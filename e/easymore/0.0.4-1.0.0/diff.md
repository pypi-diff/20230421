# Comparing `tmp/easymore-0.0.4.tar.gz` & `tmp/easymore-1.0.0.tar.gz`

## filetype from file(1)

```diff
@@ -1 +1 @@
-gzip compressed data, was "easymore-0.0.4.tar", last modified: Sun Aug 21 16:22:50 2022, max compression
+gzip compressed data, was "easymore-1.0.0.tar", last modified: Fri Apr 21 18:27:17 2023, max compression
```

## Comparing `easymore-0.0.4.tar` & `easymore-1.0.0.tar`

### file list

```diff
@@ -1,16 +1,16 @@
-drwxr-xr-x   0 shg096   (1947606008) 1162755160        0 2022-08-21 16:22:50.355116 easymore-0.0.4/
--rw-r--r--   0 shg096   (1947606008) 1162755160    35149 2022-08-21 16:21:30.000000 easymore-0.0.4/LICENSE
--rw-r--r--   0 shg096   (1947606008) 1162755160       43 2022-08-21 16:21:30.000000 easymore-0.0.4/MANIFEST.in
--rw-r--r--   0 shg096   (1947606008) 1162755160     6716 2022-08-21 16:22:50.354834 easymore-0.0.4/PKG-INFO
--rw-r--r--   0 shg096   (1947606008) 1162755160     5757 2022-08-21 16:21:30.000000 easymore-0.0.4/README.md
-drwxr-xr-x   0 shg096   (1947606008) 1162755160        0 2022-08-21 16:22:50.352465 easymore-0.0.4/easymore/
--rw-r--r--   0 shg096   (1947606008) 1162755160       39 2022-08-21 16:21:32.000000 easymore-0.0.4/easymore/__init__.py
--rw-r--r--   0 shg096   (1947606008) 1162755160   137949 2022-08-21 16:21:32.000000 easymore-0.0.4/easymore/easymore.py
-drwxr-xr-x   0 shg096   (1947606008) 1162755160        0 2022-08-21 16:22:50.354405 easymore-0.0.4/easymore.egg-info/
--rw-r--r--   0 shg096   (1947606008) 1162755160     6716 2022-08-21 16:22:50.000000 easymore-0.0.4/easymore.egg-info/PKG-INFO
--rw-r--r--   0 shg096   (1947606008) 1162755160      239 2022-08-21 16:22:50.000000 easymore-0.0.4/easymore.egg-info/SOURCES.txt
--rw-r--r--   0 shg096   (1947606008) 1162755160        1 2022-08-21 16:22:50.000000 easymore-0.0.4/easymore.egg-info/dependency_links.txt
--rw-r--r--   0 shg096   (1947606008) 1162755160      122 2022-08-21 16:22:50.000000 easymore-0.0.4/easymore.egg-info/requires.txt
--rw-r--r--   0 shg096   (1947606008) 1162755160        9 2022-08-21 16:22:50.000000 easymore-0.0.4/easymore.egg-info/top_level.txt
--rw-r--r--   0 shg096   (1947606008) 1162755160       38 2022-08-21 16:22:50.355226 easymore-0.0.4/setup.cfg
--rw-r--r--   0 shg096   (1947606008) 1162755160     3599 2022-08-21 16:21:32.000000 easymore-0.0.4/setup.py
+drwxr-xr-x   0 shg096   (1947606008) 1162755160        0 2023-04-21 18:27:17.373814 easymore-1.0.0/
+-rw-r--r--   0 shg096   (1947606008) 1162755160    35149 2023-04-21 18:26:00.000000 easymore-1.0.0/LICENSE
+-rw-r--r--   0 shg096   (1947606008) 1162755160       43 2023-04-21 18:26:00.000000 easymore-1.0.0/MANIFEST.in
+-rw-r--r--   0 shg096   (1947606008) 1162755160     6926 2023-04-21 18:27:17.373545 easymore-1.0.0/PKG-INFO
+-rw-r--r--   0 shg096   (1947606008) 1162755160     5990 2023-04-21 18:26:00.000000 easymore-1.0.0/README.md
+drwxr-xr-x   0 shg096   (1947606008) 1162755160        0 2023-04-21 18:27:17.371258 easymore-1.0.0/easymore/
+-rw-r--r--   0 shg096   (1947606008) 1162755160       39 2023-04-21 18:26:00.000000 easymore-1.0.0/easymore/__init__.py
+-rw-r--r--   0 shg096   (1947606008) 1162755160   137503 2023-04-21 18:26:00.000000 easymore-1.0.0/easymore/easymore.py
+drwxr-xr-x   0 shg096   (1947606008) 1162755160        0 2023-04-21 18:27:17.373135 easymore-1.0.0/easymore.egg-info/
+-rw-r--r--   0 shg096   (1947606008) 1162755160     6926 2023-04-21 18:27:17.000000 easymore-1.0.0/easymore.egg-info/PKG-INFO
+-rw-r--r--   0 shg096   (1947606008) 1162755160      239 2023-04-21 18:27:17.000000 easymore-1.0.0/easymore.egg-info/SOURCES.txt
+-rw-r--r--   0 shg096   (1947606008) 1162755160        1 2023-04-21 18:27:17.000000 easymore-1.0.0/easymore.egg-info/dependency_links.txt
+-rw-r--r--   0 shg096   (1947606008) 1162755160       96 2023-04-21 18:27:17.000000 easymore-1.0.0/easymore.egg-info/requires.txt
+-rw-r--r--   0 shg096   (1947606008) 1162755160        9 2023-04-21 18:27:17.000000 easymore-1.0.0/easymore.egg-info/top_level.txt
+-rw-r--r--   0 shg096   (1947606008) 1162755160       38 2023-04-21 18:27:17.373929 easymore-1.0.0/setup.cfg
+-rw-r--r--   0 shg096   (1947606008) 1162755160     3622 2023-04-21 18:26:02.000000 easymore-1.0.0/setup.py
```

### Comparing `easymore-0.0.4/LICENSE` & `easymore-1.0.0/LICENSE`

 * *Files identical despite different names*

### Comparing `easymore-0.0.4/PKG-INFO` & `easymore-1.0.0/PKG-INFO`

 * *Files 20% similar despite different names*

```diff
@@ -1,13 +1,13 @@
 Metadata-Version: 2.1
 Name: easymore
-Version: 0.0.4
+Version: 1.0.0
 Summary: geo-spatial processing of the input data for environmental and hydrological modeling
 Home-page: https://github.com/ShervanGharari/EASYMORE
-Author: ('Shervan Gharari', 'Wouter Knoben')
+Author: Shervan Gharari
 Author-email: sh.gharari@gmail.com
 License: GPLv3
 Keywords: remapping,NetCDF,shapefile,geotif,geo-spatial processing,environmental modeling
 Platform: any
 Classifier: Programming Language :: Python
 Classifier: Programming Language :: Python :: 3
 Classifier: Programming Language :: Python :: 3.6
@@ -28,85 +28,67 @@
 This package allows you to extract and aggregate the relevant values from a
 cfconventions compliant netcdf files given shapefiles.
 
 EASYMORE is a collection of functions that allows extraction of the data from a NetCDF file for a given shapefile such as a basin, catchment, points or lines. It can map gridded data or model output to any given shapefile and provide area average for a target variable.
 
 EASYMORE is very efficient as it uses pandas `groupby` functionality. Remapping of the entire north American domain from ERA5 with resolution of 0.25 degree to 500,000 subbasins of MERIT-Hydro watershed for 7 variables in 1.2 seconds for one time step (the time varying from device to device and depending on the source netCDF files sizes and their temporal aggregation).
 
-In addition, EASYMORE can perform geospatial processes that are often needed for setting up a hydroligcal or land model. These steps are zonal statistics of raster given a shapefile, zonal statistics of two shapefiles, creation of subbasins and river network topology given hydrologically conditioned DEM such as MERIT-Hydro.
-
 ## The code can be used for the following purposes:
 
 1. Remapping the relevant forcing variables, such as precipitation or temperature and other variables for the effortless model set up. This transfer can be from Thiessen polygon or gridded data, for example, to computational units, hydrological model for example.
 2. Remapping the output of a hydrological or land surface model to force another model, such as providing the gridded model output in sub-basin for routing.
 3. Extraction of single or multiple points from the gridded or irregular data for comparison with gauges data, for example.
 4. Interpolation to caorser or finer resolutions with full controllability in creating the interpolation rules.
 
 ## How to install:
 
+**âš  ATTENTION:**
+We highly recommend before using EASYMORE, the virtual environment is set up properly, and then the examples from the GitHub repository are tested to evaluate the authenticity of the results with what is generated by the EASYMORE development team. Examples and more detailed information on installation is provided in the [env](https://github.com/ShervanGharari/EASYMORE/tree/main/env) folder.
+
 ### From PyPI:
 
 `pip install easymore`
 
 ### From local repo:
 
 clone the code on your perosnal computer or home on HPC by
 
 ```
-git clone https://github.com/ShervanGharari/EASYMORE.git`
+git clone https://github.com/ShervanGharari/EASYMORE.git
 cd EASYMORE
-pip install -r requirements.txt
 pip install .
 ```
 
 ## Flexibilities:
 
-1. EASYMORE allow for commbination of the remapping of NetCDF on local computer or remote high performance computer. For example, the the GIS steps of creating remapping file can be done locally on a sample file that contains few time step of the data (but all the domain). EASYMORE can then be directed to remapping file on the HPC and will skip all the needed GIS steps and directly start remapping process of bulk of the data. For installing without gis packages you can simply do:
-
-
-### From PyPI
-
-`pip install easymore --no-deps -r requirements_basic.txt`
-
-### From local repo:
-
-```
-git clone https://github.com/ShervanGharari/EASYMORE.git`
-cd EASYMORE
-pip install -r requirements.txt
-pip install . --no-deps -r requirements_basic.txt
-```
+1. EASYMORE allow for commbination of the remapping of NetCDF on local computer or remote high performance computer. For example, the the GIS steps of creating remapping file can be done locally on a sample file that contains few time step of the data (but all the domain). EASYMORE can then be directed to remapping file on the HPC and will skip all the needed GIS steps and directly start remapping process of bulk of the data.
 
 ## Examples:
 
-1. [Remapping a regular lat/lon gridded data or model output to irregular shapes.](./examples/Chapter1_E1.ipynb)
-2. [Remapping a rotate lat/lon gridded data or model output to irregular shapes.](./examples/Chapter1_E2.ipynb)
-3. [Remapping an irregular shapefile data, such as Thiessen polygon for example, to irregular shapes.](./examples/Chapter1_E3.ipynb)
-4. [Extract the data for points (such as location of stations, cities, etc) from the grided or irregular shapefiles; temprature example](./examples/Chapter1_E4.ipynb)
-5. [Resampling of regular, rotated or irregular data and model output to any resolution density of the points](./examples/Chapter1_E5.ipynb)
-6. [Manipulation of remapped variables such as lapse rate to temperature based on elevation difference (can be applied to slope and aspect, etc)](./examples/Chapter1_E6.ipynb)
-7. [Creation of subbasins for hydrologically conditioned MERIT-Hydro DEM and perform spatial processes for finding elevation and land cover characteistics of all the subbasins](./examples/Chapter2_E1.ipynb)
-8. [Creation of Thiessen polygons, sampling a from a geotif based on point shapefile](./examples/Chapter2_E2.ipynb)
+1. [Illustrative example.](https://github.com/ShervanGharari/EASYMORE/blob/main/examples/00_test_example.ipynb)
+2. [Remap variables from a regular lat/lon gridded data or model output to irregular shapes.](https://github.com/ShervanGharari/EASYMORE/blob/main/examples/01_ERA5_Regular_Lat_Lon.ipynb)
+3. [Remap variables from a regular lat/lon gridded data or model output to irregular shapes with missing values and non-overlapping extent.](https://github.com/ShervanGharari/EASYMORE/blob/main/examples/02_ERA5_Regular_Lat_Lon_NaN.ipynb)
+4. [Remap variables from a rotate lat/lon gridded data or model output to irregular shapes.](https://github.com/ShervanGharari/EASYMORE/blob/main/examples/03_WRF_Rotated_Lat_Lon.ipynb)
+5. [Remap variables from an irregular shapefile data from Thiessen polygons of station data to irregular shapes.](https://github.com/ShervanGharari/EASYMORE/blob/main/examples/04_Thiessen_Polygons_SCDNA.ipynb)
+6. [Remap variables from irregular shapefile data, such as administrative boundaries for example, to irregular shapes.](https://github.com/ShervanGharari/EASYMORE/blob/main/examples/05_irregular_shapes.ipynb)
+7. [Extract variables for points (such as locations of stations, cities, etc) from the grided or irregular shapefiles; temperature example](https://github.com/ShervanGharari/EASYMORE/blob/main/examples/07_GRACE_capitals.ipynb)
+8. [Interpolate regular, rotated, or irregular data and model output to any resolution density of the points by reconstructing the remapping file](https://github.com/ShervanGharari/EASYMORE/blob/main/examples/92_WRF_interpolation.ipynb)
 
 The two figures show remapping of the gridded temperature from ERA5 data set to subbasin of South Saskatchewan River at Medicine Hat.
 
 ### Original gridded temperature field:
 
-<img src="./fig/Gird.png" width="2000">
+![](https://github.com/ShervanGharari/EASYMORE/blob/main/fig/Gird_new.png)
 
 ### Remapped temperature field to the subbasins:
 
-<img src="./fig/Remapped.png" width="2000">
+![](https://github.com/ShervanGharari/EASYMORE/blob/main/fig/Remapped_new.png)
 
 ## Publication that have used EASYMORE so far:
 
-Authors
-
-Knoben, W. J. M., Clark, M. P., Bales, J., Bennett, A., Gharari, S., Marsh, C. B., Nijssen, B., Pietroniro, A., Spiteri, R. J., Tarboton, D. G., Wood, A. W.: Community Workflows to Advance Reproducibility in Hydrologic Modeling: Separating model-agnostic and model-specific configuration steps in applications of large-domain hydrologic models, Earth and Space Science Open Archive, 42, https://doi.org/10.1002/essoar.10509195.1, 2021
+Knoben, W. J. M., Clark, M. P., Bales, J., Bennett, A., Gharari, S., Marsh, C. B., Nijssen, B., Pietroniro, A., Spiteri, R. J., Tarboton, D. G., Wood, A. W.: Community Workflows to Advance Reproducibility in Hydrologic Modeling: Separating Model-Agnostic and Model-Specific Configuration Steps in Applications of Large-Domain Hydrologic Models, Water Resources Research, 58, e2021WR031753. https://doi.org/10.1029/2021WR031753
 
 Gharari, S., Vanderkelen, I., Tefs, A., Mizukami, N., Stadnyk, T. A., Lawrence, D., Clark, M. P.: A Flexible Multi-Scale Framework to Simulate Lakes and Reservoirs in Earth System Models, Earth and Space Science Open Archive, 24, https://doi.org/10.1002/essoar.10510902.1, 2022
 
 Gharari, S., Clark, M. P., Mizukami, N., Knoben, W. J. M., Wong, J. S., and Pietroniro, A.: Flexible vector-based spatial configurations in land models, Hydrol. Earth Syst. Sci., 24, 5953â€“5971, https://doi.org/10.5194/hess-24-5953-2020, 2020
 
 Sheikholeslami, R., Gharari, S., Papalexiou, S. M., Clark, M. P.: VISCOUS: A Variance-Based Sensitivity Analysis Using Copulas for Efficient Identification of Dominant Hydrological Processes, Water Resources Research, https://doi.org/10.1029/2020WR028435, 2021.
-
-
```

### Comparing `easymore-0.0.4/README.md` & `easymore-1.0.0/README.md`

 * *Files 20% similar despite different names*

```diff
@@ -5,83 +5,67 @@
 This package allows you to extract and aggregate the relevant values from a
 cfconventions compliant netcdf files given shapefiles.
 
 EASYMORE is a collection of functions that allows extraction of the data from a NetCDF file for a given shapefile such as a basin, catchment, points or lines. It can map gridded data or model output to any given shapefile and provide area average for a target variable.
 
 EASYMORE is very efficient as it uses pandas `groupby` functionality. Remapping of the entire north American domain from ERA5 with resolution of 0.25 degree to 500,000 subbasins of MERIT-Hydro watershed for 7 variables in 1.2 seconds for one time step (the time varying from device to device and depending on the source netCDF files sizes and their temporal aggregation).
 
-In addition, EASYMORE can perform geospatial processes that are often needed for setting up a hydroligcal or land model. These steps are zonal statistics of raster given a shapefile, zonal statistics of two shapefiles, creation of subbasins and river network topology given hydrologically conditioned DEM such as MERIT-Hydro.
-
 ## The code can be used for the following purposes:
 
 1. Remapping the relevant forcing variables, such as precipitation or temperature and other variables for the effortless model set up. This transfer can be from Thiessen polygon or gridded data, for example, to computational units, hydrological model for example.
 2. Remapping the output of a hydrological or land surface model to force another model, such as providing the gridded model output in sub-basin for routing.
 3. Extraction of single or multiple points from the gridded or irregular data for comparison with gauges data, for example.
 4. Interpolation to caorser or finer resolutions with full controllability in creating the interpolation rules.
 
 ## How to install:
 
+**âš  ATTENTION:**
+We highly recommend before using EASYMORE, the virtual environment is set up properly, and then the examples from the GitHub repository are tested to evaluate the authenticity of the results with what is generated by the EASYMORE development team. Examples and more detailed information on installation is provided in the [env](https://github.com/ShervanGharari/EASYMORE/tree/main/env) folder.
+
 ### From PyPI:
 
 `pip install easymore`
 
 ### From local repo:
 
 clone the code on your perosnal computer or home on HPC by
 
 ```
-git clone https://github.com/ShervanGharari/EASYMORE.git`
+git clone https://github.com/ShervanGharari/EASYMORE.git
 cd EASYMORE
-pip install -r requirements.txt
 pip install .
 ```
 
 ## Flexibilities:
 
-1. EASYMORE allow for commbination of the remapping of NetCDF on local computer or remote high performance computer. For example, the the GIS steps of creating remapping file can be done locally on a sample file that contains few time step of the data (but all the domain). EASYMORE can then be directed to remapping file on the HPC and will skip all the needed GIS steps and directly start remapping process of bulk of the data. For installing without gis packages you can simply do:
-
-
-### From PyPI
-
-`pip install easymore --no-deps -r requirements_basic.txt`
-
-### From local repo:
-
-```
-git clone https://github.com/ShervanGharari/EASYMORE.git`
-cd EASYMORE
-pip install -r requirements.txt
-pip install . --no-deps -r requirements_basic.txt
-```
+1. EASYMORE allow for commbination of the remapping of NetCDF on local computer or remote high performance computer. For example, the the GIS steps of creating remapping file can be done locally on a sample file that contains few time step of the data (but all the domain). EASYMORE can then be directed to remapping file on the HPC and will skip all the needed GIS steps and directly start remapping process of bulk of the data.
 
 ## Examples:
 
-1. [Remapping a regular lat/lon gridded data or model output to irregular shapes.](./examples/Chapter1_E1.ipynb)
-2. [Remapping a rotate lat/lon gridded data or model output to irregular shapes.](./examples/Chapter1_E2.ipynb)
-3. [Remapping an irregular shapefile data, such as Thiessen polygon for example, to irregular shapes.](./examples/Chapter1_E3.ipynb)
-4. [Extract the data for points (such as location of stations, cities, etc) from the grided or irregular shapefiles; temprature example](./examples/Chapter1_E4.ipynb)
-5. [Resampling of regular, rotated or irregular data and model output to any resolution density of the points](./examples/Chapter1_E5.ipynb)
-6. [Manipulation of remapped variables such as lapse rate to temperature based on elevation difference (can be applied to slope and aspect, etc)](./examples/Chapter1_E6.ipynb)
-7. [Creation of subbasins for hydrologically conditioned MERIT-Hydro DEM and perform spatial processes for finding elevation and land cover characteistics of all the subbasins](./examples/Chapter2_E1.ipynb)
-8. [Creation of Thiessen polygons, sampling a from a geotif based on point shapefile](./examples/Chapter2_E2.ipynb)
+1. [Illustrative example.](https://github.com/ShervanGharari/EASYMORE/blob/main/examples/00_test_example.ipynb)
+2. [Remap variables from a regular lat/lon gridded data or model output to irregular shapes.](https://github.com/ShervanGharari/EASYMORE/blob/main/examples/01_ERA5_Regular_Lat_Lon.ipynb)
+3. [Remap variables from a regular lat/lon gridded data or model output to irregular shapes with missing values and non-overlapping extent.](https://github.com/ShervanGharari/EASYMORE/blob/main/examples/02_ERA5_Regular_Lat_Lon_NaN.ipynb)
+4. [Remap variables from a rotate lat/lon gridded data or model output to irregular shapes.](https://github.com/ShervanGharari/EASYMORE/blob/main/examples/03_WRF_Rotated_Lat_Lon.ipynb)
+5. [Remap variables from an irregular shapefile data from Thiessen polygons of station data to irregular shapes.](https://github.com/ShervanGharari/EASYMORE/blob/main/examples/04_Thiessen_Polygons_SCDNA.ipynb)
+6. [Remap variables from irregular shapefile data, such as administrative boundaries for example, to irregular shapes.](https://github.com/ShervanGharari/EASYMORE/blob/main/examples/05_irregular_shapes.ipynb)
+7. [Extract variables for points (such as locations of stations, cities, etc) from the grided or irregular shapefiles; temperature example](https://github.com/ShervanGharari/EASYMORE/blob/main/examples/07_GRACE_capitals.ipynb)
+8. [Interpolate regular, rotated, or irregular data and model output to any resolution density of the points by reconstructing the remapping file](https://github.com/ShervanGharari/EASYMORE/blob/main/examples/92_WRF_interpolation.ipynb)
 
 The two figures show remapping of the gridded temperature from ERA5 data set to subbasin of South Saskatchewan River at Medicine Hat.
 
 ### Original gridded temperature field:
 
-<img src="./fig/Gird.png" width="2000">
+![](https://github.com/ShervanGharari/EASYMORE/blob/main/fig/Gird_new.png)
 
 ### Remapped temperature field to the subbasins:
 
-<img src="./fig/Remapped.png" width="2000">
+![](https://github.com/ShervanGharari/EASYMORE/blob/main/fig/Remapped_new.png)
 
 ## Publication that have used EASYMORE so far:
 
-Authors
-
-Knoben, W. J. M., Clark, M. P., Bales, J., Bennett, A., Gharari, S., Marsh, C. B., Nijssen, B., Pietroniro, A., Spiteri, R. J., Tarboton, D. G., Wood, A. W.: Community Workflows to Advance Reproducibility in Hydrologic Modeling: Separating model-agnostic and model-specific configuration steps in applications of large-domain hydrologic models, Earth and Space Science Open Archive, 42, https://doi.org/10.1002/essoar.10509195.1, 2021
+Knoben, W. J. M., Clark, M. P., Bales, J., Bennett, A., Gharari, S., Marsh, C. B., Nijssen, B., Pietroniro, A., Spiteri, R. J., Tarboton, D. G., Wood, A. W.: Community Workflows to Advance Reproducibility in Hydrologic Modeling: Separating Model-Agnostic and Model-Specific Configuration Steps in Applications of Large-Domain Hydrologic Models, Water Resources Research, 58, e2021WR031753. https://doi.org/10.1029/2021WR031753
 
 Gharari, S., Vanderkelen, I., Tefs, A., Mizukami, N., Stadnyk, T. A., Lawrence, D., Clark, M. P.: A Flexible Multi-Scale Framework to Simulate Lakes and Reservoirs in Earth System Models, Earth and Space Science Open Archive, 24, https://doi.org/10.1002/essoar.10510902.1, 2022
 
 Gharari, S., Clark, M. P., Mizukami, N., Knoben, W. J. M., Wong, J. S., and Pietroniro, A.: Flexible vector-based spatial configurations in land models, Hydrol. Earth Syst. Sci., 24, 5953â€“5971, https://doi.org/10.5194/hess-24-5953-2020, 2020
 
 Sheikholeslami, R., Gharari, S., Papalexiou, S. M., Clark, M. P.: VISCOUS: A Variance-Based Sensitivity Analysis Using Copulas for Efficient Identification of Dominant Hydrological Processes, Water Resources Research, https://doi.org/10.1029/2020WR028435, 2021.
```

### Comparing `easymore-0.0.4/easymore/easymore.py` & `easymore-1.0.0/easymore/easymore.py`

 * *Files 8% similar despite different names*

```diff
@@ -10,8613 +10,8585 @@
 00000090: 6461 7320 2020 2020 2020 6173 2070 640a  das       as pd.
 000000a0: 696d 706f 7274 2078 6172 7261 7920 2020  import xarray   
 000000b0: 2020 2020 6173 2078 720a 696d 706f 7274      as xr.import
 000000c0: 2073 7973 0a69 6d70 6f72 7420 6f73 0a69   sys.import os.i
 000000d0: 6d70 6f72 7420 7761 726e 696e 6773 0a66  mport warnings.f
 000000e0: 726f 6d20 2020 6461 7465 7469 6d65 2020  rom   datetime  
 000000f0: 2020 2069 6d70 6f72 7420 6461 7465 7469     import dateti
-00000100: 6d65 0a69 6d70 6f72 7420 7265 0a0a 0a63  me.import re...c
-00000110: 6c61 7373 2065 6173 796d 6f72 653a 0a0a  lass easymore:..
-00000120: 2020 2020 6465 6620 5f5f 696e 6974 5f5f      def __init__
-00000130: 2873 656c 6629 3a0a 2020 2020 2020 2020  (self):.        
-00000140: 7365 6c66 2e63 6173 655f 6e61 6d65 2020  self.case_name  
-00000150: 2020 2020 2020 2020 2020 2020 2020 203d                 =
-00000160: 2020 2763 6173 655f 7465 6d70 2720 2320    'case_temp' # 
-00000170: 6e61 6d65 206f 6620 7468 6520 6361 7365  name of the case
-00000180: 0a20 2020 2020 2020 2073 656c 662e 7461  .        self.ta
-00000190: 7267 6574 5f73 6870 2020 2020 2020 2020  rget_shp        
-000001a0: 2020 2020 2020 2020 3d20 2027 2720 2320          =  '' # 
-000001b0: 7369 6e6b 2f74 6172 6765 7420 7368 6170  sink/target shap
-000001c0: 6566 696c 650a 2020 2020 2020 2020 7365  efile.        se
-000001d0: 6c66 2e74 6172 6765 745f 7368 705f 4944  lf.target_shp_ID
-000001e0: 2020 2020 2020 2020 2020 2020 203d 2020               =  
-000001f0: 2727 2023 206e 616d 6520 6f66 2074 6865  '' # name of the
-00000200: 2063 6f6c 756d 6e20 4944 2069 6e20 7468   column ID in th
-00000210: 6520 7369 6e6b 2f74 6172 6765 7420 7368  e sink/target sh
-00000220: 6170 6566 696c 650a 2020 2020 2020 2020  apefile.        
-00000230: 7365 6c66 2e74 6172 6765 745f 7368 705f  self.target_shp_
-00000240: 6c61 7420 2020 2020 2020 2020 2020 203d  lat            =
-00000250: 2020 2727 2023 206e 616d 6520 6f66 2074    '' # name of t
-00000260: 6865 2063 6f6c 756d 6e20 6c61 7469 7475  he column latitu
-00000270: 6465 2069 6e20 7468 6520 7369 6e6b 2f74  de in the sink/t
-00000280: 6172 6765 7420 7368 6170 6566 696c 650a  arget shapefile.
-00000290: 2020 2020 2020 2020 7365 6c66 2e74 6172          self.tar
-000002a0: 6765 745f 7368 705f 6c6f 6e20 2020 2020  get_shp_lon     
-000002b0: 2020 2020 2020 203d 2020 2727 2023 206e         =  '' # n
-000002c0: 616d 6520 6f66 2074 6865 2063 6f6c 756d  ame of the colum
-000002d0: 6e20 6c6f 6e67 6974 7564 6520 696e 2074  n longitude in t
-000002e0: 6865 2073 696e 6b2f 7461 7267 6574 2073  he sink/target s
-000002f0: 6861 7065 6669 6c65 0a20 2020 2020 2020  hapefile.       
-00000300: 2073 656c 662e 736f 7572 6365 5f6e 6320   self.source_nc 
-00000310: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00000320: 3d20 2027 2720 2320 6e61 6d65 206f 6620  =  '' # name of 
-00000330: 6e63 2066 696c 6520 746f 2062 6520 7265  nc file to be re
-00000340: 6d61 7070 6564 0a20 2020 2020 2020 2073  mapped.        s
-00000350: 656c 662e 7661 725f 6e61 6d65 7320 2020  elf.var_names   
-00000360: 2020 2020 2020 2020 2020 2020 2020 3d20                = 
-00000370: 205b 5d20 2320 6c69 7374 206f 6620 7661   [] # list of va
-00000380: 7269 6261 6c65 206e 616d 6573 2074 6f20  ribale names to 
-00000390: 6265 2072 656d 6170 7065 6420 6672 6f6d  be remapped from
-000003a0: 2074 6865 2073 6f75 7263 6520 4e65 7443   the source NetC
-000003b0: 4446 2066 696c 650a 2020 2020 2020 2020  DF file.        
-000003c0: 7365 6c66 2e76 6172 5f6c 6f6e 2020 2020  self.var_lon    
-000003d0: 2020 2020 2020 2020 2020 2020 2020 203d                 =
-000003e0: 2020 2727 2023 206e 616d 6520 6f66 2076    '' # name of v
-000003f0: 6172 6962 616c 6520 6c6f 6e67 6974 7564  aribale longitud
-00000400: 6520 696e 2074 6865 2073 6f75 7263 6520  e in the source 
-00000410: 4e65 7443 4446 2066 696c 650a 2020 2020  NetCDF file.    
-00000420: 2020 2020 7365 6c66 2e76 6172 5f6c 6174      self.var_lat
-00000430: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00000440: 2020 203d 2020 2727 2023 206e 616d 6520     =  '' # name 
-00000450: 6f66 2076 6172 6962 616c 6520 6c61 7469  of varibale lati
-00000460: 7475 6465 2069 6e20 7468 6520 736f 7572  tude in the sour
-00000470: 6365 204e 6574 4344 4620 6669 6c65 0a20  ce NetCDF file. 
-00000480: 2020 2020 2020 2073 656c 662e 7661 725f         self.var_
-00000490: 7469 6d65 2020 2020 2020 2020 2020 2020  time            
-000004a0: 2020 2020 2020 3d20 2027 7469 6d65 2720        =  'time' 
-000004b0: 2320 6e61 6d65 206f 6620 7661 7269 6261  # name of variba
-000004c0: 6c65 2074 696d 6520 696e 2074 6865 2073  le time in the s
-000004d0: 6f75 7263 6520 4e65 7443 4446 2066 696c  ource NetCDF fil
-000004e0: 650a 2020 2020 2020 2020 7365 6c66 2e76  e.        self.v
-000004f0: 6172 5f49 4420 2020 2020 2020 2020 2020  ar_ID           
-00000500: 2020 2020 2020 2020 203d 2020 2727 2023           =  '' #
-00000510: 206e 616d 6520 6f66 2076 7269 6162 6c65   name of vriable
-00000520: 2049 4420 696e 2074 6865 2073 6f75 7263   ID in the sourc
-00000530: 6520 4e65 7443 4446 2066 696c 650a 2020  e NetCDF file.  
-00000540: 2020 2020 2020 7365 6c66 2e76 6172 5f6e        self.var_n
-00000550: 616d 6573 5f72 656d 6170 7065 6420 2020  ames_remapped   
-00000560: 2020 2020 203d 2020 5b5d 2023 206c 6973       =  [] # lis
-00000570: 7420 6f66 2076 6172 6962 616c 6520 6e61  t of varibale na
-00000580: 6d65 7320 7468 6174 2077 696c 6c20 6265  mes that will be
-00000590: 2072 6570 6c61 6365 6420 696e 2074 6865   replaced in the
-000005a0: 2072 656d 6170 7065 6420 6669 6c65 0a20   remapped file. 
-000005b0: 2020 2020 2020 2073 656c 662e 736f 7572         self.sour
-000005c0: 6365 5f73 6870 2020 2020 2020 2020 2020  ce_shp          
-000005d0: 2020 2020 2020 3d20 2027 2720 2320 6e61        =  '' # na
-000005e0: 6d65 206f 6620 736f 7572 6365 2073 6861  me of source sha
-000005f0: 7065 6669 6c65 2028 6573 7365 6e74 6961  pefile (essentia
-00000600: 6c20 666f 7220 6361 7365 2d33 290a 2020  l for case-3).  
-00000610: 2020 2020 2020 7365 6c66 2e73 6f75 7263        self.sourc
-00000620: 655f 7368 705f 6c61 7420 2020 2020 2020  e_shp_lat       
-00000630: 2020 2020 203d 2020 2727 2023 206e 616d       =  '' # nam
-00000640: 6520 6f66 2063 6f6c 756d 6e20 6c61 7469  e of column lati
-00000650: 7475 6465 2069 6e20 7468 6520 736f 7572  tude in the sour
-00000660: 6365 2073 6861 7065 6669 6c65 0a20 2020  ce shapefile.   
-00000670: 2020 2020 2073 656c 662e 736f 7572 6365       self.source
-00000680: 5f73 6870 5f6c 6f6e 2020 2020 2020 2020  _shp_lon        
-00000690: 2020 2020 3d20 2027 2720 2320 6e61 6d65      =  '' # name
-000006a0: 206f 6620 636f 6c75 6d6e 206c 6f6e 6769   of column longi
-000006b0: 7475 6465 2069 6e20 7468 6520 736f 7572  tude in the sour
-000006c0: 6365 2073 6861 7065 6669 6c65 0a20 2020  ce shapefile.   
-000006d0: 2020 2020 2073 656c 662e 736f 7572 6365       self.source
-000006e0: 5f73 6870 5f49 4420 2020 2020 2020 2020  _shp_ID         
-000006f0: 2020 2020 3d20 2027 2720 2320 6e61 6d65      =  '' # name
-00000700: 206f 6620 636f 6c75 6d6e 2049 4420 696e   of column ID in
-00000710: 2074 6865 2073 6f75 7263 6520 7368 6170   the source shap
-00000720: 6566 696c 650a 2020 2020 2020 2020 7365  efile.        se
-00000730: 6c66 2e72 656d 6170 7065 645f 7661 725f  lf.remapped_var_
-00000740: 6964 2020 2020 2020 2020 2020 203d 2020  id           =  
-00000750: 2749 4427 2023 206e 616d 6520 6f66 2074  'ID' # name of t
-00000760: 6865 2049 4420 7661 7269 6162 6c65 2069  he ID variable i
-00000770: 6e20 7468 6520 6e65 7720 6e63 2066 696c  n the new nc fil
-00000780: 653b 2064 6566 6175 6c74 2027 4944 270a  e; default 'ID'.
-00000790: 2020 2020 2020 2020 7365 6c66 2e72 656d          self.rem
-000007a0: 6170 7065 645f 7661 725f 6c61 7420 2020  apped_var_lat   
-000007b0: 2020 2020 2020 203d 2020 276c 6174 6974         =  'latit
-000007c0: 7564 6527 2023 206e 616d 6520 6f66 2074  ude' # name of t
-000007d0: 6865 206c 6174 6974 7564 6520 7661 7269  he latitude vari
-000007e0: 6162 6c65 2069 6e20 7468 6520 6e65 7720  able in the new 
-000007f0: 6e63 2066 696c 653b 2064 6566 6175 6c74  nc file; default
-00000800: 2027 6c61 7469 7475 6465 270a 2020 2020   'latitude'.    
-00000810: 2020 2020 7365 6c66 2e72 656d 6170 7065      self.remappe
-00000820: 645f 7661 725f 6c6f 6e20 2020 2020 2020  d_var_lon       
-00000830: 2020 203d 2020 276c 6f6e 6769 7475 6465     =  'longitude
-00000840: 2720 2320 6e61 6d65 206f 6620 7468 6520  ' # name of the 
-00000850: 6c6f 6e67 6974 7564 6520 7661 7269 6162  longitude variab
-00000860: 6c65 2069 6e20 7468 6520 6e65 7720 6e63  le in the new nc
-00000870: 2066 696c 653b 2064 6566 6175 6c74 2027   file; default '
-00000880: 6c6f 6e67 6974 7564 6527 0a20 2020 2020  longitude'.     
-00000890: 2020 2073 656c 662e 7265 6d61 7070 6564     self.remapped
-000008a0: 5f64 696d 5f69 6420 2020 2020 2020 2020  _dim_id         
-000008b0: 2020 3d20 2027 4944 2720 2320 6e61 6d65    =  'ID' # name
-000008c0: 206f 6620 7468 6520 4944 2064 696d 656e   of the ID dimen
-000008d0: 7369 6f6e 2069 6e20 7468 6520 6e65 7720  sion in the new 
-000008e0: 6e63 2066 696c 653b 2064 6566 6175 6c74  nc file; default
-000008f0: 2027 4944 270a 2020 2020 2020 2020 7365   'ID'.        se
-00000900: 6c66 2e6f 7665 7277 7269 7465 5f65 7869  lf.overwrite_exi
-00000910: 7374 696e 675f 7265 6d61 7020 203d 2020  sting_remap  =  
-00000920: 5472 7565 2023 2046 6c61 6720 746f 2061  True # Flag to a
-00000930: 7574 6f6d 6174 6963 616c 6c79 206f 7665  utomatically ove
-00000940: 7277 7269 7465 2065 7869 7374 696e 6720  rwrite existing 
-00000950: 7265 6d61 7070 696e 6720 6669 6c65 732e  remapping files.
-00000960: 2049 6620 2746 616c 7365 272c 2061 626f   If 'False', abo
-00000970: 7274 7320 7468 6520 7265 6d61 7070 696e  rts the remappin
-00000980: 6720 7072 6f63 6564 7572 6520 6966 2061  g procedure if a
-00000990: 2066 696c 6520 6973 2064 6574 6563 7465   file is detecte
-000009a0: 640a 2020 2020 2020 2020 7365 6c66 2e74  d.        self.t
-000009b0: 656d 705f 6469 7220 2020 2020 2020 2020  emp_dir         
-000009c0: 2020 2020 2020 2020 203d 2020 272e 2f74           =  './t
-000009d0: 656d 702f 2720 2320 7465 6d70 5f64 6972  emp/' # temp_dir
-000009e0: 0a20 2020 2020 2020 2073 656c 662e 6f75  .        self.ou
-000009f0: 7470 7574 5f64 6972 2020 2020 2020 2020  tput_dir        
-00000a00: 2020 2020 2020 2020 3d20 2027 2e2f 6f75          =  './ou
-00000a10: 7470 7574 2f27 2023 206f 7574 7075 7420  tput/' # output 
-00000a20: 6469 7265 6374 6f72 790a 2020 2020 2020  directory.      
-00000a30: 2020 7365 6c66 2e66 6f72 6d61 745f 6c69    self.format_li
-00000a40: 7374 2020 2020 2020 2020 2020 2020 2020  st              
-00000a50: 203d 2020 5b27 6638 275d 2023 2066 6c6f   =  ['f8'] # flo
-00000a60: 6174 2066 6f72 2074 6865 2072 656d 6170  at for the remap
-00000a70: 7065 6420 7661 6c75 6573 0a20 2020 2020  ped values.     
-00000a80: 2020 2073 656c 662e 6669 6c6c 5f76 616c     self.fill_val
-00000a90: 7565 5f6c 6973 7420 2020 2020 2020 2020  ue_list         
-00000aa0: 2020 3d20 205b 272d 3939 3939 275d 2023    =  ['-9999'] #
-00000ab0: 206d 6973 7369 6e67 2076 616c 7565 7320   missing values 
-00000ac0: 7365 7420 746f 202d 3939 3939 0a20 2020  set to -9999.   
-00000ad0: 2020 2020 2073 656c 662e 7265 6d61 705f       self.remap_
-00000ae0: 6373 7620 2020 2020 2020 2020 2020 2020  csv             
-00000af0: 2020 2020 3d20 2027 2720 2320 6e61 6d65      =  '' # name
-00000b00: 206f 6620 7468 6520 7265 6d61 7070 6564   of the remapped
-00000b10: 2066 696c 6520 6966 2070 726f 7669 6465   file if provide
-00000b20: 640a 2020 2020 2020 2020 7365 6c66 2e61  d.        self.a
-00000b30: 7574 686f 725f 6e61 6d65 2020 2020 2020  uthor_name      
-00000b40: 2020 2020 2020 2020 203d 2020 2727 2023           =  '' #
-00000b50: 206e 616d 6520 6f66 2074 6865 2061 7574   name of the aut
-00000b60: 686f 7572 0a20 2020 2020 2020 2073 656c  hour.        sel
-00000b70: 662e 6c69 6365 6e73 6520 2020 2020 2020  f.license       
-00000b80: 2020 2020 2020 2020 2020 2020 3d20 2027              =  '
-00000b90: 2720 2320 6461 7461 206c 6963 656e 7365  ' # data license
-00000ba0: 0a20 2020 2020 2020 2073 656c 662e 746f  .        self.to
-00000bb0: 6c65 7261 6e63 6520 2020 2020 2020 2020  lerance         
-00000bc0: 2020 2020 2020 2020 3d20 2031 302a 2a2d          =  10**-
-00000bd0: 3520 2320 746f 6c65 7261 6e63 650a 2020  5 # tolerance.  
-00000be0: 2020 2020 2020 7365 6c66 2e73 6176 655f        self.save_
-00000bf0: 6373 7620 2020 2020 2020 2020 2020 2020  csv             
-00000c00: 2020 2020 203d 2020 4661 6c73 6520 2320       =  False # 
-00000c10: 7361 7665 2063 7376 0a20 2020 2020 2020  save csv.       
-00000c20: 2073 656c 662e 736f 7274 5f49 4420 2020   self.sort_ID   
-00000c30: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00000c40: 3d20 2046 616c 7365 2023 2074 6f20 736f  =  False # to so
-00000c50: 7274 2074 6865 2072 656d 6170 7065 6420  rt the remapped 
-00000c60: 6261 7365 6420 6f6e 2074 6865 2074 6172  based on the tar
-00000c70: 6765 7420 7368 6170 6669 6c65 2049 443b  get shapfile ID;
-00000c80: 2073 656c 662e 7461 7267 6574 5f73 6870   self.target_shp
-00000c90: 5f49 4420 7368 6f75 6c64 2062 6520 6769  _ID should be gi
-00000ca0: 7665 6e0a 2020 2020 2020 2020 7365 6c66  ven.        self
-00000cb0: 2e63 6f6d 706c 6576 656c 2020 2020 2020  .complevel      
-00000cc0: 2020 2020 2020 2020 2020 203d 2020 3420             =  4 
-00000cd0: 2320 6e65 7463 6466 2063 6f6d 7072 6573  # netcdf compres
-00000ce0: 7369 6f6e 206c 6576 656c 2066 726f 6d20  sion level from 
-00000cf0: 3120 746f 2039 2e20 416e 7920 6f74 6865  1 to 9. Any othe
-00000d00: 7220 7661 6c75 6520 6f72 206f 626a 6563  r value or objec
-00000d10: 7420 7769 6c6c 206d 6561 6e20 6e6f 2063  t will mean no c
-00000d20: 6f6d 7072 6573 7369 6f6e 2e0a 2020 2020  ompression..    
-00000d30: 2020 2020 7365 6c66 2e76 6572 7369 6f6e      self.version
-00000d40: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00000d50: 2020 203d 2020 2730 2e30 2e34 2720 2320     =  '0.0.4' # 
-00000d60: 7665 7273 696f 6e20 6f66 2074 6865 2065  version of the e
-00000d70: 6173 796d 6f72 650a 2020 2020 2020 2020  asymore.        
-00000d80: 7072 696e 7428 2745 4153 594d 4f52 4520  print('EASYMORE 
-00000d90: 7665 7273 696f 6e20 272b 7365 6c66 2e76  version '+self.v
-00000da0: 6572 7369 6f6e 2b20 2720 6973 2069 6e69  ersion+ ' is ini
-00000db0: 7469 6174 6564 2e27 290a 0a20 2020 2023  tiated.')..    #
-00000dc0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-00000dd0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-00000de0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-00000df0: 2323 2323 2323 2323 2323 2323 230a 2020  #############.  
-00000e00: 2020 2323 2323 204e 6574 4344 4620 7265    #### NetCDF re
-00000e10: 6d61 7070 696e 670a 2020 2020 2323 2323  mapping.    ####
-00000e20: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-00000e30: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-00000e40: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-00000e50: 2323 2323 2323 2323 2323 0a0a 2020 2020  ##########..    
-00000e60: 6465 6620 6e63 5f72 656d 6170 7065 7228  def nc_remapper(
-00000e70: 7365 6c66 293a 0a20 2020 2020 2020 2022  self):.        "
-00000e80: 2222 0a20 2020 2020 2020 2040 2061 7574  "".        @ aut
-00000e90: 686f 723a 2020 2020 2020 2020 2020 2020  hor:            
-00000ea0: 2020 2020 2020 5368 6572 7661 6e20 4768        Shervan Gh
-00000eb0: 6172 6172 690a 2020 2020 2020 2020 4020  arari.        @ 
-00000ec0: 4769 7468 7562 3a20 2020 2020 2020 2020  Github:         
-00000ed0: 2020 2020 2020 2020 2068 7474 7073 3a2f           https:/
-00000ee0: 2f67 6974 6875 622e 636f 6d2f 5368 6572  /github.com/Sher
-00000ef0: 7661 6e47 6861 7261 7269 2f45 4153 594d  vanGharari/EASYM
-00000f00: 4f52 450a 2020 2020 2020 2020 4020 6175  ORE.        @ au
-00000f10: 7468 6f72 2773 2065 6d61 696c 2069 643a  thor's email id:
-00000f20: 2020 2020 2020 2073 682e 6768 6172 6172         sh.gharar
-00000f30: 6940 676d 6169 6c2e 636f 6d0a 2020 2020  i@gmail.com.    
-00000f40: 2020 2020 4020 6c69 6365 6e73 653a 2020      @ license:  
-00000f50: 2020 2020 2020 2020 2020 2020 2020 2047                 G
-00000f60: 4e55 2d47 504c 7633 0a20 2020 2020 2020  NU-GPLv3.       
-00000f70: 2054 6869 7320 6675 6e63 7469 6f6e 2072   This function r
-00000f80: 756e 7320 6120 7365 7420 6f66 2045 4153  uns a set of EAS
-00000f90: 594d 4f52 4520 6675 6e63 7469 6f6e 2077  YMORE function w
-00000fa0: 6869 6368 2063 616e 2072 656d 6170 2066  hich can remap f
-00000fb0: 726f 6d20 6120 7372 6f75 6365 2073 6861  rom a srouce sha
-00000fc0: 7065 6669 6c65 0a20 2020 2020 2020 2077  pefile.        w
-00000fd0: 6974 6820 7265 6775 6c61 722c 2072 6f61  ith regular, roa
-00000fe0: 7465 642c 2069 7272 6567 756c 6172 2074  ted, irregular t
-00000ff0: 6f20 6120 7461 7267 6574 2073 6861 7065  o a target shape
-00001000: 6669 6c65 0a20 2020 2020 2020 2022 2222  file.        """
-00001010: 0a20 2020 2020 2020 2023 2063 6865 636b  .        # check
-00001020: 2045 4153 594d 4f52 4520 696e 7075 740a   EASYMORE input.
-00001030: 2020 2020 2020 2020 7365 6c66 2e63 6865          self.che
-00001040: 636b 5f65 6173 796d 6f72 655f 696e 7075  ck_easymore_inpu
-00001050: 7428 290a 2020 2020 2020 2020 2320 6966  t().        # if
-00001060: 2072 656d 6170 2069 7320 6e6f 7420 7072   remap is not pr
-00001070: 6f76 6964 6564 2074 6865 6e20 6372 6561  ovided then crea
-00001080: 7465 2074 6865 2072 656d 6170 7069 6e67  te the remapping
-00001090: 2066 696c 650a 2020 2020 2020 2020 6966   file.        if
-000010a0: 2073 656c 662e 7265 6d61 705f 6373 7620   self.remap_csv 
-000010b0: 3d3d 2027 273a 0a20 2020 2020 2020 2020  == '':.         
-000010c0: 2020 2069 6d70 6f72 7420 6765 6f70 616e     import geopan
-000010d0: 6461 7320 6173 2067 7064 0a20 2020 2020  das as gpd.     
-000010e0: 2020 2020 2020 2023 2063 6865 636b 2074         # check t
-000010f0: 6865 2074 6172 6765 7420 7368 6170 6566  he target shapef
-00001100: 696c 650a 2020 2020 2020 2020 2020 2020  ile.            
-00001110: 7461 7267 6574 5f73 6870 5f67 7064 203d  target_shp_gpd =
-00001120: 2067 7064 2e72 6561 645f 6669 6c65 2873   gpd.read_file(s
-00001130: 656c 662e 7461 7267 6574 5f73 6870 290a  elf.target_shp).
-00001140: 2020 2020 2020 2020 2020 2020 7461 7267              targ
-00001150: 6574 5f73 6870 5f67 7064 203d 2073 656c  et_shp_gpd = sel
-00001160: 662e 6368 6563 6b5f 7461 7267 6574 5f73  f.check_target_s
-00001170: 6870 2874 6172 6765 745f 7368 705f 6770  hp(target_shp_gp
-00001180: 6429 0a20 2020 2020 2020 2020 2020 2023  d).            #
-00001190: 2073 6176 6520 7468 6520 7374 616e 6461   save the standa
-000011a0: 7264 2074 6172 6765 7420 7368 6170 6566  rd target shapef
-000011b0: 696c 650a 2020 2020 2020 2020 2020 2020  ile.            
-000011c0: 7072 696e 7428 2745 4153 594d 4f52 4520  print('EASYMORE 
-000011d0: 7769 6c6c 2073 6176 6520 7374 616e 6461  will save standa
-000011e0: 7264 2073 6861 7065 6669 6c65 2066 6f72  rd shapefile for
-000011f0: 2045 4153 594d 4f52 4520 636c 6163 756c   EASYMORE clacul
-00001200: 6174 696f 6e20 6173 3a27 290a 2020 2020  ation as:').    
-00001210: 2020 2020 2020 2020 7072 696e 7428 7365          print(se
-00001220: 6c66 2e74 656d 705f 6469 722b 7365 6c66  lf.temp_dir+self
-00001230: 2e63 6173 655f 6e61 6d65 2b27 5f74 6172  .case_name+'_tar
-00001240: 6765 745f 7368 6170 6566 696c 652e 7368  get_shapefile.sh
-00001250: 7027 290a 2020 2020 2020 2020 2020 2020  p').            
-00001260: 7461 7267 6574 5f73 6870 5f67 7064 2e74  target_shp_gpd.t
-00001270: 6f5f 6669 6c65 2873 656c 662e 7465 6d70  o_file(self.temp
-00001280: 5f64 6972 2b73 656c 662e 6361 7365 5f6e  _dir+self.case_n
-00001290: 616d 652b 275f 7461 7267 6574 5f73 6861  ame+'_target_sha
-000012a0: 7065 6669 6c65 2e73 6870 2729 2023 2073  pefile.shp') # s
-000012b0: 6176 650a 2020 2020 2020 2020 2020 2020  ave.            
-000012c0: 2320 6368 6563 6b20 7468 6520 736f 7572  # check the sour
-000012d0: 6365 204e 6574 4344 4620 6669 6c65 730a  ce NetCDF files.
-000012e0: 2020 2020 2020 2020 2020 2020 7365 6c66              self
-000012f0: 2e63 6865 636b 5f73 6f75 7263 655f 6e63  .check_source_nc
-00001300: 2829 0a20 2020 2020 2020 2020 2020 2023  ().            #
-00001310: 2066 696e 6420 7468 6520 6361 7365 0a20   find the case. 
-00001320: 2020 2020 2020 2020 2020 2073 656c 662e             self.
-00001330: 4e65 7443 4446 5f53 4850 5f6c 6174 5f6c  NetCDF_SHP_lat_l
-00001340: 6f6e 2829 0a20 2020 2020 2020 2020 2020  on().           
-00001350: 2023 2063 7265 6174 6520 7468 6520 736f   # create the so
-00001360: 7572 6365 2073 6861 7065 6669 6c65 2066  urce shapefile f
-00001370: 6f72 2063 6173 6520 3120 616e 6420 3220  or case 1 and 2 
-00001380: 6966 2073 6861 7065 6669 6c65 2069 7320  if shapefile is 
-00001390: 6e6f 7420 7072 6f76 6964 6564 0a20 2020  not provided.   
-000013a0: 2020 2020 2020 2020 2069 6620 2873 656c           if (sel
-000013b0: 662e 6361 7365 203d 3d20 3120 6f72 2073  f.case == 1 or s
-000013c0: 656c 662e 6361 7365 203d 3d20 3229 2020  elf.case == 2)  
-000013d0: 616e 6420 2873 656c 662e 736f 7572 6365  and (self.source
-000013e0: 5f73 6870 203d 3d20 2727 293a 0a20 2020  _shp == ''):.   
-000013f0: 2020 2020 2020 2020 2020 2020 2069 6620               if 
-00001400: 7365 6c66 2e63 6173 6520 3d3d 2031 3a0a  self.case == 1:.
-00001410: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00001420: 2020 2020 6966 2068 6173 6174 7472 2873      if hasattr(s
-00001430: 656c 662c 2027 6c61 745f 6578 7061 6e64  elf, 'lat_expand
-00001440: 6564 2729 2061 6e64 2068 6173 6174 7472  ed') and hasattr
-00001450: 2873 656c 662c 2027 6c6f 6e5f 6578 7061  (self, 'lon_expa
-00001460: 6e64 6564 2729 3a0a 2020 2020 2020 2020  nded'):.        
-00001470: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00001480: 7365 6c66 2e6c 6174 5f6c 6f6e 5f53 4850  self.lat_lon_SHP
-00001490: 2873 656c 662e 6c61 745f 6578 7061 6e64  (self.lat_expand
-000014a0: 6564 2c20 7365 6c66 2e6c 6f6e 5f65 7870  ed, self.lon_exp
-000014b0: 616e 6465 642c 5c0a 2020 2020 2020 2020  anded,\.        
-000014c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000014d0: 2020 2020 7365 6c66 2e74 656d 705f 6469      self.temp_di
-000014e0: 722b 7365 6c66 2e63 6173 655f 6e61 6d65  r+self.case_name
-000014f0: 2b27 5f73 6f75 7263 655f 7368 6170 6566  +'_source_shapef
-00001500: 696c 652e 7368 7027 290a 2020 2020 2020  ile.shp').      
-00001510: 2020 2020 2020 2020 2020 2020 2020 656c                el
-00001520: 7365 3a0a 2020 2020 2020 2020 2020 2020  se:.            
-00001530: 2020 2020 2020 2020 2020 2020 7365 6c66              self
-00001540: 2e6c 6174 5f6c 6f6e 5f53 4850 2873 656c  .lat_lon_SHP(sel
-00001550: 662e 6c61 742c 2073 656c 662e 6c6f 6e2c  f.lat, self.lon,
-00001560: 5c0a 2020 2020 2020 2020 2020 2020 2020  \.              
-00001570: 2020 2020 2020 2020 2020 2020 2020 7365                se
-00001580: 6c66 2e74 656d 705f 6469 722b 7365 6c66  lf.temp_dir+self
-00001590: 2e63 6173 655f 6e61 6d65 2b27 5f73 6f75  .case_name+'_sou
-000015a0: 7263 655f 7368 6170 6566 696c 652e 7368  rce_shapefile.sh
-000015b0: 7027 290a 2020 2020 2020 2020 2020 2020  p').            
-000015c0: 2020 2020 656c 7365 3a0a 2020 2020 2020      else:.      
-000015d0: 2020 2020 2020 2020 2020 2020 2020 7365                se
-000015e0: 6c66 2e6c 6174 5f6c 6f6e 5f53 4850 2873  lf.lat_lon_SHP(s
-000015f0: 656c 662e 6c61 742c 2073 656c 662e 6c6f  elf.lat, self.lo
-00001600: 6e2c 5c0a 2020 2020 2020 2020 2020 2020  n,\.            
-00001610: 2020 2020 2020 2020 2020 2020 7365 6c66              self
-00001620: 2e74 656d 705f 6469 722b 7365 6c66 2e63  .temp_dir+self.c
-00001630: 6173 655f 6e61 6d65 2b27 5f73 6f75 7263  ase_name+'_sourc
-00001640: 655f 7368 6170 6566 696c 652e 7368 7027  e_shapefile.shp'
-00001650: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
-00001660: 2020 7072 696e 7428 2745 4153 594d 4f52    print('EASYMOR
-00001670: 4520 6973 2063 7265 6174 696e 6720 7468  E is creating th
-00001680: 6520 7368 6170 6566 696c 6520 6672 6f6d  e shapefile from
-00001690: 2074 6865 206e 6574 4344 4620 6669 6c65   the netCDF file
-000016a0: 2061 6e64 2073 6176 696e 6720 6974 2068   and saving it h
-000016b0: 6572 653a 2729 0a20 2020 2020 2020 2020  ere:').         
-000016c0: 2020 2020 2020 2070 7269 6e74 2873 656c         print(sel
-000016d0: 662e 7465 6d70 5f64 6972 2b73 656c 662e  f.temp_dir+self.
-000016e0: 6361 7365 5f6e 616d 652b 275f 736f 7572  case_name+'_sour
-000016f0: 6365 5f73 6861 7065 6669 6c65 2e73 6870  ce_shapefile.shp
-00001700: 2729 0a20 2020 2020 2020 2020 2020 2069  ').            i
-00001710: 6620 2873 656c 662e 6361 7365 203d 3d20  f (self.case == 
-00001720: 3120 6f72 2073 656c 662e 6361 7365 203d  1 or self.case =
-00001730: 3d20 3229 2020 616e 6420 2873 656c 662e  = 2)  and (self.
-00001740: 736f 7572 6365 5f73 6870 2021 3d20 2727  source_shp != ''
-00001750: 293a 0a20 2020 2020 2020 2020 2020 2020  ):.             
-00001760: 2020 2073 6f75 7263 655f 7368 705f 6770     source_shp_gp
-00001770: 6420 3d20 6770 642e 7265 6164 5f66 696c  d = gpd.read_fil
-00001780: 6528 7365 6c66 2e73 6f75 7263 655f 7368  e(self.source_sh
-00001790: 7029 0a20 2020 2020 2020 2020 2020 2020  p).             
-000017a0: 2020 2073 6f75 7263 655f 7368 705f 6770     source_shp_gp
-000017b0: 6420 3d20 7365 6c66 2e61 6464 5f6c 6174  d = self.add_lat
-000017c0: 5f6c 6f6e 5f73 6f75 7263 655f 5348 5028  _lon_source_SHP(
-000017d0: 736f 7572 6365 5f73 6870 5f67 7064 2c20  source_shp_gpd, 
-000017e0: 7365 6c66 2e73 6f75 7263 655f 7368 705f  self.source_shp_
-000017f0: 6c61 742c 5c0a 2020 2020 2020 2020 2020  lat,\.          
-00001800: 2020 2020 2020 2020 2020 7365 6c66 2e73            self.s
-00001810: 6f75 7263 655f 7368 705f 6c6f 6e2c 2073  ource_shp_lon, s
-00001820: 656c 662e 736f 7572 6365 5f73 6870 5f49  elf.source_shp_I
-00001830: 4429 0a20 2020 2020 2020 2020 2020 2020  D).             
-00001840: 2020 2073 6f75 7263 655f 7368 705f 6770     source_shp_gp
-00001850: 642e 746f 5f66 696c 6528 7365 6c66 2e74  d.to_file(self.t
-00001860: 656d 705f 6469 722b 7365 6c66 2e63 6173  emp_dir+self.cas
-00001870: 655f 6e61 6d65 2b27 5f73 6f75 7263 655f  e_name+'_source_
-00001880: 7368 6170 6566 696c 652e 7368 7027 290a  shapefile.shp').
-00001890: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000018a0: 7072 696e 7428 2745 4153 594d 4f52 4520  print('EASYMORE 
-000018b0: 6465 7465 6374 2074 6865 2073 6861 7065  detect the shape
-000018c0: 6669 6c65 2069 7320 7072 6f76 6964 6564  file is provided
-000018d0: 2061 6e64 2077 696c 6c20 7265 7361 7665   and will resave
-000018e0: 2069 7420 6865 7265 3a27 290a 2020 2020   it here:').    
-000018f0: 2020 2020 2020 2020 2020 2020 7072 696e              prin
-00001900: 7428 7365 6c66 2e74 656d 705f 6469 722b  t(self.temp_dir+
-00001910: 7365 6c66 2e63 6173 655f 6e61 6d65 2b27  self.case_name+'
-00001920: 5f73 6f75 7263 655f 7368 6170 6566 696c  _source_shapefil
-00001930: 652e 7368 7027 290a 2020 2020 2020 2020  e.shp').        
-00001940: 2020 2020 2320 6966 2063 6173 6520 3320      # if case 3 
-00001950: 6f72 2073 6f75 7263 6520 7368 6170 6566  or source shapef
-00001960: 696c 6520 6973 2070 726f 7669 6465 640a  ile is provided.
-00001970: 2020 2020 2020 2020 2020 2020 6966 2028              if (
-00001980: 7365 6c66 2e63 6173 6520 3d3d 2033 2920  self.case == 3) 
-00001990: 616e 6420 2873 656c 662e 736f 7572 6365  and (self.source
-000019a0: 5f73 6870 2021 3d20 2727 293a 0a20 2020  _shp != ''):.   
-000019b0: 2020 2020 2020 2020 2020 2020 2073 656c               sel
-000019c0: 662e 6368 6563 6b5f 736f 7572 6365 5f6e  f.check_source_n
-000019d0: 635f 7368 7028 2920 2320 6368 6563 6b20  c_shp() # check 
-000019e0: 7468 6520 6c61 7420 6c6f 6e20 696e 2073  the lat lon in s
-000019f0: 6f75 7265 2073 6861 7065 6669 6c65 2061  oure shapefile a
-00001a00: 6e64 206e 6320 6669 6c65 0a20 2020 2020  nd nc file.     
-00001a10: 2020 2020 2020 2020 2020 2073 6f75 7263             sourc
-00001a20: 655f 7368 705f 6770 6420 3d20 6770 642e  e_shp_gpd = gpd.
-00001a30: 7265 6164 5f66 696c 6528 7365 6c66 2e73  read_file(self.s
-00001a40: 6f75 7263 655f 7368 7029 0a20 2020 2020  ource_shp).     
-00001a50: 2020 2020 2020 2020 2020 2073 6f75 7263             sourc
-00001a60: 655f 7368 705f 6770 6420 3d20 7365 6c66  e_shp_gpd = self
-00001a70: 2e61 6464 5f6c 6174 5f6c 6f6e 5f73 6f75  .add_lat_lon_sou
-00001a80: 7263 655f 5348 5028 736f 7572 6365 5f73  rce_SHP(source_s
-00001a90: 6870 5f67 7064 2c20 7365 6c66 2e73 6f75  hp_gpd, self.sou
-00001aa0: 7263 655f 7368 705f 6c61 742c 5c0a 2020  rce_shp_lat,\.  
-00001ab0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00001ac0: 2020 7365 6c66 2e73 6f75 7263 655f 7368    self.source_sh
-00001ad0: 705f 6c6f 6e2c 2073 656c 662e 736f 7572  p_lon, self.sour
-00001ae0: 6365 5f73 6870 5f49 4429 0a20 2020 2020  ce_shp_ID).     
-00001af0: 2020 2020 2020 2020 2020 2073 6f75 7263             sourc
-00001b00: 655f 7368 705f 6770 642e 746f 5f66 696c  e_shp_gpd.to_fil
-00001b10: 6528 7365 6c66 2e74 656d 705f 6469 722b  e(self.temp_dir+
-00001b20: 7365 6c66 2e63 6173 655f 6e61 6d65 2b27  self.case_name+'
-00001b30: 5f73 6f75 7263 655f 7368 6170 6566 696c  _source_shapefil
-00001b40: 652e 7368 7027 290a 2020 2020 2020 2020  e.shp').        
-00001b50: 2020 2020 2020 2020 7072 696e 7428 2745          print('E
-00001b60: 4153 594d 4f52 4520 6973 2063 7265 6174  ASYMORE is creat
-00001b70: 696e 6720 7468 6520 7368 6170 6566 696c  ing the shapefil
-00001b80: 6520 6672 6f6d 2074 6865 206e 6574 4344  e from the netCD
-00001b90: 4620 6669 6c65 2061 6e64 2073 6176 696e  F file and savin
-00001ba0: 6720 6974 2068 6572 653a 2729 0a20 2020  g it here:').   
-00001bb0: 2020 2020 2020 2020 2020 2020 2070 7269               pri
-00001bc0: 6e74 2873 656c 662e 7465 6d70 5f64 6972  nt(self.temp_dir
-00001bd0: 2b73 656c 662e 6361 7365 5f6e 616d 652b  +self.case_name+
-00001be0: 275f 736f 7572 6365 5f73 6861 7065 6669  '_source_shapefi
-00001bf0: 6c65 2e73 6870 2729 0a20 2020 2020 2020  le.shp').       
-00001c00: 2020 2020 2023 2069 6e74 6572 7365 6374       # intersect
-00001c10: 696f 6e20 6f66 2074 6865 2073 6f75 7263  ion of the sourc
-00001c20: 6520 616e 6420 7369 6e6b 2f74 6172 6765  e and sink/targe
-00001c30: 7420 7368 6170 6566 696c 650a 2020 2020  t shapefile.    
-00001c40: 2020 2020 2020 2020 7368 705f 3120 3d20          shp_1 = 
-00001c50: 6770 642e 7265 6164 5f66 696c 6528 7365  gpd.read_file(se
-00001c60: 6c66 2e74 656d 705f 6469 722b 7365 6c66  lf.temp_dir+self
-00001c70: 2e63 6173 655f 6e61 6d65 2b27 5f74 6172  .case_name+'_tar
-00001c80: 6765 745f 7368 6170 6566 696c 652e 7368  get_shapefile.sh
-00001c90: 7027 290a 2020 2020 2020 2020 2020 2020  p').            
-00001ca0: 7368 705f 3220 3d20 6770 642e 7265 6164  shp_2 = gpd.read
-00001cb0: 5f66 696c 6528 7365 6c66 2e74 656d 705f  _file(self.temp_
-00001cc0: 6469 722b 7365 6c66 2e63 6173 655f 6e61  dir+self.case_na
-00001cd0: 6d65 2b27 5f73 6f75 7263 655f 7368 6170  me+'_source_shap
-00001ce0: 6566 696c 652e 7368 7027 290a 2020 2020  efile.shp').    
-00001cf0: 2020 2020 2020 2020 2320 636f 7272 6563          # correc
-00001d00: 7469 6f6e 206f 6620 7468 6520 736f 7572  tion of the sour
-00001d10: 6365 2061 6e64 2074 6172 6765 7420 7368  ce and target sh
-00001d20: 6170 6566 696c 6520 746f 2066 7261 6d65  apefile to frame
-00001d30: 206f 6620 2d31 3830 2074 6f20 3138 300a   of -180 to 180.
-00001d40: 2020 2020 2020 2020 2020 2020 7368 705f              shp_
-00001d50: 3120 3d20 7365 6c66 2e73 6870 5f6c 6f6e  1 = self.shp_lon
-00001d60: 5f63 6f72 7265 6374 696f 6e28 7368 705f  _correction(shp_
-00001d70: 3129 0a20 2020 2020 2020 2020 2020 2073  1).            s
-00001d80: 6870 5f32 203d 2073 656c 662e 7368 705f  hp_2 = self.shp_
-00001d90: 6c6f 6e5f 636f 7272 6563 7469 6f6e 2873  lon_correction(s
-00001da0: 6870 5f32 290a 2020 2020 2020 2020 2020  hp_2).          
-00001db0: 2020 7368 705f 312e 746f 5f66 696c 6528    shp_1.to_file(
-00001dc0: 7365 6c66 2e74 656d 705f 6469 722b 7365  self.temp_dir+se
-00001dd0: 6c66 2e63 6173 655f 6e61 6d65 2b27 5f74  lf.case_name+'_t
-00001de0: 6172 6765 745f 7368 6170 6566 696c 655f  arget_shapefile_
-00001df0: 636f 7272 6563 7465 645f 6672 616d 652e  corrected_frame.
-00001e00: 7368 7027 290a 2020 2020 2020 2020 2020  shp').          
-00001e10: 2020 7368 705f 322e 746f 5f66 696c 6528    shp_2.to_file(
-00001e20: 7365 6c66 2e74 656d 705f 6469 722b 7365  self.temp_dir+se
-00001e30: 6c66 2e63 6173 655f 6e61 6d65 2b27 5f73  lf.case_name+'_s
-00001e40: 6f75 7263 655f 7368 6170 6566 696c 655f  ource_shapefile_
-00001e50: 636f 7272 6563 7465 645f 6672 616d 652e  corrected_frame.
-00001e60: 7368 7027 290a 2020 2020 2020 2020 2020  shp').          
-00001e70: 2020 2320 7265 7072 6f6a 6563 7469 6f6e    # reprojection
-00001e80: 7320 746f 2065 7175 616c 2061 7265 610a  s to equal area.
-00001e90: 2020 2020 2020 2020 2020 2020 6966 2028              if (
-00001ea0: 7374 7228 7368 705f 312e 6372 7329 2e6c  str(shp_1.crs).l
-00001eb0: 6f77 6572 2829 203d 3d20 7374 7228 7368  ower() == str(sh
-00001ec0: 705f 322e 6372 7329 2e6c 6f77 6572 2829  p_2.crs).lower()
-00001ed0: 2920 616e 6420 2827 6570 7367 3a34 3332  ) and ('epsg:432
-00001ee0: 3627 2069 6e20 7374 7228 7368 705f 312e  6' in str(shp_1.
-00001ef0: 6372 7329 2e6c 6f77 6572 2829 293a 0a20  crs).lower()):. 
-00001f00: 2020 2020 2020 2020 2020 2020 2020 2073                 s
-00001f10: 6870 5f31 203d 2073 6870 5f31 2e74 6f5f  hp_1 = shp_1.to_
-00001f20: 6372 7320 2822 4550 5347 3a36 3933 3322  crs ("EPSG:6933"
-00001f30: 2920 2320 7072 6f6a 6563 7420 746f 2065  ) # project to e
-00001f40: 7175 616c 2061 7265 610a 2020 2020 2020  qual area.      
-00001f50: 2020 2020 2020 2020 2020 7368 705f 312e            shp_1.
-00001f60: 746f 5f66 696c 6528 7365 6c66 2e74 656d  to_file(self.tem
-00001f70: 705f 6469 722b 7365 6c66 2e63 6173 655f  p_dir+self.case_
-00001f80: 6e61 6d65 2b27 7465 7374 2e73 6870 2729  name+'test.shp')
-00001f90: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00001fa0: 2073 6870 5f31 203d 2067 7064 2e72 6561   shp_1 = gpd.rea
-00001fb0: 645f 6669 6c65 2873 656c 662e 7465 6d70  d_file(self.temp
-00001fc0: 5f64 6972 2b73 656c 662e 6361 7365 5f6e  _dir+self.case_n
-00001fd0: 616d 652b 2774 6573 742e 7368 7027 290a  ame+'test.shp').
-00001fe0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00001ff0: 7368 705f 3220 3d20 7368 705f 322e 746f  shp_2 = shp_2.to
-00002000: 5f63 7273 2028 2245 5053 473a 3639 3333  _crs ("EPSG:6933
-00002010: 2229 2023 2070 726f 6a65 6374 2074 6f20  ") # project to 
-00002020: 6571 7561 6c20 6172 6561 0a20 2020 2020  equal area.     
-00002030: 2020 2020 2020 2020 2020 2073 6870 5f32             shp_2
-00002040: 2e74 6f5f 6669 6c65 2873 656c 662e 7465  .to_file(self.te
-00002050: 6d70 5f64 6972 2b73 656c 662e 6361 7365  mp_dir+self.case
-00002060: 5f6e 616d 652b 2774 6573 742e 7368 7027  _name+'test.shp'
-00002070: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
-00002080: 2020 7368 705f 3220 3d20 6770 642e 7265    shp_2 = gpd.re
-00002090: 6164 5f66 696c 6528 7365 6c66 2e74 656d  ad_file(self.tem
-000020a0: 705f 6469 722b 7365 6c66 2e63 6173 655f  p_dir+self.case_
-000020b0: 6e61 6d65 2b27 7465 7374 2e73 6870 2729  name+'test.shp')
-000020c0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-000020d0: 2023 2072 656d 6f76 6520 7465 7374 2066   # remove test f
-000020e0: 696c 6573 0a20 2020 2020 2020 2020 2020  iles.           
-000020f0: 2020 2020 2072 656d 6f76 6554 6865 7365       removeThese
-00002100: 203d 2067 6c6f 622e 676c 6f62 2873 656c   = glob.glob(sel
-00002110: 662e 7465 6d70 5f64 6972 2b73 656c 662e  f.temp_dir+self.
-00002120: 6361 7365 5f6e 616d 652b 2774 6573 742e  case_name+'test.
-00002130: 2a27 290a 2020 2020 2020 2020 2020 2020  *').            
-00002140: 2020 2020 666f 7220 6669 6c65 2069 6e20      for file in 
-00002150: 7265 6d6f 7665 5468 6573 653a 0a20 2020  removeThese:.   
-00002160: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00002170: 206f 732e 7265 6d6f 7665 2866 696c 6529   os.remove(file)
-00002180: 0a20 2020 2020 2020 2020 2020 2065 6c73  .            els
-00002190: 653a 0a20 2020 2020 2020 2020 2020 2020  e:.             
-000021a0: 2020 2073 7973 2e65 7869 7428 2754 6865     sys.exit('The
-000021b0: 2070 726f 6a65 6374 696f 6e20 666f 7220   projection for 
-000021c0: 736f 7572 6365 2061 6e64 2074 6172 6765  source and targe
-000021d0: 7420 7368 6170 6566 696c 6520 6172 6520  t shapefile are 
-000021e0: 6e6f 7420 5747 5338 342c 2070 6c65 6173  not WGS84, pleas
-000021f0: 6520 7265 7669 7365 2c20 6173 7369 676e  e revise, assign
-00002200: 2729 0a20 2020 2020 2020 2020 2020 2073  ').            s
-00002210: 6870 5f69 6e74 203d 2073 656c 662e 696e  hp_int = self.in
-00002220: 7465 7273 6563 7469 6f6e 5f73 6870 2873  tersection_shp(s
-00002230: 6870 5f31 2c20 7368 705f 3229 0a20 2020  hp_1, shp_2).   
-00002240: 2020 2020 2020 2020 2073 6870 5f69 6e74           shp_int
-00002250: 203d 2073 6870 5f69 6e74 2e73 6f72 745f   = shp_int.sort_
-00002260: 7661 6c75 6573 2862 793d 5b27 535f 315f  values(by=['S_1_
-00002270: 4944 5f74 275d 2920 2320 736f 7274 2062  ID_t']) # sort b
-00002280: 6173 6564 206f 6e20 4944 5f74 0a20 2020  ased on ID_t.   
-00002290: 2020 2020 2020 2020 2073 6870 5f69 6e74           shp_int
-000022a0: 203d 2073 6870 5f69 6e74 2e74 6f5f 6372   = shp_int.to_cr
-000022b0: 7320 2822 4550 5347 3a34 3332 3622 2920  s ("EPSG:4326") 
-000022c0: 2320 7072 6f6a 6563 7420 6261 636b 2074  # project back t
-000022d0: 6f20 5747 5338 340a 2020 2020 2020 2020  o WGS84.        
-000022e0: 2020 2020 7368 705f 696e 742e 746f 5f66      shp_int.to_f
-000022f0: 696c 6528 7365 6c66 2e74 656d 705f 6469  ile(self.temp_di
-00002300: 722b 7365 6c66 2e63 6173 655f 6e61 6d65  r+self.case_name
-00002310: 2b27 5f69 6e74 6572 7365 6374 6564 5f73  +'_intersected_s
-00002320: 6861 7065 6669 6c65 2e73 6870 2729 2023  hapefile.shp') #
-00002330: 2073 6176 6520 7468 6520 696e 7465 7273   save the inters
-00002340: 6563 7465 6420 6669 6c65 730a 2020 2020  ected files.    
-00002350: 2020 2020 2020 2020 7368 705f 696e 7420          shp_int 
-00002360: 3d20 7368 705f 696e 742e 6472 6f70 2863  = shp_int.drop(c
-00002370: 6f6c 756d 6e73 3d5b 2767 656f 6d65 7472  olumns=['geometr
-00002380: 7927 5d29 2023 2072 656d 6f76 6520 7468  y']) # remove th
-00002390: 6520 6765 6f6d 6574 7279 0a20 2020 2020  e geometry.     
-000023a0: 2020 2020 2020 2023 2072 656e 616d 6520         # rename 
-000023b0: 6469 6374 696f 6e61 7279 0a20 2020 2020  dictionary.     
-000023c0: 2020 2020 2020 2064 6963 745f 7265 6e61         dict_rena
-000023d0: 6d65 203d 207b 2753 5f31 5f49 445f 7427  me = {'S_1_ID_t'
-000023e0: 203a 2027 4944 5f74 272c 0a20 2020 2020   : 'ID_t',.     
-000023f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00002400: 2020 2020 2020 2753 5f31 5f6c 6174 5f74        'S_1_lat_t
-00002410: 273a 2027 6c61 745f 7427 2c0a 2020 2020  ': 'lat_t',.    
-00002420: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00002430: 2020 2020 2020 2027 535f 315f 6c6f 6e5f         'S_1_lon_
-00002440: 7427 3a20 276c 6f6e 5f74 272c 0a20 2020  t': 'lon_t',.   
-00002450: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00002460: 2020 2020 2020 2020 2753 5f31 5f6f 7264          'S_1_ord
-00002470: 6572 273a 2027 6f72 6465 725f 7427 2c0a  er': 'order_t',.
-00002480: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00002490: 2020 2020 2020 2020 2020 2027 535f 325f             'S_2_
-000024a0: 4944 5f73 2720 3a20 2749 445f 7327 2c0a  ID_s' : 'ID_s',.
-000024b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000024c0: 2020 2020 2020 2020 2020 2027 535f 325f             'S_2_
-000024d0: 6c61 745f 7327 3a20 276c 6174 5f73 272c  lat_s': 'lat_s',
-000024e0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-000024f0: 2020 2020 2020 2020 2020 2020 2753 5f32              'S_2
-00002500: 5f6c 6f6e 5f73 273a 2027 6c6f 6e5f 7327  _lon_s': 'lon_s'
-00002510: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
-00002520: 2020 2020 2020 2020 2020 2020 2027 4150               'AP
-00002530: 314e 2720 2020 2020 3a20 2777 6569 6768  1N'     : 'weigh
-00002540: 7427 7d0a 2020 2020 2020 2020 2020 2020  t'}.            
-00002550: 7368 705f 696e 7420 3d20 7368 705f 696e  shp_int = shp_in
-00002560: 742e 7265 6e61 6d65 2863 6f6c 756d 6e73  t.rename(columns
-00002570: 3d64 6963 745f 7265 6e61 6d65 2920 2320  =dict_rename) # 
-00002580: 7265 6e61 6d65 2066 6965 6c64 7320 666f  rename fields fo
-00002590: 7220 7265 6d61 7070 696e 6720 6669 6c65  r remapping file
-000025a0: 0a20 2020 2020 2020 2020 2020 2073 6870  .            shp
-000025b0: 5f69 6e74 203d 2070 642e 4461 7461 4672  _int = pd.DataFr
-000025c0: 616d 6528 7368 705f 696e 7429 2023 206d  ame(shp_int) # m
-000025d0: 6f76 6520 746f 2064 6174 6120 7365 7420  ove to data set 
-000025e0: 616e 6420 7361 7665 2061 7320 6120 6373  and save as a cs
-000025f0: 760a 2020 2020 2020 2020 2020 2020 7368  v.            sh
-00002600: 705f 696e 742e 746f 5f63 7376 2873 656c  p_int.to_csv(sel
-00002610: 662e 7465 6d70 5f64 6972 2b73 656c 662e  f.temp_dir+self.
-00002620: 6361 7365 5f6e 616d 652b 275f 696e 7465  case_name+'_inte
-00002630: 7273 6563 7465 645f 7368 6170 6566 696c  rsected_shapefil
-00002640: 652e 6373 7627 2920 2320 7361 7665 2074  e.csv') # save t
-00002650: 6865 2069 6e74 6572 7365 6374 6564 2066  he intersected f
-00002660: 696c 6573 0a20 2020 2020 2020 2020 2020  iles.           
-00002670: 2023 2063 7265 6174 6520 7468 6520 7265   # create the re
-00002680: 6d61 7020 6669 6c65 2069 6620 7265 6d61  map file if rema
-00002690: 7020 6669 6c65 0a20 2020 2020 2020 2020  p file.         
-000026a0: 2020 2069 6e74 5f64 6620 3d20 7064 2e72     int_df = pd.r
-000026b0: 6561 645f 6373 7620 2873 656c 662e 7465  ead_csv (self.te
-000026c0: 6d70 5f64 6972 2b73 656c 662e 6361 7365  mp_dir+self.case
-000026d0: 5f6e 616d 652b 275f 696e 7465 7273 6563  _name+'_intersec
-000026e0: 7465 645f 7368 6170 6566 696c 652e 6373  ted_shapefile.cs
-000026f0: 7627 290a 2020 2020 2020 2020 2020 2020  v').            
-00002700: 6c61 745f 736f 7572 6365 203d 2073 656c  lat_source = sel
-00002710: 662e 6c61 740a 2020 2020 2020 2020 2020  f.lat.          
-00002720: 2020 6c6f 6e5f 736f 7572 6365 203d 2073    lon_source = s
-00002730: 656c 662e 6c6f 6e0a 2020 2020 2020 2020  elf.lon.        
-00002740: 2020 2020 696e 745f 6466 203d 2073 656c      int_df = sel
-00002750: 662e 6372 6561 7465 5f72 656d 6170 2869  f.create_remap(i
-00002760: 6e74 5f64 662c 206c 6174 5f73 6f75 7263  nt_df, lat_sourc
-00002770: 652c 206c 6f6e 5f73 6f75 7263 6529 0a20  e, lon_source). 
-00002780: 2020 2020 2020 2020 2020 2069 6e74 5f64             int_d
-00002790: 662e 746f 5f63 7376 2873 656c 662e 7465  f.to_csv(self.te
-000027a0: 6d70 5f64 6972 2b73 656c 662e 6361 7365  mp_dir+self.case
-000027b0: 5f6e 616d 652b 275f 7265 6d61 7070 696e  _name+'_remappin
-000027c0: 672e 6373 7627 290a 2020 2020 2020 2020  g.csv').        
-000027d0: 2020 2020 7365 6c66 2e72 656d 6170 5f63      self.remap_c
-000027e0: 7376 203d 2073 656c 662e 7465 6d70 5f64  sv = self.temp_d
-000027f0: 6972 2b73 656c 662e 6361 7365 5f6e 616d  ir+self.case_nam
-00002800: 652b 275f 7265 6d61 7070 696e 672e 6373  e+'_remapping.cs
-00002810: 7627 0a20 2020 2020 2020 2065 6c73 653a  v'.        else:
-00002820: 0a20 2020 2020 2020 2020 2020 2023 2063  .            # c
-00002830: 6865 636b 2074 6865 2072 656d 6170 2066  heck the remap f
-00002840: 696c 6520 6966 2070 726f 7669 6465 640a  ile if provided.
-00002850: 2020 2020 2020 2020 2020 2020 696e 745f              int_
-00002860: 6466 2020 3d20 7064 2e72 6561 645f 6373  df  = pd.read_cs
-00002870: 7628 7365 6c66 2e72 656d 6170 5f63 7376  v(self.remap_csv
-00002880: 290a 2020 2020 2020 2020 2020 2020 7365  ).            se
-00002890: 6c66 2e63 6865 636b 5f65 6173 796d 6f72  lf.check_easymor
-000028a0: 655f 7265 6d61 7028 696e 745f 6466 290a  e_remap(int_df).
-000028b0: 2020 2020 2020 2020 2020 2020 2320 6368              # ch
-000028c0: 6563 6b20 7468 6520 736f 7572 6365 206e  eck the source n
-000028d0: 6320 6669 6c65 0a20 2020 2020 2020 2020  c file.         
-000028e0: 2020 2073 656c 662e 6368 6563 6b5f 736f     self.check_so
-000028f0: 7572 6365 5f6e 6328 290a 2020 2020 2020  urce_nc().      
-00002900: 2020 7365 6c66 2e5f 5f74 6172 6765 745f    self.__target_
-00002910: 6e63 5f63 7265 6174 696f 6e28 290a 0a20  nc_creation().. 
-00002920: 2020 2064 6566 2067 6574 5f63 6f6c 5f72     def get_col_r
-00002930: 6f77 2873 656c 6629 3a0a 2020 2020 2020  ow(self):.      
-00002940: 2020 2222 220a 2020 2020 2020 2020 4020    """.        @ 
-00002950: 6175 7468 6f72 3a20 2020 2020 2020 2020  author:         
-00002960: 2020 2020 2020 2020 2053 6865 7276 616e           Shervan
-00002970: 2047 6861 7261 7269 0a20 2020 2020 2020   Gharari.       
-00002980: 2040 2047 6974 6875 623a 2020 2020 2020   @ Github:      
-00002990: 2020 2020 2020 2020 2020 2020 6874 7470              http
-000029a0: 733a 2f2f 6769 7468 7562 2e63 6f6d 2f53  s://github.com/S
-000029b0: 6865 7276 616e 4768 6172 6172 692f 4541  hervanGharari/EA
-000029c0: 5359 4d4f 5245 0a20 2020 2020 2020 2040  SYMORE.        @
-000029d0: 2061 7574 686f 7227 7320 656d 6169 6c20   author's email 
-000029e0: 6964 3a20 2020 2020 2020 7368 2e67 6861  id:       sh.gha
-000029f0: 7261 7269 4067 6d61 696c 2e63 6f6d 0a20  rari@gmail.com. 
-00002a00: 2020 2020 2020 2040 206c 6963 656e 7365         @ license
-00002a10: 3a20 2020 2020 2020 2020 2020 2020 2020  :               
-00002a20: 2020 474e 552d 4750 4c76 330a 2020 2020    GNU-GPLv3.    
-00002a30: 2020 2020 5468 6973 2066 756e 6374 696f      This functio
-00002a40: 6e20 6372 6561 7465 7320 7468 6520 6461  n creates the da
-00002a50: 7461 6672 616d 6520 7769 7468 2061 7373  taframe with ass
-00002a60: 6f73 6961 7465 6420 6c61 7469 7475 6465  osiated latitude
-00002a70: 2061 6e64 206c 6f6e 6769 7475 6465 206f   and longitude o
-00002a80: 7220 736f 7572 6365 2066 696c 6520 616e  r source file an
-00002a90: 640a 2020 2020 2020 2020 6974 7320 6c6f  d.        its lo
-00002aa0: 6361 7469 6f6e 206f 6620 6461 7461 2062  cation of data b
-00002ab0: 7920 636f 6c75 6d6e 2061 6e64 2072 6f77  y column and row
-00002ac0: 2066 6f72 2045 4153 594d 4f52 4520 746f   for EASYMORE to
-00002ad0: 2065 7874 7261 6374 2f72 656d 6170 2064   extract/remap d
-00002ae0: 6174 610a 2020 2020 2020 2020 2222 220a  ata.        """.
-00002af0: 2020 2020 2020 2020 2320 6669 6e64 2074          # find t
-00002b00: 6865 2063 6173 650a 2020 2020 2020 2020  he case.        
-00002b10: 7365 6c66 2e4e 6574 4344 465f 5348 505f  self.NetCDF_SHP_
-00002b20: 6c61 745f 6c6f 6e28 290a 2020 2020 2020  lat_lon().      
-00002b30: 2020 230a 2020 2020 2020 2020 6c61 745f    #.        lat_
-00002b40: 7461 7267 6574 5f69 6e74 203d 206e 702e  target_int = np.
-00002b50: 6172 7261 7928 7365 6c66 2e6c 6174 293b  array(self.lat);
-00002b60: 206c 6174 5f74 6172 6765 745f 696e 7420   lat_target_int 
-00002b70: 3d20 6c61 745f 7461 7267 6574 5f69 6e74  = lat_target_int
-00002b80: 2e66 6c61 7474 656e 2829 0a20 2020 2020  .flatten().     
-00002b90: 2020 206c 6f6e 5f74 6172 6765 745f 696e     lon_target_in
-00002ba0: 7420 3d20 6e70 2e61 7272 6179 2873 656c  t = np.array(sel
-00002bb0: 662e 6c6f 6e29 3b20 6c6f 6e5f 7461 7267  f.lon); lon_targ
-00002bc0: 6574 5f69 6e74 203d 206c 6f6e 5f74 6172  et_int = lon_tar
-00002bd0: 6765 745f 696e 742e 666c 6174 7465 6e28  get_int.flatten(
-00002be0: 290a 2020 2020 2020 2020 726f 7773 2c20  ).        rows, 
-00002bf0: 636f 6c73 203d 2073 656c 662e 6372 6561  cols = self.crea
-00002c00: 7465 5f72 6f77 5f63 6f6c 5f64 6620 2873  te_row_col_df (s
-00002c10: 656c 662e 6c61 742c 2073 656c 662e 6c6f  elf.lat, self.lo
-00002c20: 6e2c 206c 6174 5f74 6172 6765 745f 696e  n, lat_target_in
-00002c30: 742c 206c 6f6e 5f74 6172 6765 745f 696e  t, lon_target_in
-00002c40: 7429 0a20 2020 2020 2020 2023 2063 7265  t).        # cre
-00002c50: 6174 6520 7468 6520 6461 7461 2066 7261  ate the data fra
-00002c60: 6d65 0a20 2020 2020 2020 206c 6174 5f6c  me.        lat_l
-00002c70: 6f6e 5f72 6f77 5f63 6f6c 203d 2070 642e  on_row_col = pd.
-00002c80: 4461 7461 4672 616d 6528 290a 2020 2020  DataFrame().    
-00002c90: 2020 2020 6c61 745f 6c6f 6e5f 726f 775f      lat_lon_row_
-00002ca0: 636f 6c20 5b27 6c61 745f 7327 5d20 3d20  col ['lat_s'] = 
-00002cb0: 6c61 745f 7461 7267 6574 5f69 6e74 0a20  lat_target_int. 
-00002cc0: 2020 2020 2020 206c 6174 5f6c 6f6e 5f72         lat_lon_r
-00002cd0: 6f77 5f63 6f6c 205b 276c 6f6e 5f73 275d  ow_col ['lon_s']
-00002ce0: 203d 206c 6f6e 5f74 6172 6765 745f 696e   = lon_target_in
-00002cf0: 740a 2020 2020 2020 2020 6c61 745f 6c6f  t.        lat_lo
-00002d00: 6e5f 726f 775f 636f 6c20 5b27 726f 7773  n_row_col ['rows
-00002d10: 275d 2020 3d20 726f 7773 0a20 2020 2020  ']  = rows.     
-00002d20: 2020 206c 6174 5f6c 6f6e 5f72 6f77 5f63     lat_lon_row_c
-00002d30: 6f6c 205b 2763 6f6c 7327 5d20 203d 2063  ol ['cols']  = c
-00002d40: 6f6c 730a 2020 2020 2020 2020 2320 7361  ols.        # sa
-00002d50: 7669 6e67 0a20 2020 2020 2020 206c 6174  ving.        lat
-00002d60: 5f6c 6f6e 5f72 6f77 5f63 6f6c 2e74 6f5f  _lon_row_col.to_
-00002d70: 6373 7628 7365 6c66 2e74 656d 705f 6469  csv(self.temp_di
-00002d80: 722b 7365 6c66 2e63 6173 655f 6e61 6d65  r+self.case_name
-00002d90: 2b27 5f72 6f77 5f63 6f6c 5f6c 6174 5f6c  +'_row_col_lat_l
-00002da0: 6f6e 2e63 7376 2729 0a20 2020 2020 2020  on.csv').       
-00002db0: 2073 656c 662e 636f 6c5f 726f 775f 6e61   self.col_row_na
-00002dc0: 6d65 203d 2073 656c 662e 7465 6d70 5f64  me = self.temp_d
-00002dd0: 6972 2b73 656c 662e 6361 7365 5f6e 616d  ir+self.case_nam
-00002de0: 652b 275f 726f 775f 636f 6c5f 6c61 745f  e+'_row_col_lat_
-00002df0: 6c6f 6e2e 6373 7627 0a0a 2020 2020 6465  lon.csv'..    de
-00002e00: 6620 6368 6563 6b5f 6561 7379 6d6f 7265  f check_easymore
-00002e10: 5f69 6e70 7574 2873 656c 6629 3a0a 2020  _input(self):.  
-00002e20: 2020 2020 2020 2222 220a 2020 2020 2020        """.      
-00002e30: 2020 4020 6175 7468 6f72 3a20 2020 2020    @ author:     
-00002e40: 2020 2020 2020 2020 2020 2020 2053 6865               She
-00002e50: 7276 616e 2047 6861 7261 7269 0a20 2020  rvan Gharari.   
-00002e60: 2020 2020 2040 2047 6974 6875 623a 2020       @ Github:  
-00002e70: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00002e80: 6874 7470 733a 2f2f 6769 7468 7562 2e63  https://github.c
-00002e90: 6f6d 2f53 6865 7276 616e 4768 6172 6172  om/ShervanGharar
-00002ea0: 692f 4541 5359 4d4f 5245 0a20 2020 2020  i/EASYMORE.     
-00002eb0: 2020 2040 2061 7574 686f 7227 7320 656d     @ author's em
-00002ec0: 6169 6c20 6964 3a20 2020 2020 2020 7368  ail id:       sh
-00002ed0: 2e67 6861 7261 7269 4067 6d61 696c 2e63  .gharari@gmail.c
-00002ee0: 6f6d 0a20 2020 2020 2020 2040 206c 6963  om.        @ lic
-00002ef0: 656e 7365 3a20 2020 2020 2020 2020 2020  ense:           
-00002f00: 2020 2020 2020 474e 552d 4750 4c76 330a        GNU-GPLv3.
-00002f10: 2020 2020 2020 2020 7468 6520 6675 6e63          the func
-00002f20: 7469 6f6e 7320 6368 6563 6b65 7320 6966  tions checkes if
-00002f30: 2074 6865 206e 6563 6573 7361 7279 2045   the necessary E
-00002f40: 4153 594d 4f52 4520 6f62 6a65 6374 2061  ASYMORE object a
-00002f50: 7265 2070 726f 7669 6465 6420 6672 6f6d  re provided from
-00002f60: 2074 6865 2075 7365 720a 2020 2020 2020   the user.      
-00002f70: 2020 2222 220a 2020 2020 2020 2020 6966    """.        if
-00002f80: 2073 656c 662e 7465 6d70 5f64 6972 2021   self.temp_dir !
-00002f90: 3d20 2727 3a0a 2020 2020 2020 2020 2020  = '':.          
-00002fa0: 2020 6966 2073 656c 662e 7465 6d70 5f64    if self.temp_d
-00002fb0: 6972 5b2d 315d 2021 3d20 272f 273a 0a20  ir[-1] != '/':. 
-00002fc0: 2020 2020 2020 2020 2020 2020 2020 2073                 s
-00002fd0: 7973 2e65 7869 7428 2774 6865 2070 726f  ys.exit('the pro
-00002fe0: 7669 6465 6420 7465 6d70 6f72 6172 7920  vided temporary 
-00002ff0: 666f 6c64 6572 2066 6f72 2045 4153 594d  folder for EASYM
-00003000: 4f52 4520 7368 6f75 6c64 2065 6e64 2077  ORE should end w
-00003010: 6974 6820 282f 2927 290a 2020 2020 2020  ith (/)').      
-00003020: 2020 2020 2020 6966 206e 6f74 206f 732e        if not os.
-00003030: 7061 7468 2e69 7364 6972 2873 656c 662e  path.isdir(self.
-00003040: 7465 6d70 5f64 6972 293a 0a20 2020 2020  temp_dir):.     
-00003050: 2020 2020 2020 2020 2020 206f 732e 6d6b             os.mk
-00003060: 6469 7228 7365 6c66 2e74 656d 705f 6469  dir(self.temp_di
-00003070: 7229 0a20 2020 2020 2020 2069 6620 7365  r).        if se
-00003080: 6c66 2e6f 7574 7075 745f 6469 7220 3d3d  lf.output_dir ==
-00003090: 2027 273a 0a20 2020 2020 2020 2020 2020   '':.           
-000030a0: 2073 7973 2e65 7869 7428 2774 6865 2070   sys.exit('the p
-000030b0: 726f 7669 6465 6420 666f 6c64 6572 2066  rovided folder f
-000030c0: 6f72 2045 4153 594d 4f52 4520 7265 6d61  or EASYMORE rema
-000030d0: 7070 6564 206e 6574 4344 4620 6f75 7470  pped netCDF outp
-000030e0: 7574 2069 7320 6d69 7373 696e 673b 2070  ut is missing; p
-000030f0: 6c65 6173 6520 7072 6f76 6964 6520 7468  lease provide th
-00003100: 6174 2729 0a20 2020 2020 2020 2069 6620  at').        if 
-00003110: 7365 6c66 2e6f 7574 7075 745f 6469 7220  self.output_dir 
-00003120: 213d 2027 273a 0a20 2020 2020 2020 2020  != '':.         
-00003130: 2020 2069 6620 7365 6c66 2e6f 7574 7075     if self.outpu
-00003140: 745f 6469 725b 2d31 5d20 213d 2027 2f27  t_dir[-1] != '/'
-00003150: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-00003160: 2020 7379 732e 6578 6974 2827 7468 6520    sys.exit('the 
-00003170: 7072 6f76 6964 6564 206f 7574 7075 7420  provided output 
-00003180: 666f 6c64 6572 2066 6f72 2045 4153 594d  folder for EASYM
-00003190: 4f52 4520 7368 6f75 6c64 2065 6e64 2077  ORE should end w
-000031a0: 6974 6820 282f 2927 290a 2020 2020 2020  ith (/)').      
-000031b0: 2020 2020 2020 6966 206e 6f74 206f 732e        if not os.
-000031c0: 7061 7468 2e69 7364 6972 2873 656c 662e  path.isdir(self.
-000031d0: 6f75 7470 7574 5f64 6972 293a 0a20 2020  output_dir):.   
-000031e0: 2020 2020 2020 2020 2020 2020 206f 732e               os.
-000031f0: 6d6b 6469 7228 7365 6c66 2e6f 7574 7075  mkdir(self.outpu
-00003200: 745f 6469 7229 0a20 2020 2020 2020 2069  t_dir).        i
-00003210: 6620 7365 6c66 2e74 656d 705f 6469 7220  f self.temp_dir 
-00003220: 3d3d 2027 273a 0a20 2020 2020 2020 2020  == '':.         
-00003230: 2020 2070 7269 6e74 2822 4e6f 2074 656d     print("No tem
-00003240: 706f 7261 7279 2066 6f6c 6465 7220 6973  porary folder is
-00003250: 2070 726f 7669 6465 6420 666f 7220 4541   provided for EA
-00003260: 5359 4d4f 5245 3b20 7468 6973 2077 696c  SYMORE; this wil
-00003270: 6c20 7265 7375 6c74 2069 6e20 4541 5359  l result in EASY
-00003280: 4d4f 5245 2073 6176 696e 6720 7468 6520  MORE saving the 
-00003290: 6669 6c65 7320 696e 2074 6865 2073 616d  files in the sam
-000032a0: 6520 6469 7265 6374 6f72 7920 6173 2070  e directory as p
-000032b0: 7974 686f 6e20 7363 7269 7074 2229 0a20  ython script"). 
-000032c0: 2020 2020 2020 2069 6620 7365 6c66 2e61         if self.a
-000032d0: 7574 686f 725f 6e61 6d65 203d 3d20 2727  uthor_name == ''
-000032e0: 3a0a 2020 2020 2020 2020 2020 2020 7072  :.            pr
-000032f0: 696e 7428 226e 6f20 6175 7468 6f72 206e  int("no author n
-00003300: 616d 6520 6973 2070 726f 7669 6465 2061  ame is provide a
-00003310: 6e64 2074 6865 2061 7574 686f 7220 6e61  nd the author na
-00003320: 6d65 2069 7320 6368 616e 6765 6420 746f  me is changed to
-00003330: 2028 6175 7468 6f72 206e 616d 6529 2122   (author name)!"
-00003340: 290a 2020 2020 2020 2020 2020 2020 7365  ).            se
-00003350: 6c66 2e61 7574 686f 725f 6e61 6d65 203d  lf.author_name =
-00003360: 2022 6175 7468 6f72 206e 616d 6522 0a20   "author name". 
-00003370: 2020 2020 2020 2069 6620 286c 656e 2873         if (len(s
-00003380: 656c 662e 7661 725f 6e61 6d65 7329 2021  elf.var_names) !
-00003390: 3d20 3129 2061 6e64 2028 6c65 6e28 7365  = 1) and (len(se
-000033a0: 6c66 2e66 6f72 6d61 745f 6c69 7374 2920  lf.format_list) 
-000033b0: 3d3d 2031 2920 616e 6420 286c 656e 2873  == 1) and (len(s
-000033c0: 656c 662e 6669 6c6c 5f76 616c 7565 5f6c  elf.fill_value_l
-000033d0: 6973 7429 203d 3d31 293a 0a20 2020 2020  ist) ==1):.     
-000033e0: 2020 2020 2020 2069 6620 286c 656e 2873         if (len(s
-000033f0: 656c 662e 7661 725f 6e61 6d65 7329 2021  elf.var_names) !
-00003400: 3d20 6c65 6e28 7365 6c66 2e66 696c 6c5f  = len(self.fill_
-00003410: 7661 6c75 655f 6c69 7374 2929 2061 6e64  value_list)) and
-00003420: 205c 0a20 2020 2020 2020 2020 2020 2028   \.            (
-00003430: 6c65 6e28 7365 6c66 2e76 6172 5f6e 616d  len(self.var_nam
-00003440: 6573 2920 213d 206c 656e 2873 656c 662e  es) != len(self.
-00003450: 666f 726d 6174 5f6c 6973 7429 2920 616e  format_list)) an
-00003460: 6420 5c0a 2020 2020 2020 2020 2020 2020  d \.            
-00003470: 286c 656e 2873 656c 662e 666f 726d 6174  (len(self.format
-00003480: 5f6c 6973 7429 203d 3d20 3129 2061 6e64  _list) == 1) and
-00003490: 2028 6c65 6e28 7365 6c66 2e66 696c 6c5f   (len(self.fill_
-000034a0: 7661 6c75 655f 6c69 7374 2920 3d3d 3129  value_list) ==1)
-000034b0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-000034c0: 2020 7072 696e 7428 2745 4153 594d 4f52    print('EASYMOR
-000034d0: 4520 6973 2067 6976 656e 206d 756c 7469  E is given multi
-000034e0: 706c 6520 7661 7269 6261 6c65 7320 746f  ple varibales to
-000034f0: 2062 6520 7265 6d61 7070 6564 2062 7574   be remapped but
-00003500: 206f 6e6c 7920 6f6e 2066 6f72 6d61 7420   only on format 
-00003510: 616e 6420 6669 6c6c 2076 616c 7565 272b  and fill value'+
-00003520: 5c0a 2020 2020 2020 2020 2020 2020 2020  \.              
-00003530: 2020 2020 2020 2745 4153 594d 4f52 4520        'EASYMORE 
-00003540: 7265 7065 6174 2074 6865 2066 6f72 6d61  repeat the forma
-00003550: 7420 616e 6420 6669 6c6c 2076 616c 7565  t and fill value
-00003560: 2066 6f72 2061 6c6c 2074 6865 2076 6172   for all the var
-00003570: 6961 626c 6573 2069 6e20 6f75 7470 7574  iables in output
-00003580: 2066 696c 6573 2729 0a20 2020 2020 2020   files').       
-00003590: 2020 2020 2020 2020 2073 656c 662e 666f           self.fo
-000035a0: 726d 6174 5f6c 6973 7420 2020 2020 3d20  rmat_list     = 
-000035b0: 7365 6c66 2e66 6f72 6d61 745f 6c69 7374  self.format_list
-000035c0: 2020 2020 202a 206c 656e 2873 656c 662e       * len(self.
-000035d0: 7661 725f 6e61 6d65 7329 0a20 2020 2020  var_names).     
-000035e0: 2020 2020 2020 2020 2020 2073 656c 662e             self.
-000035f0: 6669 6c6c 5f76 616c 7565 5f6c 6973 7420  fill_value_list 
-00003600: 3d20 7365 6c66 2e66 696c 6c5f 7661 6c75  = self.fill_valu
-00003610: 655f 6c69 7374 202a 206c 656e 2873 656c  e_list * len(sel
-00003620: 662e 7661 725f 6e61 6d65 7329 0a20 2020  f.var_names).   
-00003630: 2020 2020 2020 2020 2065 6c73 653a 0a20           else:. 
-00003640: 2020 2020 2020 2020 2020 2020 2020 2073                 s
-00003650: 7973 2e65 7869 7428 276e 756d 6265 7220  ys.exit('number 
-00003660: 6f66 2076 6172 6962 616c 6573 2061 6e64  of varibales and
-00003670: 2066 696c 6c20 7661 6c75 6573 2061 6e64   fill values and
-00003680: 2066 6f72 6d61 7473 2064 6f20 6e6f 7420   formats do not 
-00003690: 6d61 7463 6827 290a 2020 2020 2020 2020  match').        
-000036a0: 6966 2073 656c 662e 7265 6d61 705f 6373  if self.remap_cs
-000036b0: 7620 213d 2027 273a 0a20 2020 2020 2020  v != '':.       
-000036c0: 2020 2020 2070 7269 6e74 2827 7265 6d61       print('rema
-000036d0: 7020 6669 6c65 2069 7320 7072 6f76 6964  p file is provid
-000036e0: 6564 3b20 4541 5359 4d4f 5245 2077 696c  ed; EASYMORE wil
-000036f0: 6c20 7573 6520 7468 6973 2066 696c 6520  l use this file 
-00003700: 616e 6420 736b 6970 2063 616c 6375 6c61  and skip calcula
-00003710: 7469 6f6e 206f 6620 7265 6d61 7070 696e  tion of remappin
-00003720: 6727 290a 2020 2020 2020 2020 6966 206c  g').        if l
-00003730: 656e 2873 656c 662e 7661 725f 6e61 6d65  en(self.var_name
-00003740: 7329 2021 3d20 6c65 6e28 7365 7428 7365  s) != len(set(se
-00003750: 6c66 2e76 6172 5f6e 616d 6573 2929 3a0a  lf.var_names)):.
-00003760: 2020 2020 2020 2020 2020 2020 7379 732e              sys.
-00003770: 6578 6974 2827 7468 6520 6e61 6d65 206f  exit('the name o
-00003780: 6620 7468 6520 7661 7269 6162 6c65 7320  f the variables 
-00003790: 796f 7520 6861 7665 2070 726f 7669 6465  you have provide
-000037a0: 6420 6672 6f6d 2074 6865 2073 6f75 7263  d from the sourc
-000037b0: 6520 4e65 7443 4446 2066 696c 6520 746f  e NetCDF file to
-000037c0: 2062 6520 7265 6d61 7070 6564 2061 7265   be remapped are
-000037d0: 206e 6f74 2075 6e69 7175 6527 290a 2020   not unique').  
-000037e0: 2020 2020 2020 6966 2073 656c 662e 7661        if self.va
-000037f0: 725f 6e61 6d65 735f 7265 6d61 7070 6564  r_names_remapped
-00003800: 3a0a 2020 2020 2020 2020 2020 2020 6966  :.            if
-00003810: 206c 656e 2873 656c 662e 7661 725f 6e61   len(self.var_na
-00003820: 6d65 735f 7265 6d61 7070 6564 2920 213d  mes_remapped) !=
-00003830: 206c 656e 2873 6574 2873 656c 662e 7661   len(set(self.va
-00003840: 725f 6e61 6d65 735f 7265 6d61 7070 6564  r_names_remapped
-00003850: 2929 3a0a 2020 2020 2020 2020 2020 2020  )):.            
-00003860: 2020 2020 7379 732e 6578 6974 2827 7468      sys.exit('th
-00003870: 6520 6e61 6d65 206f 6620 7468 6520 7661  e name of the va
-00003880: 7269 6162 6c65 7320 796f 7520 6861 7665  riables you have
-00003890: 2070 726f 7669 6465 6420 6173 2074 6865   provided as the
-000038a0: 2072 656e 616d 6520 696e 2074 6865 2072   rename in the r
-000038b0: 656d 6170 7065 6420 6669 6c65 2061 7265  emapped file are
-000038c0: 206e 6f74 2075 6e69 7175 6527 290a 2020   not unique').  
-000038d0: 2020 2020 2020 2020 2020 6966 206c 656e            if len
-000038e0: 2873 656c 662e 7661 725f 6e61 6d65 735f  (self.var_names_
-000038f0: 7265 6d61 7070 6564 2920 213d 206c 656e  remapped) != len
-00003900: 2873 656c 662e 7661 725f 6e61 6d65 7329  (self.var_names)
-00003910: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-00003920: 2020 7379 732e 6578 6974 2827 7468 6520    sys.exit('the 
-00003930: 6e75 6d62 6572 206f 6620 7072 6f76 6964  number of provid
-00003940: 6564 2076 6172 6961 626c 6573 2066 726f  ed variables fro
-00003950: 6d20 7468 6520 736f 7572 6365 2066 696c  m the source fil
-00003960: 6520 616e 6420 6e61 6d65 7320 746f 2062  e and names to b
-00003970: 6520 7265 6d61 7070 6564 2061 7265 206e  e remapped are n
-00003980: 6f74 2074 6865 2073 616d 6520 6c65 6e67  ot the same leng
-00003990: 7468 2729 0a20 2020 2020 2020 2069 6620  th').        if 
-000039a0: 6e6f 7420 7365 6c66 2e76 6172 5f6e 616d  not self.var_nam
-000039b0: 6573 5f72 656d 6170 7065 643a 0a20 2020  es_remapped:.   
-000039c0: 2020 2020 2020 2020 2073 656c 662e 7661           self.va
-000039d0: 725f 6e61 6d65 735f 7265 6d61 7070 6564  r_names_remapped
-000039e0: 203d 2073 656c 662e 7661 725f 6e61 6d65   = self.var_name
-000039f0: 730a 2020 2020 2020 2020 666f 7220 6920  s.        for i 
-00003a00: 696e 206e 702e 6172 616e 6765 286c 656e  in np.arange(len
-00003a10: 2873 656c 662e 7661 725f 6e61 6d65 7329  (self.var_names)
-00003a20: 293a 0a20 2020 2020 2020 2020 2020 2070  ):.            p
-00003a30: 7269 6e74 2827 4541 5359 4d4f 5245 2077  rint('EASYMORE w
-00003a40: 696c 6c20 7265 6d61 7020 7661 7269 6162  ill remap variab
-00003a50: 6c65 2027 2c73 656c 662e 7661 725f 6e61  le ',self.var_na
-00003a60: 6d65 735b 695d 2c27 2066 726f 6d20 736f  mes[i],' from so
-00003a70: 7572 6365 2066 696c 6520 746f 2076 6172  urce file to var
-00003a80: 6961 626c 6520 272c 7365 6c66 2e76 6172  iable ',self.var
-00003a90: 5f6e 616d 6573 5f72 656d 6170 7065 645b  _names_remapped[
-00003aa0: 695d 2c27 2069 6e20 7265 6d61 7070 6564  i],' in remapped
-00003ab0: 204e 6543 4446 2066 696c 6527 290a 0a20   NeCDF file').. 
-00003ac0: 2020 2064 6566 2063 6865 636b 5f74 6172     def check_tar
-00003ad0: 6765 745f 7368 7020 2873 656c 662c 7368  get_shp (self,sh
-00003ae0: 7029 3a0a 2020 2020 2020 2020 2222 220a  p):.        """.
-00003af0: 2020 2020 2020 2020 4020 6175 7468 6f72          @ author
-00003b00: 3a20 2020 2020 2020 2020 2020 2020 2020  :               
-00003b10: 2020 2053 6865 7276 616e 2047 6861 7261     Shervan Ghara
-00003b20: 7269 0a20 2020 2020 2020 2040 2047 6974  ri.        @ Git
-00003b30: 6875 623a 2020 2020 2020 2020 2020 2020  hub:            
-00003b40: 2020 2020 2020 6874 7470 733a 2f2f 6769        https://gi
-00003b50: 7468 7562 2e63 6f6d 2f53 6865 7276 616e  thub.com/Shervan
-00003b60: 4768 6172 6172 692f 4541 5359 4d4f 5245  Gharari/EASYMORE
-00003b70: 0a20 2020 2020 2020 2040 2061 7574 686f  .        @ autho
-00003b80: 7227 7320 656d 6169 6c20 6964 3a20 2020  r's email id:   
-00003b90: 2020 2020 7368 2e67 6861 7261 7269 4067      sh.gharari@g
-00003ba0: 6d61 696c 2e63 6f6d 0a20 2020 2020 2020  mail.com.       
-00003bb0: 2040 206c 6963 656e 7365 3a20 2020 2020   @ license:     
-00003bc0: 2020 2020 2020 2020 2020 2020 474e 552d              GNU-
-00003bd0: 4750 4c76 330a 2020 2020 2020 2020 7468  GPLv3.        th
-00003be0: 6973 2066 756e 6374 696f 6e20 6368 6563  is function chec
-00003bf0: 6b20 6966 2074 6172 6765 7420 7368 6170  k if target shap
-00003c00: 6566 696c 6520 616e 6420 6164 6420 4944  efile and add ID
-00003c10: 2061 6e64 2063 656e 7472 6f69 6420 6c61   and centroid la
-00003c20: 7420 616e 6420 6c6f 6e20 6973 206e 6f74  t and lon is not
-00003c30: 2070 726f 7669 6465 640a 2020 2020 2020   provided.      
-00003c40: 2020 4172 6775 6d65 6e74 730a 2020 2020    Arguments.    
-00003c50: 2020 2020 2d2d 2d2d 2d2d 2d2d 2d0a 2020      ---------.  
-00003c60: 2020 2020 2020 7368 703a 2067 656f 7061        shp: geopa
-00003c70: 6e64 6173 2064 6174 6166 7261 6d65 2c20  ndas dataframe, 
-00003c80: 706f 6c79 676f 6e65 2c20 6d75 6c74 6970  polygone, multip
-00003c90: 6f6c 7967 6f6e 2c20 706f 696e 742c 206d  olygon, point, m
-00003ca0: 756c 7469 706f 696e 740a 2020 2020 2020  ultipoint.      
-00003cb0: 2020 2222 220a 2020 2020 2020 2020 2320    """.        # 
-00003cc0: 6c6f 6164 2074 6865 206e 6565 6465 6420  load the needed 
-00003cd0: 7061 636b 6167 6573 0a20 2020 2020 2020  packages.       
-00003ce0: 2069 6d70 6f72 7420 6765 6f70 616e 6461   import geopanda
-00003cf0: 7320 6173 2067 7064 0a20 2020 2020 2020  s as gpd.       
-00003d00: 2066 726f 6d20 2020 7368 6170 656c 792e   from   shapely.
-00003d10: 6765 6f6d 6574 7279 2069 6d70 6f72 7420  geometry import 
-00003d20: 506f 6c79 676f 6e0a 2020 2020 2020 2020  Polygon.        
-00003d30: 696d 706f 7274 2073 6861 7065 6669 6c65  import shapefile
-00003d40: 2023 2070 7973 6865 6420 6c69 6272 6172   # pyshed librar
-00003d50: 790a 2020 2020 2020 2020 696d 706f 7274  y.        import
-00003d60: 2073 6861 7065 6c79 0a20 2020 2020 2020   shapely.       
-00003d70: 2023 2073 696e 6b2f 7461 7267 6574 2073   # sink/target s
-00003d80: 6861 7065 6669 6c65 2063 6865 636b 2074  hapefile check t
-00003d90: 6865 2070 726f 6a65 6374 696f 6e0a 2020  he projection.  
-00003da0: 2020 2020 2020 6966 2027 6570 7367 3a34        if 'epsg:4
-00003db0: 3332 3627 206e 6f74 2069 6e20 7374 7228  326' not in str(
-00003dc0: 7368 702e 6372 7329 2e6c 6f77 6572 2829  shp.crs).lower()
-00003dd0: 3a0a 2020 2020 2020 2020 2020 2020 7379  :.            sy
-00003de0: 732e 6578 6974 2827 706c 6561 7365 2070  s.exit('please p
-00003df0: 726f 6a65 6374 2079 6f75 7220 7368 6170  roject your shap
-00003e00: 6566 696c 6520 746f 2057 4753 3834 2028  efile to WGS84 (
-00003e10: 6570 7367 3a34 3332 3629 2729 0a20 2020  epsg:4326)').   
-00003e20: 2020 2020 2065 6c73 653a 2023 2063 6865       else: # che
-00003e30: 636b 2069 6620 7468 6520 7072 6f6a 6563  ck if the projec
-00003e40: 7469 6f6e 2069 7320 5747 5338 3420 286f  tion is WGS84 (o
-00003e50: 7220 6570 7367 3a34 3332 3629 0a20 2020  r epsg:4326).   
-00003e60: 2020 2020 2020 2020 2070 7269 6e74 2827           print('
-00003e70: 4541 5359 4d4f 5245 2064 6574 6563 7473  EASYMORE detects
-00003e80: 2074 6861 7420 7461 7267 6574 2073 6861   that target sha
-00003e90: 7065 6669 6c65 2069 7320 696e 2057 4753  pefile is in WGS
-00003ea0: 3834 2028 6570 7367 3a34 3332 3629 2729  84 (epsg:4326)')
-00003eb0: 0a20 2020 2020 2020 2023 2063 6865 636b  .        # check
-00003ec0: 2069 6620 7468 6520 4944 2c20 6c61 7469   if the ID, lati
-00003ed0: 7475 6465 2c20 6c6f 6e67 6974 7564 6520  tude, longitude 
-00003ee0: 6172 6520 7072 6f76 6964 6564 0a20 2020  are provided.   
-00003ef0: 2020 2020 2069 6620 7365 6c66 2e74 6172       if self.tar
-00003f00: 6765 745f 7368 705f 4944 203d 3d20 2727  get_shp_ID == ''
-00003f10: 3a0a 2020 2020 2020 2020 2020 2020 7072  :.            pr
-00003f20: 696e 7428 2745 4153 594d 4f52 4520 6465  int('EASYMORE de
-00003f30: 7465 6374 7320 7468 6174 206e 6f20 6669  tects that no fi
-00003f40: 656c 6420 666f 7220 4944 2069 7320 7072  eld for ID is pr
-00003f50: 6f76 6964 6564 2069 6e20 7369 6e6b 2f74  ovided in sink/t
-00003f60: 6172 6765 7420 7368 6170 6566 696c 6527  arget shapefile'
-00003f70: 290a 2020 2020 2020 2020 2020 2020 7072  ).            pr
-00003f80: 696e 7428 2761 7262 6974 6172 6172 7920  int('arbitarary 
-00003f90: 7661 6c75 6573 206f 6620 4944 2061 7265  values of ID are
-00003fa0: 2061 6464 6564 2069 6e20 7468 6520 6669   added in the fi
-00003fb0: 656c 6420 4944 5f74 2729 0a20 2020 2020  eld ID_t').     
-00003fc0: 2020 2020 2020 2073 6870 5b27 4944 5f74         shp['ID_t
-00003fd0: 275d 2020 3d20 6e70 2e61 7261 6e67 6528  ']  = np.arange(
-00003fe0: 6c65 6e28 7368 7029 292b 310a 2020 2020  len(shp))+1.    
-00003ff0: 2020 2020 656c 7365 3a0a 2020 2020 2020      else:.      
-00004000: 2020 2020 2020 7072 696e 7428 2745 4153        print('EAS
-00004010: 594d 4f52 4520 6465 7465 6374 7320 7468  YMORE detects th
-00004020: 6174 2074 6865 2066 6965 6c64 2066 6f72  at the field for
-00004030: 2049 4420 6973 2070 726f 7669 6465 6420   ID is provided 
-00004040: 696e 2073 696e 6b2f 7461 7267 6574 2073  in sink/target s
-00004050: 6861 7065 6669 6c65 2729 0a20 2020 2020  hapefile').     
-00004060: 2020 2020 2020 2023 2063 6865 636b 2069         # check i
-00004070: 6620 7468 6520 7072 6f76 6964 6564 2049  f the provided I
-00004080: 4473 2061 7265 2075 6e69 7175 650a 2020  Ds are unique.  
-00004090: 2020 2020 2020 2020 2020 4944 5f76 616c            ID_val
-000040a0: 7565 7320 3d20 6e70 2e61 7272 6179 2873  ues = np.array(s
-000040b0: 6870 5b73 656c 662e 7461 7267 6574 5f73  hp[self.target_s
-000040c0: 6870 5f49 445d 290a 2020 2020 2020 2020  hp_ID]).        
-000040d0: 2020 2020 6966 206c 656e 2849 445f 7661      if len(ID_va
-000040e0: 6c75 6573 2920 213d 206c 656e 286e 702e  lues) != len(np.
-000040f0: 756e 6971 7565 2849 445f 7661 6c75 6573  unique(ID_values
-00004100: 2929 3a0a 2020 2020 2020 2020 2020 2020  )):.            
-00004110: 2020 2020 7379 732e 6578 6974 2827 5468      sys.exit('Th
-00004120: 6520 7072 6f76 6964 6564 2049 4473 2069  e provided IDs i
-00004130: 6e20 7368 6170 6566 696c 6520 6172 6520  n shapefile are 
-00004140: 6e6f 7420 756e 6971 7565 3b20 7072 6f76  not unique; prov
-00004150: 6964 6520 756e 6971 7565 2049 4473 206f  ide unique IDs o
-00004160: 7220 646f 206e 6f74 2069 6465 6e74 6966  r do not identif
-00004170: 7920 7461 7267 6574 5f73 6870 5f49 4427  y target_shp_ID'
-00004180: 290a 2020 2020 2020 2020 2020 2020 7368  ).            sh
-00004190: 705b 2749 445f 7427 5d20 3d20 7368 705b  p['ID_t'] = shp[
-000041a0: 7365 6c66 2e74 6172 6765 745f 7368 705f  self.target_shp_
-000041b0: 4944 5d0a 2020 2020 2020 2020 6966 2073  ID].        if s
-000041c0: 656c 662e 7461 7267 6574 5f73 6870 5f6c  elf.target_shp_l
-000041d0: 6174 203d 3d20 2727 206f 7220 7365 6c66  at == '' or self
-000041e0: 2e74 6172 6765 745f 7368 705f 6c6f 6e20  .target_shp_lon 
-000041f0: 3d3d 2027 273a 0a20 2020 2020 2020 2020  == '':.         
-00004200: 2020 2070 7269 6e74 2827 4541 5359 4d4f     print('EASYMO
-00004210: 5245 2064 6574 6563 7473 2074 6861 7420  RE detects that 
-00004220: 6569 7468 6572 206f 6620 7468 6520 6669  either of the fi
-00004230: 656c 6473 2066 6f72 206c 6174 6974 7564  elds for latitud
-00004240: 6520 6f72 206c 6f6e 6769 7475 6465 2069  e or longitude i
-00004250: 7320 6e6f 7420 7072 6f76 6964 6564 2069  s not provided i
-00004260: 6e20 7369 6e6b 2f74 6172 6765 7420 7368  n sink/target sh
-00004270: 6170 6566 696c 6527 290a 2020 2020 2020  apefile').      
-00004280: 2020 2020 2020 2320 696e 2057 4753 3834        # in WGS84
-00004290: 0a20 2020 2020 2020 2020 2020 2070 7269  .            pri
-000042a0: 6e74 2827 6361 6c63 756c 6174 696e 6720  nt('calculating 
-000042b0: 6365 6e74 726f 6964 206f 6620 7368 6170  centroid of shap
-000042c0: 6573 2069 6e20 5747 5338 3420 7072 6f6a  es in WGS84 proj
-000042d0: 6563 7469 6f6e 3b27 290a 2020 2020 2020  ection;').      
-000042e0: 2020 2020 2020 7072 696e 7428 2766 6f72        print('for
-000042f0: 2062 6574 7465 7220 6170 7078 696d 6174   better appximat
-00004300: 696f 6e20 7573 6520 7468 6520 6561 7379  ion use the easy
-00004310: 6d6f 7265 2065 7175 616c 2061 7265 6120  more equal area 
-00004320: 6365 6e74 726f 6964 2066 756e 6374 696f  centroid functio
-00004330: 6e20 746f 2070 7265 7072 6f63 6573 7320  n to preprocess 
-00004340: 7461 7267 6574 2073 6861 7065 6669 6c65  target shapefile
-00004350: 2729 0a20 2020 2020 2020 2020 2020 2064  ').            d
-00004360: 665f 706f 696e 7420 3d20 7064 2e44 6174  f_point = pd.Dat
-00004370: 6146 7261 6d65 2829 0a20 2020 2020 2020  aFrame().       
-00004380: 2020 2020 2077 6172 6e69 6e67 732e 7369       warnings.si
-00004390: 6d70 6c65 6669 6c74 6572 2827 6967 6e6f  mplefilter('igno
-000043a0: 7265 2729 2023 2073 696c 656e 7420 7468  re') # silent th
-000043b0: 6520 7761 726e 696e 670a 2020 2020 2020  e warning.      
-000043c0: 2020 2020 2020 6466 5f70 6f69 6e74 205b        df_point [
-000043d0: 276c 6174 275d 203d 2073 6870 2e63 656e  'lat'] = shp.cen
-000043e0: 7472 6f69 642e 790a 2020 2020 2020 2020  troid.y.        
-000043f0: 2020 2020 6466 5f70 6f69 6e74 205b 276c      df_point ['l
-00004400: 6f6e 275d 203d 2073 6870 2e63 656e 7472  on'] = shp.centr
-00004410: 6f69 642e 780a 2020 2020 2020 2020 2020  oid.x.          
-00004420: 2020 7761 726e 696e 6773 2e73 696d 706c    warnings.simpl
-00004430: 6566 696c 7465 7228 2764 6566 6175 6c74  efilter('default
-00004440: 2729 2023 2062 6163 6b20 746f 206e 6f72  ') # back to nor
-00004450: 6d61 6c0a 2020 2020 2020 2020 6966 2073  mal.        if s
-00004460: 656c 662e 7461 7267 6574 5f73 6870 5f6c  elf.target_shp_l
-00004470: 6174 203d 3d20 2727 3a0a 2020 2020 2020  at == '':.      
-00004480: 2020 2020 2020 7072 696e 7428 2745 4153        print('EAS
-00004490: 594d 4f52 4520 6465 7465 6374 7320 7468  YMORE detects th
-000044a0: 6174 206e 6f20 6669 656c 6420 666f 7220  at no field for 
-000044b0: 6c61 7469 7475 6465 2069 7320 7072 6f76  latitude is prov
-000044c0: 6964 6564 2069 6e20 7369 6e6b 2f74 6172  ided in sink/tar
-000044d0: 6765 7420 7368 6170 6566 696c 6527 290a  get shapefile').
-000044e0: 2020 2020 2020 2020 2020 2020 7072 696e              prin
-000044f0: 7428 276c 6174 6974 7564 6520 7661 6c75  t('latitude valu
-00004500: 6573 2061 7265 2061 6464 6564 2069 6e20  es are added in 
-00004510: 7468 6520 6669 656c 6420 6c61 745f 7427  the field lat_t'
-00004520: 290a 2020 2020 2020 2020 2020 2020 7368  ).            sh
-00004530: 705b 276c 6174 5f74 275d 2020 3d20 6466  p['lat_t']  = df
-00004540: 5f70 6f69 6e74 205b 276c 6174 275d 2023  _point ['lat'] #
-00004550: 2063 656e 7472 6f69 6420 6c61 7420 6672   centroid lat fr
-00004560: 6f6d 2074 6172 6765 740a 2020 2020 2020  om target.      
-00004570: 2020 656c 7365 3a0a 2020 2020 2020 2020    else:.        
-00004580: 2020 2020 7072 696e 7428 2745 4153 594d      print('EASYM
-00004590: 4f52 4520 6465 7465 6374 7320 7468 6174  ORE detects that
-000045a0: 2074 6865 2066 6965 6c64 206c 6174 6974   the field latit
-000045b0: 7564 6520 6973 2070 726f 7669 6465 6420  ude is provided 
-000045c0: 696e 2073 696e 6b2f 7461 7267 6574 2073  in sink/target s
-000045d0: 6861 7065 6669 6c65 2729 0a20 2020 2020  hapefile').     
-000045e0: 2020 2020 2020 2073 6870 5b27 6c61 745f         shp['lat_
-000045f0: 7427 5d20 3d20 7368 705b 7365 6c66 2e74  t'] = shp[self.t
-00004600: 6172 6765 745f 7368 705f 6c61 745d 0a20  arget_shp_lat]. 
-00004610: 2020 2020 2020 2069 6620 7365 6c66 2e74         if self.t
-00004620: 6172 6765 745f 7368 705f 6c6f 6e20 3d3d  arget_shp_lon ==
-00004630: 2027 273a 0a20 2020 2020 2020 2020 2020   '':.           
-00004640: 2070 7269 6e74 2827 4541 5359 4d4f 5245   print('EASYMORE
-00004650: 2064 6574 6563 7473 2074 6861 7420 6e6f   detects that no
-00004660: 2066 6965 6c64 2066 6f72 206c 6f6e 6769   field for longi
-00004670: 7475 6465 2069 7320 7072 6f76 6964 6564  tude is provided
-00004680: 2069 6e20 7369 6e6b 2f74 6172 6765 7420   in sink/target 
-00004690: 7368 6170 6566 696c 6527 290a 2020 2020  shapefile').    
-000046a0: 2020 2020 2020 2020 7072 696e 7428 276c          print('l
-000046b0: 6f6e 6769 7475 6465 2076 616c 7565 7320  ongitude values 
-000046c0: 6172 6520 6164 6465 6420 696e 2074 6865  are added in the
-000046d0: 2066 6965 6c64 206c 6f6e 5f74 2729 0a20   field lon_t'). 
-000046e0: 2020 2020 2020 2020 2020 2073 6870 5b27             shp['
-000046f0: 6c6f 6e5f 7427 5d20 203d 2064 665f 706f  lon_t']  = df_po
-00004700: 696e 7420 5b27 6c6f 6e27 5d20 2320 6365  int ['lon'] # ce
-00004710: 6e74 726f 6964 206c 6f6e 2066 726f 6d20  ntroid lon from 
-00004720: 7461 7267 6574 0a20 2020 2020 2020 2065  target.        e
-00004730: 6c73 653a 0a20 2020 2020 2020 2020 2020  lse:.           
-00004740: 2070 7269 6e74 2827 4541 5359 4d4f 5245   print('EASYMORE
-00004750: 2064 6574 6563 7473 2074 6861 7420 7468   detects that th
-00004760: 6520 6669 656c 6420 6c6f 6e67 6974 7564  e field longitud
-00004770: 6520 6973 2070 726f 7669 6465 6420 696e  e is provided in
-00004780: 2073 696e 6b2f 7461 7267 6574 2073 6861   sink/target sha
-00004790: 7065 6669 6c65 2729 0a20 2020 2020 2020  pefile').       
-000047a0: 2020 2020 2073 6870 5b27 6c6f 6e5f 7427       shp['lon_t'
-000047b0: 5d20 3d20 7368 705b 7365 6c66 2e74 6172  ] = shp[self.tar
-000047c0: 6765 745f 7368 705f 6c6f 6e5d 0a20 2020  get_shp_lon].   
-000047d0: 2020 2020 2023 2063 6865 636b 206f 7468       # check oth
-000047e0: 6572 2067 656f 6d65 7472 6965 7320 616e  er geometries an
-000047f0: 6420 6164 6420 6275 6666 6572 2069 6620  d add buffer if 
-00004800: 6e65 6564 6564 0a20 2020 2020 2020 2064  needed.        d
-00004810: 6574 6563 7465 645f 706f 696e 7473 203d  etected_points =
-00004820: 2046 616c 7365 0a20 2020 2020 2020 2064   False.        d
-00004830: 6574 6563 7465 645f 6d75 6c74 6970 6f69  etected_multipoi
-00004840: 6e74 7320 3d20 4661 6c73 650a 2020 2020  nts = False.    
-00004850: 2020 2020 6465 7465 6374 6564 5f6c 696e      detected_lin
-00004860: 6573 203d 2046 616c 7365 0a20 2020 2020  es = False.     
-00004870: 2020 2066 6f72 2069 6e64 6578 2c20 5f20     for index, _ 
-00004880: 696e 2073 6870 2e69 7465 7272 6f77 7328  in shp.iterrows(
-00004890: 293a 0a20 2020 2020 2020 2020 2020 2070  ):.            p
-000048a0: 6f6c 7973 203d 2073 6870 2e67 656f 6d65  olys = shp.geome
-000048b0: 7472 792e 696c 6f63 5b69 6e64 6578 5d20  try.iloc[index] 
-000048c0: 2320 6765 7420 7468 6520 7368 6170 650a  # get the shape.
-000048d0: 2020 2020 2020 2020 2020 2020 6966 2070              if p
-000048e0: 6f6c 7973 2e67 656f 6d5f 7479 7065 2e6c  olys.geom_type.l
-000048f0: 6f77 6572 2829 203d 3d20 2270 6f69 6e74  ower() == "point
-00004900: 2220 2020 2020 206f 7220 706f 6c79 732e  "      or polys.
-00004910: 6765 6f6d 5f74 7970 652e 6c6f 7765 7228  geom_type.lower(
-00004920: 2920 3d3d 2022 706f 696e 7473 223a 0a20  ) == "points":. 
-00004930: 2020 2020 2020 2020 2020 2020 2020 2064                 d
-00004940: 6574 6563 7465 645f 706f 696e 7473 203d  etected_points =
-00004950: 2054 7275 650a 2020 2020 2020 2020 2020   True.          
-00004960: 2020 2020 2020 706f 6c79 7320 3d20 706f        polys = po
-00004970: 6c79 732e 6275 6666 6572 2831 302a 2a2d  lys.buffer(10**-
-00004980: 3529 2e73 696d 706c 6966 7928 3130 2a2a  5).simplify(10**
-00004990: 2d35 290a 2020 2020 2020 2020 2020 2020  -5).            
-000049a0: 2020 2020 7368 702e 6765 6f6d 6574 7279      shp.geometry
-000049b0: 2e69 6c6f 635b 696e 6465 785d 203d 2070  .iloc[index] = p
-000049c0: 6f6c 7973 0a20 2020 2020 2020 2020 2020  olys.           
-000049d0: 2069 6620 706f 6c79 732e 6765 6f6d 5f74   if polys.geom_t
-000049e0: 7970 652e 6c6f 7765 7228 2920 3d3d 2022  ype.lower() == "
-000049f0: 6d75 6c74 6970 6f69 6e74 2220 6f72 2070  multipoint" or p
-00004a00: 6f6c 7973 2e67 656f 6d5f 7479 7065 2e6c  olys.geom_type.l
-00004a10: 6f77 6572 2829 203d 3d20 226d 756c 7469  ower() == "multi
-00004a20: 706f 696e 7473 223a 0a20 2020 2020 2020  points":.       
-00004a30: 2020 2020 2020 2020 2064 6574 6563 7465           detecte
-00004a40: 645f 6d75 6c74 6970 6f69 6e74 7320 3d20  d_multipoints = 
-00004a50: 5472 7565 0a20 2020 2020 2020 2020 2020  True.           
-00004a60: 2020 2020 2070 6f6c 7973 203d 2070 6f6c       polys = pol
-00004a70: 7973 2e62 7566 6665 7228 3130 2a2a 2d35  ys.buffer(10**-5
-00004a80: 292e 7369 6d70 6c69 6679 2831 302a 2a2d  ).simplify(10**-
-00004a90: 3529 0a20 2020 2020 2020 2020 2020 2020  5).             
-00004aa0: 2020 2073 6870 2e67 656f 6d65 7472 792e     shp.geometry.
-00004ab0: 696c 6f63 5b69 6e64 6578 5d20 3d20 706f  iloc[index] = po
-00004ac0: 6c79 730a 2020 2020 2020 2020 2020 2020  lys.            
-00004ad0: 6966 2070 6f6c 7973 2e67 656f 6d5f 7479  if polys.geom_ty
-00004ae0: 7065 2e6c 6f77 6572 2829 203d 3d20 226c  pe.lower() == "l
-00004af0: 696e 6522 2020 2020 2020 206f 7220 706f  ine"       or po
-00004b00: 6c79 732e 6765 6f6d 5f74 7970 652e 6c6f  lys.geom_type.lo
-00004b10: 7765 7228 2920 3d3d 2022 6c69 6e65 7322  wer() == "lines"
-00004b20: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-00004b30: 2020 6465 7465 6374 6564 5f6c 696e 6573    detected_lines
-00004b40: 203d 2054 7275 650a 2020 2020 2020 2020   = True.        
-00004b50: 2020 2020 2020 2020 706f 6c79 7320 3d20          polys = 
-00004b60: 706f 6c79 732e 6275 6666 6572 2831 302a  polys.buffer(10*
-00004b70: 2a2d 3529 2e73 696d 706c 6966 7928 3130  *-5).simplify(10
-00004b80: 2a2a 2d35 290a 2020 2020 2020 2020 2020  **-5).          
-00004b90: 2020 2020 2020 7368 702e 6765 6f6d 6574        shp.geomet
-00004ba0: 7279 2e69 6c6f 635b 696e 6465 785d 203d  ry.iloc[index] =
-00004bb0: 2070 6f6c 7973 0a20 2020 2020 2020 2020   polys.         
-00004bc0: 2020 2069 6620 706f 6c79 732e 6765 6f6d     if polys.geom
-00004bd0: 5f74 7970 652e 6c6f 7765 7228 2920 3d3d  _type.lower() ==
-00004be0: 2022 706f 6c79 6c69 6e65 2220 2020 6f72   "polyline"   or
-00004bf0: 2070 6f6c 7973 2e67 656f 6d5f 7479 7065   polys.geom_type
-00004c00: 2e6c 6f77 6572 2829 203d 3d20 2270 6f6c  .lower() == "pol
-00004c10: 796c 696e 6573 223a 0a20 2020 2020 2020  ylines":.       
-00004c20: 2020 2020 2020 2020 2064 6574 6563 7465           detecte
-00004c30: 645f 6c69 6e65 7320 3d20 5472 7565 0a20  d_lines = True. 
-00004c40: 2020 2020 2020 2020 2020 2020 2020 2070                 p
-00004c50: 6f6c 7973 203d 2070 6f6c 7973 2e62 7566  olys = polys.buf
-00004c60: 6665 7228 3130 2a2a 2d35 292e 7369 6d70  fer(10**-5).simp
-00004c70: 6c69 6679 2831 302a 2a2d 3529 0a20 2020  lify(10**-5).   
-00004c80: 2020 2020 2020 2020 2020 2020 2073 6870               shp
-00004c90: 2e67 656f 6d65 7472 792e 696c 6f63 5b69  .geometry.iloc[i
-00004ca0: 6e64 6578 5d20 3d20 706f 6c79 730a 2020  ndex] = polys.  
-00004cb0: 2020 2020 2020 2320 7072 696e 7420 6d65        # print me
-00004cc0: 7373 6167 6573 0a20 2020 2020 2020 2069  ssages.        i
-00004cd0: 6620 6465 7465 6374 6564 5f70 6f69 6e74  f detected_point
-00004ce0: 733a 0a20 2020 2020 2020 2020 2020 2070  s:.            p
-00004cf0: 7269 6e74 2827 4541 5359 4d4f 5245 2064  rint('EASYMORE d
-00004d00: 6574 6563 7473 2070 6f69 6e74 2873 2920  etects point(s) 
-00004d10: 6173 2067 656f 6d65 7472 7920 6f66 2074  as geometry of t
-00004d20: 6172 6765 7420 7368 6170 6566 696c 6520  arget shapefile 
-00004d30: 616e 6420 7769 6c6c 2061 7070 6c79 2073  and will apply s
-00004d40: 6d61 6c6c 2062 7566 6665 7220 746f 2074  mall buffer to t
-00004d50: 6865 6d27 290a 2020 2020 2020 2020 6966  hem').        if
-00004d60: 2064 6574 6563 7465 645f 6d75 6c74 6970   detected_multip
-00004d70: 6f69 6e74 733a 0a20 2020 2020 2020 2020  oints:.         
-00004d80: 2020 2070 7269 6e74 2827 4541 5359 4d4f     print('EASYMO
-00004d90: 5245 2064 6574 6563 7465 6420 6d75 6c74  RE detected mult
-00004da0: 6970 6f69 6e74 2061 7320 6765 6f6d 6574  ipoint as geomet
-00004db0: 7279 206f 6620 7461 7267 6574 2073 6861  ry of target sha
-00004dc0: 7065 6669 6c65 2061 6e64 2077 696c 6c20  pefile and will 
-00004dd0: 636f 6e73 6964 6572 6520 6974 2061 7320  considere it as 
-00004de0: 6d75 6c74 6970 6f6c 7967 6f6e 6527 290a  multipolygone').
-00004df0: 2020 2020 2020 2020 2020 2020 7072 696e              prin
-00004e00: 7428 2768 656e 6365 2045 4153 594d 4f52  t('hence EASYMOR
-00004e10: 4520 7769 6c6c 2070 726f 7669 6465 2074  E will provide t
-00004e20: 6865 2061 7665 7261 6765 206f 6620 616c  he average of al
-00004e30: 6c20 7468 6520 706f 696e 7420 696e 2065  l the point in e
-00004e40: 6163 6820 6d75 6c74 6970 6f69 6e74 2729  ach multipoint')
-00004e50: 0a20 2020 2020 2020 2020 2020 2070 7269  .            pri
-00004e60: 6e74 2827 6966 2079 6f75 206d 6973 7461  nt('if you mista
-00004e70: 6b65 6e6c 7920 6861 7665 2067 6976 656e  kenly have given
-00004e80: 2070 6f69 746e 7320 6173 206d 756c 7469   poitns as multi
-00004e90: 706f 696e 7473 2070 6c65 6173 6520 636f  points please co
-00004ea0: 7272 6563 7420 7468 6520 7461 7267 6574  rrect the target
-00004eb0: 2073 6861 7065 6669 6c65 2729 0a20 2020   shapefile').   
-00004ec0: 2020 2020 2069 6620 6465 7465 6374 6564       if detected
-00004ed0: 5f6c 696e 6573 3a0a 2020 2020 2020 2020  _lines:.        
-00004ee0: 2020 2020 7072 696e 7428 2745 4153 594d      print('EASYM
-00004ef0: 4f52 4520 6465 7465 6374 6564 206c 696e  ORE detected lin
-00004f00: 6520 6173 2067 656f 6d65 7472 7920 6f66  e as geometry of
-00004f10: 2074 6172 6765 7420 7368 6170 6566 696c   target shapefil
-00004f20: 6520 616e 6420 7769 6c6c 2063 6f6e 7369  e and will consi
-00004f30: 6465 7265 2069 7420 6173 2070 6f6c 7967  dere it as polyg
-00004f40: 6f6e 2028 6164 6469 6e67 2073 6d61 6c6c  on (adding small
-00004f50: 2062 7566 6665 7229 2729 0a20 2020 2020   buffer)').     
-00004f60: 2020 2070 7269 6e74 2827 6974 2073 6565     print('it see
-00004f70: 6d73 2065 7665 7279 7468 696e 6720 6973  ms everything is
-00004f80: 204f 4b20 7769 7468 2074 6865 2073 696e   OK with the sin
-00004f90: 6b2f 7461 7267 6574 2073 6861 7065 6669  k/target shapefi
-00004fa0: 6c65 3b20 6164 6465 6420 746f 2045 4153  le; added to EAS
-00004fb0: 594d 4f52 4520 6f62 6a65 6374 2074 6172  YMORE object tar
-00004fc0: 6765 745f 7368 705f 6770 6427 290a 2020  get_shp_gpd').  
-00004fd0: 2020 2020 2020 6966 2073 656c 662e 736f        if self.so
-00004fe0: 7274 5f49 443a 0a20 2020 2020 2020 2020  rt_ID:.         
-00004ff0: 2020 2073 6870 203d 2073 6870 2e73 6f72     shp = shp.sor
-00005000: 745f 7661 6c75 6573 2862 793d 2749 445f  t_values(by='ID_
-00005010: 7427 290a 2020 2020 2020 2020 2020 2020  t').            
-00005020: 7368 7020 3d20 7368 702e 7265 7365 745f  shp = shp.reset_
-00005030: 696e 6465 7828 6472 6f70 3d54 7275 6529  index(drop=True)
-00005040: 0a20 2020 2020 2020 2073 6870 5b27 6f72  .        shp['or
-00005050: 6465 7227 5d20 3d20 6e70 2e61 7261 6e67  der'] = np.arang
-00005060: 6528 6c65 6e28 7368 7029 2920 2b20 3120  e(len(shp)) + 1 
-00005070: 2320 6f72 6465 7220 6f66 2074 6865 2073  # order of the s
-00005080: 6861 7065 6669 6c65 0a20 2020 2020 2020  hapefile.       
-00005090: 2072 6574 7572 6e20 7368 700a 0a20 2020   return shp..   
-000050a0: 2064 6566 2063 6865 636b 5f73 6f75 7263   def check_sourc
-000050b0: 655f 6e63 2028 7365 6c66 293a 0a20 2020  e_nc (self):.   
-000050c0: 2020 2020 2022 2222 0a20 2020 2020 2020       """.       
-000050d0: 2040 2061 7574 686f 723a 2020 2020 2020   @ author:      
-000050e0: 2020 2020 2020 2020 2020 2020 5368 6572              Sher
-000050f0: 7661 6e20 4768 6172 6172 690a 2020 2020  van Gharari.    
-00005100: 2020 2020 4020 4769 7468 7562 3a20 2020      @ Github:   
-00005110: 2020 2020 2020 2020 2020 2020 2020 2068                 h
-00005120: 7474 7073 3a2f 2f67 6974 6875 622e 636f  ttps://github.co
-00005130: 6d2f 5368 6572 7661 6e47 6861 7261 7269  m/ShervanGharari
-00005140: 2f45 4153 594d 4f52 450a 2020 2020 2020  /EASYMORE.      
-00005150: 2020 4020 6175 7468 6f72 2773 2065 6d61    @ author's ema
-00005160: 696c 2069 643a 2020 2020 2020 2073 682e  il id:       sh.
-00005170: 6768 6172 6172 6940 676d 6169 6c2e 636f  gharari@gmail.co
-00005180: 6d0a 2020 2020 2020 2020 4020 6c69 6365  m.        @ lice
-00005190: 6e73 653a 2020 2020 2020 2020 2020 2020  nse:            
-000051a0: 2020 2020 2047 4e55 2d47 504c 7633 0a20       GNU-GPLv3. 
-000051b0: 2020 2020 2020 2054 6869 7320 6675 6e63         This func
-000051c0: 7469 6f6e 2063 6865 636b 7320 7468 6520  tion checks the 
-000051d0: 636f 6e73 6973 7465 6e63 7920 6f66 2074  consistency of t
-000051e0: 6865 2064 696d 656e 7469 6f6e 7320 616e  he dimentions an
-000051f0: 6420 7661 7269 6261 6c65 7320 666f 7220  d varibales for 
-00005200: 736f 7572 6365 206e 6574 6364 6620 6669  source netcdf fi
-00005210: 6c65 2873 290a 2020 2020 2020 2020 2222  le(s).        ""
-00005220: 220a 2020 2020 2020 2020 666c 6167 5f64  ".        flag_d
-00005230: 6f5f 6e6f 745f 6d61 7463 6820 3d20 4661  o_not_match = Fa
-00005240: 6c73 650a 2020 2020 2020 2020 6e63 5f6e  lse.        nc_n
-00005250: 616d 6573 203d 2067 6c6f 622e 676c 6f62  ames = glob.glob
-00005260: 2028 7365 6c66 2e73 6f75 7263 655f 6e63   (self.source_nc
-00005270: 290a 2020 2020 2020 2020 6966 206e 6f74  ).        if not
-00005280: 206e 635f 6e61 6d65 733a 0a20 2020 2020   nc_names:.     
-00005290: 2020 2020 2020 2073 7973 2e65 7869 7428         sys.exit(
-000052a0: 2745 4153 594d 4f52 4520 6465 7465 6374  'EASYMORE detect
-000052b0: 7320 6e6f 206e 6574 4344 4620 6669 6c65  s no netCDF file
-000052c0: 3b20 6368 6563 6b20 7468 6520 7061 7468  ; check the path
-000052d0: 2074 6f20 7468 6520 736f 7572 6520 6e65   to the soure ne
-000052e0: 7443 4446 2066 696c 6573 2729 0a20 2020  tCDF files').   
-000052f0: 2020 2020 2065 6c73 653a 0a20 2020 2020       else:.     
-00005300: 2020 2020 2020 206e 6369 6420 2020 2020         ncid     
-00005310: 203d 206e 6334 2e44 6174 6173 6574 286e   = nc4.Dataset(n
-00005320: 635f 6e61 6d65 735b 305d 290a 2020 2020  c_names[0]).    
-00005330: 2020 2020 2020 2020 7661 725f 6469 6d20          var_dim 
-00005340: 2020 3d20 6c69 7374 286e 6369 642e 7661    = list(ncid.va
-00005350: 7269 6162 6c65 735b 7365 6c66 2e76 6172  riables[self.var
-00005360: 5f6e 616d 6573 5b30 5d5d 2e64 696d 656e  _names[0]].dimen
-00005370: 7369 6f6e 7329 0a20 2020 2020 2020 2020  sions).         
-00005380: 2020 206c 6174 5f64 696d 2020 203d 206c     lat_dim   = l
-00005390: 6973 7428 6e63 6964 2e76 6172 6961 626c  ist(ncid.variabl
-000053a0: 6573 5b73 656c 662e 7661 725f 6c61 745d  es[self.var_lat]
-000053b0: 2e64 696d 656e 7369 6f6e 7329 0a20 2020  .dimensions).   
-000053c0: 2020 2020 2020 2020 206c 6f6e 5f64 696d           lon_dim
-000053d0: 2020 203d 206c 6973 7428 6e63 6964 2e76     = list(ncid.v
-000053e0: 6172 6961 626c 6573 5b73 656c 662e 7661  ariables[self.va
-000053f0: 725f 6c6f 6e5d 2e64 696d 656e 7369 6f6e  r_lon].dimension
-00005400: 7329 0a20 2020 2020 2020 2020 2020 206c  s).            l
-00005410: 6174 5f76 616c 7565 203d 206e 702e 6172  at_value = np.ar
-00005420: 7261 7928 6e63 6964 2e76 6172 6961 626c  ray(ncid.variabl
-00005430: 6573 5b73 656c 662e 7661 725f 6c61 745d  es[self.var_lat]
-00005440: 290a 2020 2020 2020 2020 2020 2020 6c6f  ).            lo
-00005450: 6e5f 7661 6c75 6520 3d20 6e70 2e61 7272  n_value = np.arr
-00005460: 6179 286e 6369 642e 7661 7269 6162 6c65  ay(ncid.variable
-00005470: 735b 7365 6c66 2e76 6172 5f6c 6f6e 5d29  s[self.var_lon])
-00005480: 0a20 2020 2020 2020 2020 2020 2023 2064  .            # d
-00005490: 696d 656e 7369 6f6e 2063 6865 636b 2062  imension check b
-000054a0: 6173 6564 206f 6e20 7468 6520 6669 7273  ased on the firs
-000054b0: 7420 6e65 7463 6466 2066 696c 650a 2020  t netcdf file.  
-000054c0: 2020 2020 2020 2020 2020 6966 206e 6f74            if not
-000054d0: 2028 7365 7428 6c61 745f 6469 6d29 203c   (set(lat_dim) <
-000054e0: 3d20 7365 7428 7661 725f 6469 6d29 293a  = set(var_dim)):
-000054f0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00005500: 2066 6c61 675f 646f 5f6e 6f74 5f6d 6174   flag_do_not_mat
-00005510: 6368 203d 2054 7275 650a 2020 2020 2020  ch = True.      
-00005520: 2020 2020 2020 6966 206e 6f74 2028 7365        if not (se
-00005530: 7428 6c6f 6e5f 6469 6d29 203c 3d20 7365  t(lon_dim) <= se
-00005540: 7428 7661 725f 6469 6d29 293a 0a20 2020  t(var_dim)):.   
-00005550: 2020 2020 2020 2020 2020 2020 2066 6c61               fla
-00005560: 675f 646f 5f6e 6f74 5f6d 6174 6368 203d  g_do_not_match =
-00005570: 2054 7275 650a 2020 2020 2020 2020 2020   True.          
-00005580: 2020 6966 2028 6c65 6e28 6c61 745f 6469    if (len(lat_di
-00005590: 6d29 203d 3d20 3229 2061 6e64 2028 6c65  m) == 2) and (le
-000055a0: 6e28 6c6f 6e5f 6469 6d29 203d 3d20 3229  n(lon_dim) == 2)
-000055b0: 2061 6e64 2028 6c65 6e28 7661 725f 6469   and (len(var_di
-000055c0: 6d29 203d 3d20 3329 3a20 2320 6361 7365  m) == 3): # case
-000055d0: 2032 0a20 2020 2020 2020 2020 2020 2020   2.             
-000055e0: 2020 2069 6620 6e6f 7420 2873 6574 286c     if not (set(l
-000055f0: 6174 5f64 696d 2920 3d3d 2073 6574 286c  at_dim) == set(l
-00005600: 6f6e 5f64 696d 2929 3a0a 2020 2020 2020  on_dim)):.      
-00005610: 2020 2020 2020 2020 2020 2020 2020 666c                fl
-00005620: 6167 5f64 6f5f 6e6f 745f 6d61 7463 6820  ag_do_not_match 
-00005630: 3d20 5472 7565 0a20 2020 2020 2020 2020  = True.         
-00005640: 2020 2069 6620 286c 656e 286c 6174 5f64     if (len(lat_d
-00005650: 696d 2920 3d3d 2031 2920 616e 6420 286c  im) == 1) and (l
-00005660: 656e 286c 6f6e 5f64 696d 2920 3d3d 2031  en(lon_dim) == 1
-00005670: 2920 616e 6420 286c 656e 2876 6172 5f64  ) and (len(var_d
-00005680: 696d 2920 3d3d 2032 293a 2023 2063 6173  im) == 2): # cas
-00005690: 6520 330a 2020 2020 2020 2020 2020 2020  e 3.            
-000056a0: 2020 2020 6966 206e 6f74 2028 7365 7428      if not (set(
-000056b0: 6c61 745f 6469 6d29 203d 3d20 7365 7428  lat_dim) == set(
-000056c0: 6c6f 6e5f 6469 6d29 293a 0a20 2020 2020  lon_dim)):.     
-000056d0: 2020 2020 2020 2020 2020 2020 2020 2066                 f
-000056e0: 6c61 675f 646f 5f6e 6f74 5f6d 6174 6368  lag_do_not_match
-000056f0: 203d 2054 7275 650a 2020 2020 2020 2020   = True.        
-00005700: 2020 2020 2320 6469 6d65 6e73 696f 6e20      # dimension 
-00005710: 6368 6563 6b20 616e 6420 636f 6e73 6973  check and consis
-00005720: 7461 6e63 7920 666f 7220 7661 7269 6162  tancy for variab
-00005730: 6c65 206c 6174 6974 7564 650a 2020 2020  le latitude.    
-00005740: 2020 2020 2020 2020 666f 7220 6e63 5f6e          for nc_n
-00005750: 616d 6520 696e 206e 635f 6e61 6d65 733a  ame in nc_names:
-00005760: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00005770: 206e 6369 6420 3d20 6e63 342e 4461 7461   ncid = nc4.Data
-00005780: 7365 7428 6e63 5f6e 616d 6529 0a20 2020  set(nc_name).   
-00005790: 2020 2020 2020 2020 2020 2020 2074 656d               tem
-000057a0: 7020 3d20 6c69 7374 286e 6369 642e 7661  p = list(ncid.va
-000057b0: 7269 6162 6c65 735b 7365 6c66 2e76 6172  riables[self.var
-000057c0: 5f6c 6174 5d2e 6469 6d65 6e73 696f 6e73  _lat].dimensions
-000057d0: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
-000057e0: 2020 2320 6669 7374 2063 6865 636b 2074    # fist check t
-000057f0: 6865 206c 656e 6774 6820 6f66 2074 6865  he length of the
-00005800: 2074 656d 7020 616e 6420 6c61 745f 6469   temp and lat_di
-00005810: 6d0a 2020 2020 2020 2020 2020 2020 2020  m.              
-00005820: 2020 6966 206c 656e 2874 656d 7029 2021    if len(temp) !
-00005830: 3d20 6c65 6e28 6c61 745f 6469 6d29 3a0a  = len(lat_dim):.
-00005840: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00005850: 2020 2020 666c 6167 5f64 6f5f 6e6f 745f      flag_do_not_
-00005860: 6d61 7463 6820 3d20 5472 7565 0a20 2020  match = True.   
-00005870: 2020 2020 2020 2020 2020 2020 2065 6c73               els
-00005880: 653a 0a20 2020 2020 2020 2020 2020 2020  e:.             
-00005890: 2020 2020 2020 2066 6f72 2069 2069 6e20         for i in 
-000058a0: 6e70 2e61 7261 6e67 6528 6c65 6e28 7465  np.arange(len(te
-000058b0: 6d70 2929 3a0a 2020 2020 2020 2020 2020  mp)):.          
-000058c0: 2020 2020 2020 2020 2020 2020 2020 6966                if
-000058d0: 2074 656d 705b 695d 2021 3d20 6c61 745f   temp[i] != lat_
-000058e0: 6469 6d5b 695d 3a0a 2020 2020 2020 2020  dim[i]:.        
-000058f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00005900: 2020 2020 666c 6167 5f64 6f5f 6e6f 745f      flag_do_not_
-00005910: 6d61 7463 6820 3d20 5472 7565 0a20 2020  match = True.   
-00005920: 2020 2020 2020 2020 2020 2020 2074 656d               tem
-00005930: 7020 3d20 6e70 2e61 7272 6179 286e 6369  p = np.array(nci
-00005940: 642e 7661 7269 6162 6c65 735b 7365 6c66  d.variables[self
-00005950: 2e76 6172 5f6c 6174 5d29 0a20 2020 2020  .var_lat]).     
-00005960: 2020 2020 2020 2020 2020 2069 6620 6e70             if np
-00005970: 2e73 756d 2861 6273 286c 6174 5f76 616c  .sum(abs(lat_val
-00005980: 7565 2d74 656d 7029 293e 7365 6c66 2e74  ue-temp))>self.t
-00005990: 6f6c 6572 616e 6365 3a0a 2020 2020 2020  olerance:.      
-000059a0: 2020 2020 2020 2020 2020 2020 2020 666c                fl
-000059b0: 6167 5f64 6f5f 6e6f 745f 6d61 7463 6820  ag_do_not_match 
-000059c0: 3d20 5472 7565 0a20 2020 2020 2020 2020  = True.         
-000059d0: 2020 2023 2064 696d 656e 7369 6f6e 2063     # dimension c
-000059e0: 6865 636b 2061 6e64 2063 6f6e 7369 7374  heck and consist
-000059f0: 616e 6379 2066 6f72 2076 6172 6961 626c  ancy for variabl
-00005a00: 6520 6c6f 6e67 6974 7564 650a 2020 2020  e longitude.    
-00005a10: 2020 2020 2020 2020 666f 7220 6e63 5f6e          for nc_n
-00005a20: 616d 6520 696e 206e 635f 6e61 6d65 733a  ame in nc_names:
-00005a30: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00005a40: 206e 6369 6420 3d20 6e63 342e 4461 7461   ncid = nc4.Data
-00005a50: 7365 7428 6e63 5f6e 616d 6529 0a20 2020  set(nc_name).   
-00005a60: 2020 2020 2020 2020 2020 2020 2074 656d               tem
-00005a70: 7020 3d20 6c69 7374 286e 6369 642e 7661  p = list(ncid.va
-00005a80: 7269 6162 6c65 735b 7365 6c66 2e76 6172  riables[self.var
-00005a90: 5f6c 6f6e 5d2e 6469 6d65 6e73 696f 6e73  _lon].dimensions
-00005aa0: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
-00005ab0: 2020 2320 6669 7374 2063 6865 636b 2074    # fist check t
-00005ac0: 6865 206c 656e 6774 6820 6f66 2074 6865  he length of the
-00005ad0: 2074 656d 7020 616e 6420 6c6f 6e5f 6469   temp and lon_di
-00005ae0: 6d0a 2020 2020 2020 2020 2020 2020 2020  m.              
-00005af0: 2020 6966 206c 656e 2874 656d 7029 2021    if len(temp) !
-00005b00: 3d20 6c65 6e28 6c6f 6e5f 6469 6d29 3a0a  = len(lon_dim):.
-00005b10: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00005b20: 2020 2020 666c 6167 5f64 6f5f 6e6f 745f      flag_do_not_
-00005b30: 6d61 7463 6820 3d20 5472 7565 0a20 2020  match = True.   
-00005b40: 2020 2020 2020 2020 2020 2020 2065 6c73               els
-00005b50: 653a 0a20 2020 2020 2020 2020 2020 2020  e:.             
-00005b60: 2020 2020 2020 2066 6f72 2069 2069 6e20         for i in 
-00005b70: 6e70 2e61 7261 6e67 6528 6c65 6e28 7465  np.arange(len(te
-00005b80: 6d70 2929 3a0a 2020 2020 2020 2020 2020  mp)):.          
-00005b90: 2020 2020 2020 2020 2020 2020 2020 6966                if
-00005ba0: 2074 656d 705b 695d 2021 3d20 6c6f 6e5f   temp[i] != lon_
-00005bb0: 6469 6d5b 695d 3a0a 2020 2020 2020 2020  dim[i]:.        
-00005bc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00005bd0: 2020 2020 666c 6167 5f64 6f5f 6e6f 745f      flag_do_not_
-00005be0: 6d61 7463 6820 3d20 5472 7565 0a20 2020  match = True.   
-00005bf0: 2020 2020 2020 2020 2020 2020 2074 656d               tem
-00005c00: 7020 3d20 6e70 2e61 7272 6179 286e 6369  p = np.array(nci
-00005c10: 642e 7661 7269 6162 6c65 735b 7365 6c66  d.variables[self
-00005c20: 2e76 6172 5f6c 6f6e 5d29 0a20 2020 2020  .var_lon]).     
-00005c30: 2020 2020 2020 2020 2020 2069 6620 6e70             if np
-00005c40: 2e73 756d 2861 6273 286c 6f6e 5f76 616c  .sum(abs(lon_val
-00005c50: 7565 2d74 656d 7029 293e 7365 6c66 2e74  ue-temp))>self.t
-00005c60: 6f6c 6572 616e 6365 3a0a 2020 2020 2020  olerance:.      
-00005c70: 2020 2020 2020 2020 2020 2020 2020 666c                fl
-00005c80: 6167 5f64 6f5f 6e6f 745f 6d61 7463 6820  ag_do_not_match 
-00005c90: 3d20 5472 7565 0a20 2020 2020 2020 2020  = True.         
-00005ca0: 2020 2023 2064 696d 656e 7369 6f6e 2063     # dimension c
-00005cb0: 6865 636b 2063 6f6e 7369 7374 616e 6379  heck consistancy
-00005cc0: 2066 6f72 2076 6172 6961 626c 6573 2074   for variables t
-00005cd0: 6f20 6265 2072 656d 6170 7065 640a 2020  o be remapped.  
-00005ce0: 2020 2020 2020 2020 2020 666f 7220 7661            for va
-00005cf0: 725f 6e61 6d65 2069 6e20 7365 6c66 2e76  r_name in self.v
-00005d00: 6172 5f6e 616d 6573 3a0a 2020 2020 2020  ar_names:.      
-00005d10: 2020 2020 2020 2020 2020 2320 6765 7420            # get 
-00005d20: 7468 6520 7661 7269 6261 6c65 2069 6e66  the varibale inf
-00005d30: 6f72 6d61 7469 6f6e 206f 6620 6c61 742c  ormation of lat,
-00005d40: 206c 6f6e 2061 6e64 2064 696d 656e 7369   lon and dimensi
-00005d50: 6f6e 7320 6f66 2074 6865 2076 6172 6962  ons of the varib
-00005d60: 616c 652e 0a20 2020 2020 2020 2020 2020  ale..           
-00005d70: 2020 2020 2066 6f72 206e 635f 6e61 6d65       for nc_name
-00005d80: 2069 6e20 6e63 5f6e 616d 6573 3a0a 2020   in nc_names:.  
-00005d90: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00005da0: 2020 6e63 6964 203d 206e 6334 2e44 6174    ncid = nc4.Dat
-00005db0: 6173 6574 286e 635f 6e61 6d65 290a 2020  aset(nc_name).  
-00005dc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00005dd0: 2020 7465 6d70 203d 206c 6973 7428 6e63    temp = list(nc
-00005de0: 6964 2e76 6172 6961 626c 6573 5b76 6172  id.variables[var
-00005df0: 5f6e 616d 655d 2e64 696d 656e 7369 6f6e  _name].dimension
-00005e00: 7329 0a20 2020 2020 2020 2020 2020 2020  s).             
-00005e10: 2020 2020 2020 2023 2066 6973 7420 6368         # fist ch
-00005e20: 6563 6b20 7468 6520 6c65 6e67 7468 206f  eck the length o
-00005e30: 6620 7468 6520 7465 6d70 2061 6e64 2076  f the temp and v
-00005e40: 6172 5f64 696d 0a20 2020 2020 2020 2020  ar_dim.         
-00005e50: 2020 2020 2020 2020 2020 2069 6620 6c65             if le
-00005e60: 6e28 7465 6d70 2920 213d 206c 656e 2876  n(temp) != len(v
-00005e70: 6172 5f64 696d 293a 0a20 2020 2020 2020  ar_dim):.       
-00005e80: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00005e90: 2066 6c61 675f 646f 5f6e 6f74 5f6d 6174   flag_do_not_mat
-00005ea0: 6368 203d 2054 7275 650a 2020 2020 2020  ch = True.      
-00005eb0: 2020 2020 2020 2020 2020 2020 2020 656c                el
-00005ec0: 7365 3a0a 2020 2020 2020 2020 2020 2020  se:.            
-00005ed0: 2020 2020 2020 2020 2020 2020 666f 7220              for 
-00005ee0: 6920 696e 206e 702e 6172 616e 6765 286c  i in np.arange(l
-00005ef0: 656e 2874 656d 7029 293a 0a20 2020 2020  en(temp)):.     
-00005f00: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00005f10: 2020 2020 2020 2069 6620 7465 6d70 5b69         if temp[i
-00005f20: 5d20 213d 2076 6172 5f64 696d 5b69 5d3a  ] != var_dim[i]:
-00005f30: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00005f40: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00005f50: 2066 6c61 675f 646f 5f6e 6f74 5f6d 6174   flag_do_not_mat
-00005f60: 6368 203d 2054 7275 650a 2020 2020 2020  ch = True.      
-00005f70: 2020 2020 2020 2320 6368 6563 6b20 7661        # check va
-00005f80: 7269 6261 6c65 2074 696d 6520 616e 6420  ribale time and 
-00005f90: 6469 6d65 6e73 696f 6e20 7469 6d65 2061  dimension time a
-00005fa0: 7265 2074 6865 2073 616d 6520 6e61 6d65  re the same name
-00005fb0: 2073 6f20 7469 6d65 2069 7320 636f 6f72   so time is coor
-00005fc0: 6469 6e61 7465 0a20 2020 2020 2020 2020  dinate.         
-00005fd0: 2020 2066 6f72 206e 635f 6e61 6d65 2069     for nc_name i
-00005fe0: 6e20 6e63 5f6e 616d 6573 3a0a 2020 2020  n nc_names:.    
-00005ff0: 2020 2020 2020 2020 2020 2020 6e63 6964              ncid
-00006000: 203d 206e 6334 2e44 6174 6173 6574 286e   = nc4.Dataset(n
-00006010: 635f 6e61 6d65 290a 2020 2020 2020 2020  c_name).        
-00006020: 2020 2020 2020 2020 7465 6d70 203d 206e          temp = n
-00006030: 6369 642e 7661 7269 6162 6c65 735b 7365  cid.variables[se
-00006040: 6c66 2e76 6172 5f74 696d 655d 2e64 696d  lf.var_time].dim
-00006050: 656e 7369 6f6e 730a 2020 2020 2020 2020  ensions.        
-00006060: 2020 2020 2020 2020 6966 206c 656e 2874          if len(t
-00006070: 656d 7029 2021 3d20 313a 0a20 2020 2020  emp) != 1:.     
-00006080: 2020 2020 2020 2020 2020 2020 2020 2073                 s
-00006090: 7973 2e65 7869 7428 2745 4153 594d 4f52  ys.exit('EASYMOR
-000060a0: 4520 6578 7065 6374 7320 3144 2074 696d  E expects 1D tim
-000060b0: 6520 7661 7269 6261 6c65 2c20 6974 2073  e varibale, it s
-000060c0: 6565 6d73 2074 696d 6520 7661 7269 6261  eems time variba
-000060d0: 6c65 7320 6861 7320 6d6f 7265 2074 6861  les has more tha
-000060e0: 6e20 3120 6469 6d65 6e73 696f 6e27 290a  n 1 dimension').
-000060f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00006100: 6966 2073 7472 2874 656d 705b 305d 2920  if str(temp[0]) 
-00006110: 213d 2073 656c 662e 7661 725f 7469 6d65  != self.var_time
-00006120: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-00006130: 2020 2020 2020 7379 732e 6578 6974 2827        sys.exit('
-00006140: 4541 5359 4d4f 5245 2065 7870 6563 7473  EASYMORE expects
-00006150: 2074 696d 6520 7661 7269 6261 6c65 2061   time varibale a
-00006160: 6e64 2064 696d 656e 7369 6f6e 2074 6f20  nd dimension to 
-00006170: 6265 2064 6966 6665 7265 6e74 2c20 7468  be different, th
-00006180: 6579 2073 686f 756c 6420 6265 2074 6865  ey should be the
-00006190: 2073 616d 655c 0a20 2020 2020 2020 2020   same\.         
-000061a0: 2020 2020 2020 2020 2020 2066 6f72 2078             for x
-000061b0: 6172 7261 7920 746f 2063 6f6e 7369 6465  array to conside
-000061c0: 7220 7469 6d65 2064 696d 656e 7369 6f6e  r time dimension
-000061d0: 2061 7320 636f 6f72 6469 6e61 7465 7327   as coordinates'
-000061e0: 290a 2020 2020 2020 2020 6966 2066 6c61  ).        if fla
-000061f0: 675f 646f 5f6e 6f74 5f6d 6174 6368 3a0a  g_do_not_match:.
-00006200: 2020 2020 2020 2020 2020 2020 7379 732e              sys.
-00006210: 6578 6974 2827 4541 5359 4d4f 5245 2064  exit('EASYMORE d
-00006220: 6574 6563 7473 2074 6861 7420 616c 6c20  etects that all 
-00006230: 7468 6520 7072 6f76 6964 6564 206e 6574  the provided net
-00006240: 4344 4620 6669 6c65 7320 616e 6420 7661  CDF files and va
-00006250: 7269 6261 6c65 205c 0a68 6173 2064 6966  ribale \.has dif
-00006260: 6665 7265 6e74 2064 696d 656e 7369 6f6e  ferent dimension
-00006270: 7320 666f 7220 7468 6520 7661 7269 6261  s for the variba
-00006280: 6c65 7320 6f72 206c 6174 6974 7564 6520  les or latitude 
-00006290: 616e 6420 6c6f 6e67 6974 7564 6527 290a  and longitude').
-000062a0: 2020 2020 2020 2020 656c 7365 3a0a 2020          else:.  
-000062b0: 2020 2020 2020 2020 2020 7072 696e 7428            print(
-000062c0: 2745 4153 594d 4f52 4520 6465 7465 6374  'EASYMORE detect
-000062d0: 7320 7468 6174 2074 6865 2076 6172 6962  s that the varib
-000062e0: 616c 6573 2066 726f 6d20 7468 6520 6e65  ales from the ne
-000062f0: 7443 4446 2066 696c 6573 2061 7265 2069  tCDF files are i
-00006300: 6465 6e74 6963 616c 5c0a 696e 2064 696d  dentical\.in dim
-00006310: 656e 7369 6f6e 7320 6f66 2074 6865 2076  ensions of the v
-00006320: 6172 6962 616c 6573 2061 6e64 206c 6174  aribales and lat
-00006330: 6974 7564 6520 616e 6420 6c6f 6e67 6974  itude and longit
-00006340: 7564 6527 290a 2020 2020 2020 2020 2020  ude').          
-00006350: 2020 7072 696e 7428 2745 4153 594d 4f52    print('EASYMOR
-00006360: 4520 6465 7465 6374 7320 7468 6174 2061  E detects that a
-00006370: 6c6c 2074 6865 2076 6172 6962 616c 6573  ll the varibales
-00006380: 2068 6176 6520 6469 6d65 6e73 696f 6e73   have dimensions
-00006390: 206f 663a 2729 0a20 2020 2020 2020 2020   of:').         
-000063a0: 2020 2070 7269 6e74 2876 6172 5f64 696d     print(var_dim
-000063b0: 290a 2020 2020 2020 2020 2020 2020 7072  ).            pr
-000063c0: 696e 7428 2745 4153 594d 4f52 4520 6465  int('EASYMORE de
-000063d0: 7465 6374 7320 7468 6174 2074 6865 206c  tects that the l
-000063e0: 6f6e 6769 7475 6465 2076 6172 6962 616c  ongitude varibal
-000063f0: 6573 2068 6173 2064 696d 656e 7369 6f6e  es has dimension
-00006400: 7320 6f66 3a27 290a 2020 2020 2020 2020  s of:').        
-00006410: 2020 2020 7072 696e 7428 6c6f 6e5f 6469      print(lon_di
-00006420: 6d29 0a20 2020 2020 2020 2020 2020 2070  m).            p
-00006430: 7269 6e74 2827 4541 5359 4d4f 5245 2064  rint('EASYMORE d
-00006440: 6574 6563 7473 2074 6861 7420 7468 6520  etects that the 
-00006450: 6c61 7469 7475 6465 2076 6172 6962 616c  latitude varibal
-00006460: 6573 2068 6173 2064 696d 656e 7369 6f6e  es has dimension
-00006470: 7320 6f66 3a27 290a 2020 2020 2020 2020  s of:').        
-00006480: 2020 2020 7072 696e 7428 6c61 745f 6469      print(lat_di
-00006490: 6d29 0a0a 2020 2020 6465 6620 6368 6563  m)..    def chec
-000064a0: 6b5f 736f 7572 6365 5f6e 635f 7368 7020  k_source_nc_shp 
-000064b0: 2873 656c 6629 3a0a 2020 2020 2020 2020  (self):.        
-000064c0: 2222 220a 2020 2020 2020 2020 4020 6175  """.        @ au
-000064d0: 7468 6f72 3a20 2020 2020 2020 2020 2020  thor:           
-000064e0: 2020 2020 2020 2053 6865 7276 616e 2047         Shervan G
-000064f0: 6861 7261 7269 0a20 2020 2020 2020 2040  harari.        @
-00006500: 2047 6974 6875 623a 2020 2020 2020 2020   Github:        
-00006510: 2020 2020 2020 2020 2020 6874 7470 733a            https:
-00006520: 2f2f 6769 7468 7562 2e63 6f6d 2f53 6865  //github.com/She
-00006530: 7276 616e 4768 6172 6172 692f 4541 5359  rvanGharari/EASY
-00006540: 4d4f 5245 0a20 2020 2020 2020 2040 2061  MORE.        @ a
-00006550: 7574 686f 7227 7320 656d 6169 6c20 6964  uthor's email id
-00006560: 3a20 2020 2020 2020 7368 2e67 6861 7261  :       sh.ghara
-00006570: 7269 4067 6d61 696c 2e63 6f6d 0a20 2020  ri@gmail.com.   
-00006580: 2020 2020 2040 206c 6963 656e 7365 3a20       @ license: 
-00006590: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000065a0: 474e 552d 4750 4c76 330a 2020 2020 2020  GNU-GPLv3.      
-000065b0: 2020 5468 6973 2066 756e 6374 696f 6e20    This function 
-000065c0: 6368 6563 6b73 2074 6865 2073 6f75 7263  checks the sourc
-000065d0: 6520 6e65 7463 6466 2066 696c 6520 7368  e netcdf file sh
-000065e0: 6170 6566 696c 650a 2020 2020 2020 2020  apefile.        
-000065f0: 6e65 6564 7320 6d6f 7265 2064 6576 656c  needs more devel
-00006600: 6f70 6d65 6e74 0a20 2020 2020 2020 2022  opment.        "
-00006610: 2222 0a20 2020 2020 2020 2023 206c 6f61  "".        # loa
-00006620: 6420 7468 6520 6e65 6564 6564 2070 6163  d the needed pac
-00006630: 6b61 6765 730a 2020 2020 2020 2020 696d  kages.        im
-00006640: 706f 7274 2067 656f 7061 6e64 6173 2061  port geopandas a
-00006650: 7320 6770 640a 2020 2020 2020 2020 6672  s gpd.        fr
-00006660: 6f6d 2020 2073 6861 7065 6c79 2e67 656f  om   shapely.geo
-00006670: 6d65 7472 7920 696d 706f 7274 2050 6f6c  metry import Pol
-00006680: 7967 6f6e 0a20 2020 2020 2020 2069 6d70  ygon.        imp
-00006690: 6f72 7420 7368 6170 6566 696c 6520 2320  ort shapefile # 
-000066a0: 7079 7368 6564 206c 6962 7261 7279 0a20  pyshed library. 
-000066b0: 2020 2020 2020 2069 6d70 6f72 7420 7368         import sh
-000066c0: 6170 656c 790a 2020 2020 2020 2020 230a  apely.        #.
-000066d0: 2020 2020 2020 2020 6d75 6c74 695f 736f          multi_so
-000066e0: 7572 6365 203d 2046 616c 7365 0a20 2020  urce = False.   
-000066f0: 2020 2020 206e 635f 6e61 6d65 7320 3d20       nc_names = 
-00006700: 676c 6f62 2e67 6c6f 6220 2873 656c 662e  glob.glob (self.
-00006710: 736f 7572 6365 5f6e 6329 0a20 2020 2020  source_nc).     
-00006720: 2020 206e 6369 6420 3d20 6e63 342e 4461     ncid = nc4.Da
-00006730: 7461 7365 7428 6e63 5f6e 616d 6573 5b30  taset(nc_names[0
-00006740: 5d29 0a20 2020 2020 2020 2023 2073 696e  ]).        # sin
-00006750: 6b2f 7461 7267 6574 2073 6861 7065 6669  k/target shapefi
-00006760: 6c65 2069 7320 7768 6174 2077 6520 7761  le is what we wa
-00006770: 6e74 2074 6865 2076 6172 6962 616c 6573  nt the varibales
-00006780: 2074 6f20 6265 2072 656d 6170 7065 6420   to be remapped 
-00006790: 746f 0a20 2020 2020 2020 2073 6870 203d  to.        shp =
-000067a0: 2067 7064 2e72 6561 645f 6669 6c65 2873   gpd.read_file(s
-000067b0: 656c 662e 736f 7572 6365 5f73 6870 290a  elf.source_shp).
-000067c0: 2020 2020 2020 2020 6966 2027 6570 7367          if 'epsg
-000067d0: 3a34 3332 3627 206e 6f74 2069 6e20 7374  :4326' not in st
-000067e0: 7228 7368 702e 6372 7329 2e6c 6f77 6572  r(shp.crs).lower
-000067f0: 2829 3a0a 2020 2020 2020 2020 2020 2020  ():.            
-00006800: 7379 732e 6578 6974 2827 706c 6561 7365  sys.exit('please
-00006810: 2070 726f 6a65 6374 2079 6f75 7220 736f   project your so
-00006820: 7572 6365 2073 6861 7065 6669 6c65 2061  urce shapefile a
-00006830: 6e64 2076 6172 6962 616c 6573 2069 6e20  nd varibales in 
-00006840: 736f 7572 6365 206e 6320 6669 6c65 7320  source nc files 
-00006850: 746f 2057 4753 3834 2028 6570 7367 3a34  to WGS84 (epsg:4
-00006860: 3332 3629 2729 0a20 2020 2020 2020 2065  326)').        e
-00006870: 6c73 653a 2023 2063 6865 636b 2069 6620  lse: # check if 
-00006880: 7468 6520 7072 6f6a 6563 7469 6f6e 2069  the projection i
-00006890: 7320 5747 5338 3420 286f 7220 6570 7367  s WGS84 (or epsg
-000068a0: 3a34 3332 3629 0a20 2020 2020 2020 2020  :4326).         
-000068b0: 2020 2070 7269 6e74 2827 4541 5359 4d4f     print('EASYMO
-000068c0: 5245 2064 6574 6563 7473 2074 6861 7420  RE detects that 
-000068d0: 736f 7572 6365 2073 6861 7065 6669 6c65  source shapefile
-000068e0: 2069 7320 696e 2057 4753 3834 2028 6570   is in WGS84 (ep
-000068f0: 7367 3a34 3332 3629 2729 0a20 2020 2020  sg:4326)').     
-00006900: 2020 2023 2067 6574 2074 6865 206c 6174     # get the lat
-00006910: 2f6c 6f6e 2066 726f 6d20 736f 7572 6365  /lon from source
-00006920: 2073 6861 7066 696c 6520 616e 6420 6e63   shapfile and nc
-00006930: 2066 696c 6573 0a20 2020 2020 2020 206c   files.        l
-00006940: 6174 5f73 6870 203d 206e 702e 6172 7261  at_shp = np.arra
-00006950: 7928 7368 705b 7365 6c66 2e73 6f75 7263  y(shp[self.sourc
-00006960: 655f 7368 705f 6c61 745d 293b 206c 6174  e_shp_lat]); lat
-00006970: 5f73 6870 203d 206c 6174 5f73 6870 2e61  _shp = lat_shp.a
-00006980: 7374 7970 6528 666c 6f61 7429 0a20 2020  stype(float).   
-00006990: 2020 2020 206c 6f6e 5f73 6870 203d 206e       lon_shp = n
-000069a0: 702e 6172 7261 7928 7368 705b 7365 6c66  p.array(shp[self
-000069b0: 2e73 6f75 7263 655f 7368 705f 6c6f 6e5d  .source_shp_lon]
-000069c0: 293b 206c 6f6e 5f73 6870 203d 206c 6f6e  ); lon_shp = lon
-000069d0: 5f73 6870 2e61 7374 7970 6528 666c 6f61  _shp.astype(floa
-000069e0: 7429 0a20 2020 2020 2020 2023 0a20 2020  t).        #.   
-000069f0: 2020 2020 2063 6f6f 7264 5f73 6870 2020       coord_shp  
-00006a00: 2020 2020 2020 203d 2070 642e 4461 7461         = pd.Data
-00006a10: 4672 616d 6528 290a 2020 2020 2020 2020  Frame().        
-00006a20: 636f 6f72 645f 7368 7020 5b27 6c6f 6e27  coord_shp ['lon'
-00006a30: 5d20 3d20 6c6f 6e5f 7368 700a 2020 2020  ] = lon_shp.    
-00006a40: 2020 2020 636f 6f72 645f 7368 7020 5b27      coord_shp ['
-00006a50: 6c61 7427 5d20 3d20 6c61 745f 7368 700a  lat'] = lat_shp.
-00006a60: 2020 2020 2020 2020 636f 6f72 645f 7368          coord_sh
-00006a70: 7020 2020 2020 2020 2020 3d20 636f 6f72  p         = coor
-00006a80: 645f 7368 702e 736f 7274 5f76 616c 7565  d_shp.sort_value
-00006a90: 7328 6279 3d27 6c6f 6e27 290a 2020 2020  s(by='lon').    
-00006aa0: 2020 2020 636f 6f72 645f 7368 7020 2020      coord_shp   
-00006ab0: 2020 2020 2020 3d20 636f 6f72 645f 7368        = coord_sh
-00006ac0: 702e 736f 7274 5f76 616c 7565 7328 6279  p.sort_values(by
-00006ad0: 3d27 6c61 7427 290a 2020 2020 2020 2020  ='lat').        
-00006ae0: 2320 6368 6563 6b20 6966 2061 6c6c 2074  # check if all t
-00006af0: 6865 206c 6174 2f6c 6f6e 2069 6e20 7368  he lat/lon in sh
-00006b00: 6170 6566 696c 6520 6172 6520 756e 6971  apefile are uniq
-00006b10: 7565 0a20 2020 2020 2020 2064 665f 7465  ue.        df_te
-00006b20: 6d70 2020 2020 2020 2020 2020 203d 2063  mp           = c
-00006b30: 6f6f 7264 5f73 6870 2e64 726f 705f 6475  oord_shp.drop_du
-00006b40: 706c 6963 6174 6573 2829 0a20 2020 2020  plicates().     
-00006b50: 2020 2069 6620 6c65 6e28 6466 5f74 656d     if len(df_tem
-00006b60: 7029 2020 213d 206c 656e 2863 6f6f 7264  p)  != len(coord
-00006b70: 5f73 6870 293a 0a20 2020 2020 2020 2020  _shp):.         
-00006b80: 2020 2023 2070 7269 6e74 0a20 2020 2020     # print.     
-00006b90: 2020 2020 2020 2073 7973 2e65 7869 7428         sys.exit(
-00006ba0: 2754 6865 206c 6174 6974 7564 6520 616e  'The latitude an
-00006bb0: 6420 6c6f 6e67 6974 7564 6520 696e 2073  d longitude in s
-00006bc0: 6f75 7263 6520 7368 6170 6566 696c 6520  ource shapefile 
-00006bd0: 6172 6520 6e6f 7420 756e 6971 7565 2729  are not unique')
-00006be0: 0a20 2020 2020 2020 2023 2066 6972 7374  .        # first
-00006bf0: 2063 6865 636b 2074 6865 206d 6f64 656c   check the model
-00006c00: 0a20 2020 2020 2020 2063 6f6f 7264 5f6e  .        coord_n
-00006c10: 6320 2020 2020 2020 2020 203d 2070 642e  c          = pd.
-00006c20: 4461 7461 4672 616d 6528 290a 2020 2020  DataFrame().    
-00006c30: 2020 2020 636f 6f72 645f 6e63 2020 5b27      coord_nc  ['
-00006c40: 6c6f 6e27 5d20 3d20 7365 6c66 2e6c 6f6e  lon'] = self.lon
-00006c50: 0a20 2020 2020 2020 2063 6f6f 7264 5f6e  .        coord_n
-00006c60: 6320 205b 276c 6174 275d 203d 2073 656c  c  ['lat'] = sel
-00006c70: 662e 6c61 740a 2020 2020 2020 2020 636f  f.lat.        co
-00006c80: 6f72 645f 6e63 2020 2020 2020 2020 2020  ord_nc          
-00006c90: 3d20 636f 6f72 645f 6e63 2e73 6f72 745f  = coord_nc.sort_
-00006ca0: 7661 6c75 6573 2862 793d 276c 6f6e 2729  values(by='lon')
-00006cb0: 0a20 2020 2020 2020 2063 6f6f 7264 5f6e  .        coord_n
-00006cc0: 6320 2020 2020 2020 2020 203d 2063 6f6f  c          = coo
-00006cd0: 7264 5f6e 632e 736f 7274 5f76 616c 7565  rd_nc.sort_value
-00006ce0: 7328 6279 3d27 6c61 7427 290a 2020 2020  s(by='lat').    
-00006cf0: 2020 2020 2320 6368 6563 6b20 6966 2061      # check if a
-00006d00: 6c6c 2074 6865 206c 6174 2f6c 6f6e 2069  ll the lat/lon i
-00006d10: 6e20 7368 6170 6566 696c 6520 6172 6520  n shapefile are 
-00006d20: 756e 6971 7565 0a20 2020 2020 2020 2064  unique.        d
-00006d30: 665f 7465 6d70 2020 2020 2020 2020 2020  f_temp          
-00006d40: 203d 2063 6f6f 7264 5f6e 632e 6472 6f70   = coord_nc.drop
-00006d50: 5f64 7570 6c69 6361 7465 7328 290a 2020  _duplicates().  
-00006d60: 2020 2020 2020 6966 206c 656e 2864 665f        if len(df_
-00006d70: 7465 6d70 2920 2021 3d20 6c65 6e28 636f  temp)  != len(co
-00006d80: 6f72 645f 6e63 293a 0a20 2020 2020 2020  ord_nc):.       
-00006d90: 2020 2020 2023 2070 7269 6e74 0a20 2020       # print.   
-00006da0: 2020 2020 2020 2020 2023 7379 732e 6578           #sys.ex
-00006db0: 6974 2827 5468 6520 6c61 7469 7475 6465  it('The latitude
-00006dc0: 2061 6e64 206c 6f6e 6769 7475 6465 2069   and longitude i
-00006dd0: 6e20 736f 7572 6365 204e 6574 4344 4620  n source NetCDF 
-00006de0: 6669 6c65 7320 6172 6520 6e6f 7420 756e  files are not un
-00006df0: 6971 7565 2729 0a20 2020 2020 2020 2020  ique').         
-00006e00: 2020 2070 7269 6e74 2827 5468 6520 6c61     print('The la
-00006e10: 7469 7475 6465 2061 6e64 206c 6f6e 6769  titude and longi
-00006e20: 7475 6465 2069 6e20 736f 7572 6365 204e  tude in source N
-00006e30: 6574 4344 4620 6669 6c65 7320 6172 6520  etCDF files are 
-00006e40: 6e6f 7420 756e 6971 7565 2729 0a20 2020  not unique').   
-00006e50: 2020 2020 2023 2063 6865 636b 2069 6620       # check if 
-00006e60: 7468 6520 6c61 7469 7475 6465 2061 6e64  the latitude and
-00006e70: 206c 6f6e 6769 7475 6465 2069 6e20 7468   longitude in th
-00006e80: 6520 7368 6170 6566 696c 6573 2061 7265  e shapefiles are
-00006e90: 2069 6e20 7468 6520 6e63 2066 696c 650a   in the nc file.
-00006ea0: 2020 2020 2020 2020 2320 636f 6f72 645f          # coord_
-00006eb0: 6e63 5f74 656d 7020 2020 2020 3d20 6e70  nc_temp     = np
-00006ec0: 2e61 7272 6179 2863 6f6f 7264 5f6e 6329  .array(coord_nc)
-00006ed0: 0a20 2020 2020 2020 2023 2066 6f72 2069  .        # for i
-00006ee0: 6e64 6578 2c20 726f 7720 696e 2063 6f6f  ndex, row in coo
-00006ef0: 7264 5f73 6870 2e69 7465 7272 6f77 7328  rd_shp.iterrows(
-00006f00: 293a 0a20 2020 2020 2020 2023 2020 2020  ):.        #    
-00006f10: 2023 2067 6574 2074 6865 2064 6973 7461   # get the dista
-00006f20: 6e63 650a 2020 2020 2020 2020 2320 2020  nce.        #   
-00006f30: 2020 6c61 745f 7461 7267 6574 203d 2072    lat_target = r
-00006f40: 6f77 2e6c 6174 0a20 2020 2020 2020 2023  ow.lat.        #
-00006f50: 2020 2020 206c 6f6e 5f74 6172 6765 7420       lon_target 
-00006f60: 3d20 726f 772e 6c6f 6e0a 2020 2020 2020  = row.lon.      
-00006f70: 2020 2320 2020 2020 4469 7374 203d 206e    #     Dist = n
-00006f80: 702e 6172 7261 7928 2828 636f 6f72 645f  p.array(((coord_
-00006f90: 6e63 5f74 656d 705b 3a2c 315d 202d 206c  nc_temp[:,1] - l
-00006fa0: 6174 5f74 6172 6765 7429 2a2a 3220 2b5c  at_target)**2 +\
-00006fb0: 0a20 2020 2020 2020 2023 2020 2020 2020  .        #      
-00006fc0: 2020 2028 636f 6f72 645f 6e63 5f74 656d     (coord_nc_tem
-00006fd0: 705b 3a2c 305d 202d 206c 6f6e 5f74 6172  p[:,0] - lon_tar
-00006fe0: 6765 7429 2a2a 3229 2a2a 302e 3529 0a20  get)**2)**0.5). 
-00006ff0: 2020 2020 2020 2023 2020 2020 2069 6478         #     idx
-00007000: 5f74 6172 6765 7420 3d20 6e70 2e77 6865  _target = np.whe
-00007010: 7265 2844 6973 743c 7365 6c66 2e74 6f6c  re(Dist<self.tol
-00007020: 6572 616e 6365 290a 2020 2020 2020 2020  erance).        
-00007030: 2320 2020 2020 6964 785f 7461 7267 6574  #     idx_target
-00007040: 203d 206e 702e 6172 7261 7928 6964 785f   = np.array(idx_
-00007050: 7461 7267 6574 290a 2020 2020 2020 2020  target).        
-00007060: 2320 2020 2020 6964 785f 7461 7267 6574  #     idx_target
-00007070: 203d 2069 6478 5f74 6172 6765 742e 666c   = idx_target.fl
-00007080: 6174 7465 6e28 290a 2020 2020 2020 2020  atten().        
-00007090: 2320 2020 2020 6966 2069 6478 5f74 6172  #     if idx_tar
-000070a0: 6765 742e 7368 6170 655b 305d 203e 2031  get.shape[0] > 1
-000070b0: 3a0a 2020 2020 2020 2020 2320 2020 2020  :.        #     
-000070c0: 2020 2020 6d75 6c74 695f 736f 7572 6365      multi_source
-000070d0: 203d 2054 7275 650a 2020 2020 2020 2020   = True.        
-000070e0: 2320 2020 2020 2020 2020 2369 6478 5f74  #         #idx_t
-000070f0: 6172 6765 7420 2020 203d 206d 6178 2028  arget    = max (
-00007100: 6964 785f 7461 7267 6574 5b30 5d2d 3130  idx_target[0]-10
-00007110: 3030 2c30 290a 2020 2020 2020 2020 2320  00,0).        # 
-00007120: 2020 2020 2020 2020 2373 7973 2e65 7869          #sys.exi
-00007130: 7428 2754 6865 7265 2061 7265 206d 756c  t('There are mul
-00007140: 7469 706c 6520 7368 6170 6520 696e 2073  tiple shape in s
-00007150: 6f75 7263 6520 7368 6170 6566 696c 6520  ource shapefile 
-00007160: 7468 6174 2069 7320 636c 6f73 6572 2074  that is closer t
-00007170: 6f20 7072 6f76 6964 6564 206e 6574 4344  o provided netCD
-00007180: 4620 6c61 7469 7475 6465 2061 6e64 206c  F latitude and l
-00007190: 6f6e 6769 7475 6465 2729 0a20 2020 2020  ongitude').     
-000071a0: 2020 2023 2020 2020 2069 6620 6964 785f     #     if idx_
-000071b0: 7461 7267 6574 2e73 6861 7065 5b30 5d20  target.shape[0] 
-000071c0: 3d3d 2031 3a0a 2020 2020 2020 2020 2320  == 1:.        # 
-000071d0: 2020 2020 2020 2020 6964 785f 7461 7267          idx_targ
-000071e0: 6574 203d 2069 6478 5f74 6172 6765 742e  et = idx_target.
-000071f0: 6974 656d 2829 0a20 2020 2020 2020 2023  item().        #
-00007200: 2020 2020 2020 2020 2069 6478 5f74 6172           idx_tar
-00007210: 6765 7420 2020 203d 206d 6178 2028 6964  get    = max (id
-00007220: 785f 7461 7267 6574 2d31 3030 302c 3029  x_target-1000,0)
-00007230: 0a20 2020 2020 2020 2023 2020 2020 2070  .        #     p
-00007240: 7269 6e74 2869 6478 5f74 6172 6765 7429  rint(idx_target)
-00007250: 0a20 2020 2020 2020 2023 2020 2020 2063  .        #     c
-00007260: 6f6f 7264 5f6e 635f 7465 6d70 203d 2063  oord_nc_temp = c
-00007270: 6f6f 7264 5f6e 635f 7465 6d70 5b69 6478  oord_nc_temp[idx
-00007280: 5f74 6172 6765 743a 5d20 2320 6375 7420  _target:] # cut 
-00007290: 7468 650a 2020 2020 2020 2020 2320 6966  the.        # if
-000072a0: 206d 756c 7469 5f73 6f75 7263 653a 0a20   multi_source:. 
-000072b0: 2020 2020 2020 2023 2020 2020 2070 7269         #     pri
-000072c0: 6e74 2827 5468 6572 6520 6172 6520 6d75  nt('There are mu
-000072d0: 6c74 6970 6c65 2073 6861 7065 2069 6e20  ltiple shape in 
-000072e0: 736f 7572 6365 2073 6861 7065 6669 6c65  source shapefile
-000072f0: 2074 6861 7420 6973 2063 6c6f 7365 7220   that is closer 
-00007300: 746f 2070 726f 7669 6465 6420 6e65 7443  to provided netC
-00007310: 4446 206c 6174 6974 7564 6520 616e 6420  DF latitude and 
-00007320: 6c6f 6e67 6974 7564 6527 290a 0a20 2020  longitude')..   
-00007330: 2064 6566 204e 6574 4344 465f 5348 505f   def NetCDF_SHP_
-00007340: 6c61 745f 6c6f 6e28 7365 6c66 293a 0a20  lat_lon(self):. 
-00007350: 2020 2020 2020 2022 2222 0a20 2020 2020         """.     
-00007360: 2020 2040 2061 7574 686f 723a 2020 2020     @ author:    
-00007370: 2020 2020 2020 2020 2020 2020 2020 5368                Sh
-00007380: 6572 7661 6e20 4768 6172 6172 690a 2020  ervan Gharari.  
-00007390: 2020 2020 2020 4020 4769 7468 7562 3a20        @ Github: 
-000073a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000073b0: 2068 7474 7073 3a2f 2f67 6974 6875 622e   https://github.
-000073c0: 636f 6d2f 5368 6572 7661 6e47 6861 7261  com/ShervanGhara
-000073d0: 7269 2f45 4153 594d 4f52 450a 2020 2020  ri/EASYMORE.    
-000073e0: 2020 2020 4020 6175 7468 6f72 2773 2065      @ author's e
-000073f0: 6d61 696c 2069 643a 2020 2020 2020 2073  mail id:       s
-00007400: 682e 6768 6172 6172 6940 676d 6169 6c2e  h.gharari@gmail.
-00007410: 636f 6d0a 2020 2020 2020 2020 4020 6c69  com.        @ li
-00007420: 6365 6e73 653a 2020 2020 2020 2020 2020  cense:          
-00007430: 2020 2020 2020 2047 4e55 2d47 504c 7633         GNU-GPLv3
-00007440: 0a20 2020 2020 2020 2054 6869 7320 6675  .        This fu
-00007450: 6e63 7469 6f6e 2063 6865 636b 7320 6469  nction checks di
-00007460: 6d65 6e73 696f 6e20 6f66 2074 6865 2073  mension of the s
-00007470: 6f75 7263 6520 7368 6170 6566 696c 6520  ource shapefile 
-00007480: 616e 6420 6368 6563 6b73 2074 6865 2063  and checks the c
-00007490: 6173 6520 6f66 2072 6567 756c 6172 2c20  ase of regular, 
-000074a0: 726f 7461 7465 642c 2061 6e64 2069 7272  rotated, and irr
-000074b0: 6567 756c 6172 0a20 2020 2020 2020 2061  egular.        a
-000074c0: 6c73 6f20 6372 6561 7465 6420 7468 6520  lso created the 
-000074d0: 3244 2061 7272 6179 206f 6620 6c61 7420  2D array of lat 
-000074e0: 616e 6420 6c6f 6e20 666f 7220 6372 6561  and lon for crea
-000074f0: 7469 6e67 2074 6865 2073 6861 7065 6669  ting the shapefi
-00007500: 6c65 0a20 2020 2020 2020 2022 2222 0a20  le.        """. 
-00007510: 2020 2020 2020 2069 6d70 6f72 7420 6765         import ge
-00007520: 6f70 616e 6461 7320 6173 2067 7064 0a20  opandas as gpd. 
-00007530: 2020 2020 2020 2066 726f 6d20 2020 7368         from   sh
-00007540: 6170 656c 792e 6765 6f6d 6574 7279 2069  apely.geometry i
-00007550: 6d70 6f72 7420 506f 6c79 676f 6e0a 2020  mport Polygon.  
-00007560: 2020 2020 2020 696d 706f 7274 2073 6861        import sha
-00007570: 7065 6669 6c65 2023 2070 7973 6865 6420  pefile # pyshed 
-00007580: 6c69 6272 6172 790a 2020 2020 2020 2020  library.        
-00007590: 696d 706f 7274 2073 6861 7065 6c79 0a20  import shapely. 
-000075a0: 2020 2020 2020 2023 0a20 2020 2020 2020         #.       
-000075b0: 206e 635f 6e61 6d65 7320 3d20 676c 6f62   nc_names = glob
-000075c0: 2e67 6c6f 6220 2873 656c 662e 736f 7572  .glob (self.sour
-000075d0: 6365 5f6e 6329 0a20 2020 2020 2020 2076  ce_nc).        v
-000075e0: 6172 5f6e 616d 6520 3d20 7365 6c66 2e76  ar_name = self.v
-000075f0: 6172 5f6e 616d 6573 5b30 5d0a 2020 2020  ar_names[0].    
-00007600: 2020 2020 2320 6f70 656e 2074 6865 206e      # open the n
-00007610: 6320 6669 6c65 2074 6f20 7265 6164 0a20  c file to read. 
-00007620: 2020 2020 2020 206e 6369 6420 3d20 6e63         ncid = nc
-00007630: 342e 4461 7461 7365 7428 6e63 5f6e 616d  4.Dataset(nc_nam
-00007640: 6573 5b30 5d29 0a20 2020 2020 2020 2023  es[0]).        #
-00007650: 2064 6563 6964 696e 6720 7768 6963 6820   deciding which 
-00007660: 6361 7365 0a20 2020 2020 2020 2023 2063  case.        # c
-00007670: 6173 6520 2331 2072 6567 756c 6172 206c  ase #1 regular l
-00007680: 6174 6974 7564 652f 6c6f 6e67 6974 7564  atitude/longitud
-00007690: 650a 2020 2020 2020 2020 6966 2028 6c65  e.        if (le
-000076a0: 6e28 6e63 6964 2e76 6172 6961 626c 6573  n(ncid.variables
-000076b0: 5b73 656c 662e 7661 725f 6c6f 6e5d 2e64  [self.var_lon].d
-000076c0: 696d 656e 7369 6f6e 7329 3d3d 3129 2061  imensions)==1) a
-000076d0: 6e64 5c0a 2020 2020 2020 2020 286c 656e  nd\.        (len
-000076e0: 286e 6369 642e 7661 7269 6162 6c65 735b  (ncid.variables[
-000076f0: 7365 6c66 2e76 6172 5f6c 6f6e 5d2e 6469  self.var_lon].di
-00007700: 6d65 6e73 696f 6e73 293d 3d31 2920 616e  mensions)==1) an
-00007710: 645c 0a20 2020 2020 2020 2028 6c65 6e28  d\.        (len(
-00007720: 6e63 6964 2e76 6172 6961 626c 6573 5b73  ncid.variables[s
-00007730: 656c 662e 7661 725f 6e61 6d65 735b 305d  elf.var_names[0]
-00007740: 5d2e 6469 6d65 6e73 696f 6e73 293d 3d33  ].dimensions)==3
-00007750: 293a 0a20 2020 2020 2020 2020 2020 2070  ):.            p
-00007760: 7269 6e74 2827 4541 5359 4d4f 5245 2064  rint('EASYMORE d
-00007770: 6574 6563 7473 2063 6173 6520 3120 2d20  etects case 1 - 
-00007780: 7265 6775 6c61 7220 6c61 742f 6c6f 6e27  regular lat/lon'
-00007790: 290a 2020 2020 2020 2020 2020 2020 7365  ).            se
-000077a0: 6c66 2e63 6173 6520 3d20 310a 2020 2020  lf.case = 1.    
-000077b0: 2020 2020 2020 2020 2320 6765 7420 7468          # get th
-000077c0: 6520 6c69 7374 206f 6620 6469 6d65 6e73  e list of dimens
-000077d0: 696f 6e73 2066 6f72 2074 6865 206e 6369  ions for the nci
-000077e0: 6420 7361 6d70 6c65 2076 6172 6962 616c  d sample varibal
-000077f0: 650a 2020 2020 2020 2020 2020 2020 6c69  e.            li
-00007800: 7374 5f64 696d 5f6e 616d 6520 3d20 6c69  st_dim_name = li
-00007810: 7374 286e 6369 642e 7661 7269 6162 6c65  st(ncid.variable
-00007820: 735b 7365 6c66 2e76 6172 5f6e 616d 6573  s[self.var_names
-00007830: 5b30 5d5d 2e64 696d 656e 7369 6f6e 7329  [0]].dimensions)
-00007840: 0a20 2020 2020 2020 2020 2020 2023 2067  .            # g
-00007850: 6574 2074 6865 206c 6f63 6174 696f 6e20  et the location 
-00007860: 6f66 206c 6174 2064 696d 656e 7369 6f6e  of lat dimension
-00007870: 730a 2020 2020 2020 2020 2020 2020 6c6f  s.            lo
-00007880: 6361 7469 6f6e 5f6f 665f 6c61 7420 3d20  cation_of_lat = 
-00007890: 6c69 7374 5f64 696d 5f6e 616d 652e 696e  list_dim_name.in
-000078a0: 6465 7828 6c69 7374 286e 6369 642e 7661  dex(list(ncid.va
-000078b0: 7269 6162 6c65 735b 7365 6c66 2e76 6172  riables[self.var
-000078c0: 5f6c 6174 5d2e 6469 6d65 6e73 696f 6e73  _lat].dimensions
-000078d0: 295b 305d 290a 2020 2020 2020 2020 2020  )[0]).          
-000078e0: 2020 6c6f 6361 6974 6f6e 5f6f 665f 6c6f    locaiton_of_lo
-000078f0: 6e20 3d20 6c69 7374 5f64 696d 5f6e 616d  n = list_dim_nam
-00007900: 652e 696e 6465 7828 6c69 7374 286e 6369  e.index(list(nci
-00007910: 642e 7661 7269 6162 6c65 735b 7365 6c66  d.variables[self
-00007920: 2e76 6172 5f6c 6f6e 5d2e 6469 6d65 6e73  .var_lon].dimens
-00007930: 696f 6e73 295b 305d 290a 2020 2020 2020  ions)[0]).      
-00007940: 2020 2020 2020 2320 6465 7420 7468 6520        # det the 
-00007950: 6469 6d65 6e73 696f 6e73 206f 6620 6c61  dimensions of la
-00007960: 7420 616e 6420 6c6f 6e0a 2020 2020 2020  t and lon.      
-00007970: 2020 2020 2020 6c65 6e5f 6f66 5f6c 6174        len_of_lat
-00007980: 203d 206c 656e 286e 6369 642e 7661 7269   = len(ncid.vari
-00007990: 6162 6c65 735b 7365 6c66 2e76 6172 5f6c  ables[self.var_l
-000079a0: 6174 5d5b 3a5d 290a 2020 2020 2020 2020  at][:]).        
-000079b0: 2020 2020 6c65 6e5f 6f66 5f6c 6f6e 203d      len_of_lon =
-000079c0: 206c 656e 286e 6369 642e 7661 7269 6162   len(ncid.variab
-000079d0: 6c65 735b 7365 6c66 2e76 6172 5f6c 6f6e  les[self.var_lon
-000079e0: 5d5b 3a5d 290a 2020 2020 2020 2020 2020  ][:]).          
-000079f0: 2020 6966 206c 6f63 6169 746f 6e5f 6f66    if locaiton_of
-00007a00: 5f6c 6f6e 203e 206c 6f63 6174 696f 6e5f  _lon > location_
-00007a10: 6f66 5f6c 6174 3a0a 2020 2020 2020 2020  of_lat:.        
-00007a20: 2020 2020 2020 2020 6c61 7420 3d20 6e70          lat = np
-00007a30: 2e7a 6572 6f73 285b 6c65 6e5f 6f66 5f6c  .zeros([len_of_l
-00007a40: 6174 2c20 6c65 6e5f 6f66 5f6c 6f6e 5d29  at, len_of_lon])
-00007a50: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00007a60: 206c 6f6e 203d 206e 702e 7a65 726f 7328   lon = np.zeros(
-00007a70: 5b6c 656e 5f6f 665f 6c61 742c 206c 656e  [len_of_lat, len
-00007a80: 5f6f 665f 6c6f 6e5d 290a 2020 2020 2020  _of_lon]).      
-00007a90: 2020 2020 2020 2020 2020 666f 7220 6920            for i 
-00007aa0: 696e 206e 702e 6172 616e 6765 286c 656e  in np.arange(len
-00007ab0: 286e 6369 642e 7661 7269 6162 6c65 735b  (ncid.variables[
-00007ac0: 7365 6c66 2e76 6172 5f6c 6f6e 5d5b 3a5d  self.var_lon][:]
-00007ad0: 2929 3a0a 2020 2020 2020 2020 2020 2020  )):.            
-00007ae0: 2020 2020 2020 2020 6c61 7420 5b3a 2c69          lat [:,i
-00007af0: 5d20 3d20 6e63 6964 2e76 6172 6961 626c  ] = ncid.variabl
-00007b00: 6573 5b73 656c 662e 7661 725f 6c61 745d  es[self.var_lat]
-00007b10: 5b3a 5d0a 2020 2020 2020 2020 2020 2020  [:].            
-00007b20: 2020 2020 666f 7220 6920 696e 206e 702e      for i in np.
-00007b30: 6172 616e 6765 286c 656e 286e 6369 642e  arange(len(ncid.
-00007b40: 7661 7269 6162 6c65 735b 7365 6c66 2e76  variables[self.v
-00007b50: 6172 5f6c 6174 5d5b 3a5d 2929 3a0a 2020  ar_lat][:])):.  
-00007b60: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00007b70: 2020 6c6f 6e20 5b69 2c3a 5d20 3d20 6e63    lon [i,:] = nc
-00007b80: 6964 2e76 6172 6961 626c 6573 5b73 656c  id.variables[sel
-00007b90: 662e 7661 725f 6c6f 6e5d 5b3a 5d0a 2020  f.var_lon][:].  
-00007ba0: 2020 2020 2020 2020 2020 656c 7365 3a0a            else:.
-00007bb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00007bc0: 6c61 7420 3d20 6e70 2e7a 6572 6f73 285b  lat = np.zeros([
-00007bd0: 6c65 6e5f 6f66 5f6c 6f6e 2c20 6c65 6e5f  len_of_lon, len_
-00007be0: 6f66 5f6c 6174 5d29 0a20 2020 2020 2020  of_lat]).       
-00007bf0: 2020 2020 2020 2020 206c 6f6e 203d 206e           lon = n
-00007c00: 702e 7a65 726f 7328 5b6c 656e 5f6f 665f  p.zeros([len_of_
-00007c10: 6c6f 6e2c 206c 656e 5f6f 665f 6c61 745d  lon, len_of_lat]
-00007c20: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
-00007c30: 2020 666f 7220 6920 696e 206e 702e 6172    for i in np.ar
-00007c40: 616e 6765 286c 656e 286e 6369 642e 7661  ange(len(ncid.va
-00007c50: 7269 6162 6c65 735b 7365 6c66 2e76 6172  riables[self.var
-00007c60: 5f6c 6f6e 5d5b 3a5d 2929 3a0a 2020 2020  _lon][:])):.    
-00007c70: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00007c80: 6c61 7420 5b69 2c3a 5d20 3d20 6e63 6964  lat [i,:] = ncid
-00007c90: 2e76 6172 6961 626c 6573 5b73 656c 662e  .variables[self.
-00007ca0: 7661 725f 6c61 745d 5b3a 5d0a 2020 2020  var_lat][:].    
-00007cb0: 2020 2020 2020 2020 2020 2020 666f 7220              for 
-00007cc0: 6920 696e 206e 702e 6172 616e 6765 286c  i in np.arange(l
-00007cd0: 656e 286e 6369 642e 7661 7269 6162 6c65  en(ncid.variable
-00007ce0: 735b 7365 6c66 2e76 6172 5f6c 6174 5d5b  s[self.var_lat][
-00007cf0: 3a5d 2929 3a0a 2020 2020 2020 2020 2020  :])):.          
-00007d00: 2020 2020 2020 2020 2020 6c6f 6e20 5b3a            lon [:
-00007d10: 2c69 5d20 3d20 6e63 6964 2e76 6172 6961  ,i] = ncid.varia
-00007d20: 626c 6573 5b73 656c 662e 7661 725f 6c6f  bles[self.var_lo
-00007d30: 6e5d 5b3a 5d0a 2020 2020 2020 2020 2020  n][:].          
-00007d40: 2020 2320 6368 6563 6b20 6966 206c 6174    # check if lat
-00007d50: 2061 6e64 206c 6f6e 2061 7265 2073 7061   and lon are spa
-00007d60: 6365 6420 6571 7561 6c6c 790a 2020 2020  ced equally.    
-00007d70: 2020 2020 2020 2020 6c61 745f 7465 6d70          lat_temp
-00007d80: 203d 206e 702e 6172 7261 7928 6e63 6964   = np.array(ncid
-00007d90: 2e76 6172 6961 626c 6573 5b73 656c 662e  .variables[self.
-00007da0: 7661 725f 6c61 745d 5b3a 5d29 0a20 2020  var_lat][:]).   
-00007db0: 2020 2020 2020 2020 206c 6174 5f74 656d           lat_tem
-00007dc0: 705f 6469 6666 203d 206e 702e 6469 6666  p_diff = np.diff
-00007dd0: 286c 6174 5f74 656d 7029 0a20 2020 2020  (lat_temp).     
-00007de0: 2020 2020 2020 206c 6174 5f74 656d 705f         lat_temp_
-00007df0: 6469 6666 5f32 203d 206e 702e 6469 6666  diff_2 = np.diff
-00007e00: 286c 6174 5f74 656d 705f 6469 6666 290a  (lat_temp_diff).
-00007e10: 2020 2020 2020 2020 2020 2020 6d61 785f              max_
-00007e20: 6c61 745f 7465 6d70 5f64 6966 665f 3220  lat_temp_diff_2 
-00007e30: 3d20 6d61 7828 6162 7328 6c61 745f 7465  = max(abs(lat_te
-00007e40: 6d70 5f64 6966 665f 3229 290a 2020 2020  mp_diff_2)).    
-00007e50: 2020 2020 2020 2020 7072 696e 7428 276d          print('m
-00007e60: 6178 2064 6966 6665 7265 6e63 6520 6f66  ax difference of
-00007e70: 206c 6174 2076 616c 7565 7320 696e 2073   lat values in s
-00007e80: 6f75 7263 6520 6e63 2066 696c 6573 2061  ource nc files a
-00007e90: 7265 203a 2027 2c20 6d61 785f 6c61 745f  re : ', max_lat_
-00007ea0: 7465 6d70 5f64 6966 665f 3229 0a20 2020  temp_diff_2).   
-00007eb0: 2020 2020 2020 2020 206c 6f6e 5f74 656d           lon_tem
-00007ec0: 7020 3d20 6e70 2e61 7272 6179 286e 6369  p = np.array(nci
-00007ed0: 642e 7661 7269 6162 6c65 735b 7365 6c66  d.variables[self
-00007ee0: 2e76 6172 5f6c 6f6e 5d5b 3a5d 290a 2020  .var_lon][:]).  
-00007ef0: 2020 2020 2020 2020 2020 6c6f 6e5f 7465            lon_te
-00007f00: 6d70 5f64 6966 6620 3d20 6e70 2e64 6966  mp_diff = np.dif
-00007f10: 6628 6c6f 6e5f 7465 6d70 290a 2020 2020  f(lon_temp).    
-00007f20: 2020 2020 2020 2020 6c6f 6e5f 7465 6d70          lon_temp
-00007f30: 5f64 6966 665f 3220 3d20 6e70 2e64 6966  _diff_2 = np.dif
-00007f40: 6628 6c6f 6e5f 7465 6d70 5f64 6966 6629  f(lon_temp_diff)
-00007f50: 0a20 2020 2020 2020 2020 2020 206d 6178  .            max
-00007f60: 5f6c 6f6e 5f74 656d 705f 6469 6666 5f32  _lon_temp_diff_2
-00007f70: 203d 206d 6178 2861 6273 286c 6f6e 5f74   = max(abs(lon_t
-00007f80: 656d 705f 6469 6666 5f32 2929 0a20 2020  emp_diff_2)).   
-00007f90: 2020 2020 2020 2020 2070 7269 6e74 2827           print('
-00007fa0: 6d61 7820 6469 6666 6572 656e 6365 206f  max difference o
-00007fb0: 6620 6c6f 6e20 7661 6c75 6573 2069 6e20  f lon values in 
-00007fc0: 736f 7572 6365 206e 6320 6669 6c65 7320  source nc files 
-00007fd0: 6172 6520 3a20 272c 206d 6178 5f6c 6f6e  are : ', max_lon
-00007fe0: 5f74 656d 705f 6469 6666 5f32 290a 2020  _temp_diff_2).  
-00007ff0: 2020 2020 2020 2020 2020 2320 7361 7665            # save
-00008000: 206c 6174 2c20 6c6f 6e20 696e 746f 2074   lat, lon into t
-00008010: 6865 206f 626a 6563 740a 2020 2020 2020  he object.      
-00008020: 2020 2020 2020 6c61 7420 2020 2020 203d        lat      =
-00008030: 206e 702e 6172 7261 7928 6c61 7429 2e61   np.array(lat).a
-00008040: 7374 7970 6528 666c 6f61 7429 0a20 2020  stype(float).   
-00008050: 2020 2020 2020 2020 206c 6f6e 2020 2020           lon    
-00008060: 2020 3d20 6e70 2e61 7272 6179 286c 6f6e    = np.array(lon
-00008070: 292e 6173 7479 7065 2866 6c6f 6174 290a  ).astype(float).
-00008080: 2020 2020 2020 2020 2020 2020 7365 6c66              self
-00008090: 2e6c 6174 203d 206c 6174 0a20 2020 2020  .lat = lat.     
-000080a0: 2020 2020 2020 2073 656c 662e 6c6f 6e20         self.lon 
-000080b0: 3d20 6c6f 6e0a 2020 2020 2020 2020 2020  = lon.          
-000080c0: 2020 2320 6578 7061 6e64 696e 6720 6a75    # expanding ju
-000080d0: 7374 2066 6f72 2074 6865 2074 6865 2063  st for the the c
-000080e0: 7265 6174 696f 6e20 6f66 2073 6861 7065  reation of shape
-000080f0: 6669 6c65 2077 6974 6820 6669 7273 7420  file with first 
-00008100: 6c61 7374 2072 6f77 7320 616e 6420 636f  last rows and co
-00008110: 6c75 6d6e 730a 2020 2020 2020 2020 2020  lumns.          
-00008120: 2020 6966 2028 6d61 785f 6c61 745f 7465    if (max_lat_te
-00008130: 6d70 5f64 6966 665f 323c 7365 6c66 2e74  mp_diff_2<self.t
-00008140: 6f6c 6572 616e 6365 2920 616e 6420 286d  olerance) and (m
-00008150: 6178 5f6c 6f6e 5f74 656d 705f 6469 6666  ax_lon_temp_diff
-00008160: 5f32 3c73 656c 662e 746f 6c65 7261 6e63  _2<self.toleranc
-00008170: 6529 3a20 2320 7468 656e 206c 6174 206c  e): # then lat l
-00008180: 6f6e 2061 7265 2073 7061 6365 6420 6571  on are spaced eq
-00008190: 7561 6c0a 2020 2020 2020 2020 2020 2020  ual.            
-000081a0: 2020 2020 2320 6372 6561 7465 2065 7870      # create exp
-000081b0: 616e 6465 6420 6c61 740a 2020 2020 2020  anded lat.      
-000081c0: 2020 2020 2020 2020 2020 6c61 745f 6578            lat_ex
-000081d0: 7061 6e64 6564 203d 206e 702e 7a65 726f  panded = np.zero
-000081e0: 7328 6e70 2e61 7272 6179 286c 6174 2e73  s(np.array(lat.s
-000081f0: 6861 7065 292b 3229 0a20 2020 2020 2020  hape)+2).       
-00008200: 2020 2020 2020 2020 206c 6174 5f65 7870           lat_exp
-00008210: 616e 6465 6420 5b31 3a2d 312c 313a 2d31  anded [1:-1,1:-1
-00008220: 5d20 3d20 6c61 740a 2020 2020 2020 2020  ] = lat.        
-00008230: 2020 2020 2020 2020 6c61 745f 6578 7061          lat_expa
-00008240: 6e64 6564 205b 3a2c 2030 5d20 203d 206c  nded [:, 0]  = l
-00008250: 6174 5f65 7870 616e 6465 6420 5b3a 2c20  at_expanded [:, 
-00008260: 315d 202b 2028 6c61 745f 6578 7061 6e64  1] + (lat_expand
-00008270: 6564 205b 3a2c 2031 5d20 2d20 6c61 745f  ed [:, 1] - lat_
-00008280: 6578 7061 6e64 6564 205b 3a2c 2032 5d29  expanded [:, 2])
-00008290: 2023 2070 6f70 756c 6174 6520 6c65 6674   # populate left
-000082a0: 2063 6f6c 756d 6e0a 2020 2020 2020 2020   column.        
-000082b0: 2020 2020 2020 2020 6c61 745f 6578 7061          lat_expa
-000082c0: 6e64 6564 205b 3a2c 2d31 5d20 203d 206c  nded [:,-1]  = l
-000082d0: 6174 5f65 7870 616e 6465 6420 5b3a 2c2d  at_expanded [:,-
-000082e0: 325d 202b 2028 6c61 745f 6578 7061 6e64  2] + (lat_expand
-000082f0: 6564 205b 3a2c 2d32 5d20 2d20 6c61 745f  ed [:,-2] - lat_
-00008300: 6578 7061 6e64 6564 205b 3a2c 2d33 5d29  expanded [:,-3])
-00008310: 2023 2070 6f70 756c 6174 6520 7269 6768   # populate righ
-00008320: 7420 636f 6c75 6d6e 0a20 2020 2020 2020  t column.       
-00008330: 2020 2020 2020 2020 206c 6174 5f65 7870           lat_exp
-00008340: 616e 6465 6420 5b30 2c20 3a5d 2020 3d20  anded [0, :]  = 
-00008350: 6c61 745f 6578 7061 6e64 6564 205b 312c  lat_expanded [1,
-00008360: 203a 5d20 2b20 286c 6174 5f65 7870 616e   :] + (lat_expan
-00008370: 6465 6420 5b31 2c20 3a5d 202d 206c 6174  ded [1, :] - lat
-00008380: 5f65 7870 616e 6465 6420 5b32 2c20 3a5d  _expanded [2, :]
-00008390: 2920 2320 706f 7075 6c61 7465 2074 6f70  ) # populate top
-000083a0: 2072 6f77 0a20 2020 2020 2020 2020 2020   row.           
-000083b0: 2020 2020 206c 6174 5f65 7870 616e 6465       lat_expande
-000083c0: 6420 5b2d 312c 3a5d 2020 3d20 6c61 745f  d [-1,:]  = lat_
-000083d0: 6578 7061 6e64 6564 205b 2d32 2c3a 5d20  expanded [-2,:] 
-000083e0: 2b20 286c 6174 5f65 7870 616e 6465 6420  + (lat_expanded 
-000083f0: 5b2d 322c 3a5d 202d 206c 6174 5f65 7870  [-2,:] - lat_exp
-00008400: 616e 6465 6420 5b2d 332c 3a5d 2920 2320  anded [-3,:]) # 
-00008410: 706f 7075 6c61 7465 2062 6f74 746f 6d20  populate bottom 
-00008420: 726f 770a 2020 2020 2020 2020 2020 2020  row.            
-00008430: 2020 2020 2320 6372 6561 7465 2065 7870      # create exp
-00008440: 616e 6465 6420 6c61 740a 2020 2020 2020  anded lat.      
-00008450: 2020 2020 2020 2020 2020 6c6f 6e5f 6578            lon_ex
-00008460: 7061 6e64 6564 203d 206e 702e 7a65 726f  panded = np.zero
-00008470: 7328 6e70 2e61 7272 6179 286c 6f6e 2e73  s(np.array(lon.s
-00008480: 6861 7065 292b 3229 0a20 2020 2020 2020  hape)+2).       
-00008490: 2020 2020 2020 2020 206c 6f6e 5f65 7870           lon_exp
-000084a0: 616e 6465 6420 5b31 3a2d 312c 313a 2d31  anded [1:-1,1:-1
-000084b0: 5d20 3d20 6c6f 6e0a 2020 2020 2020 2020  ] = lon.        
-000084c0: 2020 2020 2020 2020 6c6f 6e5f 6578 7061          lon_expa
-000084d0: 6e64 6564 205b 3a2c 2030 5d20 203d 206c  nded [:, 0]  = l
-000084e0: 6f6e 5f65 7870 616e 6465 6420 5b3a 2c20  on_expanded [:, 
-000084f0: 315d 202b 2028 6c6f 6e5f 6578 7061 6e64  1] + (lon_expand
-00008500: 6564 205b 3a2c 2031 5d20 2d20 6c6f 6e5f  ed [:, 1] - lon_
-00008510: 6578 7061 6e64 6564 205b 3a2c 2032 5d29  expanded [:, 2])
-00008520: 2023 2070 6f70 756c 6174 6520 6c65 6674   # populate left
-00008530: 2063 6f6c 756d 6e0a 2020 2020 2020 2020   column.        
-00008540: 2020 2020 2020 2020 6c6f 6e5f 6578 7061          lon_expa
-00008550: 6e64 6564 205b 3a2c 2d31 5d20 203d 206c  nded [:,-1]  = l
-00008560: 6f6e 5f65 7870 616e 6465 6420 5b3a 2c2d  on_expanded [:,-
-00008570: 325d 202b 2028 6c6f 6e5f 6578 7061 6e64  2] + (lon_expand
-00008580: 6564 205b 3a2c 2d32 5d20 2d20 6c6f 6e5f  ed [:,-2] - lon_
-00008590: 6578 7061 6e64 6564 205b 3a2c 2d33 5d29  expanded [:,-3])
-000085a0: 2023 2070 6f70 756c 6174 6520 7269 6768   # populate righ
-000085b0: 7420 636f 6c75 6d6e 0a20 2020 2020 2020  t column.       
-000085c0: 2020 2020 2020 2020 206c 6f6e 5f65 7870           lon_exp
-000085d0: 616e 6465 6420 5b30 2c20 3a5d 2020 3d20  anded [0, :]  = 
-000085e0: 6c6f 6e5f 6578 7061 6e64 6564 205b 312c  lon_expanded [1,
-000085f0: 203a 5d20 2b20 286c 6f6e 5f65 7870 616e   :] + (lon_expan
-00008600: 6465 6420 5b31 2c20 3a5d 202d 206c 6f6e  ded [1, :] - lon
-00008610: 5f65 7870 616e 6465 6420 5b32 2c20 3a5d  _expanded [2, :]
-00008620: 2920 2320 706f 7075 6c61 7465 2074 6f70  ) # populate top
-00008630: 2072 6f77 0a20 2020 2020 2020 2020 2020   row.           
-00008640: 2020 2020 206c 6f6e 5f65 7870 616e 6465       lon_expande
-00008650: 6420 5b2d 312c 3a5d 2020 3d20 6c6f 6e5f  d [-1,:]  = lon_
-00008660: 6578 7061 6e64 6564 205b 2d32 2c3a 5d20  expanded [-2,:] 
-00008670: 2b20 286c 6f6e 5f65 7870 616e 6465 6420  + (lon_expanded 
-00008680: 5b2d 322c 3a5d 202d 206c 6f6e 5f65 7870  [-2,:] - lon_exp
-00008690: 616e 6465 6420 5b2d 332c 3a5d 2920 2320  anded [-3,:]) # 
-000086a0: 706f 7075 6c61 7465 2062 6f74 746f 6d20  populate bottom 
-000086b0: 726f 770a 2020 2020 2020 2020 2020 2020  row.            
-000086c0: 2020 2020 2320 7061 7373 2074 6f20 7468      # pass to th
-000086d0: 6520 6c61 742c 206c 6f6e 2065 7874 656e  e lat, lon exten
-000086e0: 6465 640a 2020 2020 2020 2020 2020 2020  ded.            
-000086f0: 2020 2020 7365 6c66 2e6c 6174 5f65 7870      self.lat_exp
-00008700: 616e 6465 6420 3d20 6c61 745f 6578 7061  anded = lat_expa
-00008710: 6e64 6564 0a20 2020 2020 2020 2020 2020  nded.           
-00008720: 2020 2020 2073 656c 662e 6c6f 6e5f 6578       self.lon_ex
-00008730: 7061 6e64 6564 203d 206c 6f6e 5f65 7870  panded = lon_exp
-00008740: 616e 6465 640a 2020 2020 2020 2020 2320  anded.        # 
-00008750: 6361 7365 2023 3220 726f 7461 7465 6420  case #2 rotated 
-00008760: 6c61 742f 6c6f 6e0a 2020 2020 2020 2020  lat/lon.        
-00008770: 6966 2028 6c65 6e28 6e63 6964 2e76 6172  if (len(ncid.var
-00008780: 6961 626c 6573 5b73 656c 662e 7661 725f  iables[self.var_
-00008790: 6c61 745d 2e64 696d 656e 7369 6f6e 7329  lat].dimensions)
-000087a0: 3d3d 3229 2061 6e64 2028 6c65 6e28 6e63  ==2) and (len(nc
-000087b0: 6964 2e76 6172 6961 626c 6573 5b73 656c  id.variables[sel
-000087c0: 662e 7661 725f 6c6f 6e5d 2e64 696d 656e  f.var_lon].dimen
-000087d0: 7369 6f6e 7329 3d3d 3229 3a0a 2020 2020  sions)==2):.    
-000087e0: 2020 2020 2020 2020 7072 696e 7428 2745          print('E
-000087f0: 4153 594d 4f52 4520 6465 7465 6374 7320  ASYMORE detects 
-00008800: 6361 7365 2032 202d 2072 6f74 6174 6564  case 2 - rotated
-00008810: 206c 6174 2f6c 6f6e 2729 0a20 2020 2020   lat/lon').     
-00008820: 2020 2020 2020 2073 656c 662e 6361 7365         self.case
-00008830: 203d 2032 0a20 2020 2020 2020 2020 2020   = 2.           
-00008840: 206c 6174 203d 206e 6369 642e 7661 7269   lat = ncid.vari
-00008850: 6162 6c65 735b 7365 6c66 2e76 6172 5f6c  ables[self.var_l
-00008860: 6174 5d5b 3a2c 3a5d 0a20 2020 2020 2020  at][:,:].       
-00008870: 2020 2020 206c 6f6e 203d 206e 6369 642e       lon = ncid.
-00008880: 7661 7269 6162 6c65 735b 7365 6c66 2e76  variables[self.v
-00008890: 6172 5f6c 6f6e 5d5b 3a2c 3a5d 0a20 2020  ar_lon][:,:].   
-000088a0: 2020 2020 2020 2020 2023 2063 7265 6174           # creat
-000088b0: 696e 672f 7361 7669 6e67 2074 6865 2073  ing/saving the s
-000088c0: 6861 7065 6669 6c65 0a20 2020 2020 2020  hapefile.       
-000088d0: 2020 2020 206c 6174 203d 206e 702e 6172       lat = np.ar
-000088e0: 7261 7928 6c61 7429 2e61 7374 7970 6528  ray(lat).astype(
-000088f0: 666c 6f61 7429 0a20 2020 2020 2020 2020  float).         
-00008900: 2020 206c 6f6e 203d 206e 702e 6172 7261     lon = np.arra
-00008910: 7928 6c6f 6e29 2e61 7374 7970 6528 666c  y(lon).astype(fl
-00008920: 6f61 7429 0a20 2020 2020 2020 2020 2020  oat).           
-00008930: 2073 656c 662e 6c61 7420 3d20 6c61 740a   self.lat = lat.
-00008940: 2020 2020 2020 2020 2020 2020 7365 6c66              self
-00008950: 2e6c 6f6e 203d 206c 6f6e 0a20 2020 2020  .lon = lon.     
-00008960: 2020 2023 2063 6173 6520 2333 2031 2d44     # case #3 1-D
-00008970: 206c 6174 2f6c 6f6e 2061 6e64 2032 2064   lat/lon and 2 d
-00008980: 6174 6120 666f 7220 6972 7265 6775 6c61  ata for irregula
-00008990: 7420 7368 6170 6573 0a20 2020 2020 2020  t shapes.       
-000089a0: 2069 6620 286c 656e 286e 6369 642e 7661   if (len(ncid.va
-000089b0: 7269 6162 6c65 735b 7365 6c66 2e76 6172  riables[self.var
-000089c0: 5f6c 6174 5d2e 6469 6d65 6e73 696f 6e73  _lat].dimensions
-000089d0: 293d 3d31 2920 616e 6420 286c 656e 286e  )==1) and (len(n
-000089e0: 6369 642e 7661 7269 6162 6c65 735b 7365  cid.variables[se
-000089f0: 6c66 2e76 6172 5f6c 6f6e 5d2e 6469 6d65  lf.var_lon].dime
-00008a00: 6e73 696f 6e73 293d 3d31 2920 616e 645c  nsions)==1) and\
-00008a10: 0a20 2020 2020 2020 2020 2020 286c 656e  .           (len
-00008a20: 286e 6369 642e 7661 7269 6162 6c65 735b  (ncid.variables[
-00008a30: 7365 6c66 2e76 6172 5f6e 616d 6573 5b30  self.var_names[0
-00008a40: 5d5d 2e64 696d 656e 7369 6f6e 7329 3d3d  ]].dimensions)==
-00008a50: 3229 3a0a 2020 2020 2020 2020 2020 2020  2):.            
-00008a60: 7072 696e 7428 2745 4153 594d 4f52 4520  print('EASYMORE 
-00008a70: 6465 7465 6374 7320 6361 7365 2033 202d  detects case 3 -
-00008a80: 2069 7272 6567 756c 6172 206c 6174 2f6c   irregular lat/l
-00008a90: 6f6e 3b20 7368 6170 6566 696c 6520 7368  on; shapefile sh
-00008aa0: 6f75 6c64 2062 6520 7072 6f76 6964 6564  ould be provided
-00008ab0: 2729 0a20 2020 2020 2020 2020 2020 2073  ').            s
-00008ac0: 656c 662e 6361 7365 203d 2033 0a20 2020  elf.case = 3.   
-00008ad0: 2020 2020 2020 2020 206c 6174 203d 206e           lat = n
-00008ae0: 6369 642e 7661 7269 6162 6c65 735b 7365  cid.variables[se
-00008af0: 6c66 2e76 6172 5f6c 6174 5d5b 3a5d 0a20  lf.var_lat][:]. 
-00008b00: 2020 2020 2020 2020 2020 206c 6f6e 203d             lon =
-00008b10: 206e 6369 642e 7661 7269 6162 6c65 735b   ncid.variables[
-00008b20: 7365 6c66 2e76 6172 5f6c 6f6e 5d5b 3a5d  self.var_lon][:]
-00008b30: 0a20 2020 2020 2020 2020 2020 2023 7072  .            #pr
-00008b40: 696e 7428 6c61 742c 206c 6f6e 290a 2020  int(lat, lon).  
-00008b50: 2020 2020 2020 2020 2020 6966 2073 656c            if sel
-00008b60: 662e 7661 725f 4944 2020 3d3d 2027 273a  f.var_ID  == '':
-00008b70: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00008b80: 2070 7269 6e74 2827 4541 5359 4d4f 5245   print('EASYMORE
-00008b90: 2064 6574 6563 7473 2074 6861 7420 6e6f   detects that no
-00008ba0: 2076 6172 6962 616c 6520 666f 7220 4944   varibale for ID
-00008bb0: 206f 6620 7468 6520 736f 7572 6365 206e   of the source n
-00008bc0: 6574 4344 4620 6669 6c65 3b20 616e 2061  etCDF file; an a
-00008bd0: 7262 6974 6174 6972 7920 4944 2077 696c  rbitatiry ID wil
-00008be0: 6c20 6265 2070 726f 7669 6465 6427 290a  l be provided').
-00008bf0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00008c00: 4944 203d 2020 6e70 2e61 7261 6e67 6528  ID =  np.arange(
-00008c10: 6c65 6e28 6c61 7429 292b 3120 2320 7061  len(lat))+1 # pa
-00008c20: 7373 2061 7262 6974 6172 6172 7920 7661  ss arbitarary va
-00008c30: 6c75 6573 0a20 2020 2020 2020 2020 2020  lues.           
-00008c40: 2065 6c73 653a 0a20 2020 2020 2020 2020   else:.         
-00008c50: 2020 2020 2020 2049 4420 3d20 6e63 6964         ID = ncid
-00008c60: 2e76 6172 6961 626c 6573 5b73 656c 662e  .variables[self.
-00008c70: 7661 725f 4944 5d5b 3a5d 0a20 2020 2020  var_ID][:].     
-00008c80: 2020 2020 2020 2023 2063 7265 6174 696e         # creatin
-00008c90: 672f 7361 7669 6e67 2074 6865 2073 6861  g/saving the sha
-00008ca0: 7065 6669 6c65 0a20 2020 2020 2020 2020  pefile.         
-00008cb0: 2020 206c 6174 203d 206e 702e 6172 7261     lat = np.arra
-00008cc0: 7928 6c61 7429 2e61 7374 7970 6528 666c  y(lat).astype(fl
-00008cd0: 6f61 7429 0a20 2020 2020 2020 2020 2020  oat).           
-00008ce0: 206c 6f6e 203d 206e 702e 6172 7261 7928   lon = np.array(
-00008cf0: 6c6f 6e29 2e61 7374 7970 6528 666c 6f61  lon).astype(floa
-00008d00: 7429 0a20 2020 2020 2020 2020 2020 2073  t).            s
-00008d10: 656c 662e 6c61 7420 3d20 6c61 740a 2020  elf.lat = lat.  
-00008d20: 2020 2020 2020 2020 2020 7365 6c66 2e6c            self.l
-00008d30: 6f6e 203d 206c 6f6e 0a20 2020 2020 2020  on = lon.       
-00008d40: 2020 2020 2073 656c 662e 4944 2020 3d20       self.ID  = 
-00008d50: 4944 0a0a 2020 2020 6465 6620 6c61 745f  ID..    def lat_
-00008d60: 6c6f 6e5f 5348 5028 7365 6c66 2c0a 2020  lon_SHP(self,.  
-00008d70: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00008d80: 2020 6c61 742c 0a20 2020 2020 2020 2020    lat,.         
-00008d90: 2020 2020 2020 2020 2020 206c 6f6e 2c0a             lon,.
-00008da0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00008db0: 2020 2020 6669 6c65 5f6e 616d 6529 3a0a      file_name):.
-00008dc0: 2020 2020 2020 2020 2222 220a 2020 2020          """.    
-00008dd0: 2020 2020 4020 6175 7468 6f72 3a20 2020      @ author:   
-00008de0: 2020 2020 2020 2020 2020 2020 2020 2053                 S
-00008df0: 6865 7276 616e 2047 6861 7261 7269 2c20  hervan Gharari, 
-00008e00: 576f 7574 6572 204b 6e6f 6265 6e0a 2020  Wouter Knoben.  
-00008e10: 2020 2020 2020 4020 4769 7468 7562 3a20        @ Github: 
-00008e20: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00008e30: 2068 7474 7073 3a2f 2f67 6974 6875 622e   https://github.
-00008e40: 636f 6d2f 5368 6572 7661 6e47 6861 7261  com/ShervanGhara
-00008e50: 7269 2f45 4153 594d 4f52 450a 2020 2020  ri/EASYMORE.    
-00008e60: 2020 2020 4020 6175 7468 6f72 2773 2065      @ author's e
-00008e70: 6d61 696c 2069 643a 2020 2020 2020 2073  mail id:       s
-00008e80: 682e 6768 6172 6172 6940 676d 6169 6c2e  h.gharari@gmail.
-00008e90: 636f 6d0a 2020 2020 2020 2020 4020 6c69  com.        @ li
-00008ea0: 6365 6e73 653a 2020 2020 2020 2020 2020  cense:          
-00008eb0: 2020 2020 2020 2047 4e55 2d47 504c 7633         GNU-GPLv3
-00008ec0: 0a20 2020 2020 2020 2054 6869 7320 6675  .        This fu
-00008ed0: 6e63 7469 6f6e 2063 7265 6174 6573 2061  nction creates a
-00008ee0: 2073 6861 7065 6669 6c65 2066 6f72 2074   shapefile for t
-00008ef0: 6865 2073 6f75 7263 6520 6e65 7463 6466  he source netcdf
-00008f00: 2066 696c 650a 2020 2020 2020 2020 4172   file.        Ar
-00008f10: 6775 6d65 6e74 730a 2020 2020 2020 2020  guments.        
-00008f20: 2d2d 2d2d 2d2d 2d2d 2d0a 2020 2020 2020  ---------.      
-00008f30: 2020 6c61 743a 2074 6865 2032 4420 6d61    lat: the 2D ma
-00008f40: 7472 6978 206f 6620 6c61 745f 3244 205b  trix of lat_2D [
-00008f50: 6e2c 6d2c 5d0a 2020 2020 2020 2020 6c6f  n,m,].        lo
-00008f60: 6e3a 2074 6865 2032 4420 6d61 7472 6978  n: the 2D matrix
-00008f70: 206f 6620 6c6f 6e5f 3244 205b 6e2c 6d2c   of lon_2D [n,m,
-00008f80: 5d0a 2020 2020 2020 2020 6669 6c65 5f6e  ].        file_n
-00008f90: 616d 653a 2073 7472 696e 672c 206e 616d  ame: string, nam
-00008fa0: 6520 6f66 2074 6865 2066 696c 6520 7468  e of the file th
-00008fb0: 6174 2074 6865 2073 6861 7065 6669 6c65  at the shapefile
-00008fc0: 2077 696c 6c20 6265 2073 6176 6564 2061   will be saved a
-00008fd0: 740a 2020 2020 2020 2020 2222 220a 2020  t.        """.  
-00008fe0: 2020 2020 2020 2320 6368 6563 6b20 6966        # check if
-00008ff0: 206c 6174 2f6c 6f6e 2074 6861 7420 6172   lat/lon that ar
-00009000: 6520 7461 6b65 6e20 696e 2068 6173 2074  e taken in has t
-00009010: 6865 2073 616d 6520 6469 6d65 6e73 696f  he same dimensio
-00009020: 6e0a 2020 2020 2020 2020 696d 706f 7274  n.        import
-00009030: 2067 656f 7061 6e64 6173 2061 7320 6770   geopandas as gp
-00009040: 640a 2020 2020 2020 2020 6672 6f6d 2020  d.        from  
-00009050: 2073 6861 7065 6c79 2e67 656f 6d65 7472   shapely.geometr
-00009060: 7920 696d 706f 7274 2050 6f6c 7967 6f6e  y import Polygon
-00009070: 0a20 2020 2020 2020 2069 6d70 6f72 7420  .        import 
-00009080: 7368 6170 6566 696c 6520 2320 7079 7368  shapefile # pysh
-00009090: 6564 206c 6962 7261 7279 0a20 2020 2020  ed library.     
-000090a0: 2020 2069 6d70 6f72 7420 7368 6170 656c     import shapel
-000090b0: 790a 2020 2020 2020 2020 230a 2020 2020  y.        #.    
-000090c0: 2020 2020 6c61 745f 6c6f 6e5f 7368 6170      lat_lon_shap
-000090d0: 6520 3d20 6c61 742e 7368 6170 650a 2020  e = lat.shape.  
-000090e0: 2020 2020 2020 2320 7772 6974 6520 7468        # write th
-000090f0: 6520 7368 6170 6566 696c 650a 2020 2020  e shapefile.    
-00009100: 2020 2020 7769 7468 2073 6861 7065 6669      with shapefi
-00009110: 6c65 2e57 7269 7465 7228 6669 6c65 5f6e  le.Writer(file_n
-00009120: 616d 6529 2061 7320 773a 0a20 2020 2020  ame) as w:.     
-00009130: 2020 2020 2020 2077 2e61 7574 6f42 616c         w.autoBal
-00009140: 616e 6365 203d 2031 2023 2074 7572 6e20  ance = 1 # turn 
-00009150: 6f6e 2066 756e 6374 696f 6e20 7468 6174  on function that
-00009160: 206b 6565 7073 2066 696c 6520 7374 6162   keeps file stab
-00009170: 6c65 2069 6620 6e75 6d62 6572 206f 6620  le if number of 
-00009180: 7368 6170 6573 2061 6e64 2072 6563 6f72  shapes and recor
-00009190: 6473 2064 6f6e 2774 206c 696e 6520 7570  ds don't line up
-000091a0: 0a20 2020 2020 2020 2020 2020 2077 2e66  .            w.f
-000091b0: 6965 6c64 2822 4944 5f73 222c 274e 2729  ield("ID_s",'N')
-000091c0: 2023 2063 7265 6174 6520 284e 2975 6d65   # create (N)ume
-000091d0: 7269 6361 6c20 6174 7472 6962 7574 6520  rical attribute 
-000091e0: 6669 656c 6473 2c20 696e 7465 6765 720a  fields, integer.
-000091f0: 2020 2020 2020 2020 2020 2020 772e 6669              w.fi
-00009200: 656c 6428 226c 6174 5f73 222c 2746 272c  eld("lat_s",'F',
-00009210: 6465 6369 6d61 6c3d 3429 2023 2066 6c6f  decimal=4) # flo
-00009220: 6174 2077 6974 6820 3420 6465 6369 6d61  at with 4 decima
-00009230: 6c73 0a20 2020 2020 2020 2020 2020 2077  ls.            w
-00009240: 2e66 6965 6c64 2822 6c6f 6e5f 7322 2c27  .field("lon_s",'
-00009250: 4627 2c64 6563 696d 616c 3d34 2920 2320  F',decimal=4) # 
-00009260: 666c 6f61 7420 7769 7468 2034 2064 6563  float with 4 dec
-00009270: 696d 616c 730a 2020 2020 2020 2020 2020  imals.          
-00009280: 2020 2320 7072 6570 6172 696e 6720 7468    # preparing th
-00009290: 6520 6d20 7768 6369 6820 6973 2061 2063  e m whcih is a c
-000092a0: 6f75 7465 7220 666f 7220 7468 6520 7368  outer for the sh
-000092b0: 6170 6566 696c 6520 6172 6269 7472 6172  apefile arbitrar
-000092c0: 7920 4944 0a20 2020 2020 2020 2020 2020  y ID.           
-000092d0: 206d 203d 2030 2e30 300a 2020 2020 2020   m = 0.00.      
-000092e0: 2020 2020 2020 2320 6974 7465 7261 7469        # itterati
-000092f0: 6e67 2074 6f20 6372 6561 7465 2074 6865  ng to create the
-00009300: 2073 6861 7065 7320 6f66 2074 6865 2072   shapes of the r
-00009310: 6573 756c 7420 7368 6170 6566 696c 6520  esult shapefile 
-00009320: 6967 6e6f 7269 6e67 2074 6865 2066 6972  ignoring the fir
-00009330: 7374 2061 6e64 206c 6173 7420 726f 7773  st and last rows
-00009340: 2061 6e64 2063 6f6c 756d 6e73 0a20 2020   and columns.   
-00009350: 2020 2020 2020 2020 2066 6f72 2069 2069           for i i
-00009360: 6e20 7261 6e67 6528 312c 206c 6174 5f6c  n range(1, lat_l
-00009370: 6f6e 5f73 6861 7065 5b30 5d20 2d20 3129  on_shape[0] - 1)
-00009380: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-00009390: 2020 666f 7220 6a20 696e 2072 616e 6765    for j in range
-000093a0: 2831 2c20 6c61 745f 6c6f 6e5f 7368 6170  (1, lat_lon_shap
-000093b0: 655b 315d 202d 2031 293a 0a20 2020 2020  e[1] - 1):.     
-000093c0: 2020 2020 2020 2020 2020 2020 2020 2023                 #
-000093d0: 2063 6865 636b 696e 6720 6973 206c 6174   checking is lat
-000093e0: 2061 6e64 206c 6f6e 2069 7320 6c6f 6361   and lon is loca
-000093f0: 7465 6420 696e 7369 6465 2074 6865 2070  ted inside the p
-00009400: 726f 7669 6465 6420 626f 0a20 2020 2020  rovided bo.     
-00009410: 2020 2020 2020 2020 2020 2020 2020 2023                 #
-00009420: 2065 6d70 7479 2074 6865 2070 6f6c 7967   empty the polyg
-00009430: 6f6e 2076 6172 6961 626c 650a 2020 2020  on variable.    
-00009440: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00009450: 7061 7274 7320 3d20 5b5d 0a20 2020 2020  parts = [].     
-00009460: 2020 2020 2020 2020 2020 2020 2020 2023                 #
-00009470: 2075 7064 6174 6520 7265 636f 7264 730a   update records.
-00009480: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00009490: 2020 2020 6d20 2b3d 2031 2023 2049 440a      m += 1 # ID.
-000094a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000094b0: 2020 2020 6365 6e74 6572 5f6c 6174 203d      center_lat =
-000094c0: 206c 6174 5b69 2c6a 5d20 2320 6c61 7420   lat[i,j] # lat 
-000094d0: 7661 6c75 6520 6f66 2064 6174 6120 706f  value of data po
-000094e0: 696e 7420 696e 2073 6f75 7263 6520 2e6e  int in source .n
-000094f0: 6320 6669 6c65 0a20 2020 2020 2020 2020  c file.         
-00009500: 2020 2020 2020 2020 2020 2063 656e 7465             cente
-00009510: 725f 6c6f 6e20 3d20 6c6f 6e5b 692c 6a5d  r_lon = lon[i,j]
-00009520: 2023 206c 6f6e 2076 616c 7565 206f 6620   # lon value of 
-00009530: 6461 7461 2070 6f69 6e74 2069 6e20 736f  data point in so
-00009540: 7572 6365 202e 6e63 2066 696c 6520 7368  urce .nc file sh
-00009550: 6f75 6c64 2062 6520 7769 7468 696e 205b  ould be within [
-00009560: 302c 3336 305d 0a20 2020 2020 2020 2020  0,360].         
-00009570: 2020 2020 2020 2020 2020 2023 2043 7265             # Cre
-00009580: 6174 696e 6720 7468 6520 6c61 7420 6f66  ating the lat of
-00009590: 2074 6865 2073 6861 7065 6669 6c65 0a20   the shapefile. 
-000095a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000095b0: 2020 204c 6174 5f55 7020 2020 2020 2020     Lat_Up       
-000095c0: 3d20 286c 6174 5b69 202d 2031 2c20 6a5d  = (lat[i - 1, j]
-000095d0: 202b 206c 6174 5b69 2c20 6a5d 2920 2f20   + lat[i, j]) / 
-000095e0: 320a 2020 2020 2020 2020 2020 2020 2020  2.              
-000095f0: 2020 2020 2020 4c61 745f 5570 5272 6967        Lat_UpRrig
-00009600: 6874 203d 2028 6c61 745b 6920 2d20 312c  ht = (lat[i - 1,
-00009610: 206a 5d20 2b20 6c61 745b 6920 2d20 312c   j] + lat[i - 1,
-00009620: 206a 202b 2031 5d20 2b20 6c61 745b 692c   j + 1] + lat[i,
-00009630: 206a 202b 2031 5d20 2b20 6c61 745b 692c   j + 1] + lat[i,
-00009640: 206a 5d29 202f 2034 0a20 2020 2020 2020   j]) / 4.       
-00009650: 2020 2020 2020 2020 2020 2020 204c 6174               Lat
-00009660: 5f52 6967 6874 2020 2020 3d20 286c 6174  _Right    = (lat
-00009670: 5b69 2c20 6a20 2b20 315d 202b 206c 6174  [i, j + 1] + lat
-00009680: 5b69 2c20 6a5d 2920 2f20 320a 2020 2020  [i, j]) / 2.    
-00009690: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000096a0: 4c61 745f 4c6f 7752 6967 6874 203d 2028  Lat_LowRight = (
-000096b0: 6c61 745b 692c 206a 202b 2031 5d20 2b20  lat[i, j + 1] + 
-000096c0: 6c61 745b 6920 2b20 312c 206a 202b 2031  lat[i + 1, j + 1
-000096d0: 5d20 2b20 6c61 745b 6920 2b20 312c 206a  ] + lat[i + 1, j
-000096e0: 5d20 2b20 6c61 745b 692c 206a 5d29 202f  ] + lat[i, j]) /
-000096f0: 2034 0a20 2020 2020 2020 2020 2020 2020   4.             
-00009700: 2020 2020 2020 204c 6174 5f4c 6f77 2020         Lat_Low  
-00009710: 2020 2020 3d20 286c 6174 5b69 202b 2031      = (lat[i + 1
-00009720: 2c20 6a5d 202b 206c 6174 5b69 2c20 6a5d  , j] + lat[i, j]
-00009730: 2920 2f20 320a 2020 2020 2020 2020 2020  ) / 2.          
-00009740: 2020 2020 2020 2020 2020 4c61 745f 4c6f            Lat_Lo
-00009750: 774c 6566 7420 203d 2028 6c61 745b 692c  wLeft  = (lat[i,
-00009760: 206a 202d 2031 5d20 2b20 6c61 745b 6920   j - 1] + lat[i 
-00009770: 2b20 312c 206a 202d 2031 5d20 2b20 6c61  + 1, j - 1] + la
-00009780: 745b 6920 2b20 312c 206a 5d20 2b20 6c61  t[i + 1, j] + la
-00009790: 745b 692c 206a 5d29 202f 2034 0a20 2020  t[i, j]) / 4.   
-000097a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000097b0: 204c 6174 5f4c 6566 7420 2020 2020 3d20   Lat_Left     = 
-000097c0: 286c 6174 5b69 2c20 6a20 2d20 315d 202b  (lat[i, j - 1] +
-000097d0: 206c 6174 5b69 2c20 6a5d 2920 2f20 320a   lat[i, j]) / 2.
-000097e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000097f0: 2020 2020 4c61 745f 5570 4c65 6674 2020      Lat_UpLeft  
-00009800: 203d 2028 6c61 745b 6920 2d20 312c 206a   = (lat[i - 1, j
-00009810: 202d 2031 5d20 2b20 6c61 745b 6920 2d20   - 1] + lat[i - 
-00009820: 312c 206a 5d20 2b20 6c61 745b 692c 206a  1, j] + lat[i, j
-00009830: 202d 2031 5d20 2b20 6c61 745b 692c 206a   - 1] + lat[i, j
-00009840: 5d29 202f 2034 0a20 2020 2020 2020 2020  ]) / 4.         
-00009850: 2020 2020 2020 2020 2020 2023 2043 7265             # Cre
-00009860: 6174 696e 6720 7468 6520 6c6f 6e20 6f66  ating the lon of
-00009870: 2074 6865 2073 6861 7065 6669 6c65 0a20   the shapefile. 
-00009880: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00009890: 2020 204c 6f6e 5f55 7020 2020 2020 2020     Lon_Up       
-000098a0: 3d20 286c 6f6e 5b69 202d 2031 2c20 6a5d  = (lon[i - 1, j]
-000098b0: 202b 206c 6f6e 5b69 2c20 6a5d 2920 2f20   + lon[i, j]) / 
-000098c0: 320a 2020 2020 2020 2020 2020 2020 2020  2.              
-000098d0: 2020 2020 2020 4c6f 6e5f 5570 5272 6967        Lon_UpRrig
-000098e0: 6874 203d 2028 6c6f 6e5b 6920 2d20 312c  ht = (lon[i - 1,
-000098f0: 206a 5d20 2b20 6c6f 6e5b 6920 2d20 312c   j] + lon[i - 1,
-00009900: 206a 202b 2031 5d20 2b20 6c6f 6e5b 692c   j + 1] + lon[i,
-00009910: 206a 202b 2031 5d20 2b20 6c6f 6e5b 692c   j + 1] + lon[i,
-00009920: 206a 5d29 202f 2034 0a20 2020 2020 2020   j]) / 4.       
-00009930: 2020 2020 2020 2020 2020 2020 204c 6f6e               Lon
-00009940: 5f52 6967 6874 2020 2020 3d20 286c 6f6e  _Right    = (lon
-00009950: 5b69 2c20 6a20 2b20 315d 202b 206c 6f6e  [i, j + 1] + lon
-00009960: 5b69 2c20 6a5d 2920 2f20 320a 2020 2020  [i, j]) / 2.    
-00009970: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00009980: 4c6f 6e5f 4c6f 7752 6967 6874 203d 2028  Lon_LowRight = (
-00009990: 6c6f 6e5b 692c 206a 202b 2031 5d20 2b20  lon[i, j + 1] + 
-000099a0: 6c6f 6e5b 6920 2b20 312c 206a 202b 2031  lon[i + 1, j + 1
-000099b0: 5d20 2b20 6c6f 6e5b 6920 2b20 312c 206a  ] + lon[i + 1, j
-000099c0: 5d20 2b20 6c6f 6e5b 692c 206a 5d29 202f  ] + lon[i, j]) /
-000099d0: 2034 0a20 2020 2020 2020 2020 2020 2020   4.             
-000099e0: 2020 2020 2020 204c 6f6e 5f4c 6f77 2020         Lon_Low  
-000099f0: 2020 2020 3d20 286c 6f6e 5b69 202b 2031      = (lon[i + 1
-00009a00: 2c20 6a5d 202b 206c 6f6e 5b69 2c20 6a5d  , j] + lon[i, j]
-00009a10: 2920 2f20 320a 2020 2020 2020 2020 2020  ) / 2.          
-00009a20: 2020 2020 2020 2020 2020 4c6f 6e5f 4c6f            Lon_Lo
-00009a30: 774c 6566 7420 203d 2028 6c6f 6e5b 692c  wLeft  = (lon[i,
-00009a40: 206a 202d 2031 5d20 2b20 6c6f 6e5b 6920   j - 1] + lon[i 
-00009a50: 2b20 312c 206a 202d 2031 5d20 2b20 6c6f  + 1, j - 1] + lo
-00009a60: 6e5b 6920 2b20 312c 206a 5d20 2b20 6c6f  n[i + 1, j] + lo
-00009a70: 6e5b 692c 206a 5d29 202f 2034 0a20 2020  n[i, j]) / 4.   
-00009a80: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00009a90: 204c 6f6e 5f4c 6566 7420 2020 2020 3d20   Lon_Left     = 
-00009aa0: 286c 6f6e 5b69 2c20 6a20 2d20 315d 202b  (lon[i, j - 1] +
-00009ab0: 206c 6f6e 5b69 2c20 6a5d 2920 2f20 320a   lon[i, j]) / 2.
-00009ac0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00009ad0: 2020 2020 4c6f 6e5f 5570 4c65 6674 2020      Lon_UpLeft  
-00009ae0: 203d 2028 6c6f 6e5b 6920 2d20 312c 206a   = (lon[i - 1, j
-00009af0: 202d 2031 5d20 2b20 6c6f 6e5b 6920 2d20   - 1] + lon[i - 
-00009b00: 312c 206a 5d20 2b20 6c6f 6e5b 692c 206a  1, j] + lon[i, j
-00009b10: 202d 2031 5d20 2b20 6c6f 6e5b 692c 206a   - 1] + lon[i, j
-00009b20: 5d29 202f 2034 0a20 2020 2020 2020 2020  ]) / 4.         
-00009b30: 2020 2020 2020 2020 2020 2023 2063 7265             # cre
-00009b40: 6174 696e 6720 7468 6520 706f 6c79 676f  ating the polygo
-00009b50: 6e20 6769 7665 6e20 7468 6520 6c61 7420  n given the lat 
-00009b60: 616e 6420 6c6f 6e0a 2020 2020 2020 2020  and lon.        
-00009b70: 2020 2020 2020 2020 2020 2020 7061 7274              part
-00009b80: 732e 6170 7065 6e64 285b 2028 4c6f 6e5f  s.append([ (Lon_
-00009b90: 5570 2c20 2020 2020 2020 204c 6174 5f55  Up,        Lat_U
-00009ba0: 7029 2c5c 0a20 2020 2020 2020 2020 2020  p),\.           
-00009bb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00009bc0: 2020 2020 2020 2020 284c 6f6e 5f55 7052          (Lon_UpR
-00009bd0: 7269 6768 742c 2020 4c61 745f 5570 5272  right,  Lat_UpRr
-00009be0: 6967 6874 292c 205c 0a20 2020 2020 2020  ight), \.       
-00009bf0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00009c00: 2020 2020 2020 2020 2020 2020 284c 6f6e              (Lon
-00009c10: 5f52 6967 6874 2c20 2020 2020 4c61 745f  _Right,     Lat_
-00009c20: 5269 6768 7429 2c20 5c0a 2020 2020 2020  Right), \.      
-00009c30: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00009c40: 2020 2020 2020 2020 2020 2020 2028 4c6f               (Lo
-00009c50: 6e5f 4c6f 7752 6967 6874 2c20 204c 6174  n_LowRight,  Lat
-00009c60: 5f4c 6f77 5269 6768 7429 2c20 5c0a 2020  _LowRight), \.  
-00009c70: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00009c80: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00009c90: 2028 4c6f 6e5f 4c6f 772c 2020 2020 2020   (Lon_Low,      
-00009ca0: 204c 6174 5f4c 6f77 292c 205c 0a20 2020   Lat_Low), \.   
-00009cb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00009cc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00009cd0: 284c 6f6e 5f4c 6f77 4c65 6674 2c20 2020  (Lon_LowLeft,   
-00009ce0: 4c61 745f 4c6f 774c 6566 7429 2c20 5c0a  Lat_LowLeft), \.
-00009cf0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00009d00: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00009d10: 2020 2028 4c6f 6e5f 4c65 6674 2c20 2020     (Lon_Left,   
-00009d20: 2020 204c 6174 5f4c 6566 7429 2c20 5c0a     Lat_Left), \.
-00009d30: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00009d40: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00009d50: 2020 2028 4c6f 6e5f 5570 4c65 6674 2c20     (Lon_UpLeft, 
-00009d60: 2020 204c 6174 5f55 704c 6566 7429 2c20     Lat_UpLeft), 
-00009d70: 5c0a 2020 2020 2020 2020 2020 2020 2020  \.              
-00009d80: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00009d90: 2020 2020 2028 4c6f 6e5f 5570 2c20 2020       (Lon_Up,   
-00009da0: 2020 2020 204c 6174 5f55 7029 5d29 0a20       Lat_Up)]). 
-00009db0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00009dc0: 2020 2023 2073 746f 7265 2070 6f6c 7967     # store polyg
-00009dd0: 6f6e 0a20 2020 2020 2020 2020 2020 2020  on.             
-00009de0: 2020 2020 2020 2077 2e70 6f6c 7928 7061         w.poly(pa
-00009df0: 7274 7329 0a20 2020 2020 2020 2020 2020  rts).           
-00009e00: 2020 2020 2020 2020 2023 2075 7064 6174           # updat
-00009e10: 6520 7265 636f 7264 732f 6669 656c 6473  e records/fields
-00009e20: 2066 6f72 2074 6865 2070 6f6c 7967 6f6e   for the polygon
-00009e30: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00009e40: 2020 2020 2077 2e72 6563 6f72 6428 6d2c       w.record(m,
-00009e50: 2063 656e 7465 725f 6c61 742c 2063 656e   center_lat, cen
-00009e60: 7465 725f 6c6f 6e29 0a0a 2020 2020 6465  ter_lon)..    de
-00009e70: 6620 6164 645f 6c61 745f 6c6f 6e5f 736f  f add_lat_lon_so
-00009e80: 7572 6365 5f53 4850 2820 7365 6c66 2c0a  urce_SHP( self,.
-00009e90: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00009ea0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00009eb0: 7368 702c 0a20 2020 2020 2020 2020 2020  shp,.           
-00009ec0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00009ed0: 2020 2020 2073 6f75 7263 655f 7368 705f       source_shp_
-00009ee0: 6c61 742c 0a20 2020 2020 2020 2020 2020  lat,.           
-00009ef0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00009f00: 2020 2020 2073 6f75 7263 655f 7368 705f       source_shp_
-00009f10: 6c6f 6e2c 0a20 2020 2020 2020 2020 2020  lon,.           
-00009f20: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00009f30: 2020 2020 2073 6f75 7263 655f 7368 705f       source_shp_
-00009f40: 4944 293a 0a20 2020 2020 2020 2022 2222  ID):.        """
-00009f50: 0a20 2020 2020 2020 2040 2061 7574 686f  .        @ autho
-00009f60: 723a 2020 2020 2020 2020 2020 2020 2020  r:              
-00009f70: 2020 2020 5368 6572 7661 6e20 4768 6172      Shervan Ghar
-00009f80: 6172 690a 2020 2020 2020 2020 4020 4769  ari.        @ Gi
-00009f90: 7468 7562 3a20 2020 2020 2020 2020 2020  thub:           
-00009fa0: 2020 2020 2020 2068 7474 7073 3a2f 2f67         https://g
-00009fb0: 6974 6875 622e 636f 6d2f 5368 6572 7661  ithub.com/Sherva
-00009fc0: 6e47 6861 7261 7269 2f45 4153 594d 4f52  nGharari/EASYMOR
-00009fd0: 450a 2020 2020 2020 2020 4020 6175 7468  E.        @ auth
-00009fe0: 6f72 2773 2065 6d61 696c 2069 643a 2020  or's email id:  
-00009ff0: 2020 2020 2073 682e 6768 6172 6172 6940       sh.gharari@
-0000a000: 676d 6169 6c2e 636f 6d0a 2020 2020 2020  gmail.com.      
-0000a010: 2020 4020 6c69 6365 6e73 653a 2020 2020    @ license:    
-0000a020: 2020 2020 2020 2020 2020 2020 2047 4e55               GNU
-0000a030: 2d47 504c 7633 0a20 2020 2020 2020 2054  -GPLv3.        T
-0000a040: 6869 7320 6675 6e63 7469 6f6e 2061 6464  his function add
-0000a050: 206c 6174 2c20 6c6f 6e20 616e 6420 4944   lat, lon and ID
-0000a060: 2066 726f 6d20 7468 6520 736f 7572 6365   from the source
-0000a070: 2073 6861 7065 6669 6c65 2069 6620 7072   shapefile if pr
-0000a080: 6f76 6964 6564 0a20 2020 2020 2020 2041  ovided.        A
-0000a090: 7267 756d 656e 7473 0a20 2020 2020 2020  rguments.       
-0000a0a0: 202d 2d2d 2d2d 2d2d 2d2d 0a20 2020 2020   ---------.     
-0000a0b0: 2020 2073 6870 3a20 6765 6f64 6174 6166     shp: geodataf
-0000a0c0: 7261 6d65 206f 6620 736f 7572 6365 2073  rame of source s
-0000a0d0: 6861 7065 6669 6c65 0a20 2020 2020 2020  hapefile.       
-0000a0e0: 2073 6f75 7263 655f 7368 705f 6c61 743a   source_shp_lat:
-0000a0f0: 2073 7472 696e 672c 2074 6865 206e 616d   string, the nam
-0000a100: 6520 6f66 2074 6865 206c 6174 2066 6965  e of the lat fie
-0000a110: 6c64 2069 6e20 7468 6520 736f 7572 6365  ld in the source
-0000a120: 2073 6861 7065 6669 6c65 0a20 2020 2020   shapefile.     
-0000a130: 2020 2073 6f75 7263 655f 7368 705f 6c6f     source_shp_lo
-0000a140: 6e3a 2073 7472 696e 672c 2074 6865 206e  n: string, the n
-0000a150: 616d 6520 6f66 2074 6865 206c 6f6e 2066  ame of the lon f
-0000a160: 6965 6c64 2069 6e20 7468 6520 736f 7572  ield in the sour
-0000a170: 6365 2073 6861 7065 6669 6c65 0a20 2020  ce shapefile.   
-0000a180: 2020 2020 2073 6f75 7263 655f 7368 705f       source_shp_
-0000a190: 4944 3a20 7374 7269 6e67 2c20 7468 6520  ID: string, the 
-0000a1a0: 6e61 6d65 206f 6620 7468 6520 4944 2066  name of the ID f
-0000a1b0: 6965 6c64 2069 6e20 7468 6520 736f 7572  ield in the sour
-0000a1c0: 6365 2073 6861 7065 6669 6c65 0a20 2020  ce shapefile.   
-0000a1d0: 2020 2020 2022 2222 0a20 2020 2020 2020       """.       
-0000a1e0: 2069 6d70 6f72 7420 6765 6f70 616e 6461   import geopanda
-0000a1f0: 7320 6173 2067 7064 0a20 2020 2020 2020  s as gpd.       
-0000a200: 2066 726f 6d20 2020 7368 6170 656c 792e   from   shapely.
-0000a210: 6765 6f6d 6574 7279 2069 6d70 6f72 7420  geometry import 
-0000a220: 506f 6c79 676f 6e0a 2020 2020 2020 2020  Polygon.        
-0000a230: 696d 706f 7274 2073 6861 7065 6669 6c65  import shapefile
-0000a240: 2023 2070 7973 6865 6420 6c69 6272 6172   # pyshed librar
-0000a250: 790a 2020 2020 2020 2020 696d 706f 7274  y.        import
-0000a260: 2073 6861 7065 6c79 0a20 2020 2020 2020   shapely.       
-0000a270: 2073 6870 5b27 6c61 745f 7327 5d20 3d20   shp['lat_s'] = 
-0000a280: 7368 7020 5b73 6f75 7263 655f 7368 705f  shp [source_shp_
-0000a290: 6c61 745d 2e61 7374 7970 6528 666c 6f61  lat].astype(floa
-0000a2a0: 7429 0a20 2020 2020 2020 2073 6870 5b27  t).        shp['
-0000a2b0: 6c6f 6e5f 7327 5d20 3d20 7368 7020 5b73  lon_s'] = shp [s
-0000a2c0: 6f75 7263 655f 7368 705f 6c6f 6e5d 2e61  ource_shp_lon].a
-0000a2d0: 7374 7970 6528 666c 6f61 7429 0a20 2020  stype(float).   
-0000a2e0: 2020 2020 2069 6620 7365 6c66 2e73 6f75       if self.sou
-0000a2f0: 7263 655f 7368 705f 4944 2021 3d20 2727  rce_shp_ID != ''
-0000a300: 3a0a 2020 2020 2020 2020 2020 2020 7368  :.            sh
-0000a310: 7020 5b27 4944 5f73 275d 2020 3d20 7368  p ['ID_s']  = sh
-0000a320: 7020 5b73 6f75 7263 655f 7368 705f 4944  p [source_shp_ID
-0000a330: 5d0a 2020 2020 2020 2020 656c 7365 3a0a  ].        else:.
-0000a340: 2020 2020 2020 2020 2020 2020 7368 7020              shp 
-0000a350: 5b27 4944 5f73 275d 2020 3d20 6e70 2e61  ['ID_s']  = np.a
-0000a360: 7261 6e67 6528 6c65 6e28 7368 7029 292b  range(len(shp))+
-0000a370: 310a 2020 2020 2020 2020 7265 7475 726e  1.        return
-0000a380: 2073 6870 0a0a 2020 2020 6465 6620 6578   shp..    def ex
-0000a390: 7061 6e64 5f73 6f75 7263 655f 5348 5028  pand_source_SHP(
-0000a3a0: 2020 7365 6c66 2c0a 2020 2020 2020 2020    self,.        
-0000a3b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000a3c0: 2020 2020 7368 702c 0a20 2020 2020 2020      shp,.       
-0000a3d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000a3e0: 2020 2020 2074 656d 705f 6469 722c 0a20       temp_dir,. 
-0000a3f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000a400: 2020 2020 2020 2020 2020 2063 6173 655f             case_
-0000a410: 6e61 6d65 293a 0a20 2020 2020 2020 2022  name):.        "
-0000a420: 2222 0a20 2020 2020 2020 2040 2061 7574  "".        @ aut
-0000a430: 686f 723a 2020 2020 2020 2020 2020 2020  hor:            
-0000a440: 2020 2020 2020 5368 6572 7661 6e20 4768        Shervan Gh
-0000a450: 6172 6172 690a 2020 2020 2020 2020 4020  arari.        @ 
-0000a460: 4769 7468 7562 3a20 2020 2020 2020 2020  Github:         
-0000a470: 2020 2020 2020 2020 2068 7474 7073 3a2f           https:/
-0000a480: 2f67 6974 6875 622e 636f 6d2f 5368 6572  /github.com/Sher
-0000a490: 7661 6e47 6861 7261 7269 2f45 4153 594d  vanGharari/EASYM
-0000a4a0: 4f52 450a 2020 2020 2020 2020 4020 6175  ORE.        @ au
-0000a4b0: 7468 6f72 2773 2065 6d61 696c 2069 643a  thor's email id:
-0000a4c0: 2020 2020 2020 2073 682e 6768 6172 6172         sh.gharar
-0000a4d0: 6940 676d 6169 6c2e 636f 6d0a 2020 2020  i@gmail.com.    
-0000a4e0: 2020 2020 4020 6c69 6365 6e73 653a 2020      @ license:  
-0000a4f0: 2020 2020 2020 2020 2020 2020 2020 2047                 G
-0000a500: 4e55 2d47 504c 7633 0a20 2020 2020 2020  NU-GPLv3.       
-0000a510: 2054 6869 7320 6675 6e63 7469 6f6e 2061   This function a
-0000a520: 6464 206c 6174 2c20 6c6f 6e20 616e 6420  dd lat, lon and 
-0000a530: 4944 2066 726f 6d20 7468 6520 736f 7572  ID from the sour
-0000a540: 6365 2073 6861 7065 6669 6c65 2069 6620  ce shapefile if 
-0000a550: 7072 6f76 6964 6564 0a20 2020 2020 2020  provided.       
-0000a560: 2041 7267 756d 656e 7473 0a20 2020 2020   Arguments.     
-0000a570: 2020 202d 2d2d 2d2d 2d2d 2d2d 0a20 2020     ---------.   
-0000a580: 2020 2020 2073 6870 3a20 6765 6f64 6174       shp: geodat
-0000a590: 6166 7261 6d65 206f 6620 736f 7572 6365  aframe of source
-0000a5a0: 2073 6861 7065 6669 6c65 0a20 2020 2020   shapefile.     
-0000a5b0: 2020 2073 6f75 7263 655f 7368 705f 6c61     source_shp_la
-0000a5c0: 743a 2073 7472 696e 672c 2074 6865 206e  t: string, the n
-0000a5d0: 616d 6520 6f66 2074 6865 206c 6174 2066  ame of the lat f
-0000a5e0: 6965 6c64 2069 6e20 7468 6520 736f 7572  ield in the sour
-0000a5f0: 6365 2073 6861 7065 6669 6c65 0a20 2020  ce shapefile.   
-0000a600: 2020 2020 2073 6f75 7263 655f 7368 705f       source_shp_
-0000a610: 6c6f 6e3a 2073 7472 696e 672c 2074 6865  lon: string, the
-0000a620: 206e 616d 6520 6f66 2074 6865 206c 6f6e   name of the lon
-0000a630: 2066 6965 6c64 2069 6e20 7468 6520 736f   field in the so
-0000a640: 7572 6365 2073 6861 7065 6669 6c65 0a20  urce shapefile. 
-0000a650: 2020 2020 2020 2073 6f75 7263 655f 7368         source_sh
-0000a660: 705f 4944 3a20 7374 7269 6e67 2c20 7468  p_ID: string, th
-0000a670: 6520 6e61 6d65 206f 6620 7468 6520 4944  e name of the ID
-0000a680: 2066 6965 6c64 2069 6e20 7468 6520 736f   field in the so
-0000a690: 7572 6365 2073 6861 7065 6669 6c65 0a20  urce shapefile. 
-0000a6a0: 2020 2020 2020 2052 6574 7572 6e73 0a20         Returns. 
-0000a6b0: 2020 2020 2020 202d 2d2d 2d2d 2d2d 0a20         -------. 
-0000a6c0: 2020 2020 2020 2072 6573 756c 743a 2067         result: g
-0000a6d0: 656f 7061 6e64 6173 2064 6174 6166 7261  eopandas datafra
-0000a6e0: 6d65 2c20 6578 7061 6e64 6564 2073 6f75  me, expanded sou
-0000a6f0: 7263 6520 7368 6170 6566 696c 6520 7468  rce shapefile th
-0000a700: 6174 2063 6f76 6572 7320 2d31 3830 2074  at covers -180 t
-0000a710: 6f20 3336 3020 6f66 206c 6f6e 0a20 2020  o 360 of lon.   
-0000a720: 2020 2020 2022 2222 0a20 2020 2020 2020       """.       
-0000a730: 2069 6d70 6f72 7420 6765 6f70 616e 6461   import geopanda
-0000a740: 7320 6173 2067 7064 0a20 2020 2020 2020  s as gpd.       
-0000a750: 2066 726f 6d20 2020 7368 6170 656c 792e   from   shapely.
-0000a760: 6765 6f6d 6574 7279 2069 6d70 6f72 7420  geometry import 
-0000a770: 506f 6c79 676f 6e0a 2020 2020 2020 2020  Polygon.        
-0000a780: 696d 706f 7274 2073 6861 7065 6669 6c65  import shapefile
-0000a790: 2023 2070 7973 6865 6420 6c69 6272 6172   # pyshed librar
-0000a7a0: 790a 2020 2020 2020 2020 696d 706f 7274  y.        import
-0000a7b0: 2073 6861 7065 6c79 0a20 2020 2020 2020   shapely.       
-0000a7c0: 2023 2070 7574 2061 2063 6865 636b 2074   # put a check t
-0000a7d0: 6f20 7365 6520 6966 2074 6865 7265 2069  o see if there i
-0000a7e0: 7320 6c6f 6e5f 7320 616e 6420 6c61 745f  s lon_s and lat_
-0000a7f0: 732c 2049 445f 730a 2020 2020 2020 2020  s, ID_s.        
-0000a800: 636f 6c75 6d6e 5f6e 616d 6573 203d 2073  column_names = s
-0000a810: 6870 2e63 6f6c 756d 6e73 0a20 2020 2020  hp.columns.     
-0000a820: 2020 2063 6f6c 756d 6e5f 6e61 6d65 7320     column_names 
-0000a830: 3d20 6c69 7374 2863 6f6c 756d 6e5f 6e61  = list(column_na
-0000a840: 6d65 7329 0a20 2020 2020 2020 2069 6620  mes).        if 
-0000a850: 2827 6c6f 6e5f 7327 206e 6f74 2069 6e20  ('lon_s' not in 
-0000a860: 636f 6c75 6d6e 5f6e 616d 6573 2920 6f72  column_names) or
-0000a870: 2028 276c 6174 5f73 2720 6e6f 7420 696e   ('lat_s' not in
-0000a880: 2063 6f6c 756d 6e5f 6e61 6d65 7329 206f   column_names) o
-0000a890: 7220 2827 4944 5f73 2720 6e6f 7420 696e  r ('ID_s' not in
-0000a8a0: 2063 6f6c 756d 6e5f 6e61 6d65 7329 3a0a   column_names):.
-0000a8b0: 2020 2020 2020 2020 2020 2020 7379 732e              sys.
-0000a8c0: 6578 6974 2827 7468 6520 736f 7572 6365  exit('the source
-0000a8d0: 2073 6861 7065 6669 6c65 2064 6f65 7320   shapefile does 
-0000a8e0: 6e6f 7420 6861 7665 2063 6f6c 756d 6e20  not have column 
-0000a8f0: 6f66 206c 6f6e 5f73 206c 6174 5f73 2061  of lon_s lat_s a
-0000a900: 6e64 2049 445f 7327 290a 2020 2020 2020  nd ID_s').      
-0000a910: 2020 2320 6368 6563 6b20 6966 2074 6865    # check if the
-0000a920: 2073 6861 7065 6669 6c65 2069 7320 616c   shapefile is al
-0000a930: 7265 6164 7920 6578 7061 6e64 6564 0a20  ready expanded. 
-0000a940: 2020 2020 2020 206d 696e 5f6c 6f6e 2c20         min_lon, 
-0000a950: 6d69 6e5f 6c61 742c 206d 6178 5f6c 6f6e  min_lat, max_lon
-0000a960: 2c20 6d61 785f 6c61 7420 3d20 7368 702e  , max_lat = shp.
-0000a970: 746f 7461 6c5f 626f 756e 6473 0a20 2020  total_bounds.   
-0000a980: 2020 2020 2070 7269 6e74 286d 696e 5f6c       print(min_l
-0000a990: 6f6e 2c20 6d69 6e5f 6c61 742c 206d 6178  on, min_lat, max
-0000a9a0: 5f6c 6f6e 2c20 6d61 785f 6c61 7429 0a20  _lon, max_lat). 
-0000a9b0: 2020 2020 2020 2069 6620 2831 3830 203c         if (180 <
-0000a9c0: 206d 6178 5f6c 6f6e 2920 616e 6420 286d   max_lon) and (m
-0000a9d0: 696e 5f6c 6f6e 203c 2030 293a 0a20 2020  in_lon < 0):.   
-0000a9e0: 2020 2020 2020 2020 2070 7269 6e74 2827           print('
-0000a9f0: 6974 2073 6565 6d73 2074 6865 2073 6f75  it seems the sou
-0000aa00: 7263 6520 7368 6170 6566 696c 6520 6973  rce shapefile is
-0000aa10: 2061 6c72 6561 6479 2065 7870 616e 6465   already expande
-0000aa20: 6420 6265 7477 6565 6e20 2d31 3830 2074  d between -180 t
-0000aa30: 6f20 3336 3020 6c6f 6e67 6974 7564 6527  o 360 longitude'
-0000aa40: 290a 2020 2020 2020 2020 656c 7365 3a0a  ).        else:.
-0000aa50: 2020 2020 2020 2020 2020 2020 6966 206d              if m
-0000aa60: 6178 2028 7368 705b 276c 6f6e 5f73 275d  ax (shp['lon_s']
-0000aa70: 2920 3e20 3138 3020 616e 6420 6d69 6e20  ) > 180 and min 
-0000aa80: 2873 6870 5b27 6c6f 6e5f 7327 5d29 203e  (shp['lon_s']) >
-0000aa90: 2030 2061 6e64 206d 6178 2028 7368 705b   0 and max (shp[
-0000aaa0: 276c 6f6e 5f73 275d 2920 3c20 3336 303a  'lon_s']) < 360:
-0000aab0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0000aac0: 2070 7269 6e74 2827 4541 5359 4d4f 5245   print('EASYMORE
-0000aad0: 2064 6563 6964 6573 2074 6865 206e 6574   decides the net
-0000aae0: 4344 4620 6669 6c65 2068 6173 206c 6f6e  CDF file has lon
-0000aaf0: 6774 6974 7564 6520 7661 6c75 6573 206f  gtitude values o
-0000ab00: 6620 3020 746f 2033 3630 3b20 6372 6561  f 0 to 360; crea
-0000ab10: 7469 6e67 2074 6865 2065 7874 656e 6465  ting the extende
-0000ab20: 6427 290a 2020 2020 2020 2020 2020 2020  d').            
-0000ab30: 2020 2020 7368 7031 203d 2073 6870 205b      shp1 = shp [
-0000ab40: 7368 705b 276c 6f6e 5f73 275d 203c 3d20  shp['lon_s'] <= 
-0000ab50: 3138 305d 0a20 2020 2020 2020 2020 2020  180].           
-0000ab60: 2020 2020 2073 6870 3220 3d20 7368 7020       shp2 = shp 
-0000ab70: 5b73 6870 5b27 6c6f 6e5f 7327 5d20 3e20  [shp['lon_s'] > 
-0000ab80: 2031 3830 5d0a 2020 2020 2020 2020 2020   180].          
-0000ab90: 2020 2020 2020 6966 206e 6f74 2073 6870        if not shp
-0000aba0: 312e 656d 7074 793a 0a20 2020 2020 2020  1.empty:.       
-0000abb0: 2020 2020 2020 2020 2020 2020 2073 6870               shp
-0000abc0: 312e 746f 5f66 696c 6528 7465 6d70 5f64  1.to_file(temp_d
-0000abd0: 6972 2b63 6173 655f 6e61 6d65 2b27 5f73  ir+case_name+'_s
-0000abe0: 6f75 7263 655f 7368 6170 6566 696c 6541  ource_shapefileA
-0000abf0: 2e73 6870 2729 0a20 2020 2020 2020 2020  .shp').         
-0000ac00: 2020 2020 2020 2020 2020 2073 6870 3120             shp1 
-0000ac10: 3d20 6770 642e 7265 6164 5f66 696c 6528  = gpd.read_file(
-0000ac20: 7465 6d70 5f64 6972 2b63 6173 655f 6e61  temp_dir+case_na
-0000ac30: 6d65 2b27 5f73 6f75 7263 655f 7368 6170  me+'_source_shap
-0000ac40: 6566 696c 6541 2e73 6870 2729 0a20 2020  efileA.shp').   
-0000ac50: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000ac60: 2074 656d 7020 3d20 7368 7031 0a20 2020   temp = shp1.   
-0000ac70: 2020 2020 2020 2020 2020 2020 2069 6620               if 
-0000ac80: 6e6f 7420 7368 7032 2e65 6d70 7479 3a0a  not shp2.empty:.
-0000ac90: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000aca0: 2020 2020 7368 7032 2e74 6f5f 6669 6c65      shp2.to_file
-0000acb0: 2874 656d 705f 6469 722b 6361 7365 5f6e  (temp_dir+case_n
-0000acc0: 616d 652b 275f 736f 7572 6365 5f73 6861  ame+'_source_sha
-0000acd0: 7065 6669 6c65 422e 7368 7027 290a 2020  pefileB.shp').  
-0000ace0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000acf0: 2020 7368 7032 203d 2067 7064 2e72 6561    shp2 = gpd.rea
-0000ad00: 645f 6669 6c65 2874 656d 705f 6469 722b  d_file(temp_dir+
-0000ad10: 6361 7365 5f6e 616d 652b 275f 736f 7572  case_name+'_sour
-0000ad20: 6365 5f73 6861 7065 6669 6c65 422e 7368  ce_shapefileB.sh
-0000ad30: 7027 290a 2020 2020 2020 2020 2020 2020  p').            
-0000ad40: 2020 2020 2020 2020 7368 7033 203d 2067          shp3 = g
-0000ad50: 7064 2e72 6561 645f 6669 6c65 2874 656d  pd.read_file(tem
-0000ad60: 705f 6469 722b 6361 7365 5f6e 616d 652b  p_dir+case_name+
-0000ad70: 275f 736f 7572 6365 5f73 6861 7065 6669  '_source_shapefi
-0000ad80: 6c65 422e 7368 7027 290a 2020 2020 2020  leB.shp').      
-0000ad90: 2020 2020 2020 2020 2020 2020 2020 2320                # 
-0000ada0: 6c6f 6f70 2063 6861 6e67 6520 7468 6520  loop change the 
-0000adb0: 6765 6f6d 6574 7279 0a20 2020 2020 2020  geometry.       
-0000adc0: 2020 2020 2020 2020 2020 2020 2066 6f72               for
-0000add0: 2069 6e64 6578 2c20 5f20 696e 2073 6870   index, _ in shp
-0000ade0: 332e 6974 6572 726f 7773 2829 3a0a 2020  3.iterrows():.  
-0000adf0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000ae00: 2020 2020 2020 706f 6c79 7320 3d20 7368        polys = sh
-0000ae10: 7033 2e67 656f 6d65 7472 792e 696c 6f63  p3.geometry.iloc
-0000ae20: 5b69 6e64 6578 5d20 2320 6765 7420 7468  [index] # get th
-0000ae30: 6520 7368 6170 650a 2020 2020 2020 2020  e shape.        
-0000ae40: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000ae50: 706f 6c79 7320 3d20 7368 6170 656c 792e  polys = shapely.
-0000ae60: 6166 6669 6e69 7479 2e74 7261 6e73 6c61  affinity.transla
-0000ae70: 7465 2870 6f6c 7973 2c20 786f 6666 3d2d  te(polys, xoff=-
-0000ae80: 3336 302e 302c 2079 6f66 663d 302e 302c  360.0, yoff=0.0,
-0000ae90: 207a 6f66 663d 302e 3029 0a20 2020 2020   zoff=0.0).     
-0000aea0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000aeb0: 2020 2073 6870 332e 6765 6f6d 6574 7279     shp3.geometry
-0000aec0: 2e69 6c6f 635b 696e 6465 785d 203d 2070  .iloc[index] = p
-0000aed0: 6f6c 7973 0a20 2020 2020 2020 2020 2020  olys.           
-0000aee0: 2020 2020 2020 2020 2073 6870 332e 746f           shp3.to
-0000aef0: 5f66 696c 6528 7465 6d70 5f64 6972 2b63  _file(temp_dir+c
-0000af00: 6173 655f 6e61 6d65 2b27 5f73 6f75 7263  ase_name+'_sourc
-0000af10: 655f 7368 6170 6566 696c 6543 2e73 6870  e_shapefileC.shp
-0000af20: 2729 0a20 2020 2020 2020 2020 2020 2020  ').             
-0000af30: 2020 2020 2020 2073 6870 3320 3d20 6770         shp3 = gp
-0000af40: 642e 7265 6164 5f66 696c 6528 7465 6d70  d.read_file(temp
-0000af50: 5f64 6972 2b63 6173 655f 6e61 6d65 2b27  _dir+case_name+'
-0000af60: 5f73 6f75 7263 655f 7368 6170 6566 696c  _source_shapefil
-0000af70: 6543 2e73 6870 2729 0a20 2020 2020 2020  eC.shp').       
-0000af80: 2020 2020 2020 2020 2020 2020 2074 656d               tem
-0000af90: 7020 3d20 6770 642e 4765 6f44 6174 6146  p = gpd.GeoDataF
-0000afa0: 7261 6d65 2820 7064 2e63 6f6e 6361 7428  rame( pd.concat(
-0000afb0: 205b 7368 7033 2c73 6870 325d 202c 2069   [shp3,shp2] , i
-0000afc0: 676e 6f72 655f 696e 6465 783d 5472 7565  gnore_index=True
-0000afd0: 2020 2920 290a 2020 2020 2020 2020 2020    ) ).          
-0000afe0: 2020 2020 2020 2020 2020 6966 206e 6f74            if not
-0000aff0: 2073 6870 312e 656d 7074 793a 0a20 2020   shp1.empty:.   
-0000b000: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000b010: 2020 2020 2074 656d 7020 3d20 6770 642e       temp = gpd.
-0000b020: 4765 6f44 6174 6146 7261 6d65 2820 7064  GeoDataFrame( pd
-0000b030: 2e63 6f6e 6361 7428 205b 7465 6d70 2c73  .concat( [temp,s
-0000b040: 6870 315d 202c 2069 676e 6f72 655f 696e  hp1] , ignore_in
-0000b050: 6465 783d 5472 7565 2029 2020 290a 2020  dex=True )  ).  
-0000b060: 2020 2020 2020 2020 2020 2020 2020 7465                te
-0000b070: 6d70 2e74 6f5f 6669 6c65 2874 656d 705f  mp.to_file(temp_
-0000b080: 6469 722b 6361 7365 5f6e 616d 652b 275f  dir+case_name+'_
-0000b090: 736f 7572 6365 5f73 6861 7065 6669 6c65  source_shapefile
-0000b0a0: 5f65 7870 616e 6465 642e 7368 7027 290a  _expanded.shp').
-0000b0b0: 2020 2020 2020 2020 2020 2020 2320 7468              # th
-0000b0c0: 6520 6e65 7463 6466 2066 696c 6520 6861  e netcdf file ha
-0000b0d0: 7320 7661 6c75 6573 2062 6574 7765 656e  s values between
-0000b0e0: 202d 3138 3020 746f 2031 3830 0a20 2020   -180 to 180.   
-0000b0f0: 2020 2020 2020 2020 2065 6c69 6620 6d69           elif mi
-0000b100: 6e20 2873 6870 5b27 6c6f 6e5f 7327 5d29  n (shp['lon_s'])
-0000b110: 203e 202d 3138 3020 616e 6420 6d61 7820   > -180 and max 
-0000b120: 2873 6870 5b27 6c6f 6e5f 7327 5d29 203c  (shp['lon_s']) <
-0000b130: 2031 3830 3a0a 2020 2020 2020 2020 2020   180:.          
-0000b140: 2020 2020 2020 7072 696e 7428 2745 4153        print('EAS
-0000b150: 594d 4f52 4520 6465 6369 6465 7320 7468  YMORE decides th
-0000b160: 6520 6e65 7443 4446 2066 696c 6520 6861  e netCDF file ha
-0000b170: 7320 6c6f 6e67 7469 7475 6465 2076 616c  s longtitude val
-0000b180: 7565 7320 6f66 202d 3138 3020 746f 2031  ues of -180 to 1
-0000b190: 3830 3b20 6372 6561 7469 6e67 2074 6865  80; creating the
-0000b1a0: 2065 7874 656e 6465 6427 290a 2020 2020   extended').    
-0000b1b0: 2020 2020 2020 2020 2020 2020 7368 7031              shp1
-0000b1c0: 203d 2073 6870 205b 7368 705b 276c 6f6e   = shp [shp['lon
-0000b1d0: 5f73 275d 203e 2020 2030 5d0a 2020 2020  _s'] >   0].    
-0000b1e0: 2020 2020 2020 2020 2020 2020 7368 7032              shp2
-0000b1f0: 203d 2073 6870 205b 7368 705b 276c 6f6e   = shp [shp['lon
-0000b200: 5f73 275d 203c 3d20 2030 5d0a 2020 2020  _s'] <=  0].    
-0000b210: 2020 2020 2020 2020 2020 2020 6966 206e              if n
-0000b220: 6f74 2073 6870 312e 656d 7074 793a 0a20  ot shp1.empty:. 
-0000b230: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000b240: 2020 2073 6870 312e 746f 5f66 696c 6528     shp1.to_file(
-0000b250: 7465 6d70 5f64 6972 2b63 6173 655f 6e61  temp_dir+case_na
-0000b260: 6d65 2b27 5f73 6f75 7263 655f 7368 6170  me+'_source_shap
-0000b270: 6566 696c 6541 2e73 6870 2729 0a20 2020  efileA.shp').   
-0000b280: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000b290: 2073 6870 3120 3d20 6770 642e 7265 6164   shp1 = gpd.read
-0000b2a0: 5f66 696c 6528 7465 6d70 5f64 6972 2b63  _file(temp_dir+c
-0000b2b0: 6173 655f 6e61 6d65 2b27 5f73 6f75 7263  ase_name+'_sourc
-0000b2c0: 655f 7368 6170 6566 696c 6541 2e73 6870  e_shapefileA.shp
-0000b2d0: 2729 0a20 2020 2020 2020 2020 2020 2020  ').             
-0000b2e0: 2020 2020 2020 2074 656d 7020 3d20 7368         temp = sh
-0000b2f0: 7031 0a20 2020 2020 2020 2020 2020 2020  p1.             
-0000b300: 2020 2069 6620 6e6f 7420 7368 7032 2e65     if not shp2.e
-0000b310: 6d70 7479 3a0a 2020 2020 2020 2020 2020  mpty:.          
-0000b320: 2020 2020 2020 2020 2020 7368 7032 2e74            shp2.t
-0000b330: 6f5f 6669 6c65 2874 656d 705f 6469 722b  o_file(temp_dir+
-0000b340: 6361 7365 5f6e 616d 652b 275f 736f 7572  case_name+'_sour
-0000b350: 6365 5f73 6861 7065 6669 6c65 422e 7368  ce_shapefileB.sh
-0000b360: 7027 290a 2020 2020 2020 2020 2020 2020  p').            
-0000b370: 2020 2020 2020 2020 7368 7032 203d 2067          shp2 = g
-0000b380: 7064 2e72 6561 645f 6669 6c65 2874 656d  pd.read_file(tem
-0000b390: 705f 6469 722b 6361 7365 5f6e 616d 652b  p_dir+case_name+
-0000b3a0: 275f 736f 7572 6365 5f73 6861 7065 6669  '_source_shapefi
-0000b3b0: 6c65 422e 7368 7027 290a 2020 2020 2020  leB.shp').      
-0000b3c0: 2020 2020 2020 2020 2020 2020 2020 7368                sh
-0000b3d0: 7033 203d 2067 7064 2e72 6561 645f 6669  p3 = gpd.read_fi
-0000b3e0: 6c65 2874 656d 705f 6469 722b 6361 7365  le(temp_dir+case
-0000b3f0: 5f6e 616d 652b 275f 736f 7572 6365 5f73  _name+'_source_s
-0000b400: 6861 7065 6669 6c65 422e 7368 7027 290a  hapefileB.shp').
-0000b410: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000b420: 2020 2020 2320 6c6f 6f70 2063 6861 6e67      # loop chang
-0000b430: 6520 7468 6520 6765 6f6d 6574 7279 0a20  e the geometry. 
-0000b440: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000b450: 2020 2066 6f72 2069 6e64 6578 2c20 5f20     for index, _ 
-0000b460: 696e 2073 6870 332e 6974 6572 726f 7773  in shp3.iterrows
-0000b470: 2829 3a0a 2020 2020 2020 2020 2020 2020  ():.            
-0000b480: 2020 2020 2020 2020 2020 2020 706f 6c79              poly
-0000b490: 7320 3d20 7368 7033 2e67 656f 6d65 7472  s = shp3.geometr
-0000b4a0: 792e 696c 6f63 5b69 6e64 6578 5d20 2320  y.iloc[index] # 
-0000b4b0: 6765 7420 7468 6520 7368 6170 650a 2020  get the shape.  
-0000b4c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000b4d0: 2020 2020 2020 706f 6c79 7320 3d20 7368        polys = sh
-0000b4e0: 6170 656c 792e 6166 6669 6e69 7479 2e74  apely.affinity.t
-0000b4f0: 7261 6e73 6c61 7465 2870 6f6c 7973 2c20  ranslate(polys, 
-0000b500: 786f 6666 3d2b 3336 302e 302c 2079 6f66  xoff=+360.0, yof
-0000b510: 663d 302e 302c 207a 6f66 663d 302e 3029  f=0.0, zoff=0.0)
-0000b520: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0000b530: 2020 2020 2020 2020 2073 6870 332e 6765           shp3.ge
-0000b540: 6f6d 6574 7279 2e69 6c6f 635b 696e 6465  ometry.iloc[inde
-0000b550: 785d 203d 2070 6f6c 7973 0a20 2020 2020  x] = polys.     
-0000b560: 2020 2020 2020 2020 2020 2020 2020 2073                 s
-0000b570: 6870 332e 746f 5f66 696c 6528 7465 6d70  hp3.to_file(temp
-0000b580: 5f64 6972 2b63 6173 655f 6e61 6d65 2b27  _dir+case_name+'
-0000b590: 5f73 6f75 7263 655f 7368 6170 6566 696c  _source_shapefil
-0000b5a0: 6543 2e73 6870 2729 0a20 2020 2020 2020  eC.shp').       
-0000b5b0: 2020 2020 2020 2020 2020 2020 2073 6870               shp
-0000b5c0: 3320 3d20 6770 642e 7265 6164 5f66 696c  3 = gpd.read_fil
-0000b5d0: 6528 7465 6d70 5f64 6972 2b63 6173 655f  e(temp_dir+case_
-0000b5e0: 6e61 6d65 2b27 5f73 6f75 7263 655f 7368  name+'_source_sh
-0000b5f0: 6170 6566 696c 6543 2e73 6870 2729 0a20  apefileC.shp'). 
-0000b600: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000b610: 2020 2074 656d 7020 3d20 6770 642e 4765     temp = gpd.Ge
-0000b620: 6f44 6174 6146 7261 6d65 2820 7064 2e63  oDataFrame( pd.c
-0000b630: 6f6e 6361 7428 205b 7368 7033 2c73 6870  oncat( [shp3,shp
-0000b640: 325d 202c 2069 676e 6f72 655f 696e 6465  2] , ignore_inde
-0000b650: 783d 5472 7565 2020 2920 290a 2020 2020  x=True  ) ).    
-0000b660: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000b670: 6966 206e 6f74 2073 6870 312e 656d 7074  if not shp1.empt
-0000b680: 793a 0a20 2020 2020 2020 2020 2020 2020  y:.             
-0000b690: 2020 2020 2020 2020 2020 2074 656d 7020             temp 
-0000b6a0: 3d20 6770 642e 4765 6f44 6174 6146 7261  = gpd.GeoDataFra
-0000b6b0: 6d65 2820 7064 2e63 6f6e 6361 7428 205b  me( pd.concat( [
-0000b6c0: 7465 6d70 2c73 6870 315d 202c 2069 676e  temp,shp1] , ign
-0000b6d0: 6f72 655f 696e 6465 783d 5472 7565 2029  ore_index=True )
-0000b6e0: 2020 290a 2020 2020 2020 2020 2020 2020    ).            
-0000b6f0: 2020 2020 7465 6d70 2e74 6f5f 6669 6c65      temp.to_file
-0000b700: 2874 656d 705f 6469 722b 6361 7365 5f6e  (temp_dir+case_n
-0000b710: 616d 652b 275f 736f 7572 6365 5f73 6861  ame+'_source_sha
-0000b720: 7065 6669 6c65 5f65 7870 616e 6465 642e  pefile_expanded.
-0000b730: 7368 7027 290a 2020 2020 2020 2020 2020  shp').          
-0000b740: 2020 656c 7365 3a0a 2020 2020 2020 2020    else:.        
-0000b750: 2020 2020 2020 2020 7379 732e 6578 6974          sys.exit
-0000b760: 2827 4541 5359 4d4f 5245 2063 616e 6e6f  ('EASYMORE canno
-0000b770: 7420 6465 6369 6465 2061 626f 7574 2074  t decide about t
-0000b780: 6865 206c 6174 2061 6e64 206c 6f6e 206f  he lat and lon o
-0000b790: 6620 7468 6520 7368 6170 6566 696c 6573  f the shapefiles
-0000b7a0: 2729 0a20 2020 2020 2020 2072 6573 756c  ').        resul
-0000b7b0: 7420 3d20 6770 642e 7265 6164 5f66 696c  t = gpd.read_fil
-0000b7c0: 6528 7465 6d70 5f64 6972 2b63 6173 655f  e(temp_dir+case_
-0000b7d0: 6e61 6d65 2b27 5f73 6f75 7263 655f 7368  name+'_source_sh
-0000b7e0: 6170 6566 696c 655f 6578 7061 6e64 6564  apefile_expanded
-0000b7f0: 2e73 6870 2729 0a20 2020 2020 2020 2072  .shp').        r
-0000b800: 6574 7572 6e20 7265 7375 6c74 0a0a 2020  eturn result..  
-0000b810: 2020 6465 6620 6372 6561 7465 5f72 656d    def create_rem
-0000b820: 6170 2820 2020 7365 6c66 2c0a 2020 2020  ap(   self,.    
-0000b830: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000b840: 2020 2020 696e 745f 6466 2c0a 2020 2020      int_df,.    
-0000b850: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000b860: 2020 2020 6c61 745f 736f 7572 6365 2c0a      lat_source,.
-0000b870: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000b880: 2020 2020 2020 2020 6c6f 6e5f 736f 7572          lon_sour
-0000b890: 6365 293a 0a20 2020 2020 2020 2022 2222  ce):.        """
-0000b8a0: 0a20 2020 2020 2020 2040 2061 7574 686f  .        @ autho
-0000b8b0: 723a 2020 2020 2020 2020 2020 2020 2020  r:              
-0000b8c0: 2020 2020 5368 6572 7661 6e20 4768 6172      Shervan Ghar
-0000b8d0: 6172 690a 2020 2020 2020 2020 4020 4769  ari.        @ Gi
-0000b8e0: 7468 7562 3a20 2020 2020 2020 2020 2020  thub:           
-0000b8f0: 2020 2020 2020 2068 7474 7073 3a2f 2f67         https://g
-0000b900: 6974 6875 622e 636f 6d2f 5368 6572 7661  ithub.com/Sherva
-0000b910: 6e47 6861 7261 7269 2f45 4153 594d 4f52  nGharari/EASYMOR
-0000b920: 450a 2020 2020 2020 2020 4020 6175 7468  E.        @ auth
-0000b930: 6f72 2773 2065 6d61 696c 2069 643a 2020  or's email id:  
-0000b940: 2020 2020 2073 682e 6768 6172 6172 6940       sh.gharari@
-0000b950: 676d 6169 6c2e 636f 6d0a 2020 2020 2020  gmail.com.      
-0000b960: 2020 4020 6c69 6365 6e73 653a 2020 2020    @ license:    
-0000b970: 2020 2020 2020 2020 2020 2020 2047 4e55               GNU
-0000b980: 2d47 504c 7633 0a20 2020 2020 2020 2074  -GPLv3.        t
-0000b990: 6869 7320 6675 6e63 7469 6f6e 2061 6464  his function add
-0000b9a0: 2074 6865 2063 6f72 7265 7370 6f6e 7369   the corresponsi
-0000b9b0: 6e67 2072 6f77 2061 6e64 2063 6f6c 756d  ng row and colum
-0000b9c0: 6e73 2066 726f 6d20 7468 6520 736f 7572  ns from the sour
-0000b9d0: 6365 204e 6574 4344 4620 6669 6c65 0a20  ce NetCDF file. 
-0000b9e0: 2020 2020 2020 2050 6172 616d 6574 6572         Parameter
-0000b9f0: 730a 2020 2020 2020 2020 2d2d 2d2d 2d2d  s.        ------
-0000ba00: 2d2d 2d2d 0a20 2020 2020 2020 2069 6e74  ----.        int
-0000ba10: 5f64 663a 2069 6e74 6572 7365 6374 6564  _df: intersected
-0000ba20: 2064 6174 6120 6672 616d 6520 7468 6174   data frame that
-0000ba30: 2069 6e63 6c75 6465 7320 7468 6520 696e   includes the in
-0000ba40: 6672 6f6d 6174 696f 6e20 666f 7220 736f  fromation for so
-0000ba50: 7572 6365 2061 6e64 2073 696e 6b0a 2020  urce and sink.  
-0000ba60: 2020 2020 2020 6c61 745f 736f 7572 6365        lat_source
-0000ba70: 3a20 6e75 6d70 7920 6172 7261 7920 6f66  : numpy array of
-0000ba80: 2073 6f75 7263 6520 6c61 740a 2020 2020   source lat.    
-0000ba90: 2020 2020 6c6f 6e5f 736f 7572 6365 3a20      lon_source: 
-0000baa0: 6e75 6d70 7920 6172 7261 7920 6f66 2073  numpy array of s
-0000bab0: 6f75 7263 6520 6c6f 6e0a 2020 2020 2020  ource lon.      
-0000bac0: 2020 5265 7475 726e 730a 2020 2020 2020    Returns.      
-0000bad0: 2020 2d2d 2d2d 2d2d 2d0a 2020 2020 2020    -------.      
-0000bae0: 2020 696e 745f 6466 3a20 6461 7461 6672    int_df: datafr
-0000baf0: 616d 652c 2069 6e63 6c75 6469 6e67 2074  ame, including t
-0000bb00: 6865 2061 7373 6f63 6961 7465 6420 726f  he associated ro
-0000bb10: 7773 2061 6e64 2063 6f6c 7320 616e 6420  ws and cols and 
-0000bb20: 4541 5359 4d4f 5245 2063 6173 650a 2020  EASYMORE case.  
-0000bb30: 2020 2020 2020 2222 220a 2020 2020 2020        """.      
-0000bb40: 2020 2320 7468 6520 6c61 7420 6c6f 6e20    # the lat lon 
-0000bb50: 6672 6f6d 2074 6865 2069 6e74 6572 7365  from the interse
-0000bb60: 6374 696f 6e2f 7265 6d61 700a 2020 2020  ction/remap.    
-0000bb70: 2020 2020 6c61 745f 736f 7572 6365 5f69      lat_source_i
-0000bb80: 6e74 203d 206e 702e 6172 7261 7928 696e  nt = np.array(in
-0000bb90: 745f 6466 5b27 6c61 745f 7327 5d29 0a20  t_df['lat_s']). 
-0000bba0: 2020 2020 2020 206c 6f6e 5f73 6f75 7263         lon_sourc
-0000bbb0: 655f 696e 7420 3d20 6e70 2e61 7272 6179  e_int = np.array
-0000bbc0: 2869 6e74 5f64 665b 276c 6f6e 5f73 275d  (int_df['lon_s']
-0000bbd0: 290a 2020 2020 2020 2020 2320 6361 6c6c  ).        # call
-0000bbe0: 2067 6574 2072 6f77 2061 6e64 2063 6f6c   get row and col
-0000bbf0: 2066 756e 6374 696f 6e0a 2020 2020 2020   function.      
-0000bc00: 2020 726f 7773 2c20 636f 6c73 203d 2073    rows, cols = s
-0000bc10: 656c 662e 6372 6561 7465 5f72 6f77 5f63  elf.create_row_c
-0000bc20: 6f6c 5f64 6620 286c 6174 5f73 6f75 7263  ol_df (lat_sourc
-0000bc30: 652c 206c 6f6e 5f73 6f75 7263 652c 206c  e, lon_source, l
-0000bc40: 6174 5f73 6f75 7263 655f 696e 742c 206c  at_source_int, l
-0000bc50: 6f6e 5f73 6f75 7263 655f 696e 7429 0a20  on_source_int). 
-0000bc60: 2020 2020 2020 2023 2061 6464 2072 6f77         # add row
-0000bc70: 7320 616e 6420 636f 6c75 6d6e 730a 2020  s and columns.  
-0000bc80: 2020 2020 2020 696e 745f 6466 5b27 726f        int_df['ro
-0000bc90: 7773 275d 203d 2072 6f77 730a 2020 2020  ws'] = rows.    
-0000bca0: 2020 2020 696e 745f 6466 5b27 636f 6c73      int_df['cols
-0000bcb0: 275d 203d 2063 6f6c 730a 2020 2020 2020  '] = cols.      
-0000bcc0: 2020 2320 7061 7373 2074 6865 2063 6173    # pass the cas
-0000bcd0: 6520 746f 2074 6865 2072 656d 6170 5f64  e to the remap_d
-0000bce0: 660a 2020 2020 2020 2020 696e 745f 6466  f.        int_df
-0000bcf0: 5b27 6561 7379 6d6f 7265 5f63 6173 6527  ['easymore_case'
-0000bd00: 5d20 3d20 7365 6c66 2e63 6173 650a 2020  ] = self.case.  
-0000bd10: 2020 2020 2020 2320 7361 7665 2072 656d        # save rem
-0000bd20: 6170 5f64 6620 6173 2063 7376 2066 6f72  ap_df as csv for
-0000bd30: 2066 7574 7572 6520 7573 650a 2020 2020   future use.    
-0000bd40: 2020 2020 7265 7475 726e 2069 6e74 5f64      return int_d
-0000bd50: 660a 0a20 2020 2064 6566 2063 7265 6174  f..    def creat
-0000bd60: 655f 726f 775f 636f 6c5f 6466 2028 2073  e_row_col_df ( s
-0000bd70: 656c 662c 0a20 2020 2020 2020 2020 2020  elf,.           
-0000bd80: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000bd90: 206c 6174 5f73 6f75 7263 652c 0a20 2020   lat_source,.   
-0000bda0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000bdb0: 2020 2020 2020 2020 206c 6f6e 5f73 6f75           lon_sou
-0000bdc0: 7263 652c 0a20 2020 2020 2020 2020 2020  rce,.           
+00000100: 6d65 0a69 6d70 6f72 7420 7265 0a69 6d70  me.import re.imp
+00000110: 6f72 7420 6a73 6f6e 0a0a 0a63 6c61 7373  ort json...class
+00000120: 2065 6173 796d 6f72 653a 0a0a 2020 2020   easymore:..    
+00000130: 6465 6620 5f5f 696e 6974 5f5f 2873 656c  def __init__(sel
+00000140: 6629 3a0a 2020 2020 2020 2020 7365 6c66  f):.        self
+00000150: 2e64 656c 6574 5f61 7474 7228 2920 2020  .delet_attr()   
+00000160: 2020 2020 2020 2020 2020 2020 2020 2320                # 
+00000170: 7265 6d6f 7665 2074 6865 2065 7869 7374  remove the exist
+00000180: 696e 6720 7661 7269 6162 6c65 730a 2020  ing variables.  
+00000190: 2020 2020 2020 7365 6c66 2e63 6173 655f        self.case_
+000001a0: 6e61 6d65 2020 2020 2020 2020 2020 2020  name            
+000001b0: 2020 2020 203d 2020 2763 6173 655f 7465       =  'case_te
+000001c0: 6d70 2720 2320 6e61 6d65 206f 6620 7468  mp' # name of th
+000001d0: 6520 6361 7365 0a20 2020 2020 2020 2073  e case.        s
+000001e0: 656c 662e 7461 7267 6574 5f73 6870 2020  elf.target_shp  
+000001f0: 2020 2020 2020 2020 2020 2020 2020 3d20                = 
+00000200: 2027 2720 2320 7369 6e6b 2f74 6172 6765   '' # sink/targe
+00000210: 7420 7368 6170 6566 696c 650a 2020 2020  t shapefile.    
+00000220: 2020 2020 7365 6c66 2e74 6172 6765 745f      self.target_
+00000230: 7368 705f 4944 2020 2020 2020 2020 2020  shp_ID          
+00000240: 2020 203d 2020 2727 2023 206e 616d 6520     =  '' # name 
+00000250: 6f66 2074 6865 2063 6f6c 756d 6e20 4944  of the column ID
+00000260: 2069 6e20 7468 6520 7369 6e6b 2f74 6172   in the sink/tar
+00000270: 6765 7420 7368 6170 6566 696c 650a 2020  get shapefile.  
+00000280: 2020 2020 2020 7365 6c66 2e74 6172 6765        self.targe
+00000290: 745f 7368 705f 6c61 7420 2020 2020 2020  t_shp_lat       
+000002a0: 2020 2020 203d 2020 2727 2023 206e 616d       =  '' # nam
+000002b0: 6520 6f66 2074 6865 2063 6f6c 756d 6e20  e of the column 
+000002c0: 6c61 7469 7475 6465 2069 6e20 7468 6520  latitude in the 
+000002d0: 7369 6e6b 2f74 6172 6765 7420 7368 6170  sink/target shap
+000002e0: 6566 696c 650a 2020 2020 2020 2020 7365  efile.        se
+000002f0: 6c66 2e74 6172 6765 745f 7368 705f 6c6f  lf.target_shp_lo
+00000300: 6e20 2020 2020 2020 2020 2020 203d 2020  n            =  
+00000310: 2727 2023 206e 616d 6520 6f66 2074 6865  '' # name of the
+00000320: 2063 6f6c 756d 6e20 6c6f 6e67 6974 7564   column longitud
+00000330: 6520 696e 2074 6865 2073 696e 6b2f 7461  e in the sink/ta
+00000340: 7267 6574 2073 6861 7065 6669 6c65 0a20  rget shapefile. 
+00000350: 2020 2020 2020 2073 656c 662e 736f 7572         self.sour
+00000360: 6365 5f6e 6320 2020 2020 2020 2020 2020  ce_nc           
+00000370: 2020 2020 2020 3d20 2027 2720 2320 6e61        =  '' # na
+00000380: 6d65 206f 6620 6e63 2066 696c 6520 746f  me of nc file to
+00000390: 2062 6520 7265 6d61 7070 6564 0a20 2020   be remapped.   
+000003a0: 2020 2020 2073 656c 662e 7661 725f 6e61       self.var_na
+000003b0: 6d65 7320 2020 2020 2020 2020 2020 2020  mes             
+000003c0: 2020 2020 3d20 205b 5d20 2320 6c69 7374      =  [] # list
+000003d0: 206f 6620 7661 7269 6162 6c65 206e 616d   of variable nam
+000003e0: 6573 2074 6f20 6265 2072 656d 6170 7065  es to be remappe
+000003f0: 6420 6672 6f6d 2074 6865 2073 6f75 7263  d from the sourc
+00000400: 6520 4e65 7443 4446 2066 696c 650a 2020  e NetCDF file.  
+00000410: 2020 2020 2020 7365 6c66 2e76 6172 5f6c        self.var_l
+00000420: 6f6e 2020 2020 2020 2020 2020 2020 2020  on              
+00000430: 2020 2020 203d 2020 2727 2023 206e 616d       =  '' # nam
+00000440: 6520 6f66 2076 6172 6961 626c 6520 6c6f  e of variable lo
+00000450: 6e67 6974 7564 6520 696e 2074 6865 2073  ngitude in the s
+00000460: 6f75 7263 6520 4e65 7443 4446 2066 696c  ource NetCDF fil
+00000470: 650a 2020 2020 2020 2020 7365 6c66 2e76  e.        self.v
+00000480: 6172 5f6c 6174 2020 2020 2020 2020 2020  ar_lat          
+00000490: 2020 2020 2020 2020 203d 2020 2727 2023           =  '' #
+000004a0: 206e 616d 6520 6f66 2076 6172 6961 626c   name of variabl
+000004b0: 6520 6c61 7469 7475 6465 2069 6e20 7468  e latitude in th
+000004c0: 6520 736f 7572 6365 204e 6574 4344 4620  e source NetCDF 
+000004d0: 6669 6c65 0a20 2020 2020 2020 2073 656c  file.        sel
+000004e0: 662e 7661 725f 7469 6d65 2020 2020 2020  f.var_time      
+000004f0: 2020 2020 2020 2020 2020 2020 3d20 2027              =  '
+00000500: 7469 6d65 2720 2320 6e61 6d65 206f 6620  time' # name of 
+00000510: 7661 7269 6162 6c65 2074 696d 6520 696e  variable time in
+00000520: 2074 6865 2073 6f75 7263 6520 4e65 7443   the source NetC
+00000530: 4446 2066 696c 650a 2020 2020 2020 2020  DF file.        
+00000540: 7365 6c66 2e76 6172 5f49 4420 2020 2020  self.var_ID     
+00000550: 2020 2020 2020 2020 2020 2020 2020 203d                 =
+00000560: 2020 2727 2023 206e 616d 6520 6f66 2076    '' # name of v
+00000570: 6172 6961 626c 6520 4944 2069 6e20 7468  ariable ID in th
+00000580: 6520 736f 7572 6365 204e 6574 4344 4620  e source NetCDF 
+00000590: 6669 6c65 0a20 2020 2020 2020 2073 656c  file.        sel
+000005a0: 662e 7661 725f 7374 6174 696f 6e20 2020  f.var_station   
+000005b0: 2020 2020 2020 2020 2020 2020 3d20 2027              =  '
+000005c0: 2720 2320 6e61 6d65 206f 6620 7661 7269  ' # name of vari
+000005d0: 6162 6c65 2073 7461 7469 6f6e 2069 6e20  able station in 
+000005e0: 7468 6520 736f 7572 6365 204e 6574 4344  the source NetCD
+000005f0: 4620 6669 6c65 0a20 2020 2020 2020 2073  F file.        s
+00000600: 656c 662e 7661 725f 6e61 6d65 735f 7265  elf.var_names_re
+00000610: 6d61 7070 6564 2020 2020 2020 2020 3d20  mapped        = 
+00000620: 205b 5d20 2320 6c69 7374 206f 6620 7661   [] # list of va
+00000630: 7269 6162 6c65 206e 616d 6573 2074 6861  riable names tha
+00000640: 7420 7769 6c6c 2062 6520 7265 706c 6163  t will be replac
+00000650: 6564 2069 6e20 7468 6520 7265 6d61 7070  ed in the remapp
+00000660: 6564 2066 696c 650a 2020 2020 2020 2020  ed file.        
+00000670: 7365 6c66 2e73 6b69 705f 6368 6563 6b5f  self.skip_check_
+00000680: 616c 6c5f 736f 7572 6365 5f6e 6320 203d  all_source_nc  =
+00000690: 2020 4661 6c73 6520 2320 6966 2073 6574    False # if set
+000006a0: 2074 6f20 5472 7565 206f 6e6c 7920 6669   to True only fi
+000006b0: 7273 7420 6669 6c65 2077 696c 6c20 6265  rst file will be
+000006c0: 2063 6865 636b 2066 6f72 2076 6172 6961   check for varia
+000006d0: 626c 6573 2061 6e64 2064 696d 656e 7369  bles and dimensi
+000006e0: 6f6e 7320 616e 6420 6e6f 7420 7468 6520  ons and not the 
+000006f0: 616c 6c20 7468 6520 6669 6c65 7320 2872  all the files (r
+00000700: 6563 6f6d 6d6e 6564 6564 206e 6f74 2074  ecommneded not t
+00000710: 6f20 6368 616e 6765 290a 2020 2020 2020  o change).      
+00000720: 2020 7365 6c66 2e73 6f75 7263 655f 7368    self.source_sh
+00000730: 7020 2020 2020 2020 2020 2020 2020 2020  p               
+00000740: 203d 2020 2727 2023 206e 616d 6520 6f66   =  '' # name of
+00000750: 2073 6f75 7263 6520 7368 6170 6566 696c   source shapefil
+00000760: 6520 2865 7373 656e 7469 616c 2066 6f72  e (essential for
+00000770: 2063 6173 652d 3329 0a20 2020 2020 2020   case-3).       
+00000780: 2073 656c 662e 736f 7572 6365 5f73 6870   self.source_shp
+00000790: 5f6c 6174 2020 2020 2020 2020 2020 2020  _lat            
+000007a0: 3d20 2027 2720 2320 6e61 6d65 206f 6620  =  '' # name of 
+000007b0: 636f 6c75 6d6e 206c 6174 6974 7564 6520  column latitude 
+000007c0: 696e 2074 6865 2073 6f75 7263 6520 7368  in the source sh
+000007d0: 6170 6566 696c 650a 2020 2020 2020 2020  apefile.        
+000007e0: 7365 6c66 2e73 6f75 7263 655f 7368 705f  self.source_shp_
+000007f0: 6c6f 6e20 2020 2020 2020 2020 2020 203d  lon            =
+00000800: 2020 2727 2023 206e 616d 6520 6f66 2063    '' # name of c
+00000810: 6f6c 756d 6e20 6c6f 6e67 6974 7564 6520  olumn longitude 
+00000820: 696e 2074 6865 2073 6f75 7263 6520 7368  in the source sh
+00000830: 6170 6566 696c 650a 2020 2020 2020 2020  apefile.        
+00000840: 7365 6c66 2e73 6f75 7263 655f 7368 705f  self.source_shp_
+00000850: 4944 2020 2020 2020 2020 2020 2020 203d  ID             =
+00000860: 2020 2727 2023 206e 616d 6520 6f66 2063    '' # name of c
+00000870: 6f6c 756d 6e20 4944 2069 6e20 7468 6520  olumn ID in the 
+00000880: 736f 7572 6365 2073 6861 7065 6669 6c65  source shapefile
+00000890: 0a20 2020 2020 2020 2073 656c 662e 7265  .        self.re
+000008a0: 6d61 7070 6564 5f76 6172 5f69 6420 2020  mapped_var_id   
+000008b0: 2020 2020 2020 2020 3d20 2027 4944 2720          =  'ID' 
+000008c0: 2320 6e61 6d65 206f 6620 7468 6520 4944  # name of the ID
+000008d0: 2076 6172 6961 626c 6520 696e 2074 6865   variable in the
+000008e0: 206e 6577 206e 6320 6669 6c65 3b20 6465   new nc file; de
+000008f0: 6661 756c 7420 2749 4427 0a20 2020 2020  fault 'ID'.     
+00000900: 2020 2073 656c 662e 7265 6d61 7070 6564     self.remapped
+00000910: 5f76 6172 5f6c 6174 2020 2020 2020 2020  _var_lat        
+00000920: 2020 3d20 2027 6c61 7469 7475 6465 2720    =  'latitude' 
+00000930: 2320 6e61 6d65 206f 6620 7468 6520 6c61  # name of the la
+00000940: 7469 7475 6465 2076 6172 6961 626c 6520  titude variable 
+00000950: 696e 2074 6865 206e 6577 206e 6320 6669  in the new nc fi
+00000960: 6c65 3b20 6465 6661 756c 7420 276c 6174  le; default 'lat
+00000970: 6974 7564 6527 0a20 2020 2020 2020 2073  itude'.        s
+00000980: 656c 662e 7265 6d61 7070 6564 5f76 6172  elf.remapped_var
+00000990: 5f6c 6f6e 2020 2020 2020 2020 2020 3d20  _lon          = 
+000009a0: 2027 6c6f 6e67 6974 7564 6527 2023 206e   'longitude' # n
+000009b0: 616d 6520 6f66 2074 6865 206c 6f6e 6769  ame of the longi
+000009c0: 7475 6465 2076 6172 6961 626c 6520 696e  tude variable in
+000009d0: 2074 6865 206e 6577 206e 6320 6669 6c65   the new nc file
+000009e0: 3b20 6465 6661 756c 7420 276c 6f6e 6769  ; default 'longi
+000009f0: 7475 6465 270a 2020 2020 2020 2020 7365  tude'.        se
+00000a00: 6c66 2e72 656d 6170 7065 645f 6469 6d5f  lf.remapped_dim_
+00000a10: 6964 2020 2020 2020 2020 2020 203d 2020  id           =  
+00000a20: 2749 4427 2023 206e 616d 6520 6f66 2074  'ID' # name of t
+00000a30: 6865 2049 4420 6469 6d65 6e73 696f 6e20  he ID dimension 
+00000a40: 696e 2074 6865 206e 6577 206e 6320 6669  in the new nc fi
+00000a50: 6c65 3b20 6465 6661 756c 7420 2749 4427  le; default 'ID'
+00000a60: 0a20 2020 2020 2020 2073 656c 662e 7265  .        self.re
+00000a70: 6d61 7070 6564 5f63 6875 6e6b 5f73 697a  mapped_chunk_siz
+00000a80: 6520 2020 2020 2020 3d20 2032 3030 2023  e       =  200 #
+00000a90: 2063 6875 6e6b 7369 7a65 206f 6620 7265   chunksize of re
+00000aa0: 6d61 7070 6564 2076 6172 6961 626c 6573  mapped variables
+00000ab0: 2069 6e20 7468 6520 6e6f 6e2d 7469 6d65   in the non-time
+00000ac0: 2028 692e 652e 206c 696d 6974 6564 2920   (i.e. limited) 
+00000ad0: 6469 6d65 6e73 696f 6e2e 2044 6566 6175  dimension. Defau
+00000ae0: 6c74 2032 3030 2e20 5573 6520 274e 6f6e  lt 200. Use 'Non
+00000af0: 6527 2066 6f72 206e 6574 4344 4634 2064  e' for netCDF4 d
+00000b00: 6566 6175 6c74 730a 2020 2020 2020 2020  efaults.        
+00000b10: 7365 6c66 2e6f 7665 7277 7269 7465 5f72  self.overwrite_r
+00000b20: 656d 6170 7065 645f 6e63 2020 2020 203d  emapped_nc     =
+00000b30: 2020 5472 7565 2023 2046 6c61 6720 746f    True # Flag to
+00000b40: 2061 7574 6f6d 6174 6963 616c 6c79 206f   automatically o
+00000b50: 7665 7277 7269 7465 2065 7869 7374 696e  verwrite existin
+00000b60: 6720 7265 6d61 7070 696e 6720 6669 6c65  g remapping file
+00000b70: 732e 2049 6620 2746 616c 7365 272c 2061  s. If 'False', a
+00000b80: 626f 7274 7320 7468 6520 7265 6d61 7070  borts the remapp
+00000b90: 696e 6720 7072 6f63 6564 7572 6520 6966  ing procedure if
+00000ba0: 2061 2066 696c 6520 6973 2064 6574 6563   a file is detec
+00000bb0: 7465 640a 2020 2020 2020 2020 7365 6c66  ted.        self
+00000bc0: 2e74 656d 705f 6469 7220 2020 2020 2020  .temp_dir       
+00000bd0: 2020 2020 2020 2020 2020 203d 2020 272e             =  '.
+00000be0: 2f74 656d 702f 2720 2320 7465 6d70 5f64  /temp/' # temp_d
+00000bf0: 6972 0a20 2020 2020 2020 2073 656c 662e  ir.        self.
+00000c00: 6f75 7470 7574 5f64 6972 2020 2020 2020  output_dir      
+00000c10: 2020 2020 2020 2020 2020 3d20 2027 2e2f            =  './
+00000c20: 6f75 7470 7574 2f27 2023 206f 7574 7075  output/' # outpu
+00000c30: 7420 6469 7265 6374 6f72 790a 2020 2020  t directory.    
+00000c40: 2020 2020 7365 6c66 2e66 6f72 6d61 745f      self.format_
+00000c50: 6c69 7374 2020 2020 2020 2020 2020 2020  list            
+00000c60: 2020 203d 2020 5b27 6638 275d 2023 2066     =  ['f8'] # f
+00000c70: 6c6f 6174 2066 6f72 2074 6865 2072 656d  loat for the rem
+00000c80: 6170 7065 6420 7661 6c75 6573 0a20 2020  apped values.   
+00000c90: 2020 2020 2073 656c 662e 6669 6c6c 5f76       self.fill_v
+00000ca0: 616c 7565 5f6c 6973 7420 2020 2020 2020  alue_list       
+00000cb0: 2020 2020 3d20 205b 272d 3939 3939 275d      =  ['-9999']
+00000cc0: 2023 206d 6973 7369 6e67 2076 616c 7565   # missing value
+00000cd0: 7320 7365 7420 746f 202d 3939 3939 0a20  s set to -9999. 
+00000ce0: 2020 2020 2020 2073 656c 662e 7265 6d61         self.rema
+00000cf0: 705f 6373 7620 2020 2020 2020 2020 2020  p_csv           
+00000d00: 2020 2020 2020 3d20 2027 2720 2320 6e61        =  '' # na
+00000d10: 6d65 206f 6620 7468 6520 7265 6d61 7070  me of the remapp
+00000d20: 6564 2066 696c 6520 6966 2070 726f 7669  ed file if provi
+00000d30: 6465 640a 2020 2020 2020 2020 7365 6c66  ded.        self
+00000d40: 2e6f 6e6c 795f 6372 6561 7465 5f72 656d  .only_create_rem
+00000d50: 6170 5f63 7376 2020 2020 203d 2020 4661  ap_csv     =  Fa
+00000d60: 6c73 6520 2320 6973 2074 7275 6520 6974  lse # is true it
+00000d70: 2064 6f65 7320 6e6f 7420 7265 6d61 7020   does not remap 
+00000d80: 616e 7920 6e63 2066 696c 6573 0a20 2020  any nc files.   
+00000d90: 2020 2020 2073 656c 662e 636c 6970 5f73       self.clip_s
+00000da0: 6f75 7263 655f 7368 7020 2020 2020 2020  ource_shp       
+00000db0: 2020 2020 3d20 2054 7275 6520 2320 7468      =  True # th
+00000dc0: 6520 736f 7572 6365 2073 6861 7065 6669  e source shapefi
+00000dd0: 6c65 2069 7320 636c 6970 7065 6420 746f  le is clipped to
+00000de0: 2074 6865 2064 6f6d 6169 6e20 6f66 2074   the domain of t
+00000df0: 6172 6765 7420 7368 6170 6566 696c 6520  arget shapefile 
+00000e00: 746f 2069 6e63 7265 6173 6520 696e 7465  to increase inte
+00000e10: 7273 6563 7469 6f6e 2073 7065 6564 0a20  rsection speed. 
+00000e20: 2020 2020 2020 2073 656c 662e 6275 6666         self.buff
+00000e30: 6572 5f63 6c69 705f 736f 7572 6365 5f73  er_clip_source_s
+00000e40: 6870 2020 2020 3d20 2032 2020 2320 3220  hp    =  2  # 2 
+00000e50: 6465 6772 6565 7320 666f 7220 6275 6666  degrees for buff
+00000e60: 6572 2074 6f20 636c 6970 2074 6865 2073  er to clip the s
+00000e70: 6f75 7263 6520 7368 6170 6566 696c 6520  ource shapefile 
+00000e80: 6261 7365 6420 6f6e 2074 6172 6765 7420  based on target 
+00000e90: 7368 6170 6566 696c 650a 2020 2020 2020  shapefile.      
+00000ea0: 2020 7365 6c66 2e73 6176 655f 7465 6d70    self.save_temp
+00000eb0: 5f73 6870 2020 2020 2020 2020 2020 2020  _shp            
+00000ec0: 203d 2020 5472 7565 2023 2069 6620 7365   =  True # if se
+00000ed0: 7420 746f 2066 616c 7365 2064 6f65 7320  t to false does 
+00000ee0: 6e6f 7420 7361 7665 2074 6865 2074 656d  not save the tem
+00000ef0: 706f 7261 7279 2073 6861 7065 6669 6c65  porary shapefile
+00000f00: 2069 6e20 7468 6520 7465 6d70 2066 6f6c   in the temp fol
+00000f10: 6465 7220 666f 7220 6c61 7267 6520 7368  der for large sh
+00000f20: 6170 6566 696c 6573 0a20 2020 2020 2020  apefiles.       
+00000f30: 2073 656c 662e 636f 7272 6563 7469 6f6e   self.correction
+00000f40: 5f73 6870 5f6c 6f6e 2020 2020 2020 2020  _shp_lon        
+00000f50: 3d20 2054 7275 6520 2320 636f 7272 6563  =  True # correc
+00000f60: 7420 666f 7220 2d31 3830 2074 6f20 3138  t for -180 to 18
+00000f70: 3020 616e 6420 3020 746f 2033 3630 206c  0 and 0 to 360 l
+00000f80: 6f6e 6769 7475 6465 0a20 2020 2020 2020  ongitude.       
+00000f90: 2073 656c 662e 7265 7363 616c 6564 7765   self.rescaledwe
+00000fa0: 6967 6874 7320 2020 2020 2020 2020 2020  ights           
+00000fb0: 3d20 2054 7275 6520 2320 6966 2073 6574  =  True # if set
+00000fc0: 2074 7275 6520 7468 6520 7765 6967 6874   true the weight
+00000fd0: 7320 6172 6520 7265 7363 616c 6564 0a20  s are rescaled. 
+00000fe0: 2020 2020 2020 2073 656c 662e 736b 6970         self.skip
+00000ff0: 5f6f 7574 7369 6465 5f73 6861 7065 2020  _outside_shape  
+00001000: 2020 2020 2020 3d20 2046 616c 7365 2023        =  False #
+00001010: 2069 6620 7365 7420 746f 2054 7275 6520   if set to True 
+00001020: 6974 2077 696c 6c20 6e6f 7420 6361 7272  it will not carr
+00001030: 7920 7468 6520 6e61 6e20 7661 6c75 6573  y the nan values
+00001040: 2066 6f72 2073 6861 7065 7320 7468 6174   for shapes that
+00001050: 2061 7265 206f 7574 7369 6465 2074 6865   are outside the
+00001060: 2073 6f75 7263 6520 6e65 7443 4446 2067   source netCDF g
+00001070: 656f 6772 6170 6869 6361 6c20 646f 6d61  eographical doma
+00001080: 696e 0a20 2020 2020 2020 2073 656c 662e  in.        self.
+00001090: 6175 7468 6f72 5f6e 616d 6520 2020 2020  author_name     
+000010a0: 2020 2020 2020 2020 2020 3d20 2027 2720            =  '' 
+000010b0: 2320 6e61 6d65 206f 6620 7468 6520 6175  # name of the au
+000010c0: 7468 6f75 720a 2020 2020 2020 2020 7365  thour.        se
+000010d0: 6c66 2e6c 6963 656e 7365 2020 2020 2020  lf.license      
+000010e0: 2020 2020 2020 2020 2020 2020 203d 2020               =  
+000010f0: 2727 2023 2064 6174 6120 6c69 6365 6e73  '' # data licens
+00001100: 650a 2020 2020 2020 2020 7365 6c66 2e74  e.        self.t
+00001110: 6f6c 6572 616e 6365 2020 2020 2020 2020  olerance        
+00001120: 2020 2020 2020 2020 203d 2020 3130 2a2a           =  10**
+00001130: 2d35 2023 2074 6f6c 6572 616e 6365 0a20  -5 # tolerance. 
+00001140: 2020 2020 2020 2073 656c 662e 7361 7665         self.save
+00001150: 5f63 7376 2020 2020 2020 2020 2020 2020  _csv            
+00001160: 2020 2020 2020 3d20 2046 616c 7365 2023        =  False #
+00001170: 2073 6176 6520 6373 760a 2020 2020 2020   save csv.      
+00001180: 2020 7365 6c66 2e73 6f72 745f 4944 2020    self.sort_ID  
+00001190: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000011a0: 203d 2020 4661 6c73 6520 2320 746f 2073   =  False # to s
+000011b0: 6f72 7420 7468 6520 7265 6d61 7070 6564  ort the remapped
+000011c0: 2062 6173 6564 206f 6e20 7468 6520 7461   based on the ta
+000011d0: 7267 6574 2073 6861 7066 696c 6520 4944  rget shapfile ID
+000011e0: 3b20 7365 6c66 2e74 6172 6765 745f 7368  ; self.target_sh
+000011f0: 705f 4944 2073 686f 756c 6420 6265 2067  p_ID should be g
+00001200: 6976 656e 0a20 2020 2020 2020 2073 656c  iven.        sel
+00001210: 662e 636f 6d70 6c65 7665 6c20 2020 2020  f.complevel     
+00001220: 2020 2020 2020 2020 2020 2020 3d20 2034              =  4
+00001230: 2023 206e 6574 6364 6620 636f 6d70 7265   # netcdf compre
+00001240: 7373 696f 6e20 6c65 7665 6c20 6672 6f6d  ssion level from
+00001250: 2031 2074 6f20 392e 2041 6e79 206f 7468   1 to 9. Any oth
+00001260: 6572 2076 616c 7565 206f 7220 6f62 6a65  er value or obje
+00001270: 6374 2077 696c 6c20 6d65 616e 206e 6f20  ct will mean no 
+00001280: 636f 6d70 7265 7373 696f 6e2e 0a20 2020  compression..   
+00001290: 2020 2020 2073 656c 662e 7665 7273 696f       self.versio
+000012a0: 6e20 2020 2020 2020 2020 2020 2020 2020  n               
+000012b0: 2020 2020 3d20 2027 312e 302e 3027 2023      =  '1.0.0' #
+000012c0: 2076 6572 7369 6f6e 206f 6620 7468 6520   version of the 
+000012d0: 6561 7379 6d6f 7265 0a20 2020 2020 2020  easymore.       
+000012e0: 2070 7269 6e74 2827 4541 5359 4d4f 5245   print('EASYMORE
+000012f0: 2076 6572 7369 6f6e 2027 2b73 656c 662e   version '+self.
+00001300: 7665 7273 696f 6e2b 2027 2069 7320 696e  version+ ' is in
+00001310: 6974 6961 7465 642e 2729 0a0a 0a20 2020  itiated.')...   
+00001320: 2023 2323 2323 2323 2323 2323 2323 2323   ###############
+00001330: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+00001340: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+00001350: 2323 2323 2323 2323 2323 2323 2323 230a  ###############.
+00001360: 2020 2020 2323 2323 2043 6f6e 6669 6775      #### Configu
+00001370: 7261 7469 6f6e 2066 726f 6d20 6a73 6f6e  ration from json
+00001380: 2066 696c 650a 2020 2020 2323 2323 2323   file.    ######
+00001390: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+000013a0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+000013b0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+000013c0: 2323 2323 2323 2323 0a0a 2020 2020 6465  ########..    de
+000013d0: 6620 6465 6c65 745f 6174 7472 2873 656c  f delet_attr(sel
+000013e0: 6629 3a0a 2020 2020 2020 2020 2320 7265  f):.        # re
+000013f0: 6d6f 7665 2061 7474 7269 6275 7465 7320  move attributes 
+00001400: 7468 6174 2061 7265 206e 6f74 2066 756e  that are not fun
+00001410: 6374 696f 6e20 6672 6f6d 2074 6865 2065  ction from the e
+00001420: 6173 796d 6f72 6520 6f62 6a65 6374 2066  asymore object f
+00001430: 6f72 2069 6e69 7469 616c 697a 6174 696f  or initializatio
+00001440: 6e0a 2020 2020 2020 2020 666f 7220 6c61  n.        for la
+00001450: 6265 6c20 696e 2076 6172 7328 7365 6c66  bel in vars(self
+00001460: 292e 6b65 7973 2829 3a0a 2020 2020 2020  ).keys():.      
+00001470: 2020 2020 2020 6465 6c61 7474 7228 7365        delattr(se
+00001480: 6c66 2c20 6c29 0a20 2020 2020 2020 2020  lf, l).         
+00001490: 2020 2070 7269 6e74 2827 6465 6c65 7465     print('delete
+000014a0: 6420 272c 206c 290a 0a20 2020 2064 6566  d ', l)..    def
+000014b0: 2072 6561 645f 636f 6e66 6967 5f64 6963   read_config_dic
+000014c0: 7420 2873 656c 662c 0a20 2020 2020 2020  t (self,.       
+000014d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000014e0: 2020 2063 6f6e 6669 675f 6669 6c65 5f6e     config_file_n
+000014f0: 616d 6529 3a0a 0a20 2020 2020 2020 2022  ame):..        "
+00001500: 2222 0a20 2020 2020 2020 2040 2061 7574  "".        @ aut
+00001510: 686f 723a 2020 2020 2020 2020 2020 2020  hor:            
+00001520: 2020 2020 2020 5368 6572 7661 6e20 4768        Shervan Gh
+00001530: 6172 6172 690a 2020 2020 2020 2020 4020  arari.        @ 
+00001540: 4769 7468 7562 3a20 2020 2020 2020 2020  Github:         
+00001550: 2020 2020 2020 2020 2068 7474 7073 3a2f           https:/
+00001560: 2f67 6974 6875 622e 636f 6d2f 5368 6572  /github.com/Sher
+00001570: 7661 6e47 6861 7261 7269 2f45 4153 594d  vanGharari/EASYM
+00001580: 4f52 450a 2020 2020 2020 2020 4020 6175  ORE.        @ au
+00001590: 7468 6f72 2773 2065 6d61 696c 2069 643a  thor's email id:
+000015a0: 2020 2020 2020 2073 682e 6768 6172 6172         sh.gharar
+000015b0: 6940 676d 6169 6c2e 636f 6d0a 2020 2020  i@gmail.com.    
+000015c0: 2020 2020 4020 6c69 6365 6e73 653a 2020      @ license:  
+000015d0: 2020 2020 2020 2020 2020 2020 2020 2047                 G
+000015e0: 4e55 2d47 504c 7633 0a20 2020 2020 2020  NU-GPLv3.       
+000015f0: 2054 6869 7320 6675 6e63 7469 6f6e 2072   This function r
+00001600: 6561 6420 6120 6a73 6f6e 2066 696c 650a  ead a json file.
+00001610: 2020 2020 2020 2020 636f 6e66 6967 5f66          config_f
+00001620: 696c 655f 6e61 6d65 3a20 6e61 6d65 206f  ile_name: name o
+00001630: 6620 7468 650a 2020 2020 2020 2020 2222  f the.        ""
+00001640: 220a 2020 2020 2020 2020 2320 7265 6164  ".        # read
+00001650: 696e 6720 7468 6520 6461 7461 2066 726f  ing the data fro
+00001660: 6d20 7468 6520 6669 6c65 0a20 2020 2020  m the file.     
+00001670: 2020 2077 6974 6820 6f70 656e 2863 6f6e     with open(con
+00001680: 6669 675f 6669 6c65 5f6e 616d 6529 2061  fig_file_name) a
+00001690: 7320 663a 0a20 2020 2020 2020 2020 2020  s f:.           
+000016a0: 2064 6174 6120 3d20 662e 7265 6164 2829   data = f.read()
+000016b0: 0a20 2020 2020 2020 2023 2072 6563 6f6e  .        # recon
+000016c0: 7374 7275 6374 696e 6720 7468 6520 6461  structing the da
+000016d0: 7461 2061 7320 6120 6a73 6f6e 0a20 2020  ta as a json.   
+000016e0: 2020 2020 2063 6f6e 6669 675f 6469 6374       config_dict
+000016f0: 203d 206a 736f 6e2e 6c6f 6164 7328 6461   = json.loads(da
+00001700: 7461 290a 2020 2020 2020 2020 2320 7265  ta).        # re
+00001710: 7475 726e 0a20 2020 2020 2020 2072 6574  turn.        ret
+00001720: 7572 6e20 636f 6e66 6967 5f64 6963 740a  urn config_dict.
+00001730: 0a20 2020 2064 6566 2069 6e69 745f 6672  .    def init_fr
+00001740: 6f6d 5f64 6963 7420 2873 656c 662c 0a20  om_dict (self,. 
+00001750: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00001760: 2020 2020 2020 2064 6963 745f 6e61 6d65         dict_name
+00001770: 293a 0a0a 2020 2020 2020 2020 2222 220a  ):..        """.
+00001780: 2020 2020 2020 2020 4020 6175 7468 6f72          @ author
+00001790: 3a20 2020 2020 2020 2020 2020 2020 2020  :               
+000017a0: 2020 2053 6865 7276 616e 2047 6861 7261     Shervan Ghara
+000017b0: 7269 0a20 2020 2020 2020 2040 2047 6974  ri.        @ Git
+000017c0: 6875 623a 2020 2020 2020 2020 2020 2020  hub:            
+000017d0: 2020 2020 2020 6874 7470 733a 2f2f 6769        https://gi
+000017e0: 7468 7562 2e63 6f6d 2f53 6865 7276 616e  thub.com/Shervan
+000017f0: 4768 6172 6172 692f 4541 5359 4d4f 5245  Gharari/EASYMORE
+00001800: 0a20 2020 2020 2020 2040 2061 7574 686f  .        @ autho
+00001810: 7227 7320 656d 6169 6c20 6964 3a20 2020  r's email id:   
+00001820: 2020 2020 7368 2e67 6861 7261 7269 4067      sh.gharari@g
+00001830: 6d61 696c 2e63 6f6d 0a20 2020 2020 2020  mail.com.       
+00001840: 2040 206c 6963 656e 7365 3a20 2020 2020   @ license:     
+00001850: 2020 2020 2020 2020 2020 2020 474e 552d              GNU-
+00001860: 4750 4c76 330a 2020 2020 2020 2020 5468  GPLv3.        Th
+00001870: 6973 2066 756e 6374 696f 6e20 7461 6b65  is function take
+00001880: 2061 2064 6963 745f 6e61 6d65 2061 6e64   a dict_name and
+00001890: 2070 6f70 756c 6174 6520 7468 6520 7661   populate the va
+000018a0: 7269 6162 6c65 7320 6e65 6564 6564 2074  riables needed t
+000018b0: 6f20 6265 2069 6e69 7469 616c 697a 6564  o be initialized
+000018c0: 2066 6f72 2045 4153 594d 4f52 450a 2020   for EASYMORE.  
+000018d0: 2020 2020 2020 2222 220a 2020 2020 2020        """.      
+000018e0: 2020 6966 2069 7369 6e73 7461 6e63 6528    if isinstance(
+000018f0: 6469 6374 5f6e 616d 652c 2073 7472 293a  dict_name, str):
+00001900: 2023 2072 6561 6420 7468 6520 6669 6c65   # read the file
+00001910: 2069 7320 7374 7269 6e67 2069 7320 7072   is string is pr
+00001920: 6f76 6964 6564 0a20 2020 2020 2020 2020  ovided.         
+00001930: 2020 2064 6963 7469 6f6e 6172 7920 3d20     dictionary = 
+00001940: 7365 6c66 2e72 6561 645f 636f 6e66 6967  self.read_config
+00001950: 5f64 6963 7428 6469 6374 5f6e 616d 6529  _dict(dict_name)
+00001960: 0a20 2020 2020 2020 2065 6c69 6620 6973  .        elif is
+00001970: 696e 7374 616e 6365 2864 6963 745f 6e61  instance(dict_na
+00001980: 6d65 2c20 6469 6374 293a 2023 2070 6173  me, dict): # pas
+00001990: 7320 7468 6520 6469 6374 696f 6e61 7279  s the dictionary
+000019a0: 0a20 2020 2020 2020 2020 2020 2064 6963  .            dic
+000019b0: 7469 6f6e 6172 7920 3d20 6469 6374 5f6e  tionary = dict_n
+000019c0: 616d 650a 2020 2020 2020 2020 656c 7365  ame.        else
+000019d0: 3a0a 2020 2020 2020 2020 2020 2020 7379  :.            sy
+000019e0: 732e 6578 6974 2827 636f 6e66 6967 7572  s.exit('configur
+000019f0: 6174 696f 6e20 6469 6374 696f 6e61 7279  ation dictionary
+00001a00: 2073 686f 756c 6420 6265 2061 2066 696c   should be a fil
+00001a10: 6520 6e61 6d65 205b 7374 7269 6e67 5d2c  e name [string],
+00001a20: 206f 7220 6120 6469 6374 696f 6e61 7279   or a dictionary
+00001a30: 2729 0a20 2020 2020 2020 2023 206c 6f6f  ').        # loo
+00001a40: 7020 6f76 6572 2074 6865 2064 6963 7469  p over the dicti
+00001a50: 6f6e 6172 7920 6b65 7973 0a20 2020 2020  onary keys.     
+00001a60: 2020 2066 6f72 206b 6579 2069 6e20 6c69     for key in li
+00001a70: 7374 2864 6963 7469 6f6e 6172 792e 6b65  st(dictionary.ke
+00001a80: 7973 2829 293a 0a20 2020 2020 2020 2020  ys()):.         
+00001a90: 2020 2069 6620 6b65 7920 696e 206c 6973     if key in lis
+00001aa0: 7428 7661 7273 2873 656c 6629 2e6b 6579  t(vars(self).key
+00001ab0: 7328 2929 3a0a 2020 2020 2020 2020 2020  s()):.          
+00001ac0: 2020 2020 2020 7365 7461 7474 7228 7365        setattr(se
+00001ad0: 6c66 2c20 6b65 792c 2064 6963 7469 6f6e  lf, key, diction
+00001ae0: 6172 795b 6b65 795d 290a 2020 2020 2020  ary[key]).      
+00001af0: 2020 2020 2020 656c 7365 3a0a 2020 2020        else:.    
+00001b00: 2020 2020 2020 2020 2020 2020 7379 732e              sys.
+00001b10: 6578 6974 2827 7072 6f76 6964 6564 206b  exit('provided k
+00001b20: 6579 2069 6e20 636f 6e66 6967 7572 6174  ey in configurat
+00001b30: 696f 6e20 6469 6374 696f 6e61 7279 206f  ion dictionary o
+00001b40: 7220 6669 6c65 2069 7320 6e6f 7420 7265  r file is not re
+00001b50: 636f 6e67 6e69 7a65 6420 6279 2065 6173  congnized by eas
+00001b60: 796d 6f72 6520 6b65 7973 2729 0a0a 0a20  ymore keys')... 
+00001b70: 2020 2023 2323 2323 2323 2323 2323 2323     #############
+00001b80: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+00001b90: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+00001ba0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+00001bb0: 230a 2020 2020 2323 2323 204e 6574 4344  #.    #### NetCD
+00001bc0: 4620 7265 6d61 7070 696e 670a 2020 2020  F remapping.    
+00001bd0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+00001be0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+00001bf0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+00001c00: 2323 2323 2323 2323 2323 2323 2323 0a0a  ##############..
+00001c10: 2020 2020 6465 6620 6e63 5f72 656d 6170      def nc_remap
+00001c20: 7065 7228 7365 6c66 293a 0a20 2020 2020  per(self):.     
+00001c30: 2020 2022 2222 0a20 2020 2020 2020 2040     """.        @
+00001c40: 2061 7574 686f 723a 2020 2020 2020 2020   author:        
+00001c50: 2020 2020 2020 2020 2020 5368 6572 7661            Sherva
+00001c60: 6e20 4768 6172 6172 690a 2020 2020 2020  n Gharari.      
+00001c70: 2020 4020 4769 7468 7562 3a20 2020 2020    @ Github:     
+00001c80: 2020 2020 2020 2020 2020 2020 2068 7474               htt
+00001c90: 7073 3a2f 2f67 6974 6875 622e 636f 6d2f  ps://github.com/
+00001ca0: 5368 6572 7661 6e47 6861 7261 7269 2f45  ShervanGharari/E
+00001cb0: 4153 594d 4f52 450a 2020 2020 2020 2020  ASYMORE.        
+00001cc0: 4020 6175 7468 6f72 2773 2065 6d61 696c  @ author's email
+00001cd0: 2069 643a 2020 2020 2020 2073 682e 6768   id:       sh.gh
+00001ce0: 6172 6172 6940 676d 6169 6c2e 636f 6d0a  arari@gmail.com.
+00001cf0: 2020 2020 2020 2020 4020 6c69 6365 6e73          @ licens
+00001d00: 653a 2020 2020 2020 2020 2020 2020 2020  e:              
+00001d10: 2020 2047 4e55 2d47 504c 7633 0a20 2020     GNU-GPLv3.   
+00001d20: 2020 2020 2054 6869 7320 6675 6e63 7469       This functi
+00001d30: 6f6e 2072 756e 7320 6120 7365 7420 6f66  on runs a set of
+00001d40: 2045 4153 594d 4f52 4520 6675 6e63 7469   EASYMORE functi
+00001d50: 6f6e 2077 6869 6368 2063 616e 2072 656d  on which can rem
+00001d60: 6170 2076 6172 6961 626c 6528 7329 2066  ap variable(s) f
+00001d70: 726f 6d20 6120 7372 6f75 6365 2073 6861  rom a srouce sha
+00001d80: 7065 6669 6c65 0a20 2020 2020 2020 2077  pefile.        w
+00001d90: 6974 6820 7265 6775 6c61 722c 2072 6f61  ith regular, roa
+00001da0: 7465 642c 2069 7272 6567 756c 6172 2074  ted, irregular t
+00001db0: 6f20 6120 7461 7267 6574 2073 6861 7065  o a target shape
+00001dc0: 6669 6c65 0a20 2020 2020 2020 2022 2222  file.        """
+00001dd0: 0a20 2020 2020 2020 2023 2063 6865 636b  .        # check
+00001de0: 2045 4153 594d 4f52 4520 696e 7075 740a   EASYMORE input.
+00001df0: 2020 2020 2020 2020 7365 6c66 2e63 6865          self.che
+00001e00: 636b 5f65 6173 796d 6f72 655f 696e 7075  ck_easymore_inpu
+00001e10: 7428 290a 2020 2020 2020 2020 2320 6368  t().        # ch
+00001e20: 6563 6b20 7468 6520 736f 7572 6365 206e  eck the source n
+00001e30: 6320 6669 6c65 0a20 2020 2020 2020 2073  c file.        s
+00001e40: 656c 662e 6368 6563 6b5f 736f 7572 6365  elf.check_source
+00001e50: 5f6e 6328 290a 2020 2020 2020 2020 2320  _nc().        # 
+00001e60: 6966 2072 656d 6170 2069 7320 6e6f 7420  if remap is not 
+00001e70: 7072 6f76 6964 6564 2074 6865 6e20 6372  provided then cr
+00001e80: 6561 7465 2074 6865 2072 656d 6170 7069  eate the remappi
+00001e90: 6e67 2066 696c 650a 2020 2020 2020 2020  ng file.        
+00001ea0: 6966 2073 656c 662e 7265 6d61 705f 6373  if self.remap_cs
+00001eb0: 7620 3d3d 2027 273a 0a20 2020 2020 2020  v == '':.       
+00001ec0: 2020 2020 2069 6d70 6f72 7420 6765 6f70       import geop
+00001ed0: 616e 6461 7320 6173 2067 7064 0a20 2020  andas as gpd.   
+00001ee0: 2020 2020 2020 2020 2070 7269 6e74 2827           print('
+00001ef0: 2d2d 4352 4541 5449 4e47 2d52 454d 4150  --CREATING-REMAP
+00001f00: 5049 4e47 2d46 494c 452d 2d27 290a 2020  PING-FILE--').  
+00001f10: 2020 2020 2020 2020 2020 7469 6d65 5f73            time_s
+00001f20: 7461 7274 203d 2064 6174 6574 696d 652e  tart = datetime.
+00001f30: 6e6f 7728 290a 2020 2020 2020 2020 2020  now().          
+00001f40: 2020 7072 696e 7428 2753 7461 7274 6564    print('Started
+00001f50: 2061 7420 6461 7465 2061 6e64 2074 696d   at date and tim
+00001f60: 6520 2720 2b20 7374 7228 7469 6d65 5f73  e ' + str(time_s
+00001f70: 7461 7274 2929 0a20 2020 2020 2020 2020  tart)).         
+00001f80: 2020 2023 2072 6561 6420 616e 6420 6368     # read and ch
+00001f90: 6563 6b20 7468 6520 7461 7267 6574 2073  eck the target s
+00001fa0: 6861 7065 6669 6c65 0a20 2020 2020 2020  hapefile.       
+00001fb0: 2020 2020 2074 6172 6765 745f 7368 705f       target_shp_
+00001fc0: 6770 6420 3d20 6770 642e 7265 6164 5f66  gpd = gpd.read_f
+00001fd0: 696c 6528 7365 6c66 2e74 6172 6765 745f  ile(self.target_
+00001fe0: 7368 7029 0a20 2020 2020 2020 2020 2020  shp).           
+00001ff0: 2074 6172 6765 745f 7368 705f 6770 6420   target_shp_gpd 
+00002000: 3d20 7365 6c66 2e63 6865 636b 5f74 6172  = self.check_tar
+00002010: 6765 745f 7368 7028 7461 7267 6574 5f73  get_shp(target_s
+00002020: 6870 5f67 7064 290a 2020 2020 2020 2020  hp_gpd).        
+00002030: 2020 2020 2320 7361 7665 2074 6865 2073      # save the s
+00002040: 7461 6e64 6172 6420 7461 7267 6574 2073  tandard target s
+00002050: 6861 7065 6669 6c65 0a20 2020 2020 2020  hapefile.       
+00002060: 2020 2020 2069 6620 7365 6c66 2e73 6176       if self.sav
+00002070: 655f 7465 6d70 5f73 6870 3a0a 2020 2020  e_temp_shp:.    
+00002080: 2020 2020 2020 2020 2020 2020 7461 7267              targ
+00002090: 6574 5f73 6870 5f67 7064 2e74 6f5f 6669  et_shp_gpd.to_fi
+000020a0: 6c65 2873 656c 662e 7465 6d70 5f64 6972  le(self.temp_dir
+000020b0: 2b73 656c 662e 6361 7365 5f6e 616d 652b  +self.case_name+
+000020c0: 275f 7461 7267 6574 5f73 6861 7065 6669  '_target_shapefi
+000020d0: 6c65 2e73 6870 2729 2023 2073 6176 650a  le.shp') # save.
+000020e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000020f0: 7072 696e 7428 2745 4153 594d 4f52 4520  print('EASYMORE 
+00002100: 7361 7665 6420 7461 7267 6574 2073 6861  saved target sha
+00002110: 7065 6669 6c65 2066 6f72 2045 4153 594d  pefile for EASYM
+00002120: 4f52 4520 636c 6163 756c 6174 696f 6e20  ORE claculation 
+00002130: 6173 3a27 290a 2020 2020 2020 2020 2020  as:').          
+00002140: 2020 2020 2020 7072 696e 7428 7365 6c66        print(self
+00002150: 2e74 656d 705f 6469 722b 7365 6c66 2e63  .temp_dir+self.c
+00002160: 6173 655f 6e61 6d65 2b27 5f74 6172 6765  ase_name+'_targe
+00002170: 745f 7368 6170 6566 696c 652e 7368 7027  t_shapefile.shp'
+00002180: 290a 2020 2020 2020 2020 2020 2020 2320  ).            # 
+00002190: 6372 6561 7465 2073 6f75 7263 6520 7368  create source sh
+000021a0: 6170 6566 696c 650a 2020 2020 2020 2020  apefile.        
+000021b0: 2020 2020 736f 7572 6365 5f73 6870 5f67      source_shp_g
+000021c0: 7064 203d 2073 656c 662e 6372 6561 7465  pd = self.create
+000021d0: 5f73 6f75 7263 655f 7368 7028 290a 2020  _source_shp().  
+000021e0: 2020 2020 2020 2020 2020 6966 2073 656c            if sel
+000021f0: 662e 7361 7665 5f74 656d 705f 7368 703a  f.save_temp_shp:
+00002200: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00002210: 2073 6f75 7263 655f 7368 705f 6770 642e   source_shp_gpd.
+00002220: 746f 5f66 696c 6528 7365 6c66 2e74 656d  to_file(self.tem
+00002230: 705f 6469 722b 7365 6c66 2e63 6173 655f  p_dir+self.case_
+00002240: 6e61 6d65 2b27 5f73 6f75 7263 655f 7368  name+'_source_sh
+00002250: 6170 6566 696c 652e 7368 7027 290a 2020  apefile.shp').  
+00002260: 2020 2020 2020 2020 2020 2020 2020 7072                pr
+00002270: 696e 7428 7365 6c66 2e74 656d 705f 6469  int(self.temp_di
+00002280: 722b 7365 6c66 2e63 6173 655f 6e61 6d65  r+self.case_name
+00002290: 2b27 5f73 6f75 7263 655f 7368 6170 6566  +'_source_shapef
+000022a0: 696c 652e 7368 7027 290a 2020 2020 2020  ile.shp').      
+000022b0: 2020 2020 2020 2020 2020 7072 696e 7428            print(
+000022c0: 2745 4153 594d 4f52 4520 6372 6561 7465  'EASYMORE create
+000022d0: 6420 7468 6520 7368 6170 6566 696c 6520  d the shapefile 
+000022e0: 6672 6f6d 2074 6865 206e 6574 4344 4620  from the netCDF 
+000022f0: 6669 6c65 2061 6e64 2073 6176 6564 2069  file and saved i
+00002300: 7420 6865 7265 3a27 290a 2020 2020 2020  t here:').      
+00002310: 2020 2020 2020 2320 696e 7465 7273 6563        # intersec
+00002320: 7469 6f6e 206f 6620 7468 6520 736f 7572  tion of the sour
+00002330: 6365 2061 6e64 2073 696e 6b2f 7461 7267  ce and sink/targ
+00002340: 6574 2073 6861 7065 6669 6c65 0a20 2020  et shapefile.   
+00002350: 2020 2020 2020 2020 2069 6620 7365 6c66           if self
+00002360: 2e73 6176 655f 7465 6d70 5f73 6870 3a0a  .save_temp_shp:.
+00002370: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00002380: 7368 705f 3120 3d20 6770 642e 7265 6164  shp_1 = gpd.read
+00002390: 5f66 696c 6528 7365 6c66 2e74 656d 705f  _file(self.temp_
+000023a0: 6469 722b 7365 6c66 2e63 6173 655f 6e61  dir+self.case_na
+000023b0: 6d65 2b27 5f74 6172 6765 745f 7368 6170  me+'_target_shap
+000023c0: 6566 696c 652e 7368 7027 290a 2020 2020  efile.shp').    
+000023d0: 2020 2020 2020 2020 2020 2020 7368 705f              shp_
+000023e0: 3220 3d20 6770 642e 7265 6164 5f66 696c  2 = gpd.read_fil
+000023f0: 6528 7365 6c66 2e74 656d 705f 6469 722b  e(self.temp_dir+
+00002400: 7365 6c66 2e63 6173 655f 6e61 6d65 2b27  self.case_name+'
+00002410: 5f73 6f75 7263 655f 7368 6170 6566 696c  _source_shapefil
+00002420: 652e 7368 7027 290a 2020 2020 2020 2020  e.shp').        
+00002430: 2020 2020 656c 7365 3a0a 2020 2020 2020      else:.      
+00002440: 2020 2020 2020 2020 2020 7368 705f 3120            shp_1 
+00002450: 3d20 7461 7267 6574 5f73 6870 5f67 7064  = target_shp_gpd
+00002460: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00002470: 2073 6870 5f32 203d 2073 6f75 7263 655f   shp_2 = source_
+00002480: 7368 705f 6770 640a 2020 2020 2020 2020  shp_gpd.        
+00002490: 2020 2020 2320 636f 7272 6563 7469 6f6e      # correction
+000024a0: 206f 6620 7468 6520 736f 7572 6365 2061   of the source a
+000024b0: 6e64 2074 6172 6765 7420 7368 6170 6566  nd target shapef
+000024c0: 696c 6520 746f 2066 7261 6d65 206f 6620  ile to frame of 
+000024d0: 2d31 3830 2074 6f20 3138 300a 2020 2020  -180 to 180.    
+000024e0: 2020 2020 2020 2020 6d69 6e5f 6c6f 6e5f          min_lon_
+000024f0: 742c 206d 696e 5f6c 6174 5f74 2c20 6d61  t, min_lat_t, ma
+00002500: 785f 6c6f 6e5f 742c 206d 6178 5f6c 6174  x_lon_t, max_lat
+00002510: 5f74 203d 2073 6870 5f31 2e74 6f74 616c  _t = shp_1.total
+00002520: 5f62 6f75 6e64 7320 2320 7461 7267 6574  _bounds # target
+00002530: 0a20 2020 2020 2020 2020 2020 206d 696e  .            min
+00002540: 5f6c 6f6e 5f73 2c20 6d69 6e5f 6c61 745f  _lon_s, min_lat_
+00002550: 732c 206d 6178 5f6c 6f6e 5f73 2c20 6d61  s, max_lon_s, ma
+00002560: 785f 6c61 745f 7320 3d20 7368 705f 322e  x_lat_s = shp_2.
+00002570: 746f 7461 6c5f 626f 756e 6473 2023 2073  total_bounds # s
+00002580: 6f75 7263 650a 2020 2020 2020 2020 2020  ource.          
+00002590: 2020 6966 206e 6f74 2028 286d 696e 5f6c    if not ((min_l
+000025a0: 6f6e 5f73 3c6d 696e 5f6c 6f6e 5f74 2920  on_s<min_lon_t) 
+000025b0: 616e 6420 286d 6178 5f6c 6f6e 5f73 3e6d  and (max_lon_s>m
+000025c0: 6178 5f6c 6f6e 5f74 2920 616e 6420 5c0a  ax_lon_t) and \.
+000025d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000025e0: 2020 2020 286d 696e 5f6c 6174 5f73 3c6d      (min_lat_s<m
+000025f0: 696e 5f6c 6174 5f74 2920 616e 6420 286d  in_lat_t) and (m
+00002600: 6178 5f6c 6174 5f73 3e6d 6178 5f6c 6174  ax_lat_s>max_lat
+00002610: 5f74 2929 3a20 2320 6865 636b 2069 6620  _t)): # heck if 
+00002620: 7461 7265 7420 6973 206e 6f74 2069 6e20  taret is not in 
+00002630: 736f 7572 6365 0a20 2020 2020 2020 2020  source.         
+00002640: 2020 2020 2020 2070 7269 6e74 2827 4541         print('EA
+00002650: 534d 4f52 4520 6465 7465 6374 7320 7468  SMORE detects th
+00002660: 6174 2074 6172 6765 7420 7368 6170 6566  at target shapef
+00002670: 696c 6520 6973 206f 7574 7369 6465 2074  ile is outside t
+00002680: 6865 2062 6f75 6e64 6172 7920 6f66 2073  he boundary of s
+00002690: 6f75 7263 6520 6e65 7443 4446 2066 696c  ource netCDF fil
+000026a0: 6520 272c 0a20 2020 2020 2020 2020 2020  e ',.           
+000026b0: 2020 2020 2020 2020 2020 2027 616e 6420             'and 
+000026c0: 7468 6572 6566 6f72 6520 636f 7272 6563  therefore correc
+000026d0: 7469 6f6e 2066 6f72 206c 6f6e 6769 7475  tion for longitu
+000026e0: 6465 2076 616c 7565 7320 2d31 3830 2074  de values -180 t
+000026f0: 6f20 3138 3020 6f72 2030 2074 6f20 3336  o 180 or 0 to 36
+00002700: 3020 6966 2063 6f72 7265 6374 696f 6e5f  0 if correction_
+00002710: 7368 705f 6c6f 6e20 272c 0a20 2020 2020  shp_lon ',.     
+00002720: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00002730: 2027 666c 6167 2069 7320 7365 7420 746f   'flag is set to
+00002740: 2054 7275 6520 5b64 6566 6175 6c74 2069   True [default i
+00002750: 7320 5472 7565 5d27 290a 2020 2020 2020  s True]').      
+00002760: 2020 2020 2020 2020 2020 6966 2073 656c            if sel
+00002770: 662e 636f 7272 6563 7469 6f6e 5f73 6870  f.correction_shp
+00002780: 5f6c 6f6e 3a0a 2020 2020 2020 2020 2020  _lon:.          
+00002790: 2020 2020 2020 2020 2020 7368 705f 3120            shp_1 
+000027a0: 3d20 7365 6c66 2e73 6870 5f6c 6f6e 5f63  = self.shp_lon_c
+000027b0: 6f72 7265 6374 696f 6e28 7368 705f 3129  orrection(shp_1)
+000027c0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+000027d0: 2020 2020 2073 6870 5f32 203d 2073 656c       shp_2 = sel
+000027e0: 662e 7368 705f 6c6f 6e5f 636f 7272 6563  f.shp_lon_correc
+000027f0: 7469 6f6e 2873 6870 5f32 290a 2020 2020  tion(shp_2).    
+00002800: 2020 2020 2020 2020 656c 7365 3a20 2320          else: # 
+00002810: 6974 2074 6172 6765 7420 6973 2069 6e20  it target is in 
+00002820: 736f 7572 6365 0a20 2020 2020 2020 2020  source.         
+00002830: 2020 2020 2020 2070 7269 6e74 2827 4541         print('EA
+00002840: 534d 4f52 4520 6465 7465 6374 7320 7468  SMORE detects th
+00002850: 6174 2074 6172 6765 7420 7368 6170 6566  at target shapef
+00002860: 696c 6520 6973 2069 6e73 6964 6520 7468  ile is inside th
+00002870: 6520 626f 756e 6461 7279 206f 6620 736f  e boundary of so
+00002880: 7572 6365 206e 6574 4344 4620 6669 6c65  urce netCDF file
+00002890: 2027 2c0a 2020 2020 2020 2020 2020 2020   ',.            
+000028a0: 2020 2020 2020 2020 2020 2761 6e64 2074            'and t
+000028b0: 6865 7265 666f 7265 2063 6f72 7265 6374  herefore correct
+000028c0: 696f 6e20 666f 7220 6c6f 6e67 6974 7564  ion for longitud
+000028d0: 6520 7661 6c75 6573 202d 3138 3020 746f  e values -180 to
+000028e0: 2031 3830 206f 7220 3020 746f 2033 3630   180 or 0 to 360
+000028f0: 2069 7320 6e6f 7420 7065 7266 6f72 6d65   is not performe
+00002900: 6420 6576 656e 2069 6620 272c 0a20 2020  d even if ',.   
+00002910: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00002920: 2020 2027 7468 6520 636f 7272 6563 7469     'the correcti
+00002930: 6f6e 5f73 6870 5f6c 6f6e 2066 6c61 6720  on_shp_lon flag 
+00002940: 6973 2073 6574 2074 6f20 5472 7565 205b  is set to True [
+00002950: 6465 6661 756c 7420 6973 2054 7275 655d  default is True]
+00002960: 2729 0a20 2020 2020 2020 2020 2020 2069  ').            i
+00002970: 6620 7365 6c66 2e73 6176 655f 7465 6d70  f self.save_temp
+00002980: 5f73 6870 3a0a 2020 2020 2020 2020 2020  _shp:.          
+00002990: 2020 2020 2020 7368 705f 312e 746f 5f66        shp_1.to_f
+000029a0: 696c 6528 7365 6c66 2e74 656d 705f 6469  ile(self.temp_di
+000029b0: 722b 7365 6c66 2e63 6173 655f 6e61 6d65  r+self.case_name
+000029c0: 2b27 5f74 6172 6765 745f 7368 6170 6566  +'_target_shapef
+000029d0: 696c 655f 636f 7272 6563 7465 645f 6672  ile_corrected_fr
+000029e0: 616d 652e 7368 7027 290a 2020 2020 2020  ame.shp').      
+000029f0: 2020 2020 2020 2020 2020 7368 705f 322e            shp_2.
+00002a00: 746f 5f66 696c 6528 7365 6c66 2e74 656d  to_file(self.tem
+00002a10: 705f 6469 722b 7365 6c66 2e63 6173 655f  p_dir+self.case_
+00002a20: 6e61 6d65 2b27 5f73 6f75 7263 655f 7368  name+'_source_sh
+00002a30: 6170 6566 696c 655f 636f 7272 6563 7465  apefile_correcte
+00002a40: 645f 6672 616d 652e 7368 7027 290a 2020  d_frame.shp').  
+00002a50: 2020 2020 2020 2020 2020 2320 2320 636c            # # cl
+00002a60: 6970 2074 6f20 7468 6520 7265 6769 6f6e  ip to the region
+00002a70: 206f 6620 7468 6520 7461 7267 6574 2073   of the target s
+00002a80: 6861 7065 6669 6c65 2074 6f20 7370 6565  hapefile to spee
+00002a90: 6420 7570 2074 6865 2069 6e74 6572 7365  d up the interse
+00002aa0: 6374 696f 6e0a 2020 2020 2020 2020 2020  ction.          
+00002ab0: 2020 2320 6966 2073 656c 662e 636c 6970    # if self.clip
+00002ac0: 5f73 6f75 7263 655f 7368 703a 0a20 2020  _source_shp:.   
+00002ad0: 2020 2020 2020 2020 2023 2020 2020 206d           #     m
+00002ae0: 696e 5f6c 6f6e 2c20 6d69 6e5f 6c61 742c  in_lon, min_lat,
+00002af0: 206d 6178 5f6c 6f6e 2c20 6d61 785f 6c61   max_lon, max_la
+00002b00: 7420 3d20 7368 705f 312e 746f 7461 6c5f  t = shp_1.total_
+00002b10: 626f 756e 6473 0a20 2020 2020 2020 2020  bounds.         
+00002b20: 2020 2023 2020 2020 206d 696e 5f6c 6f6e     #     min_lon
+00002b30: 2c20 6d69 6e5f 6c61 742c 206d 6178 5f6c  , min_lat, max_l
+00002b40: 6f6e 2c20 6d61 785f 6c61 7420 3d20 6d69  on, max_lat = mi
+00002b50: 6e5f 6c6f 6e20 2d20 7365 6c66 2e62 7566  n_lon - self.buf
+00002b60: 6665 725f 636c 6970 5f73 6f75 7263 655f  fer_clip_source_
+00002b70: 7368 702c 206d 696e 5f6c 6174 202d 2073  shp, min_lat - s
+00002b80: 656c 662e 6275 6666 6572 5f63 6c69 705f  elf.buffer_clip_
+00002b90: 736f 7572 6365 5f73 6870 2c5c 0a20 2020  source_shp,\.   
+00002ba0: 2020 2020 2020 2020 2023 2020 2020 2020           #      
+00002bb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00002bc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00002bd0: 2020 2020 6d61 785f 6c6f 6e20 2b20 7365      max_lon + se
+00002be0: 6c66 2e62 7566 6665 725f 636c 6970 5f73  lf.buffer_clip_s
+00002bf0: 6f75 7263 655f 7368 702c 206d 6178 5f6c  ource_shp, max_l
+00002c00: 6174 202b 2073 656c 662e 6275 6666 6572  at + self.buffer
+00002c10: 5f63 6c69 705f 736f 7572 6365 5f73 6870  _clip_source_shp
+00002c20: 0a20 2020 2020 2020 2020 2020 2023 2020  .            #  
+00002c30: 2020 2073 6870 5f32 203d 2073 6870 5f32     shp_2 = shp_2
+00002c40: 5b28 7368 705f 325b 276c 6174 5f73 275d  [(shp_2['lat_s']
+00002c50: 3c6d 6178 5f6c 6174 2920 2620 2873 6870  <max_lat) & (shp
+00002c60: 5f32 5b27 6c61 745f 7327 5d3e 6d69 6e5f  _2['lat_s']>min_
+00002c70: 6c61 7429 2026 2028 7368 705f 325b 276c  lat) & (shp_2['l
+00002c80: 6f6e 5f73 275d 3c6d 6178 5f6c 6f6e 2920  on_s']<max_lon) 
+00002c90: 2620 2873 6870 5f32 5b27 6c6f 6e5f 7327  & (shp_2['lon_s'
+00002ca0: 5d3e 6d69 6e5f 6c6f 6e29 5d0a 2020 2020  ]>min_lon)].    
+00002cb0: 2020 2020 2020 2020 2320 2020 2020 7368          #     sh
+00002cc0: 705f 322e 7265 7365 745f 696e 6465 7828  p_2.reset_index(
+00002cd0: 6472 6f70 3d54 7275 652c 2069 6e70 6c61  drop=True, inpla
+00002ce0: 6365 3d54 7275 6529 0a20 2020 2020 2020  ce=True).       
+00002cf0: 2020 2020 2023 2020 2020 2069 6620 7365       #     if se
+00002d00: 6c66 2e73 6176 655f 7465 6d70 5f73 6870  lf.save_temp_shp
+00002d10: 3a0a 2020 2020 2020 2020 2020 2020 2320  :.            # 
+00002d20: 2020 2020 2020 2020 6966 2073 656c 662e          if self.
+00002d30: 636f 7272 6563 7469 6f6e 5f73 6870 5f6c  correction_shp_l
+00002d40: 6f6e 3a0a 2020 2020 2020 2020 2020 2020  on:.            
+00002d50: 2320 2020 2020 2020 2020 2020 2020 7368  #             sh
+00002d60: 705f 322e 746f 5f66 696c 6528 7365 6c66  p_2.to_file(self
+00002d70: 2e74 656d 705f 6469 722b 7365 6c66 2e63  .temp_dir+self.c
+00002d80: 6173 655f 6e61 6d65 2b27 5f73 6f75 7263  ase_name+'_sourc
+00002d90: 655f 7368 6170 6566 696c 655f 636f 7272  e_shapefile_corr
+00002da0: 6563 7465 645f 6672 616d 655f 636c 6970  ected_frame_clip
+00002db0: 7065 642e 7368 7027 290a 2020 2020 2020  ped.shp').      
+00002dc0: 2020 2020 2020 2320 2020 2020 2020 2020        #         
+00002dd0: 656c 7365 3a0a 2020 2020 2020 2020 2020  else:.          
+00002de0: 2020 2320 2020 2020 2020 2020 2020 2020    #             
+00002df0: 7368 705f 322e 746f 5f66 696c 6528 7365  shp_2.to_file(se
+00002e00: 6c66 2e74 656d 705f 6469 722b 7365 6c66  lf.temp_dir+self
+00002e10: 2e63 6173 655f 6e61 6d65 2b27 5f73 6f75  .case_name+'_sou
+00002e20: 7263 655f 7368 6170 6566 696c 655f 636c  rce_shapefile_cl
+00002e30: 6970 7065 642e 7368 7027 290a 2020 2020  ipped.shp').    
+00002e40: 2020 2020 2020 2020 2320 7265 7072 6f6a          # reproj
+00002e50: 6563 7469 6f6e 7320 746f 2065 7175 616c  ections to equal
+00002e60: 2061 7265 610a 2020 2020 2020 2020 2020   area.          
+00002e70: 2020 6966 2073 656c 662e 6368 6563 6b5f    if self.check_
+00002e80: 7368 705f 6372 7328 7368 705f 3129 2061  shp_crs(shp_1) a
+00002e90: 6e64 2073 656c 662e 6368 6563 6b5f 7368  nd self.check_sh
+00002ea0: 705f 6372 7328 7368 705f 3229 3a20 2328  p_crs(shp_2): #(
+00002eb0: 7374 7228 7368 705f 312e 6372 7329 2e6c  str(shp_1.crs).l
+00002ec0: 6f77 6572 2829 203d 3d20 7374 7228 7368  ower() == str(sh
+00002ed0: 705f 322e 6372 7329 2e6c 6f77 6572 2829  p_2.crs).lower()
+00002ee0: 2920 616e 6420 2827 6570 7367 3a34 3332  ) and ('epsg:432
+00002ef0: 3627 2069 6e20 7374 7228 7368 705f 312e  6' in str(shp_1.
+00002f00: 6372 7329 2e6c 6f77 6572 2829 293a 0a20  crs).lower()):. 
+00002f10: 2020 2020 2020 2020 2020 2020 2020 2073                 s
+00002f20: 6870 5f31 203d 2073 6870 5f31 2e74 6f5f  hp_1 = shp_1.to_
+00002f30: 6372 7320 2822 4550 5347 3a36 3933 3322  crs ("EPSG:6933"
+00002f40: 2920 2320 7072 6f6a 6563 7420 746f 2065  ) # project to e
+00002f50: 7175 616c 2061 7265 610a 2020 2020 2020  qual area.      
+00002f60: 2020 2020 2020 2020 2020 7368 705f 3220            shp_2 
+00002f70: 3d20 7368 705f 322e 746f 5f63 7273 2028  = shp_2.to_crs (
+00002f80: 2245 5053 473a 3639 3333 2229 2023 2070  "EPSG:6933") # p
+00002f90: 726f 6a65 6374 2074 6f20 6571 7561 6c20  roject to equal 
+00002fa0: 6172 6561 0a20 2020 2020 2020 2020 2020  area.           
+00002fb0: 2020 2020 2069 6620 7365 6c66 2e73 6176       if self.sav
+00002fc0: 655f 7465 6d70 5f73 6870 3a0a 2020 2020  e_temp_shp:.    
+00002fd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00002fe0: 7368 705f 312e 746f 5f66 696c 6528 7365  shp_1.to_file(se
+00002ff0: 6c66 2e74 656d 705f 6469 722b 7365 6c66  lf.temp_dir+self
+00003000: 2e63 6173 655f 6e61 6d65 2b27 7465 7374  .case_name+'test
+00003010: 2e73 6870 2729 0a20 2020 2020 2020 2020  .shp').         
+00003020: 2020 2020 2020 2020 2020 2073 6870 5f31             shp_1
+00003030: 203d 2067 7064 2e72 6561 645f 6669 6c65   = gpd.read_file
+00003040: 2873 656c 662e 7465 6d70 5f64 6972 2b73  (self.temp_dir+s
+00003050: 656c 662e 6361 7365 5f6e 616d 652b 2774  elf.case_name+'t
+00003060: 6573 742e 7368 7027 290a 2020 2020 2020  est.shp').      
+00003070: 2020 2020 2020 2020 2020 2020 2020 7368                sh
+00003080: 705f 322e 746f 5f66 696c 6528 7365 6c66  p_2.to_file(self
+00003090: 2e74 656d 705f 6469 722b 7365 6c66 2e63  .temp_dir+self.c
+000030a0: 6173 655f 6e61 6d65 2b27 7465 7374 2e73  ase_name+'test.s
+000030b0: 6870 2729 0a20 2020 2020 2020 2020 2020  hp').           
+000030c0: 2020 2020 2020 2020 2073 6870 5f32 203d           shp_2 =
+000030d0: 2067 7064 2e72 6561 645f 6669 6c65 2873   gpd.read_file(s
+000030e0: 656c 662e 7465 6d70 5f64 6972 2b73 656c  elf.temp_dir+sel
+000030f0: 662e 6361 7365 5f6e 616d 652b 2774 6573  f.case_name+'tes
+00003100: 742e 7368 7027 290a 2020 2020 2020 2020  t.shp').        
+00003110: 2020 2020 2020 2020 2320 7265 6d6f 7665          # remove
+00003120: 2074 6573 7420 6669 6c65 730a 2020 2020   test files.    
+00003130: 2020 2020 2020 2020 2020 2020 7265 6d6f              remo
+00003140: 7665 5468 6573 6520 3d20 676c 6f62 2e67  veThese = glob.g
+00003150: 6c6f 6228 7365 6c66 2e74 656d 705f 6469  lob(self.temp_di
+00003160: 722b 7365 6c66 2e63 6173 655f 6e61 6d65  r+self.case_name
+00003170: 2b27 7465 7374 2e2a 2729 0a20 2020 2020  +'test.*').     
+00003180: 2020 2020 2020 2020 2020 2066 6f72 2066             for f
+00003190: 696c 6520 696e 2072 656d 6f76 6554 6865  ile in removeThe
+000031a0: 7365 3a0a 2020 2020 2020 2020 2020 2020  se:.            
+000031b0: 2020 2020 2020 2020 6f73 2e72 656d 6f76          os.remov
+000031c0: 6528 6669 6c65 290a 2020 2020 2020 2020  e(file).        
+000031d0: 2020 2020 656c 7365 3a0a 2020 2020 2020      else:.      
+000031e0: 2020 2020 2020 2020 2020 7379 732e 6578            sys.ex
+000031f0: 6974 2827 5468 6520 7072 6f6a 6563 7469  it('The projecti
+00003200: 6f6e 2066 6f72 2073 6f75 7263 6520 616e  on for source an
+00003210: 6420 7461 7267 6574 2073 6861 7065 6669  d target shapefi
+00003220: 6c65 2061 7265 206e 6f74 2057 4753 3834  le are not WGS84
+00003230: 2c20 706c 6561 7365 2072 6576 6973 652c  , please revise,
+00003240: 2061 7373 6967 6e27 290a 2020 2020 2020   assign').      
+00003250: 2020 2020 2020 2320 696e 7465 7273 6563        # intersec
+00003260: 7469 6f6e 0a20 2020 2020 2020 2020 2020  tion.           
+00003270: 2077 6172 6e69 6e67 732e 7369 6d70 6c65   warnings.simple
+00003280: 6669 6c74 6572 2827 6967 6e6f 7265 2729  filter('ignore')
+00003290: 0a20 2020 2020 2020 2020 2020 2073 6870  .            shp
+000032a0: 5f69 6e74 203d 2073 656c 662e 696e 7465  _int = self.inte
+000032b0: 7273 6563 7469 6f6e 5f73 6870 2873 6870  rsection_shp(shp
+000032c0: 5f31 2c20 7368 705f 3229 0a20 2020 2020  _1, shp_2).     
+000032d0: 2020 2020 2020 2077 6172 6e69 6e67 732e         warnings.
+000032e0: 7369 6d70 6c65 6669 6c74 6572 2827 6465  simplefilter('de
+000032f0: 6661 756c 7427 290a 2020 2020 2020 2020  fault').        
+00003300: 2020 2020 7368 705f 696e 7420 3d20 7368      shp_int = sh
+00003310: 705f 696e 742e 736f 7274 5f76 616c 7565  p_int.sort_value
+00003320: 7328 6279 3d5b 2753 5f31 5f49 445f 7427  s(by=['S_1_ID_t'
+00003330: 5d29 2023 2073 6f72 7420 6261 7365 6420  ]) # sort based 
+00003340: 6f6e 2049 445f 740a 2020 2020 2020 2020  on ID_t.        
+00003350: 2020 2020 7368 705f 696e 7420 3d20 7368      shp_int = sh
+00003360: 705f 696e 742e 746f 5f63 7273 2028 2245  p_int.to_crs ("E
+00003370: 5053 473a 3433 3236 2229 2023 2070 726f  PSG:4326") # pro
+00003380: 6a65 6374 2062 6163 6b20 746f 2057 4753  ject back to WGS
+00003390: 3834 0a20 2020 2020 2020 2020 2020 2069  84.            i
+000033a0: 6620 7365 6c66 2e73 6176 655f 7465 6d70  f self.save_temp
+000033b0: 5f73 6870 3a0a 2020 2020 2020 2020 2020  _shp:.          
+000033c0: 2020 2020 2020 7368 705f 696e 742e 746f        shp_int.to
+000033d0: 5f66 696c 6528 7365 6c66 2e74 656d 705f  _file(self.temp_
+000033e0: 6469 722b 7365 6c66 2e63 6173 655f 6e61  dir+self.case_na
+000033f0: 6d65 2b27 5f69 6e74 6572 7365 6374 6564  me+'_intersected
+00003400: 5f73 6861 7065 6669 6c65 2e73 6870 2729  _shapefile.shp')
+00003410: 2023 2073 6176 6520 7468 6520 696e 7465   # save the inte
+00003420: 7273 6563 7465 6420 6669 6c65 730a 2020  rsected files.  
+00003430: 2020 2020 2020 2020 2020 7368 705f 696e            shp_in
+00003440: 7420 3d20 7368 705f 696e 742e 6472 6f70  t = shp_int.drop
+00003450: 2863 6f6c 756d 6e73 3d5b 2767 656f 6d65  (columns=['geome
+00003460: 7472 7927 5d29 2023 2072 656d 6f76 6520  try']) # remove 
+00003470: 7468 6520 6765 6f6d 6574 7279 0a20 2020  the geometry.   
+00003480: 2020 2020 2020 2020 2023 2063 6f6d 7061           # compa
+00003490: 7265 2073 6870 5f31 206f 7220 7461 7267  re shp_1 or targ
+000034a0: 6574 2073 6861 7065 6669 6c65 2077 6974  et shapefile wit
+000034b0: 6820 696e 7465 7273 6563 7469 6f6e 2074  h intersection t
+000034c0: 6f20 7365 6520 6966 2061 6c6c 2074 6865  o see if all the
+000034d0: 2073 6861 7065 2065 7869 7374 7320 696e   shape exists in
+000034e0: 2069 6e74 6572 7365 6374 696f 6e0a 2020   intersection.  
+000034f0: 2020 2020 2020 2020 2020 6f72 6465 725f            order_
+00003500: 7661 6c75 6573 5f73 6870 5f31 2020 203d  values_shp_1   =
+00003510: 206e 702e 756e 6971 7565 286e 702e 6172   np.unique(np.ar
+00003520: 7261 7928 7368 705f 315b 2753 5f31 5f6f  ray(shp_1['S_1_o
+00003530: 7264 6572 275d 2929 0a20 2020 2020 2020  rder'])).       
+00003540: 2020 2020 206f 7264 6572 5f76 616c 7565       order_value
+00003550: 735f 7368 705f 696e 7420 3d20 6e70 2e75  s_shp_int = np.u
+00003560: 6e69 7175 6528 6e70 2e61 7272 6179 2873  nique(np.array(s
+00003570: 6870 5f69 6e74 5b27 535f 315f 6f72 6465  hp_int['S_1_orde
+00003580: 7227 5d29 290a 2020 2020 2020 2020 2020  r'])).          
+00003590: 2020 6469 6666 203d 206e 702e 7365 7464    diff = np.setd
+000035a0: 6966 6631 6428 6f72 6465 725f 7661 6c75  iff1d(order_valu
+000035b0: 6573 5f73 6870 5f31 2c20 6f72 6465 725f  es_shp_1, order_
+000035c0: 7661 6c75 6573 5f73 6870 5f69 6e74 290a  values_shp_int).
+000035d0: 2020 2020 2020 2020 2020 2020 6966 2028              if (
+000035e0: 6469 6666 2e73 697a 6520 3e20 3029 3a0a  diff.size > 0):.
+000035f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00003600: 6e70 2e73 6176 6574 7874 2873 656c 662e  np.savetxt(self.
+00003610: 7465 6d70 5f64 6972 2b73 656c 662e 6361  temp_dir+self.ca
+00003620: 7365 5f6e 616d 652b 2749 445f 6e6f 745f  se_name+'ID_not_
+00003630: 696e 7465 7273 6563 7465 642e 7478 7427  intersected.txt'
+00003640: 2c20 6469 6666 2c20 666d 743d 2725 6427  , diff, fmt='%d'
+00003650: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
+00003660: 2020 7072 696e 7428 2757 6172 6e69 6e67    print('Warning
+00003670: 3a20 5468 6572 6520 6172 6520 7368 6170  : There are shap
+00003680: 6573 2074 6861 7420 6172 6520 6f75 7473  es that are outs
+00003690: 6964 6520 7468 6520 626f 756e 6461 7269  ide the boundari
+000036a0: 6573 206f 6620 7468 6520 7072 6f76 6964  es of the provid
+000036b0: 6564 206e 6574 4344 4620 6669 6c65 2e20  ed netCDF file. 
+000036c0: 5468 6520 4944 7320 6f66 2074 686f 7365  The IDs of those
+000036d0: 272b 5c0a 2020 2020 2020 2020 2020 2020  '+\.            
+000036e0: 2020 2020 2020 2020 2020 2773 6861 7065            'shape
+000036f0: 7320 6172 6520 7361 7665 6420 696e 3a20  s are saved in: 
+00003700: 5c6e 272b 7365 6c66 2e74 656d 705f 6469  \n'+self.temp_di
+00003710: 722b 7365 6c66 2e63 6173 655f 6e61 6d65  r+self.case_name
+00003720: 2b27 4944 5f6e 6f74 5f69 6e74 6572 7365  +'ID_not_interse
+00003730: 6374 6564 2e74 7874 2729 0a20 2020 2020  cted.txt').     
+00003740: 2020 2020 2020 2020 2020 2069 6620 6e6f             if no
+00003750: 7420 2873 656c 662e 736b 6970 5f6f 7574  t (self.skip_out
+00003760: 7369 6465 5f73 6861 7065 293a 2023 206e  side_shape): # n
+00003770: 6f74 2061 6c6c 2074 6865 2065 6c65 6d65  ot all the eleme
+00003780: 6e74 7320 6f66 2074 6172 6765 7420 7368  nts of target sh
+00003790: 6170 6566 696c 6520 6172 6520 696e 2069  apefile are in i
+000037a0: 6e74 6572 7365 6374 696f 6e0a 2020 2020  ntersection.    
+000037b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000037c0: 7368 705f 315f 6e6f 745f 696e 7420 3d20  shp_1_not_int = 
+000037d0: 7368 705f 315b 7368 705f 315b 2753 5f31  shp_1[shp_1['S_1
+000037e0: 5f6f 7264 6572 275d 2e69 7369 6e28 6469  _order'].isin(di
+000037f0: 6666 295d 0a20 2020 2020 2020 2020 2020  ff)].           
+00003800: 2020 2020 2020 2020 2073 6870 5f31 5f6e           shp_1_n
+00003810: 6f74 5f69 6e74 203d 2073 6870 5f31 5f6e  ot_int = shp_1_n
+00003820: 6f74 5f69 6e74 2e64 726f 7028 636f 6c75  ot_int.drop(colu
+00003830: 6d6e 733d 5b27 6765 6f6d 6574 7279 275d  mns=['geometry']
+00003840: 2920 2320 7265 6d6f 7665 2074 6865 2067  ) # remove the g
+00003850: 656f 6d65 7472 790a 2020 2020 2020 2020  eometry.        
+00003860: 2020 2020 2020 2020 2020 2020 7368 705f              shp_
+00003870: 315f 6e6f 745f 696e 745b 2753 5f32 5f6c  1_not_int['S_2_l
+00003880: 6174 5f73 275d 203d 2030 2e30 3020 2320  at_s'] = 0.00 # 
+00003890: 6173 7369 676e 2072 616e 646f 6d20 6c61  assign random la
+000038a0: 742c 206e 6f20 696e 666c 7565 6e63 6520  t, no influence 
+000038b0: 6173 2077 6569 6768 7420 6973 206e 6f6e  as weight is non
+000038c0: 2065 7869 7374 696e 6720 696e 2073 6870   existing in shp
+000038d0: 5f69 6e74 0a20 2020 2020 2020 2020 2020  _int.           
+000038e0: 2020 2020 2020 2020 2073 6870 5f31 5f6e           shp_1_n
+000038f0: 6f74 5f69 6e74 5b27 535f 325f 6c6f 6e5f  ot_int['S_2_lon_
+00003900: 7327 5d20 3d20 302e 3030 2023 2061 7373  s'] = 0.00 # ass
+00003910: 6967 6e20 7261 6e64 6f6d 206c 6f6e 2c20  ign random lon, 
+00003920: 6e6f 2069 6e66 6c75 656e 6365 2061 7320  no influence as 
+00003930: 7765 6967 6874 2069 6620 6e6f 6e20 6578  weight if non ex
+00003940: 6973 7469 6e67 2069 6e20 7368 705f 696e  isting in shp_in
+00003950: 740a 2020 2020 2020 2020 2020 2020 2020  t.              
+00003960: 2020 2020 2020 7368 705f 696e 7420 3d20        shp_int = 
+00003970: 7064 2e63 6f6e 6361 7428 5b73 6870 5f69  pd.concat([shp_i
+00003980: 6e74 2c20 7368 705f 315f 6e6f 745f 696e  nt, shp_1_not_in
+00003990: 745d 2c61 7869 733d 3029 2023 2063 6f6e  t],axis=0) # con
+000039a0: 7461 6374 2074 6865 2073 6870 5f69 6e74  tact the shp_int
+000039b0: 2061 6e64 2073 6861 7065 7320 7468 6174   and shapes that
+000039c0: 2061 7265 206e 6f74 2069 6e74 6572 7365   are not interse
+000039d0: 6374 6564 0a20 2020 2020 2020 2020 2020  cted.           
+000039e0: 2020 2020 2020 2020 2070 7269 6e74 2827           print('
+000039f0: 5761 726e 696e 673a 2054 6865 7265 2061  Warning: There a
+00003a00: 7265 2073 6861 7065 7320 7468 6174 2061  re shapes that a
+00003a10: 7265 206f 7574 7369 6465 2074 6865 2062  re outside the b
+00003a20: 6f75 6e64 6172 6965 7320 6f66 2074 6865  oundaries of the
+00003a30: 2070 726f 7669 6465 6420 6e65 7443 4446   provided netCDF
+00003a40: 2066 696c 652e 2054 686f 7365 2073 6861   file. Those sha
+00003a50: 7065 7320 272b 5c0a 2020 2020 2020 2020  pes '+\.        
+00003a60: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00003a70: 2020 2774 6869 7320 7769 6c6c 2072 6564    'this will red
+00003a80: 7563 6520 7468 6520 7370 6565 6420 6f66  uce the speed of
+00003a90: 2072 656d 6170 7069 6e67 206f 6620 7468   remapping of th
+00003aa0: 6520 736f 7572 6365 2074 6f20 7265 6d61  e source to rema
+00003ab0: 7065 6420 6e65 7443 4446 2066 696c 6520  ped netCDF file 
+00003ac0: 272b 5c0a 2020 2020 2020 2020 2020 2020  '+\.            
+00003ad0: 2020 2020 2020 2020 2020 2020 2020 2774                't
+00003ae0: 6f20 696e 6372 6561 7365 2074 6865 2073  o increase the s
+00003af0: 7065 6564 2079 6f75 2073 686f 756c 6420  peed you should 
+00003b00: 6d61 6b65 2073 7572 6520 7468 6174 2074  make sure that t
+00003b10: 6172 6765 7420 7368 6170 6566 696c 6520  arget shapefile 
+00003b20: 6973 2077 6974 6869 6e20 7468 6520 626f  is within the bo
+00003b30: 756e 6461 7279 206f 6620 7072 6f76 6964  undary of provid
+00003b40: 6564 2027 2b5c 0a20 2020 2020 2020 2020  ed '+\.         
+00003b50: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00003b60: 2027 6e65 7443 4446 2066 696c 6520 6f72   'netCDF file or
+00003b70: 2073 6574 2074 6865 2065 6173 796d 6f72   set the easymor
+00003b80: 6520 666c 6167 206f 6620 736b 6970 5f6f  e flag of skip_o
+00003b90: 7574 7369 6465 5f73 6861 7065 2074 6f20  utside_shape to 
+00003ba0: 5472 7565 2e27 2b5c 0a20 2020 2020 2020  True.'+\.       
+00003bb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00003bc0: 2020 2027 7468 6973 2066 6c61 6720 656e     'this flag en
+00003bd0: 7375 7265 7320 7468 6520 7368 6170 6573  sures the shapes
+00003be0: 2074 6861 7420 6172 6520 6f75 7473 6964   that are outsid
+00003bf0: 6520 6f66 2074 6865 206e 6574 4344 4620  e of the netCDF 
+00003c00: 646f 6d61 696e 2061 7265 206e 6f74 2074  domain are not t
+00003c10: 7261 6e73 6665 7265 6420 6173 206e 616e  ransfered as nan
+00003c20: 2074 6f20 7265 6d61 7070 6564 2027 2b5c   to remapped '+\
+00003c30: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00003c40: 2020 2020 2020 2020 2020 2027 6e65 7443             'netC
+00003c50: 4446 2066 696c 6573 2729 0a20 2020 2020  DF files').     
+00003c60: 2020 2020 2020 2023 2072 656e 616d 6520         # rename 
+00003c70: 6469 6374 696f 6e61 7279 0a20 2020 2020  dictionary.     
+00003c80: 2020 2020 2020 2064 6963 745f 7265 6e61         dict_rena
+00003c90: 6d65 203d 207b 2753 5f31 5f49 445f 7427  me = {'S_1_ID_t'
+00003ca0: 203a 2027 4944 5f74 272c 0a20 2020 2020   : 'ID_t',.     
+00003cb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00003cc0: 2020 2020 2020 2753 5f31 5f6c 6174 5f74        'S_1_lat_t
+00003cd0: 273a 2027 6c61 745f 7427 2c0a 2020 2020  ': 'lat_t',.    
+00003ce0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00003cf0: 2020 2020 2020 2027 535f 315f 6c6f 6e5f         'S_1_lon_
+00003d00: 7427 3a20 276c 6f6e 5f74 272c 0a20 2020  t': 'lon_t',.   
+00003d10: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00003d20: 2020 2020 2020 2020 2753 5f31 5f6f 7264          'S_1_ord
+00003d30: 6572 273a 2027 6f72 6465 725f 7427 2c0a  er': 'order_t',.
+00003d40: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00003d50: 2020 2020 2020 2020 2020 2027 535f 325f             'S_2_
+00003d60: 4944 5f73 2720 3a20 2749 445f 7327 2c0a  ID_s' : 'ID_s',.
+00003d70: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00003d80: 2020 2020 2020 2020 2020 2027 535f 325f             'S_2_
+00003d90: 6c61 745f 7327 3a20 276c 6174 5f73 272c  lat_s': 'lat_s',
+00003da0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00003db0: 2020 2020 2020 2020 2020 2020 2753 5f32              'S_2
+00003dc0: 5f6c 6f6e 5f73 273a 2027 6c6f 6e5f 7327  _lon_s': 'lon_s'
+00003dd0: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
+00003de0: 2020 2020 2020 2020 2020 2020 2027 4150               'AP
+00003df0: 314e 2720 2020 2020 3a20 2777 6569 6768  1N'     : 'weigh
+00003e00: 7427 7d0a 2020 2020 2020 2020 2020 2020  t'}.            
+00003e10: 7368 705f 696e 7420 3d20 7368 705f 696e  shp_int = shp_in
+00003e20: 742e 7265 6e61 6d65 2863 6f6c 756d 6e73  t.rename(columns
+00003e30: 3d64 6963 745f 7265 6e61 6d65 2920 2320  =dict_rename) # 
+00003e40: 7265 6e61 6d65 2066 6965 6c64 7320 666f  rename fields fo
+00003e50: 7220 7265 6d61 7070 696e 6720 6669 6c65  r remapping file
+00003e60: 0a20 2020 2020 2020 2020 2020 2073 6870  .            shp
+00003e70: 5f69 6e74 203d 2070 642e 4461 7461 4672  _int = pd.DataFr
+00003e80: 616d 6528 7368 705f 696e 7429 2023 206d  ame(shp_int) # m
+00003e90: 6f76 6520 746f 2064 6174 6120 7365 7420  ove to data set 
+00003ea0: 616e 6420 7361 7665 2061 7320 6120 6373  and save as a cs
+00003eb0: 760a 2020 2020 2020 2020 2020 2020 7368  v.            sh
+00003ec0: 705f 696e 742e 746f 5f63 7376 2873 656c  p_int.to_csv(sel
+00003ed0: 662e 7465 6d70 5f64 6972 2b73 656c 662e  f.temp_dir+self.
+00003ee0: 6361 7365 5f6e 616d 652b 275f 696e 7465  case_name+'_inte
+00003ef0: 7273 6563 7465 645f 7368 6170 6566 696c  rsected_shapefil
+00003f00: 652e 6373 7627 2920 2320 7361 7665 2074  e.csv') # save t
+00003f10: 6865 2069 6e74 6572 7365 6374 6564 2066  he intersected f
+00003f20: 696c 6573 0a20 2020 2020 2020 2020 2020  iles.           
+00003f30: 2023 2063 7265 6174 6520 7468 6520 7265   # create the re
+00003f40: 6d61 7020 6669 6c65 2069 6620 7265 6d61  map file if rema
+00003f50: 7020 6669 6c65 0a20 2020 2020 2020 2020  p file.         
+00003f60: 2020 2069 6e74 5f64 6620 3d20 7064 2e72     int_df = pd.r
+00003f70: 6561 645f 6373 7620 2873 656c 662e 7465  ead_csv (self.te
+00003f80: 6d70 5f64 6972 2b73 656c 662e 6361 7365  mp_dir+self.case
+00003f90: 5f6e 616d 652b 275f 696e 7465 7273 6563  _name+'_intersec
+00003fa0: 7465 645f 7368 6170 6566 696c 652e 6373  ted_shapefile.cs
+00003fb0: 7627 290a 2020 2020 2020 2020 2020 2020  v').            
+00003fc0: 6c61 745f 736f 7572 6365 203d 2073 656c  lat_source = sel
+00003fd0: 662e 6c61 740a 2020 2020 2020 2020 2020  f.lat.          
+00003fe0: 2020 6c6f 6e5f 736f 7572 6365 203d 2073    lon_source = s
+00003ff0: 656c 662e 6c6f 6e0a 2020 2020 2020 2020  elf.lon.        
+00004000: 2020 2020 696e 745f 6466 203d 2073 656c      int_df = sel
+00004010: 662e 6372 6561 7465 5f72 656d 6170 2869  f.create_remap(i
+00004020: 6e74 5f64 662c 206c 6174 5f73 6f75 7263  nt_df, lat_sourc
+00004030: 652c 206c 6f6e 5f73 6f75 7263 6529 0a20  e, lon_source). 
+00004040: 2020 2020 2020 2020 2020 2069 6e74 5f64             int_d
+00004050: 662e 746f 5f63 7376 2873 656c 662e 7465  f.to_csv(self.te
+00004060: 6d70 5f64 6972 2b73 656c 662e 6361 7365  mp_dir+self.case
+00004070: 5f6e 616d 652b 275f 7265 6d61 7070 696e  _name+'_remappin
+00004080: 672e 6373 7627 290a 2020 2020 2020 2020  g.csv').        
+00004090: 2020 2020 7365 6c66 2e72 656d 6170 5f63      self.remap_c
+000040a0: 7376 203d 2073 656c 662e 7465 6d70 5f64  sv = self.temp_d
+000040b0: 6972 2b73 656c 662e 6361 7365 5f6e 616d  ir+self.case_nam
+000040c0: 652b 275f 7265 6d61 7070 696e 672e 6373  e+'_remapping.cs
+000040d0: 7627 0a20 2020 2020 2020 2020 2020 2074  v'.            t
+000040e0: 696d 655f 656e 6420 3d20 6461 7465 7469  ime_end = dateti
+000040f0: 6d65 2e6e 6f77 2829 0a20 2020 2020 2020  me.now().       
+00004100: 2020 2020 2074 696d 655f 6469 6666 203d       time_diff =
+00004110: 2074 696d 655f 656e 642d 7469 6d65 5f73   time_end-time_s
+00004120: 7461 7274 0a20 2020 2020 2020 2020 2020  tart.           
+00004130: 2070 7269 6e74 2827 456e 6465 6420 6174   print('Ended at
+00004140: 2064 6174 6520 616e 6420 7469 6d65 2027   date and time '
+00004150: 202b 2073 7472 2874 696d 655f 656e 6429   + str(time_end)
+00004160: 290a 2020 2020 2020 2020 2020 2020 7072  ).            pr
+00004170: 696e 7428 2749 7420 746f 6f6b 2027 2b20  int('It took '+ 
+00004180: 7374 7228 7469 6d65 5f64 6966 662e 746f  str(time_diff.to
+00004190: 7461 6c5f 7365 636f 6e64 7328 2929 2b27  tal_seconds())+'
+000041a0: 2073 6563 6f6e 6473 2074 6f20 6669 6e69   seconds to fini
+000041b0: 7368 2063 7265 6174 696e 6720 6f66 2074  sh creating of t
+000041c0: 6865 2072 656d 6170 7069 6e67 2066 696c  he remapping fil
+000041d0: 6527 290a 2020 2020 2020 2020 2020 2020  e').            
+000041e0: 7072 696e 7428 272d 2d2d 2d2d 2d2d 2d2d  print('---------
+000041f0: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
+00004200: 2d2d 2729 0a20 2020 2020 2020 2065 6c73  --').        els
+00004210: 653a 0a20 2020 2020 2020 2020 2020 2023  e:.            #
+00004220: 2063 6865 636b 2074 6865 2072 656d 6170   check the remap
+00004230: 2066 696c 6520 6966 2070 726f 7669 6465   file if provide
+00004240: 640a 2020 2020 2020 2020 2020 2020 696e  d.            in
+00004250: 745f 6466 2020 3d20 7064 2e72 6561 645f  t_df  = pd.read_
+00004260: 6373 7628 7365 6c66 2e72 656d 6170 5f63  csv(self.remap_c
+00004270: 7376 290a 2020 2020 2020 2020 2020 2020  sv).            
+00004280: 7365 6c66 2e63 6865 636b 5f65 6173 796d  self.check_easym
+00004290: 6f72 655f 7265 6d61 7028 696e 745f 6466  ore_remap(int_df
+000042a0: 290a 2020 2020 2020 2020 2320 6368 6563  ).        # chec
+000042b0: 6b20 6966 2074 6865 2072 656d 6170 7069  k if the remappi
+000042c0: 6e67 2066 696c 6520 6e65 6564 7320 746f  ng file needs to
+000042d0: 2062 6520 6765 6e65 7261 7465 6420 6f6e   be generated on
+000042e0: 6c79 0a20 2020 2020 2020 2069 6620 7365  ly.        if se
+000042f0: 6c66 2e6f 6e6c 795f 6372 6561 7465 5f72  lf.only_create_r
+00004300: 656d 6170 5f63 7376 3a0a 2020 2020 2020  emap_csv:.      
+00004310: 2020 2020 2020 7072 696e 7428 2754 6865        print('The
+00004320: 2066 6c61 6720 746f 2063 7265 6174 6520   flag to create 
+00004330: 6f6e 6c79 2072 656d 6170 2066 696c 6520  only remap file 
+00004340: 6973 2054 7275 6527 290a 2020 2020 2020  is True').      
+00004350: 2020 2020 2020 7072 696e 7428 2754 6865        print('The
+00004360: 2072 656d 6170 7069 6e67 2066 696c 6520   remapping file 
+00004370: 6973 2065 6974 6865 7220 6372 6561 7465  is either create
+00004380: 6420 6f72 2067 6976 656e 2074 6f20 4541  d or given to EA
+00004390: 5359 4d4f 5245 2729 0a20 2020 2020 2020  SYMORE').       
+000043a0: 2020 2020 2070 7269 6e74 2827 5468 6520       print('The 
+000043b0: 7265 6d61 7070 696e 6720 4c6f 6361 7465  remapping Locate
+000043c0: 6420 6865 7265 3a20 272c 2073 656c 662e  d here: ', self.
+000043d0: 7265 6d61 705f 6373 7629 0a20 2020 2020  remap_csv).     
+000043e0: 2020 2065 6c73 653a 0a20 2020 2020 2020     else:.       
+000043f0: 2020 2020 2073 656c 662e 5f5f 7461 7267       self.__targ
+00004400: 6574 5f6e 635f 6372 6561 7469 6f6e 2829  et_nc_creation()
+00004410: 0a0a 0a20 2020 2064 6566 2063 7265 6174  ...    def creat
+00004420: 655f 736f 7572 6365 5f73 6870 2873 656c  e_source_shp(sel
+00004430: 6629 3a0a 2020 2020 2020 2020 2222 220a  f):.        """.
+00004440: 2020 2020 2020 2020 4020 6175 7468 6f72          @ author
+00004450: 3a20 2020 2020 2020 2020 2020 2020 2020  :               
+00004460: 2020 2053 6865 7276 616e 2047 6861 7261     Shervan Ghara
+00004470: 7269 0a20 2020 2020 2020 2040 2047 6974  ri.        @ Git
+00004480: 6875 623a 2020 2020 2020 2020 2020 2020  hub:            
+00004490: 2020 2020 2020 6874 7470 733a 2f2f 6769        https://gi
+000044a0: 7468 7562 2e63 6f6d 2f53 6865 7276 616e  thub.com/Shervan
+000044b0: 4768 6172 6172 692f 4541 5359 4d4f 5245  Gharari/EASYMORE
+000044c0: 0a20 2020 2020 2020 2040 2061 7574 686f  .        @ autho
+000044d0: 7227 7320 656d 6169 6c20 6964 3a20 2020  r's email id:   
+000044e0: 2020 2020 7368 2e67 6861 7261 7269 4067      sh.gharari@g
+000044f0: 6d61 696c 2e63 6f6d 0a20 2020 2020 2020  mail.com.       
+00004500: 2040 206c 6963 656e 7365 3a20 2020 2020   @ license:     
+00004510: 2020 2020 2020 2020 2020 2020 474e 552d              GNU-
+00004520: 4750 4c76 330a 2020 2020 2020 2020 5468  GPLv3.        Th
+00004530: 6973 2066 756e 6374 696f 6e20 6372 6561  is function crea
+00004540: 7465 7320 6120 736f 7572 6365 2073 6861  tes a source sha
+00004550: 7065 6669 6c65 2066 6f72 2072 6567 756c  pefile for regul
+00004560: 6172 206f 7220 726f 7461 7465 6420 6772  ar or rotated gr
+00004570: 6964 2061 6e64 2056 6f72 6f6e 6f69 2064  id and Voronoi d
+00004580: 6961 6772 616d 2066 726f 6d0a 2020 2020  iagram from.    
+00004590: 2020 2020 736f 7572 6365 206e 6574 4344      source netCD
+000045a0: 4620 6669 6c65 0a20 2020 2020 2020 2022  F file.        "
+000045b0: 2222 0a20 2020 2020 2020 2069 6d70 6f72  "".        impor
+000045c0: 7420 6765 6f70 616e 6461 7320 6173 2067  t geopandas as g
+000045d0: 7064 0a20 2020 2020 2020 2023 2066 696e  pd.        # fin
+000045e0: 6420 7468 6520 6361 7365 2c20 313a 2072  d the case, 1: r
+000045f0: 6567 756c 6172 2c20 323a 2072 6f74 6174  egular, 2: rotat
+00004600: 6564 2c20 333a 2069 7272 6567 756c 6172  ed, 3: irregular
+00004610: 2056 6f72 6f6e 6f69 2064 6961 6772 616d   Voronoi diagram
+00004620: 2063 7265 6174 696f 6e20 6966 206e 6f74   creation if not
+00004630: 2070 726f 7669 6465 640a 2020 2020 2020   provided.      
+00004640: 2020 7365 6c66 2e4e 6574 4344 465f 5348    self.NetCDF_SH
+00004650: 505f 6c61 745f 6c6f 6e28 290a 2020 2020  P_lat_lon().    
+00004660: 2020 2020 2320 6372 6561 7465 2074 6865      # create the
+00004670: 2073 6f75 7263 6520 7368 6170 6566 696c   source shapefil
+00004680: 6520 666f 7220 6361 7365 2031 2061 6e64  e for case 1 and
+00004690: 2032 2069 6620 7368 6170 6566 696c 6520   2 if shapefile 
+000046a0: 6973 206e 6f74 2070 726f 7669 6465 640a  is not provided.
+000046b0: 2020 2020 2020 2020 6966 2028 7365 6c66          if (self
+000046c0: 2e63 6173 6520 3d3d 2031 206f 7220 7365  .case == 1 or se
+000046d0: 6c66 2e63 6173 6520 3d3d 2032 293a 0a20  lf.case == 2):. 
+000046e0: 2020 2020 2020 2020 2020 2069 6620 2873             if (s
+000046f0: 656c 662e 736f 7572 6365 5f73 6870 203d  elf.source_shp =
+00004700: 3d20 2727 293a 0a20 2020 2020 2020 2020  = ''):.         
+00004710: 2020 2020 2020 2069 6620 7365 6c66 2e63         if self.c
+00004720: 6173 6520 3d3d 2031 2061 6e64 2068 6173  ase == 1 and has
+00004730: 6174 7472 2873 656c 662c 2027 6c61 745f  attr(self, 'lat_
+00004740: 6578 7061 6e64 6564 2729 2061 6e64 2068  expanded') and h
+00004750: 6173 6174 7472 2873 656c 662c 2027 6c6f  asattr(self, 'lo
+00004760: 6e5f 6578 7061 6e64 6564 2729 3a0a 2020  n_expanded'):.  
+00004770: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00004780: 2020 736f 7572 6365 5f73 6870 5f67 7064    source_shp_gpd
+00004790: 203d 2073 656c 662e 6c61 745f 6c6f 6e5f   = self.lat_lon_
+000047a0: 5348 5028 7365 6c66 2e6c 6174 5f65 7870  SHP(self.lat_exp
+000047b0: 616e 6465 642c 2073 656c 662e 6c6f 6e5f  anded, self.lon_
+000047c0: 6578 7061 6e64 6564 2c63 7273 3d22 6570  expanded,crs="ep
+000047d0: 7367 3a34 3332 3622 290a 2020 2020 2020  sg:4326").      
+000047e0: 2020 2020 2020 2020 2020 656c 7365 3a0a            else:.
+000047f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00004800: 2020 2020 736f 7572 6365 5f73 6870 5f67      source_shp_g
+00004810: 7064 203d 2073 656c 662e 6c61 745f 6c6f  pd = self.lat_lo
+00004820: 6e5f 5348 5028 7365 6c66 2e6c 6174 2c20  n_SHP(self.lat, 
+00004830: 7365 6c66 2e6c 6f6e 2c63 7273 3d22 6570  self.lon,crs="ep
+00004840: 7367 3a34 3332 3622 290a 2020 2020 2020  sg:4326").      
+00004850: 2020 2020 2020 656c 7365 3a0a 2020 2020        else:.    
+00004860: 2020 2020 2020 2020 2020 2020 736f 7572              sour
+00004870: 6365 5f73 6870 5f67 7064 203d 2067 7064  ce_shp_gpd = gpd
+00004880: 2e72 6561 645f 6669 6c65 2873 656c 662e  .read_file(self.
+00004890: 736f 7572 6365 5f73 6870 290a 2020 2020  source_shp).    
+000048a0: 2020 2020 2020 2020 2020 2020 736f 7572              sour
+000048b0: 6365 5f73 6870 5f67 7064 203d 2073 656c  ce_shp_gpd = sel
+000048c0: 662e 6164 645f 6c61 745f 6c6f 6e5f 736f  f.add_lat_lon_so
+000048d0: 7572 6365 5f53 4850 2873 6f75 7263 655f  urce_SHP(source_
+000048e0: 7368 705f 6770 642c 2073 656c 662e 736f  shp_gpd, self.so
+000048f0: 7572 6365 5f73 6870 5f6c 6174 2c5c 0a20  urce_shp_lat,\. 
+00004900: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00004910: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00004920: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00004930: 2020 2020 2020 2020 2020 2020 7365 6c66              self
+00004940: 2e73 6f75 7263 655f 7368 705f 6c6f 6e2c  .source_shp_lon,
+00004950: 2073 656c 662e 736f 7572 6365 5f73 6870   self.source_shp
+00004960: 5f49 4429 0a20 2020 2020 2020 2023 2069  _ID).        # i
+00004970: 6620 6361 7365 2033 0a20 2020 2020 2020  f case 3.       
+00004980: 2069 6620 2873 656c 662e 6361 7365 203d   if (self.case =
+00004990: 3d20 3329 3a0a 2020 2020 2020 2020 2020  = 3):.          
+000049a0: 2020 6966 2028 7365 6c66 2e73 6f75 7263    if (self.sourc
+000049b0: 655f 7368 7020 213d 2027 2729 3a20 2320  e_shp != ''): # 
+000049c0: 736f 7572 6365 2073 6861 7065 6669 6c65  source shapefile
+000049d0: 2069 7320 7072 6f76 6964 6564 0a20 2020   is provided.   
+000049e0: 2020 2020 2020 2020 2020 2020 2073 656c               sel
+000049f0: 662e 6368 6563 6b5f 736f 7572 6365 5f6e  f.check_source_n
+00004a00: 635f 7368 7028 2920 2320 6368 6563 6b20  c_shp() # check 
+00004a10: 7468 6520 6c61 7420 6c6f 6e20 696e 2073  the lat lon in s
+00004a20: 6f75 7265 2073 6861 7065 6669 6c65 2061  oure shapefile a
+00004a30: 6e64 206e 6320 6669 6c65 0a20 2020 2020  nd nc file.     
+00004a40: 2020 2020 2020 2020 2020 2073 6f75 7263             sourc
+00004a50: 655f 7368 705f 6770 6420 3d20 6770 642e  e_shp_gpd = gpd.
+00004a60: 7265 6164 5f66 696c 6528 7365 6c66 2e73  read_file(self.s
+00004a70: 6f75 7263 655f 7368 7029 0a20 2020 2020  ource_shp).     
+00004a80: 2020 2020 2020 2020 2020 2073 6f75 7263             sourc
+00004a90: 655f 7368 705f 6770 6420 3d20 7365 6c66  e_shp_gpd = self
+00004aa0: 2e61 6464 5f6c 6174 5f6c 6f6e 5f73 6f75  .add_lat_lon_sou
+00004ab0: 7263 655f 5348 5028 736f 7572 6365 5f73  rce_SHP(source_s
+00004ac0: 6870 5f67 7064 2c20 7365 6c66 2e73 6f75  hp_gpd, self.sou
+00004ad0: 7263 655f 7368 705f 6c61 742c 5c0a 2020  rce_shp_lat,\.  
+00004ae0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00004af0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00004b00: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00004b10: 2020 2020 2020 2020 2020 2073 656c 662e             self.
+00004b20: 736f 7572 6365 5f73 6870 5f6c 6f6e 2c20  source_shp_lon, 
+00004b30: 7365 6c66 2e73 6f75 7263 655f 7368 705f  self.source_shp_
+00004b40: 4944 290a 2020 2020 2020 2020 2020 2020  ID).            
+00004b50: 6966 2028 7365 6c66 2e73 6f75 7263 655f  if (self.source_
+00004b60: 7368 7020 3d3d 2027 2729 3a20 2320 736f  shp == ''): # so
+00004b70: 7572 6365 2073 6861 7065 6669 6c65 2069  urce shapefile i
+00004b80: 7320 6e6f 7420 7072 6f76 6964 6564 2067  s not provided g
+00004b90: 6f65 7320 666f 7220 766f 726f 6e6f 690a  oes for voronoi.
+00004ba0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00004bb0: 2320 4372 6561 7465 2074 6865 2073 6f75  # Create the sou
+00004bc0: 7263 6520 7368 6170 6566 696c 6520 7573  rce shapefile us
+00004bd0: 696e 6720 566f 726f 6e69 6f20 6469 6167  ing Voronio diag
+00004be0: 7261 6d0a 2020 2020 2020 2020 2020 2020  ram.            
+00004bf0: 2020 2020 7072 696e 7428 2745 4153 594d      print('EASYM
+00004c00: 4f52 4520 6465 7465 6374 2074 6861 7420  ORE detect that 
+00004c10: 736f 7572 6365 2073 6861 7065 6669 6c65  source shapefile
+00004c20: 2069 7320 6e6f 7420 7072 6f76 6964 6564   is not provided
+00004c30: 2066 6f72 2069 7272 6567 756c 6174 206c   for irregulat l
+00004c40: 6174 206c 6f6e 2073 6f75 7263 6520 4e65  at lon source Ne
+00004c50: 7443 4446 2729 0a20 2020 2020 2020 2020  tCDF').         
+00004c60: 2020 2020 2020 2070 7269 6e74 2827 4541         print('EA
+00004c70: 5359 4d4f 5245 2077 696c 6c20 6372 6561  SYMORE will crea
+00004c80: 7465 2074 6865 2076 6f72 6f6e 6f69 2073  te the voronoi s
+00004c90: 6f75 7263 6520 7368 6170 6566 696c 6520  ource shapefile 
+00004ca0: 6261 7365 6420 6f6e 2074 6865 206c 6174  based on the lat
+00004cb0: 206c 6f6e 2729 0a20 2020 2020 2020 2020   lon').         
+00004cc0: 2020 2020 2020 2073 6f75 7263 655f 7368         source_sh
+00004cd0: 705f 6770 642c 2073 6f75 7263 655f 7368  p_gpd, source_sh
+00004ce0: 705f 706f 696e 745f 6770 6420 3d20 7365  p_point_gpd = se
+00004cf0: 6c66 2e73 6870 5f66 726f 6d5f 6972 7265  lf.shp_from_irre
+00004d00: 6775 6c61 725f 6e63 2028 7374 6174 696f  gular_nc (statio
+00004d10: 6e5f 7368 705f 6669 6c65 5f6e 616d 6520  n_shp_file_name 
+00004d20: 3d20 7365 6c66 2e74 656d 705f 6469 722b  = self.temp_dir+
+00004d30: 7365 6c66 2e63 6173 655f 6e61 6d65 2b27  self.case_name+'
+00004d40: 5f73 6f75 7263 655f 7368 6170 6566 696c  _source_shapefil
+00004d50: 655f 706f 696e 7473 2e73 6870 2729 0a20  e_points.shp'). 
+00004d60: 2020 2020 2020 2072 6574 7572 6e20 736f         return so
+00004d70: 7572 6365 5f73 6870 5f67 7064 0a0a 2020  urce_shp_gpd..  
+00004d80: 2020 6465 6620 6765 745f 636f 6c5f 726f    def get_col_ro
+00004d90: 7728 7365 6c66 293a 0a20 2020 2020 2020  w(self):.       
+00004da0: 2022 2222 0a20 2020 2020 2020 2040 2061   """.        @ a
+00004db0: 7574 686f 723a 2020 2020 2020 2020 2020  uthor:          
+00004dc0: 2020 2020 2020 2020 5368 6572 7661 6e20          Shervan 
+00004dd0: 4768 6172 6172 690a 2020 2020 2020 2020  Gharari.        
+00004de0: 4020 4769 7468 7562 3a20 2020 2020 2020  @ Github:       
+00004df0: 2020 2020 2020 2020 2020 2068 7474 7073             https
+00004e00: 3a2f 2f67 6974 6875 622e 636f 6d2f 5368  ://github.com/Sh
+00004e10: 6572 7661 6e47 6861 7261 7269 2f45 4153  ervanGharari/EAS
+00004e20: 594d 4f52 450a 2020 2020 2020 2020 4020  YMORE.        @ 
+00004e30: 6175 7468 6f72 2773 2065 6d61 696c 2069  author's email i
+00004e40: 643a 2020 2020 2020 2073 682e 6768 6172  d:       sh.ghar
+00004e50: 6172 6940 676d 6169 6c2e 636f 6d0a 2020  ari@gmail.com.  
+00004e60: 2020 2020 2020 4020 6c69 6365 6e73 653a        @ license:
+00004e70: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00004e80: 2047 4e55 2d47 504c 7633 0a20 2020 2020   GNU-GPLv3.     
+00004e90: 2020 2054 6869 7320 6675 6e63 7469 6f6e     This function
+00004ea0: 2063 7265 6174 6573 2074 6865 2064 6174   creates the dat
+00004eb0: 6166 7261 6d65 2077 6974 6820 6173 736f  aframe with asso
+00004ec0: 7369 6174 6564 206c 6174 6974 7564 6520  siated latitude 
+00004ed0: 616e 6420 6c6f 6e67 6974 7564 6520 6f72  and longitude or
+00004ee0: 2073 6f75 7263 6520 6669 6c65 2061 6e64   source file and
+00004ef0: 0a20 2020 2020 2020 2069 7473 206c 6f63  .        its loc
+00004f00: 6174 696f 6e20 6f66 2064 6174 6120 6279  ation of data by
+00004f10: 2063 6f6c 756d 6e20 616e 6420 726f 7720   column and row 
+00004f20: 666f 7220 4541 5359 4d4f 5245 2074 6f20  for EASYMORE to 
+00004f30: 6578 7472 6163 742f 7265 6d61 7020 6461  extract/remap da
+00004f40: 7461 0a20 2020 2020 2020 2022 2222 0a20  ta.        """. 
+00004f50: 2020 2020 2020 2023 2066 696e 6420 7468         # find th
+00004f60: 6520 6361 7365 0a20 2020 2020 2020 2073  e case.        s
+00004f70: 656c 662e 4e65 7443 4446 5f53 4850 5f6c  elf.NetCDF_SHP_l
+00004f80: 6174 5f6c 6f6e 2829 0a20 2020 2020 2020  at_lon().       
+00004f90: 2023 0a20 2020 2020 2020 206c 6174 5f74   #.        lat_t
+00004fa0: 6172 6765 745f 696e 7420 3d20 6e70 2e61  arget_int = np.a
+00004fb0: 7272 6179 2873 656c 662e 6c61 7429 3b20  rray(self.lat); 
+00004fc0: 6c61 745f 7461 7267 6574 5f69 6e74 203d  lat_target_int =
+00004fd0: 206c 6174 5f74 6172 6765 745f 696e 742e   lat_target_int.
+00004fe0: 666c 6174 7465 6e28 290a 2020 2020 2020  flatten().      
+00004ff0: 2020 6c6f 6e5f 7461 7267 6574 5f69 6e74    lon_target_int
+00005000: 203d 206e 702e 6172 7261 7928 7365 6c66   = np.array(self
+00005010: 2e6c 6f6e 293b 206c 6f6e 5f74 6172 6765  .lon); lon_targe
+00005020: 745f 696e 7420 3d20 6c6f 6e5f 7461 7267  t_int = lon_targ
+00005030: 6574 5f69 6e74 2e66 6c61 7474 656e 2829  et_int.flatten()
+00005040: 0a20 2020 2020 2020 2072 6f77 732c 2063  .        rows, c
+00005050: 6f6c 7320 3d20 7365 6c66 2e63 7265 6174  ols = self.creat
+00005060: 655f 726f 775f 636f 6c5f 6466 2028 7365  e_row_col_df (se
+00005070: 6c66 2e6c 6174 2c20 7365 6c66 2e6c 6f6e  lf.lat, self.lon
+00005080: 2c20 6c61 745f 7461 7267 6574 5f69 6e74  , lat_target_int
+00005090: 2c20 6c6f 6e5f 7461 7267 6574 5f69 6e74  , lon_target_int
+000050a0: 290a 2020 2020 2020 2020 2320 6372 6561  ).        # crea
+000050b0: 7465 2074 6865 2064 6174 6120 6672 616d  te the data fram
+000050c0: 650a 2020 2020 2020 2020 6c61 745f 6c6f  e.        lat_lo
+000050d0: 6e5f 726f 775f 636f 6c20 3d20 7064 2e44  n_row_col = pd.D
+000050e0: 6174 6146 7261 6d65 2829 0a20 2020 2020  ataFrame().     
+000050f0: 2020 206c 6174 5f6c 6f6e 5f72 6f77 5f63     lat_lon_row_c
+00005100: 6f6c 205b 276c 6174 5f73 275d 203d 206c  ol ['lat_s'] = l
+00005110: 6174 5f74 6172 6765 745f 696e 740a 2020  at_target_int.  
+00005120: 2020 2020 2020 6c61 745f 6c6f 6e5f 726f        lat_lon_ro
+00005130: 775f 636f 6c20 5b27 6c6f 6e5f 7327 5d20  w_col ['lon_s'] 
+00005140: 3d20 6c6f 6e5f 7461 7267 6574 5f69 6e74  = lon_target_int
+00005150: 0a20 2020 2020 2020 206c 6174 5f6c 6f6e  .        lat_lon
+00005160: 5f72 6f77 5f63 6f6c 205b 2772 6f77 7327  _row_col ['rows'
+00005170: 5d20 203d 2072 6f77 730a 2020 2020 2020  ]  = rows.      
+00005180: 2020 6c61 745f 6c6f 6e5f 726f 775f 636f    lat_lon_row_co
+00005190: 6c20 5b27 636f 6c73 275d 2020 3d20 636f  l ['cols']  = co
+000051a0: 6c73 0a20 2020 2020 2020 2023 2073 6176  ls.        # sav
+000051b0: 696e 670a 2020 2020 2020 2020 6c61 745f  ing.        lat_
+000051c0: 6c6f 6e5f 726f 775f 636f 6c2e 746f 5f63  lon_row_col.to_c
+000051d0: 7376 2873 656c 662e 7465 6d70 5f64 6972  sv(self.temp_dir
+000051e0: 2b73 656c 662e 6361 7365 5f6e 616d 652b  +self.case_name+
+000051f0: 275f 726f 775f 636f 6c5f 6c61 745f 6c6f  '_row_col_lat_lo
+00005200: 6e2e 6373 7627 290a 2020 2020 2020 2020  n.csv').        
+00005210: 7365 6c66 2e63 6f6c 5f72 6f77 5f6e 616d  self.col_row_nam
+00005220: 6520 3d20 7365 6c66 2e74 656d 705f 6469  e = self.temp_di
+00005230: 722b 7365 6c66 2e63 6173 655f 6e61 6d65  r+self.case_name
+00005240: 2b27 5f72 6f77 5f63 6f6c 5f6c 6174 5f6c  +'_row_col_lat_l
+00005250: 6f6e 2e63 7376 270a 0a20 2020 2064 6566  on.csv'..    def
+00005260: 2063 6865 636b 5f65 6173 796d 6f72 655f   check_easymore_
+00005270: 696e 7075 7428 7365 6c66 293a 0a20 2020  input(self):.   
+00005280: 2020 2020 2022 2222 0a20 2020 2020 2020       """.       
+00005290: 2040 2061 7574 686f 723a 2020 2020 2020   @ author:      
+000052a0: 2020 2020 2020 2020 2020 2020 5368 6572              Sher
+000052b0: 7661 6e20 4768 6172 6172 690a 2020 2020  van Gharari.    
+000052c0: 2020 2020 4020 4769 7468 7562 3a20 2020      @ Github:   
+000052d0: 2020 2020 2020 2020 2020 2020 2020 2068                 h
+000052e0: 7474 7073 3a2f 2f67 6974 6875 622e 636f  ttps://github.co
+000052f0: 6d2f 5368 6572 7661 6e47 6861 7261 7269  m/ShervanGharari
+00005300: 2f45 4153 594d 4f52 450a 2020 2020 2020  /EASYMORE.      
+00005310: 2020 4020 6175 7468 6f72 2773 2065 6d61    @ author's ema
+00005320: 696c 2069 643a 2020 2020 2020 2073 682e  il id:       sh.
+00005330: 6768 6172 6172 6940 676d 6169 6c2e 636f  gharari@gmail.co
+00005340: 6d0a 2020 2020 2020 2020 4020 6c69 6365  m.        @ lice
+00005350: 6e73 653a 2020 2020 2020 2020 2020 2020  nse:            
+00005360: 2020 2020 2047 4e55 2d47 504c 7633 0a20       GNU-GPLv3. 
+00005370: 2020 2020 2020 2074 6865 2066 756e 6374         the funct
+00005380: 696f 6e73 2063 6865 636b 6573 2069 6620  ions checkes if 
+00005390: 7468 6520 6e65 6365 7373 6172 7920 4541  the necessary EA
+000053a0: 5359 4d4f 5245 206f 626a 6563 7420 6172  SYMORE object ar
+000053b0: 6520 7072 6f76 6964 6564 2066 726f 6d20  e provided from 
+000053c0: 7468 6520 7573 6572 0a20 2020 2020 2020  the user.       
+000053d0: 2022 2222 0a20 2020 2020 2020 2069 6620   """.        if 
+000053e0: 7365 6c66 2e74 656d 705f 6469 7220 213d  self.temp_dir !=
+000053f0: 2027 273a 0a20 2020 2020 2020 2020 2020   '':.           
+00005400: 2069 6620 7365 6c66 2e74 656d 705f 6469   if self.temp_di
+00005410: 725b 2d31 5d20 213d 2027 2f27 3a0a 2020  r[-1] != '/':.  
+00005420: 2020 2020 2020 2020 2020 2020 2020 7379                sy
+00005430: 732e 6578 6974 2827 7468 6520 7072 6f76  s.exit('the prov
+00005440: 6964 6564 2074 656d 706f 7261 7279 2066  ided temporary f
+00005450: 6f6c 6465 7220 666f 7220 4541 5359 4d4f  older for EASYMO
+00005460: 5245 2073 686f 756c 6420 656e 6420 7769  RE should end wi
+00005470: 7468 2028 2f29 2729 0a20 2020 2020 2020  th (/)').       
+00005480: 2020 2020 2069 6620 6e6f 7420 6f73 2e70       if not os.p
+00005490: 6174 682e 6973 6469 7228 7365 6c66 2e74  ath.isdir(self.t
+000054a0: 656d 705f 6469 7229 3a0a 2020 2020 2020  emp_dir):.      
+000054b0: 2020 2020 2020 2020 2020 6f73 2e6d 616b            os.mak
+000054c0: 6564 6972 7328 7365 6c66 2e74 656d 705f  edirs(self.temp_
+000054d0: 6469 7229 0a20 2020 2020 2020 2069 6620  dir).        if 
+000054e0: 7365 6c66 2e6f 7574 7075 745f 6469 7220  self.output_dir 
+000054f0: 3d3d 2027 273a 0a20 2020 2020 2020 2020  == '':.         
+00005500: 2020 2073 7973 2e65 7869 7428 2774 6865     sys.exit('the
+00005510: 2070 726f 7669 6465 6420 666f 6c64 6572   provided folder
+00005520: 2066 6f72 2045 4153 594d 4f52 4520 7265   for EASYMORE re
+00005530: 6d61 7070 6564 206e 6574 4344 4620 6f75  mapped netCDF ou
+00005540: 7470 7574 2069 7320 6d69 7373 696e 673b  tput is missing;
+00005550: 2070 6c65 6173 6520 7072 6f76 6964 6520   please provide 
+00005560: 7468 6174 2729 0a20 2020 2020 2020 2069  that').        i
+00005570: 6620 7365 6c66 2e6f 7574 7075 745f 6469  f self.output_di
+00005580: 7220 213d 2027 273a 0a20 2020 2020 2020  r != '':.       
+00005590: 2020 2020 2069 6620 7365 6c66 2e6f 7574       if self.out
+000055a0: 7075 745f 6469 725b 2d31 5d20 213d 2027  put_dir[-1] != '
+000055b0: 2f27 3a0a 2020 2020 2020 2020 2020 2020  /':.            
+000055c0: 2020 2020 7379 732e 6578 6974 2827 7468      sys.exit('th
+000055d0: 6520 7072 6f76 6964 6564 206f 7574 7075  e provided outpu
+000055e0: 7420 666f 6c64 6572 2066 6f72 2045 4153  t folder for EAS
+000055f0: 594d 4f52 4520 7368 6f75 6c64 2065 6e64  YMORE should end
+00005600: 2077 6974 6820 282f 2927 290a 2020 2020   with (/)').    
+00005610: 2020 2020 2020 2020 6966 206e 6f74 206f          if not o
+00005620: 732e 7061 7468 2e69 7364 6972 2873 656c  s.path.isdir(sel
+00005630: 662e 6f75 7470 7574 5f64 6972 293a 0a20  f.output_dir):. 
+00005640: 2020 2020 2020 2020 2020 2020 2020 206f                 o
+00005650: 732e 6d61 6b65 6469 7273 2873 656c 662e  s.makedirs(self.
+00005660: 6f75 7470 7574 5f64 6972 290a 2020 2020  output_dir).    
+00005670: 2020 2020 6966 2073 656c 662e 7465 6d70      if self.temp
+00005680: 5f64 6972 203d 3d20 2727 3a0a 2020 2020  _dir == '':.    
+00005690: 2020 2020 2020 2020 7072 696e 7428 224e          print("N
+000056a0: 6f20 7465 6d70 6f72 6172 7920 666f 6c64  o temporary fold
+000056b0: 6572 2069 7320 7072 6f76 6964 6564 2066  er is provided f
+000056c0: 6f72 2045 4153 594d 4f52 453b 2074 6869  or EASYMORE; thi
+000056d0: 7320 7769 6c6c 2072 6573 756c 7420 696e  s will result in
+000056e0: 2045 4153 594d 4f52 4520 7361 7669 6e67   EASYMORE saving
+000056f0: 2074 6865 2066 696c 6573 2069 6e20 7468   the files in th
+00005700: 6520 7361 6d65 2064 6972 6563 746f 7279  e same directory
+00005710: 2061 7320 7079 7468 6f6e 2073 6372 6970   as python scrip
+00005720: 7422 290a 2020 2020 2020 2020 6966 2073  t").        if s
+00005730: 656c 662e 6175 7468 6f72 5f6e 616d 6520  elf.author_name 
+00005740: 3d3d 2027 273a 0a20 2020 2020 2020 2020  == '':.         
+00005750: 2020 2070 7269 6e74 2822 6e6f 2061 7574     print("no aut
+00005760: 686f 7220 6e61 6d65 2069 7320 7072 6f76  hor name is prov
+00005770: 6964 6564 2e20 5468 6520 6175 7468 6f72  ided. The author
+00005780: 206e 616d 6520 6973 2063 6861 6e67 6564   name is changed
+00005790: 2074 6f20 2861 7574 686f 7220 6e61 6d65   to (author name
+000057a0: 2921 2229 0a20 2020 2020 2020 2020 2020  )!").           
+000057b0: 2073 656c 662e 6175 7468 6f72 5f6e 616d   self.author_nam
+000057c0: 6520 3d20 2261 7574 686f 7220 6e61 6d65  e = "author name
+000057d0: 220a 2020 2020 2020 2020 6966 2028 6c65  ".        if (le
+000057e0: 6e28 7365 6c66 2e76 6172 5f6e 616d 6573  n(self.var_names
+000057f0: 2920 213d 2031 2920 616e 6420 286c 656e  ) != 1) and (len
+00005800: 2873 656c 662e 666f 726d 6174 5f6c 6973  (self.format_lis
+00005810: 7429 203d 3d20 3129 2061 6e64 2028 6c65  t) == 1) and (le
+00005820: 6e28 7365 6c66 2e66 696c 6c5f 7661 6c75  n(self.fill_valu
+00005830: 655f 6c69 7374 2920 3d3d 3129 3a0a 2020  e_list) ==1):.  
+00005840: 2020 2020 2020 2020 2020 6966 2028 6c65            if (le
+00005850: 6e28 7365 6c66 2e76 6172 5f6e 616d 6573  n(self.var_names
+00005860: 2920 213d 206c 656e 2873 656c 662e 6669  ) != len(self.fi
+00005870: 6c6c 5f76 616c 7565 5f6c 6973 7429 2920  ll_value_list)) 
+00005880: 616e 6420 5c0a 2020 2020 2020 2020 2020  and \.          
+00005890: 2020 286c 656e 2873 656c 662e 7661 725f    (len(self.var_
+000058a0: 6e61 6d65 7329 2021 3d20 6c65 6e28 7365  names) != len(se
+000058b0: 6c66 2e66 6f72 6d61 745f 6c69 7374 2929  lf.format_list))
+000058c0: 2061 6e64 205c 0a20 2020 2020 2020 2020   and \.         
+000058d0: 2020 2028 6c65 6e28 7365 6c66 2e66 6f72     (len(self.for
+000058e0: 6d61 745f 6c69 7374 2920 3d3d 2031 2920  mat_list) == 1) 
+000058f0: 616e 6420 286c 656e 2873 656c 662e 6669  and (len(self.fi
+00005900: 6c6c 5f76 616c 7565 5f6c 6973 7429 203d  ll_value_list) =
+00005910: 3d31 293a 0a20 2020 2020 2020 2020 2020  =1):.           
+00005920: 2020 2020 2070 7269 6e74 2827 4541 5359       print('EASY
+00005930: 4d4f 5245 2069 7320 6769 7665 6e20 6d75  MORE is given mu
+00005940: 6c74 6970 6c65 2076 6172 6961 626c 6573  ltiple variables
+00005950: 2066 6f72 2072 656d 6170 7069 6e67 2062   for remapping b
+00005960: 7574 206f 6e6c 7920 6f6e 2066 6f72 6d61  ut only on forma
+00005970: 7420 616e 6420 6669 6c6c 2076 616c 7565  t and fill value
+00005980: 2e20 272b 5c0a 2020 2020 2020 2020 2020  . '+\.          
+00005990: 2020 2020 2020 2020 2020 2020 2745 4153              'EAS
+000059a0: 594d 4f52 4520 7265 7065 6174 7320 7468  YMORE repeats th
+000059b0: 6520 666f 726d 6174 2061 6e64 2066 696c  e format and fil
+000059c0: 6c20 7661 6c75 6520 666f 7220 616c 6c20  l value for all 
+000059d0: 7468 6520 7661 7269 6162 6c65 7320 696e  the variables in
+000059e0: 206f 7574 7075 7420 6669 6c65 7327 290a   output files').
+000059f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00005a00: 7365 6c66 2e66 6f72 6d61 745f 6c69 7374  self.format_list
+00005a10: 2020 2020 203d 2073 656c 662e 666f 726d       = self.form
+00005a20: 6174 5f6c 6973 7420 2020 2020 2a20 6c65  at_list     * le
+00005a30: 6e28 7365 6c66 2e76 6172 5f6e 616d 6573  n(self.var_names
+00005a40: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
+00005a50: 2020 7365 6c66 2e66 696c 6c5f 7661 6c75    self.fill_valu
+00005a60: 655f 6c69 7374 203d 2073 656c 662e 6669  e_list = self.fi
+00005a70: 6c6c 5f76 616c 7565 5f6c 6973 7420 2a20  ll_value_list * 
+00005a80: 6c65 6e28 7365 6c66 2e76 6172 5f6e 616d  len(self.var_nam
+00005a90: 6573 290a 2020 2020 2020 2020 2020 2020  es).            
+00005aa0: 656c 7365 3a0a 2020 2020 2020 2020 2020  else:.          
+00005ab0: 2020 2020 2020 7379 732e 6578 6974 2827        sys.exit('
+00005ac0: 6e75 6d62 6572 206f 6620 7661 7269 6162  number of variab
+00005ad0: 6c65 7320 616e 6420 6669 6c6c 2076 616c  les and fill val
+00005ae0: 7565 7320 616e 6420 666f 726d 6174 7320  ues and formats 
+00005af0: 646f 206e 6f74 206d 6174 6368 2729 0a20  do not match'). 
+00005b00: 2020 2020 2020 2069 6620 7365 6c66 2e72         if self.r
+00005b10: 656d 6170 5f63 7376 2021 3d20 2727 3a0a  emap_csv != '':.
+00005b20: 2020 2020 2020 2020 2020 2020 7072 696e              prin
+00005b30: 7428 2772 656d 6170 2066 696c 6520 6973  t('remap file is
+00005b40: 2070 726f 7669 6465 643b 2045 4153 594d   provided; EASYM
+00005b50: 4f52 4520 7769 6c6c 2075 7365 2074 6869  ORE will use thi
+00005b60: 7320 6669 6c65 2061 6e64 2073 6b69 7020  s file and skip 
+00005b70: 6372 6561 7469 6f6e 206f 6620 7265 6d61  creation of rema
+00005b80: 7070 696e 6720 6669 6c65 2729 0a20 2020  pping file').   
+00005b90: 2020 2020 2069 6620 6c65 6e28 7365 6c66       if len(self
+00005ba0: 2e76 6172 5f6e 616d 6573 2920 213d 206c  .var_names) != l
+00005bb0: 656e 2873 6574 2873 656c 662e 7661 725f  en(set(self.var_
+00005bc0: 6e61 6d65 7329 293a 0a20 2020 2020 2020  names)):.       
+00005bd0: 2020 2020 2073 7973 2e65 7869 7428 276e       sys.exit('n
+00005be0: 616d 6573 206f 6620 7661 7269 6162 6c65  ames of variable
+00005bf0: 7320 7072 6f76 6964 6564 2066 726f 6d20  s provided from 
+00005c00: 7468 6520 736f 7572 6365 204e 6574 4344  the source NetCD
+00005c10: 4620 6669 6c65 2074 6f20 6265 2072 656d  F file to be rem
+00005c20: 6170 7065 6420 6172 6520 6e6f 7420 756e  apped are not un
+00005c30: 6971 7565 2729 0a20 2020 2020 2020 2069  ique').        i
+00005c40: 6620 7365 6c66 2e76 6172 5f6e 616d 6573  f self.var_names
+00005c50: 5f72 656d 6170 7065 643a 0a20 2020 2020  _remapped:.     
+00005c60: 2020 2020 2020 2069 6620 6c65 6e28 7365         if len(se
+00005c70: 6c66 2e76 6172 5f6e 616d 6573 5f72 656d  lf.var_names_rem
+00005c80: 6170 7065 6429 2021 3d20 6c65 6e28 7365  apped) != len(se
+00005c90: 7428 7365 6c66 2e76 6172 5f6e 616d 6573  t(self.var_names
+00005ca0: 5f72 656d 6170 7065 6429 293a 0a20 2020  _remapped)):.   
+00005cb0: 2020 2020 2020 2020 2020 2020 2073 7973               sys
+00005cc0: 2e65 7869 7428 2774 6865 206e 616d 6520  .exit('the name 
+00005cd0: 6f66 2074 6865 2076 6172 6961 626c 6573  of the variables
+00005ce0: 2079 6f75 2068 6176 6520 7072 6f76 6964   you have provid
+00005cf0: 6564 2061 7320 7468 6520 7265 6e61 6d65  ed as the rename
+00005d00: 2069 6e20 7468 6520 7265 6d61 7070 6564   in the remapped
+00005d10: 2066 696c 6520 6172 6520 6e6f 7420 756e   file are not un
+00005d20: 6971 7565 2729 0a20 2020 2020 2020 2020  ique').         
+00005d30: 2020 2069 6620 6c65 6e28 7365 6c66 2e76     if len(self.v
+00005d40: 6172 5f6e 616d 6573 5f72 656d 6170 7065  ar_names_remappe
+00005d50: 6429 2021 3d20 6c65 6e28 7365 6c66 2e76  d) != len(self.v
+00005d60: 6172 5f6e 616d 6573 293a 0a20 2020 2020  ar_names):.     
+00005d70: 2020 2020 2020 2020 2020 2073 7973 2e65             sys.e
+00005d80: 7869 7428 2774 6865 206e 756d 6265 7220  xit('the number 
+00005d90: 6f66 2070 726f 7669 6465 6420 7661 7269  of provided vari
+00005da0: 6162 6c65 7320 6672 6f6d 2074 6865 2073  ables from the s
+00005db0: 6f75 7263 6520 6669 6c65 2061 6e64 206e  ource file and n
+00005dc0: 616d 6573 2074 6f20 6265 2072 656d 6170  ames to be remap
+00005dd0: 7065 6420 6172 6520 6e6f 7420 7468 6520  ped are not the 
+00005de0: 7361 6d65 206c 656e 6774 6827 290a 2020  same length').  
+00005df0: 2020 2020 2020 656c 7365 3a0a 2020 2020        else:.    
+00005e00: 2020 2020 2020 2020 7365 6c66 2e76 6172          self.var
+00005e10: 5f6e 616d 6573 5f72 656d 6170 7065 6420  _names_remapped 
+00005e20: 3d20 7365 6c66 2e76 6172 5f6e 616d 6573  = self.var_names
+00005e30: 0a20 2020 2020 2020 2066 6f72 2069 2069  .        for i i
+00005e40: 6e20 6e70 2e61 7261 6e67 6528 6c65 6e28  n np.arange(len(
+00005e50: 7365 6c66 2e76 6172 5f6e 616d 6573 2929  self.var_names))
+00005e60: 3a0a 2020 2020 2020 2020 2020 2020 7072  :.            pr
+00005e70: 696e 7428 2745 4153 594d 4f52 4520 7769  int('EASYMORE wi
+00005e80: 6c6c 2072 656d 6170 2076 6172 6961 626c  ll remap variabl
+00005e90: 6520 272c 7365 6c66 2e76 6172 5f6e 616d  e ',self.var_nam
+00005ea0: 6573 5b69 5d2c 2720 6672 6f6d 2073 6f75  es[i],' from sou
+00005eb0: 7263 6520 6669 6c65 2074 6f20 7661 7269  rce file to vari
+00005ec0: 6162 6c65 2027 2c73 656c 662e 7661 725f  able ',self.var_
+00005ed0: 6e61 6d65 735f 7265 6d61 7070 6564 5b69  names_remapped[i
+00005ee0: 5d2c 2720 696e 2072 656d 6170 7065 6420  ],' in remapped 
+00005ef0: 6e65 7443 4446 2066 696c 6527 290a 0a20  netCDF file').. 
+00005f00: 2020 2064 6566 2063 6865 636b 5f74 6172     def check_tar
+00005f10: 6765 745f 7368 7020 2873 656c 662c 7368  get_shp (self,sh
+00005f20: 7029 3a0a 2020 2020 2020 2020 2222 220a  p):.        """.
+00005f30: 2020 2020 2020 2020 4020 6175 7468 6f72          @ author
+00005f40: 3a20 2020 2020 2020 2020 2020 2020 2020  :               
+00005f50: 2020 2053 6865 7276 616e 2047 6861 7261     Shervan Ghara
+00005f60: 7269 0a20 2020 2020 2020 2040 2047 6974  ri.        @ Git
+00005f70: 6875 623a 2020 2020 2020 2020 2020 2020  hub:            
+00005f80: 2020 2020 2020 6874 7470 733a 2f2f 6769        https://gi
+00005f90: 7468 7562 2e63 6f6d 2f53 6865 7276 616e  thub.com/Shervan
+00005fa0: 4768 6172 6172 692f 4541 5359 4d4f 5245  Gharari/EASYMORE
+00005fb0: 0a20 2020 2020 2020 2040 2061 7574 686f  .        @ autho
+00005fc0: 7227 7320 656d 6169 6c20 6964 3a20 2020  r's email id:   
+00005fd0: 2020 2020 7368 2e67 6861 7261 7269 4067      sh.gharari@g
+00005fe0: 6d61 696c 2e63 6f6d 0a20 2020 2020 2020  mail.com.       
+00005ff0: 2040 206c 6963 656e 7365 3a20 2020 2020   @ license:     
+00006000: 2020 2020 2020 2020 2020 2020 474e 552d              GNU-
+00006010: 4750 4c76 330a 2020 2020 2020 2020 7468  GPLv3.        th
+00006020: 6973 2066 756e 6374 696f 6e20 6368 6563  is function chec
+00006030: 6b20 6966 2074 6172 6765 7420 7368 6170  k if target shap
+00006040: 6566 696c 6520 616e 6420 6164 6420 4944  efile and add ID
+00006050: 2061 6e64 2063 656e 7472 6f69 6420 6c61   and centroid la
+00006060: 7420 616e 6420 6c6f 6e20 6973 206e 6f74  t and lon is not
+00006070: 2070 726f 7669 6465 640a 2020 2020 2020   provided.      
+00006080: 2020 4172 6775 6d65 6e74 730a 2020 2020    Arguments.    
+00006090: 2020 2020 2d2d 2d2d 2d2d 2d2d 2d0a 2020      ---------.  
+000060a0: 2020 2020 2020 7368 703a 2067 656f 7061        shp: geopa
+000060b0: 6e64 6173 2064 6174 6166 7261 6d65 2c20  ndas dataframe, 
+000060c0: 706f 6c79 676f 6e65 2c20 6d75 6c74 6970  polygone, multip
+000060d0: 6f6c 7967 6f6e 2c20 706f 696e 742c 206d  olygon, point, m
+000060e0: 756c 7469 706f 696e 740a 2020 2020 2020  ultipoint.      
+000060f0: 2020 2222 220a 2020 2020 2020 2020 2320    """.        # 
+00006100: 6c6f 6164 2074 6865 206e 6565 6465 6420  load the needed 
+00006110: 7061 636b 6167 6573 0a20 2020 2020 2020  packages.       
+00006120: 2069 6d70 6f72 7420 6765 6f70 616e 6461   import geopanda
+00006130: 7320 6173 2067 7064 0a20 2020 2020 2020  s as gpd.       
+00006140: 2066 726f 6d20 2020 7368 6170 656c 792e   from   shapely.
+00006150: 6765 6f6d 6574 7279 2069 6d70 6f72 7420  geometry import 
+00006160: 506f 6c79 676f 6e0a 2020 2020 2020 2020  Polygon.        
+00006170: 2369 6d70 6f72 7420 7368 6170 6566 696c  #import shapefil
+00006180: 6520 2320 7079 7368 6564 206c 6962 7261  e # pyshed libra
+00006190: 7279 0a20 2020 2020 2020 2069 6d70 6f72  ry.        impor
+000061a0: 7420 7368 6170 656c 790a 2020 2020 2020  t shapely.      
+000061b0: 2020 2320 7369 6e6b 2f74 6172 6765 7420    # sink/target 
+000061c0: 7368 6170 6566 696c 6520 6368 6563 6b20  shapefile check 
+000061d0: 7468 6520 7072 6f6a 6563 7469 6f6e 0a20  the projection. 
+000061e0: 2020 2020 2020 2069 6620 6e6f 7420 7365         if not se
+000061f0: 6c66 2e63 6865 636b 5f73 6870 5f63 7273  lf.check_shp_crs
+00006200: 2873 6870 293a 0a20 2020 2020 2020 2020  (shp):.         
+00006210: 2020 2073 7973 2e65 7869 7428 2770 6c65     sys.exit('ple
+00006220: 6173 6520 7072 6f6a 6563 7420 796f 7572  ase project your
+00006230: 2073 6861 7065 6669 6c65 2074 6f20 5747   shapefile to WG
+00006240: 5338 3420 2865 7073 673a 3433 3236 2927  S84 (epsg:4326)'
+00006250: 290a 2020 2020 2020 2020 656c 7365 3a20  ).        else: 
+00006260: 2320 6368 6563 6b20 6966 2074 6865 2070  # check if the p
+00006270: 726f 6a65 6374 696f 6e20 6973 2057 4753  rojection is WGS
+00006280: 3834 2028 6f72 2065 7073 673a 3433 3236  84 (or epsg:4326
+00006290: 290a 2020 2020 2020 2020 2020 2020 7072  ).            pr
+000062a0: 696e 7428 2745 4153 594d 4f52 4520 6465  int('EASYMORE de
+000062b0: 7465 6374 7320 7468 6174 2074 6172 6765  tects that targe
+000062c0: 7420 7368 6170 6566 696c 6520 6973 2069  t shapefile is i
+000062d0: 6e20 5747 5338 3420 2865 7073 673a 3433  n WGS84 (epsg:43
+000062e0: 3236 2927 290a 2020 2020 2020 2020 2320  26)').        # 
+000062f0: 6368 6563 6b20 6966 2074 6865 2049 442c  check if the ID,
+00006300: 206c 6174 6974 7564 652c 206c 6f6e 6769   latitude, longi
+00006310: 7475 6465 2061 7265 2070 726f 7669 6465  tude are provide
+00006320: 640a 2020 2020 2020 2020 6966 2073 656c  d.        if sel
+00006330: 662e 7461 7267 6574 5f73 6870 5f49 4420  f.target_shp_ID 
+00006340: 3d3d 2027 273a 0a20 2020 2020 2020 2020  == '':.         
+00006350: 2020 2070 7269 6e74 2827 4541 5359 4d4f     print('EASYMO
+00006360: 5245 2064 6574 6563 7473 2074 6861 7420  RE detects that 
+00006370: 6e6f 2066 6965 6c64 2066 6f72 2049 4420  no field for ID 
+00006380: 6973 2070 726f 7669 6465 6420 696e 2073  is provided in s
+00006390: 696e 6b2f 7461 7267 6574 2073 6861 7065  ink/target shape
+000063a0: 6669 6c65 2729 0a20 2020 2020 2020 2020  file').         
+000063b0: 2020 2070 7269 6e74 2827 6172 6269 7461     print('arbita
+000063c0: 7261 7279 2076 616c 7565 7320 6f66 2049  rary values of I
+000063d0: 4420 6172 6520 6164 6465 6420 696e 2074  D are added in t
+000063e0: 6865 2066 6965 6c64 2049 445f 7427 290a  he field ID_t').
+000063f0: 2020 2020 2020 2020 2020 2020 7368 705b              shp[
+00006400: 2749 445f 7427 5d20 203d 206e 702e 6172  'ID_t']  = np.ar
+00006410: 616e 6765 286c 656e 2873 6870 2929 2b31  ange(len(shp))+1
+00006420: 0a20 2020 2020 2020 2065 6c73 653a 0a20  .        else:. 
+00006430: 2020 2020 2020 2020 2020 2070 7269 6e74             print
+00006440: 2827 4541 5359 4d4f 5245 2064 6574 6563  ('EASYMORE detec
+00006450: 7473 2074 6861 7420 7468 6520 6669 656c  ts that the fiel
+00006460: 6420 666f 7220 4944 2069 7320 7072 6f76  d for ID is prov
+00006470: 6964 6564 2069 6e20 7369 6e6b 2f74 6172  ided in sink/tar
+00006480: 6765 7420 7368 6170 6566 696c 6527 290a  get shapefile').
+00006490: 2020 2020 2020 2020 2020 2020 2320 6368              # ch
+000064a0: 6563 6b20 6966 2074 6865 2070 726f 7669  eck if the provi
+000064b0: 6465 6420 4944 7320 6172 6520 756e 6971  ded IDs are uniq
+000064c0: 7565 0a20 2020 2020 2020 2020 2020 2049  ue.            I
+000064d0: 445f 7661 6c75 6573 203d 206e 702e 6172  D_values = np.ar
+000064e0: 7261 7928 7368 705b 7365 6c66 2e74 6172  ray(shp[self.tar
+000064f0: 6765 745f 7368 705f 4944 5d29 0a20 2020  get_shp_ID]).   
+00006500: 2020 2020 2020 2020 2069 6620 6c65 6e28           if len(
+00006510: 4944 5f76 616c 7565 7329 2021 3d20 6c65  ID_values) != le
+00006520: 6e28 6e70 2e75 6e69 7175 6528 4944 5f76  n(np.unique(ID_v
+00006530: 616c 7565 7329 293a 0a20 2020 2020 2020  alues)):.       
+00006540: 2020 2020 2020 2020 2073 7973 2e65 7869           sys.exi
+00006550: 7428 2754 6865 2070 726f 7669 6465 6420  t('The provided 
+00006560: 4944 7320 696e 2073 6861 7065 6669 6c65  IDs in shapefile
+00006570: 2061 7265 206e 6f74 2075 6e69 7175 653b   are not unique;
+00006580: 2070 726f 7669 6465 2075 6e69 7175 6520   provide unique 
+00006590: 4944 7320 6f72 2064 6f20 6e6f 7420 6964  IDs or do not id
+000065a0: 656e 7469 6679 2074 6172 6765 745f 7368  entify target_sh
+000065b0: 705f 4944 2729 0a20 2020 2020 2020 2020  p_ID').         
+000065c0: 2020 2073 6870 5b27 4944 5f74 275d 203d     shp['ID_t'] =
+000065d0: 2073 6870 5b73 656c 662e 7461 7267 6574   shp[self.target
+000065e0: 5f73 6870 5f49 445d 0a20 2020 2020 2020  _shp_ID].       
+000065f0: 2069 6620 7365 6c66 2e74 6172 6765 745f   if self.target_
+00006600: 7368 705f 6c61 7420 3d3d 2027 2720 6f72  shp_lat == '' or
+00006610: 2073 656c 662e 7461 7267 6574 5f73 6870   self.target_shp
+00006620: 5f6c 6f6e 203d 3d20 2727 3a0a 2020 2020  _lon == '':.    
+00006630: 2020 2020 2020 2020 7072 696e 7428 2745          print('E
+00006640: 4153 594d 4f52 4520 6465 7465 6374 7320  ASYMORE detects 
+00006650: 7468 6174 2065 6974 6865 7220 6f66 2074  that either of t
+00006660: 6865 2066 6965 6c64 7320 666f 7220 6c61  he fields for la
+00006670: 7469 7475 6465 206f 7220 6c6f 6e67 6974  titude or longit
+00006680: 7564 6520 6973 206e 6f74 2070 726f 7669  ude is not provi
+00006690: 6465 6420 696e 2073 696e 6b2f 7461 7267  ded in sink/targ
+000066a0: 6574 2073 6861 7065 6669 6c65 2729 0a20  et shapefile'). 
+000066b0: 2020 2020 2020 2020 2020 2023 2069 6e20             # in 
+000066c0: 5747 5338 340a 2020 2020 2020 2020 2020  WGS84.          
+000066d0: 2020 7072 696e 7428 2763 616c 6375 6c61    print('calcula
+000066e0: 7469 6e67 2063 656e 7472 6f69 6420 6f66  ting centroid of
+000066f0: 2073 6861 7065 7320 696e 2057 4753 3834   shapes in WGS84
+00006700: 2070 726f 6a65 6374 696f 6e3b 2729 0a20   projection;'). 
+00006710: 2020 2020 2020 2020 2020 2070 7269 6e74             print
+00006720: 2827 666f 7220 6265 7474 6572 2061 7070  ('for better app
+00006730: 7869 6d61 7469 6f6e 2075 7365 2074 6865  ximation use the
+00006740: 2065 6173 796d 6f72 6520 6571 7561 6c20   easymore equal 
+00006750: 6172 6561 2063 656e 7472 6f69 6420 6675  area centroid fu
+00006760: 6e63 7469 6f6e 2074 6f20 7072 6570 726f  nction to prepro
+00006770: 6365 7373 2074 6172 6765 7420 7368 6170  cess target shap
+00006780: 6566 696c 6527 290a 2020 2020 2020 2020  efile').        
+00006790: 2020 2020 6466 5f70 6f69 6e74 203d 2070      df_point = p
+000067a0: 642e 4461 7461 4672 616d 6528 290a 2020  d.DataFrame().  
+000067b0: 2020 2020 2020 2020 2020 7761 726e 696e            warnin
+000067c0: 6773 2e73 696d 706c 6566 696c 7465 7228  gs.simplefilter(
+000067d0: 2769 676e 6f72 6527 2920 2320 7369 6c65  'ignore') # sile
+000067e0: 6e74 2074 6865 2077 6172 6e69 6e67 0a20  nt the warning. 
+000067f0: 2020 2020 2020 2020 2020 2064 665f 706f             df_po
+00006800: 696e 7420 5b27 6c61 7427 5d20 3d20 7368  int ['lat'] = sh
+00006810: 702e 6365 6e74 726f 6964 2e79 0a20 2020  p.centroid.y.   
+00006820: 2020 2020 2020 2020 2064 665f 706f 696e           df_poin
+00006830: 7420 5b27 6c6f 6e27 5d20 3d20 7368 702e  t ['lon'] = shp.
+00006840: 6365 6e74 726f 6964 2e78 0a20 2020 2020  centroid.x.     
+00006850: 2020 2020 2020 2077 6172 6e69 6e67 732e         warnings.
+00006860: 7369 6d70 6c65 6669 6c74 6572 2827 6465  simplefilter('de
+00006870: 6661 756c 7427 2920 2320 6261 636b 2074  fault') # back t
+00006880: 6f20 6e6f 726d 616c 0a20 2020 2020 2020  o normal.       
+00006890: 2069 6620 7365 6c66 2e74 6172 6765 745f   if self.target_
+000068a0: 7368 705f 6c61 7420 3d3d 2027 273a 0a20  shp_lat == '':. 
+000068b0: 2020 2020 2020 2020 2020 2070 7269 6e74             print
+000068c0: 2827 4541 5359 4d4f 5245 2064 6574 6563  ('EASYMORE detec
+000068d0: 7473 2074 6861 7420 6e6f 2066 6965 6c64  ts that no field
+000068e0: 2066 6f72 206c 6174 6974 7564 6520 6973   for latitude is
+000068f0: 2070 726f 7669 6465 6420 696e 2073 696e   provided in sin
+00006900: 6b2f 7461 7267 6574 2073 6861 7065 6669  k/target shapefi
+00006910: 6c65 2729 0a20 2020 2020 2020 2020 2020  le').           
+00006920: 2070 7269 6e74 2827 6c61 7469 7475 6465   print('latitude
+00006930: 2076 616c 7565 7320 6172 6520 6164 6465   values are adde
+00006940: 6420 696e 2074 6865 2066 6965 6c64 206c  d in the field l
+00006950: 6174 5f74 2729 0a20 2020 2020 2020 2020  at_t').         
+00006960: 2020 2073 6870 5b27 6c61 745f 7427 5d20     shp['lat_t'] 
+00006970: 203d 2064 665f 706f 696e 7420 5b27 6c61   = df_point ['la
+00006980: 7427 5d20 2320 6365 6e74 726f 6964 206c  t'] # centroid l
+00006990: 6174 2066 726f 6d20 7461 7267 6574 0a20  at from target. 
+000069a0: 2020 2020 2020 2065 6c73 653a 0a20 2020         else:.   
+000069b0: 2020 2020 2020 2020 2070 7269 6e74 2827           print('
+000069c0: 4541 5359 4d4f 5245 2064 6574 6563 7473  EASYMORE detects
+000069d0: 2074 6861 7420 7468 6520 6669 656c 6420   that the field 
+000069e0: 6c61 7469 7475 6465 2069 7320 7072 6f76  latitude is prov
+000069f0: 6964 6564 2069 6e20 7369 6e6b 2f74 6172  ided in sink/tar
+00006a00: 6765 7420 7368 6170 6566 696c 6527 290a  get shapefile').
+00006a10: 2020 2020 2020 2020 2020 2020 7368 705b              shp[
+00006a20: 276c 6174 5f74 275d 203d 2073 6870 5b73  'lat_t'] = shp[s
+00006a30: 656c 662e 7461 7267 6574 5f73 6870 5f6c  elf.target_shp_l
+00006a40: 6174 5d0a 2020 2020 2020 2020 6966 2073  at].        if s
+00006a50: 656c 662e 7461 7267 6574 5f73 6870 5f6c  elf.target_shp_l
+00006a60: 6f6e 203d 3d20 2727 3a0a 2020 2020 2020  on == '':.      
+00006a70: 2020 2020 2020 7072 696e 7428 2745 4153        print('EAS
+00006a80: 594d 4f52 4520 6465 7465 6374 7320 7468  YMORE detects th
+00006a90: 6174 206e 6f20 6669 656c 6420 666f 7220  at no field for 
+00006aa0: 6c6f 6e67 6974 7564 6520 6973 2070 726f  longitude is pro
+00006ab0: 7669 6465 6420 696e 2073 696e 6b2f 7461  vided in sink/ta
+00006ac0: 7267 6574 2073 6861 7065 6669 6c65 2729  rget shapefile')
+00006ad0: 0a20 2020 2020 2020 2020 2020 2070 7269  .            pri
+00006ae0: 6e74 2827 6c6f 6e67 6974 7564 6520 7661  nt('longitude va
+00006af0: 6c75 6573 2061 7265 2061 6464 6564 2069  lues are added i
+00006b00: 6e20 7468 6520 6669 656c 6420 6c6f 6e5f  n the field lon_
+00006b10: 7427 290a 2020 2020 2020 2020 2020 2020  t').            
+00006b20: 7368 705b 276c 6f6e 5f74 275d 2020 3d20  shp['lon_t']  = 
+00006b30: 6466 5f70 6f69 6e74 205b 276c 6f6e 275d  df_point ['lon']
+00006b40: 2023 2063 656e 7472 6f69 6420 6c6f 6e20   # centroid lon 
+00006b50: 6672 6f6d 2074 6172 6765 740a 2020 2020  from target.    
+00006b60: 2020 2020 656c 7365 3a0a 2020 2020 2020      else:.      
+00006b70: 2020 2020 2020 7072 696e 7428 2745 4153        print('EAS
+00006b80: 594d 4f52 4520 6465 7465 6374 7320 7468  YMORE detects th
+00006b90: 6174 2074 6865 2066 6965 6c64 206c 6f6e  at the field lon
+00006ba0: 6769 7475 6465 2069 7320 7072 6f76 6964  gitude is provid
+00006bb0: 6564 2069 6e20 7369 6e6b 2f74 6172 6765  ed in sink/targe
+00006bc0: 7420 7368 6170 6566 696c 6527 290a 2020  t shapefile').  
+00006bd0: 2020 2020 2020 2020 2020 7368 705b 276c            shp['l
+00006be0: 6f6e 5f74 275d 203d 2073 6870 5b73 656c  on_t'] = shp[sel
+00006bf0: 662e 7461 7267 6574 5f73 6870 5f6c 6f6e  f.target_shp_lon
+00006c00: 5d0a 2020 2020 2020 2020 2320 6368 6563  ].        # chec
+00006c10: 6b20 6f74 6865 7220 6765 6f6d 6574 7269  k other geometri
+00006c20: 6573 2061 6e64 2061 6464 2062 7566 6665  es and add buffe
+00006c30: 7220 6966 206e 6565 6465 640a 2020 2020  r if needed.    
+00006c40: 2020 2020 6465 7465 6374 6564 5f70 6f69      detected_poi
+00006c50: 6e74 7320 3d20 4661 6c73 650a 2020 2020  nts = False.    
+00006c60: 2020 2020 6465 7465 6374 6564 5f6d 756c      detected_mul
+00006c70: 7469 706f 696e 7473 203d 2046 616c 7365  tipoints = False
+00006c80: 0a20 2020 2020 2020 2064 6574 6563 7465  .        detecte
+00006c90: 645f 6c69 6e65 7320 3d20 4661 6c73 650a  d_lines = False.
+00006ca0: 2020 2020 2020 2020 666f 7220 696e 6465          for inde
+00006cb0: 782c 205f 2069 6e20 7368 702e 6974 6572  x, _ in shp.iter
+00006cc0: 726f 7773 2829 3a0a 2020 2020 2020 2020  rows():.        
+00006cd0: 2020 2020 706f 6c79 7320 3d20 7368 702e      polys = shp.
+00006ce0: 6765 6f6d 6574 7279 2e69 6c6f 635b 696e  geometry.iloc[in
+00006cf0: 6465 785d 2023 2067 6574 2074 6865 2073  dex] # get the s
+00006d00: 6861 7065 0a20 2020 2020 2020 2020 2020  hape.           
+00006d10: 2069 6620 706f 6c79 732e 6765 6f6d 5f74   if polys.geom_t
+00006d20: 7970 652e 6c6f 7765 7228 2920 3d3d 2022  ype.lower() == "
+00006d30: 706f 696e 7422 2020 2020 2020 6f72 2070  point"      or p
+00006d40: 6f6c 7973 2e67 656f 6d5f 7479 7065 2e6c  olys.geom_type.l
+00006d50: 6f77 6572 2829 203d 3d20 2270 6f69 6e74  ower() == "point
+00006d60: 7322 3a0a 2020 2020 2020 2020 2020 2020  s":.            
+00006d70: 2020 2020 6465 7465 6374 6564 5f70 6f69      detected_poi
+00006d80: 6e74 7320 3d20 5472 7565 0a20 2020 2020  nts = True.     
+00006d90: 2020 2020 2020 2020 2020 2070 6f6c 7973             polys
+00006da0: 203d 2070 6f6c 7973 2e62 7566 6665 7228   = polys.buffer(
+00006db0: 3130 2a2a 2d35 292e 7369 6d70 6c69 6679  10**-5).simplify
+00006dc0: 2831 302a 2a2d 3529 0a20 2020 2020 2020  (10**-5).       
+00006dd0: 2020 2020 2020 2020 2073 6870 2e67 656f           shp.geo
+00006de0: 6d65 7472 792e 696c 6f63 5b69 6e64 6578  metry.iloc[index
+00006df0: 5d20 3d20 706f 6c79 730a 2020 2020 2020  ] = polys.      
+00006e00: 2020 2020 2020 6966 2070 6f6c 7973 2e67        if polys.g
+00006e10: 656f 6d5f 7479 7065 2e6c 6f77 6572 2829  eom_type.lower()
+00006e20: 203d 3d20 226d 756c 7469 706f 696e 7422   == "multipoint"
+00006e30: 206f 7220 706f 6c79 732e 6765 6f6d 5f74   or polys.geom_t
+00006e40: 7970 652e 6c6f 7765 7228 2920 3d3d 2022  ype.lower() == "
+00006e50: 6d75 6c74 6970 6f69 6e74 7322 3a0a 2020  multipoints":.  
+00006e60: 2020 2020 2020 2020 2020 2020 2020 6465                de
+00006e70: 7465 6374 6564 5f6d 756c 7469 706f 696e  tected_multipoin
+00006e80: 7473 203d 2054 7275 650a 2020 2020 2020  ts = True.      
+00006e90: 2020 2020 2020 2020 2020 706f 6c79 7320            polys 
+00006ea0: 3d20 706f 6c79 732e 6275 6666 6572 2831  = polys.buffer(1
+00006eb0: 302a 2a2d 3529 2e73 696d 706c 6966 7928  0**-5).simplify(
+00006ec0: 3130 2a2a 2d35 290a 2020 2020 2020 2020  10**-5).        
+00006ed0: 2020 2020 2020 2020 7368 702e 6765 6f6d          shp.geom
+00006ee0: 6574 7279 2e69 6c6f 635b 696e 6465 785d  etry.iloc[index]
+00006ef0: 203d 2070 6f6c 7973 0a20 2020 2020 2020   = polys.       
+00006f00: 2020 2020 2069 6620 706f 6c79 732e 6765       if polys.ge
+00006f10: 6f6d 5f74 7970 652e 6c6f 7765 7228 2920  om_type.lower() 
+00006f20: 3d3d 2022 6c69 6e65 2220 2020 2020 2020  == "line"       
+00006f30: 6f72 2070 6f6c 7973 2e67 656f 6d5f 7479  or polys.geom_ty
+00006f40: 7065 2e6c 6f77 6572 2829 203d 3d20 226c  pe.lower() == "l
+00006f50: 696e 6573 223a 0a20 2020 2020 2020 2020  ines":.         
+00006f60: 2020 2020 2020 2064 6574 6563 7465 645f         detected_
+00006f70: 6c69 6e65 7320 3d20 5472 7565 0a20 2020  lines = True.   
+00006f80: 2020 2020 2020 2020 2020 2020 2070 6f6c               pol
+00006f90: 7973 203d 2070 6f6c 7973 2e62 7566 6665  ys = polys.buffe
+00006fa0: 7228 3130 2a2a 2d35 292e 7369 6d70 6c69  r(10**-5).simpli
+00006fb0: 6679 2831 302a 2a2d 3529 0a20 2020 2020  fy(10**-5).     
+00006fc0: 2020 2020 2020 2020 2020 2073 6870 2e67             shp.g
+00006fd0: 656f 6d65 7472 792e 696c 6f63 5b69 6e64  eometry.iloc[ind
+00006fe0: 6578 5d20 3d20 706f 6c79 730a 2020 2020  ex] = polys.    
+00006ff0: 2020 2020 2020 2020 6966 2070 6f6c 7973          if polys
+00007000: 2e67 656f 6d5f 7479 7065 2e6c 6f77 6572  .geom_type.lower
+00007010: 2829 203d 3d20 2270 6f6c 796c 696e 6522  () == "polyline"
+00007020: 2020 206f 7220 706f 6c79 732e 6765 6f6d     or polys.geom
+00007030: 5f74 7970 652e 6c6f 7765 7228 2920 3d3d  _type.lower() ==
+00007040: 2022 706f 6c79 6c69 6e65 7322 3a0a 2020   "polylines":.  
+00007050: 2020 2020 2020 2020 2020 2020 2020 6465                de
+00007060: 7465 6374 6564 5f6c 696e 6573 203d 2054  tected_lines = T
+00007070: 7275 650a 2020 2020 2020 2020 2020 2020  rue.            
+00007080: 2020 2020 706f 6c79 7320 3d20 706f 6c79      polys = poly
+00007090: 732e 6275 6666 6572 2831 302a 2a2d 3529  s.buffer(10**-5)
+000070a0: 2e73 696d 706c 6966 7928 3130 2a2a 2d35  .simplify(10**-5
+000070b0: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
+000070c0: 2020 7368 702e 6765 6f6d 6574 7279 2e69    shp.geometry.i
+000070d0: 6c6f 635b 696e 6465 785d 203d 2070 6f6c  loc[index] = pol
+000070e0: 7973 0a20 2020 2020 2020 2023 2070 7269  ys.        # pri
+000070f0: 6e74 206d 6573 7361 6765 730a 2020 2020  nt messages.    
+00007100: 2020 2020 6966 2064 6574 6563 7465 645f      if detected_
+00007110: 706f 696e 7473 3a0a 2020 2020 2020 2020  points:.        
+00007120: 2020 2020 7072 696e 7428 2745 4153 594d      print('EASYM
+00007130: 4f52 4520 6465 7465 6374 7320 706f 696e  ORE detects poin
+00007140: 7428 7329 2061 7320 6765 6f6d 6574 7279  t(s) as geometry
+00007150: 206f 6620 7461 7267 6574 2073 6861 7065   of target shape
+00007160: 6669 6c65 2061 6e64 2077 696c 6c20 6170  file and will ap
+00007170: 706c 7920 736d 616c 6c20 6275 6666 6572  ply small buffer
+00007180: 2074 6f20 7468 656d 2729 0a20 2020 2020   to them').     
+00007190: 2020 2069 6620 6465 7465 6374 6564 5f6d     if detected_m
+000071a0: 756c 7469 706f 696e 7473 3a0a 2020 2020  ultipoints:.    
+000071b0: 2020 2020 2020 2020 7072 696e 7428 2745          print('E
+000071c0: 4153 594d 4f52 4520 6465 7465 6374 6564  ASYMORE detected
+000071d0: 206d 756c 7469 706f 696e 7420 6173 2067   multipoint as g
+000071e0: 656f 6d65 7472 7920 6f66 2074 6172 6765  eometry of targe
+000071f0: 7420 7368 6170 6566 696c 6520 616e 6420  t shapefile and 
+00007200: 7769 6c6c 2063 6f6e 7369 6465 7265 2069  will considere i
+00007210: 7420 6173 206d 756c 7469 706f 6c79 676f  t as multipolygo
+00007220: 6e65 2729 0a20 2020 2020 2020 2020 2020  ne').           
+00007230: 2070 7269 6e74 2827 6865 6e63 6520 4541   print('hence EA
+00007240: 5359 4d4f 5245 2077 696c 6c20 7072 6f76  SYMORE will prov
+00007250: 6964 6520 7468 6520 6176 6572 6167 6520  ide the average 
+00007260: 6f66 2061 6c6c 2074 6865 2070 6f69 6e74  of all the point
+00007270: 2069 6e20 6561 6368 206d 756c 7469 706f   in each multipo
+00007280: 696e 7427 290a 2020 2020 2020 2020 2020  int').          
+00007290: 2020 7072 696e 7428 2769 6620 796f 7520    print('if you 
+000072a0: 6d69 7374 616b 656e 6c79 2068 6176 6520  mistakenly have 
+000072b0: 6769 7665 6e20 706f 6974 6e73 2061 7320  given poitns as 
+000072c0: 6d75 6c74 6970 6f69 6e74 7320 706c 6561  multipoints plea
+000072d0: 7365 2063 6f72 7265 6374 2074 6865 2074  se correct the t
+000072e0: 6172 6765 7420 7368 6170 6566 696c 6527  arget shapefile'
+000072f0: 290a 2020 2020 2020 2020 6966 2064 6574  ).        if det
+00007300: 6563 7465 645f 6c69 6e65 733a 0a20 2020  ected_lines:.   
+00007310: 2020 2020 2020 2020 2070 7269 6e74 2827           print('
+00007320: 4541 5359 4d4f 5245 2064 6574 6563 7465  EASYMORE detecte
+00007330: 6420 6c69 6e65 2061 7320 6765 6f6d 6574  d line as geomet
+00007340: 7279 206f 6620 7461 7267 6574 2073 6861  ry of target sha
+00007350: 7065 6669 6c65 2061 6e64 2077 696c 6c20  pefile and will 
+00007360: 636f 6e73 6964 6572 6520 6974 2061 7320  considere it as 
+00007370: 706f 6c79 676f 6e20 2861 6464 696e 6720  polygon (adding 
+00007380: 736d 616c 6c20 6275 6666 6572 2927 290a  small buffer)').
+00007390: 2020 2020 2020 2020 7072 696e 7428 2769          print('i
+000073a0: 7420 7365 656d 7320 6576 6572 7974 6869  t seems everythi
+000073b0: 6e67 2069 7320 4f4b 2077 6974 6820 7468  ng is OK with th
+000073c0: 6520 7369 6e6b 2f74 6172 6765 7420 7368  e sink/target sh
+000073d0: 6170 6566 696c 653b 2061 6464 6564 2074  apefile; added t
+000073e0: 6f20 4541 5359 4d4f 5245 206f 626a 6563  o EASYMORE objec
+000073f0: 7420 7461 7267 6574 5f73 6870 5f67 7064  t target_shp_gpd
+00007400: 2729 0a20 2020 2020 2020 2069 6620 7365  ').        if se
+00007410: 6c66 2e73 6f72 745f 4944 3a0a 2020 2020  lf.sort_ID:.    
+00007420: 2020 2020 2020 2020 7368 7020 3d20 7368          shp = sh
+00007430: 702e 736f 7274 5f76 616c 7565 7328 6279  p.sort_values(by
+00007440: 3d27 4944 5f74 2729 0a20 2020 2020 2020  ='ID_t').       
+00007450: 2020 2020 2073 6870 203d 2073 6870 2e72       shp = shp.r
+00007460: 6573 6574 5f69 6e64 6578 2864 726f 703d  eset_index(drop=
+00007470: 5472 7565 290a 2020 2020 2020 2020 7368  True).        sh
+00007480: 705b 276f 7264 6572 275d 203d 206e 702e  p['order'] = np.
+00007490: 6172 616e 6765 286c 656e 2873 6870 2929  arange(len(shp))
+000074a0: 202b 2031 2023 206f 7264 6572 206f 6620   + 1 # order of 
+000074b0: 7468 6520 7368 6170 6566 696c 650a 2020  the shapefile.  
+000074c0: 2020 2020 2020 7265 7475 726e 2073 6870        return shp
+000074d0: 0a0a 2020 2020 6465 6620 6368 6563 6b5f  ..    def check_
+000074e0: 736f 7572 6365 5f6e 6320 2873 656c 6629  source_nc (self)
+000074f0: 3a0a 2020 2020 2020 2020 2222 220a 2020  :.        """.  
+00007500: 2020 2020 2020 4020 6175 7468 6f72 3a20        @ author: 
+00007510: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00007520: 2053 6865 7276 616e 2047 6861 7261 7269   Shervan Gharari
+00007530: 0a20 2020 2020 2020 2040 2047 6974 6875  .        @ Githu
+00007540: 623a 2020 2020 2020 2020 2020 2020 2020  b:              
+00007550: 2020 2020 6874 7470 733a 2f2f 6769 7468      https://gith
+00007560: 7562 2e63 6f6d 2f53 6865 7276 616e 4768  ub.com/ShervanGh
+00007570: 6172 6172 692f 4541 5359 4d4f 5245 0a20  arari/EASYMORE. 
+00007580: 2020 2020 2020 2040 2061 7574 686f 7227         @ author'
+00007590: 7320 656d 6169 6c20 6964 3a20 2020 2020  s email id:     
+000075a0: 2020 7368 2e67 6861 7261 7269 4067 6d61    sh.gharari@gma
+000075b0: 696c 2e63 6f6d 0a20 2020 2020 2020 2040  il.com.        @
+000075c0: 206c 6963 656e 7365 3a20 2020 2020 2020   license:       
+000075d0: 2020 2020 2020 2020 2020 474e 552d 4750            GNU-GP
+000075e0: 4c76 330a 2020 2020 2020 2020 5468 6973  Lv3.        This
+000075f0: 2066 756e 6374 696f 6e20 6368 6563 6b73   function checks
+00007600: 2074 6865 2063 6f6e 7369 7374 656e 6379   the consistency
+00007610: 206f 6620 7468 6520 6469 6d65 6e74 696f   of the dimentio
+00007620: 6e73 2061 6e64 2076 6172 6961 626c 6573  ns and variables
+00007630: 2066 6f72 2073 6f75 7263 6520 6e65 7463   for source netc
+00007640: 6466 2066 696c 6528 7329 0a20 2020 2020  df file(s).     
+00007650: 2020 2022 2222 0a20 2020 2020 2020 2066     """.        f
+00007660: 6c61 675f 646f 5f6e 6f74 5f6d 6174 6368  lag_do_not_match
+00007670: 203d 2046 616c 7365 0a20 2020 2020 2020   = False.       
+00007680: 206e 635f 6e61 6d65 7320 3d20 736f 7274   nc_names = sort
+00007690: 6564 2867 6c6f 622e 676c 6f62 2028 7365  ed(glob.glob (se
+000076a0: 6c66 2e73 6f75 7263 655f 6e63 2929 0a20  lf.source_nc)). 
+000076b0: 2020 2020 2020 2069 6620 6e6f 7420 6e63         if not nc
+000076c0: 5f6e 616d 6573 3a0a 2020 2020 2020 2020  _names:.        
+000076d0: 2020 2020 7379 732e 6578 6974 2827 4541      sys.exit('EA
+000076e0: 5359 4d4f 5245 2064 6574 6563 7473 206e  SYMORE detects n
+000076f0: 6f20 6e65 7443 4446 2066 696c 653b 2063  o netCDF file; c
+00007700: 6865 636b 2074 6865 2070 6174 6820 746f  heck the path to
+00007710: 2074 6865 2073 6f75 7265 206e 6574 4344   the soure netCD
+00007720: 4620 6669 6c65 7327 290a 2020 2020 2020  F files').      
+00007730: 2020 656c 7365 3a0a 2020 2020 2020 2020    else:.        
+00007740: 2020 2020 2320 7768 656e 2073 6b69 705f      # when skip_
+00007750: 6368 6563 6b5f 616c 6c5f 736f 7572 6365  check_all_source
+00007760: 5f6e 6320 6973 2054 7275 6520 6561 7379  _nc is True easy
+00007770: 6d6f 7265 206f 6e6c 790a 2020 2020 2020  more only.      
+00007780: 2020 2020 2020 2320 6368 6563 6b20 7468        # check th
+00007790: 6520 6669 7273 7420 6669 6c65 2061 6e64  e first file and
+000077a0: 206e 6f74 2061 6c6c 2074 6865 2063 6f6e   not all the con
+000077b0: 7369 7374 616e 6379 206f 6620 616c 6c20  sistancy of all 
+000077c0: 7468 6520 6669 6c65 7320 746f 2074 6865  the files to the
+000077d0: 2066 6972 7374 2066 696c 650a 2020 2020   first file.    
+000077e0: 2020 2020 2020 2020 6966 2073 656c 662e          if self.
+000077f0: 736b 6970 5f63 6865 636b 5f61 6c6c 5f73  skip_check_all_s
+00007800: 6f75 7263 655f 6e63 2061 6e64 206c 656e  ource_nc and len
+00007810: 286e 635f 6e61 6d65 7329 3e31 3a0a 2020  (nc_names)>1:.  
+00007820: 2020 2020 2020 2020 2020 2020 2020 6e63                nc
+00007830: 5f6e 616d 6573 203d 205b 6e63 5f6e 616d  _names = [nc_nam
+00007840: 6573 5b30 5d5d 0a20 2020 2020 2020 2020  es[0]].         
+00007850: 2020 2020 2020 2070 7269 6e74 2827 4541         print('EA
+00007860: 5359 4d4f 5245 206f 6e6c 7920 6368 6563  SYMORE only chec
+00007870: 6b73 2074 6865 2066 6972 7374 206f 6620  ks the first of 
+00007880: 736f 7572 6365 206e 6574 6364 6620 6669  source netcdf fi
+00007890: 6c65 7320 666f 7220 636f 6e73 6973 7465  les for consiste
+000078a0: 6e63 7920 6f66 2076 6172 6961 626c 6573  ncy of variables
+000078b0: 2061 6e64 2064 696d 656e 7369 6f6e 7320   and dimensions 
+000078c0: 272b 5c0a 2020 2020 2020 2020 2020 2020  '+\.            
+000078d0: 2020 2020 2020 2020 2020 2761 6e64 2061            'and a
+000078e0: 7373 756d 6573 206f 7468 6572 206e 6574  ssumes other net
+000078f0: 6364 6620 736f 7572 6365 2066 696c 6573  cdf source files
+00007900: 2061 7265 2063 6f6e 7369 7374 656e 7420   are consistent 
+00007910: 7769 7468 2074 6865 2066 6972 7374 2066  with the first f
+00007920: 696c 653a 2027 2c20 6e63 5f6e 616d 6573  ile: ', nc_names
+00007930: 5b30 5d29 0a20 2020 2020 2020 2020 2020  [0]).           
+00007940: 2023 2063 6f6e 7469 6e75 6520 6368 6563   # continue chec
+00007950: 6b69 6e67 0a20 2020 2020 2020 2020 2020  king.           
+00007960: 206e 6369 6420 2020 2020 203d 206e 6334   ncid      = nc4
+00007970: 2e44 6174 6173 6574 286e 635f 6e61 6d65  .Dataset(nc_name
+00007980: 735b 305d 290a 2020 2020 2020 2020 2020  s[0]).          
+00007990: 2020 7661 725f 6469 6d20 2020 3d20 6c69    var_dim   = li
+000079a0: 7374 286e 6369 642e 7661 7269 6162 6c65  st(ncid.variable
+000079b0: 735b 7365 6c66 2e76 6172 5f6e 616d 6573  s[self.var_names
+000079c0: 5b30 5d5d 2e64 696d 656e 7369 6f6e 7329  [0]].dimensions)
+000079d0: 0a20 2020 2020 2020 2020 2020 206c 6174  .            lat
+000079e0: 5f64 696d 2020 203d 206c 6973 7428 6e63  _dim   = list(nc
+000079f0: 6964 2e76 6172 6961 626c 6573 5b73 656c  id.variables[sel
+00007a00: 662e 7661 725f 6c61 745d 2e64 696d 656e  f.var_lat].dimen
+00007a10: 7369 6f6e 7329 0a20 2020 2020 2020 2020  sions).         
+00007a20: 2020 206c 6f6e 5f64 696d 2020 203d 206c     lon_dim   = l
+00007a30: 6973 7428 6e63 6964 2e76 6172 6961 626c  ist(ncid.variabl
+00007a40: 6573 5b73 656c 662e 7661 725f 6c6f 6e5d  es[self.var_lon]
+00007a50: 2e64 696d 656e 7369 6f6e 7329 0a20 2020  .dimensions).   
+00007a60: 2020 2020 2020 2020 206c 6174 5f76 616c           lat_val
+00007a70: 7565 203d 206e 702e 6172 7261 7928 6e63  ue = np.array(nc
+00007a80: 6964 2e76 6172 6961 626c 6573 5b73 656c  id.variables[sel
+00007a90: 662e 7661 725f 6c61 745d 290a 2020 2020  f.var_lat]).    
+00007aa0: 2020 2020 2020 2020 6c6f 6e5f 7661 6c75          lon_valu
+00007ab0: 6520 3d20 6e70 2e61 7272 6179 286e 6369  e = np.array(nci
+00007ac0: 642e 7661 7269 6162 6c65 735b 7365 6c66  d.variables[self
+00007ad0: 2e76 6172 5f6c 6f6e 5d29 0a20 2020 2020  .var_lon]).     
+00007ae0: 2020 2020 2020 2023 2064 696d 656e 7369         # dimensi
+00007af0: 6f6e 2063 6865 636b 2062 6173 6564 206f  on check based o
+00007b00: 6e20 7468 6520 6669 7273 7420 6e65 7463  n the first netc
+00007b10: 6466 2066 696c 650a 2020 2020 2020 2020  df file.        
+00007b20: 2020 2020 6966 206e 6f74 2028 7365 7428      if not (set(
+00007b30: 6c61 745f 6469 6d29 203c 3d20 7365 7428  lat_dim) <= set(
+00007b40: 7661 725f 6469 6d29 293a 0a20 2020 2020  var_dim)):.     
+00007b50: 2020 2020 2020 2020 2020 2066 6c61 675f             flag_
+00007b60: 646f 5f6e 6f74 5f6d 6174 6368 203d 2054  do_not_match = T
+00007b70: 7275 650a 2020 2020 2020 2020 2020 2020  rue.            
+00007b80: 6966 206e 6f74 2028 7365 7428 6c6f 6e5f  if not (set(lon_
+00007b90: 6469 6d29 203c 3d20 7365 7428 7661 725f  dim) <= set(var_
+00007ba0: 6469 6d29 293a 0a20 2020 2020 2020 2020  dim)):.         
+00007bb0: 2020 2020 2020 2066 6c61 675f 646f 5f6e         flag_do_n
+00007bc0: 6f74 5f6d 6174 6368 203d 2054 7275 650a  ot_match = True.
+00007bd0: 2020 2020 2020 2020 2020 2020 6966 2028              if (
+00007be0: 6c65 6e28 6c61 745f 6469 6d29 203d 3d20  len(lat_dim) == 
+00007bf0: 3229 2061 6e64 2028 6c65 6e28 6c6f 6e5f  2) and (len(lon_
+00007c00: 6469 6d29 203d 3d20 3229 2061 6e64 2028  dim) == 2) and (
+00007c10: 6c65 6e28 7661 725f 6469 6d29 203d 3d20  len(var_dim) == 
+00007c20: 3329 3a20 2320 6361 7365 2032 0a20 2020  3): # case 2.   
+00007c30: 2020 2020 2020 2020 2020 2020 2069 6620               if 
+00007c40: 6e6f 7420 2873 6574 286c 6174 5f64 696d  not (set(lat_dim
+00007c50: 2920 3d3d 2073 6574 286c 6f6e 5f64 696d  ) == set(lon_dim
+00007c60: 2929 3a0a 2020 2020 2020 2020 2020 2020  )):.            
+00007c70: 2020 2020 2020 2020 666c 6167 5f64 6f5f          flag_do_
+00007c80: 6e6f 745f 6d61 7463 6820 3d20 5472 7565  not_match = True
+00007c90: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
+00007ca0: 286c 656e 286c 6174 5f64 696d 2920 3d3d  (len(lat_dim) ==
+00007cb0: 2031 2920 616e 6420 286c 656e 286c 6f6e   1) and (len(lon
+00007cc0: 5f64 696d 2920 3d3d 2031 2920 616e 6420  _dim) == 1) and 
+00007cd0: 286c 656e 2876 6172 5f64 696d 2920 3d3d  (len(var_dim) ==
+00007ce0: 2032 293a 2023 2063 6173 6520 330a 2020   2): # case 3.  
+00007cf0: 2020 2020 2020 2020 2020 2020 2020 6966                if
+00007d00: 206e 6f74 2028 7365 7428 6c61 745f 6469   not (set(lat_di
+00007d10: 6d29 203d 3d20 7365 7428 6c6f 6e5f 6469  m) == set(lon_di
+00007d20: 6d29 293a 0a20 2020 2020 2020 2020 2020  m)):.           
+00007d30: 2020 2020 2020 2020 2066 6c61 675f 646f           flag_do
+00007d40: 5f6e 6f74 5f6d 6174 6368 203d 2054 7275  _not_match = Tru
+00007d50: 650a 2020 2020 2020 2020 2020 2020 2320  e.            # 
+00007d60: 6469 6d65 6e73 696f 6e20 6368 6563 6b20  dimension check 
+00007d70: 616e 6420 636f 6e73 6973 7461 6e63 7920  and consistancy 
+00007d80: 666f 7220 7661 7269 6162 6c65 206c 6174  for variable lat
+00007d90: 6974 7564 650a 2020 2020 2020 2020 2020  itude.          
+00007da0: 2020 666f 7220 6e63 5f6e 616d 6520 696e    for nc_name in
+00007db0: 206e 635f 6e61 6d65 733a 0a20 2020 2020   nc_names:.     
+00007dc0: 2020 2020 2020 2020 2020 206e 6369 6420             ncid 
+00007dd0: 3d20 6e63 342e 4461 7461 7365 7428 6e63  = nc4.Dataset(nc
+00007de0: 5f6e 616d 6529 0a20 2020 2020 2020 2020  _name).         
+00007df0: 2020 2020 2020 2074 656d 7020 3d20 6c69         temp = li
+00007e00: 7374 286e 6369 642e 7661 7269 6162 6c65  st(ncid.variable
+00007e10: 735b 7365 6c66 2e76 6172 5f6c 6174 5d2e  s[self.var_lat].
+00007e20: 6469 6d65 6e73 696f 6e73 290a 2020 2020  dimensions).    
+00007e30: 2020 2020 2020 2020 2020 2020 2320 6669              # fi
+00007e40: 7374 2063 6865 636b 2074 6865 206c 656e  st check the len
+00007e50: 6774 6820 6f66 2074 6865 2074 656d 7020  gth of the temp 
+00007e60: 616e 6420 6c61 745f 6469 6d0a 2020 2020  and lat_dim.    
+00007e70: 2020 2020 2020 2020 2020 2020 6966 206c              if l
+00007e80: 656e 2874 656d 7029 2021 3d20 6c65 6e28  en(temp) != len(
+00007e90: 6c61 745f 6469 6d29 3a0a 2020 2020 2020  lat_dim):.      
+00007ea0: 2020 2020 2020 2020 2020 2020 2020 666c                fl
+00007eb0: 6167 5f64 6f5f 6e6f 745f 6d61 7463 6820  ag_do_not_match 
+00007ec0: 3d20 5472 7565 0a20 2020 2020 2020 2020  = True.         
+00007ed0: 2020 2020 2020 2065 6c73 653a 0a20 2020         else:.   
+00007ee0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00007ef0: 2066 6f72 2069 2069 6e20 6e70 2e61 7261   for i in np.ara
+00007f00: 6e67 6528 6c65 6e28 7465 6d70 2929 3a0a  nge(len(temp)):.
+00007f10: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00007f20: 2020 2020 2020 2020 6966 2074 656d 705b          if temp[
+00007f30: 695d 2021 3d20 6c61 745f 6469 6d5b 695d  i] != lat_dim[i]
+00007f40: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+00007f50: 2020 2020 2020 2020 2020 2020 2020 666c                fl
+00007f60: 6167 5f64 6f5f 6e6f 745f 6d61 7463 6820  ag_do_not_match 
+00007f70: 3d20 5472 7565 0a20 2020 2020 2020 2020  = True.         
+00007f80: 2020 2020 2020 2074 656d 7020 3d20 6e70         temp = np
+00007f90: 2e61 7272 6179 286e 6369 642e 7661 7269  .array(ncid.vari
+00007fa0: 6162 6c65 735b 7365 6c66 2e76 6172 5f6c  ables[self.var_l
+00007fb0: 6174 5d29 0a20 2020 2020 2020 2020 2020  at]).           
+00007fc0: 2020 2020 2069 6620 6e70 2e73 756d 2861       if np.sum(a
+00007fd0: 6273 286c 6174 5f76 616c 7565 2d74 656d  bs(lat_value-tem
+00007fe0: 7029 293e 7365 6c66 2e74 6f6c 6572 616e  p))>self.toleran
+00007ff0: 6365 3a0a 2020 2020 2020 2020 2020 2020  ce:.            
+00008000: 2020 2020 2020 2020 666c 6167 5f64 6f5f          flag_do_
+00008010: 6e6f 745f 6d61 7463 6820 3d20 5472 7565  not_match = True
+00008020: 0a20 2020 2020 2020 2020 2020 2023 2064  .            # d
+00008030: 696d 656e 7369 6f6e 2063 6865 636b 2061  imension check a
+00008040: 6e64 2063 6f6e 7369 7374 616e 6379 2066  nd consistancy f
+00008050: 6f72 2076 6172 6961 626c 6520 6c6f 6e67  or variable long
+00008060: 6974 7564 650a 2020 2020 2020 2020 2020  itude.          
+00008070: 2020 666f 7220 6e63 5f6e 616d 6520 696e    for nc_name in
+00008080: 206e 635f 6e61 6d65 733a 0a20 2020 2020   nc_names:.     
+00008090: 2020 2020 2020 2020 2020 206e 6369 6420             ncid 
+000080a0: 3d20 6e63 342e 4461 7461 7365 7428 6e63  = nc4.Dataset(nc
+000080b0: 5f6e 616d 6529 0a20 2020 2020 2020 2020  _name).         
+000080c0: 2020 2020 2020 2074 656d 7020 3d20 6c69         temp = li
+000080d0: 7374 286e 6369 642e 7661 7269 6162 6c65  st(ncid.variable
+000080e0: 735b 7365 6c66 2e76 6172 5f6c 6f6e 5d2e  s[self.var_lon].
+000080f0: 6469 6d65 6e73 696f 6e73 290a 2020 2020  dimensions).    
+00008100: 2020 2020 2020 2020 2020 2020 2320 6669              # fi
+00008110: 7374 2063 6865 636b 2074 6865 206c 656e  st check the len
+00008120: 6774 6820 6f66 2074 6865 2074 656d 7020  gth of the temp 
+00008130: 616e 6420 6c6f 6e5f 6469 6d0a 2020 2020  and lon_dim.    
+00008140: 2020 2020 2020 2020 2020 2020 6966 206c              if l
+00008150: 656e 2874 656d 7029 2021 3d20 6c65 6e28  en(temp) != len(
+00008160: 6c6f 6e5f 6469 6d29 3a0a 2020 2020 2020  lon_dim):.      
+00008170: 2020 2020 2020 2020 2020 2020 2020 666c                fl
+00008180: 6167 5f64 6f5f 6e6f 745f 6d61 7463 6820  ag_do_not_match 
+00008190: 3d20 5472 7565 0a20 2020 2020 2020 2020  = True.         
+000081a0: 2020 2020 2020 2065 6c73 653a 0a20 2020         else:.   
+000081b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000081c0: 2066 6f72 2069 2069 6e20 6e70 2e61 7261   for i in np.ara
+000081d0: 6e67 6528 6c65 6e28 7465 6d70 2929 3a0a  nge(len(temp)):.
+000081e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000081f0: 2020 2020 2020 2020 6966 2074 656d 705b          if temp[
+00008200: 695d 2021 3d20 6c6f 6e5f 6469 6d5b 695d  i] != lon_dim[i]
+00008210: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+00008220: 2020 2020 2020 2020 2020 2020 2020 666c                fl
+00008230: 6167 5f64 6f5f 6e6f 745f 6d61 7463 6820  ag_do_not_match 
+00008240: 3d20 5472 7565 0a20 2020 2020 2020 2020  = True.         
+00008250: 2020 2020 2020 2074 656d 7020 3d20 6e70         temp = np
+00008260: 2e61 7272 6179 286e 6369 642e 7661 7269  .array(ncid.vari
+00008270: 6162 6c65 735b 7365 6c66 2e76 6172 5f6c  ables[self.var_l
+00008280: 6f6e 5d29 0a20 2020 2020 2020 2020 2020  on]).           
+00008290: 2020 2020 2069 6620 6e70 2e73 756d 2861       if np.sum(a
+000082a0: 6273 286c 6f6e 5f76 616c 7565 2d74 656d  bs(lon_value-tem
+000082b0: 7029 293e 7365 6c66 2e74 6f6c 6572 616e  p))>self.toleran
+000082c0: 6365 3a0a 2020 2020 2020 2020 2020 2020  ce:.            
+000082d0: 2020 2020 2020 2020 666c 6167 5f64 6f5f          flag_do_
+000082e0: 6e6f 745f 6d61 7463 6820 3d20 5472 7565  not_match = True
+000082f0: 0a20 2020 2020 2020 2020 2020 2023 2064  .            # d
+00008300: 696d 656e 7369 6f6e 2063 6865 636b 2063  imension check c
+00008310: 6f6e 7369 7374 616e 6379 2066 6f72 2076  onsistancy for v
+00008320: 6172 6961 626c 6573 2074 6f20 6265 2072  ariables to be r
+00008330: 656d 6170 7065 640a 2020 2020 2020 2020  emapped.        
+00008340: 2020 2020 666f 7220 7661 725f 6e61 6d65      for var_name
+00008350: 2069 6e20 7365 6c66 2e76 6172 5f6e 616d   in self.var_nam
+00008360: 6573 3a0a 2020 2020 2020 2020 2020 2020  es:.            
+00008370: 2020 2020 2320 6765 7420 7468 6520 7661      # get the va
+00008380: 7269 6162 6c65 2069 6e66 6f72 6d61 7469  riable informati
+00008390: 6f6e 206f 6620 6c61 742c 206c 6f6e 2061  on of lat, lon a
+000083a0: 6e64 2064 696d 656e 7369 6f6e 7320 6f66  nd dimensions of
+000083b0: 2074 6865 2076 6172 6961 626c 652e 0a20   the variable.. 
+000083c0: 2020 2020 2020 2020 2020 2020 2020 2066                 f
+000083d0: 6f72 206e 635f 6e61 6d65 2069 6e20 6e63  or nc_name in nc
+000083e0: 5f6e 616d 6573 3a0a 2020 2020 2020 2020  _names:.        
+000083f0: 2020 2020 2020 2020 2020 2020 6e63 6964              ncid
+00008400: 203d 206e 6334 2e44 6174 6173 6574 286e   = nc4.Dataset(n
+00008410: 635f 6e61 6d65 290a 2020 2020 2020 2020  c_name).        
+00008420: 2020 2020 2020 2020 2020 2020 7465 6d70              temp
+00008430: 203d 206c 6973 7428 6e63 6964 2e76 6172   = list(ncid.var
+00008440: 6961 626c 6573 5b76 6172 5f6e 616d 655d  iables[var_name]
+00008450: 2e64 696d 656e 7369 6f6e 7329 0a20 2020  .dimensions).   
+00008460: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00008470: 2023 2066 6973 7420 6368 6563 6b20 7468   # fist check th
+00008480: 6520 6c65 6e67 7468 206f 6620 7468 6520  e length of the 
+00008490: 7465 6d70 2061 6e64 2076 6172 5f64 696d  temp and var_dim
+000084a0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+000084b0: 2020 2020 2069 6620 6c65 6e28 7465 6d70       if len(temp
+000084c0: 2920 213d 206c 656e 2876 6172 5f64 696d  ) != len(var_dim
+000084d0: 293a 0a20 2020 2020 2020 2020 2020 2020  ):.             
+000084e0: 2020 2020 2020 2020 2020 2066 6c61 675f             flag_
+000084f0: 646f 5f6e 6f74 5f6d 6174 6368 203d 2054  do_not_match = T
+00008500: 7275 650a 2020 2020 2020 2020 2020 2020  rue.            
+00008510: 2020 2020 2020 2020 656c 7365 3a0a 2020          else:.  
+00008520: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00008530: 2020 2020 2020 666f 7220 6920 696e 206e        for i in n
+00008540: 702e 6172 616e 6765 286c 656e 2874 656d  p.arange(len(tem
+00008550: 7029 293a 0a20 2020 2020 2020 2020 2020  p)):.           
+00008560: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00008570: 2069 6620 7465 6d70 5b69 5d20 213d 2076   if temp[i] != v
+00008580: 6172 5f64 696d 5b69 5d3a 0a20 2020 2020  ar_dim[i]:.     
+00008590: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000085a0: 2020 2020 2020 2020 2020 2066 6c61 675f             flag_
+000085b0: 646f 5f6e 6f74 5f6d 6174 6368 203d 2054  do_not_match = T
+000085c0: 7275 650a 2020 2020 2020 2020 2020 2020  rue.            
+000085d0: 2320 6368 6563 6b20 7661 7269 6162 6c65  # check variable
+000085e0: 2074 696d 6520 616e 6420 6469 6d65 6e73   time and dimens
+000085f0: 696f 6e20 7469 6d65 2061 7265 2074 6865  ion time are the
+00008600: 2073 616d 6520 6e61 6d65 2073 6f20 7469   same name so ti
+00008610: 6d65 2069 7320 636f 6f72 6469 6e61 7465  me is coordinate
+00008620: 0a20 2020 2020 2020 2020 2020 2066 6f72  .            for
+00008630: 206e 635f 6e61 6d65 2069 6e20 6e63 5f6e   nc_name in nc_n
+00008640: 616d 6573 3a0a 2020 2020 2020 2020 2020  ames:.          
+00008650: 2020 2020 2020 6e63 6964 203d 206e 6334        ncid = nc4
+00008660: 2e44 6174 6173 6574 286e 635f 6e61 6d65  .Dataset(nc_name
+00008670: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
+00008680: 2020 7465 6d70 203d 206e 6369 642e 7661    temp = ncid.va
+00008690: 7269 6162 6c65 735b 7365 6c66 2e76 6172  riables[self.var
+000086a0: 5f74 696d 655d 2e64 696d 656e 7369 6f6e  _time].dimension
+000086b0: 730a 2020 2020 2020 2020 2020 2020 2020  s.              
+000086c0: 2020 6966 206c 656e 2874 656d 7029 2021    if len(temp) !
+000086d0: 3d20 313a 0a20 2020 2020 2020 2020 2020  = 1:.           
+000086e0: 2020 2020 2020 2020 2073 7973 2e65 7869           sys.exi
+000086f0: 7428 2745 4153 594d 4f52 4520 6578 7065  t('EASYMORE expe
+00008700: 6374 7320 3144 2074 696d 6520 7661 7269  cts 1D time vari
+00008710: 6162 6c65 2c20 6974 2073 6565 6d73 2074  able, it seems t
+00008720: 696d 6520 7661 7269 6162 6c65 7320 6861  ime variables ha
+00008730: 7320 6d6f 7265 2074 6861 6e20 3120 6469  s more than 1 di
+00008740: 6d65 6e73 696f 6e27 290a 2020 2020 2020  mension').      
+00008750: 2020 2020 2020 2020 2020 6966 2073 7472            if str
+00008760: 2874 656d 705b 305d 2920 213d 2073 656c  (temp[0]) != sel
+00008770: 662e 7661 725f 7469 6d65 3a0a 2020 2020  f.var_time:.    
+00008780: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00008790: 7379 732e 6578 6974 2827 4541 5359 4d4f  sys.exit('EASYMO
+000087a0: 5245 2065 7870 6563 7473 2074 696d 6520  RE expects time 
+000087b0: 7661 7269 6162 6c65 2061 6e64 2064 696d  variable and dim
+000087c0: 656e 7369 6f6e 2074 6f20 6265 2064 6966  ension to be dif
+000087d0: 6665 7265 6e74 2c20 7468 6579 2073 686f  ferent, they sho
+000087e0: 756c 6420 6265 2074 6865 2073 616d 655c  uld be the same\
+000087f0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00008800: 2020 2020 2066 6f72 2078 6172 7261 7920       for xarray 
+00008810: 746f 2063 6f6e 7369 6465 7220 7469 6d65  to consider time
+00008820: 2064 696d 656e 7369 6f6e 2061 7320 636f   dimension as co
+00008830: 6f72 6469 6e61 7465 7327 290a 2020 2020  ordinates').    
+00008840: 2020 2020 6966 2066 6c61 675f 646f 5f6e      if flag_do_n
+00008850: 6f74 5f6d 6174 6368 3a0a 2020 2020 2020  ot_match:.      
+00008860: 2020 2020 2020 7379 732e 6578 6974 2827        sys.exit('
+00008870: 4541 5359 4d4f 5245 2064 6574 6563 7473  EASYMORE detects
+00008880: 2074 6861 7420 616c 6c20 7468 6520 7072   that all the pr
+00008890: 6f76 6964 6564 206e 6574 4344 4620 6669  ovided netCDF fi
+000088a0: 6c65 7320 616e 6420 7661 7269 6162 6c65  les and variable
+000088b0: 7320 5c0a 6861 7320 6469 6666 6572 656e  s \.has differen
+000088c0: 7420 6469 6d65 6e73 696f 6e73 2066 6f72  t dimensions for
+000088d0: 2074 6865 2076 6172 6961 626c 6573 206f   the variables o
+000088e0: 7220 6c61 7469 7475 6465 2061 6e64 206c  r latitude and l
+000088f0: 6f6e 6769 7475 6465 2729 0a20 2020 2020  ongitude').     
+00008900: 2020 2065 6c73 653a 0a20 2020 2020 2020     else:.       
+00008910: 2020 2020 2070 7269 6e74 2827 4541 5359       print('EASY
+00008920: 4d4f 5245 2064 6574 6563 7473 2074 6861  MORE detects tha
+00008930: 7420 7468 6520 7661 7269 6162 6c65 7320  t the variables 
+00008940: 6672 6f6d 2074 6865 206e 6574 4344 4620  from the netCDF 
+00008950: 6669 6c65 7320 6172 6520 6964 656e 7469  files are identi
+00008960: 6361 6c5c 0a69 6e20 6469 6d65 6e73 696f  cal\.in dimensio
+00008970: 6e73 206f 6620 7468 6520 7661 7269 6162  ns of the variab
+00008980: 6c65 7320 616e 6420 6c61 7469 7475 6465  les and latitude
+00008990: 2061 6e64 206c 6f6e 6769 7475 6465 2729   and longitude')
+000089a0: 0a20 2020 2020 2020 2020 2020 2070 7269  .            pri
+000089b0: 6e74 2827 4541 5359 4d4f 5245 2064 6574  nt('EASYMORE det
+000089c0: 6563 7473 2074 6861 7420 616c 6c20 7468  ects that all th
+000089d0: 6520 7661 7269 6162 6c65 7320 6861 7665  e variables have
+000089e0: 2064 696d 656e 7369 6f6e 7320 6f66 3a27   dimensions of:'
+000089f0: 290a 2020 2020 2020 2020 2020 2020 7072  ).            pr
+00008a00: 696e 7428 7661 725f 6469 6d29 0a20 2020  int(var_dim).   
+00008a10: 2020 2020 2020 2020 2070 7269 6e74 2827           print('
+00008a20: 4541 5359 4d4f 5245 2064 6574 6563 7473  EASYMORE detects
+00008a30: 2074 6861 7420 7468 6520 6c6f 6e67 6974   that the longit
+00008a40: 7564 6520 7661 7269 6162 6c65 7320 6861  ude variables ha
+00008a50: 7320 6469 6d65 6e73 696f 6e73 206f 663a  s dimensions of:
+00008a60: 2729 0a20 2020 2020 2020 2020 2020 2070  ').            p
+00008a70: 7269 6e74 286c 6f6e 5f64 696d 290a 2020  rint(lon_dim).  
+00008a80: 2020 2020 2020 2020 2020 7072 696e 7428            print(
+00008a90: 2745 4153 594d 4f52 4520 6465 7465 6374  'EASYMORE detect
+00008aa0: 7320 7468 6174 2074 6865 206c 6174 6974  s that the latit
+00008ab0: 7564 6520 7661 7269 6162 6c65 7320 6861  ude variables ha
+00008ac0: 7320 6469 6d65 6e73 696f 6e73 206f 663a  s dimensions of:
+00008ad0: 2729 0a20 2020 2020 2020 2020 2020 2070  ').            p
+00008ae0: 7269 6e74 286c 6174 5f64 696d 290a 0a20  rint(lat_dim).. 
+00008af0: 2020 2064 6566 2063 6865 636b 5f73 6f75     def check_sou
+00008b00: 7263 655f 6e63 5f73 6870 2028 7365 6c66  rce_nc_shp (self
+00008b10: 293a 0a20 2020 2020 2020 2022 2222 0a20  ):.        """. 
+00008b20: 2020 2020 2020 2040 2061 7574 686f 723a         @ author:
+00008b30: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00008b40: 2020 5368 6572 7661 6e20 4768 6172 6172    Shervan Gharar
+00008b50: 690a 2020 2020 2020 2020 4020 4769 7468  i.        @ Gith
+00008b60: 7562 3a20 2020 2020 2020 2020 2020 2020  ub:             
+00008b70: 2020 2020 2068 7474 7073 3a2f 2f67 6974       https://git
+00008b80: 6875 622e 636f 6d2f 5368 6572 7661 6e47  hub.com/ShervanG
+00008b90: 6861 7261 7269 2f45 4153 594d 4f52 450a  harari/EASYMORE.
+00008ba0: 2020 2020 2020 2020 4020 6175 7468 6f72          @ author
+00008bb0: 2773 2065 6d61 696c 2069 643a 2020 2020  's email id:    
+00008bc0: 2020 2073 682e 6768 6172 6172 6940 676d     sh.gharari@gm
+00008bd0: 6169 6c2e 636f 6d0a 2020 2020 2020 2020  ail.com.        
+00008be0: 4020 6c69 6365 6e73 653a 2020 2020 2020  @ license:      
+00008bf0: 2020 2020 2020 2020 2020 2047 4e55 2d47             GNU-G
+00008c00: 504c 7633 0a20 2020 2020 2020 2054 6869  PLv3.        Thi
+00008c10: 7320 6675 6e63 7469 6f6e 2063 6865 636b  s function check
+00008c20: 7320 7468 6520 736f 7572 6365 206e 6574  s the source net
+00008c30: 6364 6620 6669 6c65 2073 6861 7065 6669  cdf file shapefi
+00008c40: 6c65 0a20 2020 2020 2020 206e 6565 6473  le.        needs
+00008c50: 206d 6f72 6520 6465 7665 6c6f 706d 656e   more developmen
+00008c60: 740a 2020 2020 2020 2020 2222 220a 2020  t.        """.  
+00008c70: 2020 2020 2020 2320 6c6f 6164 2074 6865        # load the
+00008c80: 206e 6565 6465 6420 7061 636b 6167 6573   needed packages
+00008c90: 0a20 2020 2020 2020 2069 6d70 6f72 7420  .        import 
+00008ca0: 6765 6f70 616e 6461 7320 6173 2067 7064  geopandas as gpd
+00008cb0: 0a20 2020 2020 2020 2066 726f 6d20 2020  .        from   
+00008cc0: 7368 6170 656c 792e 6765 6f6d 6574 7279  shapely.geometry
+00008cd0: 2069 6d70 6f72 7420 506f 6c79 676f 6e0a   import Polygon.
+00008ce0: 2020 2020 2020 2020 2369 6d70 6f72 7420          #import 
+00008cf0: 7368 6170 6566 696c 6520 2320 7079 7368  shapefile # pysh
+00008d00: 6564 206c 6962 7261 7279 0a20 2020 2020  ed library.     
+00008d10: 2020 2069 6d70 6f72 7420 7368 6170 656c     import shapel
+00008d20: 790a 2020 2020 2020 2020 230a 2020 2020  y.        #.    
+00008d30: 2020 2020 6d75 6c74 695f 736f 7572 6365      multi_source
+00008d40: 203d 2046 616c 7365 0a20 2020 2020 2020   = False.       
+00008d50: 206e 635f 6e61 6d65 7320 3d20 676c 6f62   nc_names = glob
+00008d60: 2e67 6c6f 6220 2873 656c 662e 736f 7572  .glob (self.sour
+00008d70: 6365 5f6e 6329 0a20 2020 2020 2020 206e  ce_nc).        n
+00008d80: 6369 6420 3d20 6e63 342e 4461 7461 7365  cid = nc4.Datase
+00008d90: 7428 6e63 5f6e 616d 6573 5b30 5d29 0a20  t(nc_names[0]). 
+00008da0: 2020 2020 2020 2023 2073 696e 6b2f 7461         # sink/ta
+00008db0: 7267 6574 2073 6861 7065 6669 6c65 2069  rget shapefile i
+00008dc0: 7320 7768 6174 2077 6520 7761 6e74 2074  s what we want t
+00008dd0: 6865 2076 6172 6961 626c 6573 2074 6f20  he variables to 
+00008de0: 6265 2072 656d 6170 7065 6420 746f 0a20  be remapped to. 
+00008df0: 2020 2020 2020 2073 6870 203d 2067 7064         shp = gpd
+00008e00: 2e72 6561 645f 6669 6c65 2873 656c 662e  .read_file(self.
+00008e10: 736f 7572 6365 5f73 6870 290a 2020 2020  source_shp).    
+00008e20: 2020 2020 6966 206e 6f74 2073 656c 662e      if not self.
+00008e30: 6368 6563 6b5f 7368 705f 6372 7328 7368  check_shp_crs(sh
+00008e40: 7029 3a0a 2020 2020 2020 2020 2020 2020  p):.            
+00008e50: 7379 732e 6578 6974 2827 706c 6561 7365  sys.exit('please
+00008e60: 2070 726f 6a65 6374 2079 6f75 7220 736f   project your so
+00008e70: 7572 6365 2073 6861 7065 6669 6c65 2061  urce shapefile a
+00008e80: 6e64 2076 6172 6961 626c 6573 2069 6e20  nd variables in 
+00008e90: 736f 7572 6365 206e 6320 6669 6c65 7320  source nc files 
+00008ea0: 746f 2057 4753 3834 2028 6570 7367 3a34  to WGS84 (epsg:4
+00008eb0: 3332 3629 2729 0a20 2020 2020 2020 2065  326)').        e
+00008ec0: 6c73 653a 2023 2063 6865 636b 2069 6620  lse: # check if 
+00008ed0: 7468 6520 7072 6f6a 6563 7469 6f6e 2069  the projection i
+00008ee0: 7320 5747 5338 3420 286f 7220 6570 7367  s WGS84 (or epsg
+00008ef0: 3a34 3332 3629 0a20 2020 2020 2020 2020  :4326).         
+00008f00: 2020 2070 7269 6e74 2827 4541 5359 4d4f     print('EASYMO
+00008f10: 5245 2064 6574 6563 7473 2074 6861 7420  RE detects that 
+00008f20: 736f 7572 6365 2073 6861 7065 6669 6c65  source shapefile
+00008f30: 2069 7320 696e 2057 4753 3834 2028 6570   is in WGS84 (ep
+00008f40: 7367 3a34 3332 3629 2729 0a20 2020 2020  sg:4326)').     
+00008f50: 2020 2023 2067 6574 2074 6865 206c 6174     # get the lat
+00008f60: 2f6c 6f6e 2066 726f 6d20 736f 7572 6365  /lon from source
+00008f70: 2073 6861 7066 696c 6520 616e 6420 6e63   shapfile and nc
+00008f80: 2066 696c 6573 0a20 2020 2020 2020 206c   files.        l
+00008f90: 6174 5f73 6870 203d 206e 702e 6172 7261  at_shp = np.arra
+00008fa0: 7928 7368 705b 7365 6c66 2e73 6f75 7263  y(shp[self.sourc
+00008fb0: 655f 7368 705f 6c61 745d 293b 206c 6174  e_shp_lat]); lat
+00008fc0: 5f73 6870 203d 206c 6174 5f73 6870 2e61  _shp = lat_shp.a
+00008fd0: 7374 7970 6528 666c 6f61 7429 0a20 2020  stype(float).   
+00008fe0: 2020 2020 206c 6f6e 5f73 6870 203d 206e       lon_shp = n
+00008ff0: 702e 6172 7261 7928 7368 705b 7365 6c66  p.array(shp[self
+00009000: 2e73 6f75 7263 655f 7368 705f 6c6f 6e5d  .source_shp_lon]
+00009010: 293b 206c 6f6e 5f73 6870 203d 206c 6f6e  ); lon_shp = lon
+00009020: 5f73 6870 2e61 7374 7970 6528 666c 6f61  _shp.astype(floa
+00009030: 7429 0a20 2020 2020 2020 2023 0a20 2020  t).        #.   
+00009040: 2020 2020 2063 6f6f 7264 5f73 6870 2020       coord_shp  
+00009050: 2020 2020 2020 203d 2070 642e 4461 7461         = pd.Data
+00009060: 4672 616d 6528 290a 2020 2020 2020 2020  Frame().        
+00009070: 636f 6f72 645f 7368 7020 5b27 6c6f 6e27  coord_shp ['lon'
+00009080: 5d20 3d20 6c6f 6e5f 7368 700a 2020 2020  ] = lon_shp.    
+00009090: 2020 2020 636f 6f72 645f 7368 7020 5b27      coord_shp ['
+000090a0: 6c61 7427 5d20 3d20 6c61 745f 7368 700a  lat'] = lat_shp.
+000090b0: 2020 2020 2020 2020 636f 6f72 645f 7368          coord_sh
+000090c0: 7020 2020 2020 2020 2020 3d20 636f 6f72  p         = coor
+000090d0: 645f 7368 702e 736f 7274 5f76 616c 7565  d_shp.sort_value
+000090e0: 7328 6279 3d27 6c6f 6e27 290a 2020 2020  s(by='lon').    
+000090f0: 2020 2020 636f 6f72 645f 7368 7020 2020      coord_shp   
+00009100: 2020 2020 2020 3d20 636f 6f72 645f 7368        = coord_sh
+00009110: 702e 736f 7274 5f76 616c 7565 7328 6279  p.sort_values(by
+00009120: 3d27 6c61 7427 290a 2020 2020 2020 2020  ='lat').        
+00009130: 2320 6368 6563 6b20 6966 2061 6c6c 2074  # check if all t
+00009140: 6865 206c 6174 2f6c 6f6e 2069 6e20 7368  he lat/lon in sh
+00009150: 6170 6566 696c 6520 6172 6520 756e 6971  apefile are uniq
+00009160: 7565 0a20 2020 2020 2020 2064 665f 7465  ue.        df_te
+00009170: 6d70 2020 2020 2020 2020 2020 203d 2063  mp           = c
+00009180: 6f6f 7264 5f73 6870 2e64 726f 705f 6475  oord_shp.drop_du
+00009190: 706c 6963 6174 6573 2829 0a20 2020 2020  plicates().     
+000091a0: 2020 2069 6620 6c65 6e28 6466 5f74 656d     if len(df_tem
+000091b0: 7029 2020 213d 206c 656e 2863 6f6f 7264  p)  != len(coord
+000091c0: 5f73 6870 293a 0a20 2020 2020 2020 2020  _shp):.         
+000091d0: 2020 2023 2070 7269 6e74 0a20 2020 2020     # print.     
+000091e0: 2020 2020 2020 2073 7973 2e65 7869 7428         sys.exit(
+000091f0: 2754 6865 206c 6174 6974 7564 6520 616e  'The latitude an
+00009200: 6420 6c6f 6e67 6974 7564 6520 696e 2073  d longitude in s
+00009210: 6f75 7263 6520 7368 6170 6566 696c 6520  ource shapefile 
+00009220: 6172 6520 6e6f 7420 756e 6971 7565 2729  are not unique')
+00009230: 0a20 2020 2020 2020 2023 2066 6972 7374  .        # first
+00009240: 2063 6865 636b 2074 6865 206d 6f64 656c   check the model
+00009250: 0a20 2020 2020 2020 2063 6f6f 7264 5f6e  .        coord_n
+00009260: 6320 2020 2020 2020 2020 203d 2070 642e  c          = pd.
+00009270: 4461 7461 4672 616d 6528 290a 2020 2020  DataFrame().    
+00009280: 2020 2020 636f 6f72 645f 6e63 2020 5b27      coord_nc  ['
+00009290: 6c6f 6e27 5d20 3d20 7365 6c66 2e6c 6f6e  lon'] = self.lon
+000092a0: 0a20 2020 2020 2020 2063 6f6f 7264 5f6e  .        coord_n
+000092b0: 6320 205b 276c 6174 275d 203d 2073 656c  c  ['lat'] = sel
+000092c0: 662e 6c61 740a 2020 2020 2020 2020 636f  f.lat.        co
+000092d0: 6f72 645f 6e63 2020 2020 2020 2020 2020  ord_nc          
+000092e0: 3d20 636f 6f72 645f 6e63 2e73 6f72 745f  = coord_nc.sort_
+000092f0: 7661 6c75 6573 2862 793d 276c 6f6e 2729  values(by='lon')
+00009300: 0a20 2020 2020 2020 2063 6f6f 7264 5f6e  .        coord_n
+00009310: 6320 2020 2020 2020 2020 203d 2063 6f6f  c          = coo
+00009320: 7264 5f6e 632e 736f 7274 5f76 616c 7565  rd_nc.sort_value
+00009330: 7328 6279 3d27 6c61 7427 290a 2020 2020  s(by='lat').    
+00009340: 2020 2020 2320 6368 6563 6b20 6966 2061      # check if a
+00009350: 6c6c 2074 6865 206c 6174 2f6c 6f6e 2069  ll the lat/lon i
+00009360: 6e20 7368 6170 6566 696c 6520 6172 6520  n shapefile are 
+00009370: 756e 6971 7565 0a20 2020 2020 2020 2064  unique.        d
+00009380: 665f 7465 6d70 2020 2020 2020 2020 2020  f_temp          
+00009390: 203d 2063 6f6f 7264 5f6e 632e 6472 6f70   = coord_nc.drop
+000093a0: 5f64 7570 6c69 6361 7465 7328 290a 2020  _duplicates().  
+000093b0: 2020 2020 2020 6966 206c 656e 2864 665f        if len(df_
+000093c0: 7465 6d70 2920 2021 3d20 6c65 6e28 636f  temp)  != len(co
+000093d0: 6f72 645f 6e63 293a 0a20 2020 2020 2020  ord_nc):.       
+000093e0: 2020 2020 2023 2070 7269 6e74 0a20 2020       # print.   
+000093f0: 2020 2020 2020 2020 2023 7379 732e 6578           #sys.ex
+00009400: 6974 2827 5468 6520 6c61 7469 7475 6465  it('The latitude
+00009410: 2061 6e64 206c 6f6e 6769 7475 6465 2069   and longitude i
+00009420: 6e20 736f 7572 6365 204e 6574 4344 4620  n source NetCDF 
+00009430: 6669 6c65 7320 6172 6520 6e6f 7420 756e  files are not un
+00009440: 6971 7565 2729 0a20 2020 2020 2020 2020  ique').         
+00009450: 2020 2070 7269 6e74 2827 5468 6520 6c61     print('The la
+00009460: 7469 7475 6465 2061 6e64 206c 6f6e 6769  titude and longi
+00009470: 7475 6465 2069 6e20 736f 7572 6365 204e  tude in source N
+00009480: 6574 4344 4620 6669 6c65 7320 6172 6520  etCDF files are 
+00009490: 6e6f 7420 756e 6971 7565 2729 0a0a 0a20  not unique')... 
+000094a0: 2020 2064 6566 2063 6865 636b 5f73 6870     def check_shp
+000094b0: 5f63 7273 2028 7365 6c66 2c20 7368 702c  _crs (self, shp,
+000094c0: 2063 6865 636b 5f6c 6973 7420 3d20 5b27   check_list = ['
+000094d0: 6570 7367 3a34 3332 3627 2c20 2765 7073  epsg:4326', 'eps
+000094e0: 6720 3433 3236 272c 2027 6570 7367 3a20  g 4326', 'epsg: 
+000094f0: 3433 3236 272c 205c 0a20 2020 2020 2020  4326', \.       
+00009500: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00009510: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00009520: 2020 2020 2020 2020 2027 7767 7338 3427           'wgs84'
+00009530: 2c20 2777 6773 3a38 3427 2c20 2777 6773  , 'wgs:84', 'wgs
+00009540: 2038 3427 2c20 2777 6773 5f38 3427 5c0a   84', 'wgs_84'\.
+00009550: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00009560: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00009570: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00009580: 2777 6773 3139 3834 272c 2027 7767 733a  'wgs1984', 'wgs:
+00009590: 3139 3834 272c 2027 7767 7320 3139 3834  1984', 'wgs 1984
+000095a0: 272c 2027 7767 735f 3139 3834 275d 293a  ', 'wgs_1984']):
+000095b0: 0a0a 2020 2020 2020 2020 2222 220a 2020  ..        """.  
+000095c0: 2020 2020 2020 4020 6175 7468 6f72 3a20        @ author: 
+000095d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000095e0: 2053 6865 7276 616e 2047 6861 7261 7269   Shervan Gharari
+000095f0: 0a20 2020 2020 2020 2040 2047 6974 6875  .        @ Githu
+00009600: 623a 2020 2020 2020 2020 2020 2020 2020  b:              
+00009610: 2020 2020 6874 7470 733a 2f2f 6769 7468      https://gith
+00009620: 7562 2e63 6f6d 2f53 6865 7276 616e 4768  ub.com/ShervanGh
+00009630: 6172 6172 692f 4541 5359 4d4f 5245 0a20  arari/EASYMORE. 
+00009640: 2020 2020 2020 2040 2061 7574 686f 7227         @ author'
+00009650: 7320 656d 6169 6c20 6964 3a20 2020 2020  s email id:     
+00009660: 2020 7368 2e67 6861 7261 7269 4067 6d61    sh.gharari@gma
+00009670: 696c 2e63 6f6d 0a20 2020 2020 2020 2040  il.com.        @
+00009680: 206c 6963 656e 7365 3a20 2020 2020 2020   license:       
+00009690: 2020 2020 2020 2020 2020 474e 552d 4750            GNU-GP
+000096a0: 4c76 330a 2020 2020 2020 2020 5468 6973  Lv3.        This
+000096b0: 2066 756e 6374 696f 6e20 6368 6563 6b73   function checks
+000096c0: 2074 6865 2073 6861 7065 6669 6c65 2063   the shapefile c
+000096d0: 7273 2074 6f20 7072 6f76 6964 6564 2073  rs to provided s
+000096e0: 7562 7374 7269 6e67 730a 2020 2020 2020  ubstrings.      
+000096f0: 2020 4172 6775 6d65 6e74 730a 2020 2020    Arguments.    
+00009700: 2020 2020 2d2d 2d2d 2d2d 2d2d 2d0a 2020      ---------.  
+00009710: 2020 2020 2020 7368 703a 2067 656f 7061        shp: geopa
+00009720: 6e64 6173 2064 6174 6166 7261 6d65 0a20  ndas dataframe. 
+00009730: 2020 2020 2020 2063 6865 636b 5f6c 6973         check_lis
+00009740: 743a 206c 6973 7420 6f66 2073 7562 7374  t: list of subst
+00009750: 7269 6e67 2074 6f20 6368 6563 6b20 6167  ring to check ag
+00009760: 6169 6e73 740a 2020 2020 2020 2020 2222  ainst.        ""
+00009770: 220a 0a20 2020 2020 2020 2063 6f6e 666f  "..        confo
+00009780: 726d 696e 6720 3d20 4661 6c73 650a 0a20  rming = False.. 
+00009790: 2020 2020 2020 2023 2063 6865 636b 2069         # check i
+000097a0: 6620 6e61 6d65 2069 7320 6176 6169 6c61  f name is availa
+000097b0: 626c 6520 696e 2074 6865 2063 6865 636b  ble in the check
+000097c0: 5f6c 6973 740a 2020 2020 2020 2020 6966  _list.        if
+000097d0: 2073 7472 2873 6870 2e63 7273 2e6e 616d   str(shp.crs.nam
+000097e0: 6529 2e6c 6f77 6572 2829 2069 6e20 6368  e).lower() in ch
+000097f0: 6563 6b5f 6c69 7374 3a0a 2020 2020 2020  eck_list:.      
+00009800: 2020 2020 2020 636f 6e66 6f72 6d69 6e67        conforming
+00009810: 203d 2054 7275 650a 2020 2020 2020 2020   = True.        
+00009820: 2365 6c73 653a 0a20 2020 2020 2020 2023  #else:.        #
+00009830: 2020 2020 6570 7367 5f63 6f64 6520 3d20      epsg_code = 
+00009840: 7368 702e 6372 732e 746f 5f65 7073 6728  shp.crs.to_epsg(
+00009850: 290a 2020 2020 2020 2020 2320 2020 2070  ).        #    p
+00009860: 7269 6e74 2866 2745 5053 473a 7b65 7073  rint(f'EPSG:{eps
+00009870: 675f 636f 6465 7d27 290a 0a20 2020 2020  g_code}')..     
+00009880: 2020 2023 2063 6865 636b 2069 6620 7468     # check if th
+00009890: 6520 7368 702e 6372 7320 696e 636c 7564  e shp.crs includ
+000098a0: 6520 7468 6520 656c 656d 656e 740a 2020  e the element.  
+000098b0: 2020 2020 2020 666f 7220 656c 656d 656e        for elemen
+000098c0: 7420 696e 2063 6865 636b 5f6c 6973 743a  t in check_list:
+000098d0: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
+000098e0: 656c 656d 656e 7420 696e 2073 7472 2873  element in str(s
+000098f0: 6870 2e63 7273 292e 6c6f 7765 7228 293a  hp.crs).lower():
+00009900: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00009910: 2063 6f6e 666f 726d 696e 6720 3d20 5472   conforming = Tr
+00009920: 7565 0a20 2020 2020 2020 2072 6574 7572  ue.        retur
+00009930: 6e20 636f 6e66 6f72 6d69 6e67 0a0a 0a20  n conforming... 
+00009940: 2020 2064 6566 204e 6574 4344 465f 5348     def NetCDF_SH
+00009950: 505f 6c61 745f 6c6f 6e28 7365 6c66 293a  P_lat_lon(self):
+00009960: 0a20 2020 2020 2020 2022 2222 0a20 2020  .        """.   
+00009970: 2020 2020 2040 2061 7574 686f 723a 2020       @ author:  
+00009980: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00009990: 5368 6572 7661 6e20 4768 6172 6172 690a  Shervan Gharari.
+000099a0: 2020 2020 2020 2020 4020 4769 7468 7562          @ Github
+000099b0: 3a20 2020 2020 2020 2020 2020 2020 2020  :               
+000099c0: 2020 2068 7474 7073 3a2f 2f67 6974 6875     https://githu
+000099d0: 622e 636f 6d2f 5368 6572 7661 6e47 6861  b.com/ShervanGha
+000099e0: 7261 7269 2f45 4153 594d 4f52 450a 2020  rari/EASYMORE.  
+000099f0: 2020 2020 2020 4020 6175 7468 6f72 2773        @ author's
+00009a00: 2065 6d61 696c 2069 643a 2020 2020 2020   email id:      
+00009a10: 2073 682e 6768 6172 6172 6940 676d 6169   sh.gharari@gmai
+00009a20: 6c2e 636f 6d0a 2020 2020 2020 2020 4020  l.com.        @ 
+00009a30: 6c69 6365 6e73 653a 2020 2020 2020 2020  license:        
+00009a40: 2020 2020 2020 2020 2047 4e55 2d47 504c           GNU-GPL
+00009a50: 7633 0a20 2020 2020 2020 2054 6869 7320  v3.        This 
+00009a60: 6675 6e63 7469 6f6e 2063 6865 636b 7320  function checks 
+00009a70: 6469 6d65 6e73 696f 6e20 6f66 2074 6865  dimension of the
+00009a80: 2073 6f75 7263 6520 7368 6170 6566 696c   source shapefil
+00009a90: 6520 616e 6420 6368 6563 6b73 2074 6865  e and checks the
+00009aa0: 2063 6173 6520 6f66 2072 6567 756c 6172   case of regular
+00009ab0: 2c20 726f 7461 7465 642c 2061 6e64 2069  , rotated, and i
+00009ac0: 7272 6567 756c 6172 0a20 2020 2020 2020  rregular.       
+00009ad0: 2061 6c73 6f20 6372 6561 7465 6420 7468   also created th
+00009ae0: 6520 3244 2061 7272 6179 206f 6620 6c61  e 2D array of la
+00009af0: 7420 616e 6420 6c6f 6e20 666f 7220 6372  t and lon for cr
+00009b00: 6561 7469 6e67 2074 6865 2073 6861 7065  eating the shape
+00009b10: 6669 6c65 0a20 2020 2020 2020 2022 2222  file.        """
+00009b20: 0a20 2020 2020 2020 2069 6d70 6f72 7420  .        import 
+00009b30: 6765 6f70 616e 6461 7320 6173 2067 7064  geopandas as gpd
+00009b40: 0a20 2020 2020 2020 2066 726f 6d20 2020  .        from   
+00009b50: 7368 6170 656c 792e 6765 6f6d 6574 7279  shapely.geometry
+00009b60: 2069 6d70 6f72 7420 506f 6c79 676f 6e0a   import Polygon.
+00009b70: 2020 2020 2020 2020 2369 6d70 6f72 7420          #import 
+00009b80: 7368 6170 6566 696c 6520 2320 7079 7368  shapefile # pysh
+00009b90: 6564 206c 6962 7261 7279 0a20 2020 2020  ed library.     
+00009ba0: 2020 2069 6d70 6f72 7420 7368 6170 656c     import shapel
+00009bb0: 790a 2020 2020 2020 2020 230a 2020 2020  y.        #.    
+00009bc0: 2020 2020 6e63 5f6e 616d 6573 203d 2067      nc_names = g
+00009bd0: 6c6f 622e 676c 6f62 2028 7365 6c66 2e73  lob.glob (self.s
+00009be0: 6f75 7263 655f 6e63 290a 2020 2020 2020  ource_nc).      
+00009bf0: 2020 7661 725f 6e61 6d65 203d 2073 656c    var_name = sel
+00009c00: 662e 7661 725f 6e61 6d65 735b 305d 0a20  f.var_names[0]. 
+00009c10: 2020 2020 2020 2023 206f 7065 6e20 7468         # open th
+00009c20: 6520 6e63 2066 696c 6520 746f 2072 6561  e nc file to rea
+00009c30: 640a 2020 2020 2020 2020 6e63 6964 203d  d.        ncid =
+00009c40: 206e 6334 2e44 6174 6173 6574 286e 635f   nc4.Dataset(nc_
+00009c50: 6e61 6d65 735b 305d 290a 2020 2020 2020  names[0]).      
+00009c60: 2020 2320 6465 6369 6469 6e67 2077 6869    # deciding whi
+00009c70: 6368 2063 6173 650a 2020 2020 2020 2020  ch case.        
+00009c80: 2320 6361 7365 2023 3120 7265 6775 6c61  # case #1 regula
+00009c90: 7220 6c61 7469 7475 6465 2f6c 6f6e 6769  r latitude/longi
+00009ca0: 7475 6465 0a20 2020 2020 2020 2069 6620  tude.        if 
+00009cb0: 286c 656e 286e 6369 642e 7661 7269 6162  (len(ncid.variab
+00009cc0: 6c65 735b 7365 6c66 2e76 6172 5f6c 6f6e  les[self.var_lon
+00009cd0: 5d2e 6469 6d65 6e73 696f 6e73 293d 3d31  ].dimensions)==1
+00009ce0: 2920 616e 645c 0a20 2020 2020 2020 2028  ) and\.        (
+00009cf0: 6c65 6e28 6e63 6964 2e76 6172 6961 626c  len(ncid.variabl
+00009d00: 6573 5b73 656c 662e 7661 725f 6c6f 6e5d  es[self.var_lon]
+00009d10: 2e64 696d 656e 7369 6f6e 7329 3d3d 3129  .dimensions)==1)
+00009d20: 2061 6e64 5c0a 2020 2020 2020 2020 286c   and\.        (l
+00009d30: 656e 286e 6369 642e 7661 7269 6162 6c65  en(ncid.variable
+00009d40: 735b 7365 6c66 2e76 6172 5f6e 616d 6573  s[self.var_names
+00009d50: 5b30 5d5d 2e64 696d 656e 7369 6f6e 7329  [0]].dimensions)
+00009d60: 3d3d 3329 3a0a 2020 2020 2020 2020 2020  ==3):.          
+00009d70: 2020 7072 696e 7428 2745 4153 594d 4f52    print('EASYMOR
+00009d80: 4520 6465 7465 6374 7320 6361 7365 2031  E detects case 1
+00009d90: 202d 2072 6567 756c 6172 206c 6174 2f6c   - regular lat/l
+00009da0: 6f6e 2729 0a20 2020 2020 2020 2020 2020  on').           
+00009db0: 2073 656c 662e 6361 7365 203d 2031 0a20   self.case = 1. 
+00009dc0: 2020 2020 2020 2020 2020 2023 2067 6574             # get
+00009dd0: 2074 6865 206c 6973 7420 6f66 2064 696d   the list of dim
+00009de0: 656e 7369 6f6e 7320 666f 7220 7468 6520  ensions for the 
+00009df0: 6e63 6964 2073 616d 706c 6520 7661 7269  ncid sample vari
+00009e00: 6162 6c65 0a20 2020 2020 2020 2020 2020  able.           
+00009e10: 206c 6973 745f 6469 6d5f 6e61 6d65 203d   list_dim_name =
+00009e20: 206c 6973 7428 6e63 6964 2e76 6172 6961   list(ncid.varia
+00009e30: 626c 6573 5b73 656c 662e 7661 725f 6e61  bles[self.var_na
+00009e40: 6d65 735b 305d 5d2e 6469 6d65 6e73 696f  mes[0]].dimensio
+00009e50: 6e73 290a 2020 2020 2020 2020 2020 2020  ns).            
+00009e60: 2320 6765 7420 7468 6520 6c6f 6361 7469  # get the locati
+00009e70: 6f6e 206f 6620 6c61 7420 6469 6d65 6e73  on of lat dimens
+00009e80: 696f 6e73 0a20 2020 2020 2020 2020 2020  ions.           
+00009e90: 206c 6f63 6174 696f 6e5f 6f66 5f6c 6174   location_of_lat
+00009ea0: 203d 206c 6973 745f 6469 6d5f 6e61 6d65   = list_dim_name
+00009eb0: 2e69 6e64 6578 286c 6973 7428 6e63 6964  .index(list(ncid
+00009ec0: 2e76 6172 6961 626c 6573 5b73 656c 662e  .variables[self.
+00009ed0: 7661 725f 6c61 745d 2e64 696d 656e 7369  var_lat].dimensi
+00009ee0: 6f6e 7329 5b30 5d29 0a20 2020 2020 2020  ons)[0]).       
+00009ef0: 2020 2020 206c 6f63 6169 746f 6e5f 6f66       locaiton_of
+00009f00: 5f6c 6f6e 203d 206c 6973 745f 6469 6d5f  _lon = list_dim_
+00009f10: 6e61 6d65 2e69 6e64 6578 286c 6973 7428  name.index(list(
+00009f20: 6e63 6964 2e76 6172 6961 626c 6573 5b73  ncid.variables[s
+00009f30: 656c 662e 7661 725f 6c6f 6e5d 2e64 696d  elf.var_lon].dim
+00009f40: 656e 7369 6f6e 7329 5b30 5d29 0a20 2020  ensions)[0]).   
+00009f50: 2020 2020 2020 2020 2023 2064 6574 2074           # det t
+00009f60: 6865 2064 696d 656e 7369 6f6e 7320 6f66  he dimensions of
+00009f70: 206c 6174 2061 6e64 206c 6f6e 0a20 2020   lat and lon.   
+00009f80: 2020 2020 2020 2020 206c 656e 5f6f 665f           len_of_
+00009f90: 6c61 7420 3d20 6c65 6e28 6e63 6964 2e76  lat = len(ncid.v
+00009fa0: 6172 6961 626c 6573 5b73 656c 662e 7661  ariables[self.va
+00009fb0: 725f 6c61 745d 5b3a 5d29 0a20 2020 2020  r_lat][:]).     
+00009fc0: 2020 2020 2020 206c 656e 5f6f 665f 6c6f         len_of_lo
+00009fd0: 6e20 3d20 6c65 6e28 6e63 6964 2e76 6172  n = len(ncid.var
+00009fe0: 6961 626c 6573 5b73 656c 662e 7661 725f  iables[self.var_
+00009ff0: 6c6f 6e5d 5b3a 5d29 0a20 2020 2020 2020  lon][:]).       
+0000a000: 2020 2020 2069 6620 6c6f 6361 6974 6f6e       if locaiton
+0000a010: 5f6f 665f 6c6f 6e20 3e20 6c6f 6361 7469  _of_lon > locati
+0000a020: 6f6e 5f6f 665f 6c61 743a 0a20 2020 2020  on_of_lat:.     
+0000a030: 2020 2020 2020 2020 2020 206c 6174 203d             lat =
+0000a040: 206e 702e 7a65 726f 7328 5b6c 656e 5f6f   np.zeros([len_o
+0000a050: 665f 6c61 742c 206c 656e 5f6f 665f 6c6f  f_lat, len_of_lo
+0000a060: 6e5d 290a 2020 2020 2020 2020 2020 2020  n]).            
+0000a070: 2020 2020 6c6f 6e20 3d20 6e70 2e7a 6572      lon = np.zer
+0000a080: 6f73 285b 6c65 6e5f 6f66 5f6c 6174 2c20  os([len_of_lat, 
+0000a090: 6c65 6e5f 6f66 5f6c 6f6e 5d29 0a20 2020  len_of_lon]).   
+0000a0a0: 2020 2020 2020 2020 2020 2020 2066 6f72               for
+0000a0b0: 2069 2069 6e20 6e70 2e61 7261 6e67 6528   i in np.arange(
+0000a0c0: 6c65 6e28 6e63 6964 2e76 6172 6961 626c  len(ncid.variabl
+0000a0d0: 6573 5b73 656c 662e 7661 725f 6c6f 6e5d  es[self.var_lon]
+0000a0e0: 5b3a 5d29 293a 0a20 2020 2020 2020 2020  [:])):.         
+0000a0f0: 2020 2020 2020 2020 2020 206c 6174 205b             lat [
+0000a100: 3a2c 695d 203d 206e 6369 642e 7661 7269  :,i] = ncid.vari
+0000a110: 6162 6c65 735b 7365 6c66 2e76 6172 5f6c  ables[self.var_l
+0000a120: 6174 5d5b 3a5d 0a20 2020 2020 2020 2020  at][:].         
+0000a130: 2020 2020 2020 2066 6f72 2069 2069 6e20         for i in 
+0000a140: 6e70 2e61 7261 6e67 6528 6c65 6e28 6e63  np.arange(len(nc
+0000a150: 6964 2e76 6172 6961 626c 6573 5b73 656c  id.variables[sel
+0000a160: 662e 7661 725f 6c61 745d 5b3a 5d29 293a  f.var_lat][:])):
+0000a170: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0000a180: 2020 2020 206c 6f6e 205b 692c 3a5d 203d       lon [i,:] =
+0000a190: 206e 6369 642e 7661 7269 6162 6c65 735b   ncid.variables[
+0000a1a0: 7365 6c66 2e76 6172 5f6c 6f6e 5d5b 3a5d  self.var_lon][:]
+0000a1b0: 0a20 2020 2020 2020 2020 2020 2065 6c73  .            els
+0000a1c0: 653a 0a20 2020 2020 2020 2020 2020 2020  e:.             
+0000a1d0: 2020 206c 6174 203d 206e 702e 7a65 726f     lat = np.zero
+0000a1e0: 7328 5b6c 656e 5f6f 665f 6c6f 6e2c 206c  s([len_of_lon, l
+0000a1f0: 656e 5f6f 665f 6c61 745d 290a 2020 2020  en_of_lat]).    
+0000a200: 2020 2020 2020 2020 2020 2020 6c6f 6e20              lon 
+0000a210: 3d20 6e70 2e7a 6572 6f73 285b 6c65 6e5f  = np.zeros([len_
+0000a220: 6f66 5f6c 6f6e 2c20 6c65 6e5f 6f66 5f6c  of_lon, len_of_l
+0000a230: 6174 5d29 0a20 2020 2020 2020 2020 2020  at]).           
+0000a240: 2020 2020 2066 6f72 2069 2069 6e20 6e70       for i in np
+0000a250: 2e61 7261 6e67 6528 6c65 6e28 6e63 6964  .arange(len(ncid
+0000a260: 2e76 6172 6961 626c 6573 5b73 656c 662e  .variables[self.
+0000a270: 7661 725f 6c6f 6e5d 5b3a 5d29 293a 0a20  var_lon][:])):. 
+0000a280: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000a290: 2020 206c 6174 205b 692c 3a5d 203d 206e     lat [i,:] = n
+0000a2a0: 6369 642e 7661 7269 6162 6c65 735b 7365  cid.variables[se
+0000a2b0: 6c66 2e76 6172 5f6c 6174 5d5b 3a5d 0a20  lf.var_lat][:]. 
+0000a2c0: 2020 2020 2020 2020 2020 2020 2020 2066                 f
+0000a2d0: 6f72 2069 2069 6e20 6e70 2e61 7261 6e67  or i in np.arang
+0000a2e0: 6528 6c65 6e28 6e63 6964 2e76 6172 6961  e(len(ncid.varia
+0000a2f0: 626c 6573 5b73 656c 662e 7661 725f 6c61  bles[self.var_la
+0000a300: 745d 5b3a 5d29 293a 0a20 2020 2020 2020  t][:])):.       
+0000a310: 2020 2020 2020 2020 2020 2020 206c 6f6e               lon
+0000a320: 205b 3a2c 695d 203d 206e 6369 642e 7661   [:,i] = ncid.va
+0000a330: 7269 6162 6c65 735b 7365 6c66 2e76 6172  riables[self.var
+0000a340: 5f6c 6f6e 5d5b 3a5d 0a20 2020 2020 2020  _lon][:].       
+0000a350: 2020 2020 2023 2063 6865 636b 2069 6620       # check if 
+0000a360: 6c61 7420 616e 6420 6c6f 6e20 6172 6520  lat and lon are 
+0000a370: 7370 6163 6564 2065 7175 616c 6c79 0a20  spaced equally. 
+0000a380: 2020 2020 2020 2020 2020 206c 6174 5f74             lat_t
+0000a390: 656d 7020 3d20 6e70 2e61 7272 6179 286e  emp = np.array(n
+0000a3a0: 6369 642e 7661 7269 6162 6c65 735b 7365  cid.variables[se
+0000a3b0: 6c66 2e76 6172 5f6c 6174 5d5b 3a5d 290a  lf.var_lat][:]).
+0000a3c0: 2020 2020 2020 2020 2020 2020 6c61 745f              lat_
+0000a3d0: 7465 6d70 5f64 6966 6620 3d20 6e70 2e64  temp_diff = np.d
+0000a3e0: 6966 6628 6c61 745f 7465 6d70 290a 2020  iff(lat_temp).  
+0000a3f0: 2020 2020 2020 2020 2020 6c61 745f 7465            lat_te
+0000a400: 6d70 5f64 6966 665f 3220 3d20 6e70 2e64  mp_diff_2 = np.d
+0000a410: 6966 6628 6c61 745f 7465 6d70 5f64 6966  iff(lat_temp_dif
+0000a420: 6629 0a20 2020 2020 2020 2020 2020 206d  f).            m
+0000a430: 6178 5f6c 6174 5f74 656d 705f 6469 6666  ax_lat_temp_diff
+0000a440: 5f32 203d 206d 6178 2861 6273 286c 6174  _2 = max(abs(lat
+0000a450: 5f74 656d 705f 6469 6666 5f32 2929 0a20  _temp_diff_2)). 
+0000a460: 2020 2020 2020 2020 2020 2070 7269 6e74             print
+0000a470: 2827 6d61 7820 6469 6666 6572 656e 6365  ('max difference
+0000a480: 206f 6620 6c61 7420 7661 6c75 6573 2069   of lat values i
+0000a490: 6e20 736f 7572 6365 206e 6320 6669 6c65  n source nc file
+0000a4a0: 7320 6172 6520 3a20 272c 206d 6178 5f6c  s are : ', max_l
+0000a4b0: 6174 5f74 656d 705f 6469 6666 5f32 290a  at_temp_diff_2).
+0000a4c0: 2020 2020 2020 2020 2020 2020 6c6f 6e5f              lon_
+0000a4d0: 7465 6d70 203d 206e 702e 6172 7261 7928  temp = np.array(
+0000a4e0: 6e63 6964 2e76 6172 6961 626c 6573 5b73  ncid.variables[s
+0000a4f0: 656c 662e 7661 725f 6c6f 6e5d 5b3a 5d29  elf.var_lon][:])
+0000a500: 0a20 2020 2020 2020 2020 2020 206c 6f6e  .            lon
+0000a510: 5f74 656d 705f 6469 6666 203d 206e 702e  _temp_diff = np.
+0000a520: 6469 6666 286c 6f6e 5f74 656d 7029 0a20  diff(lon_temp). 
+0000a530: 2020 2020 2020 2020 2020 206c 6f6e 5f74             lon_t
+0000a540: 656d 705f 6469 6666 5f32 203d 206e 702e  emp_diff_2 = np.
+0000a550: 6469 6666 286c 6f6e 5f74 656d 705f 6469  diff(lon_temp_di
+0000a560: 6666 290a 2020 2020 2020 2020 2020 2020  ff).            
+0000a570: 6d61 785f 6c6f 6e5f 7465 6d70 5f64 6966  max_lon_temp_dif
+0000a580: 665f 3220 3d20 6d61 7828 6162 7328 6c6f  f_2 = max(abs(lo
+0000a590: 6e5f 7465 6d70 5f64 6966 665f 3229 290a  n_temp_diff_2)).
+0000a5a0: 2020 2020 2020 2020 2020 2020 7072 696e              prin
+0000a5b0: 7428 276d 6178 2064 6966 6665 7265 6e63  t('max differenc
+0000a5c0: 6520 6f66 206c 6f6e 2076 616c 7565 7320  e of lon values 
+0000a5d0: 696e 2073 6f75 7263 6520 6e63 2066 696c  in source nc fil
+0000a5e0: 6573 2061 7265 203a 2027 2c20 6d61 785f  es are : ', max_
+0000a5f0: 6c6f 6e5f 7465 6d70 5f64 6966 665f 3229  lon_temp_diff_2)
+0000a600: 0a20 2020 2020 2020 2020 2020 2023 2073  .            # s
+0000a610: 6176 6520 6c61 742c 206c 6f6e 2069 6e74  ave lat, lon int
+0000a620: 6f20 7468 6520 6f62 6a65 6374 0a20 2020  o the object.   
+0000a630: 2020 2020 2020 2020 206c 6174 2020 2020           lat    
+0000a640: 2020 3d20 6e70 2e61 7272 6179 286c 6174    = np.array(lat
+0000a650: 292e 6173 7479 7065 2866 6c6f 6174 290a  ).astype(float).
+0000a660: 2020 2020 2020 2020 2020 2020 6c6f 6e20              lon 
+0000a670: 2020 2020 203d 206e 702e 6172 7261 7928       = np.array(
+0000a680: 6c6f 6e29 2e61 7374 7970 6528 666c 6f61  lon).astype(floa
+0000a690: 7429 0a20 2020 2020 2020 2020 2020 2073  t).            s
+0000a6a0: 656c 662e 6c61 7420 3d20 6c61 740a 2020  elf.lat = lat.  
+0000a6b0: 2020 2020 2020 2020 2020 7365 6c66 2e6c            self.l
+0000a6c0: 6f6e 203d 206c 6f6e 0a20 2020 2020 2020  on = lon.       
+0000a6d0: 2020 2020 2023 2065 7870 616e 6469 6e67       # expanding
+0000a6e0: 206a 7573 7420 666f 7220 7468 6520 7468   just for the th
+0000a6f0: 6520 6372 6561 7469 6f6e 206f 6620 7368  e creation of sh
+0000a700: 6170 6566 696c 6520 7769 7468 2066 6972  apefile with fir
+0000a710: 7374 206c 6173 7420 726f 7773 2061 6e64  st last rows and
+0000a720: 2063 6f6c 756d 6e73 0a20 2020 2020 2020   columns.       
+0000a730: 2020 2020 2069 6620 286d 6178 5f6c 6174       if (max_lat
+0000a740: 5f74 656d 705f 6469 6666 5f32 3c73 656c  _temp_diff_2<sel
+0000a750: 662e 746f 6c65 7261 6e63 6529 2061 6e64  f.tolerance) and
+0000a760: 2028 6d61 785f 6c6f 6e5f 7465 6d70 5f64   (max_lon_temp_d
+0000a770: 6966 665f 323c 7365 6c66 2e74 6f6c 6572  iff_2<self.toler
+0000a780: 616e 6365 293a 2023 2074 6865 6e20 6c61  ance): # then la
+0000a790: 7420 6c6f 6e20 6172 6520 7370 6163 6564  t lon are spaced
+0000a7a0: 2065 7175 616c 0a20 2020 2020 2020 2020   equal.         
+0000a7b0: 2020 2020 2020 2023 2063 7265 6174 6520         # create 
+0000a7c0: 6578 7061 6e64 6564 206c 6174 0a20 2020  expanded lat.   
+0000a7d0: 2020 2020 2020 2020 2020 2020 206c 6174               lat
+0000a7e0: 5f65 7870 616e 6465 6420 3d20 6e70 2e7a  _expanded = np.z
+0000a7f0: 6572 6f73 286e 702e 6172 7261 7928 6c61  eros(np.array(la
+0000a800: 742e 7368 6170 6529 2b32 290a 2020 2020  t.shape)+2).    
+0000a810: 2020 2020 2020 2020 2020 2020 6c61 745f              lat_
+0000a820: 6578 7061 6e64 6564 205b 313a 2d31 2c31  expanded [1:-1,1
+0000a830: 3a2d 315d 203d 206c 6174 0a20 2020 2020  :-1] = lat.     
+0000a840: 2020 2020 2020 2020 2020 206c 6174 5f65             lat_e
+0000a850: 7870 616e 6465 6420 5b3a 2c20 305d 2020  xpanded [:, 0]  
+0000a860: 3d20 6c61 745f 6578 7061 6e64 6564 205b  = lat_expanded [
+0000a870: 3a2c 2031 5d20 2b20 286c 6174 5f65 7870  :, 1] + (lat_exp
+0000a880: 616e 6465 6420 5b3a 2c20 315d 202d 206c  anded [:, 1] - l
+0000a890: 6174 5f65 7870 616e 6465 6420 5b3a 2c20  at_expanded [:, 
+0000a8a0: 325d 2920 2320 706f 7075 6c61 7465 206c  2]) # populate l
+0000a8b0: 6566 7420 636f 6c75 6d6e 0a20 2020 2020  eft column.     
+0000a8c0: 2020 2020 2020 2020 2020 206c 6174 5f65             lat_e
+0000a8d0: 7870 616e 6465 6420 5b3a 2c2d 315d 2020  xpanded [:,-1]  
+0000a8e0: 3d20 6c61 745f 6578 7061 6e64 6564 205b  = lat_expanded [
+0000a8f0: 3a2c 2d32 5d20 2b20 286c 6174 5f65 7870  :,-2] + (lat_exp
+0000a900: 616e 6465 6420 5b3a 2c2d 325d 202d 206c  anded [:,-2] - l
+0000a910: 6174 5f65 7870 616e 6465 6420 5b3a 2c2d  at_expanded [:,-
+0000a920: 335d 2920 2320 706f 7075 6c61 7465 2072  3]) # populate r
+0000a930: 6967 6874 2063 6f6c 756d 6e0a 2020 2020  ight column.    
+0000a940: 2020 2020 2020 2020 2020 2020 6c61 745f              lat_
+0000a950: 6578 7061 6e64 6564 205b 302c 203a 5d20  expanded [0, :] 
+0000a960: 203d 206c 6174 5f65 7870 616e 6465 6420   = lat_expanded 
+0000a970: 5b31 2c20 3a5d 202b 2028 6c61 745f 6578  [1, :] + (lat_ex
+0000a980: 7061 6e64 6564 205b 312c 203a 5d20 2d20  panded [1, :] - 
+0000a990: 6c61 745f 6578 7061 6e64 6564 205b 322c  lat_expanded [2,
+0000a9a0: 203a 5d29 2023 2070 6f70 756c 6174 6520   :]) # populate 
+0000a9b0: 746f 7020 726f 770a 2020 2020 2020 2020  top row.        
+0000a9c0: 2020 2020 2020 2020 6c61 745f 6578 7061          lat_expa
+0000a9d0: 6e64 6564 205b 2d31 2c3a 5d20 203d 206c  nded [-1,:]  = l
+0000a9e0: 6174 5f65 7870 616e 6465 6420 5b2d 322c  at_expanded [-2,
+0000a9f0: 3a5d 202b 2028 6c61 745f 6578 7061 6e64  :] + (lat_expand
+0000aa00: 6564 205b 2d32 2c3a 5d20 2d20 6c61 745f  ed [-2,:] - lat_
+0000aa10: 6578 7061 6e64 6564 205b 2d33 2c3a 5d29  expanded [-3,:])
+0000aa20: 2023 2070 6f70 756c 6174 6520 626f 7474   # populate bott
+0000aa30: 6f6d 2072 6f77 0a20 2020 2020 2020 2020  om row.         
+0000aa40: 2020 2020 2020 2023 2063 7265 6174 6520         # create 
+0000aa50: 6578 7061 6e64 6564 206c 6174 0a20 2020  expanded lat.   
+0000aa60: 2020 2020 2020 2020 2020 2020 206c 6f6e               lon
+0000aa70: 5f65 7870 616e 6465 6420 3d20 6e70 2e7a  _expanded = np.z
+0000aa80: 6572 6f73 286e 702e 6172 7261 7928 6c6f  eros(np.array(lo
+0000aa90: 6e2e 7368 6170 6529 2b32 290a 2020 2020  n.shape)+2).    
+0000aaa0: 2020 2020 2020 2020 2020 2020 6c6f 6e5f              lon_
+0000aab0: 6578 7061 6e64 6564 205b 313a 2d31 2c31  expanded [1:-1,1
+0000aac0: 3a2d 315d 203d 206c 6f6e 0a20 2020 2020  :-1] = lon.     
+0000aad0: 2020 2020 2020 2020 2020 206c 6f6e 5f65             lon_e
+0000aae0: 7870 616e 6465 6420 5b3a 2c20 305d 2020  xpanded [:, 0]  
+0000aaf0: 3d20 6c6f 6e5f 6578 7061 6e64 6564 205b  = lon_expanded [
+0000ab00: 3a2c 2031 5d20 2b20 286c 6f6e 5f65 7870  :, 1] + (lon_exp
+0000ab10: 616e 6465 6420 5b3a 2c20 315d 202d 206c  anded [:, 1] - l
+0000ab20: 6f6e 5f65 7870 616e 6465 6420 5b3a 2c20  on_expanded [:, 
+0000ab30: 325d 2920 2320 706f 7075 6c61 7465 206c  2]) # populate l
+0000ab40: 6566 7420 636f 6c75 6d6e 0a20 2020 2020  eft column.     
+0000ab50: 2020 2020 2020 2020 2020 206c 6f6e 5f65             lon_e
+0000ab60: 7870 616e 6465 6420 5b3a 2c2d 315d 2020  xpanded [:,-1]  
+0000ab70: 3d20 6c6f 6e5f 6578 7061 6e64 6564 205b  = lon_expanded [
+0000ab80: 3a2c 2d32 5d20 2b20 286c 6f6e 5f65 7870  :,-2] + (lon_exp
+0000ab90: 616e 6465 6420 5b3a 2c2d 325d 202d 206c  anded [:,-2] - l
+0000aba0: 6f6e 5f65 7870 616e 6465 6420 5b3a 2c2d  on_expanded [:,-
+0000abb0: 335d 2920 2320 706f 7075 6c61 7465 2072  3]) # populate r
+0000abc0: 6967 6874 2063 6f6c 756d 6e0a 2020 2020  ight column.    
+0000abd0: 2020 2020 2020 2020 2020 2020 6c6f 6e5f              lon_
+0000abe0: 6578 7061 6e64 6564 205b 302c 203a 5d20  expanded [0, :] 
+0000abf0: 203d 206c 6f6e 5f65 7870 616e 6465 6420   = lon_expanded 
+0000ac00: 5b31 2c20 3a5d 202b 2028 6c6f 6e5f 6578  [1, :] + (lon_ex
+0000ac10: 7061 6e64 6564 205b 312c 203a 5d20 2d20  panded [1, :] - 
+0000ac20: 6c6f 6e5f 6578 7061 6e64 6564 205b 322c  lon_expanded [2,
+0000ac30: 203a 5d29 2023 2070 6f70 756c 6174 6520   :]) # populate 
+0000ac40: 746f 7020 726f 770a 2020 2020 2020 2020  top row.        
+0000ac50: 2020 2020 2020 2020 6c6f 6e5f 6578 7061          lon_expa
+0000ac60: 6e64 6564 205b 2d31 2c3a 5d20 203d 206c  nded [-1,:]  = l
+0000ac70: 6f6e 5f65 7870 616e 6465 6420 5b2d 322c  on_expanded [-2,
+0000ac80: 3a5d 202b 2028 6c6f 6e5f 6578 7061 6e64  :] + (lon_expand
+0000ac90: 6564 205b 2d32 2c3a 5d20 2d20 6c6f 6e5f  ed [-2,:] - lon_
+0000aca0: 6578 7061 6e64 6564 205b 2d33 2c3a 5d29  expanded [-3,:])
+0000acb0: 2023 2070 6f70 756c 6174 6520 626f 7474   # populate bott
+0000acc0: 6f6d 2072 6f77 0a20 2020 2020 2020 2020  om row.         
+0000acd0: 2020 2020 2020 2023 2070 6173 7320 746f         # pass to
+0000ace0: 2074 6865 206c 6174 2c20 6c6f 6e20 6578   the lat, lon ex
+0000acf0: 7465 6e64 6564 0a20 2020 2020 2020 2020  tended.         
+0000ad00: 2020 2020 2020 2073 656c 662e 6c61 745f         self.lat_
+0000ad10: 6578 7061 6e64 6564 203d 206c 6174 5f65  expanded = lat_e
+0000ad20: 7870 616e 6465 640a 2020 2020 2020 2020  xpanded.        
+0000ad30: 2020 2020 2020 2020 7365 6c66 2e6c 6f6e          self.lon
+0000ad40: 5f65 7870 616e 6465 6420 3d20 6c6f 6e5f  _expanded = lon_
+0000ad50: 6578 7061 6e64 6564 0a20 2020 2020 2020  expanded.       
+0000ad60: 2023 2063 6173 6520 2332 2072 6f74 6174   # case #2 rotat
+0000ad70: 6564 206c 6174 2f6c 6f6e 0a20 2020 2020  ed lat/lon.     
+0000ad80: 2020 2069 6620 286c 656e 286e 6369 642e     if (len(ncid.
+0000ad90: 7661 7269 6162 6c65 735b 7365 6c66 2e76  variables[self.v
+0000ada0: 6172 5f6c 6174 5d2e 6469 6d65 6e73 696f  ar_lat].dimensio
+0000adb0: 6e73 293d 3d32 2920 616e 6420 286c 656e  ns)==2) and (len
+0000adc0: 286e 6369 642e 7661 7269 6162 6c65 735b  (ncid.variables[
+0000add0: 7365 6c66 2e76 6172 5f6c 6f6e 5d2e 6469  self.var_lon].di
+0000ade0: 6d65 6e73 696f 6e73 293d 3d32 293a 0a20  mensions)==2):. 
+0000adf0: 2020 2020 2020 2020 2020 2070 7269 6e74             print
+0000ae00: 2827 4541 5359 4d4f 5245 2064 6574 6563  ('EASYMORE detec
+0000ae10: 7473 2063 6173 6520 3220 2d20 726f 7461  ts case 2 - rota
+0000ae20: 7465 6420 6c61 742f 6c6f 6e27 290a 2020  ted lat/lon').  
+0000ae30: 2020 2020 2020 2020 2020 7365 6c66 2e63            self.c
+0000ae40: 6173 6520 3d20 320a 2020 2020 2020 2020  ase = 2.        
+0000ae50: 2020 2020 6c61 7420 3d20 6e63 6964 2e76      lat = ncid.v
+0000ae60: 6172 6961 626c 6573 5b73 656c 662e 7661  ariables[self.va
+0000ae70: 725f 6c61 745d 5b3a 2c3a 5d0a 2020 2020  r_lat][:,:].    
+0000ae80: 2020 2020 2020 2020 6c6f 6e20 3d20 6e63          lon = nc
+0000ae90: 6964 2e76 6172 6961 626c 6573 5b73 656c  id.variables[sel
+0000aea0: 662e 7661 725f 6c6f 6e5d 5b3a 2c3a 5d0a  f.var_lon][:,:].
+0000aeb0: 2020 2020 2020 2020 2020 2020 2320 6372              # cr
+0000aec0: 6561 7469 6e67 2f73 6176 696e 6720 7468  eating/saving th
+0000aed0: 6520 7368 6170 6566 696c 650a 2020 2020  e shapefile.    
+0000aee0: 2020 2020 2020 2020 6c61 7420 3d20 6e70          lat = np
+0000aef0: 2e61 7272 6179 286c 6174 292e 6173 7479  .array(lat).asty
+0000af00: 7065 2866 6c6f 6174 290a 2020 2020 2020  pe(float).      
+0000af10: 2020 2020 2020 6c6f 6e20 3d20 6e70 2e61        lon = np.a
+0000af20: 7272 6179 286c 6f6e 292e 6173 7479 7065  rray(lon).astype
+0000af30: 2866 6c6f 6174 290a 2020 2020 2020 2020  (float).        
+0000af40: 2020 2020 7365 6c66 2e6c 6174 203d 206c      self.lat = l
+0000af50: 6174 0a20 2020 2020 2020 2020 2020 2073  at.            s
+0000af60: 656c 662e 6c6f 6e20 3d20 6c6f 6e0a 2020  elf.lon = lon.  
+0000af70: 2020 2020 2020 2320 6361 7365 2023 3320        # case #3 
+0000af80: 312d 4420 6c61 742f 6c6f 6e20 616e 6420  1-D lat/lon and 
+0000af90: 3220 6461 7461 2066 6f72 2069 7272 6567  2 data for irreg
+0000afa0: 756c 6174 2073 6861 7065 730a 2020 2020  ulat shapes.    
+0000afb0: 2020 2020 6966 2028 6c65 6e28 6e63 6964      if (len(ncid
+0000afc0: 2e76 6172 6961 626c 6573 5b73 656c 662e  .variables[self.
+0000afd0: 7661 725f 6c61 745d 2e64 696d 656e 7369  var_lat].dimensi
+0000afe0: 6f6e 7329 3d3d 3129 2061 6e64 2028 6c65  ons)==1) and (le
+0000aff0: 6e28 6e63 6964 2e76 6172 6961 626c 6573  n(ncid.variables
+0000b000: 5b73 656c 662e 7661 725f 6c6f 6e5d 2e64  [self.var_lon].d
+0000b010: 696d 656e 7369 6f6e 7329 3d3d 3129 2061  imensions)==1) a
+0000b020: 6e64 5c0a 2020 2020 2020 2020 2020 2028  nd\.           (
+0000b030: 6c65 6e28 6e63 6964 2e76 6172 6961 626c  len(ncid.variabl
+0000b040: 6573 5b73 656c 662e 7661 725f 6e61 6d65  es[self.var_name
+0000b050: 735b 305d 5d2e 6469 6d65 6e73 696f 6e73  s[0]].dimensions
+0000b060: 293d 3d32 293a 0a20 2020 2020 2020 2020  )==2):.         
+0000b070: 2020 2070 7269 6e74 2827 4541 5359 4d4f     print('EASYMO
+0000b080: 5245 2064 6574 6563 7473 2063 6173 6520  RE detects case 
+0000b090: 3320 2d20 6972 7265 6775 6c61 7220 6c61  3 - irregular la
+0000b0a0: 742f 6c6f 6e3b 2073 6861 7065 6669 6c65  t/lon; shapefile
+0000b0b0: 2073 686f 756c 6420 6265 2070 726f 7669   should be provi
+0000b0c0: 6465 6427 290a 2020 2020 2020 2020 2020  ded').          
+0000b0d0: 2020 7365 6c66 2e63 6173 6520 3d20 330a    self.case = 3.
+0000b0e0: 2020 2020 2020 2020 2020 2020 6c61 7420              lat 
+0000b0f0: 3d20 6e63 6964 2e76 6172 6961 626c 6573  = ncid.variables
+0000b100: 5b73 656c 662e 7661 725f 6c61 745d 5b3a  [self.var_lat][:
+0000b110: 5d0a 2020 2020 2020 2020 2020 2020 6c6f  ].            lo
+0000b120: 6e20 3d20 6e63 6964 2e76 6172 6961 626c  n = ncid.variabl
+0000b130: 6573 5b73 656c 662e 7661 725f 6c6f 6e5d  es[self.var_lon]
+0000b140: 5b3a 5d0a 2020 2020 2020 2020 2020 2020  [:].            
+0000b150: 2370 7269 6e74 286c 6174 2c20 6c6f 6e29  #print(lat, lon)
+0000b160: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
+0000b170: 7365 6c66 2e76 6172 5f49 4420 203d 3d20  self.var_ID  == 
+0000b180: 2727 3a0a 2020 2020 2020 2020 2020 2020  '':.            
+0000b190: 2020 2020 7072 696e 7428 2745 4153 594d      print('EASYM
+0000b1a0: 4f52 4520 6465 7465 6374 7320 7468 6174  ORE detects that
+0000b1b0: 206e 6f20 7661 7269 6162 6c65 2066 6f72   no variable for
+0000b1c0: 2049 4420 6f66 2074 6865 2073 6f75 7263   ID of the sourc
+0000b1d0: 6520 6e65 7443 4446 2066 696c 653b 2061  e netCDF file; a
+0000b1e0: 6e20 6172 6269 7461 7469 7279 2049 4420  n arbitatiry ID 
+0000b1f0: 7769 6c6c 2062 6520 6164 6465 6427 290a  will be added').
+0000b200: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000b210: 4944 203d 2020 6e70 2e61 7261 6e67 6528  ID =  np.arange(
+0000b220: 6c65 6e28 6c61 7429 292b 3120 2320 7061  len(lat))+1 # pa
+0000b230: 7373 2061 7262 6974 6172 6172 7920 7661  ss arbitarary va
+0000b240: 6c75 6573 0a20 2020 2020 2020 2020 2020  lues.           
+0000b250: 2065 6c73 653a 0a20 2020 2020 2020 2020   else:.         
+0000b260: 2020 2020 2020 2049 4420 3d20 6e63 6964         ID = ncid
+0000b270: 2e76 6172 6961 626c 6573 5b73 656c 662e  .variables[self.
+0000b280: 7661 725f 4944 5d5b 3a5d 0a20 2020 2020  var_ID][:].     
+0000b290: 2020 2020 2020 2023 2063 7265 6174 696e         # creatin
+0000b2a0: 672f 7361 7669 6e67 2074 6865 2073 6861  g/saving the sha
+0000b2b0: 7065 6669 6c65 0a20 2020 2020 2020 2020  pefile.         
+0000b2c0: 2020 206c 6174 203d 206e 702e 6172 7261     lat = np.arra
+0000b2d0: 7928 6c61 7429 2e61 7374 7970 6528 666c  y(lat).astype(fl
+0000b2e0: 6f61 7429 0a20 2020 2020 2020 2020 2020  oat).           
+0000b2f0: 206c 6f6e 203d 206e 702e 6172 7261 7928   lon = np.array(
+0000b300: 6c6f 6e29 2e61 7374 7970 6528 666c 6f61  lon).astype(floa
+0000b310: 7429 0a20 2020 2020 2020 2020 2020 2073  t).            s
+0000b320: 656c 662e 6c61 7420 3d20 6c61 740a 2020  elf.lat = lat.  
+0000b330: 2020 2020 2020 2020 2020 7365 6c66 2e6c            self.l
+0000b340: 6f6e 203d 206c 6f6e 0a20 2020 2020 2020  on = lon.       
+0000b350: 2020 2020 2073 656c 662e 4944 2020 3d20       self.ID  = 
+0000b360: 4944 0a0a 2020 2020 6465 6620 6c61 745f  ID..    def lat_
+0000b370: 6c6f 6e5f 5348 5028 7365 6c66 2c0a 2020  lon_SHP(self,.  
+0000b380: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000b390: 2020 6c61 742c 0a20 2020 2020 2020 2020    lat,.         
+0000b3a0: 2020 2020 2020 2020 2020 206c 6f6e 2c0a             lon,.
+0000b3b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000b3c0: 2020 2020 6372 7320 3d20 4e6f 6e65 2c0a      crs = None,.
+0000b3d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000b3e0: 2020 2020 6669 6c65 5f6e 616d 6520 3d20      file_name = 
+0000b3f0: 4e6f 6e65 293a 0a20 2020 2020 2020 2022  None):.        "
+0000b400: 2222 0a20 2020 2020 2020 2040 2061 7574  "".        @ aut
+0000b410: 686f 723a 2020 2020 2020 2020 2020 2020  hor:            
+0000b420: 2020 2020 2020 5368 6572 7661 6e20 4768        Shervan Gh
+0000b430: 6172 6172 692c 2057 6f75 7465 7220 4b6e  arari, Wouter Kn
+0000b440: 6f62 656e 0a20 2020 2020 2020 2040 2047  oben.        @ G
+0000b450: 6974 6875 623a 2020 2020 2020 2020 2020  ithub:          
+0000b460: 2020 2020 2020 2020 6874 7470 733a 2f2f          https://
+0000b470: 6769 7468 7562 2e63 6f6d 2f53 6865 7276  github.com/Sherv
+0000b480: 616e 4768 6172 6172 692f 4541 5359 4d4f  anGharari/EASYMO
+0000b490: 5245 0a20 2020 2020 2020 2040 2061 7574  RE.        @ aut
+0000b4a0: 686f 7227 7320 656d 6169 6c20 6964 3a20  hor's email id: 
+0000b4b0: 2020 2020 2020 7368 2e67 6861 7261 7269        sh.gharari
+0000b4c0: 4067 6d61 696c 2e63 6f6d 0a20 2020 2020  @gmail.com.     
+0000b4d0: 2020 2040 206c 6963 656e 7365 3a20 2020     @ license:   
+0000b4e0: 2020 2020 2020 2020 2020 2020 2020 474e                GN
+0000b4f0: 552d 4750 4c76 330a 2020 2020 2020 2020  U-GPLv3.        
+0000b500: 5468 6973 2066 756e 6374 696f 6e20 6372  This function cr
+0000b510: 6561 7465 7320 6120 7368 6170 6566 696c  eates a shapefil
+0000b520: 6520 666f 7220 7468 6520 736f 7572 6365  e for the source
+0000b530: 206e 6574 6364 6620 6669 6c65 0a20 2020   netcdf file.   
+0000b540: 2020 2020 2041 7267 756d 656e 7473 0a20       Arguments. 
+0000b550: 2020 2020 2020 202d 2d2d 2d2d 2d2d 2d2d         ---------
+0000b560: 0a20 2020 2020 2020 206c 6174 3a20 6e75  .        lat: nu
+0000b570: 6d70 7920 6172 7261 792c 2074 6865 2032  mpy array, the 2
+0000b580: 4420 6d61 7472 6978 206f 6620 6c61 745f  D matrix of lat_
+0000b590: 3244 205b 6e2c 6d2c 5d0a 2020 2020 2020  2D [n,m,].      
+0000b5a0: 2020 6c6f 6e3a 206e 756d 7079 2061 7272    lon: numpy arr
+0000b5b0: 6179 2c20 7468 6520 3244 206d 6174 7269  ay, the 2D matri
+0000b5c0: 7820 6f66 206c 6f6e 5f32 4420 5b6e 2c6d  x of lon_2D [n,m
+0000b5d0: 2c5d 0a20 2020 2020 2020 2066 696c 655f  ,].        file_
+0000b5e0: 6e61 6d65 3a20 7374 7269 6e67 2c20 6e61  name: string, na
+0000b5f0: 6d65 206f 6620 7468 6520 6669 6c65 2074  me of the file t
+0000b600: 6861 7420 7468 6520 7368 6170 6566 696c  hat the shapefil
+0000b610: 6520 7769 6c6c 2062 6520 7361 7665 6420  e will be saved 
+0000b620: 6174 0a20 2020 2020 2020 2022 2222 0a0a  at.        """..
+0000b630: 2020 2020 2020 2020 6672 6f6d 2020 2073          from   s
+0000b640: 6861 7065 6c79 2e67 656f 6d65 7472 7920  hapely.geometry 
+0000b650: 696d 706f 7274 2050 6f6c 7967 6f6e 0a20  import Polygon. 
+0000b660: 2020 2020 2020 2069 6d70 6f72 7420 6765         import ge
+0000b670: 6f70 616e 6461 7320 6173 2067 7064 0a0a  opandas as gpd..
+0000b680: 2020 2020 2020 2020 2320 656d 7074 7920          # empty 
+0000b690: 6461 7461 6672 616d 650a 2020 2020 2020  dataframe.      
+0000b6a0: 2020 6466 203d 2070 642e 4461 7461 4672    df = pd.DataFr
+0000b6b0: 616d 6528 290a 2020 2020 2020 2020 2320  ame().        # 
+0000b6c0: 6765 7420 7468 6520 6c61 7473 2061 6e64  get the lats and
+0000b6d0: 206c 6f6e 7320 6f66 2073 7572 726f 756e   lons of surroun
+0000b6e0: 6469 6e67 2067 7269 6473 0a20 2020 2020  ding grids.     
+0000b6f0: 2020 2064 665b 274c 6174 5f55 705f 4c65     df['Lat_Up_Le
+0000b700: 6674 275d 2020 203d 206c 6174 205b 2020  ft']   = lat [  
+0000b710: 3a2d 3220 2c20 2020 3a2d 325d 2e66 6c61  :-2 ,   :-2].fla
+0000b720: 7474 656e 2829 0a20 2020 2020 2020 2064  tten().        d
+0000b730: 665b 274c 6174 5f4c 6566 7427 5d20 2020  f['Lat_Left']   
+0000b740: 2020 203d 206c 6174 205b 2031 3a2d 3120     = lat [ 1:-1 
+0000b750: 2c20 2020 3a2d 325d 2e66 6c61 7474 656e  ,   :-2].flatten
+0000b760: 2829 0a20 2020 2020 2020 2064 665b 274c  ().        df['L
+0000b770: 6174 5f4c 6f77 5f4c 6566 7427 5d20 203d  at_Low_Left']  =
+0000b780: 206c 6174 205b 2032 3a20 2020 2c20 2020   lat [ 2:   ,   
+0000b790: 3a2d 325d 2e66 6c61 7474 656e 2829 0a20  :-2].flatten(). 
+0000b7a0: 2020 2020 2020 2064 665b 274c 6174 5f4c         df['Lat_L
+0000b7b0: 6f77 275d 2020 2020 2020 203d 206c 6174  ow']       = lat
+0000b7c0: 205b 2032 3a20 2020 2c20 2031 3a2d 315d   [ 2:   ,  1:-1]
+0000b7d0: 2e66 6c61 7474 656e 2829 0a20 2020 2020  .flatten().     
+0000b7e0: 2020 2064 665b 274c 6174 5f4c 6f77 5f52     df['Lat_Low_R
+0000b7f0: 6967 6874 275d 203d 206c 6174 205b 2032  ight'] = lat [ 2
+0000b800: 3a20 2020 2c20 2032 3a20 205d 2e66 6c61  :   ,  2:  ].fla
+0000b810: 7474 656e 2829 0a20 2020 2020 2020 2064  tten().        d
+0000b820: 665b 274c 6174 5f52 6967 6874 275d 2020  f['Lat_Right']  
+0000b830: 2020 203d 206c 6174 205b 2031 3a2d 3120     = lat [ 1:-1 
+0000b840: 2c20 2032 3a20 205d 2e66 6c61 7474 656e  ,  2:  ].flatten
+0000b850: 2829 0a20 2020 2020 2020 2064 665b 274c  ().        df['L
+0000b860: 6174 5f55 705f 5269 6768 7427 5d20 203d  at_Up_Right']  =
+0000b870: 206c 6174 205b 2020 3a2d 3220 2c20 2032   lat [  :-2 ,  2
+0000b880: 3a20 205d 2e66 6c61 7474 656e 2829 0a20  :  ].flatten(). 
+0000b890: 2020 2020 2020 2064 665b 274c 6174 5f55         df['Lat_U
+0000b8a0: 7027 5d20 2020 2020 2020 203d 206c 6174  p']        = lat
+0000b8b0: 205b 2020 3a2d 3220 2c20 2031 3a2d 315d   [  :-2 ,  1:-1]
+0000b8c0: 2e66 6c61 7474 656e 2829 0a20 2020 2020  .flatten().     
+0000b8d0: 2020 2064 665b 274c 6f6e 5f55 705f 4c65     df['Lon_Up_Le
+0000b8e0: 6674 275d 2020 203d 206c 6f6e 205b 2020  ft']   = lon [  
+0000b8f0: 3a2d 3220 2c20 2020 3a2d 325d 2e66 6c61  :-2 ,   :-2].fla
+0000b900: 7474 656e 2829 0a20 2020 2020 2020 2064  tten().        d
+0000b910: 665b 274c 6f6e 5f4c 6566 7427 5d20 2020  f['Lon_Left']   
+0000b920: 2020 203d 206c 6f6e 205b 2031 3a2d 3120     = lon [ 1:-1 
+0000b930: 2c20 2020 3a2d 325d 2e66 6c61 7474 656e  ,   :-2].flatten
+0000b940: 2829 0a20 2020 2020 2020 2064 665b 274c  ().        df['L
+0000b950: 6f6e 5f4c 6f77 5f4c 6566 7427 5d20 203d  on_Low_Left']  =
+0000b960: 206c 6f6e 205b 2032 3a20 2020 2c20 2020   lon [ 2:   ,   
+0000b970: 3a2d 325d 2e66 6c61 7474 656e 2829 0a20  :-2].flatten(). 
+0000b980: 2020 2020 2020 2064 665b 274c 6f6e 5f4c         df['Lon_L
+0000b990: 6f77 275d 2020 2020 2020 203d 206c 6f6e  ow']       = lon
+0000b9a0: 205b 2032 3a20 2020 2c20 2031 3a2d 315d   [ 2:   ,  1:-1]
+0000b9b0: 2e66 6c61 7474 656e 2829 0a20 2020 2020  .flatten().     
+0000b9c0: 2020 2064 665b 274c 6f6e 5f4c 6f77 5f52     df['Lon_Low_R
+0000b9d0: 6967 6874 275d 203d 206c 6f6e 205b 2032  ight'] = lon [ 2
+0000b9e0: 3a20 2020 2c20 2032 3a20 205d 2e66 6c61  :   ,  2:  ].fla
+0000b9f0: 7474 656e 2829 0a20 2020 2020 2020 2064  tten().        d
+0000ba00: 665b 274c 6f6e 5f52 6967 6874 275d 2020  f['Lon_Right']  
+0000ba10: 2020 203d 206c 6f6e 205b 2031 3a2d 3120     = lon [ 1:-1 
+0000ba20: 2c20 2032 3a20 205d 2e66 6c61 7474 656e  ,  2:  ].flatten
+0000ba30: 2829 0a20 2020 2020 2020 2064 665b 274c  ().        df['L
+0000ba40: 6f6e 5f55 705f 5269 6768 7427 5d20 203d  on_Up_Right']  =
+0000ba50: 206c 6f6e 205b 2020 3a2d 3220 2c20 2032   lon [  :-2 ,  2
+0000ba60: 3a20 205d 2e66 6c61 7474 656e 2829 0a20  :  ].flatten(). 
+0000ba70: 2020 2020 2020 2064 665b 274c 6f6e 5f55         df['Lon_U
+0000ba80: 7027 5d20 2020 2020 2020 203d 206c 6f6e  p']        = lon
+0000ba90: 205b 2020 3a2d 3220 2c20 2031 3a2d 315d   [  :-2 ,  1:-1]
+0000baa0: 2e66 6c61 7474 656e 2829 0a20 2020 2020  .flatten().     
+0000bab0: 2020 2023 2067 6574 2074 6865 2063 656e     # get the cen
+0000bac0: 7465 7220 6f66 2067 7269 640a 2020 2020  ter of grid.    
+0000bad0: 2020 2020 6466 5b27 4c61 745f 4327 5d20      df['Lat_C'] 
+0000bae0: 2020 2020 2020 2020 3d20 6c61 7420 5b20          = lat [ 
+0000baf0: 313a 2d31 202c 2020 313a 2d31 5d2e 666c  1:-1 ,  1:-1].fl
+0000bb00: 6174 7465 6e28 290a 2020 2020 2020 2020  atten().        
+0000bb10: 6466 5b27 4c6f 6e5f 4327 5d20 2020 2020  df['Lon_C']     
+0000bb20: 2020 2020 3d20 6c6f 6e20 5b20 313a 2d31      = lon [ 1:-1
+0000bb30: 202c 2020 313a 2d31 5d2e 666c 6174 7465   ,  1:-1].flatte
+0000bb40: 6e28 290a 0a0a 2020 2020 2020 2020 2320  n()...        # 
+0000bb50: 6361 6c63 756c 6174 6520 7468 6520 6d69  calculate the mi
+0000bb60: 6420 706f 696e 7420 7769 7468 2073 7572  d point with sur
+0000bb70: 726f 756e 6469 6e67 2067 7269 6473 0a20  rounding grids. 
+0000bb80: 2020 2020 2020 2064 665b 2750 6f69 6e74         df['Point
+0000bb90: 5f4c 6174 5f55 705f 4c65 6674 275d 2020  _Lat_Up_Left']  
+0000bba0: 203d 2028 6466 5b27 4c61 745f 5570 5f4c   = (df['Lat_Up_L
+0000bbb0: 6566 7427 5d20 2020 2b64 665b 274c 6174  eft']   +df['Lat
+0000bbc0: 5f55 7027 5d20 202b 6466 5b27 4c61 745f  _Up']  +df['Lat_
+0000bbd0: 4c65 6674 275d 2020 202b 6466 5b27 4c61  Left']   +df['La
+0000bbe0: 745f 4327 5d29 2f34 0a20 2020 2020 2020  t_C'])/4.       
+0000bbf0: 2064 665b 2750 6f69 6e74 5f4c 6174 5f4c   df['Point_Lat_L
+0000bc00: 6566 7427 5d20 2020 2020 203d 2028 6466  eft']      = (df
+0000bc10: 5b27 4c61 745f 4c65 6674 275d 2020 2020  ['Lat_Left']    
+0000bc20: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000bc30: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000bc40: 2020 202b 6466 5b27 4c61 745f 4327 5d29     +df['Lat_C'])
+0000bc50: 2f32 0a20 2020 2020 2020 2064 665b 2750  /2.        df['P
+0000bc60: 6f69 6e74 5f4c 6174 5f4c 6f77 5f4c 6566  oint_Lat_Low_Lef
+0000bc70: 7427 5d20 203d 2028 6466 5b27 4c61 745f  t']  = (df['Lat_
+0000bc80: 4c6f 775f 4c65 6674 275d 2020 2b64 665b  Low_Left']  +df[
+0000bc90: 274c 6174 5f4c 6f77 275d 202b 6466 5b27  'Lat_Low'] +df['
+0000bca0: 4c61 745f 4c65 6674 275d 2020 202b 6466  Lat_Left']   +df
+0000bcb0: 5b27 4c61 745f 4327 5d29 2f34 0a20 2020  ['Lat_C'])/4.   
+0000bcc0: 2020 2020 2064 665b 2750 6f69 6e74 5f4c       df['Point_L
+0000bcd0: 6174 5f4c 6f77 275d 2020 2020 2020 203d  at_Low']       =
+0000bce0: 2028 6466 5b27 4c61 745f 4c6f 7727 5d20   (df['Lat_Low'] 
+0000bcf0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000bd00: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000bd10: 2020 2020 2020 202b 6466 5b27 4c61 745f         +df['Lat_
+0000bd20: 4327 5d29 2f32 0a20 2020 2020 2020 2064  C'])/2.        d
+0000bd30: 665b 2750 6f69 6e74 5f4c 6174 5f4c 6f77  f['Point_Lat_Low
+0000bd40: 5f52 6967 6874 275d 203d 2028 6466 5b27  _Right'] = (df['
+0000bd50: 4c61 745f 4c6f 775f 5269 6768 7427 5d20  Lat_Low_Right'] 
+0000bd60: 2b64 665b 274c 6174 5f4c 6f77 275d 202b  +df['Lat_Low'] +
+0000bd70: 6466 5b27 4c61 745f 5269 6768 7427 5d20  df['Lat_Right'] 
+0000bd80: 202b 6466 5b27 4c61 745f 4327 5d29 2f34   +df['Lat_C'])/4
+0000bd90: 0a20 2020 2020 2020 2064 665b 2750 6f69  .        df['Poi
+0000bda0: 6e74 5f4c 6174 5f52 6967 6874 275d 2020  nt_Lat_Right']  
+0000bdb0: 2020 203d 2028 6466 5b27 4c61 745f 5269     = (df['Lat_Ri
+0000bdc0: 6768 7427 5d20 2020 2020 2020 2020 2020  ght']           
 0000bdd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000bde0: 206c 6174 5f74 6172 6765 745f 696e 742c   lat_target_int,
-0000bdf0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0000be00: 2020 2020 2020 2020 2020 2020 206c 6f6e               lon
-0000be10: 5f74 6172 6765 745f 696e 7429 3a0a 2020  _target_int):.  
-0000be20: 2020 2020 2020 2222 220a 2020 2020 2020        """.      
-0000be30: 2020 4020 6175 7468 6f72 3a20 2020 2020    @ author:     
-0000be40: 2020 2020 2020 2020 2020 2020 2053 6865               She
-0000be50: 7276 616e 2047 6861 7261 7269 0a20 2020  rvan Gharari.   
-0000be60: 2020 2020 2040 2047 6974 6875 623a 2020       @ Github:  
-0000be70: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000be80: 6874 7470 733a 2f2f 6769 7468 7562 2e63  https://github.c
-0000be90: 6f6d 2f53 6865 7276 616e 4768 6172 6172  om/ShervanGharar
-0000bea0: 692f 4541 5359 4d4f 5245 0a20 2020 2020  i/EASYMORE.     
-0000beb0: 2020 2040 2061 7574 686f 7227 7320 656d     @ author's em
-0000bec0: 6169 6c20 6964 3a20 2020 2020 2020 7368  ail id:       sh
-0000bed0: 2e67 6861 7261 7269 4067 6d61 696c 2e63  .gharari@gmail.c
-0000bee0: 6f6d 0a20 2020 2020 2020 2040 206c 6963  om.        @ lic
-0000bef0: 656e 7365 3a20 2020 2020 2020 2020 2020  ense:           
-0000bf00: 2020 2020 2020 474e 552d 4750 4c76 330a        GNU-GPLv3.
-0000bf10: 2020 2020 2020 2020 7468 6973 2066 7563          this fuc
-0000bf20: 6e74 696f 6e20 6765 7473 2074 6865 2072  ntion gets the r
-0000bf30: 6f77 2061 6e64 2063 6f6c 6f6d 6e73 206f  ow and colomns o
-0000bf40: 6620 7468 6520 736f 7572 6365 206e 6574  f the source net
-0000bf50: 6364 6620 6669 6c65 2061 6e64 2072 6574  cdf file and ret
-0000bf60: 7572 6e73 2069 740a 2020 2020 2020 2020  urns it.        
-0000bf70: 2d2d 2d2d 2d2d 2d2d 2d2d 0a20 2020 2020  ----------.     
-0000bf80: 2020 206c 6174 5f73 6f75 7263 653a 206e     lat_source: n
-0000bf90: 756d 7079 2061 7272 6179 206f 6620 6c61  umpy array of la
-0000bfa0: 7420 736f 7572 6365 0a20 2020 2020 2020  t source.       
-0000bfb0: 206c 6f6e 5f73 6f75 7263 653a 206e 756d   lon_source: num
-0000bfc0: 7079 2061 7272 6179 206f 6620 6c6f 6e20  py array of lon 
-0000bfd0: 736f 7572 6365 0a20 2020 2020 2020 206c  source.        l
-0000bfe0: 6174 5f74 6172 6765 745f 696e 743a 206e  at_target_int: n
-0000bff0: 756d 7079 2061 7272 6179 206f 6620 6c61  umpy array of la
-0000c000: 7420 736f 7572 6365 0a20 2020 2020 2020  t source.       
-0000c010: 206c 6f6e 5f74 6172 6765 745f 696e 743a   lon_target_int:
-0000c020: 206e 756d 7079 2061 7272 6179 206f 6620   numpy array of 
-0000c030: 6c6f 6e20 736f 7572 6365 0a20 2020 2020  lon source.     
-0000c040: 2020 2052 6574 7572 6e73 0a20 2020 2020     Returns.     
-0000c050: 2020 202d 2d2d 2d2d 2d2d 0a20 2020 2020     -------.     
-0000c060: 2020 2072 6f77 733a 206e 756d 7079 2061     rows: numpy a
-0000c070: 7272 6179 2c20 726f 7773 2066 726f 6d20  rray, rows from 
-0000c080: 7468 6520 736f 7572 6365 2066 696c 6520  the source file 
-0000c090: 6261 7365 6420 6f6e 2074 6865 2074 6172  based on the tar
-0000c0a0: 6765 7420 6c61 742f 6c6f 6e0a 2020 2020  get lat/lon.    
-0000c0b0: 2020 2020 636f 6c73 3a20 6e75 6d70 7920      cols: numpy 
-0000c0c0: 6172 7261 792c 2063 6f6c 7320 6672 6f6d  array, cols from
-0000c0d0: 2074 6865 2073 6f75 7263 6520 6669 6c65   the source file
-0000c0e0: 2062 6173 6564 206f 6e20 7468 6520 7461   based on the ta
-0000c0f0: 7267 6574 206c 6174 2f6c 6f6e 0a20 2020  rget lat/lon.   
-0000c100: 2020 2020 2022 2222 0a20 2020 2020 2020       """.       
-0000c110: 2023 2063 7265 6174 6520 7468 6520 726f   # create the ro
-0000c120: 7773 2061 6e64 2063 6f6c 730a 2020 2020  ws and cols.    
-0000c130: 2020 2020 726f 7773 203d 206e 702e 7a65      rows = np.ze
-0000c140: 726f 7328 6c65 6e28 6c61 745f 7461 7267  ros(len(lat_targ
-0000c150: 6574 5f69 6e74 2929 0a20 2020 2020 2020  et_int)).       
-0000c160: 2063 6f6c 7320 3d20 6e70 2e7a 6572 6f73   cols = np.zeros
-0000c170: 286c 656e 286c 6f6e 5f74 6172 6765 745f  (len(lon_target_
-0000c180: 696e 7429 290a 2020 2020 2020 2020 2320  int)).        # 
-0000c190: 6c6f 6f70 2074 6f20 6669 6e64 2074 6865  loop to find the
-0000c1a0: 2072 6f77 7320 616e 6420 636f 6c6f 6d6e   rows and colomn
-0000c1b0: 730a 2020 2020 2020 2020 666f 7220 6920  s.        for i 
-0000c1c0: 696e 206e 702e 6172 616e 6765 286c 656e  in np.arange(len
-0000c1d0: 286c 6174 5f74 6172 6765 745f 696e 7429  (lat_target_int)
-0000c1e0: 293a 0a20 2020 2020 2020 2020 2020 206c  ):.            l
-0000c1f0: 6174 5f6c 6f6e 5f76 616c 7565 5f64 6966  at_lon_value_dif
-0000c200: 6620 3d20 6162 7328 6c61 745f 7461 7267  f = abs(lat_targ
-0000c210: 6574 5f69 6e74 5b69 5d2d 6c61 745f 736f  et_int[i]-lat_so
-0000c220: 7572 6365 292b 6162 7328 6c6f 6e5f 7461  urce)+abs(lon_ta
-0000c230: 7267 6574 5f69 6e74 5b69 5d2d 6c6f 6e5f  rget_int[i]-lon_
-0000c240: 736f 7572 6365 290a 2020 2020 2020 2020  source).        
-0000c250: 2020 2020 6966 2073 656c 662e 6361 7365      if self.case
-0000c260: 203d 3d20 3120 6f72 2073 656c 662e 6361   == 1 or self.ca
-0000c270: 7365 203d 3d20 323a 0a20 2020 2020 2020  se == 2:.       
-0000c280: 2020 2020 2020 2020 2072 6f77 2c20 636f           row, co
-0000c290: 6c20 3d20 6e70 2e77 6865 7265 286c 6174  l = np.where(lat
-0000c2a0: 5f6c 6f6e 5f76 616c 7565 5f64 6966 6620  _lon_value_diff 
-0000c2b0: 3d3d 206e 702e 6d69 6e28 6c61 745f 6c6f  == np.min(lat_lo
-0000c2c0: 6e5f 7661 6c75 655f 6469 6666 2929 0a20  n_value_diff)). 
-0000c2d0: 2020 2020 2020 2020 2020 2069 6620 7365             if se
-0000c2e0: 6c66 2e63 6173 6520 3d3d 2033 3a0a 2020  lf.case == 3:.  
-0000c2f0: 2020 2020 2020 2020 2020 2020 2020 726f                ro
-0000c300: 7720 3d20 6e70 2e77 6865 7265 286c 6174  w = np.where(lat
-0000c310: 5f6c 6f6e 5f76 616c 7565 5f64 6966 6620  _lon_value_diff 
-0000c320: 3d3d 206e 702e 6d69 6e28 6c61 745f 6c6f  == np.min(lat_lo
-0000c330: 6e5f 7661 6c75 655f 6469 6666 2929 0a20  n_value_diff)). 
-0000c340: 2020 2020 2020 2020 2020 2020 2020 2063                 c
-0000c350: 6f6c 203d 2072 6f77 0a20 2020 2020 2020  ol = row.       
-0000c360: 2020 2020 2072 6f77 7320 5b69 5d20 3d20       rows [i] = 
-0000c370: 726f 775b 305d 0a20 2020 2020 2020 2020  row[0].         
-0000c380: 2020 2063 6f6c 7320 5b69 5d20 3d20 636f     cols [i] = co
-0000c390: 6c5b 305d 0a20 2020 2020 2020 2023 2070  l[0].        # p
-0000c3a0: 6173 7320 746f 2063 6c61 7373 0a20 2020  ass to class.   
-0000c3b0: 2020 2020 2072 6574 7572 6e20 726f 7773       return rows
-0000c3c0: 2c20 636f 6c73 0a0a 2020 2020 6465 6620  , cols..    def 
-0000c3d0: 6368 6563 6b5f 6561 7379 6d6f 7265 5f72  check_easymore_r
-0000c3e0: 656d 6170 2820 2073 656c 662c 0a20 2020  emap(  self,.   
-0000c3f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000c400: 2020 2020 2020 2020 2020 7265 6d61 705f            remap_
-0000c410: 6466 293a 0a20 2020 2020 2020 2022 2222  df):.        """
-0000c420: 0a20 2020 2020 2020 2040 2061 7574 686f  .        @ autho
-0000c430: 723a 2020 2020 2020 2020 2020 2020 2020  r:              
-0000c440: 2020 2020 5368 6572 7661 6e20 4768 6172      Shervan Ghar
-0000c450: 6172 690a 2020 2020 2020 2020 4020 4769  ari.        @ Gi
-0000c460: 7468 7562 3a20 2020 2020 2020 2020 2020  thub:           
-0000c470: 2020 2020 2020 2068 7474 7073 3a2f 2f67         https://g
-0000c480: 6974 6875 622e 636f 6d2f 5368 6572 7661  ithub.com/Sherva
-0000c490: 6e47 6861 7261 7269 2f45 4153 594d 4f52  nGharari/EASYMOR
-0000c4a0: 450a 2020 2020 2020 2020 4020 6175 7468  E.        @ auth
-0000c4b0: 6f72 2773 2065 6d61 696c 2069 643a 2020  or's email id:  
-0000c4c0: 2020 2020 2073 682e 6768 6172 6172 6940       sh.gharari@
-0000c4d0: 676d 6169 6c2e 636f 6d0a 2020 2020 2020  gmail.com.      
-0000c4e0: 2020 4020 6c69 6365 6e73 653a 2020 2020    @ license:    
-0000c4f0: 2020 2020 2020 2020 2020 2020 2047 4e55               GNU
-0000c500: 2d47 504c 7633 0a20 2020 2020 2020 2074  -GPLv3.        t
-0000c510: 6869 7320 6675 6e63 7469 6f6e 2063 6865  his function che
-0000c520: 636b 2074 6865 2072 656d 6170 7069 6e67  ck the remapping
-0000c530: 2064 6174 6166 7261 6d65 0a20 2020 2020   dataframe.     
-0000c540: 2020 2050 6172 616d 6574 6572 733a 0a20     Parameters:. 
-0000c550: 2020 2020 2020 202d 2d2d 2d2d 2d2d 2d2d         ---------
-0000c560: 2d0a 2020 2020 2020 2020 7265 6d61 705f  -.        remap_
-0000c570: 6466 3a20 6461 7461 6672 616d 652c 2069  df: dataframe, i
-0000c580: 6e63 6c75 6469 6e67 2072 656d 6170 7069  ncluding remappi
-0000c590: 6e67 2069 6e66 6f72 6d61 7469 6f6e 2069  ng information i
-0000c5a0: 6e63 6c75 6469 6e67 2074 6865 2066 6f6c  ncluding the fol
-0000c5b0: 6c6f 7769 6e67 2063 6f6c 6f6d 6e73 3a0a  lowing colomns:.
-0000c5c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000c5d0: 2020 2020 4944 5f74 6172 6765 740a 2020      ID_target.  
-0000c5e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000c5f0: 2020 6c6f 6e5f 7461 7267 6574 0a20 2020    lon_target.   
-0000c600: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000c610: 206c 6174 5f74 6172 6765 740a 2020 2020   lat_target.    
-0000c620: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000c630: 4944 5f73 6f75 7263 650a 2020 2020 2020  ID_source.      
-0000c640: 2020 2020 2020 2020 2020 2020 2020 6c61                la
-0000c650: 745f 736f 7572 6365 0a20 2020 2020 2020  t_source.       
-0000c660: 2020 2020 2020 2020 2020 2020 206c 6f6e               lon
-0000c670: 5f73 6f75 7263 650a 2020 2020 2020 2020  _source.        
-0000c680: 2020 2020 2020 2020 2020 2020 726f 7773              rows
-0000c690: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0000c6a0: 2020 2020 2063 6f6c 730a 2020 2020 2020       cols.      
-0000c6b0: 2020 2020 2020 2020 2020 2020 2020 6f72                or
-0000c6c0: 6465 720a 2020 2020 2020 2020 2222 220a  der.        """.
-0000c6d0: 2020 2020 2020 2020 2320 6368 6563 6b20          # check 
-0000c6e0: 6966 2074 6865 7265 2069 7320 4541 5359  if there is EASY
-0000c6f0: 4d4f 5245 5f63 6173 6520 696e 2074 6865  MORE_case in the
-0000c700: 2063 6f6c 756d 6e73 0a20 2020 2020 2020   columns.       
-0000c710: 2069 6620 2765 6173 796d 6f72 655f 6361   if 'easymore_ca
-0000c720: 7365 2720 696e 2072 656d 6170 5f64 662e  se' in remap_df.
-0000c730: 636f 6c75 6d6e 733a 0a20 2020 2020 2020  columns:.       
-0000c740: 2020 2020 2070 7269 6e74 2827 4541 5359       print('EASY
-0000c750: 4d4f 5245 2063 6173 6520 6578 6973 7473  MORE case exists
-0000c760: 2069 6e20 7468 6520 7265 6d61 7020 6669   in the remap fi
-0000c770: 6c65 2729 0a20 2020 2020 2020 2065 6c73  le').        els
-0000c780: 653a 0a20 2020 2020 2020 2020 2020 2073  e:.            s
-0000c790: 7973 2e65 7869 7428 2745 4153 594d 4f52  ys.exit('EASYMOR
-0000c7a0: 4520 6361 7365 2066 6965 6c64 2064 6f20  E case field do 
-0000c7b0: 6e6f 7420 6573 6974 7320 696e 2074 6865  not esits in the
-0000c7c0: 2072 656d 6170 2066 696c 653b 206d 616b   remap file; mak
-0000c7d0: 6520 7375 7265 2074 6f20 696e 636c 7564  e sure to includ
-0000c7e0: 6520 7468 6973 2061 6e64 2074 616b 6520  e this and take 
-0000c7f0: 6361 7265 2069 6620 796f 7572 2064 6f20  care if your do 
-0000c800: 6974 206d 616e 7561 6c6c 7921 2729 0a20  it manually!'). 
-0000c810: 2020 2020 2020 2023 2063 6865 636b 2069         # check i
-0000c820: 6620 616c 6c20 7468 6520 6561 7379 6d6f  f all the easymo
-0000c830: 7265 5f63 6173 6520 6973 2075 6e69 7175  re_case is uniqu
-0000c840: 6520 666f 7220 7468 6520 6461 7461 2073  e for the data s
-0000c850: 6574 0a20 2020 2020 2020 2069 6620 6e6f  et.        if no
-0000c860: 7420 286c 656e 286e 702e 756e 6971 7565  t (len(np.unique
-0000c870: 286e 702e 6172 7261 7928 7265 6d61 705f  (np.array(remap_
-0000c880: 6466 5b27 6561 7379 6d6f 7265 5f63 6173  df['easymore_cas
-0000c890: 6527 5d29 2929 3d3d 3129 3a0a 2020 2020  e'])))==1):.    
-0000c8a0: 2020 2020 2020 2020 7379 732e 6578 6974          sys.exit
-0000c8b0: 2827 7468 6520 4541 5359 4d4f 5245 5f63  ('the EASYMORE_c
-0000c8c0: 6173 6520 6973 206e 6f74 2075 6e69 7175  ase is not uniqu
-0000c8d0: 6520 696e 2074 6865 2072 656d 6170 7069  e in the remappi
-0000c8e0: 6e67 2066 696c 6527 290a 2020 2020 2020  ng file').      
-0000c8f0: 2020 6966 206e 6f74 2028 6e70 2e75 6e69    if not (np.uni
-0000c900: 7175 6528 6e70 2e61 7272 6179 2872 656d  que(np.array(rem
-0000c910: 6170 5f64 665b 2765 6173 796d 6f72 655f  ap_df['easymore_
-0000c920: 6361 7365 275d 2929 203d 3d20 3120 6f72  case'])) == 1 or
-0000c930: 5c0a 2020 2020 2020 2020 6e70 2e75 6e69  \.        np.uni
-0000c940: 7175 6528 6e70 2e61 7272 6179 2872 656d  que(np.array(rem
-0000c950: 6170 5f64 665b 2765 6173 796d 6f72 655f  ap_df['easymore_
-0000c960: 6361 7365 275d 2929 203d 3d20 3220 6f72  case'])) == 2 or
-0000c970: 5c0a 2020 2020 2020 2020 6e70 2e75 6e69  \.        np.uni
-0000c980: 7175 6528 6e70 2e61 7272 6179 2872 656d  que(np.array(rem
-0000c990: 6170 5f64 665b 2765 6173 796d 6f72 655f  ap_df['easymore_
-0000c9a0: 6361 7365 275d 2929 203d 3d20 3329 3a0a  case'])) == 3):.
-0000c9b0: 2020 2020 2020 2020 2020 2020 7379 732e              sys.
-0000c9c0: 6578 6974 2827 4541 5359 4d4f 5245 2063  exit('EASYMORE c
-0000c9d0: 6173 6520 7368 6f75 6c64 2062 6520 6f6e  ase should be on
-0000c9e0: 6520 6f66 2031 2c20 3220 6f72 2033 3b20  e of 1, 2 or 3; 
-0000c9f0: 706c 6561 7365 2072 6566 6572 2074 6f20  please refer to 
-0000ca00: 7468 6520 646f 6375 6d65 6e74 6174 696f  the documentatio
-0000ca10: 6e27 290a 2020 2020 2020 2020 7365 6c66  n').        self
-0000ca20: 2e63 6173 6520 3d20 6e70 2e75 6e69 7175  .case = np.uniqu
-0000ca30: 6528 6e70 2e61 7272 6179 2872 656d 6170  e(np.array(remap
-0000ca40: 5f64 665b 2765 6173 796d 6f72 655f 6361  _df['easymore_ca
-0000ca50: 7365 275d 2929 0a20 2020 2020 2020 2023  se'])).        #
-0000ca60: 2063 6865 636b 2069 6620 7468 6520 6e65   check if the ne
-0000ca70: 6564 6564 2063 6f6c 756d 6e73 2061 7265  eded columns are
-0000ca80: 2065 7869 7374 696e 670a 2020 2020 2020   existing.      
-0000ca90: 2020 6966 206e 6f74 2073 6574 285b 2749    if not set(['I
-0000caa0: 445f 7427 2c27 6c61 745f 7427 2c27 6c6f  D_t','lat_t','lo
-0000cab0: 6e5f 7427 2c27 6f72 6465 725f 7427 2c27  n_t','order_t','
-0000cac0: 4944 5f73 272c 276c 6174 5f73 272c 276c  ID_s','lat_s','l
-0000cad0: 6f6e 5f73 272c 2777 6569 6768 7427 5d29  on_s','weight'])
-0000cae0: 203c 3d20 7365 7428 7265 6d61 705f 6466   <= set(remap_df
-0000caf0: 2e63 6f6c 756d 6e73 293a 0a20 2020 2020  .columns):.     
-0000cb00: 2020 2020 2020 2073 7973 2e65 7869 7428         sys.exit(
-0000cb10: 2770 726f 7669 6465 6420 7265 6d61 7070  'provided remapp
-0000cb20: 696e 6720 6669 6c65 2064 6f65 7320 6e6f  ing file does no
-0000cb30: 7420 6861 7665 206f 6e65 206f 6620 7468  t have one of th
-0000cb40: 6520 6e65 6564 6564 2066 6965 6c64 733a  e needed fields:
-0000cb50: 205c 6e27 2b5c 0a20 2020 2020 2020 2020   \n'+\.         
-0000cb60: 2020 2020 2020 2027 4944 5f74 2c20 6c61         'ID_t, la
-0000cb70: 745f 742c 206c 6f6e 5f74 2c20 6f72 6465  t_t, lon_t, orde
-0000cb80: 725f 742c 2049 445f 322c 206c 6174 5f73  r_t, ID_2, lat_s
-0000cb90: 2c20 6c6f 6e5f 732c 2077 6569 6768 7427  , lon_s, weight'
-0000cba0: 290a 0a20 2020 2064 6566 205f 5f74 6172  )..    def __tar
-0000cbb0: 6765 745f 6e63 5f63 7265 6174 696f 6e28  get_nc_creation(
-0000cbc0: 7365 6c66 293a 0a20 2020 2020 2020 2022  self):.        "
-0000cbd0: 2222 0a20 2020 2020 2020 2040 2061 7574  "".        @ aut
-0000cbe0: 686f 723a 2020 2020 2020 2020 2020 2020  hor:            
-0000cbf0: 2020 2020 2020 5368 6572 7661 6e20 4768        Shervan Gh
-0000cc00: 6172 6172 690a 2020 2020 2020 2020 4020  arari.        @ 
-0000cc10: 4769 7468 7562 3a20 2020 2020 2020 2020  Github:         
-0000cc20: 2020 2020 2020 2020 2068 7474 7073 3a2f           https:/
-0000cc30: 2f67 6974 6875 622e 636f 6d2f 5368 6572  /github.com/Sher
-0000cc40: 7661 6e47 6861 7261 7269 2f45 4153 594d  vanGharari/EASYM
-0000cc50: 4f52 450a 2020 2020 2020 2020 4020 6175  ORE.        @ au
-0000cc60: 7468 6f72 2773 2065 6d61 696c 2069 643a  thor's email id:
-0000cc70: 2020 2020 2020 2073 682e 6768 6172 6172         sh.gharar
-0000cc80: 6940 676d 6169 6c2e 636f 6d0a 2020 2020  i@gmail.com.    
-0000cc90: 2020 2020 4020 6c69 6365 6e73 653a 2020      @ license:  
-0000cca0: 2020 2020 2020 2020 2020 2020 2020 2047                 G
-0000ccb0: 4e55 2d47 504c 7633 0a20 2020 2020 2020  NU-GPLv3.       
-0000ccc0: 2054 6869 7320 6675 6e63 6974 6f6e 2072   This funciton r
-0000ccd0: 6561 6420 6469 6666 6572 656e 7420 6772  ead different gr
-0000cce0: 6964 7320 616e 6420 7375 6d20 7468 656d  ids and sum them
-0000ccf0: 2075 7020 6261 7365 6420 6f6e 2074 6865   up based on the
-0000cd00: 0a20 2020 2020 2020 2077 6569 6768 7420  .        weight 
-0000cd10: 7072 6f76 6964 6564 2074 6f20 6167 6772  provided to aggr
-0000cd20: 6567 6174 6520 7468 656d 206f 7665 7220  egate them over 
-0000cd30: 6120 6c61 7267 6572 2061 7265 610a 2020  a larger area.  
-0000cd40: 2020 2020 2020 2222 220a 2020 2020 2020        """.      
-0000cd50: 2020 7072 696e 7428 272d 2d2d 2d2d 2d52    print('------R
-0000cd60: 454d 4150 5049 4e47 2d2d 2d2d 2d2d 2729  EMAPPING------')
-0000cd70: 0a20 2020 2020 2020 2072 656d 6170 203d  .        remap =
-0000cd80: 2070 642e 7265 6164 5f63 7376 2873 656c   pd.read_csv(sel
-0000cd90: 662e 7265 6d61 705f 6373 7629 0a20 2020  f.remap_csv).   
-0000cda0: 2020 2020 2023 2063 7265 6174 696e 6720       # creating 
-0000cdb0: 7468 6520 7461 7267 6574 5f49 445f 6c61  the target_ID_la
-0000cdc0: 745f 6c6f 6e0a 2020 2020 2020 2020 7461  t_lon.        ta
-0000cdd0: 7267 6574 5f49 445f 6c61 745f 6c6f 6e20  rget_ID_lat_lon 
-0000cde0: 3d20 7064 2e44 6174 6146 7261 6d65 2829  = pd.DataFrame()
-0000cdf0: 0a20 2020 2020 2020 2074 6172 6765 745f  .        target_
-0000ce00: 4944 5f6c 6174 5f6c 6f6e 205b 2749 445f  ID_lat_lon ['ID_
-0000ce10: 7427 5d20 203d 2072 656d 6170 205b 2749  t']  = remap ['I
-0000ce20: 445f 7427 5d0a 2020 2020 2020 2020 7461  D_t'].        ta
-0000ce30: 7267 6574 5f49 445f 6c61 745f 6c6f 6e20  rget_ID_lat_lon 
-0000ce40: 5b27 6c61 745f 7427 5d20 3d20 7265 6d61  ['lat_t'] = rema
-0000ce50: 7020 5b27 6c61 745f 7427 5d0a 2020 2020  p ['lat_t'].    
-0000ce60: 2020 2020 7461 7267 6574 5f49 445f 6c61      target_ID_la
-0000ce70: 745f 6c6f 6e20 5b27 6c6f 6e5f 7427 5d20  t_lon ['lon_t'] 
-0000ce80: 3d20 7265 6d61 7020 5b27 6c6f 6e5f 7427  = remap ['lon_t'
-0000ce90: 5d0a 2020 2020 2020 2020 7461 7267 6574  ].        target
-0000cea0: 5f49 445f 6c61 745f 6c6f 6e20 5b27 6f72  _ID_lat_lon ['or
-0000ceb0: 6465 725f 7427 5d20 3d20 7265 6d61 7020  der_t'] = remap 
-0000cec0: 5b27 6f72 6465 725f 7427 5d0a 2020 2020  ['order_t'].    
-0000ced0: 2020 2020 7461 7267 6574 5f49 445f 6c61      target_ID_la
-0000cee0: 745f 6c6f 6e20 3d20 7461 7267 6574 5f49  t_lon = target_I
-0000cef0: 445f 6c61 745f 6c6f 6e2e 6472 6f70 5f64  D_lat_lon.drop_d
-0000cf00: 7570 6c69 6361 7465 7328 290a 2020 2020  uplicates().    
-0000cf10: 2020 2020 7461 7267 6574 5f49 445f 6c61      target_ID_la
-0000cf20: 745f 6c6f 6e20 3d20 7461 7267 6574 5f49  t_lon = target_I
-0000cf30: 445f 6c61 745f 6c6f 6e2e 736f 7274 5f76  D_lat_lon.sort_v
-0000cf40: 616c 7565 7328 6279 3d5b 276f 7264 6572  alues(by=['order
-0000cf50: 5f74 275d 290a 2020 2020 2020 2020 7461  _t']).        ta
-0000cf60: 7267 6574 5f49 445f 6c61 745f 6c6f 6e20  rget_ID_lat_lon 
-0000cf70: 3d20 7461 7267 6574 5f49 445f 6c61 745f  = target_ID_lat_
-0000cf80: 6c6f 6e2e 7265 7365 745f 696e 6465 7828  lon.reset_index(
-0000cf90: 6472 6f70 3d54 7275 6529 0a20 2020 2020  drop=True).     
-0000cfa0: 2020 2023 2070 7265 7061 7265 2074 6865     # prepare the
-0000cfb0: 2068 7275 5f69 6420 2868 6572 6520 434f   hru_id (here CO
-0000cfc0: 4d49 4429 2c20 6c61 742c 206c 6f6e 0a20  MID), lat, lon. 
-0000cfd0: 2020 2020 2020 2068 7275 4944 5f76 6172         hruID_var
-0000cfe0: 203d 206e 702e 6172 7261 7928 7461 7267   = np.array(targ
-0000cff0: 6574 5f49 445f 6c61 745f 6c6f 6e5b 2749  et_ID_lat_lon['I
-0000d000: 445f 7427 5d29 0a20 2020 2020 2020 2068  D_t']).        h
-0000d010: 7275 4944 5f6c 6174 203d 206e 702e 6172  ruID_lat = np.ar
-0000d020: 7261 7928 7461 7267 6574 5f49 445f 6c61  ray(target_ID_la
-0000d030: 745f 6c6f 6e5b 276c 6174 5f74 275d 290a  t_lon['lat_t']).
-0000d040: 2020 2020 2020 2020 6872 7549 445f 6c6f          hruID_lo
-0000d050: 6e20 3d20 6e70 2e61 7272 6179 2874 6172  n = np.array(tar
-0000d060: 6765 745f 4944 5f6c 6174 5f6c 6f6e 5b27  get_ID_lat_lon['
-0000d070: 6c6f 6e5f 7427 5d29 0a20 2020 2020 2020  lon_t']).       
-0000d080: 2023 0a20 2020 2020 2020 2073 656c 662e   #.        self.
-0000d090: 726f 7773 203d 206e 702e 6172 7261 7928  rows = np.array(
-0000d0a0: 7265 6d61 705b 2772 6f77 7327 5d29 2e61  remap['rows']).a
-0000d0b0: 7374 7970 6528 696e 7429 0a20 2020 2020  stype(int).     
-0000d0c0: 2020 2073 656c 662e 636f 6c73 203d 206e     self.cols = n
-0000d0d0: 702e 6172 7261 7928 7265 6d61 705b 2763  p.array(remap['c
-0000d0e0: 6f6c 7327 5d29 2e61 7374 7970 6528 696e  ols']).astype(in
-0000d0f0: 7429 0a20 2020 2020 2020 2073 656c 662e  t).        self.
-0000d100: 6e75 6d62 6572 5f6f 665f 7461 7267 6574  number_of_target
-0000d110: 5f65 6c65 6d65 6e74 7320 3d20 6c65 6e28  _elements = len(
-0000d120: 6872 7549 445f 7661 7229 0a20 2020 2020  hruID_var).     
-0000d130: 2020 2023 0a20 2020 2020 2020 206e 635f     #.        nc_
-0000d140: 6e61 6d65 7320 3d20 676c 6f62 2e67 6c6f  names = glob.glo
-0000d150: 6228 7365 6c66 2e73 6f75 7263 655f 6e63  b(self.source_nc
-0000d160: 290a 2020 2020 2020 2020 6e63 5f6e 616d  ).        nc_nam
-0000d170: 6573 203d 2073 6f72 7465 6428 6e63 5f6e  es = sorted(nc_n
-0000d180: 616d 6573 290a 2020 2020 2020 2020 2320  ames).        # 
-0000d190: 6368 6563 6b20 636f 6d70 7265 7373 696f  check compressio
-0000d1a0: 6e20 6368 6f69 6365 0a20 2020 2020 2020  n choice.       
-0000d1b0: 2069 6620 6973 696e 7374 616e 6365 2873   if isinstance(s
-0000d1c0: 656c 662e 636f 6d70 6c65 7665 6c2c 2069  elf.complevel, i
-0000d1d0: 6e74 2920 616e 6420 2873 656c 662e 636f  nt) and (self.co
-0000d1e0: 6d70 6c65 7665 6c20 3e3d 3129 2061 6e64  mplevel >=1) and
-0000d1f0: 2028 7365 6c66 2e63 6f6d 706c 6576 656c   (self.complevel
-0000d200: 3c3d 3929 3a0a 2020 2020 2020 2020 2020  <=9):.          
-0000d210: 2020 636f 6d70 666c 6167 203d 2054 7275    compflag = Tru
-0000d220: 650a 2020 2020 2020 2020 2020 2020 636f  e.            co
-0000d230: 6d70 6c65 7665 6c20 3d20 7365 6c66 2e63  mplevel = self.c
-0000d240: 6f6d 706c 6576 656c 0a20 2020 2020 2020  omplevel.       
-0000d250: 2020 2020 2070 7269 6e74 2827 6e65 7463       print('netc
-0000d260: 6466 206f 7574 7075 7420 6669 6c65 2077  df output file w
-0000d270: 696c 6c20 6265 2063 6f6d 7072 6573 7365  ill be compresse
-0000d280: 6420 6174 206c 6576 656c 272c 2063 6f6d  d at level', com
-0000d290: 706c 6576 656c 290a 2020 2020 2020 2020  plevel).        
-0000d2a0: 656c 7365 3a0a 2020 2020 2020 2020 2020  else:.          
-0000d2b0: 2020 636f 6d70 666c 6167 203d 2046 616c    compflag = Fal
-0000d2c0: 7365 0a20 2020 2020 2020 2020 2020 2063  se.            c
-0000d2d0: 6f6d 706c 6576 656c 203d 2030 0a20 2020  omplevel = 0.   
-0000d2e0: 2020 2020 2020 2020 2070 7269 6e74 2827           print('
-0000d2f0: 6e65 7463 6466 206f 7574 7075 7420 6669  netcdf output fi
-0000d300: 6c65 2077 696c 6c20 6e6f 7420 6265 2063  le will not be c
-0000d310: 6f6d 7072 6573 7365 642e 2729 0a20 2020  ompressed.').   
-0000d320: 2020 2020 2066 6f72 206e 635f 6e61 6d65       for nc_name
-0000d330: 2069 6e20 6e63 5f6e 616d 6573 3a0a 2020   in nc_names:.  
-0000d340: 2020 2020 2020 2020 2020 2320 6765 7420            # get 
-0000d350: 7468 6520 7469 6d65 2075 6e69 7420 616e  the time unit an
-0000d360: 6420 7469 6d65 2076 6172 2066 726f 6d20  d time var from 
-0000d370: 736f 7572 6365 0a20 2020 2020 2020 2020  source.         
-0000d380: 2020 206e 6369 6473 203d 206e 6334 2e44     ncids = nc4.D
-0000d390: 6174 6173 6574 286e 635f 6e61 6d65 290a  ataset(nc_name).
-0000d3a0: 2020 2020 2020 2020 2020 2020 2320 4368              # Ch
-0000d3b0: 6563 6b20 6461 7461 206c 6963 656e 7365  eck data license
-0000d3c0: 2c20 6361 6c65 6e64 6172 2061 6e64 2074  , calendar and t
-0000d3d0: 696d 6520 756e 6974 730a 2020 2020 2020  ime units.      
-0000d3e0: 2020 2020 2020 6e63 5f61 7474 5f6c 6973        nc_att_lis
-0000d3f0: 7420 3d20 6e63 6964 732e 6e63 6174 7472  t = ncids.ncattr
-0000d400: 7328 290a 2020 2020 2020 2020 2020 2020  s().            
-0000d410: 6e63 5f61 7474 5f6c 6973 7420 3d20 5b65  nc_att_list = [e
-0000d420: 6163 685f 6174 7420 666f 7220 6561 6368  ach_att for each
-0000d430: 5f61 7474 2069 6e20 6e63 5f61 7474 5f6c  _att in nc_att_l
-0000d440: 6973 745d 0a20 2020 2020 2020 2020 2020  ist].           
-0000d450: 206e 635f 6174 745f 6c69 7374 5f6c 6f77   nc_att_list_low
-0000d460: 6572 203d 205b 6561 6368 5f61 7474 2e6c  er = [each_att.l
-0000d470: 6f77 6572 2829 2066 6f72 2065 6163 685f  ower() for each_
-0000d480: 6174 7420 696e 206e 635f 6174 745f 6c69  att in nc_att_li
-0000d490: 7374 5d0a 2020 2020 2020 2020 2020 2020  st].            
-0000d4a0: 6966 2073 656c 662e 6c69 6365 6e73 6520  if self.license 
-0000d4b0: 3d3d 2027 2720 616e 6420 2827 6c69 6365  == '' and ('lice
-0000d4c0: 6e73 6527 206e 6f74 2069 6e20 6e63 5f61  nse' not in nc_a
-0000d4d0: 7474 5f6c 6973 745f 6c6f 7765 7229 3a0a  tt_list_lower):.
-0000d4e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000d4f0: 7365 6c66 2e6c 6963 656e 7365 203d 3d20  self.license == 
-0000d500: 2774 6865 206f 7269 6769 6e61 6c20 6c69  'the original li
-0000d510: 6365 6e73 6520 6f66 2074 6865 2073 6f75  cense of the sou
-0000d520: 7263 6520 4e65 7443 4446 2066 696c 6520  rce NetCDF file 
-0000d530: 6973 206e 6f74 2070 726f 7669 6465 6427  is not provided'
-0000d540: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
-0000d550: 2827 6c69 6365 6e73 6527 2069 6e20 6e63  ('license' in nc
-0000d560: 5f61 7474 5f6c 6973 745f 6c6f 7765 7229  _att_list_lower)
-0000d570: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-0000d580: 2020 6966 2027 6c69 6365 6e73 6527 2069    if 'license' i
-0000d590: 6e20 6e63 5f61 7474 5f6c 6973 743a 0a20  n nc_att_list:. 
-0000d5a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000d5b0: 2020 2073 656c 662e 6c69 6365 6e73 6520     self.license 
-0000d5c0: 3d3d 2067 6574 6174 7472 286e 6369 6473  == getattr(ncids
-0000d5d0: 2c20 276c 6963 656e 7365 2729 0a20 2020  , 'license').   
-0000d5e0: 2020 2020 2020 2020 2020 2020 2069 6620               if 
-0000d5f0: 274c 6963 656e 7365 2720 696e 206e 635f  'License' in nc_
-0000d600: 6174 745f 6c69 7374 3a0a 2020 2020 2020  att_list:.      
-0000d610: 2020 2020 2020 2020 2020 2020 2020 7365                se
-0000d620: 6c66 2e6c 6963 656e 7365 203d 3d20 6765  lf.license == ge
-0000d630: 7461 7474 7228 6e63 6964 732c 2027 4c69  tattr(ncids, 'Li
-0000d640: 6365 6e73 6527 290a 2020 2020 2020 2020  cense').        
-0000d650: 2020 2020 2020 2020 6966 2027 4c49 4345          if 'LICE
-0000d660: 4e53 4527 2069 6e20 6e63 5f61 7474 5f6c  NSE' in nc_att_l
-0000d670: 6973 743a 0a20 2020 2020 2020 2020 2020  ist:.           
-0000d680: 2020 2020 2020 2020 2073 656c 662e 6c69           self.li
-0000d690: 6365 6e73 6520 3d3d 2067 6574 6174 7472  cense == getattr
-0000d6a0: 286e 6369 6473 2c20 274c 4943 454e 5345  (ncids, 'LICENSE
-0000d6b0: 2729 0a20 2020 2020 2020 2020 2020 2020  ').             
-0000d6c0: 2020 2073 656c 662e 6c69 6365 6e73 6520     self.license 
-0000d6d0: 3d3d 2027 4f72 6967 696e 616c 2064 6174  == 'Original dat
-0000d6e0: 6120 6c69 6365 6e73 6520 272b 7365 6c66  a license '+self
-0000d6f0: 2e6c 6963 656e 7365 0a20 2020 2020 2020  .license.       
-0000d700: 2020 2020 2069 6620 2775 6e69 7473 2720       if 'units' 
-0000d710: 696e 206e 6369 6473 2e76 6172 6961 626c  in ncids.variabl
-0000d720: 6573 5b73 656c 662e 7661 725f 7469 6d65  es[self.var_time
-0000d730: 5d2e 6e63 6174 7472 7328 293a 0a20 2020  ].ncattrs():.   
-0000d740: 2020 2020 2020 2020 2020 2020 2074 696d               tim
-0000d750: 655f 756e 6974 203d 206e 6369 6473 2e76  e_unit = ncids.v
-0000d760: 6172 6961 626c 6573 5b73 656c 662e 7661  ariables[self.va
-0000d770: 725f 7469 6d65 5d2e 756e 6974 730a 2020  r_time].units.  
-0000d780: 2020 2020 2020 2020 2020 656c 7365 3a0a            else:.
-0000d790: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000d7a0: 7379 732e 6578 6974 2827 756e 6974 7320  sys.exit('units 
-0000d7b0: 6973 206e 6f74 2070 726f 7669 6465 6420  is not provided 
-0000d7c0: 666f 7220 7468 6520 7469 6d65 2076 6172  for the time var
-0000d7d0: 6962 616c 6520 666f 7220 736f 7572 6365  ibale for source
-0000d7e0: 204e 6574 4344 4620 6f66 272b 206e 635f   NetCDF of'+ nc_
-0000d7f0: 6e61 6d65 290a 2020 2020 2020 2020 2020  name).          
-0000d800: 2020 6966 2027 6361 6c65 6e64 6172 2720    if 'calendar' 
-0000d810: 696e 206e 6369 6473 2e76 6172 6961 626c  in ncids.variabl
-0000d820: 6573 5b73 656c 662e 7661 725f 7469 6d65  es[self.var_time
-0000d830: 5d2e 6e63 6174 7472 7328 293a 0a20 2020  ].ncattrs():.   
-0000d840: 2020 2020 2020 2020 2020 2020 2074 696d               tim
-0000d850: 655f 6361 6c20 3d20 6e63 6964 732e 7661  e_cal = ncids.va
-0000d860: 7269 6162 6c65 735b 7365 6c66 2e76 6172  riables[self.var
-0000d870: 5f74 696d 655d 2e63 616c 656e 6461 720a  _time].calendar.
-0000d880: 2020 2020 2020 2020 2020 2020 656c 7365              else
-0000d890: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-0000d8a0: 2020 7379 732e 6578 6974 2827 6361 6c65    sys.exit('cale
-0000d8b0: 6e64 6172 2069 7320 6e6f 7420 7072 6f76  ndar is not prov
-0000d8c0: 6964 6564 2066 6f72 2074 6865 2074 696d  ided for the tim
-0000d8d0: 6520 7661 7269 6261 6c65 2066 6f72 2073  e varibale for s
-0000d8e0: 6f75 7263 6520 4e65 7443 4446 206f 6627  ource NetCDF of'
-0000d8f0: 2b20 6e63 5f6e 616d 6529 0a20 2020 2020  + nc_name).     
-0000d900: 2020 2020 2020 2074 696d 655f 7661 7220         time_var 
-0000d910: 3d20 6e63 6964 735b 7365 6c66 2e76 6172  = ncids[self.var
-0000d920: 5f74 696d 655d 5b3a 5d0a 2020 2020 2020  _time][:].      
-0000d930: 2020 2020 2020 7365 6c66 2e6c 656e 6774        self.lengt
-0000d940: 685f 6f66 5f74 696d 6520 3d20 6c65 6e28  h_of_time = len(
-0000d950: 7469 6d65 5f76 6172 290a 2020 2020 2020  time_var).      
-0000d960: 2020 2020 2020 7461 7267 6574 5f64 6174        target_dat
-0000d970: 655f 7469 6d65 7320 3d20 6e63 342e 6e75  e_times = nc4.nu
-0000d980: 6d32 6461 7465 2874 696d 655f 7661 722c  m2date(time_var,
-0000d990: 756e 6974 7320 3d20 7469 6d65 5f75 6e69  units = time_uni
-0000d9a0: 742c 6361 6c65 6e64 6172 203d 2074 696d  t,calendar = tim
-0000d9b0: 655f 6361 6c29 0a20 2020 2020 2020 2020  e_cal).         
-0000d9c0: 2020 2074 6172 6765 745f 6e61 6d65 203d     target_name =
-0000d9d0: 2073 656c 662e 6f75 7470 7574 5f64 6972   self.output_dir
-0000d9e0: 202b 2073 656c 662e 6361 7365 5f6e 616d   + self.case_nam
-0000d9f0: 6520 2b20 275f 7265 6d61 7070 6564 5f27  e + '_remapped_'
-0000da00: 202b 2074 6172 6765 745f 6461 7465 5f74   + target_date_t
-0000da10: 696d 6573 5b30 5d2e 7374 7266 7469 6d65  imes[0].strftime
-0000da20: 2822 2559 2d25 6d2d 2564 2d25 482d 254d  ("%Y-%m-%d-%H-%M
-0000da30: 2d25 5322 292b 272e 6e63 270a 2020 2020  -%S")+'.nc'.    
-0000da40: 2020 2020 2020 2020 6966 206f 732e 7061          if os.pa
-0000da50: 7468 2e65 7869 7374 7328 7461 7267 6574  th.exists(target
-0000da60: 5f6e 616d 6529 3a0a 2020 2020 2020 2020  _name):.        
-0000da70: 2020 2020 2020 2020 6966 2073 656c 662e          if self.
-0000da80: 6f76 6572 7772 6974 655f 6578 6973 7469  overwrite_existi
-0000da90: 6e67 5f72 656d 6170 3a0a 2020 2020 2020  ng_remap:.      
+0000bde0: 2020 2020 2020 2020 2020 202b 6466 5b27             +df['
+0000bdf0: 4c61 745f 4327 5d29 2f32 0a20 2020 2020  Lat_C'])/2.     
+0000be00: 2020 2064 665b 2750 6f69 6e74 5f4c 6174     df['Point_Lat
+0000be10: 5f55 705f 5269 6768 7427 5d20 203d 2028  _Up_Right']  = (
+0000be20: 6466 5b27 4c61 745f 5570 5f52 6967 6874  df['Lat_Up_Right
+0000be30: 275d 2020 2b64 665b 274c 6174 5f55 7027  ']  +df['Lat_Up'
+0000be40: 5d20 202b 6466 5b27 4c61 745f 5269 6768  ]  +df['Lat_Righ
+0000be50: 7427 5d20 202b 6466 5b27 4c61 745f 4327  t']  +df['Lat_C'
+0000be60: 5d29 2f34 0a20 2020 2020 2020 2064 665b  ])/4.        df[
+0000be70: 2750 6f69 6e74 5f4c 6174 5f55 7027 5d20  'Point_Lat_Up'] 
+0000be80: 2020 2020 2020 203d 2028 6466 5b27 4c61         = (df['La
+0000be90: 745f 5570 275d 2020 2020 2020 2020 2020  t_Up']          
+0000bea0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000beb0: 2020 2020 2020 2020 2020 2020 2020 202b                 +
+0000bec0: 6466 5b27 4c61 745f 4327 5d29 2f32 0a20  df['Lat_C'])/2. 
+0000bed0: 2020 2020 2020 2064 665b 2750 6f69 6e74         df['Point
+0000bee0: 5f4c 6f6e 5f55 705f 4c65 6674 275d 2020  _Lon_Up_Left']  
+0000bef0: 203d 2028 6466 5b27 4c6f 6e5f 5570 5f4c   = (df['Lon_Up_L
+0000bf00: 6566 7427 5d20 2020 2b64 665b 274c 6f6e  eft']   +df['Lon
+0000bf10: 5f55 7027 5d20 202b 6466 5b27 4c6f 6e5f  _Up']  +df['Lon_
+0000bf20: 4c65 6674 275d 2020 202b 6466 5b27 4c6f  Left']   +df['Lo
+0000bf30: 6e5f 4327 5d29 2f34 0a20 2020 2020 2020  n_C'])/4.       
+0000bf40: 2064 665b 2750 6f69 6e74 5f4c 6f6e 5f4c   df['Point_Lon_L
+0000bf50: 6566 7427 5d20 2020 2020 203d 2028 6466  eft']      = (df
+0000bf60: 5b27 4c6f 6e5f 4c65 6674 275d 2020 2020  ['Lon_Left']    
+0000bf70: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000bf80: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000bf90: 2020 202b 6466 5b27 4c6f 6e5f 4327 5d29     +df['Lon_C'])
+0000bfa0: 2f32 0a20 2020 2020 2020 2064 665b 2750  /2.        df['P
+0000bfb0: 6f69 6e74 5f4c 6f6e 5f4c 6f77 5f4c 6566  oint_Lon_Low_Lef
+0000bfc0: 7427 5d20 203d 2028 6466 5b27 4c6f 6e5f  t']  = (df['Lon_
+0000bfd0: 4c6f 775f 4c65 6674 275d 2020 2b64 665b  Low_Left']  +df[
+0000bfe0: 274c 6f6e 5f4c 6f77 275d 202b 6466 5b27  'Lon_Low'] +df['
+0000bff0: 4c6f 6e5f 4c65 6674 275d 2020 202b 6466  Lon_Left']   +df
+0000c000: 5b27 4c6f 6e5f 4327 5d29 2f34 0a20 2020  ['Lon_C'])/4.   
+0000c010: 2020 2020 2064 665b 2750 6f69 6e74 5f4c       df['Point_L
+0000c020: 6f6e 5f4c 6f77 275d 2020 2020 2020 203d  on_Low']       =
+0000c030: 2028 6466 5b27 4c6f 6e5f 4c6f 7727 5d20   (df['Lon_Low'] 
+0000c040: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000c050: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000c060: 2020 2020 2020 202b 6466 5b27 4c6f 6e5f         +df['Lon_
+0000c070: 4327 5d29 2f32 0a20 2020 2020 2020 2064  C'])/2.        d
+0000c080: 665b 2750 6f69 6e74 5f4c 6f6e 5f4c 6f77  f['Point_Lon_Low
+0000c090: 5f52 6967 6874 275d 203d 2028 6466 5b27  _Right'] = (df['
+0000c0a0: 4c6f 6e5f 4c6f 775f 5269 6768 7427 5d20  Lon_Low_Right'] 
+0000c0b0: 2b64 665b 274c 6f6e 5f4c 6f77 275d 202b  +df['Lon_Low'] +
+0000c0c0: 6466 5b27 4c6f 6e5f 5269 6768 7427 5d20  df['Lon_Right'] 
+0000c0d0: 202b 6466 5b27 4c6f 6e5f 4327 5d29 2f34   +df['Lon_C'])/4
+0000c0e0: 0a20 2020 2020 2020 2064 665b 2750 6f69  .        df['Poi
+0000c0f0: 6e74 5f4c 6f6e 5f52 6967 6874 275d 2020  nt_Lon_Right']  
+0000c100: 2020 203d 2028 6466 5b27 4c6f 6e5f 5269     = (df['Lon_Ri
+0000c110: 6768 7427 5d20 2020 2020 2020 2020 2020  ght']           
+0000c120: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000c130: 2020 2020 2020 2020 2020 202b 6466 5b27             +df['
+0000c140: 4c6f 6e5f 4327 5d29 2f32 0a20 2020 2020  Lon_C'])/2.     
+0000c150: 2020 2064 665b 2750 6f69 6e74 5f4c 6f6e     df['Point_Lon
+0000c160: 5f55 705f 5269 6768 7427 5d20 203d 2028  _Up_Right']  = (
+0000c170: 6466 5b27 4c6f 6e5f 5570 5f52 6967 6874  df['Lon_Up_Right
+0000c180: 275d 2020 2b64 665b 274c 6f6e 5f55 7027  ']  +df['Lon_Up'
+0000c190: 5d20 202b 6466 5b27 4c6f 6e5f 5269 6768  ]  +df['Lon_Righ
+0000c1a0: 7427 5d20 202b 6466 5b27 4c6f 6e5f 4327  t']  +df['Lon_C'
+0000c1b0: 5d29 2f34 0a20 2020 2020 2020 2064 665b  ])/4.        df[
+0000c1c0: 2750 6f69 6e74 5f4c 6f6e 5f55 7027 5d20  'Point_Lon_Up'] 
+0000c1d0: 2020 2020 2020 203d 2028 6466 5b27 4c6f         = (df['Lo
+0000c1e0: 6e5f 5570 275d 2020 2020 2020 2020 2020  n_Up']          
+0000c1f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000c200: 2020 2020 2020 2020 2020 2020 2020 202b                 +
+0000c210: 6466 5b27 4c6f 6e5f 4327 5d29 2f32 0a0a  df['Lon_C'])/2..
+0000c220: 2020 2020 2020 2020 2320 696e 6e65 7220          # inner 
+0000c230: 6675 6e63 7469 6f6e 2074 6f20 6372 6561  function to crea
+0000c240: 7465 2074 6865 2067 7269 6420 706f 6c79  te the grid poly
+0000c250: 676f 6e73 0a20 2020 2020 2020 2064 6566  gons.        def
+0000c260: 206d 616b 655f 706f 6c79 676f 6e28 726f   make_polygon(ro
+0000c270: 7729 3a0a 2020 2020 2020 2020 2020 2020  w):.            
+0000c280: 636f 6f72 6473 203d 205b 2872 6f77 5b22  coords = [(row["
+0000c290: 506f 696e 745f 4c6f 6e5f 5570 225d 2020  Point_Lon_Up"]  
+0000c2a0: 2020 2020 2020 2c20 726f 775b 2250 6f69        , row["Poi
+0000c2b0: 6e74 5f4c 6174 5f55 7022 5d29 2c20 5c0a  nt_Lat_Up"]), \.
+0000c2c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000c2d0: 2020 2020 2020 2872 6f77 5b22 506f 696e        (row["Poin
+0000c2e0: 745f 4c6f 6e5f 5570 5f52 6967 6874 225d  t_Lon_Up_Right"]
+0000c2f0: 2020 2c20 726f 775b 2250 6f69 6e74 5f4c    , row["Point_L
+0000c300: 6174 5f55 705f 5269 6768 7422 5d29 2c20  at_Up_Right"]), 
+0000c310: 5c0a 2020 2020 2020 2020 2020 2020 2020  \.              
+0000c320: 2020 2020 2020 2020 2872 6f77 5b22 506f          (row["Po
+0000c330: 696e 745f 4c6f 6e5f 5269 6768 7422 5d20  int_Lon_Right"] 
+0000c340: 2020 2020 2c20 726f 775b 2250 6f69 6e74      , row["Point
+0000c350: 5f4c 6174 5f52 6967 6874 225d 292c 205c  _Lat_Right"]), \
+0000c360: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0000c370: 2020 2020 2020 2028 726f 775b 2250 6f69         (row["Poi
+0000c380: 6e74 5f4c 6f6e 5f4c 6f77 5f52 6967 6874  nt_Lon_Low_Right
+0000c390: 225d 202c 2072 6f77 5b22 506f 696e 745f  "] , row["Point_
+0000c3a0: 4c61 745f 4c6f 775f 5269 6768 7422 5d29  Lat_Low_Right"])
+0000c3b0: 2c20 5c0a 2020 2020 2020 2020 2020 2020  , \.            
+0000c3c0: 2020 2020 2020 2020 2020 2872 6f77 5b22            (row["
+0000c3d0: 506f 696e 745f 4c6f 6e5f 4c6f 7722 5d20  Point_Lon_Low"] 
+0000c3e0: 2020 2020 2020 2c20 726f 775b 2250 6f69        , row["Poi
+0000c3f0: 6e74 5f4c 6174 5f4c 6f77 225d 292c 205c  nt_Lat_Low"]), \
+0000c400: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0000c410: 2020 2020 2020 2028 726f 775b 2250 6f69         (row["Poi
+0000c420: 6e74 5f4c 6f6e 5f4c 6f77 5f4c 6566 7422  nt_Lon_Low_Left"
+0000c430: 5d20 202c 2072 6f77 5b22 506f 696e 745f  ]  , row["Point_
+0000c440: 4c61 745f 4c6f 775f 4c65 6674 225d 292c  Lat_Low_Left"]),
+0000c450: 205c 0a20 2020 2020 2020 2020 2020 2020   \.             
+0000c460: 2020 2020 2020 2020 2028 726f 775b 2250           (row["P
+0000c470: 6f69 6e74 5f4c 6f6e 5f4c 6566 7422 5d20  oint_Lon_Left"] 
+0000c480: 2020 2020 202c 2072 6f77 5b22 506f 696e       , row["Poin
+0000c490: 745f 4c61 745f 4c65 6674 225d 292c 205c  t_Lat_Left"]), \
+0000c4a0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0000c4b0: 2020 2020 2020 2028 726f 775b 2250 6f69         (row["Poi
+0000c4c0: 6e74 5f4c 6f6e 5f55 705f 4c65 6674 225d  nt_Lon_Up_Left"]
+0000c4d0: 2020 202c 2072 6f77 5b22 506f 696e 745f     , row["Point_
+0000c4e0: 4c61 745f 5570 5f4c 6566 7422 5d29 2c20  Lat_Up_Left"]), 
+0000c4f0: 5c0a 2020 2020 2020 2020 2020 2020 2020  \.              
+0000c500: 2020 2020 2020 2020 2872 6f77 5b22 506f          (row["Po
+0000c510: 696e 745f 4c6f 6e5f 5570 225d 2020 2020  int_Lon_Up"]    
+0000c520: 2020 2020 2c20 726f 775b 2250 6f69 6e74      , row["Point
+0000c530: 5f4c 6174 5f55 7022 5d29 5d0a 2020 2020  _Lat_Up"])].    
+0000c540: 2020 2020 2020 2020 7265 7475 726e 2050          return P
+0000c550: 6f6c 7967 6f6e 2863 6f6f 7264 7329 0a0a  olygon(coords)..
+0000c560: 2020 2020 2020 2020 2320 4372 6561 7465          # Create
+0000c570: 2061 206e 6577 2063 6f6c 756d 6e20 2267   a new column "g
+0000c580: 656f 6d65 7472 7922 2069 6e20 7468 6520  eometry" in the 
+0000c590: 4461 7461 4672 616d 6520 636f 6e74 6169  DataFrame contai
+0000c5a0: 6e69 6e67 2050 6f6c 7967 6f6e 730a 2020  ning Polygons.  
+0000c5b0: 2020 2020 2020 6466 5b22 6765 6f6d 6574        df["geomet
+0000c5c0: 7279 225d 203d 2064 662e 6170 706c 7928  ry"] = df.apply(
+0000c5d0: 6d61 6b65 5f70 6f6c 7967 6f6e 2c20 6178  make_polygon, ax
+0000c5e0: 6973 3d31 290a 2020 2020 2020 2020 6466  is=1).        df
+0000c5f0: 203d 2064 662e 6c6f 635b 3a2c 205b 2767   = df.loc[:, ['g
+0000c600: 656f 6d65 7472 7927 2c20 274c 6174 5f43  eometry', 'Lat_C
+0000c610: 272c 2027 4c6f 6e5f 4327 5d5d 0a20 2020  ', 'Lon_C']].   
+0000c620: 2020 2020 2064 6620 5b27 4944 5f73 275d       df ['ID_s']
+0000c630: 203d 206e 702e 6172 616e 6765 286c 656e   = np.arange(len
+0000c640: 2864 6629 292b 310a 2020 2020 2020 2020  (df))+1.        
+0000c650: 6466 203d 2064 662e 7265 6e61 6d65 2863  df = df.rename(c
+0000c660: 6f6c 756d 6e73 3d7b 274c 6174 5f43 273a  olumns={'Lat_C':
+0000c670: 2027 6c61 745f 7327 2c0a 2020 2020 2020   'lat_s',.      
+0000c680: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000c690: 2020 2020 2020 2020 2020 274c 6f6e 5f43            'Lon_C
+0000c6a0: 273a 2027 6c6f 6e5f 7327 7d29 0a20 2020  ': 'lon_s'}).   
+0000c6b0: 2020 2020 2023 2074 6f20 6765 6f64 6174       # to geodat
+0000c6c0: 6166 7261 6d65 0a20 2020 2020 2020 2067  aframe.        g
+0000c6d0: 6466 203d 2067 7064 2e47 656f 4461 7461  df = gpd.GeoData
+0000c6e0: 4672 616d 6528 6466 2c20 6765 6f6d 6574  Frame(df, geomet
+0000c6f0: 7279 3d22 6765 6f6d 6574 7279 2229 0a20  ry="geometry"). 
+0000c700: 2020 2020 2020 2023 2061 7373 696e 696e         # assinin
+0000c710: 6720 7468 6520 6372 730a 2020 2020 2020  g the crs.      
+0000c720: 2020 6966 2063 7273 3a0a 2020 2020 2020    if crs:.      
+0000c730: 2020 2020 2020 6764 6620 3d20 6764 662e        gdf = gdf.
+0000c740: 7365 745f 6372 7328 6372 7329 0a20 2020  set_crs(crs).   
+0000c750: 2020 2020 2023 2073 6176 696e 6720 7468       # saving th
+0000c760: 6520 6669 6c65 2069 6620 6669 6c65 5f6e  e file if file_n
+0000c770: 616d 6520 6973 2070 726f 7669 6465 640a  ame is provided.
+0000c780: 2020 2020 2020 2020 6966 2066 696c 655f          if file_
+0000c790: 6e61 6d65 3a0a 2020 2020 2020 2020 2020  name:.          
+0000c7a0: 2020 6764 662e 746f 5f66 696c 6528 6669    gdf.to_file(fi
+0000c7b0: 6c65 5f6e 616d 6529 0a20 2020 2020 2020  le_name).       
+0000c7c0: 2072 6574 7572 6e20 6764 660a 0a0a 0a0a   return gdf.....
+0000c7d0: 2020 2020 6465 6620 6164 645f 6c61 745f      def add_lat_
+0000c7e0: 6c6f 6e5f 736f 7572 6365 5f53 4850 2820  lon_source_SHP( 
+0000c7f0: 7365 6c66 2c0a 2020 2020 2020 2020 2020  self,.          
+0000c800: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000c810: 2020 2020 2020 7368 702c 0a20 2020 2020        shp,.     
+0000c820: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000c830: 2020 2020 2020 2020 2020 2073 6f75 7263             sourc
+0000c840: 655f 7368 705f 6c61 742c 0a20 2020 2020  e_shp_lat,.     
+0000c850: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000c860: 2020 2020 2020 2020 2020 2073 6f75 7263             sourc
+0000c870: 655f 7368 705f 6c6f 6e2c 0a20 2020 2020  e_shp_lon,.     
+0000c880: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000c890: 2020 2020 2020 2020 2020 2073 6f75 7263             sourc
+0000c8a0: 655f 7368 705f 4944 293a 0a20 2020 2020  e_shp_ID):.     
+0000c8b0: 2020 2022 2222 0a20 2020 2020 2020 2040     """.        @
+0000c8c0: 2061 7574 686f 723a 2020 2020 2020 2020   author:        
+0000c8d0: 2020 2020 2020 2020 2020 5368 6572 7661            Sherva
+0000c8e0: 6e20 4768 6172 6172 690a 2020 2020 2020  n Gharari.      
+0000c8f0: 2020 4020 4769 7468 7562 3a20 2020 2020    @ Github:     
+0000c900: 2020 2020 2020 2020 2020 2020 2068 7474               htt
+0000c910: 7073 3a2f 2f67 6974 6875 622e 636f 6d2f  ps://github.com/
+0000c920: 5368 6572 7661 6e47 6861 7261 7269 2f45  ShervanGharari/E
+0000c930: 4153 594d 4f52 450a 2020 2020 2020 2020  ASYMORE.        
+0000c940: 4020 6175 7468 6f72 2773 2065 6d61 696c  @ author's email
+0000c950: 2069 643a 2020 2020 2020 2073 682e 6768   id:       sh.gh
+0000c960: 6172 6172 6940 676d 6169 6c2e 636f 6d0a  arari@gmail.com.
+0000c970: 2020 2020 2020 2020 4020 6c69 6365 6e73          @ licens
+0000c980: 653a 2020 2020 2020 2020 2020 2020 2020  e:              
+0000c990: 2020 2047 4e55 2d47 504c 7633 0a20 2020     GNU-GPLv3.   
+0000c9a0: 2020 2020 2054 6869 7320 6675 6e63 7469       This functi
+0000c9b0: 6f6e 2061 6464 206c 6174 2c20 6c6f 6e20  on add lat, lon 
+0000c9c0: 616e 6420 4944 2066 726f 6d20 7468 6520  and ID from the 
+0000c9d0: 736f 7572 6365 2073 6861 7065 6669 6c65  source shapefile
+0000c9e0: 2069 6620 7072 6f76 6964 6564 0a20 2020   if provided.   
+0000c9f0: 2020 2020 2041 7267 756d 656e 7473 0a20       Arguments. 
+0000ca00: 2020 2020 2020 202d 2d2d 2d2d 2d2d 2d2d         ---------
+0000ca10: 0a20 2020 2020 2020 2073 6870 3a20 6765  .        shp: ge
+0000ca20: 6f64 6174 6166 7261 6d65 206f 6620 736f  odataframe of so
+0000ca30: 7572 6365 2073 6861 7065 6669 6c65 0a20  urce shapefile. 
+0000ca40: 2020 2020 2020 2073 6f75 7263 655f 7368         source_sh
+0000ca50: 705f 6c61 743a 2073 7472 696e 672c 2074  p_lat: string, t
+0000ca60: 6865 206e 616d 6520 6f66 2074 6865 206c  he name of the l
+0000ca70: 6174 2066 6965 6c64 2069 6e20 7468 6520  at field in the 
+0000ca80: 736f 7572 6365 2073 6861 7065 6669 6c65  source shapefile
+0000ca90: 0a20 2020 2020 2020 2073 6f75 7263 655f  .        source_
+0000caa0: 7368 705f 6c6f 6e3a 2073 7472 696e 672c  shp_lon: string,
+0000cab0: 2074 6865 206e 616d 6520 6f66 2074 6865   the name of the
+0000cac0: 206c 6f6e 2066 6965 6c64 2069 6e20 7468   lon field in th
+0000cad0: 6520 736f 7572 6365 2073 6861 7065 6669  e source shapefi
+0000cae0: 6c65 0a20 2020 2020 2020 2073 6f75 7263  le.        sourc
+0000caf0: 655f 7368 705f 4944 3a20 7374 7269 6e67  e_shp_ID: string
+0000cb00: 2c20 7468 6520 6e61 6d65 206f 6620 7468  , the name of th
+0000cb10: 6520 4944 2066 6965 6c64 2069 6e20 7468  e ID field in th
+0000cb20: 6520 736f 7572 6365 2073 6861 7065 6669  e source shapefi
+0000cb30: 6c65 0a20 2020 2020 2020 2022 2222 0a20  le.        """. 
+0000cb40: 2020 2020 2020 2069 6d70 6f72 7420 6765         import ge
+0000cb50: 6f70 616e 6461 7320 6173 2067 7064 0a20  opandas as gpd. 
+0000cb60: 2020 2020 2020 2066 726f 6d20 2020 7368         from   sh
+0000cb70: 6170 656c 792e 6765 6f6d 6574 7279 2069  apely.geometry i
+0000cb80: 6d70 6f72 7420 506f 6c79 676f 6e0a 2020  mport Polygon.  
+0000cb90: 2020 2020 2020 2369 6d70 6f72 7420 7368        #import sh
+0000cba0: 6170 6566 696c 6520 2320 7079 7368 6564  apefile # pyshed
+0000cbb0: 206c 6962 7261 7279 0a20 2020 2020 2020   library.       
+0000cbc0: 2069 6d70 6f72 7420 7368 6170 656c 790a   import shapely.
+0000cbd0: 2020 2020 2020 2020 7368 705b 276c 6174          shp['lat
+0000cbe0: 5f73 275d 203d 2073 6870 205b 736f 7572  _s'] = shp [sour
+0000cbf0: 6365 5f73 6870 5f6c 6174 5d2e 6173 7479  ce_shp_lat].asty
+0000cc00: 7065 2866 6c6f 6174 290a 2020 2020 2020  pe(float).      
+0000cc10: 2020 7368 705b 276c 6f6e 5f73 275d 203d    shp['lon_s'] =
+0000cc20: 2073 6870 205b 736f 7572 6365 5f73 6870   shp [source_shp
+0000cc30: 5f6c 6f6e 5d2e 6173 7479 7065 2866 6c6f  _lon].astype(flo
+0000cc40: 6174 290a 2020 2020 2020 2020 6966 2073  at).        if s
+0000cc50: 656c 662e 736f 7572 6365 5f73 6870 5f49  elf.source_shp_I
+0000cc60: 4420 213d 2027 273a 0a20 2020 2020 2020  D != '':.       
+0000cc70: 2020 2020 2073 6870 205b 2749 445f 7327       shp ['ID_s'
+0000cc80: 5d20 203d 2073 6870 205b 736f 7572 6365  ]  = shp [source
+0000cc90: 5f73 6870 5f49 445d 0a20 2020 2020 2020  _shp_ID].       
+0000cca0: 2065 6c73 653a 0a20 2020 2020 2020 2020   else:.         
+0000ccb0: 2020 2073 6870 205b 2749 445f 7327 5d20     shp ['ID_s'] 
+0000ccc0: 203d 206e 702e 6172 616e 6765 286c 656e   = np.arange(len
+0000ccd0: 2873 6870 2929 2b31 0a20 2020 2020 2020  (shp))+1.       
+0000cce0: 2072 6574 7572 6e20 7368 700a 0a20 2020   return shp..   
+0000ccf0: 2064 6566 2065 7870 616e 645f 736f 7572   def expand_sour
+0000cd00: 6365 5f53 4850 2820 2073 656c 662c 0a20  ce_SHP(  self,. 
+0000cd10: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000cd20: 2020 2020 2020 2020 2020 2073 6870 2c0a             shp,.
+0000cd30: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000cd40: 2020 2020 2020 2020 2020 2020 7465 6d70              temp
+0000cd50: 5f64 6972 2c0a 2020 2020 2020 2020 2020  _dir,.          
+0000cd60: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000cd70: 2020 6361 7365 5f6e 616d 6529 3a0a 2020    case_name):.  
+0000cd80: 2020 2020 2020 2222 220a 2020 2020 2020        """.      
+0000cd90: 2020 4020 6175 7468 6f72 3a20 2020 2020    @ author:     
+0000cda0: 2020 2020 2020 2020 2020 2020 2053 6865               She
+0000cdb0: 7276 616e 2047 6861 7261 7269 0a20 2020  rvan Gharari.   
+0000cdc0: 2020 2020 2040 2047 6974 6875 623a 2020       @ Github:  
+0000cdd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000cde0: 6874 7470 733a 2f2f 6769 7468 7562 2e63  https://github.c
+0000cdf0: 6f6d 2f53 6865 7276 616e 4768 6172 6172  om/ShervanGharar
+0000ce00: 692f 4541 5359 4d4f 5245 0a20 2020 2020  i/EASYMORE.     
+0000ce10: 2020 2040 2061 7574 686f 7227 7320 656d     @ author's em
+0000ce20: 6169 6c20 6964 3a20 2020 2020 2020 7368  ail id:       sh
+0000ce30: 2e67 6861 7261 7269 4067 6d61 696c 2e63  .gharari@gmail.c
+0000ce40: 6f6d 0a20 2020 2020 2020 2040 206c 6963  om.        @ lic
+0000ce50: 656e 7365 3a20 2020 2020 2020 2020 2020  ense:           
+0000ce60: 2020 2020 2020 474e 552d 4750 4c76 330a        GNU-GPLv3.
+0000ce70: 2020 2020 2020 2020 5468 6973 2066 756e          This fun
+0000ce80: 6374 696f 6e20 6164 6420 6c61 742c 206c  ction add lat, l
+0000ce90: 6f6e 2061 6e64 2049 4420 6672 6f6d 2074  on and ID from t
+0000cea0: 6865 2073 6f75 7263 6520 7368 6170 6566  he source shapef
+0000ceb0: 696c 6520 6966 2070 726f 7669 6465 640a  ile if provided.
+0000cec0: 2020 2020 2020 2020 4172 6775 6d65 6e74          Argument
+0000ced0: 730a 2020 2020 2020 2020 2d2d 2d2d 2d2d  s.        ------
+0000cee0: 2d2d 2d0a 2020 2020 2020 2020 7368 703a  ---.        shp:
+0000cef0: 2067 656f 6461 7461 6672 616d 6520 6f66   geodataframe of
+0000cf00: 2073 6f75 7263 6520 7368 6170 6566 696c   source shapefil
+0000cf10: 650a 2020 2020 2020 2020 736f 7572 6365  e.        source
+0000cf20: 5f73 6870 5f6c 6174 3a20 7374 7269 6e67  _shp_lat: string
+0000cf30: 2c20 7468 6520 6e61 6d65 206f 6620 7468  , the name of th
+0000cf40: 6520 6c61 7420 6669 656c 6420 696e 2074  e lat field in t
+0000cf50: 6865 2073 6f75 7263 6520 7368 6170 6566  he source shapef
+0000cf60: 696c 650a 2020 2020 2020 2020 736f 7572  ile.        sour
+0000cf70: 6365 5f73 6870 5f6c 6f6e 3a20 7374 7269  ce_shp_lon: stri
+0000cf80: 6e67 2c20 7468 6520 6e61 6d65 206f 6620  ng, the name of 
+0000cf90: 7468 6520 6c6f 6e20 6669 656c 6420 696e  the lon field in
+0000cfa0: 2074 6865 2073 6f75 7263 6520 7368 6170   the source shap
+0000cfb0: 6566 696c 650a 2020 2020 2020 2020 736f  efile.        so
+0000cfc0: 7572 6365 5f73 6870 5f49 443a 2073 7472  urce_shp_ID: str
+0000cfd0: 696e 672c 2074 6865 206e 616d 6520 6f66  ing, the name of
+0000cfe0: 2074 6865 2049 4420 6669 656c 6420 696e   the ID field in
+0000cff0: 2074 6865 2073 6f75 7263 6520 7368 6170   the source shap
+0000d000: 6566 696c 650a 2020 2020 2020 2020 5265  efile.        Re
+0000d010: 7475 726e 730a 2020 2020 2020 2020 2d2d  turns.        --
+0000d020: 2d2d 2d2d 2d0a 2020 2020 2020 2020 7265  -----.        re
+0000d030: 7375 6c74 3a20 6765 6f70 616e 6461 7320  sult: geopandas 
+0000d040: 6461 7461 6672 616d 652c 2065 7870 616e  dataframe, expan
+0000d050: 6465 6420 736f 7572 6365 2073 6861 7065  ded source shape
+0000d060: 6669 6c65 2074 6861 7420 636f 7665 7273  file that covers
+0000d070: 202d 3138 3020 746f 2033 3630 206f 6620   -180 to 360 of 
+0000d080: 6c6f 6e0a 2020 2020 2020 2020 2222 220a  lon.        """.
+0000d090: 2020 2020 2020 2020 696d 706f 7274 2067          import g
+0000d0a0: 656f 7061 6e64 6173 2061 7320 6770 640a  eopandas as gpd.
+0000d0b0: 2020 2020 2020 2020 6672 6f6d 2020 2073          from   s
+0000d0c0: 6861 7065 6c79 2e67 656f 6d65 7472 7920  hapely.geometry 
+0000d0d0: 696d 706f 7274 2050 6f6c 7967 6f6e 0a20  import Polygon. 
+0000d0e0: 2020 2020 2020 2023 696d 706f 7274 2073         #import s
+0000d0f0: 6861 7065 6669 6c65 2023 2070 7973 6865  hapefile # pyshe
+0000d100: 6420 6c69 6272 6172 790a 2020 2020 2020  d library.      
+0000d110: 2020 696d 706f 7274 2073 6861 7065 6c79    import shapely
+0000d120: 0a20 2020 2020 2020 2023 2070 7574 2061  .        # put a
+0000d130: 2063 6865 636b 2074 6f20 7365 6520 6966   check to see if
+0000d140: 2074 6865 7265 2069 7320 6c6f 6e5f 7320   there is lon_s 
+0000d150: 616e 6420 6c61 745f 732c 2049 445f 730a  and lat_s, ID_s.
+0000d160: 2020 2020 2020 2020 636f 6c75 6d6e 5f6e          column_n
+0000d170: 616d 6573 203d 2073 6870 2e63 6f6c 756d  ames = shp.colum
+0000d180: 6e73 0a20 2020 2020 2020 2063 6f6c 756d  ns.        colum
+0000d190: 6e5f 6e61 6d65 7320 3d20 6c69 7374 2863  n_names = list(c
+0000d1a0: 6f6c 756d 6e5f 6e61 6d65 7329 0a20 2020  olumn_names).   
+0000d1b0: 2020 2020 2069 6620 2827 6c6f 6e5f 7327       if ('lon_s'
+0000d1c0: 206e 6f74 2069 6e20 636f 6c75 6d6e 5f6e   not in column_n
+0000d1d0: 616d 6573 2920 6f72 2028 276c 6174 5f73  ames) or ('lat_s
+0000d1e0: 2720 6e6f 7420 696e 2063 6f6c 756d 6e5f  ' not in column_
+0000d1f0: 6e61 6d65 7329 206f 7220 2827 4944 5f73  names) or ('ID_s
+0000d200: 2720 6e6f 7420 696e 2063 6f6c 756d 6e5f  ' not in column_
+0000d210: 6e61 6d65 7329 3a0a 2020 2020 2020 2020  names):.        
+0000d220: 2020 2020 7379 732e 6578 6974 2827 7468      sys.exit('th
+0000d230: 6520 736f 7572 6365 2073 6861 7065 6669  e source shapefi
+0000d240: 6c65 2064 6f65 7320 6e6f 7420 6861 7665  le does not have
+0000d250: 2063 6f6c 756d 6e20 6f66 206c 6f6e 5f73   column of lon_s
+0000d260: 206c 6174 5f73 2061 6e64 2049 445f 7327   lat_s and ID_s'
+0000d270: 290a 2020 2020 2020 2020 2320 6368 6563  ).        # chec
+0000d280: 6b20 6966 2074 6865 2073 6861 7065 6669  k if the shapefi
+0000d290: 6c65 2069 7320 616c 7265 6164 7920 6578  le is already ex
+0000d2a0: 7061 6e64 6564 0a20 2020 2020 2020 206d  panded.        m
+0000d2b0: 696e 5f6c 6f6e 2c20 6d69 6e5f 6c61 742c  in_lon, min_lat,
+0000d2c0: 206d 6178 5f6c 6f6e 2c20 6d61 785f 6c61   max_lon, max_la
+0000d2d0: 7420 3d20 7368 702e 746f 7461 6c5f 626f  t = shp.total_bo
+0000d2e0: 756e 6473 0a20 2020 2020 2020 2070 7269  unds.        pri
+0000d2f0: 6e74 286d 696e 5f6c 6f6e 2c20 6d69 6e5f  nt(min_lon, min_
+0000d300: 6c61 742c 206d 6178 5f6c 6f6e 2c20 6d61  lat, max_lon, ma
+0000d310: 785f 6c61 7429 0a20 2020 2020 2020 2069  x_lat).        i
+0000d320: 6620 2831 3830 203c 206d 6178 5f6c 6f6e  f (180 < max_lon
+0000d330: 2920 616e 6420 286d 696e 5f6c 6f6e 203c  ) and (min_lon <
+0000d340: 2030 293a 0a20 2020 2020 2020 2020 2020   0):.           
+0000d350: 2070 7269 6e74 2827 6974 2073 6565 6d73   print('it seems
+0000d360: 2074 6865 2073 6f75 7263 6520 7368 6170   the source shap
+0000d370: 6566 696c 6520 6973 2061 6c72 6561 6479  efile is already
+0000d380: 2065 7870 616e 6465 6420 6265 7477 6565   expanded betwee
+0000d390: 6e20 2d31 3830 2074 6f20 3336 3020 6c6f  n -180 to 360 lo
+0000d3a0: 6e67 6974 7564 6527 290a 2020 2020 2020  ngitude').      
+0000d3b0: 2020 656c 7365 3a0a 2020 2020 2020 2020    else:.        
+0000d3c0: 2020 2020 6966 206d 6178 2028 7368 705b      if max (shp[
+0000d3d0: 276c 6f6e 5f73 275d 2920 3e20 3138 3020  'lon_s']) > 180 
+0000d3e0: 616e 6420 6d69 6e20 2873 6870 5b27 6c6f  and min (shp['lo
+0000d3f0: 6e5f 7327 5d29 203e 2030 2061 6e64 206d  n_s']) > 0 and m
+0000d400: 6178 2028 7368 705b 276c 6f6e 5f73 275d  ax (shp['lon_s']
+0000d410: 2920 3c20 3336 303a 0a20 2020 2020 2020  ) < 360:.       
+0000d420: 2020 2020 2020 2020 2070 7269 6e74 2827           print('
+0000d430: 4541 5359 4d4f 5245 2064 6563 6964 6573  EASYMORE decides
+0000d440: 2074 6865 206e 6574 4344 4620 6669 6c65   the netCDF file
+0000d450: 2068 6173 206c 6f6e 6774 6974 7564 6520   has longtitude 
+0000d460: 7661 6c75 6573 206f 6620 3020 746f 2033  values of 0 to 3
+0000d470: 3630 3b20 6372 6561 7469 6e67 2074 6865  60; creating the
+0000d480: 2065 7874 656e 6465 6427 290a 2020 2020   extended').    
+0000d490: 2020 2020 2020 2020 2020 2020 7368 7031              shp1
+0000d4a0: 203d 2073 6870 205b 7368 705b 276c 6f6e   = shp [shp['lon
+0000d4b0: 5f73 275d 203c 3d20 3138 305d 0a20 2020  _s'] <= 180].   
+0000d4c0: 2020 2020 2020 2020 2020 2020 2073 6870               shp
+0000d4d0: 3220 3d20 7368 7020 5b73 6870 5b27 6c6f  2 = shp [shp['lo
+0000d4e0: 6e5f 7327 5d20 3e20 2031 3830 5d0a 2020  n_s'] >  180].  
+0000d4f0: 2020 2020 2020 2020 2020 2020 2020 6966                if
+0000d500: 206e 6f74 2073 6870 312e 656d 7074 793a   not shp1.empty:
+0000d510: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0000d520: 2020 2020 2073 6870 312e 746f 5f66 696c       shp1.to_fil
+0000d530: 6528 7465 6d70 5f64 6972 2b63 6173 655f  e(temp_dir+case_
+0000d540: 6e61 6d65 2b27 5f73 6f75 7263 655f 7368  name+'_source_sh
+0000d550: 6170 6566 696c 6541 2e73 6870 2729 0a20  apefileA.shp'). 
+0000d560: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000d570: 2020 2073 6870 3120 3d20 6770 642e 7265     shp1 = gpd.re
+0000d580: 6164 5f66 696c 6528 7465 6d70 5f64 6972  ad_file(temp_dir
+0000d590: 2b63 6173 655f 6e61 6d65 2b27 5f73 6f75  +case_name+'_sou
+0000d5a0: 7263 655f 7368 6170 6566 696c 6541 2e73  rce_shapefileA.s
+0000d5b0: 6870 2729 0a20 2020 2020 2020 2020 2020  hp').           
+0000d5c0: 2020 2020 2020 2020 2074 656d 7020 3d20           temp = 
+0000d5d0: 7368 7031 0a20 2020 2020 2020 2020 2020  shp1.           
+0000d5e0: 2020 2020 2069 6620 6e6f 7420 7368 7032       if not shp2
+0000d5f0: 2e65 6d70 7479 3a0a 2020 2020 2020 2020  .empty:.        
+0000d600: 2020 2020 2020 2020 2020 2020 7368 7032              shp2
+0000d610: 2e74 6f5f 6669 6c65 2874 656d 705f 6469  .to_file(temp_di
+0000d620: 722b 6361 7365 5f6e 616d 652b 275f 736f  r+case_name+'_so
+0000d630: 7572 6365 5f73 6861 7065 6669 6c65 422e  urce_shapefileB.
+0000d640: 7368 7027 290a 2020 2020 2020 2020 2020  shp').          
+0000d650: 2020 2020 2020 2020 2020 7368 7032 203d            shp2 =
+0000d660: 2067 7064 2e72 6561 645f 6669 6c65 2874   gpd.read_file(t
+0000d670: 656d 705f 6469 722b 6361 7365 5f6e 616d  emp_dir+case_nam
+0000d680: 652b 275f 736f 7572 6365 5f73 6861 7065  e+'_source_shape
+0000d690: 6669 6c65 422e 7368 7027 290a 2020 2020  fileB.shp').    
+0000d6a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000d6b0: 7368 7033 203d 2067 7064 2e72 6561 645f  shp3 = gpd.read_
+0000d6c0: 6669 6c65 2874 656d 705f 6469 722b 6361  file(temp_dir+ca
+0000d6d0: 7365 5f6e 616d 652b 275f 736f 7572 6365  se_name+'_source
+0000d6e0: 5f73 6861 7065 6669 6c65 422e 7368 7027  _shapefileB.shp'
+0000d6f0: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
+0000d700: 2020 2020 2020 2320 6c6f 6f70 2063 6861        # loop cha
+0000d710: 6e67 6520 7468 6520 6765 6f6d 6574 7279  nge the geometry
+0000d720: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0000d730: 2020 2020 2066 6f72 2069 6e64 6578 2c20       for index, 
+0000d740: 5f20 696e 2073 6870 332e 6974 6572 726f  _ in shp3.iterro
+0000d750: 7773 2829 3a0a 2020 2020 2020 2020 2020  ws():.          
+0000d760: 2020 2020 2020 2020 2020 2020 2020 706f                po
+0000d770: 6c79 7320 3d20 7368 7033 2e67 656f 6d65  lys = shp3.geome
+0000d780: 7472 792e 696c 6f63 5b69 6e64 6578 5d20  try.iloc[index] 
+0000d790: 2320 6765 7420 7468 6520 7368 6170 650a  # get the shape.
+0000d7a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000d7b0: 2020 2020 2020 2020 706f 6c79 7320 3d20          polys = 
+0000d7c0: 7368 6170 656c 792e 6166 6669 6e69 7479  shapely.affinity
+0000d7d0: 2e74 7261 6e73 6c61 7465 2870 6f6c 7973  .translate(polys
+0000d7e0: 2c20 786f 6666 3d2d 3336 302e 302c 2079  , xoff=-360.0, y
+0000d7f0: 6f66 663d 302e 302c 207a 6f66 663d 302e  off=0.0, zoff=0.
+0000d800: 3029 0a20 2020 2020 2020 2020 2020 2020  0).             
+0000d810: 2020 2020 2020 2020 2020 2073 6870 332e             shp3.
+0000d820: 6765 6f6d 6574 7279 2e69 6c6f 635b 696e  geometry.iloc[in
+0000d830: 6465 785d 203d 2070 6f6c 7973 0a20 2020  dex] = polys.   
+0000d840: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000d850: 2073 6870 332e 746f 5f66 696c 6528 7465   shp3.to_file(te
+0000d860: 6d70 5f64 6972 2b63 6173 655f 6e61 6d65  mp_dir+case_name
+0000d870: 2b27 5f73 6f75 7263 655f 7368 6170 6566  +'_source_shapef
+0000d880: 696c 6543 2e73 6870 2729 0a20 2020 2020  ileC.shp').     
+0000d890: 2020 2020 2020 2020 2020 2020 2020 2073                 s
+0000d8a0: 6870 3320 3d20 6770 642e 7265 6164 5f66  hp3 = gpd.read_f
+0000d8b0: 696c 6528 7465 6d70 5f64 6972 2b63 6173  ile(temp_dir+cas
+0000d8c0: 655f 6e61 6d65 2b27 5f73 6f75 7263 655f  e_name+'_source_
+0000d8d0: 7368 6170 6566 696c 6543 2e73 6870 2729  shapefileC.shp')
+0000d8e0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0000d8f0: 2020 2020 2074 656d 7020 3d20 6770 642e       temp = gpd.
+0000d900: 4765 6f44 6174 6146 7261 6d65 2820 7064  GeoDataFrame( pd
+0000d910: 2e63 6f6e 6361 7428 205b 7368 7033 2c73  .concat( [shp3,s
+0000d920: 6870 325d 202c 2069 676e 6f72 655f 696e  hp2] , ignore_in
+0000d930: 6465 783d 5472 7565 2020 2920 290a 2020  dex=True  ) ).  
+0000d940: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000d950: 2020 6966 206e 6f74 2073 6870 312e 656d    if not shp1.em
+0000d960: 7074 793a 0a20 2020 2020 2020 2020 2020  pty:.           
+0000d970: 2020 2020 2020 2020 2020 2020 2074 656d               tem
+0000d980: 7020 3d20 6770 642e 4765 6f44 6174 6146  p = gpd.GeoDataF
+0000d990: 7261 6d65 2820 7064 2e63 6f6e 6361 7428  rame( pd.concat(
+0000d9a0: 205b 7465 6d70 2c73 6870 315d 202c 2069   [temp,shp1] , i
+0000d9b0: 676e 6f72 655f 696e 6465 783d 5472 7565  gnore_index=True
+0000d9c0: 2029 2020 290a 2020 2020 2020 2020 2020   )  ).          
+0000d9d0: 2020 2020 2020 7465 6d70 2e74 6f5f 6669        temp.to_fi
+0000d9e0: 6c65 2874 656d 705f 6469 722b 6361 7365  le(temp_dir+case
+0000d9f0: 5f6e 616d 652b 275f 736f 7572 6365 5f73  _name+'_source_s
+0000da00: 6861 7065 6669 6c65 5f65 7870 616e 6465  hapefile_expande
+0000da10: 642e 7368 7027 290a 2020 2020 2020 2020  d.shp').        
+0000da20: 2020 2020 2320 7468 6520 6e65 7463 6466      # the netcdf
+0000da30: 2066 696c 6520 6861 7320 7661 6c75 6573   file has values
+0000da40: 2062 6574 7765 656e 202d 3138 3020 746f   between -180 to
+0000da50: 2031 3830 0a20 2020 2020 2020 2020 2020   180.           
+0000da60: 2065 6c69 6620 6d69 6e20 2873 6870 5b27   elif min (shp['
+0000da70: 6c6f 6e5f 7327 5d29 203e 202d 3138 3020  lon_s']) > -180 
+0000da80: 616e 6420 6d61 7820 2873 6870 5b27 6c6f  and max (shp['lo
+0000da90: 6e5f 7327 5d29 203c 2031 3830 3a0a 2020  n_s']) < 180:.  
 0000daa0: 2020 2020 2020 2020 2020 2020 2020 7072                pr
-0000dab0: 696e 7428 2752 656d 6f76 696e 6720 6578  int('Removing ex
-0000dac0: 6973 7469 6e67 2072 656d 6170 7065 6420  isting remapped 
-0000dad0: 2e6e 6320 6669 6c65 2e27 290a 2020 2020  .nc file.').    
-0000dae0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000daf0: 6f73 2e72 656d 6f76 6528 7461 7267 6574  os.remove(target
-0000db00: 5f6e 616d 6529 0a20 2020 2020 2020 2020  _name).         
-0000db10: 2020 2020 2020 2065 6c73 653a 0a20 2020         else:.   
-0000db20: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000db30: 2070 7269 6e74 2827 5265 6d61 7070 6564   print('Remapped
-0000db40: 202e 6e63 2066 696c 6520 616c 7265 6164   .nc file alread
-0000db50: 7920 6578 6973 7473 2e20 476f 696e 6720  y exists. Going 
-0000db60: 746f 206e 6578 7420 6669 6c65 2e27 290a  to next file.').
-0000db70: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000db80: 2020 2020 636f 6e74 696e 7565 2023 2073      continue # s
-0000db90: 6b69 7020 746f 206e 6578 7420 6669 6c65  kip to next file
-0000dba0: 0a20 2020 2020 2020 2020 2020 2066 6f72  .            for
-0000dbb0: 2076 6172 2069 6e20 6e63 6964 732e 7661   var in ncids.va
-0000dbc0: 7269 6162 6c65 732e 7661 6c75 6573 2829  riables.values()
-0000dbd0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-0000dbe0: 2020 6966 2076 6172 2e6e 616d 6520 3d3d    if var.name ==
-0000dbf0: 2073 656c 662e 7661 725f 7469 6d65 3a0a   self.var_time:.
-0000dc00: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000dc10: 2020 2020 7469 6d65 5f64 7479 7065 203d      time_dtype =
-0000dc20: 2020 7374 7228 7661 722e 6474 7970 6529    str(var.dtype)
-0000dc30: 0a20 2020 2020 2020 2020 2020 2074 696d  .            tim
-0000dc40: 655f 6474 7970 655f 636f 6465 203d 2027  e_dtype_code = '
-0000dc50: 6638 2720 2320 696e 6974 6961 6c69 7a65  f8' # initialize
-0000dc60: 2074 6865 2074 696d 6520 6173 2066 6c6f   the time as flo
-0000dc70: 6174 0a20 2020 2020 2020 2020 2020 2069  at.            i
-0000dc80: 6620 2766 6c6f 6174 2720 696e 2074 696d  f 'float' in tim
-0000dc90: 655f 6474 7970 652e 6c6f 7765 7228 293a  e_dtype.lower():
-0000dca0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0000dcb0: 2074 696d 655f 6474 7970 655f 636f 6465   time_dtype_code
-0000dcc0: 203d 2027 6638 270a 2020 2020 2020 2020   = 'f8'.        
-0000dcd0: 2020 2020 656c 6966 2027 696e 7427 2069      elif 'int' i
-0000dce0: 6e20 7469 6d65 5f64 7479 7065 2e6c 6f77  n time_dtype.low
-0000dcf0: 6572 2829 3a0a 2020 2020 2020 2020 2020  er():.          
-0000dd00: 2020 2020 2020 7469 6d65 5f64 7479 7065        time_dtype
-0000dd10: 5f63 6f64 6520 3d20 2769 3427 0a20 2020  _code = 'i4'.   
-0000dd20: 2020 2020 2020 2020 2023 2072 6570 6f72           # repor
-0000dd30: 7469 6e67 0a20 2020 2020 2020 2020 2020  ting.           
-0000dd40: 2070 7269 6e74 2827 5265 6d61 7070 696e   print('Remappin
-0000dd50: 6720 272b 6e63 5f6e 616d 652b 2720 746f  g '+nc_name+' to
-0000dd60: 2027 2b74 6172 6765 745f 6e61 6d65 290a   '+target_name).
-0000dd70: 2020 2020 2020 2020 2020 2020 7072 696e              prin
-0000dd80: 7428 2753 7461 7274 6564 2061 7420 6461  t('Started at da
-0000dd90: 7465 2061 6e64 2074 696d 6520 272b 7374  te and time '+st
-0000dda0: 7228 6461 7465 7469 6d65 2e6e 6f77 2829  r(datetime.now()
-0000ddb0: 2929 0a20 2020 2020 2020 2020 2020 2077  )).            w
-0000ddc0: 6974 6820 6e63 342e 4461 7461 7365 7428  ith nc4.Dataset(
-0000ddd0: 7461 7267 6574 5f6e 616d 652c 2022 7722  target_name, "w"
-0000dde0: 2c20 666f 726d 6174 3d22 4e45 5443 4446  , format="NETCDF
-0000ddf0: 3422 2920 6173 206e 6369 643a 2023 2063  4") as ncid: # c
-0000de00: 7265 6174 696e 6720 7468 6520 4e65 7443  reating the NetC
-0000de10: 4446 2066 696c 650a 2020 2020 2020 2020  DF file.        
-0000de20: 2020 2020 2020 2020 2320 6465 6669 6e65          # define
-0000de30: 2074 6865 2064 696d 656e 7369 6f6e 730a   the dimensions.
-0000de40: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000de50: 6469 6d69 645f 4e20 3d20 6e63 6964 2e63  dimid_N = ncid.c
-0000de60: 7265 6174 6544 696d 656e 7369 6f6e 2873  reateDimension(s
-0000de70: 656c 662e 7265 6d61 7070 6564 5f64 696d  elf.remapped_dim
-0000de80: 5f69 642c 206c 656e 2868 7275 4944 5f76  _id, len(hruID_v
-0000de90: 6172 2929 2020 2320 6c69 6d69 7465 6420  ar))  # limited 
-0000dea0: 6469 6d65 6e73 6974 6f6e 2065 7175 616c  dimensiton equal
-0000deb0: 2074 6865 206e 756d 6265 7220 6f66 2068   the number of h
-0000dec0: 7275 4944 0a20 2020 2020 2020 2020 2020  ruID.           
-0000ded0: 2020 2020 2064 696d 6964 5f54 203d 206e       dimid_T = n
-0000dee0: 6369 642e 6372 6561 7465 4469 6d65 6e73  cid.createDimens
-0000def0: 696f 6e28 2774 696d 6527 2c20 4e6f 6e65  ion('time', None
-0000df00: 2920 2020 2320 756e 6c69 6d69 7465 6420  )   # unlimited 
-0000df10: 6469 6d65 6e73 6974 6f6e 0a20 2020 2020  dimensiton.     
-0000df20: 2020 2020 2020 2020 2020 2023 2056 6172             # Var
-0000df30: 6961 626c 6520 7469 6d65 0a20 2020 2020  iable time.     
-0000df40: 2020 2020 2020 2020 2020 2074 696d 655f             time_
-0000df50: 7661 7269 6420 3d20 6e63 6964 2e63 7265  varid = ncid.cre
-0000df60: 6174 6556 6172 6961 626c 6528 2774 696d  ateVariable('tim
-0000df70: 6527 2c20 7469 6d65 5f64 7479 7065 5f63  e', time_dtype_c
-0000df80: 6f64 652c 2028 2774 696d 6527 2c20 292c  ode, ('time', ),
-0000df90: 207a 6c69 623d 636f 6d70 666c 6167 2c20   zlib=compflag, 
-0000dfa0: 636f 6d70 6c65 7665 6c3d 636f 6d70 6c65  complevel=comple
-0000dfb0: 7665 6c29 0a20 2020 2020 2020 2020 2020  vel).           
-0000dfc0: 2020 2020 2023 2041 7474 7269 6275 7465       # Attribute
-0000dfd0: 730a 2020 2020 2020 2020 2020 2020 2020  s.              
-0000dfe0: 2020 7469 6d65 5f76 6172 6964 2e6c 6f6e    time_varid.lon
-0000dff0: 675f 6e61 6d65 203d 2073 656c 662e 7661  g_name = self.va
-0000e000: 725f 7469 6d65 0a20 2020 2020 2020 2020  r_time.         
-0000e010: 2020 2020 2020 2074 696d 655f 7661 7269         time_vari
-0000e020: 642e 756e 6974 7320 3d20 7469 6d65 5f75  d.units = time_u
-0000e030: 6e69 7420 2023 2065 2e67 2e20 2764 6179  nit  # e.g. 'day
-0000e040: 7320 7369 6e63 6520 3230 3030 2d30 312d  s since 2000-01-
-0000e050: 3031 2030 303a 3030 2720 7368 6f75 6c64  01 00:00' should
-0000e060: 2063 6861 6e67 6520 6163 636f 7264 696e   change accordin
-0000e070: 676c 790a 2020 2020 2020 2020 2020 2020  gly.            
-0000e080: 2020 2020 7469 6d65 5f76 6172 6964 2e63      time_varid.c
-0000e090: 616c 656e 6461 7220 3d20 7469 6d65 5f63  alendar = time_c
-0000e0a0: 616c 0a20 2020 2020 2020 2020 2020 2020  al.             
-0000e0b0: 2020 2074 696d 655f 7661 7269 642e 7374     time_varid.st
-0000e0c0: 616e 6461 7264 5f6e 616d 6520 3d20 7365  andard_name = se
-0000e0d0: 6c66 2e76 6172 5f74 696d 650a 2020 2020  lf.var_time.    
-0000e0e0: 2020 2020 2020 2020 2020 2020 7469 6d65              time
-0000e0f0: 5f76 6172 6964 2e61 7869 7320 3d20 2754  _varid.axis = 'T
-0000e100: 270a 2020 2020 2020 2020 2020 2020 2020  '.              
-0000e110: 2020 7469 6d65 5f76 6172 6964 5b3a 5d20    time_varid[:] 
-0000e120: 3d20 7469 6d65 5f76 6172 0a20 2020 2020  = time_var.     
-0000e130: 2020 2020 2020 2020 2020 2023 2056 6172             # Var
-0000e140: 6961 626c 6573 206c 6174 2c20 6c6f 6e2c  iables lat, lon,
-0000e150: 2073 7562 6261 7369 6e5f 4944 0a20 2020   subbasin_ID.   
-0000e160: 2020 2020 2020 2020 2020 2020 206c 6174               lat
-0000e170: 5f76 6172 6964 203d 206e 6369 642e 6372  _varid = ncid.cr
-0000e180: 6561 7465 5661 7269 6162 6c65 2873 656c  eateVariable(sel
-0000e190: 662e 7265 6d61 7070 6564 5f76 6172 5f6c  f.remapped_var_l
-0000e1a0: 6174 2c20 2766 3827 2c20 2873 656c 662e  at, 'f8', (self.
-0000e1b0: 7265 6d61 7070 6564 5f64 696d 5f69 642c  remapped_dim_id,
-0000e1c0: 2029 2c20 7a6c 6962 3d63 6f6d 7066 6c61   ), zlib=compfla
-0000e1d0: 672c 2063 6f6d 706c 6576 656c 3d63 6f6d  g, complevel=com
-0000e1e0: 706c 6576 656c 290a 2020 2020 2020 2020  plevel).        
-0000e1f0: 2020 2020 2020 2020 6c6f 6e5f 7661 7269          lon_vari
-0000e200: 6420 3d20 6e63 6964 2e63 7265 6174 6556  d = ncid.createV
-0000e210: 6172 6961 626c 6528 7365 6c66 2e72 656d  ariable(self.rem
-0000e220: 6170 7065 645f 7661 725f 6c6f 6e2c 2027  apped_var_lon, '
-0000e230: 6638 272c 2028 7365 6c66 2e72 656d 6170  f8', (self.remap
-0000e240: 7065 645f 6469 6d5f 6964 2c20 292c 207a  ped_dim_id, ), z
-0000e250: 6c69 623d 636f 6d70 666c 6167 2c20 636f  lib=compflag, co
-0000e260: 6d70 6c65 7665 6c3d 636f 6d70 6c65 7665  mplevel=compleve
-0000e270: 6c29 0a20 2020 2020 2020 2020 2020 2020  l).             
-0000e280: 2020 2068 7275 4964 5f76 6172 6964 203d     hruId_varid =
-0000e290: 206e 6369 642e 6372 6561 7465 5661 7269   ncid.createVari
-0000e2a0: 6162 6c65 2873 656c 662e 7265 6d61 7070  able(self.remapp
-0000e2b0: 6564 5f76 6172 5f69 642c 2027 6638 272c  ed_var_id, 'f8',
-0000e2c0: 2028 7365 6c66 2e72 656d 6170 7065 645f   (self.remapped_
-0000e2d0: 6469 6d5f 6964 2c20 292c 207a 6c69 623d  dim_id, ), zlib=
-0000e2e0: 636f 6d70 666c 6167 2c20 636f 6d70 6c65  compflag, comple
-0000e2f0: 7665 6c3d 636f 6d70 6c65 7665 6c29 0a20  vel=complevel). 
-0000e300: 2020 2020 2020 2020 2020 2020 2020 2023                 #
-0000e310: 2041 7474 7269 6275 7465 730a 2020 2020   Attributes.    
-0000e320: 2020 2020 2020 2020 2020 2020 6c61 745f              lat_
-0000e330: 7661 7269 642e 6c6f 6e67 5f6e 616d 6520  varid.long_name 
-0000e340: 3d20 7365 6c66 2e72 656d 6170 7065 645f  = self.remapped_
-0000e350: 7661 725f 6c61 740a 2020 2020 2020 2020  var_lat.        
-0000e360: 2020 2020 2020 2020 6c6f 6e5f 7661 7269          lon_vari
-0000e370: 642e 6c6f 6e67 5f6e 616d 6520 3d20 7365  d.long_name = se
-0000e380: 6c66 2e72 656d 6170 7065 645f 7661 725f  lf.remapped_var_
-0000e390: 6c6f 6e0a 2020 2020 2020 2020 2020 2020  lon.            
-0000e3a0: 2020 2020 6872 7549 645f 7661 7269 642e      hruId_varid.
-0000e3b0: 6c6f 6e67 5f6e 616d 6520 3d20 2773 6861  long_name = 'sha
-0000e3c0: 7065 2049 4427 0a20 2020 2020 2020 2020  pe ID'.         
-0000e3d0: 2020 2020 2020 206c 6174 5f76 6172 6964         lat_varid
-0000e3e0: 2e75 6e69 7473 203d 2027 6465 6772 6565  .units = 'degree
-0000e3f0: 735f 6e6f 7274 6827 0a20 2020 2020 2020  s_north'.       
-0000e400: 2020 2020 2020 2020 206c 6f6e 5f76 6172           lon_var
-0000e410: 6964 2e75 6e69 7473 203d 2027 6465 6772  id.units = 'degr
-0000e420: 6565 735f 6561 7374 270a 2020 2020 2020  ees_east'.      
-0000e430: 2020 2020 2020 2020 2020 6872 7549 645f            hruId_
-0000e440: 7661 7269 642e 756e 6974 7320 3d20 2731  varid.units = '1
-0000e450: 270a 2020 2020 2020 2020 2020 2020 2020  '.              
-0000e460: 2020 6c61 745f 7661 7269 642e 7374 616e    lat_varid.stan
-0000e470: 6461 7264 5f6e 616d 6520 3d20 7365 6c66  dard_name = self
-0000e480: 2e72 656d 6170 7065 645f 7661 725f 6c61  .remapped_var_la
-0000e490: 740a 2020 2020 2020 2020 2020 2020 2020  t.              
-0000e4a0: 2020 6c6f 6e5f 7661 7269 642e 7374 616e    lon_varid.stan
-0000e4b0: 6461 7264 5f6e 616d 6520 3d20 7365 6c66  dard_name = self
-0000e4c0: 2e72 656d 6170 7065 645f 7661 725f 6c6f  .remapped_var_lo
-0000e4d0: 6e0a 2020 2020 2020 2020 2020 2020 2020  n.              
-0000e4e0: 2020 6c61 745f 7661 7269 645b 3a5d 203d    lat_varid[:] =
-0000e4f0: 2068 7275 4944 5f6c 6174 0a20 2020 2020   hruID_lat.     
-0000e500: 2020 2020 2020 2020 2020 206c 6f6e 5f76             lon_v
-0000e510: 6172 6964 5b3a 5d20 3d20 6872 7549 445f  arid[:] = hruID_
-0000e520: 6c6f 6e0a 2020 2020 2020 2020 2020 2020  lon.            
-0000e530: 2020 2020 6872 7549 645f 7661 7269 645b      hruId_varid[
-0000e540: 3a5d 203d 2068 7275 4944 5f76 6172 0a20  :] = hruID_var. 
-0000e550: 2020 2020 2020 2020 2020 2020 2020 2023                 #
-0000e560: 2067 656e 6572 616c 2061 7474 7269 6275   general attribu
-0000e570: 7465 7320 666f 7220 4e65 7443 4446 2066  tes for NetCDF f
-0000e580: 696c 650a 2020 2020 2020 2020 2020 2020  ile.            
-0000e590: 2020 2020 6e63 6964 2e43 6f6e 7665 6e74      ncid.Convent
-0000e5a0: 696f 6e73 203d 2027 4346 2d31 2e36 270a  ions = 'CF-1.6'.
-0000e5b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000e5c0: 6e63 6964 2e41 7574 686f 7220 3d20 2754  ncid.Author = 'T
-0000e5d0: 6865 2064 6174 6120 7765 7265 2077 7269  he data were wri
-0000e5e0: 7474 656e 2062 7920 2720 2b20 7365 6c66  tten by ' + self
-0000e5f0: 2e61 7574 686f 725f 6e61 6d65 0a20 2020  .author_name.   
-0000e600: 2020 2020 2020 2020 2020 2020 206e 6369               nci
-0000e610: 642e 4c69 6365 6e73 6520 3d20 7365 6c66  d.License = self
-0000e620: 2e6c 6963 656e 7365 0a20 2020 2020 2020  .license.       
-0000e630: 2020 2020 2020 2020 206e 6369 642e 4869           ncid.Hi
-0000e640: 7374 6f72 7920 3d20 2743 7265 6174 6564  story = 'Created
-0000e650: 2027 202b 2074 696d 652e 6374 696d 6528   ' + time.ctime(
-0000e660: 7469 6d65 2e74 696d 6528 2929 0a20 2020  time.time()).   
-0000e670: 2020 2020 2020 2020 2020 2020 206e 6369               nci
-0000e680: 642e 536f 7572 6365 203d 2027 4361 7365  d.Source = 'Case
-0000e690: 3a20 2720 2b73 656c 662e 6361 7365 5f6e  : ' +self.case_n
-0000e6a0: 616d 6520 2b20 273b 2072 656d 6170 7065  ame + '; remappe
-0000e6b0: 6420 6279 2073 6372 6970 7420 6672 6f6d  d by script from
-0000e6c0: 206c 6962 7261 7279 206f 6620 5368 6572   library of Sher
-0000e6d0: 7661 6e20 4768 6172 6172 6920 2868 7474  van Gharari (htt
-0000e6e0: 7073 3a2f 2f67 6974 6875 622e 636f 6d2f  ps://github.com/
-0000e6f0: 5368 6572 7661 6e47 6861 7261 7269 2f45  ShervanGharari/E
-0000e700: 4153 594d 4f52 4529 2e27 0a20 2020 2020  ASYMORE).'.     
-0000e710: 2020 2020 2020 2020 2020 2023 2077 7269             # wri
-0000e720: 7465 2076 6172 6962 616c 6573 0a20 2020  te varibales.   
-0000e730: 2020 2020 2020 2020 2020 2020 2066 6f72               for
-0000e740: 2069 2069 6e20 6e70 2e61 7261 6e67 6528   i in np.arange(
-0000e750: 6c65 6e28 7365 6c66 2e76 6172 5f6e 616d  len(self.var_nam
-0000e760: 6573 2929 3a0a 2020 2020 2020 2020 2020  es)):.          
-0000e770: 2020 2020 2020 2020 2020 7661 725f 7661            var_va
-0000e780: 6c75 6520 203d 2073 656c 662e 5f5f 7765  lue  = self.__we
-0000e790: 6967 6874 6564 5f61 7665 7261 6765 2820  ighted_average( 
-0000e7a0: 6e63 5f6e 616d 652c 0a20 2020 2020 2020  nc_name,.       
-0000e7b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000e7c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000e7d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000e7e0: 2020 2074 6172 6765 745f 6461 7465 5f74     target_date_t
-0000e7f0: 696d 6573 2c0a 2020 2020 2020 2020 2020  imes,.          
-0000e800: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000e810: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000e820: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000e830: 7365 6c66 2e76 6172 5f6e 616d 6573 5b69  self.var_names[i
-0000e840: 5d2c 0a20 2020 2020 2020 2020 2020 2020  ],.             
-0000e850: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000e860: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000e870: 2020 2020 2020 2020 2020 2020 2072 656d               rem
-0000e880: 6170 290a 2020 2020 2020 2020 2020 2020  ap).            
-0000e890: 2020 2020 2020 2020 2320 5661 7269 6162          # Variab
-0000e8a0: 6c65 7320 7772 6974 696e 670a 2020 2020  les writing.    
-0000e8b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000e8c0: 7661 7269 6420 3d20 6e63 6964 2e63 7265  varid = ncid.cre
-0000e8d0: 6174 6556 6172 6961 626c 6528 7365 6c66  ateVariable(self
-0000e8e0: 2e76 6172 5f6e 616d 6573 5f72 656d 6170  .var_names_remap
-0000e8f0: 7065 645b 695d 2c20 7365 6c66 2e66 6f72  ped[i], self.for
-0000e900: 6d61 745f 6c69 7374 5b69 5d2c 2028 2774  mat_list[i], ('t
-0000e910: 696d 6527 2c73 656c 662e 7265 6d61 7070  ime',self.remapp
-0000e920: 6564 5f64 696d 5f69 6420 292c 2066 696c  ed_dim_id ), fil
-0000e930: 6c5f 7661 6c75 6520 3d20 7365 6c66 2e66  l_value = self.f
-0000e940: 696c 6c5f 7661 6c75 655f 6c69 7374 5b69  ill_value_list[i
-0000e950: 5d2c 207a 6c69 623d 636f 6d70 666c 6167  ], zlib=compflag
-0000e960: 2c20 636f 6d70 6c65 7665 6c3d 636f 6d70  , complevel=comp
-0000e970: 6c65 7665 6c29 0a20 2020 2020 2020 2020  level).         
-0000e980: 2020 2020 2020 2020 2020 2076 6172 6964             varid
-0000e990: 205b 3a5d 203d 2076 6172 5f76 616c 7565   [:] = var_value
-0000e9a0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0000e9b0: 2020 2020 2023 2050 6173 7320 6174 7472       # Pass attr
-0000e9c0: 6962 7574 6573 0a20 2020 2020 2020 2020  ibutes.         
-0000e9d0: 2020 2020 2020 2020 2020 2069 6620 276c             if 'l
-0000e9e0: 6f6e 675f 6e61 6d65 2720 696e 206e 6369  ong_name' in nci
-0000e9f0: 6473 2e76 6172 6961 626c 6573 5b73 656c  ds.variables[sel
-0000ea00: 662e 7661 725f 6e61 6d65 735b 695d 5d2e  f.var_names[i]].
-0000ea10: 6e63 6174 7472 7328 293a 0a20 2020 2020  ncattrs():.     
-0000ea20: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000ea30: 2020 2076 6172 6964 2e6c 6f6e 675f 6e61     varid.long_na
-0000ea40: 6d65 203d 206e 6369 6473 2e76 6172 6961  me = ncids.varia
-0000ea50: 626c 6573 5b73 656c 662e 7661 725f 6e61  bles[self.var_na
-0000ea60: 6d65 735b 695d 5d2e 6c6f 6e67 5f6e 616d  mes[i]].long_nam
-0000ea70: 650a 2020 2020 2020 2020 2020 2020 2020  e.              
-0000ea80: 2020 2020 2020 6966 2027 756e 6974 7327        if 'units'
-0000ea90: 2069 6e20 6e63 6964 732e 7661 7269 6162   in ncids.variab
-0000eaa0: 6c65 735b 7365 6c66 2e76 6172 5f6e 616d  les[self.var_nam
-0000eab0: 6573 5b69 5d5d 2e6e 6361 7474 7273 2829  es[i]].ncattrs()
-0000eac0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-0000ead0: 2020 2020 2020 2020 2020 7661 7269 642e            varid.
-0000eae0: 756e 6974 7320 3d20 6e63 6964 732e 7661  units = ncids.va
-0000eaf0: 7269 6162 6c65 735b 7365 6c66 2e76 6172  riables[self.var
-0000eb00: 5f6e 616d 6573 5b69 5d5d 2e75 6e69 7473  _names[i]].units
-0000eb10: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0000eb20: 2023 2072 6570 6f72 7469 6e67 0a20 2020   # reporting.   
-0000eb30: 2020 2020 2020 2020 2020 2020 2070 7269               pri
-0000eb40: 6e74 2827 456e 6465 6420 2020 6174 2064  nt('Ended   at d
-0000eb50: 6174 6520 616e 6420 7469 6d65 2027 2b73  ate and time '+s
-0000eb60: 7472 2864 6174 6574 696d 652e 6e6f 7728  tr(datetime.now(
-0000eb70: 2929 290a 2020 2020 2020 2020 2020 2020  ))).            
-0000eb80: 2020 2020 7072 696e 7428 272d 2d2d 2d2d      print('-----
-0000eb90: 2d27 290a 2020 2020 2020 2020 2020 2020  -').            
-0000eba0: 6966 2073 656c 662e 7361 7665 5f63 7376  if self.save_csv
-0000ebb0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-0000ebc0: 2020 6473 203d 2078 722e 6f70 656e 5f64    ds = xr.open_d
-0000ebd0: 6174 6173 6574 2874 6172 6765 745f 6e61  ataset(target_na
-0000ebe0: 6d65 290a 2020 2020 2020 2020 2020 2020  me).            
-0000ebf0: 2020 2020 666f 7220 6920 696e 206e 702e      for i in np.
-0000ec00: 6172 616e 6765 286c 656e 2873 656c 662e  arange(len(self.
-0000ec10: 7661 725f 6e61 6d65 735f 7265 6d61 7070  var_names_remapp
-0000ec20: 6564 2929 3a0a 2020 2020 2020 2020 2020  ed)):.          
-0000ec30: 2020 2020 2020 2020 2020 2320 6173 7369            # assi
-0000ec40: 676e 2074 6865 2076 6172 6961 626c 6520  gn the variable 
-0000ec50: 746f 2074 6865 2064 6174 6120 6672 616d  to the data fram
-0000ec60: 6520 7769 7468 2074 6865 2049 4420 636f  e with the ID co
-0000ec70: 6c75 6d6e 206e 616d 650a 2020 2020 2020  lumn name.      
-0000ec80: 2020 2020 2020 2020 2020 2020 2020 636f                co
-0000ec90: 6c75 6d6e 5f6e 616d 6520 3d20 6c69 7374  lumn_name = list
-0000eca0: 286d 6170 2873 7472 2c6c 6973 7428 6e70  (map(str,list(np
-0000ecb0: 2e61 7272 6179 2864 735b 7365 6c66 2e72  .array(ds[self.r
-0000ecc0: 656d 6170 7065 645f 7661 725f 6964 5d29  emapped_var_id])
-0000ecd0: 2929 290a 2020 2020 2020 2020 2020 2020  ))).            
-0000ece0: 2020 2020 2020 2020 636f 6c75 6d6e 5f6e          column_n
-0000ecf0: 616d 6520 3d20 5b27 4944 5f27 2b73 2066  ame = ['ID_'+s f
-0000ed00: 6f72 2073 2069 6e20 636f 6c75 6d6e 5f6e  or s in column_n
-0000ed10: 616d 655d 0a20 2020 2020 2020 2020 2020  ame].           
-0000ed20: 2020 2020 2020 2020 2064 6620 3d20 7064           df = pd
-0000ed30: 2e44 6174 6146 7261 6d65 2864 6174 613d  .DataFrame(data=
-0000ed40: 6e70 2e61 7272 6179 2864 735b 7365 6c66  np.array(ds[self
-0000ed50: 2e76 6172 5f6e 616d 6573 5f72 656d 6170  .var_names_remap
-0000ed60: 7065 645b 695d 5d29 2c20 636f 6c75 6d6e  ped[i]]), column
-0000ed70: 733d 636f 6c75 6d6e 5f6e 616d 6529 0a20  s=column_name). 
-0000ed80: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000ed90: 2020 2023 2064 6620 5b27 7469 6d65 275d     # df ['time']
-0000eda0: 203d 2064 732e 7469 6d65 0a20 2020 2020   = ds.time.     
-0000edb0: 2020 2020 2020 2020 2020 2020 2020 2064                 d
-0000edc0: 662e 696e 7365 7274 286c 6f63 3d30 2c20  f.insert(loc=0, 
-0000edd0: 636f 6c75 6d6e 3d27 7469 6d65 272c 2076  column='time', v
-0000ede0: 616c 7565 3d64 732e 7469 6d65 290a 2020  alue=ds.time).  
-0000edf0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000ee00: 2020 2320 6765 7420 7468 6520 756e 6974    # get the unit
-0000ee10: 2066 6f72 2074 6865 2076 6172 6962 616c   for the varibal
-0000ee20: 6520 6966 2065 7869 7374 730a 2020 2020  e if exists.    
-0000ee30: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000ee40: 756e 6974 5f6e 616d 6520 3d20 2727 0a20  unit_name = ''. 
-0000ee50: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000ee60: 2020 2069 6620 2775 6e69 7473 2720 696e     if 'units' in
-0000ee70: 2064 735b 7365 6c66 2e76 6172 5f6e 616d   ds[self.var_nam
-0000ee80: 6573 5f72 656d 6170 7065 645b 695d 5d2e  es_remapped[i]].
-0000ee90: 6174 7472 732e 6b65 7973 2829 3a0a 2020  attrs.keys():.  
-0000eea0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000eeb0: 2020 2020 2020 756e 6974 5f6e 616d 6520        unit_name 
-0000eec0: 3d20 6473 5b73 656c 662e 7661 725f 6e61  = ds[self.var_na
-0000eed0: 6d65 735f 7265 6d61 7070 6564 5b69 5d5d  mes_remapped[i]]
-0000eee0: 2e61 7474 7273 5b27 756e 6974 7327 5d0a  .attrs['units'].
-0000eef0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000ef00: 2020 2020 2320 7265 6d6f 7665 2074 6865      # remove the
-0000ef10: 2066 6f72 6269 6464 656e 2063 6861 7261   forbidden chara
-0000ef20: 6374 6572 2062 6173 6564 206f 6e0a 2020  cter based on.  
-0000ef30: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000ef40: 2020 2320 5b27 2327 2c27 2527 2c27 2627    # ['#','%','&'
-0000ef50: 2c27 7b27 2c27 7d27 2c27 5c27 2c27 3c27  ,'{','}','\','<'
-0000ef60: 2c27 3e27 2c27 2a27 2c27 3f27 2c27 2f27  ,'>','*','?','/'
-0000ef70: 2c27 2027 2c27 2427 2c27 2127 2c27 6027  ,' ','$','!','`'
-0000ef80: 2c27 2727 2c27 2227 2c27 3a27 2c27 4027  ,''','"',':','@'
-0000ef90: 2c27 2b27 2c27 2c27 2c27 7c27 2c27 3d27  ,'+',',','|','='
-0000efa0: 5d0a 2020 2020 2020 2020 2020 2020 2020  ].              
-0000efb0: 2020 2020 2020 756e 6974 5f6e 616d 6520        unit_name 
-0000efc0: 3d20 7265 2e73 7562 2822 5b23 2526 7b7d  = re.sub("[#%&{}
-0000efd0: 2a3c 3e2a 3f2a 2421 603a 402b 2c7c 3d20  *<>*?*$!`:@+,|= 
-0000efe0: 5d22 2c22 222c 756e 6974 5f6e 616d 6529  ]","",unit_name)
-0000eff0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0000f000: 2020 2020 2075 6e69 745f 6e61 6d65 203d       unit_name =
-0000f010: 2075 6e69 745f 6e61 6d65 2e72 6570 6c61   unit_name.repla
-0000f020: 6365 2822 5c5c 222c 2222 290a 2020 2020  ce("\\","").    
-0000f030: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000f040: 756e 6974 5f6e 616d 6520 3d20 756e 6974  unit_name = unit
-0000f050: 5f6e 616d 652e 7265 706c 6163 6528 222f  _name.replace("/
-0000f060: 2f22 2c22 2229 0a20 2020 2020 2020 2020  /","").         
-0000f070: 2020 2020 2020 2020 2020 2075 6e69 745f             unit_
-0000f080: 6e61 6d65 203d 2075 6e69 745f 6e61 6d65  name = unit_name
-0000f090: 2e72 6570 6c61 6365 2822 2f22 2c22 2229  .replace("/","")
-0000f0a0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0000f0b0: 2020 2020 2023 2070 7269 6e74 2875 6e69       # print(uni
-0000f0c0: 745f 6e61 6d65 290a 2020 2020 2020 2020  t_name).        
-0000f0d0: 2020 2020 2020 2020 2020 2020 7461 7267              targ
-0000f0e0: 6574 5f6e 616d 655f 6373 7620 3d20 7365  et_name_csv = se
-0000f0f0: 6c66 2e6f 7574 7075 745f 6469 7220 2b20  lf.output_dir + 
-0000f100: 7365 6c66 2e63 6173 655f 6e61 6d65 202b  self.case_name +
-0000f110: 2027 5f72 656d 6170 7065 645f 272b 2073   '_remapped_'+ s
-0000f120: 656c 662e 7661 725f 6e61 6d65 735f 7265  elf.var_names_re
-0000f130: 6d61 7070 6564 5b69 5d20 2b5c 0a20 2020  mapped[i] +\.   
-0000f140: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000f150: 2020 275f 2720 2b20 756e 6974 5f6e 616d    '_' + unit_nam
-0000f160: 6520 2b5c 0a20 2020 2020 2020 2020 2020  e +\.           
-0000f170: 2020 2020 2020 2020 2020 275f 2720 2b20            '_' + 
-0000f180: 7461 7267 6574 5f64 6174 655f 7469 6d65  target_date_time
-0000f190: 735b 305d 2e73 7472 6674 696d 6528 2225  s[0].strftime("%
-0000f1a0: 592d 256d 2d25 642d 2548 2d25 4d2d 2553  Y-%m-%d-%H-%M-%S
-0000f1b0: 2229 2b20 272e 6373 7627 0a20 2020 2020  ")+ '.csv'.     
-0000f1c0: 2020 2020 2020 2020 2020 2020 2020 2074                 t
-0000f1d0: 6172 6765 745f 6e61 6d65 5f6d 6170 203d  arget_name_map =
-0000f1e0: 2073 656c 662e 6f75 7470 7574 5f64 6972   self.output_dir
-0000f1f0: 202b 2027 4d61 7070 696e 675f 2720 2b20   + 'Mapping_' + 
-0000f200: 7365 6c66 2e63 6173 655f 6e61 6d65 202b  self.case_name +
-0000f210: 2027 5f72 656d 6170 7065 645f 272b 2073   '_remapped_'+ s
-0000f220: 656c 662e 7661 725f 6e61 6d65 735f 7265  elf.var_names_re
-0000f230: 6d61 7070 6564 5b69 5d20 2b5c 0a20 2020  mapped[i] +\.   
-0000f240: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000f250: 2020 275f 2720 2b20 756e 6974 5f6e 616d    '_' + unit_nam
-0000f260: 6520 2b5c 0a20 2020 2020 2020 2020 2020  e +\.           
-0000f270: 2020 2020 2020 2020 2020 275f 2720 2b20            '_' + 
-0000f280: 7461 7267 6574 5f64 6174 655f 7469 6d65  target_date_time
-0000f290: 735b 305d 2e73 7472 6674 696d 6528 2225  s[0].strftime("%
-0000f2a0: 592d 256d 2d25 642d 2548 2d25 4d2d 2553  Y-%m-%d-%H-%M-%S
-0000f2b0: 2229 2b20 272e 6373 7627 0a20 2020 2020  ")+ '.csv'.     
-0000f2c0: 2020 2020 2020 2020 2020 2020 2020 2069                 i
-0000f2d0: 6620 6f73 2e70 6174 682e 6578 6973 7473  f os.path.exists
-0000f2e0: 2874 6172 6765 745f 6e61 6d65 5f63 7376  (target_name_csv
-0000f2f0: 293a 2023 2072 656d 6f76 6520 6669 6c65  ): # remove file
-0000f300: 2069 6620 6578 6973 7473 0a20 2020 2020   if exists.     
-0000f310: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000f320: 2020 206f 732e 7265 6d6f 7665 2874 6172     os.remove(tar
-0000f330: 6765 745f 6e61 6d65 5f63 7376 290a 2020  get_name_csv).  
-0000f340: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000f350: 2020 6966 206f 732e 7061 7468 2e65 7869    if os.path.exi
-0000f360: 7374 7328 7461 7267 6574 5f6e 616d 655f  sts(target_name_
-0000f370: 6d61 7029 3a20 2320 7265 6d6f 7665 2066  map): # remove f
-0000f380: 696c 6520 6966 2065 7869 7374 730a 2020  ile if exists.  
-0000f390: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000f3a0: 2020 2020 2020 6f73 2e72 656d 6f76 6528        os.remove(
-0000f3b0: 7461 7267 6574 5f6e 616d 655f 6d61 7029  target_name_map)
-0000f3c0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0000f3d0: 2020 2020 206c 6174 5f64 6174 6120 3d20       lat_data = 
-0000f3e0: 6e70 2e73 7175 6565 7a65 286e 702e 6172  np.squeeze(np.ar
-0000f3f0: 7261 7928 6473 5b73 656c 662e 7265 6d61  ray(ds[self.rema
-0000f400: 7070 6564 5f76 6172 5f6c 6174 5d29 293b  pped_var_lat]));
-0000f410: 206c 6174 5f64 6174 6120 3d20 6c61 745f   lat_data = lat_
-0000f420: 6461 7461 2e66 6c61 7474 656e 2829 0a20  data.flatten(). 
-0000f430: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000f440: 2020 206c 6f6e 5f64 6174 6120 3d20 6e70     lon_data = np
-0000f450: 2e73 7175 6565 7a65 286e 702e 6172 7261  .squeeze(np.arra
-0000f460: 7928 6473 5b73 656c 662e 7265 6d61 7070  y(ds[self.remapp
-0000f470: 6564 5f76 6172 5f6c 6f6e 5d29 293b 206c  ed_var_lon])); l
-0000f480: 6f6e 5f64 6174 6120 3d20 6c6f 6e5f 6461  on_data = lon_da
-0000f490: 7461 2e66 6c61 7474 656e 2829 0a20 2020  ta.flatten().   
-0000f4a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000f4b0: 206d 6170 7320 3d20 6e70 2e7a 6572 6f73   maps = np.zeros
-0000f4c0: 285b 322c 6c65 6e28 6c61 745f 6461 7461  ([2,len(lat_data
-0000f4d0: 295d 290a 2020 2020 2020 2020 2020 2020  )]).            
-0000f4e0: 2020 2020 2020 2020 6d61 7073 205b 302c          maps [0,
-0000f4f0: 3a5d 203d 206c 6174 5f64 6174 610a 2020  :] = lat_data.  
-0000f500: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000f510: 2020 6d61 7073 205b 312c 3a5d 203d 206c    maps [1,:] = l
-0000f520: 6f6e 5f64 6174 610a 2020 2020 2020 2020  on_data.        
-0000f530: 2020 2020 2020 2020 2020 2020 6466 5f6d              df_m
-0000f540: 6170 203d 2070 642e 4461 7461 4672 616d  ap = pd.DataFram
-0000f550: 6528 6461 7461 3d6d 6170 732c 2069 6e64  e(data=maps, ind
-0000f560: 6578 3d5b 226c 6174 222c 226c 6f6e 225d  ex=["lat","lon"]
-0000f570: 2c20 636f 6c75 6d6e 733d 636f 6c75 6d6e  , columns=column
-0000f580: 5f6e 616d 6529 0a20 2020 2020 2020 2020  _name).         
-0000f590: 2020 2020 2020 2020 2020 2023 2323 2323             #####
-0000f5a0: 2323 0a20 2020 2020 2020 2020 2020 2020  ##.             
-0000f5b0: 2020 2020 2020 2023 206e 6577 5f6c 6973         # new_lis
-0000f5c0: 7420 3d20 6c69 7374 2873 656c 662e 7661  t = list(self.va
-0000f5d0: 725f 6e61 6d65 735f 7265 6d61 7070 6564  r_names_remapped
-0000f5e0: 2920 2320 6e65 7720 6c69 7374 730a 2020  ) # new lists.  
-0000f5f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000f600: 2020 2320 6465 6c20 6e65 775f 6c69 7374    # del new_list
-0000f610: 5b69 5d20 2320 7265 6d6f 7665 206f 6e65  [i] # remove one
-0000f620: 2076 616c 7565 0a20 2020 2020 2020 2020   value.         
-0000f630: 2020 2020 2020 2020 2020 2023 2023 6473             # #ds
-0000f640: 5f74 656d 7020 3d20 6473 2e64 726f 7028  _temp = ds.drop(
-0000f650: 6e65 775f 6c69 7374 2920 2320 6472 6f70  new_list) # drop
-0000f660: 2061 6c6c 2074 6865 206f 7468 6572 2076   all the other v
-0000f670: 6172 6962 616c 6573 2065 7863 7065 7420  aribales excpet 
-0000f680: 7461 7267 6574 2076 6172 6962 616c 652c  target varibale,
-0000f690: 206c 6174 2c20 6c6f 6e20 616e 6420 7469   lat, lon and ti
-0000f6a0: 6d65 0a20 2020 2020 2020 2020 2020 2020  me.             
-0000f6b0: 2020 2020 2020 2023 2064 735f 7465 6d70         # ds_temp
-0000f6c0: 203d 2064 732e 6472 6f70 5f76 6172 7328   = ds.drop_vars(
-0000f6d0: 6e65 775f 6c69 7374 2920 2320 6472 6f70  new_list) # drop
-0000f6e0: 2061 6c6c 2074 6865 206f 7468 6572 2076   all the other v
-0000f6f0: 6172 6962 616c 6573 2065 7863 7065 7420  aribales excpet 
-0000f700: 7461 7267 6574 2076 6172 6962 616c 652c  target varibale,
-0000f710: 206c 6174 2c20 6c6f 6e20 616e 6420 7469   lat, lon and ti
-0000f720: 6d65 0a20 2020 2020 2020 2020 2020 2020  me.             
-0000f730: 2020 2020 2020 2023 2069 6620 2775 6e69         # if 'uni
-0000f740: 7473 2720 696e 2064 735b 7365 6c66 2e76  ts' in ds[self.v
-0000f750: 6172 5f6e 616d 6573 5f72 656d 6170 7065  ar_names_remappe
-0000f760: 645b 695d 5d2e 6174 7472 732e 6b65 7973  d[i]].attrs.keys
-0000f770: 2829 3a0a 2020 2020 2020 2020 2020 2020  ():.            
-0000f780: 2020 2020 2020 2020 2320 2020 2020 6469          #     di
-0000f790: 6374 696f 6e61 7279 203d 207b 7365 6c66  ctionary = {self
-0000f7a0: 2e76 6172 5f6e 616d 6573 5f72 656d 6170  .var_names_remap
-0000f7b0: 7065 645b 695d 3a73 656c 662e 7661 725f  ped[i]:self.var_
-0000f7c0: 6e61 6d65 735f 7265 6d61 7070 6564 5b69  names_remapped[i
-0000f7d0: 5d2b 2720 5b27 2b64 735b 7365 6c66 2e76  ]+' ['+ds[self.v
-0000f7e0: 6172 5f6e 616d 6573 5f72 656d 6170 7065  ar_names_remappe
-0000f7f0: 645b 695d 5d2e 6174 7472 735b 2775 6e69  d[i]].attrs['uni
-0000f800: 7473 275d 2b27 5d27 7d0a 2020 2020 2020  ts']+']'}.      
-0000f810: 2020 2020 2020 2020 2020 2020 2020 2320                # 
-0000f820: 2020 2020 6473 5f74 656d 7020 3d20 6473      ds_temp = ds
-0000f830: 5f74 656d 702e 7265 6e61 6d65 5f76 6172  _temp.rename_var
-0000f840: 7328 6469 6374 696f 6e61 7279 290a 2020  s(dictionary).  
-0000f850: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000f860: 2020 2320 7461 7267 6574 5f6e 616d 655f    # target_name_
-0000f870: 6373 7620 3d20 7365 6c66 2e6f 7574 7075  csv = self.outpu
-0000f880: 745f 6469 7220 2b20 7365 6c66 2e63 6173  t_dir + self.cas
-0000f890: 655f 6e61 6d65 202b 2027 5f72 656d 6170  e_name + '_remap
-0000f8a0: 7065 645f 272b 2073 656c 662e 7661 725f  ped_'+ self.var_
-0000f8b0: 6e61 6d65 735f 7265 6d61 7070 6564 5b69  names_remapped[i
-0000f8c0: 5d20 2b5c 0a20 2020 2020 2020 2020 2020  ] +\.           
-0000f8d0: 2020 2020 2020 2020 2023 2020 275f 2720           #  '_' 
-0000f8e0: 2b20 7461 7267 6574 5f64 6174 655f 7469  + target_date_ti
-0000f8f0: 6d65 735b 305d 2e73 7472 6674 696d 6528  mes[0].strftime(
-0000f900: 2225 592d 256d 2d25 642d 2548 2d25 4d2d  "%Y-%m-%d-%H-%M-
-0000f910: 2553 2229 2b27 2e63 7376 270a 2020 2020  %S")+'.csv'.    
-0000f920: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000f930: 2320 6966 206f 732e 7061 7468 2e65 7869  # if os.path.exi
-0000f940: 7374 7328 7461 7267 6574 5f6e 616d 655f  sts(target_name_
-0000f950: 6373 7629 3a20 2320 7265 6d6f 7665 2066  csv): # remove f
-0000f960: 696c 6520 6966 2065 7869 7374 730a 2020  ile if exists.  
-0000f970: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000f980: 2020 2320 2020 2020 6f73 2e72 656d 6f76    #     os.remov
-0000f990: 6528 7461 7267 6574 5f6e 616d 655f 6373  e(target_name_cs
-0000f9a0: 7629 0a20 2020 2020 2020 2020 2020 2020  v).             
-0000f9b0: 2020 2020 2020 2023 2023 2064 735f 7465         # # ds_te
-0000f9c0: 6d70 203d 2064 735f 7465 6d70 2e73 6574  mp = ds_temp.set
-0000f9d0: 5f63 6f6f 7264 7328 5b73 656c 662e 7265  _coords([self.re
-0000f9e0: 6d61 7070 6564 5f76 6172 5f6c 6174 2c73  mapped_var_lat,s
-0000f9f0: 656c 662e 7265 6d61 7070 6564 5f76 6172  elf.remapped_var
-0000fa00: 5f6c 6f6e 5d29 0a20 2020 2020 2020 2020  _lon]).         
-0000fa10: 2020 2020 2020 2020 2020 2023 2064 735f             # ds_
-0000fa20: 7465 6d70 203d 2064 735f 7465 6d70 2e72  temp = ds_temp.r
-0000fa30: 6573 6574 5f69 6e64 6578 285b 2774 696d  eset_index(['tim
-0000fa40: 6527 2c73 656c 662e 7265 6d61 7070 6564  e',self.remapped
-0000fa50: 5f76 6172 5f69 645d 290a 2020 2020 2020  _var_id]).      
-0000fa60: 2020 2020 2020 2020 2020 2020 2020 2320                # 
-0000fa70: 6473 5f74 656d 7020 3d20 6473 5f74 656d  ds_temp = ds_tem
-0000fa80: 702e 7265 7365 745f 636f 6f72 6473 2829  p.reset_coords()
-0000fa90: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0000faa0: 2020 2020 2023 2064 6620 3d20 6473 5f74       # df = ds_t
-0000fab0: 656d 702e 746f 5f64 6174 6166 7261 6d65  emp.to_dataframe
-0000fac0: 2829 0a20 2020 2020 2020 2020 2020 2020  ().             
-0000fad0: 2020 2020 2020 2023 2064 6620 3d20 6466         # df = df
-0000fae0: 2e72 6573 6574 5f69 6e64 6578 2829 0a20  .reset_index(). 
-0000faf0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000fb00: 2020 2023 2064 6620 3d20 6466 2e64 726f     # df = df.dro
-0000fb10: 7028 636f 6c75 6d6e 733d 5b27 7469 6d65  p(columns=['time
-0000fb20: 275d 290a 2020 2020 2020 2020 2020 2020  ']).            
-0000fb30: 2020 2020 2020 2020 2320 6466 205b 2774          # df ['t
-0000fb40: 696d 6527 5d20 3d20 6466 205b 2774 696d  ime'] = df ['tim
-0000fb50: 655f 275d 0a20 2020 2020 2020 2020 2020  e_'].           
-0000fb60: 2020 2020 2020 2020 2023 2064 6620 3d20           # df = 
-0000fb70: 6466 2e64 726f 7028 636f 6c75 6d6e 733d  df.drop(columns=
-0000fb80: 5b27 7469 6d65 5f27 5d29 0a20 2020 2020  ['time_']).     
-0000fb90: 2020 2020 2020 2020 2020 2020 2020 2023                 #
-0000fba0: 2064 6620 3d20 6466 2e64 726f 7028 636f   df = df.drop(co
-0000fbb0: 6c75 6d6e 733d 5b73 656c 662e 7265 6d61  lumns=[self.rema
-0000fbc0: 7070 6564 5f76 6172 5f69 645d 290a 2020  pped_var_id]).  
-0000fbd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000fbe0: 2020 2320 6466 205b 7365 6c66 2e72 656d    # df [self.rem
-0000fbf0: 6170 7065 645f 7661 725f 6964 5d20 3d20  apped_var_id] = 
-0000fc00: 6466 205b 7365 6c66 2e72 656d 6170 7065  df [self.remappe
-0000fc10: 645f 7661 725f 6964 2b27 5f27 5d0a 2020  d_var_id+'_'].  
-0000fc20: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000fc30: 2020 2320 6466 203d 2064 662e 6472 6f70    # df = df.drop
-0000fc40: 2863 6f6c 756d 6e73 3d5b 7365 6c66 2e72  (columns=[self.r
-0000fc50: 656d 6170 7065 645f 7661 725f 6964 2b27  emapped_var_id+'
-0000fc60: 5f27 5d29 0a20 2020 2020 2020 2020 2020  _']).           
-0000fc70: 2020 2020 2020 2020 2023 2323 2323 2323           #######
-0000fc80: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0000fc90: 2020 2020 2023 2064 665b 2749 4427 5d20       # df['ID'] 
-0000fca0: 3d20 6466 2e69 6e64 6578 2e67 6574 5f6c  = df.index.get_l
-0000fcb0: 6576 656c 5f76 616c 7565 7328 6c65 7665  evel_values(leve
-0000fcc0: 6c3d 3029 0a20 2020 2020 2020 2020 2020  l=0).           
-0000fcd0: 2020 2020 2020 2020 2023 2064 665b 2774           # df['t
-0000fce0: 696d 6527 5d20 3d20 6466 2e69 6e64 6578  ime'] = df.index
-0000fcf0: 2e67 6574 5f6c 6576 656c 5f76 616c 7565  .get_level_value
-0000fd00: 7328 6c65 7665 6c3d 3129 0a20 2020 2020  s(level=1).     
-0000fd10: 2020 2020 2020 2020 2020 2020 2020 2023                 #
-0000fd20: 2064 6620 3d20 6466 2e73 6574 5f69 6e64   df = df.set_ind
-0000fd30: 6578 285b 2749 4427 2c27 7469 6d65 272c  ex(['ID','time',
-0000fd40: 7365 6c66 2e72 656d 6170 7065 645f 7661  self.remapped_va
-0000fd50: 725f 6c61 742c 7365 6c66 2e72 656d 6170  r_lat,self.remap
-0000fd60: 7065 645f 7661 725f 6c6f 6e5d 290a 2020  ped_var_lon]).  
-0000fd70: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000fd80: 2020 2320 6466 203d 2064 662e 756e 7374    # df = df.unst
-0000fd90: 6163 6b28 6c65 7665 6c3d 2d33 290a 2020  ack(level=-3).  
-0000fda0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000fdb0: 2020 2320 6466 203d 2064 662e 7472 616e    # df = df.tran
-0000fdc0: 7370 6f73 6528 290a 2020 2020 2020 2020  spose().        
-0000fdd0: 2020 2020 2020 2020 2020 2020 2320 6966              # if
-0000fde0: 2027 756e 6974 7327 2069 6e20 6473 5b73   'units' in ds[s
-0000fdf0: 656c 662e 7661 725f 6e61 6d65 735f 7265  elf.var_names_re
-0000fe00: 6d61 7070 6564 5b69 5d5d 2e61 7474 7273  mapped[i]].attrs
-0000fe10: 2e6b 6579 7328 293a 0a20 2020 2020 2020  .keys():.       
-0000fe20: 2020 2020 2020 2020 2020 2020 2023 2020               #  
-0000fe30: 2020 2064 6620 3d20 6466 2e72 6570 6c61     df = df.repla
-0000fe40: 6365 2873 656c 662e 7661 725f 6e61 6d65  ce(self.var_name
-0000fe50: 735f 7265 6d61 7070 6564 5b69 5d2c 2073  s_remapped[i], s
-0000fe60: 656c 662e 7661 725f 6e61 6d65 735f 7265  elf.var_names_re
-0000fe70: 6d61 7070 6564 5b69 5d2b 2720 272b 6473  mapped[i]+' '+ds
-0000fe80: 5b73 656c 662e 7661 725f 6e61 6d65 735f  [self.var_names_
-0000fe90: 7265 6d61 7070 6564 5b69 5d5d 2e61 7474  remapped[i]].att
-0000fea0: 7273 5b27 756e 6974 7327 5d29 0a20 2020  rs['units']).   
-0000feb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000fec0: 2023 2323 2323 2323 0a20 2020 2020 2020   #######.       
-0000fed0: 2020 2020 2020 2020 2020 2020 2064 662e               df.
-0000fee0: 746f 5f63 7376 2874 6172 6765 745f 6e61  to_csv(target_na
-0000fef0: 6d65 5f63 7376 290a 2020 2020 2020 2020  me_csv).        
-0000ff00: 2020 2020 2020 2020 2020 2020 7072 696e              prin
-0000ff10: 7428 2743 6f6e 7665 7274 696e 6720 7661  t('Converting va
-0000ff20: 7269 6162 6c65 2027 2b20 7365 6c66 2e76  riable '+ self.v
-0000ff30: 6172 5f6e 616d 6573 5f72 656d 6170 7065  ar_names_remappe
-0000ff40: 645b 695d 202b 2720 6672 6f6d 2072 656d  d[i] +' from rem
-0000ff50: 6170 7065 6420 6669 6c65 206f 6620 272b  apped file of '+
-0000ff60: 7461 7267 6574 5f6e 616d 652b 5c0a 2020  target_name+\.  
-0000ff70: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000ff80: 2020 2020 2020 2720 746f 2027 2b74 6172        ' to '+tar
-0000ff90: 6765 745f 6e61 6d65 5f63 7376 290a 2020  get_name_csv).  
-0000ffa0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000ffb0: 2020 6466 5f6d 6170 2e74 6f5f 6373 7628    df_map.to_csv(
-0000ffc0: 7461 7267 6574 5f6e 616d 655f 6d61 7029  target_name_map)
-0000ffd0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0000ffe0: 2020 2020 2070 7269 6e74 2827 5361 7669       print('Savi
-0000fff0: 6e67 2074 6865 2049 442c 206c 6174 2c20  ng the ID, lat, 
-00010000: 6c6f 6e20 6d61 7020 6174 2027 2b74 6172  lon map at '+tar
-00010010: 6765 745f 6e61 6d65 5f63 7376 290a 2020  get_name_csv).  
-00010020: 2020 2020 2020 2020 2020 2020 2020 7072                pr
-00010030: 696e 7428 272d 2d2d 2d2d 2d27 290a 0a20  int('------').. 
-00010040: 2020 2064 6566 205f 5f77 6569 6768 7465     def __weighte
-00010050: 645f 6176 6572 6167 6528 7365 6c66 2c0a  d_average(self,.
-00010060: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00010070: 2020 2020 2020 2020 2020 206e 635f 6e61             nc_na
-00010080: 6d65 2c0a 2020 2020 2020 2020 2020 2020  me,.            
-00010090: 2020 2020 2020 2020 2020 2020 2020 2074                 t
-000100a0: 6172 6765 745f 7469 6d65 2c0a 2020 2020  arget_time,.    
-000100b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000100c0: 2020 2020 2020 2076 6172 6962 616c 655f         varibale_
-000100d0: 6e61 6d65 2c0a 2020 2020 2020 2020 2020  name,.          
-000100e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000100f0: 206d 6170 7069 6e67 5f64 6629 3a0a 2020   mapping_df):.  
-00010100: 2020 2020 2020 2222 220a 2020 2020 2020        """.      
-00010110: 2020 4020 6175 7468 6f72 3a20 2020 2020    @ author:     
-00010120: 2020 2020 2020 2020 2020 2020 2053 6865               She
-00010130: 7276 616e 2047 6861 7261 7269 0a20 2020  rvan Gharari.   
-00010140: 2020 2020 2040 2047 6974 6875 623a 2020       @ Github:  
-00010150: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00010160: 6874 7470 733a 2f2f 6769 7468 7562 2e63  https://github.c
-00010170: 6f6d 2f53 6865 7276 616e 4768 6172 6172  om/ShervanGharar
-00010180: 692f 4541 5359 4d4f 5245 0a20 2020 2020  i/EASYMORE.     
-00010190: 2020 2040 2061 7574 686f 7227 7320 656d     @ author's em
-000101a0: 6169 6c20 6964 3a20 2020 2020 2020 7368  ail id:       sh
-000101b0: 2e67 6861 7261 7269 4067 6d61 696c 2e63  .gharari@gmail.c
-000101c0: 6f6d 0a20 2020 2020 2020 2040 206c 6963  om.        @ lic
-000101d0: 656e 7365 3a20 2020 2020 2020 2020 2020  ense:           
-000101e0: 2020 2020 2020 474e 552d 4750 4c76 330a        GNU-GPLv3.
-000101f0: 2020 2020 2020 2020 5468 6973 2066 756e          This fun
-00010200: 6374 696f 6e20 7265 6164 7320 7468 6520  ction reads the 
-00010210: 6461 7461 2066 6f72 2061 2067 6976 656e  data for a given
-00010220: 2074 696d 6520 616e 6420 6361 6c63 756c   time and calcul
-00010230: 6174 6573 2074 6865 2077 6569 6768 7465  ates the weighte
-00010240: 6420 6176 6572 6167 650a 2020 2020 2020  d average.      
-00010250: 2020 4172 6775 6d65 6e74 730a 2020 2020    Arguments.    
-00010260: 2020 2020 2d2d 2d2d 2d2d 2d2d 2d0a 2020      ---------.  
-00010270: 2020 2020 2020 6e63 5f6e 616d 653a 2073        nc_name: s
-00010280: 7472 696e 672c 206e 616d 6520 6f66 2074  tring, name of t
-00010290: 6865 206e 6574 4344 4620 6669 6c65 0a20  he netCDF file. 
-000102a0: 2020 2020 2020 2074 6172 6765 745f 7469         target_ti
-000102b0: 6d65 3a20 7374 7269 6e67 2c0a 2020 2020  me: string,.    
-000102c0: 2020 2020 7661 7269 6261 6c65 5f6e 616d      varibale_nam
-000102d0: 653a 2073 7472 696e 672c 206e 616d 6520  e: string, name 
-000102e0: 6f66 2076 6172 6962 616c 6520 6672 6f6d  of varibale from
-000102f0: 2073 6f75 7263 6520 6e65 7463 7366 2066   source netcsf f
-00010300: 696c 6520 746f 2062 6520 7265 6d61 7070  ile to be remapp
-00010310: 6564 0a20 2020 2020 2020 206d 6170 7069  ed.        mappi
-00010320: 6e67 5f64 663a 2070 616e 6461 7320 6461  ng_df: pandas da
-00010330: 7461 6672 616d 652c 2069 6e63 6c75 6469  taframe, includi
-00010340: 6e67 2074 6865 2072 6f77 2061 6e64 2063  ng the row and c
-00010350: 6f6c 756d 6e20 6f66 2074 6865 2073 6f75  olumn of the sou
-00010360: 7263 6520 6461 7461 2061 6e64 2077 6569  rce data and wei
-00010370: 6768 740a 2020 2020 2020 2020 5265 7475  ght.        Retu
-00010380: 726e 730a 2020 2020 2020 2020 2d2d 2d2d  rns.        ----
-00010390: 2d2d 2d0a 2020 2020 2020 2020 7765 6967  ---.        weig
-000103a0: 6874 6564 5f76 616c 7565 3a20 6120 6e75  hted_value: a nu
-000103b0: 6d70 7920 6172 7261 7920 7468 6174 2068  mpy array that h
-000103c0: 6173 2074 6865 2072 656d 6170 7065 6420  as the remapped 
-000103d0: 7661 6c75 6573 2066 726f 6d20 7468 6520  values from the 
-000103e0: 6e63 2066 696c 650a 2020 2020 2020 2020  nc file.        
-000103f0: 2222 220a 2020 2020 2020 2020 2320 6f70  """.        # op
-00010400: 656e 2064 6174 6173 6574 0a20 2020 2020  en dataset.     
-00010410: 2020 2064 7320 3d20 7872 2e6f 7065 6e5f     ds = xr.open_
-00010420: 6461 7461 7365 7428 6e63 5f6e 616d 6529  dataset(nc_name)
-00010430: 0a20 2020 2020 2020 2023 2072 656e 616d  .        # renam
-00010440: 6520 7469 6d65 2076 6172 6962 616c 6520  e time varibale 
-00010450: 746f 2074 696d 650a 2020 2020 2020 2020  to time.        
-00010460: 6966 2073 656c 662e 7661 725f 7469 6d65  if self.var_time
-00010470: 2021 3d20 2774 696d 6527 3a0a 2020 2020   != 'time':.    
-00010480: 2020 2020 2020 2020 6473 203d 2064 732e          ds = ds.
-00010490: 7265 6e61 6d65 287b 7365 6c66 2e76 6172  rename({self.var
-000104a0: 5f74 696d 653a 2774 696d 6527 7d29 0a20  _time:'time'}). 
-000104b0: 2020 2020 2020 2023 2070 7265 7061 7265         # prepare
-000104c0: 6420 7468 6520 6e75 6d70 7920 6172 7261  d the numpy arra
-000104d0: 7920 666f 7220 6f75 7074 7574 0a20 2020  y for ouptut.   
-000104e0: 2020 2020 2077 6569 6768 7465 645f 7661       weighted_va
-000104f0: 6c75 6520 3d20 6e70 2e7a 6572 6f73 285b  lue = np.zeros([
-00010500: 7365 6c66 2e6c 656e 6774 685f 6f66 5f74  self.length_of_t
-00010510: 696d 652c 7365 6c66 2e6e 756d 6265 725f  ime,self.number_
-00010520: 6f66 5f74 6172 6765 745f 656c 656d 656e  of_target_elemen
-00010530: 7473 5d29 0a20 2020 2020 2020 206d 203d  ts]).        m =
-00010540: 2030 2023 2063 6f75 6e74 6572 0a20 2020   0 # counter.   
-00010550: 2020 2020 2066 6f72 2064 6174 6520 696e       for date in
-00010560: 2074 6172 6765 745f 7469 6d65 3a20 2320   target_time: # 
-00010570: 6c6f 6f70 206f 7665 7220 7469 6d65 0a20  loop over time. 
-00010580: 2020 2020 2020 2020 2020 2064 735f 7465             ds_te
-00010590: 6d70 203d 2064 732e 7365 6c28 7469 6d65  mp = ds.sel(time
-000105a0: 3d64 6174 652e 7374 7266 7469 6d65 2822  =date.strftime("
-000105b0: 2559 2d25 6d2d 2564 2025 483a 254d 3a25  %Y-%m-%d %H:%M:%
-000105c0: 5322 292c 6d65 7468 6f64 3d22 6e65 6172  S"),method="near
-000105d0: 6573 7422 290a 2020 2020 2020 2020 2020  est").          
-000105e0: 2020 6461 7461 203d 206e 702e 6172 7261    data = np.arra
-000105f0: 7928 6473 5f74 656d 705b 7661 7269 6261  y(ds_temp[variba
-00010600: 6c65 5f6e 616d 655d 290a 2020 2020 2020  le_name]).      
-00010610: 2020 2020 2020 6461 7461 203d 206e 702e        data = np.
-00010620: 7371 7565 657a 6528 6461 7461 290a 2020  squeeze(data).  
-00010630: 2020 2020 2020 2020 2020 2320 6765 7420            # get 
-00010640: 7661 6c75 6573 2066 726f 6d20 7468 6520  values from the 
-00010650: 726f 7773 2061 6e64 2063 6f6c 7320 616e  rows and cols an
-00010660: 6420 7061 7373 2074 6f20 6e70 2064 6174  d pass to np dat
-00010670: 6120 6172 7261 790a 2020 2020 2020 2020  a array.        
-00010680: 2020 2020 6966 2073 656c 662e 6361 7365      if self.case
-00010690: 203d 3d31 206f 7220 7365 6c66 2e63 6173   ==1 or self.cas
-000106a0: 6520 3d3d 323a 0a20 2020 2020 2020 2020  e ==2:.         
-000106b0: 2020 2020 2020 2076 616c 7565 7320 3d20         values = 
-000106c0: 6461 7461 205b 7365 6c66 2e72 6f77 732c  data [self.rows,
-000106d0: 7365 6c66 2e63 6f6c 735d 0a20 2020 2020  self.cols].     
-000106e0: 2020 2020 2020 2069 6620 7365 6c66 2e63         if self.c
-000106f0: 6173 6520 3d3d 333a 0a20 2020 2020 2020  ase ==3:.       
-00010700: 2020 2020 2020 2020 2076 616c 7565 7320           values 
-00010710: 3d20 6461 7461 205b 7365 6c66 2e72 6f77  = data [self.row
-00010720: 735d 0a20 2020 2020 2020 2020 2020 2076  s].            v
-00010730: 616c 7565 7320 3d20 6e70 2e61 7272 6179  alues = np.array
-00010740: 2876 616c 7565 7329 0a20 2020 2020 2020  (values).       
-00010750: 2020 2020 2023 2061 6464 2076 616c 7565       # add value
-00010760: 7320 746f 2064 6174 6120 6672 616d 652c  s to data frame,
-00010770: 2077 6569 6768 7465 6420 6176 6572 6167   weighted averag
-00010780: 6520 616e 6420 7061 7373 2074 6f20 6461  e and pass to da
-00010790: 7461 2066 7261 6d65 2061 6761 696e 0a20  ta frame again. 
-000107a0: 2020 2020 2020 2020 2020 206d 6170 7069             mappi
-000107b0: 6e67 5f64 665b 2776 616c 7565 7327 5d20  ng_df['values'] 
-000107c0: 3d20 7661 6c75 6573 0a20 2020 2020 2020  = values.       
-000107d0: 2020 2020 206d 6170 7069 6e67 5f64 665b       mapping_df[
-000107e0: 2776 616c 7565 735f 7727 5d20 3d20 6d61  'values_w'] = ma
-000107f0: 7070 696e 675f 6466 5b27 7765 6967 6874  pping_df['weight
-00010800: 275d 2a6d 6170 7069 6e67 5f64 665b 2776  ']*mapping_df['v
-00010810: 616c 7565 7327 5d0a 2020 2020 2020 2020  alues'].        
-00010820: 2020 2020 6466 5f74 656d 7020 3d20 6d61      df_temp = ma
-00010830: 7070 696e 675f 6466 2e67 726f 7570 6279  pping_df.groupby
-00010840: 285b 276f 7264 6572 5f74 275d 2c61 735f  (['order_t'],as_
-00010850: 696e 6465 783d 4661 6c73 6529 2e61 6767  index=False).agg
-00010860: 287b 2776 616c 7565 735f 7727 3a20 2773  ({'values_w': 's
-00010870: 756d 277d 290a 2020 2020 2020 2020 2020  um'}).          
-00010880: 2020 6466 5f74 656d 7020 3d20 6466 5f74    df_temp = df_t
-00010890: 656d 702e 736f 7274 5f76 616c 7565 7328  emp.sort_values(
-000108a0: 6279 3d5b 276f 7264 6572 5f74 275d 290a  by=['order_t']).
-000108b0: 2020 2020 2020 2020 2020 2020 7765 6967              weig
-000108c0: 6874 6564 5f76 616c 7565 205b 6d2c 3a5d  hted_value [m,:]
-000108d0: 203d 206e 702e 6172 7261 7928 6466 5f74   = np.array(df_t
-000108e0: 656d 705b 2776 616c 7565 735f 7727 5d29  emp['values_w'])
-000108f0: 0a20 2020 2020 2020 2020 2020 206d 202b  .            m +
-00010900: 3d20 310a 2020 2020 2020 2020 7265 7475  = 1.        retu
-00010910: 726e 2077 6569 6768 7465 645f 7661 6c75  rn weighted_valu
-00010920: 650a 0a0a 2020 2020 6465 6620 7368 705f  e...    def shp_
-00010930: 6c6f 6e5f 636f 7272 6563 7469 6f6e 2028  lon_correction (
-00010940: 7365 6c66 2c0a 2020 2020 2020 2020 2020  self,.          
-00010950: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00010960: 2020 7368 7029 3a20 2320 7468 6520 6e61    shp): # the na
-00010970: 6d65 206f 6620 5348 5020 696e 636c 7564  me of SHP includ
-00010980: 696e 6720 7061 7468 2077 6974 6820 5747  ing path with WG
-00010990: 5331 3938 3420 7072 6f6a 6563 7469 6f6e  S1984 projection
-000109a0: 0a20 2020 2020 2020 2022 2222 0a20 2020  .        """.   
-000109b0: 2020 2020 2040 2061 7574 686f 723a 2020       @ author:  
-000109c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000109d0: 5368 6572 7661 6e20 4768 6172 6172 690a  Shervan Gharari.
-000109e0: 2020 2020 2020 2020 4020 4769 7468 7562          @ Github
-000109f0: 3a20 2020 2020 2020 2020 2020 2020 2020  :               
-00010a00: 2020 2068 7474 7073 3a2f 2f67 6974 6875     https://githu
-00010a10: 622e 636f 6d2f 5368 6572 7661 6e47 6861  b.com/ShervanGha
-00010a20: 7261 7269 2f45 4153 594d 4f52 450a 2020  rari/EASYMORE.  
-00010a30: 2020 2020 2020 4020 6175 7468 6f72 2773        @ author's
-00010a40: 2065 6d61 696c 2069 643a 2020 2020 2020   email id:      
-00010a50: 2073 682e 6768 6172 6172 6940 676d 6169   sh.gharari@gmai
-00010a60: 6c2e 636f 6d0a 2020 2020 2020 2020 4020  l.com.        @ 
-00010a70: 6c69 6365 6e73 653a 2020 2020 2020 2020  license:        
-00010a80: 2020 2020 2020 2020 2047 4e55 2d47 504c           GNU-GPL
-00010a90: 7633 0a20 2020 2020 2020 2054 6869 7320  v3.        This 
-00010aa0: 6675 6e63 7469 6f6e 2072 6561 6473 2061  function reads a
-00010ab0: 2073 6861 7065 6669 6c65 2061 6e64 2066   shapefile and f
-00010ac0: 6f72 206c 6f6e 6769 7475 6465 206f 6620  or longitude of 
-00010ad0: 6d6f 6465 6c20 7468 616e 2031 3830 2069  model than 180 i
-00010ae0: 7420 636f 7272 6563 7420 6974 2074 6f20  t correct it to 
-00010af0: 6120 6672 616d 6520 6f66 202d 3138 3020  a frame of -180 
-00010b00: 746f 2031 3830 0a20 2020 2020 2020 202d  to 180.        -
-00010b10: 2d2d 2d2d 2d2d 2d2d 0a20 2020 2020 2020  --------.       
-00010b20: 2073 6870 3a20 6765 6f70 616e 6461 7320   shp: geopandas 
-00010b30: 7368 6170 6566 696c 650a 2020 2020 2020  shapefile.      
-00010b40: 2020 5265 7475 726e 730a 2020 2020 2020    Returns.      
-00010b50: 2020 2d2d 2d2d 2d2d 2d0a 2020 2020 2020    -------.      
-00010b60: 2020 7368 705f 6669 6e61 6c3a 2067 656f    shp_final: geo
-00010b70: 7061 6e64 6173 2073 6861 7065 6669 6c65  pandas shapefile
-00010b80: 2063 6f72 7265 6374 6564 2069 6e20 7468   corrected in th
-00010b90: 6520 6672 616d 6520 6f66 202d 3138 3020  e frame of -180 
-00010ba0: 746f 2031 3830 0a20 2020 2020 2020 2022  to 180.        "
-00010bb0: 2222 0a20 2020 2020 2020 2023 206c 6f61  "".        # loa
-00010bc0: 6469 6e67 2074 6865 206e 6565 6465 6420  ding the needed 
-00010bd0: 7061 636b 6167 6564 0a20 2020 2020 2020  packaged.       
-00010be0: 2069 6d70 6f72 7420 6765 6f70 616e 6461   import geopanda
-00010bf0: 7320 6173 2067 7064 0a20 2020 2020 2020  s as gpd.       
-00010c00: 2069 6d70 6f72 7420 7061 6e64 6173 2061   import pandas a
-00010c10: 7320 7064 0a20 2020 2020 2020 2066 726f  s pd.        fro
-00010c20: 6d20 2020 7368 6170 656c 792e 6765 6f6d  m   shapely.geom
-00010c30: 6574 7279 2069 6d70 6f72 7420 506f 6c79  etry import Poly
-00010c40: 676f 6e0a 2020 2020 2020 2020 696d 706f  gon.        impo
-00010c50: 7274 2073 6861 7065 6c79 0a20 2020 2020  rt shapely.     
-00010c60: 2020 2023 2069 6620 6e6f 2063 7273 2073     # if no crs s
-00010c70: 6574 2074 6f20 6570 7367 3a34 3332 360a  et to epsg:4326.
-00010c80: 2020 2020 2020 2020 6966 206e 6f74 2073          if not s
-00010c90: 6870 2e63 7273 3a0a 2020 2020 2020 2020  hp.crs:.        
-00010ca0: 2020 2020 7072 696e 7428 2769 6e73 6964      print('insid
-00010cb0: 6520 7368 705f 6c6f 6e5f 636f 7272 6563  e shp_lon_correc
-00010cc0: 7469 6f6e 2c20 6e6f 2063 7273 2069 7320  tion, no crs is 
-00010cd0: 7072 6f76 6964 6564 2066 6f72 2074 6865  provided for the
-00010ce0: 2073 6861 7065 6669 6c65 3b20 4541 5359   shapefile; EASY
-00010cf0: 4d4f 5245 2077 696c 6c20 616c 6c6f 6361  MORE will alloca
-00010d00: 7465 2057 4753 3834 205c 0a74 6f20 636f  te WGS84 \.to co
-00010d10: 7272 6563 7420 666f 7220 6c6f 6e20 6162  rrect for lon ab
-00010d20: 6f76 6520 3138 3027 290a 2020 2020 2020  ove 180').      
-00010d30: 2020 2020 2020 7368 7020 3d20 7368 702e        shp = shp.
-00010d40: 7365 745f 6372 7328 2265 7073 673a 3433  set_crs("epsg:43
-00010d50: 3236 2229 0a20 2020 2020 2020 2023 0a20  26").        #. 
-00010d60: 2020 2020 2020 2063 6f6c 5f6e 616d 6573         col_names
-00010d70: 203d 2073 6870 2e63 6f6c 756d 6e73 2e74   = shp.columns.t
-00010d80: 6f5f 6c69 7374 2829 0a20 2020 2020 2020  o_list().       
-00010d90: 2063 6f6c 5f6e 616d 6573 2e72 656d 6f76   col_names.remov
-00010da0: 6528 2767 656f 6d65 7472 7927 290a 2020  e('geometry').  
-00010db0: 2020 2020 2020 6466 5f61 7474 7269 6275        df_attribu
-00010dc0: 7465 203d 2070 642e 4461 7461 4672 616d  te = pd.DataFram
-00010dd0: 6528 290a 2020 2020 2020 2020 6966 2063  e().        if c
-00010de0: 6f6c 5f6e 616d 6573 3a0a 2020 2020 2020  ol_names:.      
-00010df0: 2020 2020 2020 6466 5f61 7474 7269 6275        df_attribu
-00010e00: 7465 203d 2073 6870 2e64 726f 7028 636f  te = shp.drop(co
-00010e10: 6c75 6d6e 7320 3d20 2767 656f 6d65 7472  lumns = 'geometr
-00010e20: 7927 290a 2020 2020 2020 2020 7368 7020  y').        shp 
-00010e30: 3d20 7368 702e 6472 6f70 2863 6f6c 756d  = shp.drop(colum
-00010e40: 6e73 203d 2063 6f6c 5f6e 616d 6573 290a  ns = col_names).
-00010e50: 2020 2020 2020 2020 7368 705b 2749 4427          shp['ID'
-00010e60: 5d20 3d20 6e70 2e61 7261 6e67 6528 6c65  ] = np.arange(le
-00010e70: 6e28 7368 7029 292b 310a 2020 2020 2020  n(shp))+1.      
-00010e80: 2020 2320 6765 7420 7468 6520 6d61 7869    # get the maxi
-00010e90: 6d75 6d20 616e 6420 6d69 6e69 6d75 6d20  mum and minimum 
-00010ea0: 626f 756e 6420 6f66 2074 6865 2074 6f74  bound of the tot
-00010eb0: 616c 2062 6f75 6e64 0a20 2020 2020 2020  al bound.       
-00010ec0: 206d 696e 5f6c 6f6e 2c20 6d69 6e5f 6c61   min_lon, min_la
-00010ed0: 742c 206d 6178 5f6c 6f6e 2c20 6d61 785f  t, max_lon, max_
-00010ee0: 6c61 7420 3d20 7368 702e 746f 7461 6c5f  lat = shp.total_
-00010ef0: 626f 756e 6473 0a20 2020 2020 2020 2069  bounds.        i
-00010f00: 6620 2833 3630 203c 206d 6178 5f6c 6f6e  f (360 < max_lon
-00010f10: 2920 616e 6420 286d 696e 5f6c 6f6e 3c30  ) and (min_lon<0
-00010f20: 293a 0a20 2020 2020 2020 2020 2020 2073  ):.            s
-00010f30: 7973 2e65 7869 7428 2754 6865 206d 696e  ys.exit('The min
-00010f40: 696d 756d 206c 6f6e 6769 7475 6465 2069  imum longitude i
-00010f50: 7320 6869 6768 6572 2074 6861 6e20 3336  s higher than 36
-00010f60: 3020 7768 696c 6520 7468 6520 6d69 6e69  0 while the mini
-00010f70: 6d75 6d20 6c6f 6e67 6974 7564 6520 6973  mum longitude is
-00010f80: 206c 6f77 6572 2074 6861 7420 3027 290a   lower that 0').
-00010f90: 2020 2020 2020 2020 6966 2028 6d61 785f          if (max_
-00010fa0: 6c6f 6e20 3c20 3138 3029 2061 6e64 2028  lon < 180) and (
-00010fb0: 2d31 3830 203c 206d 696e 5f6c 6f6e 293a  -180 < min_lon):
-00010fc0: 0a20 2020 2020 2020 2020 2020 2070 7269  .            pri
-00010fd0: 6e74 2827 4541 5359 4d4f 5245 2064 6574  nt('EASYMORE det
-00010fe0: 6563 7473 2074 6861 7420 7368 6170 6566  ects that shapef
-00010ff0: 696c 6520 6c6f 6e67 6974 7564 6520 6973  ile longitude is
-00011000: 2062 6574 7765 656e 202d 3138 3020 616e   between -180 an
-00011010: 6420 3138 302c 206e 6f20 636f 7272 6563  d 180, no correc
-00011020: 7469 6f6e 2069 7320 7065 7266 6f72 6d65  tion is performe
-00011030: 6427 290a 2020 2020 2020 2020 2020 2020  d').            
-00011040: 7368 705f 6669 6e61 6c20 3d20 7368 700a  shp_final = shp.
-00011050: 2020 2020 2020 2020 656c 7365 3a0a 2020          else:.  
-00011060: 2020 2020 2020 2020 2020 7368 705f 696e            shp_in
-00011070: 7431 203d 2070 642e 4461 7461 4672 616d  t1 = pd.DataFram
-00011080: 6528 290a 2020 2020 2020 2020 2020 2020  e().            
-00011090: 7368 705f 696e 7432 203d 2070 642e 4461  shp_int2 = pd.Da
-000110a0: 7461 4672 616d 6528 290a 2020 2020 2020  taFrame().      
-000110b0: 2020 2020 2020 2320 696e 7465 7273 6563        # intersec
-000110c0: 7469 6f6e 2069 6620 7368 7020 6861 7320  tion if shp has 
-000110d0: 6120 6c61 7267 6572 206c 6f6e 206f 6620  a larger lon of 
-000110e0: 3138 3020 736f 2069 7420 6973 2030 2074  180 so it is 0 t
-000110f0: 6f20 3336 302c 0a20 2020 2020 2020 2020  o 360,.         
-00011100: 2020 2069 6620 2831 3830 203c 206d 6178     if (180 < max
-00011110: 5f6c 6f6e 2920 616e 6420 282d 3138 3020  _lon) and (-180 
-00011120: 3c20 6d69 6e5f 6c6f 6e29 3a0a 2020 2020  < min_lon):.    
-00011130: 2020 2020 2020 2020 2020 2020 7072 696e              prin
-00011140: 7428 2745 4153 594d 4f52 4520 6465 7465  t('EASYMORE dete
-00011150: 6374 7320 7468 6174 2073 6861 7065 6669  cts that shapefi
-00011160: 6c65 206c 6f6e 6769 7475 6465 2069 7320  le longitude is 
-00011170: 6265 7477 6565 6e20 3020 616e 6420 3336  between 0 and 36
-00011180: 302c 2063 6f72 7265 6374 696f 6e20 6973  0, correction is
-00011190: 2070 6572 666f 726d 6564 2074 6f20 7472   performed to tr
-000111a0: 616e 7366 6572 2074 6f20 2d31 3830 2074  ansfer to -180 t
-000111b0: 6f20 3138 3027 290a 2020 2020 2020 2020  o 180').        
-000111c0: 2020 2020 2020 2020 2320 7368 6170 6566          # shapef
-000111d0: 696c 6520 7769 7468 2031 3830 2074 6f20  ile with 180 to 
-000111e0: 3336 3020 6c6f 6e0a 2020 2020 2020 2020  360 lon.        
-000111f0: 2020 2020 2020 2020 6764 6631 203d 207b          gdf1 = {
-00011200: 2767 656f 6d65 7472 7927 3a20 5b50 6f6c  'geometry': [Pol
-00011210: 7967 6f6e 285b 2820 2031 3830 2e30 2b73  ygon([(  180.0+s
-00011220: 656c 662e 746f 6c65 7261 6e63 652c 202d  elf.tolerance, -
-00011230: 3930 2e30 2b73 656c 662e 746f 6c65 7261  90.0+self.tolera
-00011240: 6e63 6529 2c20 2820 3138 302e 302b 7365  nce), ( 180.0+se
-00011250: 6c66 2e74 6f6c 6572 616e 6365 2c20 2039  lf.tolerance,  9
-00011260: 302e 302d 7365 6c66 2e74 6f6c 6572 616e  0.0-self.toleran
-00011270: 6365 292c 5c0a 2020 2020 2020 2020 2020  ce),\.          
-00011280: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00011290: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000112a0: 2020 2020 2820 2033 3630 2e30 2d73 656c      (  360.0-sel
-000112b0: 662e 746f 6c65 7261 6e63 652c 2020 3930  f.tolerance,  90
-000112c0: 2e30 2d73 656c 662e 746f 6c65 7261 6e63  .0-self.toleranc
-000112d0: 6529 2c20 2820 3336 302e 302d 7365 6c66  e), ( 360.0-self
-000112e0: 2e74 6f6c 6572 616e 6365 2c20 2d39 302e  .tolerance, -90.
-000112f0: 302b 7365 6c66 2e74 6f6c 6572 616e 6365  0+self.tolerance
-00011300: 295d 295d 7d0a 2020 2020 2020 2020 2020  )])]}.          
-00011310: 2020 2020 2020 6764 6631 203d 2067 7064        gdf1 = gpd
-00011320: 2e47 656f 4461 7461 4672 616d 6528 6764  .GeoDataFrame(gd
-00011330: 6631 290a 2020 2020 2020 2020 2020 2020  f1).            
-00011340: 2020 2020 6764 6631 203d 2067 6466 312e      gdf1 = gdf1.
-00011350: 7365 745f 6372 7320 2822 6570 7367 3a34  set_crs ("epsg:4
-00011360: 3332 3622 290a 2020 2020 2020 2020 2020  326").          
-00011370: 2020 2020 2020 7761 726e 696e 6773 2e73        warnings.s
-00011380: 696d 706c 6566 696c 7465 7228 2769 676e  implefilter('ign
-00011390: 6f72 6527 290a 2020 2020 2020 2020 2020  ore').          
-000113a0: 2020 2020 2020 7368 705f 696e 7431 203d        shp_int1 =
-000113b0: 2073 656c 662e 696e 7465 7273 6563 7469   self.intersecti
-000113c0: 6f6e 5f73 6870 2873 6870 2c20 6764 6631  on_shp(shp, gdf1
-000113d0: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
-000113e0: 2020 7761 726e 696e 6773 2e73 696d 706c    warnings.simpl
-000113f0: 6566 696c 7465 7228 2764 6566 6175 6c74  efilter('default
-00011400: 2729 0a20 2020 2020 2020 2020 2020 2020  ').             
-00011410: 2020 2063 6f6c 5f6e 616d 6573 203d 2073     col_names = s
-00011420: 6870 5f69 6e74 312e 636f 6c75 6d6e 730a  hp_int1.columns.
+0000dab0: 696e 7428 2745 4153 594d 4f52 4520 6465  int('EASYMORE de
+0000dac0: 6369 6465 7320 7468 6520 6e65 7443 4446  cides the netCDF
+0000dad0: 2066 696c 6520 6861 7320 6c6f 6e67 7469   file has longti
+0000dae0: 7475 6465 2076 616c 7565 7320 6f66 202d  tude values of -
+0000daf0: 3138 3020 746f 2031 3830 3b20 6372 6561  180 to 180; crea
+0000db00: 7469 6e67 2074 6865 2065 7874 656e 6465  ting the extende
+0000db10: 6427 290a 2020 2020 2020 2020 2020 2020  d').            
+0000db20: 2020 2020 7368 7031 203d 2073 6870 205b      shp1 = shp [
+0000db30: 7368 705b 276c 6f6e 5f73 275d 203e 2020  shp['lon_s'] >  
+0000db40: 2030 5d0a 2020 2020 2020 2020 2020 2020   0].            
+0000db50: 2020 2020 7368 7032 203d 2073 6870 205b      shp2 = shp [
+0000db60: 7368 705b 276c 6f6e 5f73 275d 203c 3d20  shp['lon_s'] <= 
+0000db70: 2030 5d0a 2020 2020 2020 2020 2020 2020   0].            
+0000db80: 2020 2020 6966 206e 6f74 2073 6870 312e      if not shp1.
+0000db90: 656d 7074 793a 0a20 2020 2020 2020 2020  empty:.         
+0000dba0: 2020 2020 2020 2020 2020 2073 6870 312e             shp1.
+0000dbb0: 746f 5f66 696c 6528 7465 6d70 5f64 6972  to_file(temp_dir
+0000dbc0: 2b63 6173 655f 6e61 6d65 2b27 5f73 6f75  +case_name+'_sou
+0000dbd0: 7263 655f 7368 6170 6566 696c 6541 2e73  rce_shapefileA.s
+0000dbe0: 6870 2729 0a20 2020 2020 2020 2020 2020  hp').           
+0000dbf0: 2020 2020 2020 2020 2073 6870 3120 3d20           shp1 = 
+0000dc00: 6770 642e 7265 6164 5f66 696c 6528 7465  gpd.read_file(te
+0000dc10: 6d70 5f64 6972 2b63 6173 655f 6e61 6d65  mp_dir+case_name
+0000dc20: 2b27 5f73 6f75 7263 655f 7368 6170 6566  +'_source_shapef
+0000dc30: 696c 6541 2e73 6870 2729 0a20 2020 2020  ileA.shp').     
+0000dc40: 2020 2020 2020 2020 2020 2020 2020 2074                 t
+0000dc50: 656d 7020 3d20 7368 7031 0a20 2020 2020  emp = shp1.     
+0000dc60: 2020 2020 2020 2020 2020 2069 6620 6e6f             if no
+0000dc70: 7420 7368 7032 2e65 6d70 7479 3a0a 2020  t shp2.empty:.  
+0000dc80: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000dc90: 2020 7368 7032 2e74 6f5f 6669 6c65 2874    shp2.to_file(t
+0000dca0: 656d 705f 6469 722b 6361 7365 5f6e 616d  emp_dir+case_nam
+0000dcb0: 652b 275f 736f 7572 6365 5f73 6861 7065  e+'_source_shape
+0000dcc0: 6669 6c65 422e 7368 7027 290a 2020 2020  fileB.shp').    
+0000dcd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000dce0: 7368 7032 203d 2067 7064 2e72 6561 645f  shp2 = gpd.read_
+0000dcf0: 6669 6c65 2874 656d 705f 6469 722b 6361  file(temp_dir+ca
+0000dd00: 7365 5f6e 616d 652b 275f 736f 7572 6365  se_name+'_source
+0000dd10: 5f73 6861 7065 6669 6c65 422e 7368 7027  _shapefileB.shp'
+0000dd20: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
+0000dd30: 2020 2020 2020 7368 7033 203d 2067 7064        shp3 = gpd
+0000dd40: 2e72 6561 645f 6669 6c65 2874 656d 705f  .read_file(temp_
+0000dd50: 6469 722b 6361 7365 5f6e 616d 652b 275f  dir+case_name+'_
+0000dd60: 736f 7572 6365 5f73 6861 7065 6669 6c65  source_shapefile
+0000dd70: 422e 7368 7027 290a 2020 2020 2020 2020  B.shp').        
+0000dd80: 2020 2020 2020 2020 2020 2020 2320 6c6f              # lo
+0000dd90: 6f70 2063 6861 6e67 6520 7468 6520 6765  op change the ge
+0000dda0: 6f6d 6574 7279 0a20 2020 2020 2020 2020  ometry.         
+0000ddb0: 2020 2020 2020 2020 2020 2066 6f72 2069             for i
+0000ddc0: 6e64 6578 2c20 5f20 696e 2073 6870 332e  ndex, _ in shp3.
+0000ddd0: 6974 6572 726f 7773 2829 3a0a 2020 2020  iterrows():.    
+0000dde0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000ddf0: 2020 2020 706f 6c79 7320 3d20 7368 7033      polys = shp3
+0000de00: 2e67 656f 6d65 7472 792e 696c 6f63 5b69  .geometry.iloc[i
+0000de10: 6e64 6578 5d20 2320 6765 7420 7468 6520  ndex] # get the 
+0000de20: 7368 6170 650a 2020 2020 2020 2020 2020  shape.          
+0000de30: 2020 2020 2020 2020 2020 2020 2020 706f                po
+0000de40: 6c79 7320 3d20 7368 6170 656c 792e 6166  lys = shapely.af
+0000de50: 6669 6e69 7479 2e74 7261 6e73 6c61 7465  finity.translate
+0000de60: 2870 6f6c 7973 2c20 786f 6666 3d2b 3336  (polys, xoff=+36
+0000de70: 302e 302c 2079 6f66 663d 302e 302c 207a  0.0, yoff=0.0, z
+0000de80: 6f66 663d 302e 3029 0a20 2020 2020 2020  off=0.0).       
+0000de90: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000dea0: 2073 6870 332e 6765 6f6d 6574 7279 2e69   shp3.geometry.i
+0000deb0: 6c6f 635b 696e 6465 785d 203d 2070 6f6c  loc[index] = pol
+0000dec0: 7973 0a20 2020 2020 2020 2020 2020 2020  ys.             
+0000ded0: 2020 2020 2020 2073 6870 332e 746f 5f66         shp3.to_f
+0000dee0: 696c 6528 7465 6d70 5f64 6972 2b63 6173  ile(temp_dir+cas
+0000def0: 655f 6e61 6d65 2b27 5f73 6f75 7263 655f  e_name+'_source_
+0000df00: 7368 6170 6566 696c 6543 2e73 6870 2729  shapefileC.shp')
+0000df10: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0000df20: 2020 2020 2073 6870 3320 3d20 6770 642e       shp3 = gpd.
+0000df30: 7265 6164 5f66 696c 6528 7465 6d70 5f64  read_file(temp_d
+0000df40: 6972 2b63 6173 655f 6e61 6d65 2b27 5f73  ir+case_name+'_s
+0000df50: 6f75 7263 655f 7368 6170 6566 696c 6543  ource_shapefileC
+0000df60: 2e73 6870 2729 0a20 2020 2020 2020 2020  .shp').         
+0000df70: 2020 2020 2020 2020 2020 2074 656d 7020             temp 
+0000df80: 3d20 6770 642e 4765 6f44 6174 6146 7261  = gpd.GeoDataFra
+0000df90: 6d65 2820 7064 2e63 6f6e 6361 7428 205b  me( pd.concat( [
+0000dfa0: 7368 7033 2c73 6870 325d 202c 2069 676e  shp3,shp2] , ign
+0000dfb0: 6f72 655f 696e 6465 783d 5472 7565 2020  ore_index=True  
+0000dfc0: 2920 290a 2020 2020 2020 2020 2020 2020  ) ).            
+0000dfd0: 2020 2020 2020 2020 6966 206e 6f74 2073          if not s
+0000dfe0: 6870 312e 656d 7074 793a 0a20 2020 2020  hp1.empty:.     
+0000dff0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000e000: 2020 2074 656d 7020 3d20 6770 642e 4765     temp = gpd.Ge
+0000e010: 6f44 6174 6146 7261 6d65 2820 7064 2e63  oDataFrame( pd.c
+0000e020: 6f6e 6361 7428 205b 7465 6d70 2c73 6870  oncat( [temp,shp
+0000e030: 315d 202c 2069 676e 6f72 655f 696e 6465  1] , ignore_inde
+0000e040: 783d 5472 7565 2029 2020 290a 2020 2020  x=True )  ).    
+0000e050: 2020 2020 2020 2020 2020 2020 7465 6d70              temp
+0000e060: 2e74 6f5f 6669 6c65 2874 656d 705f 6469  .to_file(temp_di
+0000e070: 722b 6361 7365 5f6e 616d 652b 275f 736f  r+case_name+'_so
+0000e080: 7572 6365 5f73 6861 7065 6669 6c65 5f65  urce_shapefile_e
+0000e090: 7870 616e 6465 642e 7368 7027 290a 2020  xpanded.shp').  
+0000e0a0: 2020 2020 2020 2020 2020 656c 7365 3a0a            else:.
+0000e0b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000e0c0: 7379 732e 6578 6974 2827 4541 5359 4d4f  sys.exit('EASYMO
+0000e0d0: 5245 2063 616e 6e6f 7420 6465 6369 6465  RE cannot decide
+0000e0e0: 2061 626f 7574 2074 6865 206c 6174 2061   about the lat a
+0000e0f0: 6e64 206c 6f6e 206f 6620 7468 6520 7368  nd lon of the sh
+0000e100: 6170 6566 696c 6573 2729 0a20 2020 2020  apefiles').     
+0000e110: 2020 2072 6573 756c 7420 3d20 6770 642e     result = gpd.
+0000e120: 7265 6164 5f66 696c 6528 7465 6d70 5f64  read_file(temp_d
+0000e130: 6972 2b63 6173 655f 6e61 6d65 2b27 5f73  ir+case_name+'_s
+0000e140: 6f75 7263 655f 7368 6170 6566 696c 655f  ource_shapefile_
+0000e150: 6578 7061 6e64 6564 2e73 6870 2729 0a20  expanded.shp'). 
+0000e160: 2020 2020 2020 2072 6574 7572 6e20 7265         return re
+0000e170: 7375 6c74 0a0a 2020 2020 6465 6620 6372  sult..    def cr
+0000e180: 6561 7465 5f72 656d 6170 2820 2020 7365  eate_remap(   se
+0000e190: 6c66 2c0a 2020 2020 2020 2020 2020 2020  lf,.            
+0000e1a0: 2020 2020 2020 2020 2020 2020 696e 745f              int_
+0000e1b0: 6466 2c0a 2020 2020 2020 2020 2020 2020  df,.            
+0000e1c0: 2020 2020 2020 2020 2020 2020 6c61 745f              lat_
+0000e1d0: 736f 7572 6365 2c0a 2020 2020 2020 2020  source,.        
+0000e1e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000e1f0: 6c6f 6e5f 736f 7572 6365 293a 0a20 2020  lon_source):.   
+0000e200: 2020 2020 2022 2222 0a20 2020 2020 2020       """.       
+0000e210: 2040 2061 7574 686f 723a 2020 2020 2020   @ author:      
+0000e220: 2020 2020 2020 2020 2020 2020 5368 6572              Sher
+0000e230: 7661 6e20 4768 6172 6172 690a 2020 2020  van Gharari.    
+0000e240: 2020 2020 4020 4769 7468 7562 3a20 2020      @ Github:   
+0000e250: 2020 2020 2020 2020 2020 2020 2020 2068                 h
+0000e260: 7474 7073 3a2f 2f67 6974 6875 622e 636f  ttps://github.co
+0000e270: 6d2f 5368 6572 7661 6e47 6861 7261 7269  m/ShervanGharari
+0000e280: 2f45 4153 594d 4f52 450a 2020 2020 2020  /EASYMORE.      
+0000e290: 2020 4020 6175 7468 6f72 2773 2065 6d61    @ author's ema
+0000e2a0: 696c 2069 643a 2020 2020 2020 2073 682e  il id:       sh.
+0000e2b0: 6768 6172 6172 6940 676d 6169 6c2e 636f  gharari@gmail.co
+0000e2c0: 6d0a 2020 2020 2020 2020 4020 6c69 6365  m.        @ lice
+0000e2d0: 6e73 653a 2020 2020 2020 2020 2020 2020  nse:            
+0000e2e0: 2020 2020 2047 4e55 2d47 504c 7633 0a20       GNU-GPLv3. 
+0000e2f0: 2020 2020 2020 2074 6869 7320 6675 6e63         this func
+0000e300: 7469 6f6e 2061 6464 2074 6865 2063 6f72  tion add the cor
+0000e310: 7265 7370 6f6e 7369 6e67 2072 6f77 2061  responsing row a
+0000e320: 6e64 2063 6f6c 756d 6e73 2066 726f 6d20  nd columns from 
+0000e330: 7468 6520 736f 7572 6365 204e 6574 4344  the source NetCD
+0000e340: 4620 6669 6c65 0a20 2020 2020 2020 2050  F file.        P
+0000e350: 6172 616d 6574 6572 730a 2020 2020 2020  arameters.      
+0000e360: 2020 2d2d 2d2d 2d2d 2d2d 2d2d 0a20 2020    ----------.   
+0000e370: 2020 2020 2069 6e74 5f64 663a 2069 6e74       int_df: int
+0000e380: 6572 7365 6374 6564 2064 6174 6120 6672  ersected data fr
+0000e390: 616d 6520 7468 6174 2069 6e63 6c75 6465  ame that include
+0000e3a0: 7320 7468 6520 696e 6672 6f6d 6174 696f  s the infromatio
+0000e3b0: 6e20 666f 7220 736f 7572 6365 2061 6e64  n for source and
+0000e3c0: 2073 696e 6b0a 2020 2020 2020 2020 6c61   sink.        la
+0000e3d0: 745f 736f 7572 6365 3a20 6e75 6d70 7920  t_source: numpy 
+0000e3e0: 6172 7261 7920 6f66 2073 6f75 7263 6520  array of source 
+0000e3f0: 6c61 740a 2020 2020 2020 2020 6c6f 6e5f  lat.        lon_
+0000e400: 736f 7572 6365 3a20 6e75 6d70 7920 6172  source: numpy ar
+0000e410: 7261 7920 6f66 2073 6f75 7263 6520 6c6f  ray of source lo
+0000e420: 6e0a 2020 2020 2020 2020 5265 7475 726e  n.        Return
+0000e430: 730a 2020 2020 2020 2020 2d2d 2d2d 2d2d  s.        ------
+0000e440: 2d0a 2020 2020 2020 2020 696e 745f 6466  -.        int_df
+0000e450: 3a20 6461 7461 6672 616d 652c 2069 6e63  : dataframe, inc
+0000e460: 6c75 6469 6e67 2074 6865 2061 7373 6f63  luding the assoc
+0000e470: 6961 7465 6420 726f 7773 2061 6e64 2063  iated rows and c
+0000e480: 6f6c 7320 616e 6420 4541 5359 4d4f 5245  ols and EASYMORE
+0000e490: 2063 6173 650a 2020 2020 2020 2020 2222   case.        ""
+0000e4a0: 220a 2020 2020 2020 2020 2320 7468 6520  ".        # the 
+0000e4b0: 6c61 7420 6c6f 6e20 6672 6f6d 2074 6865  lat lon from the
+0000e4c0: 2069 6e74 6572 7365 6374 696f 6e2f 7265   intersection/re
+0000e4d0: 6d61 700a 2020 2020 2020 2020 6c61 745f  map.        lat_
+0000e4e0: 736f 7572 6365 5f69 6e74 203d 206e 702e  source_int = np.
+0000e4f0: 6172 7261 7928 696e 745f 6466 5b27 6c61  array(int_df['la
+0000e500: 745f 7327 5d29 0a20 2020 2020 2020 206c  t_s']).        l
+0000e510: 6f6e 5f73 6f75 7263 655f 696e 7420 3d20  on_source_int = 
+0000e520: 6e70 2e61 7272 6179 2869 6e74 5f64 665b  np.array(int_df[
+0000e530: 276c 6f6e 5f73 275d 290a 2020 2020 2020  'lon_s']).      
+0000e540: 2020 2320 6361 6c6c 2067 6574 2072 6f77    # call get row
+0000e550: 2061 6e64 2063 6f6c 2066 756e 6374 696f   and col functio
+0000e560: 6e0a 2020 2020 2020 2020 726f 7773 2c20  n.        rows, 
+0000e570: 636f 6c73 203d 2073 656c 662e 6372 6561  cols = self.crea
+0000e580: 7465 5f72 6f77 5f63 6f6c 5f64 6620 286c  te_row_col_df (l
+0000e590: 6174 5f73 6f75 7263 652c 206c 6f6e 5f73  at_source, lon_s
+0000e5a0: 6f75 7263 652c 206c 6174 5f73 6f75 7263  ource, lat_sourc
+0000e5b0: 655f 696e 742c 206c 6f6e 5f73 6f75 7263  e_int, lon_sourc
+0000e5c0: 655f 696e 7429 0a20 2020 2020 2020 2023  e_int).        #
+0000e5d0: 2061 6464 2072 6f77 7320 616e 6420 636f   add rows and co
+0000e5e0: 6c75 6d6e 730a 2020 2020 2020 2020 696e  lumns.        in
+0000e5f0: 745f 6466 5b27 726f 7773 275d 203d 2072  t_df['rows'] = r
+0000e600: 6f77 730a 2020 2020 2020 2020 696e 745f  ows.        int_
+0000e610: 6466 5b27 636f 6c73 275d 203d 2063 6f6c  df['cols'] = col
+0000e620: 730a 2020 2020 2020 2020 2320 7061 7373  s.        # pass
+0000e630: 2074 6865 2063 6173 6520 746f 2074 6865   the case to the
+0000e640: 2072 656d 6170 5f64 660a 2020 2020 2020   remap_df.      
+0000e650: 2020 696e 745f 6466 5b27 6561 7379 6d6f    int_df['easymo
+0000e660: 7265 5f63 6173 6527 5d20 3d20 7365 6c66  re_case'] = self
+0000e670: 2e63 6173 650a 2020 2020 2020 2020 2320  .case.        # 
+0000e680: 7361 7665 2072 656d 6170 5f64 6620 6173  save remap_df as
+0000e690: 2063 7376 2066 6f72 2066 7574 7572 6520   csv for future 
+0000e6a0: 7573 650a 2020 2020 2020 2020 7265 7475  use.        retu
+0000e6b0: 726e 2069 6e74 5f64 660a 0a20 2020 2064  rn int_df..    d
+0000e6c0: 6566 2063 7265 6174 655f 726f 775f 636f  ef create_row_co
+0000e6d0: 6c5f 6466 2028 2073 656c 662c 0a20 2020  l_df ( self,.   
+0000e6e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000e6f0: 2020 2020 2020 2020 206c 6174 5f73 6f75           lat_sou
+0000e700: 7263 652c 0a20 2020 2020 2020 2020 2020  rce,.           
+0000e710: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000e720: 206c 6f6e 5f73 6f75 7263 652c 0a20 2020   lon_source,.   
+0000e730: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000e740: 2020 2020 2020 2020 206c 6174 5f74 6172           lat_tar
+0000e750: 6765 745f 696e 742c 0a20 2020 2020 2020  get_int,.       
+0000e760: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000e770: 2020 2020 206c 6f6e 5f74 6172 6765 745f       lon_target_
+0000e780: 696e 7429 3a0a 2020 2020 2020 2020 2222  int):.        ""
+0000e790: 220a 2020 2020 2020 2020 4020 6175 7468  ".        @ auth
+0000e7a0: 6f72 3a20 2020 2020 2020 2020 2020 2020  or:             
+0000e7b0: 2020 2020 2053 6865 7276 616e 2047 6861       Shervan Gha
+0000e7c0: 7261 7269 0a20 2020 2020 2020 2040 2047  rari.        @ G
+0000e7d0: 6974 6875 623a 2020 2020 2020 2020 2020  ithub:          
+0000e7e0: 2020 2020 2020 2020 6874 7470 733a 2f2f          https://
+0000e7f0: 6769 7468 7562 2e63 6f6d 2f53 6865 7276  github.com/Sherv
+0000e800: 616e 4768 6172 6172 692f 4541 5359 4d4f  anGharari/EASYMO
+0000e810: 5245 0a20 2020 2020 2020 2040 2061 7574  RE.        @ aut
+0000e820: 686f 7227 7320 656d 6169 6c20 6964 3a20  hor's email id: 
+0000e830: 2020 2020 2020 7368 2e67 6861 7261 7269        sh.gharari
+0000e840: 4067 6d61 696c 2e63 6f6d 0a20 2020 2020  @gmail.com.     
+0000e850: 2020 2040 206c 6963 656e 7365 3a20 2020     @ license:   
+0000e860: 2020 2020 2020 2020 2020 2020 2020 474e                GN
+0000e870: 552d 4750 4c76 330a 2020 2020 2020 2020  U-GPLv3.        
+0000e880: 7468 6973 2066 7563 6e74 696f 6e20 6765  this fucntion ge
+0000e890: 7473 2074 6865 2072 6f77 2061 6e64 2063  ts the row and c
+0000e8a0: 6f6c 6f6d 6e73 206f 6620 7468 6520 736f  olomns of the so
+0000e8b0: 7572 6365 206e 6574 6364 6620 6669 6c65  urce netcdf file
+0000e8c0: 2061 6e64 2072 6574 7572 6e73 2069 740a   and returns it.
+0000e8d0: 2020 2020 2020 2020 2d2d 2d2d 2d2d 2d2d          --------
+0000e8e0: 2d2d 0a20 2020 2020 2020 206c 6174 5f73  --.        lat_s
+0000e8f0: 6f75 7263 653a 206e 756d 7079 2061 7272  ource: numpy arr
+0000e900: 6179 206f 6620 6c61 7420 736f 7572 6365  ay of lat source
+0000e910: 0a20 2020 2020 2020 206c 6f6e 5f73 6f75  .        lon_sou
+0000e920: 7263 653a 206e 756d 7079 2061 7272 6179  rce: numpy array
+0000e930: 206f 6620 6c6f 6e20 736f 7572 6365 0a20   of lon source. 
+0000e940: 2020 2020 2020 206c 6174 5f74 6172 6765         lat_targe
+0000e950: 745f 696e 743a 206e 756d 7079 2061 7272  t_int: numpy arr
+0000e960: 6179 206f 6620 6c61 7420 736f 7572 6365  ay of lat source
+0000e970: 0a20 2020 2020 2020 206c 6f6e 5f74 6172  .        lon_tar
+0000e980: 6765 745f 696e 743a 206e 756d 7079 2061  get_int: numpy a
+0000e990: 7272 6179 206f 6620 6c6f 6e20 736f 7572  rray of lon sour
+0000e9a0: 6365 0a20 2020 2020 2020 2052 6574 7572  ce.        Retur
+0000e9b0: 6e73 0a20 2020 2020 2020 202d 2d2d 2d2d  ns.        -----
+0000e9c0: 2d2d 0a20 2020 2020 2020 2072 6f77 733a  --.        rows:
+0000e9d0: 206e 756d 7079 2061 7272 6179 2c20 726f   numpy array, ro
+0000e9e0: 7773 2066 726f 6d20 7468 6520 736f 7572  ws from the sour
+0000e9f0: 6365 2066 696c 6520 6261 7365 6420 6f6e  ce file based on
+0000ea00: 2074 6865 2074 6172 6765 7420 6c61 742f   the target lat/
+0000ea10: 6c6f 6e0a 2020 2020 2020 2020 636f 6c73  lon.        cols
+0000ea20: 3a20 6e75 6d70 7920 6172 7261 792c 2063  : numpy array, c
+0000ea30: 6f6c 7320 6672 6f6d 2074 6865 2073 6f75  ols from the sou
+0000ea40: 7263 6520 6669 6c65 2062 6173 6564 206f  rce file based o
+0000ea50: 6e20 7468 6520 7461 7267 6574 206c 6174  n the target lat
+0000ea60: 2f6c 6f6e 0a20 2020 2020 2020 2022 2222  /lon.        """
+0000ea70: 0a20 2020 2020 2020 2023 2063 7265 6174  .        # creat
+0000ea80: 6520 7468 6520 726f 7773 2061 6e64 2063  e the rows and c
+0000ea90: 6f6c 730a 2020 2020 2020 2020 726f 7773  ols.        rows
+0000eaa0: 203d 206e 702e 7a65 726f 7328 6c65 6e28   = np.zeros(len(
+0000eab0: 6c61 745f 7461 7267 6574 5f69 6e74 2929  lat_target_int))
+0000eac0: 0a20 2020 2020 2020 2063 6f6c 7320 3d20  .        cols = 
+0000ead0: 6e70 2e7a 6572 6f73 286c 656e 286c 6f6e  np.zeros(len(lon
+0000eae0: 5f74 6172 6765 745f 696e 7429 290a 2020  _target_int)).  
+0000eaf0: 2020 2020 2020 2320 6c6f 6f70 2074 6f20        # loop to 
+0000eb00: 6669 6e64 2074 6865 2072 6f77 7320 616e  find the rows an
+0000eb10: 6420 636f 6c6f 6d6e 730a 2020 2020 2020  d colomns.      
+0000eb20: 2020 666f 7220 6920 696e 206e 702e 6172    for i in np.ar
+0000eb30: 616e 6765 286c 656e 286c 6174 5f74 6172  ange(len(lat_tar
+0000eb40: 6765 745f 696e 7429 293a 0a20 2020 2020  get_int)):.     
+0000eb50: 2020 2020 2020 206c 6174 5f6c 6f6e 5f76         lat_lon_v
+0000eb60: 616c 7565 5f64 6966 6620 3d20 6162 7328  alue_diff = abs(
+0000eb70: 6c61 745f 7461 7267 6574 5f69 6e74 5b69  lat_target_int[i
+0000eb80: 5d2d 6c61 745f 736f 7572 6365 292b 6162  ]-lat_source)+ab
+0000eb90: 7328 6c6f 6e5f 7461 7267 6574 5f69 6e74  s(lon_target_int
+0000eba0: 5b69 5d2d 6c6f 6e5f 736f 7572 6365 290a  [i]-lon_source).
+0000ebb0: 2020 2020 2020 2020 2020 2020 6966 2073              if s
+0000ebc0: 656c 662e 6361 7365 203d 3d20 3120 6f72  elf.case == 1 or
+0000ebd0: 2073 656c 662e 6361 7365 203d 3d20 323a   self.case == 2:
+0000ebe0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0000ebf0: 2072 6f77 2c20 636f 6c20 3d20 6e70 2e77   row, col = np.w
+0000ec00: 6865 7265 286c 6174 5f6c 6f6e 5f76 616c  here(lat_lon_val
+0000ec10: 7565 5f64 6966 6620 3d3d 206e 702e 6d69  ue_diff == np.mi
+0000ec20: 6e28 6c61 745f 6c6f 6e5f 7661 6c75 655f  n(lat_lon_value_
+0000ec30: 6469 6666 2929 0a20 2020 2020 2020 2020  diff)).         
+0000ec40: 2020 2069 6620 7365 6c66 2e63 6173 6520     if self.case 
+0000ec50: 3d3d 2033 3a0a 2020 2020 2020 2020 2020  == 3:.          
+0000ec60: 2020 2020 2020 726f 7720 3d20 6e70 2e77        row = np.w
+0000ec70: 6865 7265 286c 6174 5f6c 6f6e 5f76 616c  here(lat_lon_val
+0000ec80: 7565 5f64 6966 6620 3d3d 206e 702e 6d69  ue_diff == np.mi
+0000ec90: 6e28 6c61 745f 6c6f 6e5f 7661 6c75 655f  n(lat_lon_value_
+0000eca0: 6469 6666 2929 0a20 2020 2020 2020 2020  diff)).         
+0000ecb0: 2020 2020 2020 2063 6f6c 203d 2072 6f77         col = row
+0000ecc0: 0a20 2020 2020 2020 2020 2020 2072 6f77  .            row
+0000ecd0: 7320 5b69 5d20 3d20 726f 775b 305d 0a20  s [i] = row[0]. 
+0000ece0: 2020 2020 2020 2020 2020 2063 6f6c 7320             cols 
+0000ecf0: 5b69 5d20 3d20 636f 6c5b 305d 0a20 2020  [i] = col[0].   
+0000ed00: 2020 2020 2023 2070 6173 7320 746f 2063       # pass to c
+0000ed10: 6c61 7373 0a20 2020 2020 2020 2072 6574  lass.        ret
+0000ed20: 7572 6e20 726f 7773 2c20 636f 6c73 0a0a  urn rows, cols..
+0000ed30: 2020 2020 6465 6620 6368 6563 6b5f 6561      def check_ea
+0000ed40: 7379 6d6f 7265 5f72 656d 6170 2873 656c  symore_remap(sel
+0000ed50: 662c 0a20 2020 2020 2020 2020 2020 2020  f,.             
+0000ed60: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000ed70: 7265 6d61 705f 6466 293a 0a20 2020 2020  remap_df):.     
+0000ed80: 2020 2022 2222 0a20 2020 2020 2020 2040     """.        @
+0000ed90: 2061 7574 686f 723a 2020 2020 2020 2020   author:        
+0000eda0: 2020 2020 2020 2020 2020 5368 6572 7661            Sherva
+0000edb0: 6e20 4768 6172 6172 690a 2020 2020 2020  n Gharari.      
+0000edc0: 2020 4020 4769 7468 7562 3a20 2020 2020    @ Github:     
+0000edd0: 2020 2020 2020 2020 2020 2020 2068 7474               htt
+0000ede0: 7073 3a2f 2f67 6974 6875 622e 636f 6d2f  ps://github.com/
+0000edf0: 5368 6572 7661 6e47 6861 7261 7269 2f45  ShervanGharari/E
+0000ee00: 4153 594d 4f52 450a 2020 2020 2020 2020  ASYMORE.        
+0000ee10: 4020 6175 7468 6f72 2773 2065 6d61 696c  @ author's email
+0000ee20: 2069 643a 2020 2020 2020 2073 682e 6768   id:       sh.gh
+0000ee30: 6172 6172 6940 676d 6169 6c2e 636f 6d0a  arari@gmail.com.
+0000ee40: 2020 2020 2020 2020 4020 6c69 6365 6e73          @ licens
+0000ee50: 653a 2020 2020 2020 2020 2020 2020 2020  e:              
+0000ee60: 2020 2047 4e55 2d47 504c 7633 0a20 2020     GNU-GPLv3.   
+0000ee70: 2020 2020 2074 6869 7320 6675 6e63 7469       this functi
+0000ee80: 6f6e 2063 6865 636b 2074 6865 2072 656d  on check the rem
+0000ee90: 6170 7069 6e67 2064 6174 6166 7261 6d65  apping dataframe
+0000eea0: 0a20 2020 2020 2020 2050 6172 616d 6574  .        Paramet
+0000eeb0: 6572 733a 0a20 2020 2020 2020 202d 2d2d  ers:.        ---
+0000eec0: 2d2d 2d2d 2d2d 2d0a 2020 2020 2020 2020  -------.        
+0000eed0: 7265 6d61 705f 6466 3a20 6461 7461 6672  remap_df: datafr
+0000eee0: 616d 652c 2069 6e63 6c75 6469 6e67 2072  ame, including r
+0000eef0: 656d 6170 7069 6e67 2069 6e66 6f72 6d61  emapping informa
+0000ef00: 7469 6f6e 2069 6e63 6c75 6469 6e67 2074  tion including t
+0000ef10: 6865 2066 6f6c 6c6f 7769 6e67 2063 6f6c  he following col
+0000ef20: 6f6d 6e73 3a0a 2020 2020 2020 2020 2020  omns:.          
+0000ef30: 2020 2020 2020 2020 2020 4944 5f74 6172            ID_tar
+0000ef40: 6765 740a 2020 2020 2020 2020 2020 2020  get.            
+0000ef50: 2020 2020 2020 2020 6c6f 6e5f 7461 7267          lon_targ
+0000ef60: 6574 0a20 2020 2020 2020 2020 2020 2020  et.             
+0000ef70: 2020 2020 2020 206c 6174 5f74 6172 6765         lat_targe
+0000ef80: 740a 2020 2020 2020 2020 2020 2020 2020  t.              
+0000ef90: 2020 2020 2020 4944 5f73 6f75 7263 650a        ID_source.
+0000efa0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000efb0: 2020 2020 6c61 745f 736f 7572 6365 0a20      lat_source. 
+0000efc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000efd0: 2020 206c 6f6e 5f73 6f75 7263 650a 2020     lon_source.  
+0000efe0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000eff0: 2020 726f 7773 0a20 2020 2020 2020 2020    rows.         
+0000f000: 2020 2020 2020 2020 2020 2063 6f6c 730a             cols.
+0000f010: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000f020: 2020 2020 6f72 6465 720a 2020 2020 2020      order.      
+0000f030: 2020 2222 220a 2020 2020 2020 2020 2320    """.        # 
+0000f040: 6368 6563 6b20 6966 2074 6865 7265 2069  check if there i
+0000f050: 7320 4541 5359 4d4f 5245 5f63 6173 6520  s EASYMORE_case 
+0000f060: 696e 2074 6865 2063 6f6c 756d 6e73 0a20  in the columns. 
+0000f070: 2020 2020 2020 2069 6620 2765 6173 796d         if 'easym
+0000f080: 6f72 655f 6361 7365 2720 696e 2072 656d  ore_case' in rem
+0000f090: 6170 5f64 662e 636f 6c75 6d6e 733a 0a20  ap_df.columns:. 
+0000f0a0: 2020 2020 2020 2020 2020 2070 7269 6e74             print
+0000f0b0: 2827 4541 5359 4d4f 5245 2063 6173 6520  ('EASYMORE case 
+0000f0c0: 6578 6973 7473 2069 6e20 7468 6520 7265  exists in the re
+0000f0d0: 6d61 7020 6669 6c65 2729 0a20 2020 2020  map file').     
+0000f0e0: 2020 2065 6c73 653a 0a20 2020 2020 2020     else:.       
+0000f0f0: 2020 2020 2073 7973 2e65 7869 7428 2745       sys.exit('E
+0000f100: 4153 594d 4f52 4520 6361 7365 2066 6965  ASYMORE case fie
+0000f110: 6c64 2064 6f65 7320 6e6f 7420 6578 6974  ld does not exit
+0000f120: 7320 696e 2074 6865 2072 656d 6170 2066  s in the remap f
+0000f130: 696c 653b 206d 616b 6520 7375 7265 2074  ile; make sure t
+0000f140: 6f20 696e 636c 7564 6520 7468 6973 2069  o include this i
+0000f150: 6620 796f 7520 6372 6561 7465 2074 6865  f you create the
+0000f160: 2072 656d 6170 7069 6e67 2066 696c 6520   remapping file 
+0000f170: 6d61 6e75 616c 6c79 2127 290a 2020 2020  manually!').    
+0000f180: 2020 2020 2320 6368 6563 6b20 6966 2061      # check if a
+0000f190: 6c6c 2074 6865 2065 6173 796d 6f72 655f  ll the easymore_
+0000f1a0: 6361 7365 2069 7320 756e 6971 7565 2066  case is unique f
+0000f1b0: 6f72 2074 6865 2064 6174 6120 7365 740a  or the data set.
+0000f1c0: 2020 2020 2020 2020 6966 206e 6f74 2028          if not (
+0000f1d0: 6c65 6e28 6e70 2e75 6e69 7175 6528 6e70  len(np.unique(np
+0000f1e0: 2e61 7272 6179 2872 656d 6170 5f64 665b  .array(remap_df[
+0000f1f0: 2765 6173 796d 6f72 655f 6361 7365 275d  'easymore_case']
+0000f200: 2929 293d 3d31 293a 0a20 2020 2020 2020  )))==1):.       
+0000f210: 2020 2020 2073 7973 2e65 7869 7428 2774       sys.exit('t
+0000f220: 6865 2045 4153 594d 4f52 455f 6361 7365  he EASYMORE_case
+0000f230: 2069 7320 6e6f 7420 756e 6971 7565 2069   is not unique i
+0000f240: 6e20 7468 6520 7265 6d61 7070 696e 6720  n the remapping 
+0000f250: 6669 6c65 2729 0a20 2020 2020 2020 2069  file').        i
+0000f260: 6620 6e6f 7420 286e 702e 756e 6971 7565  f not (np.unique
+0000f270: 286e 702e 6172 7261 7928 7265 6d61 705f  (np.array(remap_
+0000f280: 6466 5b27 6561 7379 6d6f 7265 5f63 6173  df['easymore_cas
+0000f290: 6527 5d29 2920 3d3d 2031 206f 725c 0a20  e'])) == 1 or\. 
+0000f2a0: 2020 2020 2020 206e 702e 756e 6971 7565         np.unique
+0000f2b0: 286e 702e 6172 7261 7928 7265 6d61 705f  (np.array(remap_
+0000f2c0: 6466 5b27 6561 7379 6d6f 7265 5f63 6173  df['easymore_cas
+0000f2d0: 6527 5d29 2920 3d3d 2032 206f 725c 0a20  e'])) == 2 or\. 
+0000f2e0: 2020 2020 2020 206e 702e 756e 6971 7565         np.unique
+0000f2f0: 286e 702e 6172 7261 7928 7265 6d61 705f  (np.array(remap_
+0000f300: 6466 5b27 6561 7379 6d6f 7265 5f63 6173  df['easymore_cas
+0000f310: 6527 5d29 2920 3d3d 2033 293a 0a20 2020  e'])) == 3):.   
+0000f320: 2020 2020 2020 2020 2073 7973 2e65 7869           sys.exi
+0000f330: 7428 2745 4153 594d 4f52 4520 6361 7365  t('EASYMORE case
+0000f340: 2073 686f 756c 6420 6265 206f 6e65 206f   should be one o
+0000f350: 6620 312c 2032 206f 7220 333b 2070 6c65  f 1, 2 or 3; ple
+0000f360: 6173 6520 7265 6665 7220 746f 2074 6865  ase refer to the
+0000f370: 2064 6f63 756d 656e 7461 7469 6f6e 2729   documentation')
+0000f380: 0a20 2020 2020 2020 2073 656c 662e 6361  .        self.ca
+0000f390: 7365 203d 206e 702e 756e 6971 7565 286e  se = np.unique(n
+0000f3a0: 702e 6172 7261 7928 7265 6d61 705f 6466  p.array(remap_df
+0000f3b0: 5b27 6561 7379 6d6f 7265 5f63 6173 6527  ['easymore_case'
+0000f3c0: 5d29 290a 2020 2020 2020 2020 2320 6368  ])).        # ch
+0000f3d0: 6563 6b20 6966 2074 6865 206e 6565 6465  eck if the neede
+0000f3e0: 6420 636f 6c75 6d6e 7320 6172 6520 6578  d columns are ex
+0000f3f0: 6973 7469 6e67 0a20 2020 2020 2020 2069  isting.        i
+0000f400: 6620 6e6f 7420 7365 7428 5b27 4944 5f74  f not set(['ID_t
+0000f410: 272c 276c 6174 5f74 272c 276c 6f6e 5f74  ','lat_t','lon_t
+0000f420: 272c 276f 7264 6572 5f74 272c 2749 445f  ','order_t','ID_
+0000f430: 7327 2c27 6c61 745f 7327 2c27 6c6f 6e5f  s','lat_s','lon_
+0000f440: 7327 2c27 7765 6967 6874 275d 2920 3c3d  s','weight']) <=
+0000f450: 2073 6574 2872 656d 6170 5f64 662e 636f   set(remap_df.co
+0000f460: 6c75 6d6e 7329 3a0a 2020 2020 2020 2020  lumns):.        
+0000f470: 2020 2020 7379 732e 6578 6974 2827 7072      sys.exit('pr
+0000f480: 6f76 6964 6564 2072 656d 6170 7069 6e67  ovided remapping
+0000f490: 2066 696c 6520 646f 6573 206e 6f74 2068   file does not h
+0000f4a0: 6176 6520 6f6e 6520 6f66 2074 6865 206e  ave one of the n
+0000f4b0: 6565 6465 6420 6669 656c 6473 3a20 5c6e  eeded fields: \n
+0000f4c0: 272b 5c0a 2020 2020 2020 2020 2020 2020  '+\.            
+0000f4d0: 2020 2020 2749 445f 742c 206c 6174 5f74      'ID_t, lat_t
+0000f4e0: 2c20 6c6f 6e5f 742c 206f 7264 6572 5f74  , lon_t, order_t
+0000f4f0: 2c20 4944 5f73 2c20 6c61 745f 732c 206c  , ID_s, lat_s, l
+0000f500: 6f6e 5f73 2c20 7765 6967 6874 2729 0a0a  on_s, weight')..
+0000f510: 2020 2020 6465 6620 5f5f 7461 7267 6574      def __target
+0000f520: 5f6e 635f 6372 6561 7469 6f6e 2873 656c  _nc_creation(sel
+0000f530: 6629 3a0a 2020 2020 2020 2020 2222 220a  f):.        """.
+0000f540: 2020 2020 2020 2020 4020 6175 7468 6f72          @ author
+0000f550: 3a20 2020 2020 2020 2020 2020 2020 2020  :               
+0000f560: 2020 2053 6865 7276 616e 2047 6861 7261     Shervan Ghara
+0000f570: 7269 0a20 2020 2020 2020 2040 2047 6974  ri.        @ Git
+0000f580: 6875 623a 2020 2020 2020 2020 2020 2020  hub:            
+0000f590: 2020 2020 2020 6874 7470 733a 2f2f 6769        https://gi
+0000f5a0: 7468 7562 2e63 6f6d 2f53 6865 7276 616e  thub.com/Shervan
+0000f5b0: 4768 6172 6172 692f 4541 5359 4d4f 5245  Gharari/EASYMORE
+0000f5c0: 0a20 2020 2020 2020 2040 2061 7574 686f  .        @ autho
+0000f5d0: 7227 7320 656d 6169 6c20 6964 3a20 2020  r's email id:   
+0000f5e0: 2020 2020 7368 2e67 6861 7261 7269 4067      sh.gharari@g
+0000f5f0: 6d61 696c 2e63 6f6d 0a20 2020 2020 2020  mail.com.       
+0000f600: 2040 206c 6963 656e 7365 3a20 2020 2020   @ license:     
+0000f610: 2020 2020 2020 2020 2020 2020 474e 552d              GNU-
+0000f620: 4750 4c76 330a 2020 2020 2020 2020 5468  GPLv3.        Th
+0000f630: 6973 2066 756e 6369 746f 6e20 7265 6164  is funciton read
+0000f640: 2064 6966 6665 7265 6e74 2067 7269 6473   different grids
+0000f650: 2061 6e64 2073 756d 2074 6865 6d20 7570   and sum them up
+0000f660: 2062 6173 6564 206f 6e20 7468 650a 2020   based on the.  
+0000f670: 2020 2020 2020 7765 6967 6874 2070 726f        weight pro
+0000f680: 7669 6465 6420 746f 2061 6767 7265 6761  vided to aggrega
+0000f690: 7465 2074 6865 6d20 6f76 6572 2061 206c  te them over a l
+0000f6a0: 6172 6765 7220 6172 6561 0a20 2020 2020  arger area.     
+0000f6b0: 2020 2022 2222 0a20 2020 2020 2020 2070     """.        p
+0000f6c0: 7269 6e74 2827 2d2d 2d2d 2d2d 5245 4d41  rint('------REMA
+0000f6d0: 5050 494e 472d 2d2d 2d2d 2d27 290a 2020  PPING------').  
+0000f6e0: 2020 2020 2020 7265 6d61 7020 3d20 7064        remap = pd
+0000f6f0: 2e72 6561 645f 6373 7628 7365 6c66 2e72  .read_csv(self.r
+0000f700: 656d 6170 5f63 7376 290a 2020 2020 2020  emap_csv).      
+0000f710: 2020 7265 6d61 7020 3d20 7265 6d61 702e    remap = remap.
+0000f720: 6170 706c 7928 7064 2e74 6f5f 6e75 6d65  apply(pd.to_nume
+0000f730: 7269 632c 2065 7272 6f72 733d 2763 6f65  ric, errors='coe
+0000f740: 7263 6527 2920 2320 636f 6e76 6572 7420  rce') # convert 
+0000f750: 6e6f 6e20 6e75 6d65 7269 6320 746f 204e  non numeric to N
+0000f760: 614e 0a20 2020 2020 2020 2023 2063 7265  aN.        # cre
+0000f770: 6174 696e 6720 7468 6520 7461 7267 6574  ating the target
+0000f780: 5f49 445f 6c61 745f 6c6f 6e0a 2020 2020  _ID_lat_lon.    
+0000f790: 2020 2020 7461 7267 6574 5f49 445f 6c61      target_ID_la
+0000f7a0: 745f 6c6f 6e20 3d20 7064 2e44 6174 6146  t_lon = pd.DataF
+0000f7b0: 7261 6d65 2829 0a20 2020 2020 2020 2074  rame().        t
+0000f7c0: 6172 6765 745f 4944 5f6c 6174 5f6c 6f6e  arget_ID_lat_lon
+0000f7d0: 205b 2749 445f 7427 5d20 203d 2072 656d   ['ID_t']  = rem
+0000f7e0: 6170 205b 2749 445f 7427 5d0a 2020 2020  ap ['ID_t'].    
+0000f7f0: 2020 2020 7461 7267 6574 5f49 445f 6c61      target_ID_la
+0000f800: 745f 6c6f 6e20 5b27 6c61 745f 7427 5d20  t_lon ['lat_t'] 
+0000f810: 3d20 7265 6d61 7020 5b27 6c61 745f 7427  = remap ['lat_t'
+0000f820: 5d0a 2020 2020 2020 2020 7461 7267 6574  ].        target
+0000f830: 5f49 445f 6c61 745f 6c6f 6e20 5b27 6c6f  _ID_lat_lon ['lo
+0000f840: 6e5f 7427 5d20 3d20 7265 6d61 7020 5b27  n_t'] = remap ['
+0000f850: 6c6f 6e5f 7427 5d0a 2020 2020 2020 2020  lon_t'].        
+0000f860: 7461 7267 6574 5f49 445f 6c61 745f 6c6f  target_ID_lat_lo
+0000f870: 6e20 5b27 6f72 6465 725f 7427 5d20 3d20  n ['order_t'] = 
+0000f880: 7265 6d61 7020 5b27 6f72 6465 725f 7427  remap ['order_t'
+0000f890: 5d0a 2020 2020 2020 2020 7461 7267 6574  ].        target
+0000f8a0: 5f49 445f 6c61 745f 6c6f 6e20 3d20 7461  _ID_lat_lon = ta
+0000f8b0: 7267 6574 5f49 445f 6c61 745f 6c6f 6e2e  rget_ID_lat_lon.
+0000f8c0: 6472 6f70 5f64 7570 6c69 6361 7465 7328  drop_duplicates(
+0000f8d0: 290a 2020 2020 2020 2020 7461 7267 6574  ).        target
+0000f8e0: 5f49 445f 6c61 745f 6c6f 6e20 3d20 7461  _ID_lat_lon = ta
+0000f8f0: 7267 6574 5f49 445f 6c61 745f 6c6f 6e2e  rget_ID_lat_lon.
+0000f900: 736f 7274 5f76 616c 7565 7328 6279 3d5b  sort_values(by=[
+0000f910: 276f 7264 6572 5f74 275d 290a 2020 2020  'order_t']).    
+0000f920: 2020 2020 7461 7267 6574 5f49 445f 6c61      target_ID_la
+0000f930: 745f 6c6f 6e20 3d20 7461 7267 6574 5f49  t_lon = target_I
+0000f940: 445f 6c61 745f 6c6f 6e2e 7265 7365 745f  D_lat_lon.reset_
+0000f950: 696e 6465 7828 6472 6f70 3d54 7275 6529  index(drop=True)
+0000f960: 0a20 2020 2020 2020 2023 2070 7265 7061  .        # prepa
+0000f970: 7265 2074 6865 2068 7275 5f69 6420 2868  re the hru_id (h
+0000f980: 6572 6520 434f 4d49 4429 2c20 6c61 742c  ere COMID), lat,
+0000f990: 206c 6f6e 0a20 2020 2020 2020 2068 7275   lon.        hru
+0000f9a0: 4944 5f76 6172 203d 206e 702e 6172 7261  ID_var = np.arra
+0000f9b0: 7928 7461 7267 6574 5f49 445f 6c61 745f  y(target_ID_lat_
+0000f9c0: 6c6f 6e5b 2749 445f 7427 5d29 0a20 2020  lon['ID_t']).   
+0000f9d0: 2020 2020 2068 7275 4944 5f6c 6174 203d       hruID_lat =
+0000f9e0: 206e 702e 6172 7261 7928 7461 7267 6574   np.array(target
+0000f9f0: 5f49 445f 6c61 745f 6c6f 6e5b 276c 6174  _ID_lat_lon['lat
+0000fa00: 5f74 275d 290a 2020 2020 2020 2020 6872  _t']).        hr
+0000fa10: 7549 445f 6c6f 6e20 3d20 6e70 2e61 7272  uID_lon = np.arr
+0000fa20: 6179 2874 6172 6765 745f 4944 5f6c 6174  ay(target_ID_lat
+0000fa30: 5f6c 6f6e 5b27 6c6f 6e5f 7427 5d29 0a20  _lon['lon_t']). 
+0000fa40: 2020 2020 2020 2023 0a20 2020 2020 2020         #.       
+0000fa50: 2073 656c 662e 726f 7773 203d 206e 702e   self.rows = np.
+0000fa60: 6172 7261 7928 7265 6d61 705b 2772 6f77  array(remap['row
+0000fa70: 7327 5d29 2e61 7374 7970 6528 696e 7429  s']).astype(int)
+0000fa80: 0a20 2020 2020 2020 2073 656c 662e 636f  .        self.co
+0000fa90: 6c73 203d 206e 702e 6172 7261 7928 7265  ls = np.array(re
+0000faa0: 6d61 705b 2763 6f6c 7327 5d29 2e61 7374  map['cols']).ast
+0000fab0: 7970 6528 696e 7429 0a20 2020 2020 2020  ype(int).       
+0000fac0: 2073 656c 662e 6e75 6d62 6572 5f6f 665f   self.number_of_
+0000fad0: 7461 7267 6574 5f65 6c65 6d65 6e74 7320  target_elements 
+0000fae0: 3d20 6c65 6e28 6872 7549 445f 7661 7229  = len(hruID_var)
+0000faf0: 0a20 2020 2020 2020 2023 0a20 2020 2020  .        #.     
+0000fb00: 2020 206e 635f 6e61 6d65 7320 3d20 676c     nc_names = gl
+0000fb10: 6f62 2e67 6c6f 6228 7365 6c66 2e73 6f75  ob.glob(self.sou
+0000fb20: 7263 655f 6e63 290a 2020 2020 2020 2020  rce_nc).        
+0000fb30: 6e63 5f6e 616d 6573 203d 2073 6f72 7465  nc_names = sorte
+0000fb40: 6428 6e63 5f6e 616d 6573 290a 2020 2020  d(nc_names).    
+0000fb50: 2020 2020 2320 6368 6563 6b20 636f 6d70      # check comp
+0000fb60: 7265 7373 696f 6e20 6368 6f69 6365 0a20  ression choice. 
+0000fb70: 2020 2020 2020 2069 6620 6973 696e 7374         if isinst
+0000fb80: 616e 6365 2873 656c 662e 636f 6d70 6c65  ance(self.comple
+0000fb90: 7665 6c2c 2069 6e74 2920 616e 6420 2873  vel, int) and (s
+0000fba0: 656c 662e 636f 6d70 6c65 7665 6c20 3e3d  elf.complevel >=
+0000fbb0: 3129 2061 6e64 2028 7365 6c66 2e63 6f6d  1) and (self.com
+0000fbc0: 706c 6576 656c 3c3d 3929 3a0a 2020 2020  plevel<=9):.    
+0000fbd0: 2020 2020 2020 2020 636f 6d70 666c 6167          compflag
+0000fbe0: 203d 2054 7275 650a 2020 2020 2020 2020   = True.        
+0000fbf0: 2020 2020 636f 6d70 6c65 7665 6c20 3d20      complevel = 
+0000fc00: 7365 6c66 2e63 6f6d 706c 6576 656c 0a20  self.complevel. 
+0000fc10: 2020 2020 2020 2020 2020 2070 7269 6e74             print
+0000fc20: 2827 6e65 7463 6466 206f 7574 7075 7420  ('netcdf output 
+0000fc30: 6669 6c65 2077 696c 6c20 6265 2063 6f6d  file will be com
+0000fc40: 7072 6573 7365 6420 6174 206c 6576 656c  pressed at level
+0000fc50: 272c 2063 6f6d 706c 6576 656c 290a 2020  ', complevel).  
+0000fc60: 2020 2020 2020 656c 7365 3a0a 2020 2020        else:.    
+0000fc70: 2020 2020 2020 2020 636f 6d70 666c 6167          compflag
+0000fc80: 203d 2046 616c 7365 0a20 2020 2020 2020   = False.       
+0000fc90: 2020 2020 2063 6f6d 706c 6576 656c 203d       complevel =
+0000fca0: 2030 0a20 2020 2020 2020 2020 2020 2070   0.            p
+0000fcb0: 7269 6e74 2827 6e65 7463 6466 206f 7574  rint('netcdf out
+0000fcc0: 7075 7420 6669 6c65 2077 696c 6c20 6e6f  put file will no
+0000fcd0: 7420 6265 2063 6f6d 7072 6573 7365 642e  t be compressed.
+0000fce0: 2729 0a20 2020 2020 2020 2066 6f72 206e  ').        for n
+0000fcf0: 635f 6e61 6d65 2069 6e20 6e63 5f6e 616d  c_name in nc_nam
+0000fd00: 6573 3a0a 2020 2020 2020 2020 2020 2020  es:.            
+0000fd10: 2320 6765 7420 7468 6520 7469 6d65 2075  # get the time u
+0000fd20: 6e69 7420 616e 6420 7469 6d65 2076 6172  nit and time var
+0000fd30: 2066 726f 6d20 736f 7572 6365 0a20 2020   from source.   
+0000fd40: 2020 2020 2020 2020 206e 6369 6473 203d           ncids =
+0000fd50: 206e 6334 2e44 6174 6173 6574 286e 635f   nc4.Dataset(nc_
+0000fd60: 6e61 6d65 290a 2020 2020 2020 2020 2020  name).          
+0000fd70: 2020 2320 4368 6563 6b20 6461 7461 206c    # Check data l
+0000fd80: 6963 656e 7365 2c20 6361 6c65 6e64 6172  icense, calendar
+0000fd90: 2061 6e64 2074 696d 6520 756e 6974 730a   and time units.
+0000fda0: 2020 2020 2020 2020 2020 2020 6e63 5f61              nc_a
+0000fdb0: 7474 5f6c 6973 7420 3d20 6e63 6964 732e  tt_list = ncids.
+0000fdc0: 6e63 6174 7472 7328 290a 2020 2020 2020  ncattrs().      
+0000fdd0: 2020 2020 2020 6e63 5f61 7474 5f6c 6973        nc_att_lis
+0000fde0: 7420 3d20 5b65 6163 685f 6174 7420 666f  t = [each_att fo
+0000fdf0: 7220 6561 6368 5f61 7474 2069 6e20 6e63  r each_att in nc
+0000fe00: 5f61 7474 5f6c 6973 745d 0a20 2020 2020  _att_list].     
+0000fe10: 2020 2020 2020 206e 635f 6174 745f 6c69         nc_att_li
+0000fe20: 7374 5f6c 6f77 6572 203d 205b 6561 6368  st_lower = [each
+0000fe30: 5f61 7474 2e6c 6f77 6572 2829 2066 6f72  _att.lower() for
+0000fe40: 2065 6163 685f 6174 7420 696e 206e 635f   each_att in nc_
+0000fe50: 6174 745f 6c69 7374 5d0a 2020 2020 2020  att_list].      
+0000fe60: 2020 2020 2020 6966 2073 656c 662e 6c69        if self.li
+0000fe70: 6365 6e73 6520 3d3d 2027 2720 616e 6420  cense == '' and 
+0000fe80: 2827 6c69 6365 6e73 6527 206e 6f74 2069  ('license' not i
+0000fe90: 6e20 6e63 5f61 7474 5f6c 6973 745f 6c6f  n nc_att_list_lo
+0000fea0: 7765 7229 3a0a 2020 2020 2020 2020 2020  wer):.          
+0000feb0: 2020 2020 2020 7365 6c66 2e6c 6963 656e        self.licen
+0000fec0: 7365 203d 3d20 2774 6865 206f 7269 6769  se == 'the origi
+0000fed0: 6e61 6c20 6c69 6365 6e73 6520 6f66 2074  nal license of t
+0000fee0: 6865 2073 6f75 7263 6520 4e65 7443 4446  he source NetCDF
+0000fef0: 2066 696c 6520 6973 206e 6f74 2070 726f   file is not pro
+0000ff00: 7669 6465 6427 0a20 2020 2020 2020 2020  vided'.         
+0000ff10: 2020 2069 6620 2827 6c69 6365 6e73 6527     if ('license'
+0000ff20: 2069 6e20 6e63 5f61 7474 5f6c 6973 745f   in nc_att_list_
+0000ff30: 6c6f 7765 7229 3a0a 2020 2020 2020 2020  lower):.        
+0000ff40: 2020 2020 2020 2020 6966 2027 6c69 6365          if 'lice
+0000ff50: 6e73 6527 2069 6e20 6e63 5f61 7474 5f6c  nse' in nc_att_l
+0000ff60: 6973 743a 0a20 2020 2020 2020 2020 2020  ist:.           
+0000ff70: 2020 2020 2020 2020 2073 656c 662e 6c69           self.li
+0000ff80: 6365 6e73 6520 3d3d 2067 6574 6174 7472  cense == getattr
+0000ff90: 286e 6369 6473 2c20 276c 6963 656e 7365  (ncids, 'license
+0000ffa0: 2729 0a20 2020 2020 2020 2020 2020 2020  ').             
+0000ffb0: 2020 2069 6620 274c 6963 656e 7365 2720     if 'License' 
+0000ffc0: 696e 206e 635f 6174 745f 6c69 7374 3a0a  in nc_att_list:.
+0000ffd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000ffe0: 2020 2020 7365 6c66 2e6c 6963 656e 7365      self.license
+0000fff0: 203d 3d20 6765 7461 7474 7228 6e63 6964   == getattr(ncid
+00010000: 732c 2027 4c69 6365 6e73 6527 290a 2020  s, 'License').  
+00010010: 2020 2020 2020 2020 2020 2020 2020 6966                if
+00010020: 2027 4c49 4345 4e53 4527 2069 6e20 6e63   'LICENSE' in nc
+00010030: 5f61 7474 5f6c 6973 743a 0a20 2020 2020  _att_list:.     
+00010040: 2020 2020 2020 2020 2020 2020 2020 2073                 s
+00010050: 656c 662e 6c69 6365 6e73 6520 3d3d 2067  elf.license == g
+00010060: 6574 6174 7472 286e 6369 6473 2c20 274c  etattr(ncids, 'L
+00010070: 4943 454e 5345 2729 0a20 2020 2020 2020  ICENSE').       
+00010080: 2020 2020 2020 2020 2073 656c 662e 6c69           self.li
+00010090: 6365 6e73 6520 3d3d 2027 4f72 6967 696e  cense == 'Origin
+000100a0: 616c 2064 6174 6120 6c69 6365 6e73 6520  al data license 
+000100b0: 272b 7365 6c66 2e6c 6963 656e 7365 0a20  '+self.license. 
+000100c0: 2020 2020 2020 2020 2020 2069 6620 2775             if 'u
+000100d0: 6e69 7473 2720 696e 206e 6369 6473 2e76  nits' in ncids.v
+000100e0: 6172 6961 626c 6573 5b73 656c 662e 7661  ariables[self.va
+000100f0: 725f 7469 6d65 5d2e 6e63 6174 7472 7328  r_time].ncattrs(
+00010100: 293a 0a20 2020 2020 2020 2020 2020 2020  ):.             
+00010110: 2020 2074 696d 655f 756e 6974 203d 206e     time_unit = n
+00010120: 6369 6473 2e76 6172 6961 626c 6573 5b73  cids.variables[s
+00010130: 656c 662e 7661 725f 7469 6d65 5d2e 756e  elf.var_time].un
+00010140: 6974 730a 2020 2020 2020 2020 2020 2020  its.            
+00010150: 656c 7365 3a0a 2020 2020 2020 2020 2020  else:.          
+00010160: 2020 2020 2020 7379 732e 6578 6974 2827        sys.exit('
+00010170: 756e 6974 7320 6973 206e 6f74 2070 726f  units is not pro
+00010180: 7669 6465 6420 666f 7220 7468 6520 7469  vided for the ti
+00010190: 6d65 2076 6172 6961 626c 6520 666f 7220  me variable for 
+000101a0: 736f 7572 6365 204e 6574 4344 4620 6f66  source NetCDF of
+000101b0: 272b 206e 635f 6e61 6d65 290a 2020 2020  '+ nc_name).    
+000101c0: 2020 2020 2020 2020 6966 2027 6361 6c65          if 'cale
+000101d0: 6e64 6172 2720 696e 206e 6369 6473 2e76  ndar' in ncids.v
+000101e0: 6172 6961 626c 6573 5b73 656c 662e 7661  ariables[self.va
+000101f0: 725f 7469 6d65 5d2e 6e63 6174 7472 7328  r_time].ncattrs(
+00010200: 293a 0a20 2020 2020 2020 2020 2020 2020  ):.             
+00010210: 2020 2074 696d 655f 6361 6c20 3d20 6e63     time_cal = nc
+00010220: 6964 732e 7661 7269 6162 6c65 735b 7365  ids.variables[se
+00010230: 6c66 2e76 6172 5f74 696d 655d 2e63 616c  lf.var_time].cal
+00010240: 656e 6461 720a 2020 2020 2020 2020 2020  endar.          
+00010250: 2020 656c 7365 3a0a 2020 2020 2020 2020    else:.        
+00010260: 2020 2020 2020 2020 7379 732e 6578 6974          sys.exit
+00010270: 2827 6361 6c65 6e64 6172 2069 7320 6e6f  ('calendar is no
+00010280: 7420 7072 6f76 6964 6564 2066 6f72 2074  t provided for t
+00010290: 6865 2074 696d 6520 7661 7269 6162 6c65  he time variable
+000102a0: 2066 6f72 2073 6f75 7263 6520 4e65 7443   for source NetC
+000102b0: 4446 206f 6627 2b20 6e63 5f6e 616d 6529  DF of'+ nc_name)
+000102c0: 0a20 2020 2020 2020 2020 2020 2074 696d  .            tim
+000102d0: 655f 7661 7220 3d20 6e63 6964 735b 7365  e_var = ncids[se
+000102e0: 6c66 2e76 6172 5f74 696d 655d 5b3a 5d0a  lf.var_time][:].
+000102f0: 2020 2020 2020 2020 2020 2020 7365 6c66              self
+00010300: 2e6c 656e 6774 685f 6f66 5f74 696d 6520  .length_of_time 
+00010310: 3d20 6c65 6e28 7469 6d65 5f76 6172 290a  = len(time_var).
+00010320: 2020 2020 2020 2020 2020 2020 7461 7267              targ
+00010330: 6574 5f64 6174 655f 7469 6d65 7320 3d20  et_date_times = 
+00010340: 6e63 342e 6e75 6d32 6461 7465 2874 696d  nc4.num2date(tim
+00010350: 655f 7661 722c 756e 6974 7320 3d20 7469  e_var,units = ti
+00010360: 6d65 5f75 6e69 742c 6361 6c65 6e64 6172  me_unit,calendar
+00010370: 203d 2074 696d 655f 6361 6c29 0a20 2020   = time_cal).   
+00010380: 2020 2020 2020 2020 2074 6172 6765 745f           target_
+00010390: 6e61 6d65 203d 2073 656c 662e 6f75 7470  name = self.outp
+000103a0: 7574 5f64 6972 202b 2073 656c 662e 6361  ut_dir + self.ca
+000103b0: 7365 5f6e 616d 6520 2b20 275f 7265 6d61  se_name + '_rema
+000103c0: 7070 6564 5f27 202b 2074 6172 6765 745f  pped_' + target_
+000103d0: 6461 7465 5f74 696d 6573 5b30 5d2e 7374  date_times[0].st
+000103e0: 7266 7469 6d65 2822 2559 2d25 6d2d 2564  rftime("%Y-%m-%d
+000103f0: 2d25 482d 254d 2d25 5322 292b 272e 6e63  -%H-%M-%S")+'.nc
+00010400: 270a 2020 2020 2020 2020 2020 2020 6966  '.            if
+00010410: 206f 732e 7061 7468 2e65 7869 7374 7328   os.path.exists(
+00010420: 7461 7267 6574 5f6e 616d 6529 3a0a 2020  target_name):.  
+00010430: 2020 2020 2020 2020 2020 2020 2020 6966                if
+00010440: 2073 656c 662e 6f76 6572 7772 6974 655f   self.overwrite_
+00010450: 7265 6d61 7070 6564 5f6e 633a 0a20 2020  remapped_nc:.   
+00010460: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00010470: 2070 7269 6e74 2827 5265 6d6f 7669 6e67   print('Removing
+00010480: 2065 7869 7374 696e 6720 7265 6d61 7070   existing remapp
+00010490: 6564 202e 6e63 2066 696c 652e 2729 0a20  ed .nc file.'). 
+000104a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000104b0: 2020 206f 732e 7265 6d6f 7665 2874 6172     os.remove(tar
+000104c0: 6765 745f 6e61 6d65 290a 2020 2020 2020  get_name).      
+000104d0: 2020 2020 2020 2020 2020 656c 7365 3a0a            else:.
+000104e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000104f0: 2020 2020 7072 696e 7428 2752 656d 6170      print('Remap
+00010500: 7065 6420 2e6e 6320 6669 6c65 2061 6c72  ped .nc file alr
+00010510: 6561 6479 2065 7869 7374 732e 2047 6f69  eady exists. Goi
+00010520: 6e67 2074 6f20 6e65 7874 2066 696c 652e  ng to next file.
+00010530: 2729 0a20 2020 2020 2020 2020 2020 2020  ').             
+00010540: 2020 2020 2020 2063 6f6e 7469 6e75 6520         continue 
+00010550: 2320 736b 6970 2074 6f20 6e65 7874 2066  # skip to next f
+00010560: 696c 650a 2020 2020 2020 2020 2020 2020  ile.            
+00010570: 666f 7220 7661 7220 696e 206e 6369 6473  for var in ncids
+00010580: 2e76 6172 6961 626c 6573 2e76 616c 7565  .variables.value
+00010590: 7328 293a 0a20 2020 2020 2020 2020 2020  s():.           
+000105a0: 2020 2020 2069 6620 7661 722e 6e61 6d65       if var.name
+000105b0: 203d 3d20 7365 6c66 2e76 6172 5f74 696d   == self.var_tim
+000105c0: 653a 0a20 2020 2020 2020 2020 2020 2020  e:.             
+000105d0: 2020 2020 2020 2074 696d 655f 6474 7970         time_dtyp
+000105e0: 6520 3d20 2073 7472 2876 6172 2e64 7479  e =  str(var.dty
+000105f0: 7065 290a 2020 2020 2020 2020 2020 2020  pe).            
+00010600: 7469 6d65 5f64 7479 7065 5f63 6f64 6520  time_dtype_code 
+00010610: 3d20 2766 3827 2023 2069 6e69 7469 616c  = 'f8' # initial
+00010620: 697a 6520 7468 6520 7469 6d65 2061 7320  ize the time as 
+00010630: 666c 6f61 740a 2020 2020 2020 2020 2020  float.          
+00010640: 2020 6966 2027 666c 6f61 7427 2069 6e20    if 'float' in 
+00010650: 7469 6d65 5f64 7479 7065 2e6c 6f77 6572  time_dtype.lower
+00010660: 2829 3a0a 2020 2020 2020 2020 2020 2020  ():.            
+00010670: 2020 2020 7469 6d65 5f64 7479 7065 5f63      time_dtype_c
+00010680: 6f64 6520 3d20 2766 3827 0a20 2020 2020  ode = 'f8'.     
+00010690: 2020 2020 2020 2065 6c69 6620 2769 6e74         elif 'int
+000106a0: 2720 696e 2074 696d 655f 6474 7970 652e  ' in time_dtype.
+000106b0: 6c6f 7765 7228 293a 0a20 2020 2020 2020  lower():.       
+000106c0: 2020 2020 2020 2020 2074 696d 655f 6474           time_dt
+000106d0: 7970 655f 636f 6465 203d 2027 6934 270a  ype_code = 'i4'.
+000106e0: 2020 2020 2020 2020 2020 2020 2320 7265              # re
+000106f0: 706f 7274 696e 670a 2020 2020 2020 2020  porting.        
+00010700: 2020 2020 7374 6174 656d 656e 745f 7072      statement_pr
+00010710: 696e 7420 3d20 2752 656d 6170 7069 6e67  int = 'Remapping
+00010720: 2027 2b6e 635f 6e61 6d65 2b27 2074 6f20   '+nc_name+' to 
+00010730: 272b 7461 7267 6574 5f6e 616d 652b 2720  '+target_name+' 
+00010740: 5c6e 270a 2020 2020 2020 2020 2020 2020  \n'.            
+00010750: 7469 6d65 5f73 7461 7274 203d 2064 6174  time_start = dat
+00010760: 6574 696d 652e 6e6f 7728 290a 2020 2020  etime.now().    
+00010770: 2020 2020 2020 2020 7374 6174 656d 656e          statemen
+00010780: 745f 7072 696e 7420 3d20 7374 6174 656d  t_print = statem
+00010790: 656e 745f 7072 696e 7420 2b20 2753 7461  ent_print + 'Sta
+000107a0: 7274 6564 2061 7420 6461 7465 2061 6e64  rted at date and
+000107b0: 2074 696d 6520 272b 2073 7472 2874 696d   time '+ str(tim
+000107c0: 655f 7374 6172 7429 202b 2027 205c 6e27  e_start) + ' \n'
+000107d0: 0a20 2020 2020 2020 2020 2020 2077 6974  .            wit
+000107e0: 6820 6e63 342e 4461 7461 7365 7428 7461  h nc4.Dataset(ta
+000107f0: 7267 6574 5f6e 616d 652c 2022 7722 2c20  rget_name, "w", 
+00010800: 666f 726d 6174 3d22 4e45 5443 4446 3422  format="NETCDF4"
+00010810: 2920 6173 206e 6369 643a 2023 2063 7265  ) as ncid: # cre
+00010820: 6174 696e 6720 7468 6520 4e65 7443 4446  ating the NetCDF
+00010830: 2066 696c 650a 2020 2020 2020 2020 2020   file.          
+00010840: 2020 2020 2020 2320 6465 6669 6e65 2074        # define t
+00010850: 6865 2064 696d 656e 7369 6f6e 730a 2020  he dimensions.  
+00010860: 2020 2020 2020 2020 2020 2020 2020 6469                di
+00010870: 6d69 645f 4e20 3d20 6e63 6964 2e63 7265  mid_N = ncid.cre
+00010880: 6174 6544 696d 656e 7369 6f6e 2873 656c  ateDimension(sel
+00010890: 662e 7265 6d61 7070 6564 5f64 696d 5f69  f.remapped_dim_i
+000108a0: 642c 206c 656e 2868 7275 4944 5f76 6172  d, len(hruID_var
+000108b0: 2929 2020 2320 6c69 6d69 7465 6420 6469  ))  # limited di
+000108c0: 6d65 6e73 6974 6f6e 2065 7175 616c 2074  mensiton equal t
+000108d0: 6865 206e 756d 6265 7220 6f66 2068 7275  he number of hru
+000108e0: 4944 0a20 2020 2020 2020 2020 2020 2020  ID.             
+000108f0: 2020 2064 696d 6964 5f54 203d 206e 6369     dimid_T = nci
+00010900: 642e 6372 6561 7465 4469 6d65 6e73 696f  d.createDimensio
+00010910: 6e28 2774 696d 6527 2c20 4e6f 6e65 2920  n('time', None) 
+00010920: 2020 2320 756e 6c69 6d69 7465 6420 6469    # unlimited di
+00010930: 6d65 6e73 6974 6f6e 0a20 2020 2020 2020  mensiton.       
+00010940: 2020 2020 2020 2020 2023 2056 6172 6961           # Varia
+00010950: 626c 6520 7469 6d65 0a20 2020 2020 2020  ble time.       
+00010960: 2020 2020 2020 2020 2074 696d 655f 7661           time_va
+00010970: 7269 6420 3d20 6e63 6964 2e63 7265 6174  rid = ncid.creat
+00010980: 6556 6172 6961 626c 6528 2774 696d 6527  eVariable('time'
+00010990: 2c20 7469 6d65 5f64 7479 7065 5f63 6f64  , time_dtype_cod
+000109a0: 652c 2028 2774 696d 6527 2c20 292c 207a  e, ('time', ), z
+000109b0: 6c69 623d 636f 6d70 666c 6167 2c20 636f  lib=compflag, co
+000109c0: 6d70 6c65 7665 6c3d 636f 6d70 6c65 7665  mplevel=compleve
+000109d0: 6c29 0a20 2020 2020 2020 2020 2020 2020  l).             
+000109e0: 2020 2023 2041 7474 7269 6275 7465 730a     # Attributes.
+000109f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00010a00: 7469 6d65 5f76 6172 6964 2e6c 6f6e 675f  time_varid.long_
+00010a10: 6e61 6d65 203d 2073 656c 662e 7661 725f  name = self.var_
+00010a20: 7469 6d65 0a20 2020 2020 2020 2020 2020  time.           
+00010a30: 2020 2020 2074 696d 655f 7661 7269 642e       time_varid.
+00010a40: 756e 6974 7320 3d20 7469 6d65 5f75 6e69  units = time_uni
+00010a50: 7420 2023 2065 2e67 2e20 2764 6179 7320  t  # e.g. 'days 
+00010a60: 7369 6e63 6520 3230 3030 2d30 312d 3031  since 2000-01-01
+00010a70: 2030 303a 3030 2720 7368 6f75 6c64 2063   00:00' should c
+00010a80: 6861 6e67 6520 6163 636f 7264 696e 676c  hange accordingl
+00010a90: 790a 2020 2020 2020 2020 2020 2020 2020  y.              
+00010aa0: 2020 7469 6d65 5f76 6172 6964 2e63 616c    time_varid.cal
+00010ab0: 656e 6461 7220 3d20 7469 6d65 5f63 616c  endar = time_cal
+00010ac0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00010ad0: 2074 696d 655f 7661 7269 642e 7374 616e   time_varid.stan
+00010ae0: 6461 7264 5f6e 616d 6520 3d20 7365 6c66  dard_name = self
+00010af0: 2e76 6172 5f74 696d 650a 2020 2020 2020  .var_time.      
+00010b00: 2020 2020 2020 2020 2020 7469 6d65 5f76            time_v
+00010b10: 6172 6964 2e61 7869 7320 3d20 2754 270a  arid.axis = 'T'.
+00010b20: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00010b30: 7469 6d65 5f76 6172 6964 5b3a 5d20 3d20  time_varid[:] = 
+00010b40: 7469 6d65 5f76 6172 0a20 2020 2020 2020  time_var.       
+00010b50: 2020 2020 2020 2020 2023 2056 6172 6961           # Varia
+00010b60: 626c 6573 206c 6174 2c20 6c6f 6e2c 2073  bles lat, lon, s
+00010b70: 7562 6261 7369 6e5f 4944 0a20 2020 2020  ubbasin_ID.     
+00010b80: 2020 2020 2020 2020 2020 206c 6174 5f76             lat_v
+00010b90: 6172 6964 203d 206e 6369 642e 6372 6561  arid = ncid.crea
+00010ba0: 7465 5661 7269 6162 6c65 2873 656c 662e  teVariable(self.
+00010bb0: 7265 6d61 7070 6564 5f76 6172 5f6c 6174  remapped_var_lat
+00010bc0: 2c20 2766 3827 2c20 2873 656c 662e 7265  , 'f8', (self.re
+00010bd0: 6d61 7070 6564 5f64 696d 5f69 642c 2029  mapped_dim_id, )
+00010be0: 2c20 7a6c 6962 3d63 6f6d 7066 6c61 672c  , zlib=compflag,
+00010bf0: 2063 6f6d 706c 6576 656c 3d63 6f6d 706c   complevel=compl
+00010c00: 6576 656c 290a 2020 2020 2020 2020 2020  evel).          
+00010c10: 2020 2020 2020 6c6f 6e5f 7661 7269 6420        lon_varid 
+00010c20: 3d20 6e63 6964 2e63 7265 6174 6556 6172  = ncid.createVar
+00010c30: 6961 626c 6528 7365 6c66 2e72 656d 6170  iable(self.remap
+00010c40: 7065 645f 7661 725f 6c6f 6e2c 2027 6638  ped_var_lon, 'f8
+00010c50: 272c 2028 7365 6c66 2e72 656d 6170 7065  ', (self.remappe
+00010c60: 645f 6469 6d5f 6964 2c20 292c 207a 6c69  d_dim_id, ), zli
+00010c70: 623d 636f 6d70 666c 6167 2c20 636f 6d70  b=compflag, comp
+00010c80: 6c65 7665 6c3d 636f 6d70 6c65 7665 6c29  level=complevel)
+00010c90: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00010ca0: 2068 7275 4964 5f76 6172 6964 203d 206e   hruId_varid = n
+00010cb0: 6369 642e 6372 6561 7465 5661 7269 6162  cid.createVariab
+00010cc0: 6c65 2873 656c 662e 7265 6d61 7070 6564  le(self.remapped
+00010cd0: 5f76 6172 5f69 642c 2027 6638 272c 2028  _var_id, 'f8', (
+00010ce0: 7365 6c66 2e72 656d 6170 7065 645f 6469  self.remapped_di
+00010cf0: 6d5f 6964 2c20 292c 207a 6c69 623d 636f  m_id, ), zlib=co
+00010d00: 6d70 666c 6167 2c20 636f 6d70 6c65 7665  mpflag, compleve
+00010d10: 6c3d 636f 6d70 6c65 7665 6c29 0a20 2020  l=complevel).   
+00010d20: 2020 2020 2020 2020 2020 2020 2023 2041               # A
+00010d30: 7474 7269 6275 7465 730a 2020 2020 2020  ttributes.      
+00010d40: 2020 2020 2020 2020 2020 6c61 745f 7661            lat_va
+00010d50: 7269 642e 6c6f 6e67 5f6e 616d 6520 3d20  rid.long_name = 
+00010d60: 7365 6c66 2e72 656d 6170 7065 645f 7661  self.remapped_va
+00010d70: 725f 6c61 740a 2020 2020 2020 2020 2020  r_lat.          
+00010d80: 2020 2020 2020 6c6f 6e5f 7661 7269 642e        lon_varid.
+00010d90: 6c6f 6e67 5f6e 616d 6520 3d20 7365 6c66  long_name = self
+00010da0: 2e72 656d 6170 7065 645f 7661 725f 6c6f  .remapped_var_lo
+00010db0: 6e0a 2020 2020 2020 2020 2020 2020 2020  n.              
+00010dc0: 2020 6872 7549 645f 7661 7269 642e 6c6f    hruId_varid.lo
+00010dd0: 6e67 5f6e 616d 6520 3d20 2773 6861 7065  ng_name = 'shape
+00010de0: 2049 4427 0a20 2020 2020 2020 2020 2020   ID'.           
+00010df0: 2020 2020 206c 6174 5f76 6172 6964 2e75       lat_varid.u
+00010e00: 6e69 7473 203d 2027 6465 6772 6565 735f  nits = 'degrees_
+00010e10: 6e6f 7274 6827 0a20 2020 2020 2020 2020  north'.         
+00010e20: 2020 2020 2020 206c 6f6e 5f76 6172 6964         lon_varid
+00010e30: 2e75 6e69 7473 203d 2027 6465 6772 6565  .units = 'degree
+00010e40: 735f 6561 7374 270a 2020 2020 2020 2020  s_east'.        
+00010e50: 2020 2020 2020 2020 6872 7549 645f 7661          hruId_va
+00010e60: 7269 642e 756e 6974 7320 3d20 2731 270a  rid.units = '1'.
+00010e70: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00010e80: 6c61 745f 7661 7269 642e 7374 616e 6461  lat_varid.standa
+00010e90: 7264 5f6e 616d 6520 3d20 7365 6c66 2e72  rd_name = self.r
+00010ea0: 656d 6170 7065 645f 7661 725f 6c61 740a  emapped_var_lat.
+00010eb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00010ec0: 6c6f 6e5f 7661 7269 642e 7374 616e 6461  lon_varid.standa
+00010ed0: 7264 5f6e 616d 6520 3d20 7365 6c66 2e72  rd_name = self.r
+00010ee0: 656d 6170 7065 645f 7661 725f 6c6f 6e0a  emapped_var_lon.
+00010ef0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00010f00: 6c61 745f 7661 7269 645b 3a5d 203d 2068  lat_varid[:] = h
+00010f10: 7275 4944 5f6c 6174 0a20 2020 2020 2020  ruID_lat.       
+00010f20: 2020 2020 2020 2020 206c 6f6e 5f76 6172           lon_var
+00010f30: 6964 5b3a 5d20 3d20 6872 7549 445f 6c6f  id[:] = hruID_lo
+00010f40: 6e0a 2020 2020 2020 2020 2020 2020 2020  n.              
+00010f50: 2020 6872 7549 645f 7661 7269 645b 3a5d    hruId_varid[:]
+00010f60: 203d 2068 7275 4944 5f76 6172 0a20 2020   = hruID_var.   
+00010f70: 2020 2020 2020 2020 2020 2020 2023 2067               # g
+00010f80: 656e 6572 616c 2061 7474 7269 6275 7465  eneral attribute
+00010f90: 7320 666f 7220 4e65 7443 4446 2066 696c  s for NetCDF fil
+00010fa0: 650a 2020 2020 2020 2020 2020 2020 2020  e.              
+00010fb0: 2020 6e63 6964 2e43 6f6e 7665 6e74 696f    ncid.Conventio
+00010fc0: 6e73 203d 2027 4346 2d31 2e36 270a 2020  ns = 'CF-1.6'.  
+00010fd0: 2020 2020 2020 2020 2020 2020 2020 6e63                nc
+00010fe0: 6964 2e41 7574 686f 7220 3d20 2754 6865  id.Author = 'The
+00010ff0: 2064 6174 6120 7765 7265 2077 7269 7474   data were writt
+00011000: 656e 2062 7920 2720 2b20 7365 6c66 2e61  en by ' + self.a
+00011010: 7574 686f 725f 6e61 6d65 0a20 2020 2020  uthor_name.     
+00011020: 2020 2020 2020 2020 2020 206e 6369 642e             ncid.
+00011030: 4c69 6365 6e73 6520 3d20 7365 6c66 2e6c  License = self.l
+00011040: 6963 656e 7365 0a20 2020 2020 2020 2020  icense.         
+00011050: 2020 2020 2020 206e 6369 642e 4869 7374         ncid.Hist
+00011060: 6f72 7920 3d20 2743 7265 6174 6564 2027  ory = 'Created '
+00011070: 202b 2074 696d 652e 6374 696d 6528 7469   + time.ctime(ti
+00011080: 6d65 2e74 696d 6528 2929 0a20 2020 2020  me.time()).     
+00011090: 2020 2020 2020 2020 2020 206e 6369 642e             ncid.
+000110a0: 536f 7572 6365 203d 2027 4361 7365 3a20  Source = 'Case: 
+000110b0: 2720 2b73 656c 662e 6361 7365 5f6e 616d  ' +self.case_nam
+000110c0: 6520 2b20 273b 2072 656d 6170 7065 6420  e + '; remapped 
+000110d0: 6279 2073 6372 6970 7420 6672 6f6d 206c  by script from l
+000110e0: 6962 7261 7279 206f 6620 5368 6572 7661  ibrary of Sherva
+000110f0: 6e20 4768 6172 6172 6920 2868 7474 7073  n Gharari (https
+00011100: 3a2f 2f67 6974 6875 622e 636f 6d2f 5368  ://github.com/Sh
+00011110: 6572 7661 6e47 6861 7261 7269 2f45 4153  ervanGharari/EAS
+00011120: 594d 4f52 4529 2e27 0a20 2020 2020 2020  YMORE).'.       
+00011130: 2020 2020 2020 2020 2023 2077 7269 7465           # write
+00011140: 2076 6172 6961 626c 6573 0a20 2020 2020   variables.     
+00011150: 2020 2020 2020 2020 2020 2023 2063 6865             # che
+00011160: 636b 2063 6875 6e6b 696e 6720 6368 6f69  ck chunking choi
+00011170: 6365 0a20 2020 2020 2020 2020 2020 2020  ce.             
+00011180: 2020 2069 6620 7365 6c66 2e72 656d 6170     if self.remap
+00011190: 7065 645f 6368 756e 6b5f 7369 7a65 203d  ped_chunk_size =
+000111a0: 3d20 4e6f 6e65 3a0a 2020 2020 2020 2020  = None:.        
+000111b0: 2020 2020 2020 2020 2020 2020 6368 756e              chun
+000111c0: 6b5f 7369 7a65 7320 3d20 4e6f 6e65 2023  k_sizes = None #
+000111d0: 2055 7365 206e 6574 4344 4634 2064 6566   Use netCDF4 def
+000111e0: 6175 6c74 2076 616c 7565 732c 2069 2e65  ault values, i.e
+000111f0: 2e20 2831 2c6e 2920 6368 756e 6b20 6c65  . (1,n) chunk le
+00011200: 6e67 7468 7320 666f 7220 2875 6e6c 696d  ngths for (unlim
+00011210: 6974 6564 2c6c 696d 6974 6564 2920 6469  ited,limited) di
+00011220: 6d65 6e73 696f 6e73 2c20 7768 6572 6520  mensions, where 
+00011230: 6e20 6973 2074 6865 206c 656e 6774 6820  n is the length 
+00011240: 6f66 2074 6865 206c 696d 6974 6564 2064  of the limited d
+00011250: 696d 0a20 2020 2020 2020 2020 2020 2020  im.             
+00011260: 2020 2065 6c73 653a 0a20 2020 2020 2020     else:.       
+00011270: 2020 2020 2020 2020 2020 2020 2063 6875               chu
+00011280: 6e6b 5f6c 656e 6774 6820 3d20 6d69 6e28  nk_length = min(
+00011290: 7365 6c66 2e72 656d 6170 7065 645f 6368  self.remapped_ch
+000112a0: 756e 6b5f 7369 7a65 2c20 7365 6c66 2e6e  unk_size, self.n
+000112b0: 756d 6265 725f 6f66 5f74 6172 6765 745f  umber_of_target_
+000112c0: 656c 656d 656e 7473 2920 2320 646f 6e27  elements) # don'
+000112d0: 7420 6d61 6b65 2061 2063 6875 6e6b 203e  t make a chunk >
+000112e0: 2064 6174 6120 6c65 6e67 7468 0a20 2020   data length.   
+000112f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00011300: 2063 6875 6e6b 5f73 697a 6573 203d 2028   chunk_sizes = (
+00011310: 312c 6368 756e 6b5f 6c65 6e67 7468 2920  1,chunk_length) 
+00011320: 2320 2874 696d 652c 7265 6d61 705f 6469  # (time,remap_di
+00011330: 6d29 0a20 2020 2020 2020 2020 2020 2020  m).             
+00011340: 2020 2023 6c6f 6f70 206f 7665 7220 7661     #loop over va
+00011350: 7269 6162 6c65 730a 2020 2020 2020 2020  riables.        
+00011360: 2020 2020 2020 2020 666f 7220 6920 696e          for i in
+00011370: 206e 702e 6172 616e 6765 286c 656e 2873   np.arange(len(s
+00011380: 656c 662e 7661 725f 6e61 6d65 7329 293a  elf.var_names)):
+00011390: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+000113a0: 2020 2020 2076 6172 5f76 616c 7565 2020       var_value  
+000113b0: 3d20 7365 6c66 2e5f 5f77 6569 6768 7465  = self.__weighte
+000113c0: 645f 6176 6572 6167 6528 206e 635f 6e61  d_average( nc_na
+000113d0: 6d65 2c0a 2020 2020 2020 2020 2020 2020  me,.            
+000113e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000113f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00011400: 2020 2020 2020 2020 2020 2020 2020 7461                ta
+00011410: 7267 6574 5f64 6174 655f 7469 6d65 732c  rget_date_times,
+00011420: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
 00011430: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00011440: 636f 6c5f 6e61 6d65 7320 3d20 6c69 7374  col_names = list
-00011450: 2866 696c 7465 7228 6c61 6d62 6461 2078  (filter(lambda x
-00011460: 3a20 782e 7374 6172 7473 7769 7468 2827  : x.startswith('
-00011470: 535f 315f 2729 2c20 636f 6c5f 6e61 6d65  S_1_'), col_name
-00011480: 7329 290a 2020 2020 2020 2020 2020 2020  s)).            
-00011490: 2020 2020 636f 6c5f 6e61 6d65 732e 6170      col_names.ap
-000114a0: 7065 6e64 2827 6765 6f6d 6574 7279 2729  pend('geometry')
-000114b0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-000114c0: 2073 6870 5f69 6e74 3120 3d20 7368 705f   shp_int1 = shp_
-000114d0: 696e 7431 5b73 6870 5f69 6e74 312e 636f  int1[shp_int1.co
-000114e0: 6c75 6d6e 732e 696e 7465 7273 6563 7469  lumns.intersecti
-000114f0: 6f6e 2863 6f6c 5f6e 616d 6573 295d 0a20  on(col_names)]. 
-00011500: 2020 2020 2020 2020 2020 2020 2020 2063                 c
-00011510: 6f6c 5f6e 616d 6573 2e72 656d 6f76 6528  ol_names.remove(
-00011520: 2767 656f 6d65 7472 7927 290a 2020 2020  'geometry').    
-00011530: 2020 2020 2020 2020 2020 2020 2320 7265              # re
-00011540: 6e61 6d65 2063 6f6c 756d 6e73 2077 6974  name columns wit
-00011550: 686f 7574 2053 5f31 5f0a 2020 2020 2020  hout S_1_.      
-00011560: 2020 2020 2020 2020 2020 666f 7220 636f            for co
-00011570: 6c5f 6e61 6d65 2069 6e20 636f 6c5f 6e61  l_name in col_na
-00011580: 6d65 733a 0a20 2020 2020 2020 2020 2020  mes:.           
-00011590: 2020 2020 2020 2020 2063 6f6c 5f6e 616d           col_nam
-000115a0: 6520 3d20 7374 7228 636f 6c5f 6e61 6d65  e = str(col_name
-000115b0: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
-000115c0: 2020 2020 2020 636f 6c5f 6e61 6d65 5f6e        col_name_n
-000115d0: 203d 2063 6f6c 5f6e 616d 652e 7265 706c   = col_name.repl
-000115e0: 6163 6528 2253 5f31 5f22 2c22 2229 3b0a  ace("S_1_","");.
+00011440: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00011450: 2020 2020 2020 2020 2020 2073 656c 662e             self.
+00011460: 7661 725f 6e61 6d65 735b 695d 2c0a 2020  var_names[i],.  
+00011470: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00011480: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00011490: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000114a0: 2020 2020 2020 2020 7365 6c66 2e66 696c          self.fil
+000114b0: 6c5f 7661 6c75 655f 6c69 7374 5b69 5d2c  l_value_list[i],
+000114c0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+000114d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000114e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000114f0: 2020 2020 2020 2020 2020 2072 656d 6170             remap
+00011500: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
+00011510: 2020 2020 2020 2320 5661 7269 6162 6c65        # Variable
+00011520: 7320 7772 6974 696e 670a 2020 2020 2020  s writing.      
+00011530: 2020 2020 2020 2020 2020 2020 2020 7661                va
+00011540: 7269 6420 3d20 6e63 6964 2e63 7265 6174  rid = ncid.creat
+00011550: 6556 6172 6961 626c 6528 7365 6c66 2e76  eVariable(self.v
+00011560: 6172 5f6e 616d 6573 5f72 656d 6170 7065  ar_names_remappe
+00011570: 645b 695d 2c20 5c0a 2020 2020 2020 2020  d[i], \.        
+00011580: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00011590: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000115a0: 2020 2020 2020 2020 7365 6c66 2e66 6f72          self.for
+000115b0: 6d61 745f 6c69 7374 5b69 5d2c 2028 2774  mat_list[i], ('t
+000115c0: 696d 6527 2c73 656c 662e 7265 6d61 7070  ime',self.remapp
+000115d0: 6564 5f64 696d 5f69 6420 292c 5c0a 2020  ed_dim_id ),\.  
+000115e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
 000115f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00011600: 2020 2020 7368 705f 696e 7431 203d 2073      shp_int1 = s
-00011610: 6870 5f69 6e74 312e 7265 6e61 6d65 2863  hp_int1.rename(c
-00011620: 6f6c 756d 6e73 3d7b 636f 6c5f 6e61 6d65  olumns={col_name
-00011630: 3a20 636f 6c5f 6e61 6d65 5f6e 7d29 0a20  : col_name_n}). 
-00011640: 2020 2020 2020 2020 2020 2020 2020 2023                 #
-00011650: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00011660: 2066 6f72 2069 6e64 6578 2c20 5f20 696e   for index, _ in
-00011670: 2073 6870 5f69 6e74 312e 6974 6572 726f   shp_int1.iterro
-00011680: 7773 2829 3a0a 2020 2020 2020 2020 2020  ws():.          
-00011690: 2020 2020 2020 2020 2020 706f 6c79 7320            polys 
-000116a0: 3d20 7368 705f 696e 7431 2e67 656f 6d65  = shp_int1.geome
-000116b0: 7472 792e 696c 6f63 5b69 6e64 6578 5d20  try.iloc[index] 
-000116c0: 2320 6765 7420 7468 6520 7368 6170 650a  # get the shape.
-000116d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000116e0: 2020 2020 706f 6c79 7320 3d20 7368 6170      polys = shap
-000116f0: 656c 792e 6166 6669 6e69 7479 2e74 7261  ely.affinity.tra
-00011700: 6e73 6c61 7465 2870 6f6c 7973 2c20 786f  nslate(polys, xo
-00011710: 6666 3d2d 3336 302e 302c 2079 6f66 663d  ff=-360.0, yoff=
-00011720: 302e 302c 207a 6f66 663d 302e 3029 0a20  0.0, zoff=0.0). 
-00011730: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00011740: 2020 2073 6870 5f69 6e74 312e 6765 6f6d     shp_int1.geom
-00011750: 6574 7279 2e69 6c6f 635b 696e 6465 785d  etry.iloc[index]
-00011760: 203d 2070 6f6c 7973 0a20 2020 2020 2020   = polys.       
-00011770: 2020 2020 2020 2020 2023 2073 6861 7065           # shape
-00011780: 6669 6c65 2077 6974 6820 2d31 3830 2074  file with -180 t
-00011790: 6f20 3138 3020 6c6f 6e0a 2020 2020 2020  o 180 lon.      
-000117a0: 2020 2020 2020 2020 2020 6764 6632 203d            gdf2 =
-000117b0: 207b 2767 656f 6d65 7472 7927 3a20 5b50   {'geometry': [P
-000117c0: 6f6c 7967 6f6e 285b 2820 2d31 3830 2e30  olygon([( -180.0
-000117d0: 2b73 656c 662e 746f 6c65 7261 6e63 652c  +self.tolerance,
-000117e0: 202d 3930 2e30 2b73 656c 662e 746f 6c65   -90.0+self.tole
-000117f0: 7261 6e63 6529 2c20 282d 3138 302e 302b  rance), (-180.0+
-00011800: 7365 6c66 2e74 6f6c 6572 616e 6365 2c20  self.tolerance, 
-00011810: 2039 302e 302d 7365 6c66 2e74 6f6c 6572   90.0-self.toler
-00011820: 616e 6365 292c 5c0a 2020 2020 2020 2020  ance),\.        
-00011830: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00011840: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00011850: 2020 2020 2020 2820 2031 3830 2e30 2d73        (  180.0-s
-00011860: 656c 662e 746f 6c65 7261 6e63 652c 2020  elf.tolerance,  
-00011870: 3930 2e30 2d73 656c 662e 746f 6c65 7261  90.0-self.tolera
-00011880: 6e63 6529 2c20 2820 3138 302e 302d 7365  nce), ( 180.0-se
-00011890: 6c66 2e74 6f6c 6572 616e 6365 2c20 2d39  lf.tolerance, -9
-000118a0: 302e 302b 7365 6c66 2e74 6f6c 6572 616e  0.0+self.toleran
-000118b0: 6365 295d 295d 7d0a 2020 2020 2020 2020  ce)])]}.        
-000118c0: 2020 2020 2020 2020 6764 6632 203d 2067          gdf2 = g
-000118d0: 7064 2e47 656f 4461 7461 4672 616d 6528  pd.GeoDataFrame(
-000118e0: 6764 6632 290a 2020 2020 2020 2020 2020  gdf2).          
-000118f0: 2020 2020 2020 6764 6632 203d 2067 6466        gdf2 = gdf
-00011900: 322e 7365 745f 6372 7320 2822 6570 7367  2.set_crs ("epsg
-00011910: 3a34 3332 3622 290a 2020 2020 2020 2020  :4326").        
-00011920: 2020 2020 2020 2020 7761 726e 696e 6773          warnings
-00011930: 2e73 696d 706c 6566 696c 7465 7228 2769  .simplefilter('i
-00011940: 676e 6f72 6527 290a 2020 2020 2020 2020  gnore').        
-00011950: 2020 2020 2020 2020 7368 705f 696e 7432          shp_int2
-00011960: 203d 2073 656c 662e 696e 7465 7273 6563   = self.intersec
-00011970: 7469 6f6e 5f73 6870 2873 6870 2c20 6764  tion_shp(shp, gd
-00011980: 6632 290a 2020 2020 2020 2020 2020 2020  f2).            
-00011990: 2020 2020 7761 726e 696e 6773 2e73 696d      warnings.sim
-000119a0: 706c 6566 696c 7465 7228 2764 6566 6175  plefilter('defau
-000119b0: 6c74 2729 0a20 2020 2020 2020 2020 2020  lt').           
-000119c0: 2020 2020 2063 6f6c 5f6e 616d 6573 203d       col_names =
-000119d0: 2073 6870 5f69 6e74 322e 636f 6c75 6d6e   shp_int2.column
-000119e0: 730a 2020 2020 2020 2020 2020 2020 2020  s.              
-000119f0: 2020 636f 6c5f 6e61 6d65 7320 3d20 6c69    col_names = li
-00011a00: 7374 2866 696c 7465 7228 6c61 6d62 6461  st(filter(lambda
-00011a10: 2078 3a20 782e 7374 6172 7473 7769 7468   x: x.startswith
-00011a20: 2827 535f 315f 2729 2c20 636f 6c5f 6e61  ('S_1_'), col_na
-00011a30: 6d65 7329 290a 2020 2020 2020 2020 2020  mes)).          
-00011a40: 2020 2020 2020 636f 6c5f 6e61 6d65 732e        col_names.
-00011a50: 6170 7065 6e64 2827 6765 6f6d 6574 7279  append('geometry
-00011a60: 2729 0a20 2020 2020 2020 2020 2020 2020  ').             
-00011a70: 2020 2073 6870 5f69 6e74 3220 3d20 7368     shp_int2 = sh
-00011a80: 705f 696e 7432 5b73 6870 5f69 6e74 322e  p_int2[shp_int2.
-00011a90: 636f 6c75 6d6e 732e 696e 7465 7273 6563  columns.intersec
-00011aa0: 7469 6f6e 2863 6f6c 5f6e 616d 6573 295d  tion(col_names)]
-00011ab0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00011ac0: 2063 6f6c 5f6e 616d 6573 2e72 656d 6f76   col_names.remov
-00011ad0: 6528 2767 656f 6d65 7472 7927 290a 2020  e('geometry').  
-00011ae0: 2020 2020 2020 2020 2020 2020 2020 2320                # 
-00011af0: 7265 6e61 6d65 2063 6f6c 756d 6e73 2077  rename columns w
-00011b00: 6974 686f 7574 2053 5f31 5f0a 2020 2020  ithout S_1_.    
-00011b10: 2020 2020 2020 2020 2020 2020 666f 7220              for 
-00011b20: 636f 6c5f 6e61 6d65 2069 6e20 636f 6c5f  col_name in col_
-00011b30: 6e61 6d65 733a 0a20 2020 2020 2020 2020  names:.         
-00011b40: 2020 2020 2020 2020 2020 2063 6f6c 5f6e             col_n
-00011b50: 616d 6520 3d20 7374 7228 636f 6c5f 6e61  ame = str(col_na
-00011b60: 6d65 290a 2020 2020 2020 2020 2020 2020  me).            
-00011b70: 2020 2020 2020 2020 636f 6c5f 6e61 6d65          col_name
-00011b80: 5f6e 203d 2063 6f6c 5f6e 616d 652e 7265  _n = col_name.re
-00011b90: 706c 6163 6528 2253 5f31 5f22 2c22 2229  place("S_1_","")
-00011ba0: 3b0a 2020 2020 2020 2020 2020 2020 2020  ;.              
-00011bb0: 2020 2020 2020 7368 705f 696e 7432 203d        shp_int2 =
-00011bc0: 2073 6870 5f69 6e74 322e 7265 6e61 6d65   shp_int2.rename
-00011bd0: 2863 6f6c 756d 6e73 3d7b 636f 6c5f 6e61  (columns={col_na
-00011be0: 6d65 3a20 636f 6c5f 6e61 6d65 5f6e 7d29  me: col_name_n})
-00011bf0: 0a20 2020 2020 2020 2020 2020 2023 0a20  .            #. 
-00011c00: 2020 2020 2020 2020 2020 2069 6620 286d             if (m
-00011c10: 6178 5f6c 6f6e 203c 2031 3830 2920 616e  ax_lon < 180) an
-00011c20: 6420 286d 696e 5f6c 6f6e 203c 202d 3138  d (min_lon < -18
-00011c30: 3029 3a0a 2020 2020 2020 2020 2020 2020  0):.            
-00011c40: 2020 2020 7072 696e 7428 2745 4153 594d      print('EASYM
-00011c50: 4f52 4520 6465 7465 6374 7320 7468 6174  ORE detects that
-00011c60: 2073 6861 7065 6669 6c65 206c 6f6e 6769   shapefile longi
-00011c70: 7475 6465 2069 7320 6265 7477 6565 6e20  tude is between 
-00011c80: 3020 616e 6420 3336 302c 2063 6f72 7265  0 and 360, corre
-00011c90: 6374 696f 6e20 6973 2070 6572 666f 726d  ction is perform
-00011ca0: 6564 2074 6f20 7472 616e 7366 6572 2074  ed to transfer t
-00011cb0: 6f20 2d31 3830 2074 6f20 3138 3027 290a  o -180 to 180').
-00011cc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00011cd0: 2320 7368 6170 6566 696c 6520 7769 7468  # shapefile with
-00011ce0: 202d 3138 3020 746f 202d 3336 3020 6c6f   -180 to -360 lo
-00011cf0: 6e0a 2020 2020 2020 2020 2020 2020 2020  n.              
-00011d00: 2020 6764 6631 203d 207b 2767 656f 6d65    gdf1 = {'geome
-00011d10: 7472 7927 3a20 5b50 6f6c 7967 6f6e 285b  try': [Polygon([
-00011d20: 2820 2d33 3630 2e30 2b73 656c 662e 746f  ( -360.0+self.to
-00011d30: 6c65 7261 6e63 652c 202d 3930 2e30 2b73  lerance, -90.0+s
-00011d40: 656c 662e 746f 6c65 7261 6e63 6529 2c20  elf.tolerance), 
-00011d50: 282d 3336 302e 302b 7365 6c66 2e74 6f6c  (-360.0+self.tol
-00011d60: 6572 616e 6365 2c20 2039 302e 302d 7365  erance,  90.0-se
-00011d70: 6c66 2e74 6f6c 6572 616e 6365 292c 5c0a  lf.tolerance),\.
-00011d80: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00011d90: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00011da0: 2020 2020 2020 2020 2020 2020 2020 2820                ( 
-00011db0: 2d31 3830 2e30 2d73 656c 662e 746f 6c65  -180.0-self.tole
-00011dc0: 7261 6e63 652c 2020 3930 2e30 2d73 656c  rance,  90.0-sel
-00011dd0: 662e 746f 6c65 7261 6e63 6529 2c20 282d  f.tolerance), (-
-00011de0: 3138 302e 302d 7365 6c66 2e74 6f6c 6572  180.0-self.toler
-00011df0: 616e 6365 2c20 2d39 302e 302b 7365 6c66  ance, -90.0+self
-00011e00: 2e74 6f6c 6572 616e 6365 295d 295d 7d0a  .tolerance)])]}.
-00011e10: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00011e20: 6764 6631 203d 2067 7064 2e47 656f 4461  gdf1 = gpd.GeoDa
-00011e30: 7461 4672 616d 6528 6764 6631 290a 2020  taFrame(gdf1).  
-00011e40: 2020 2020 2020 2020 2020 2020 2020 6764                gd
-00011e50: 6631 203d 2067 6466 312e 7365 745f 6372  f1 = gdf1.set_cr
-00011e60: 7320 2822 6570 7367 3a34 3332 3622 290a  s ("epsg:4326").
-00011e70: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00011e80: 7761 726e 696e 6773 2e73 696d 706c 6566  warnings.simplef
-00011e90: 696c 7465 7228 2769 676e 6f72 6527 290a  ilter('ignore').
-00011ea0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00011eb0: 7368 705f 696e 7431 203d 2073 656c 662e  shp_int1 = self.
-00011ec0: 696e 7465 7273 6563 7469 6f6e 5f73 6870  intersection_shp
-00011ed0: 2873 6870 2c20 6764 6631 290a 2020 2020  (shp, gdf1).    
-00011ee0: 2020 2020 2020 2020 2020 2020 7761 726e              warn
-00011ef0: 696e 6773 2e73 696d 706c 6566 696c 7465  ings.simplefilte
-00011f00: 7228 2764 6566 6175 6c74 2729 0a20 2020  r('default').   
-00011f10: 2020 2020 2020 2020 2020 2020 2063 6f6c               col
-00011f20: 5f6e 616d 6573 203d 2073 6870 5f69 6e74  _names = shp_int
-00011f30: 312e 636f 6c75 6d6e 730a 2020 2020 2020  1.columns.      
-00011f40: 2020 2020 2020 2020 2020 636f 6c5f 6e61            col_na
-00011f50: 6d65 7320 3d20 6c69 7374 2866 696c 7465  mes = list(filte
-00011f60: 7228 6c61 6d62 6461 2078 3a20 782e 7374  r(lambda x: x.st
-00011f70: 6172 7473 7769 7468 2827 535f 315f 2729  artswith('S_1_')
-00011f80: 2c20 636f 6c5f 6e61 6d65 7329 290a 2020  , col_names)).  
-00011f90: 2020 2020 2020 2020 2020 2020 2020 636f                co
-00011fa0: 6c5f 6e61 6d65 732e 6170 7065 6e64 2827  l_names.append('
-00011fb0: 6765 6f6d 6574 7279 2729 0a20 2020 2020  geometry').     
-00011fc0: 2020 2020 2020 2020 2020 2073 6870 5f69             shp_i
-00011fd0: 6e74 3120 3d20 7368 705f 696e 7431 5b73  nt1 = shp_int1[s
-00011fe0: 6870 5f69 6e74 312e 636f 6c75 6d6e 732e  hp_int1.columns.
-00011ff0: 696e 7465 7273 6563 7469 6f6e 2863 6f6c  intersection(col
-00012000: 5f6e 616d 6573 295d 0a20 2020 2020 2020  _names)].       
-00012010: 2020 2020 2020 2020 2063 6f6c 5f6e 616d           col_nam
-00012020: 6573 2e72 656d 6f76 6528 2767 656f 6d65  es.remove('geome
-00012030: 7472 7927 290a 2020 2020 2020 2020 2020  try').          
-00012040: 2020 2020 2020 2320 7265 6e61 6d65 2063        # rename c
-00012050: 6f6c 756d 6e73 2077 6974 686f 7574 2053  olumns without S
-00012060: 5f31 5f0a 2020 2020 2020 2020 2020 2020  _1_.            
-00012070: 2020 2020 666f 7220 636f 6c5f 6e61 6d65      for col_name
-00012080: 2069 6e20 636f 6c5f 6e61 6d65 733a 0a20   in col_names:. 
-00012090: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000120a0: 2020 2063 6f6c 5f6e 616d 6520 3d20 7374     col_name = st
-000120b0: 7228 636f 6c5f 6e61 6d65 290a 2020 2020  r(col_name).    
-000120c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000120d0: 636f 6c5f 6e61 6d65 5f6e 203d 2063 6f6c  col_name_n = col
-000120e0: 5f6e 616d 652e 7265 706c 6163 6528 2253  _name.replace("S
-000120f0: 5f31 5f22 2c22 2229 3b0a 2020 2020 2020  _1_","");.      
-00012100: 2020 2020 2020 2020 2020 2020 2020 7368                sh
-00012110: 705f 696e 7431 203d 2073 6870 5f69 6e74  p_int1 = shp_int
-00012120: 312e 7265 6e61 6d65 2863 6f6c 756d 6e73  1.rename(columns
-00012130: 3d7b 636f 6c5f 6e61 6d65 3a20 636f 6c5f  ={col_name: col_
-00012140: 6e61 6d65 5f6e 7d29 0a20 2020 2020 2020  name_n}).       
-00012150: 2020 2020 2020 2020 2023 0a20 2020 2020           #.     
-00012160: 2020 2020 2020 2020 2020 2066 6f72 2069             for i
-00012170: 6e64 6578 2c20 5f20 696e 2073 6870 5f69  ndex, _ in shp_i
-00012180: 6e74 312e 6974 6572 726f 7773 2829 3a0a  nt1.iterrows():.
-00012190: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000121a0: 2020 2020 706f 6c79 7320 3d20 7368 705f      polys = shp_
-000121b0: 696e 7431 2e67 656f 6d65 7472 792e 696c  int1.geometry.il
-000121c0: 6f63 5b69 6e64 6578 5d20 2320 6765 7420  oc[index] # get 
-000121d0: 7468 6520 7368 6170 650a 2020 2020 2020  the shape.      
-000121e0: 2020 2020 2020 2020 2020 2020 2020 706f                po
-000121f0: 6c79 7320 3d20 7368 6170 656c 792e 6166  lys = shapely.af
-00012200: 6669 6e69 7479 2e74 7261 6e73 6c61 7465  finity.translate
-00012210: 2870 6f6c 7973 2c20 786f 6666 3d2b 3336  (polys, xoff=+36
-00012220: 302e 302c 2079 6f66 663d 302e 302c 207a  0.0, yoff=0.0, z
-00012230: 6f66 663d 302e 3029 0a20 2020 2020 2020  off=0.0).       
-00012240: 2020 2020 2020 2020 2020 2020 2073 6870               shp
-00012250: 5f69 6e74 312e 6765 6f6d 6574 7279 2e69  _int1.geometry.i
-00012260: 6c6f 635b 696e 6465 785d 203d 2070 6f6c  loc[index] = pol
-00012270: 7973 0a20 2020 2020 2020 2020 2020 2020  ys.             
-00012280: 2020 2023 2073 6861 7065 6669 6c65 2077     # shapefile w
-00012290: 6974 6820 2d31 3830 2074 6f20 3138 3020  ith -180 to 180 
-000122a0: 6c6f 6e0a 2020 2020 2020 2020 2020 2020  lon.            
-000122b0: 2020 2020 6764 6632 203d 207b 2767 656f      gdf2 = {'geo
-000122c0: 6d65 7472 7927 3a20 5b50 6f6c 7967 6f6e  metry': [Polygon
-000122d0: 285b 2820 2d31 3830 2e30 2b73 656c 662e  ([( -180.0+self.
-000122e0: 746f 6c65 7261 6e63 652c 202d 3930 2e30  tolerance, -90.0
-000122f0: 2b73 656c 662e 746f 6c65 7261 6e63 6529  +self.tolerance)
-00012300: 2c20 282d 3138 302e 302b 7365 6c66 2e74  , (-180.0+self.t
-00012310: 6f6c 6572 616e 6365 2c20 2039 302e 302d  olerance,  90.0-
-00012320: 7365 6c66 2e74 6f6c 6572 616e 6365 292c  self.tolerance),
-00012330: 5c0a 2020 2020 2020 2020 2020 2020 2020  \.              
-00012340: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00012350: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00012360: 2820 2031 3830 2e30 2d73 656c 662e 746f  (  180.0-self.to
-00012370: 6c65 7261 6e63 652c 2020 3930 2e30 2d73  lerance,  90.0-s
-00012380: 656c 662e 746f 6c65 7261 6e63 6529 2c20  elf.tolerance), 
-00012390: 2820 3138 302e 302d 7365 6c66 2e74 6f6c  ( 180.0-self.tol
-000123a0: 6572 616e 6365 2c20 2d39 302e 302b 7365  erance, -90.0+se
-000123b0: 6c66 2e74 6f6c 6572 616e 6365 295d 295d  lf.tolerance)])]
-000123c0: 7d0a 2020 2020 2020 2020 2020 2020 2020  }.              
-000123d0: 2020 6764 6632 203d 2067 7064 2e47 656f    gdf2 = gpd.Geo
-000123e0: 4461 7461 4672 616d 6528 6764 6632 290a  DataFrame(gdf2).
-000123f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00012400: 6764 6632 203d 2067 6466 322e 7365 745f  gdf2 = gdf2.set_
-00012410: 6372 7320 2822 6570 7367 3a34 3332 3622  crs ("epsg:4326"
-00012420: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
-00012430: 2020 7761 726e 696e 6773 2e73 696d 706c    warnings.simpl
-00012440: 6566 696c 7465 7228 2769 676e 6f72 6527  efilter('ignore'
-00012450: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
-00012460: 2020 7368 705f 696e 7432 203d 2073 656c    shp_int2 = sel
-00012470: 662e 696e 7465 7273 6563 7469 6f6e 5f73  f.intersection_s
-00012480: 6870 2873 6870 2c20 6764 6632 290a 2020  hp(shp, gdf2).  
-00012490: 2020 2020 2020 2020 2020 2020 2020 7761                wa
-000124a0: 726e 696e 6773 2e73 696d 706c 6566 696c  rnings.simplefil
-000124b0: 7465 7228 2764 6566 6175 6c74 2729 0a20  ter('default'). 
-000124c0: 2020 2020 2020 2020 2020 2020 2020 2063                 c
-000124d0: 6f6c 5f6e 616d 6573 203d 2073 6870 5f69  ol_names = shp_i
-000124e0: 6e74 322e 636f 6c75 6d6e 730a 2020 2020  nt2.columns.    
-000124f0: 2020 2020 2020 2020 2020 2020 636f 6c5f              col_
-00012500: 6e61 6d65 7320 3d20 6c69 7374 2866 696c  names = list(fil
-00012510: 7465 7228 6c61 6d62 6461 2078 3a20 782e  ter(lambda x: x.
-00012520: 7374 6172 7473 7769 7468 2827 535f 315f  startswith('S_1_
-00012530: 2729 2c20 636f 6c5f 6e61 6d65 7329 290a  '), col_names)).
-00012540: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00012550: 636f 6c5f 6e61 6d65 732e 6170 7065 6e64  col_names.append
-00012560: 2827 6765 6f6d 6574 7279 2729 0a20 2020  ('geometry').   
-00012570: 2020 2020 2020 2020 2020 2020 2073 6870               shp
-00012580: 5f69 6e74 3220 3d20 7368 705f 696e 7432  _int2 = shp_int2
-00012590: 5b73 6870 5f69 6e74 322e 636f 6c75 6d6e  [shp_int2.column
-000125a0: 732e 696e 7465 7273 6563 7469 6f6e 2863  s.intersection(c
-000125b0: 6f6c 5f6e 616d 6573 295d 0a20 2020 2020  ol_names)].     
-000125c0: 2020 2020 2020 2020 2020 2063 6f6c 5f6e             col_n
-000125d0: 616d 6573 2e72 656d 6f76 6528 2767 656f  ames.remove('geo
-000125e0: 6d65 7472 7927 290a 2020 2020 2020 2020  metry').        
-000125f0: 2020 2020 2020 2020 2320 7265 6e61 6d65          # rename
-00012600: 2063 6f6c 756d 6e73 2077 6974 686f 7574   columns without
-00012610: 2053 5f31 5f0a 2020 2020 2020 2020 2020   S_1_.          
-00012620: 2020 2020 2020 666f 7220 636f 6c5f 6e61        for col_na
-00012630: 6d65 2069 6e20 636f 6c5f 6e61 6d65 733a  me in col_names:
-00012640: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00012650: 2020 2020 2063 6f6c 5f6e 616d 6520 3d20       col_name = 
-00012660: 7374 7228 636f 6c5f 6e61 6d65 290a 2020  str(col_name).  
-00012670: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00012680: 2020 636f 6c5f 6e61 6d65 5f6e 203d 2063    col_name_n = c
-00012690: 6f6c 5f6e 616d 652e 7265 706c 6163 6528  ol_name.replace(
-000126a0: 2253 5f31 5f22 2c22 2229 3b0a 2020 2020  "S_1_","");.    
-000126b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000126c0: 7368 705f 696e 7432 203d 2073 6870 5f69  shp_int2 = shp_i
-000126d0: 6e74 322e 7265 6e61 6d65 2863 6f6c 756d  nt2.rename(colum
-000126e0: 6e73 3d7b 636f 6c5f 6e61 6d65 3a20 636f  ns={col_name: co
-000126f0: 6c5f 6e61 6d65 5f6e 7d29 0a20 2020 2020  l_name_n}).     
-00012700: 2020 2020 2020 2023 206d 6572 6769 6e67         # merging
-00012710: 2074 6865 2074 776f 2073 6861 7065 6669   the two shapefi
-00012720: 6c65 730a 2020 2020 2020 2020 2020 2020  les.            
-00012730: 6966 206e 6f74 2073 6870 5f69 6e74 312e  if not shp_int1.
-00012740: 656d 7074 7920 616e 6420 6e6f 7420 7368  empty and not sh
-00012750: 705f 696e 7432 2e65 6d70 7479 3a0a 2020  p_int2.empty:.  
-00012760: 2020 2020 2020 2020 2020 2020 2020 7368                sh
-00012770: 705f 6669 6e61 6c20 3d20 7064 2e63 6f6e  p_final = pd.con
-00012780: 6361 7428 5b73 6870 5f69 6e74 312c 7368  cat([shp_int1,sh
-00012790: 705f 696e 7432 5d29 0a20 2020 2020 2020  p_int2]).       
-000127a0: 2020 2020 2065 6c69 6620 6e6f 7420 7368       elif not sh
-000127b0: 705f 696e 7431 2e65 6d70 7479 3a0a 2020  p_int1.empty:.  
-000127c0: 2020 2020 2020 2020 2020 2020 2020 7368                sh
-000127d0: 705f 6669 6e61 6c20 3d20 7368 705f 696e  p_final = shp_in
-000127e0: 7431 0a20 2020 2020 2020 2020 2020 2065  t1.            e
-000127f0: 6c69 6620 6e6f 7420 7368 705f 696e 7432  lif not shp_int2
-00012800: 2e65 6d70 7479 3a0a 2020 2020 2020 2020  .empty:.        
-00012810: 2020 2020 2020 2020 7368 705f 6669 6e61          shp_fina
-00012820: 6c20 3d20 7368 705f 696e 7432 0a20 2020  l = shp_int2.   
-00012830: 2020 2020 2023 2070 7574 2062 6163 6b20       # put back 
-00012840: 7468 6520 7061 6e64 6173 2069 6e74 6f20  the pandas into 
-00012850: 6765 6f70 616e 6461 730a 2020 2020 2020  geopandas.      
-00012860: 2020 7368 705f 6669 6e61 6c20 3d20 7368    shp_final = sh
-00012870: 705f 6669 6e61 6c2e 7365 745f 6765 6f6d  p_final.set_geom
-00012880: 6574 7279 2827 6765 6f6d 6574 7279 2729  etry('geometry')
-00012890: 0a20 2020 2020 2020 2073 6870 5f66 696e  .        shp_fin
-000128a0: 616c 203d 2073 6870 5f66 696e 616c 2e64  al = shp_final.d
-000128b0: 6973 736f 6c76 6528 6279 3d27 4944 272c  issolve(by='ID',
-000128c0: 2061 735f 696e 6465 783d 4661 6c73 6529   as_index=False)
-000128d0: 0a20 2020 2020 2020 2073 6870 5f66 696e  .        shp_fin
-000128e0: 616c 203d 2073 6870 5f66 696e 616c 2e73  al = shp_final.s
-000128f0: 6f72 745f 7661 6c75 6573 2862 793d 2749  ort_values(by='I
-00012900: 4427 290a 2020 2020 2020 2020 7368 705f  D').        shp_
-00012910: 6669 6e61 6c20 3d20 7368 705f 6669 6e61  final = shp_fina
-00012920: 6c2e 6472 6f70 2863 6f6c 756d 6e73 3d27  l.drop(columns='
-00012930: 4944 2729 0a20 2020 2020 2020 2069 6620  ID').        if 
-00012940: 6e6f 7420 6466 5f61 7474 7269 6275 7465  not df_attribute
-00012950: 2e65 6d70 7479 3a20 2320 6164 6420 6174  .empty: # add at
-00012960: 7472 6962 7574 6573 0a20 2020 2020 2020  tributes.       
-00012970: 2020 2020 2073 6870 5f66 696e 616c 203d       shp_final =
-00012980: 2070 642e 636f 6e63 6174 285b 7368 705f   pd.concat([shp_
-00012990: 6669 6e61 6c2c 2064 665f 6174 7472 6962  final, df_attrib
-000129a0: 7574 655d 2c20 6178 6973 3d31 290a 2020  ute], axis=1).  
-000129b0: 2020 2020 2020 2320 6368 6563 6b20 6966        # check if
-000129c0: 2074 6865 206f 7574 7075 7420 6861 7320   the output has 
-000129d0: 7468 6520 7361 6d65 206e 756d 6265 7220  the same number 
-000129e0: 6f66 2065 6c65 6d65 6e74 730a 2020 2020  of elements.    
-000129f0: 2020 2020 6966 206c 656e 2873 6870 2920      if len(shp) 
-00012a00: 213d 206c 656e 2873 6870 5f66 696e 616c  != len(shp_final
-00012a10: 293a 0a20 2020 2020 2020 2020 2020 2073  ):.            s
-00012a20: 7973 2e65 7869 7428 2774 6865 2065 6c65  ys.exit('the ele
-00012a30: 6d65 6e74 206f 6620 696e 7075 7420 7368  ment of input sh
-00012a40: 6170 6566 696c 6520 616e 6420 636f 7272  apefile and corr
-00012a50: 6563 7465 6420 7368 6170 6566 696c 6520  ected shapefile 
-00012a60: 6172 6561 206e 6f74 2074 6865 2073 616d  area not the sam
-00012a70: 6527 290a 2020 2020 2020 2020 2320 7265  e').        # re
-00012a80: 7475 726e 2074 6865 2073 6861 7065 6669  turn the shapefi
-00012a90: 6c65 0a20 2020 2020 2020 2072 6574 7572  le.        retur
-00012aa0: 6e20 7368 705f 6669 6e61 6c0a 0a0a 2020  n shp_final...  
-00012ab0: 2020 6465 6620 7368 705f 6365 6e74 726f    def shp_centro
-00012ac0: 6964 5f65 7175 616c 5f61 7265 6120 2873  id_equal_area (s
-00012ad0: 656c 662c 0a20 2020 2020 2020 2020 2020  elf,.           
-00012ae0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00012af0: 2020 2020 2020 7368 7029 3a0a 2020 2020        shp):.    
-00012b00: 2020 2020 2222 220a 2020 2020 2020 2020      """.        
-00012b10: 4020 6175 7468 6f72 3a20 2020 2020 2020  @ author:       
-00012b20: 2020 2020 2020 2020 2020 2053 6865 7276             Sherv
-00012b30: 616e 2047 6861 7261 7269 0a20 2020 2020  an Gharari.     
-00012b40: 2020 2040 2047 6974 6875 623a 2020 2020     @ Github:    
-00012b50: 2020 2020 2020 2020 2020 2020 2020 6874                ht
-00012b60: 7470 733a 2f2f 6769 7468 7562 2e63 6f6d  tps://github.com
-00012b70: 2f53 6865 7276 616e 4768 6172 6172 692f  /ShervanGharari/
-00012b80: 4541 5359 4d4f 5245 0a20 2020 2020 2020  EASYMORE.       
-00012b90: 2040 2061 7574 686f 7227 7320 656d 6169   @ author's emai
-00012ba0: 6c20 6964 3a20 2020 2020 2020 7368 2e67  l id:       sh.g
-00012bb0: 6861 7261 7269 4067 6d61 696c 2e63 6f6d  harari@gmail.com
-00012bc0: 0a20 2020 2020 2020 2040 206c 6963 656e  .        @ licen
-00012bd0: 7365 3a20 2020 2020 2020 2020 2020 2020  se:             
-00012be0: 2020 2020 474e 552d 4750 4c76 330a 2020      GNU-GPLv3.  
-00012bf0: 2020 2020 2020 5468 6973 2066 756e 6374        This funct
-00012c00: 696f 6e20 6361 6c63 756c 7465 7320 7468  ion calcultes th
-00012c10: 6520 6365 6e74 726f 6964 2069 6e20 6571  e centroid in eq
-00012c20: 7561 6c20 6172 6561 2070 726f 6a65 6374  ual area project
-00012c30: 696f 6e20 666f 7220 7368 6170 6566 696c  ion for shapefil
-00012c40: 6520 626f 756e 6420 6265 7477 6565 6e20  e bound between 
-00012c50: 2d31 3830 2074 6f20 3138 302e 0a20 2020  -180 to 180..   
-00012c60: 2020 2020 202d 2d2d 2d2d 2d2d 2d2d 0a20       ---------. 
-00012c70: 2020 2020 2020 2073 6870 3a20 6765 6f70         shp: geop
-00012c80: 616e 6461 7320 7368 6170 6566 696c 650a  andas shapefile.
-00012c90: 2020 2020 2020 2020 5265 7475 726e 730a          Returns.
-00012ca0: 2020 2020 2020 2020 2d2d 2d2d 2d2d 2d0a          -------.
-00012cb0: 2020 2020 2020 2020 7368 703a 2067 656f          shp: geo
-00012cc0: 7061 6e64 6173 2073 6861 7065 6669 6c65  pandas shapefile
-00012cd0: 2077 6974 6820 6365 6e74 726f 6964 2069   with centroid i
-00012ce0: 6e20 6571 7561 6c20 6172 6165 0a20 2020  n equal arae.   
-00012cf0: 2020 2020 2073 6870 5f70 6f69 6e74 733a       shp_points:
-00012d00: 2067 656f 7061 6e64 6173 2073 6861 7065   geopandas shape
-00012d10: 6669 6c65 2028 706f 696e 7473 2920 7769  file (points) wi
-00012d20: 7468 206c 6f63 6174 696f 6e20 696e 2057  th location in W
-00012d30: 4753 3834 2063 6f72 7265 7370 6f6e 7369  GS84 corresponsi
-00012d40: 6e67 2074 6f20 7468 6520 6365 6e74 726f  ng to the centro
-00012d50: 6964 2069 6e20 6571 7561 6c20 6172 6561  id in equal area
-00012d60: 0a20 2020 2020 2020 2022 2222 0a20 2020  .        """.   
-00012d70: 2020 2020 2023 2069 6e20 6571 7561 6c20       # in equal 
-00012d80: 7072 6f6a 6563 7469 6f6e 0a20 2020 2020  projection.     
-00012d90: 2020 2070 7269 6e74 2827 6361 6c63 756c     print('calcul
-00012da0: 6174 696e 6720 6365 6e74 726f 6964 206f  ating centroid o
-00012db0: 6620 7368 6170 6573 2069 6e20 6571 7561  f shapes in equa
-00012dc0: 6c20 6172 6561 2070 726f 6a65 6374 696f  l area projectio
-00012dd0: 6e27 290a 2020 2020 2020 2020 6966 2022  n').        if "
-00012de0: 6570 7367 3a34 3332 3622 206e 6f74 2069  epsg:4326" not i
-00012df0: 6e20 7374 7228 7368 702e 6372 7329 2e6c  n str(shp.crs).l
-00012e00: 6f77 6572 2829 3a0a 2020 2020 2020 2020  ower():.        
-00012e10: 2020 2020 7379 732e 6578 6974 2827 7368      sys.exit('sh
-00012e20: 6170 6566 696c 6520 7368 6f75 6c64 2062  apefile should b
-00012e30: 6520 696e 2057 4753 3834 2070 726f 6a65  e in WGS84 proje
-00012e40: 6374 696f 6e27 293b 0a20 2020 2020 2020  ction');.       
-00012e50: 206d 696e 782c 206d 696e 792c 206d 6178   minx, miny, max
-00012e60: 782c 206d 6178 7920 3d20 7368 702e 746f  x, maxy = shp.to
-00012e70: 7461 6c5f 626f 756e 6473 0a20 2020 2020  tal_bounds.     
-00012e80: 2020 2069 6620 6d61 7878 203e 2031 3830     if maxx > 180
-00012e90: 3a0a 2020 2020 2020 2020 2020 2020 7379  :.            sy
-00012ea0: 732e 6578 6974 2827 6974 2073 6565 6d73  s.exit('it seems
-00012eb0: 2074 6861 7420 7468 6520 7368 6170 6566   that the shapef
-00012ec0: 696c 6520 6861 7320 6c6f 6e67 6974 7564  ile has longitud
-00012ed0: 6520 7661 6c75 6573 206f 6620 6d6f 7265  e values of more
-00012ee0: 2074 6861 6e20 3138 3020 6465 6772 6565   than 180 degree
-00012ef0: 2077 6869 6368 206d 6967 6874 206d 616b   which might mak
-00012f00: 6520 5c0a 2020 2020 2020 2020 2020 2020  e \.            
-00012f10: 7072 6f62 6c65 6d20 696e 2065 7175 616c  problem in equal
-00012f20: 2061 7265 6120 7072 6f6a 6563 7469 6f6e   area projection
-00012f30: 3b20 6f74 6865 7220 736f 6674 7761 7265  ; other software
-00012f40: 2063 616e 2062 6520 7573 6564 2729 3b0a   can be used');.
-00012f50: 2020 2020 2020 2020 7368 705f 7465 6d70          shp_temp
-00012f60: 203d 2073 6870 2e74 6f5f 6372 7320 2822   = shp.to_crs ("
-00012f70: 4550 5347 3a36 3933 3322 2920 2320 736f  EPSG:6933") # so
-00012f80: 7572 6365 2073 6861 7065 6669 6c65 2074  urce shapefile t
-00012f90: 6f20 6571 7561 6c20 6172 6561 0a20 2020  o equal area.   
-00012fa0: 2020 2020 206c 6174 5f63 203d 206e 702e       lat_c = np.
-00012fb0: 6172 7261 7928 7368 705f 7465 6d70 2e63  array(shp_temp.c
-00012fc0: 656e 7472 6f69 642e 7929 2023 2063 656e  entroid.y) # cen
-00012fd0: 7472 6f69 6420 6c61 7420 6672 6f6d 2074  troid lat from t
-00012fe0: 6172 6765 740a 2020 2020 2020 2020 6c6f  arget.        lo
-00012ff0: 6e5f 6320 3d20 6e70 2e61 7272 6179 2873  n_c = np.array(s
-00013000: 6870 5f74 656d 702e 6365 6e74 726f 6964  hp_temp.centroid
-00013010: 2e78 2920 2320 6365 6e74 726f 6964 206c  .x) # centroid l
-00013020: 6f6e 2066 726f 6d20 7461 7267 6574 0a20  on from target. 
-00013030: 2020 2020 2020 2064 665f 706f 696e 7420         df_point 
-00013040: 3d20 7064 2e44 6174 6146 7261 6d65 2829  = pd.DataFrame()
-00013050: 0a20 2020 2020 2020 2064 665f 706f 696e  .        df_poin
-00013060: 7420 5b27 6c61 7427 5d20 3d20 6c61 745f  t ['lat'] = lat_
-00013070: 630a 2020 2020 2020 2020 6466 5f70 6f69  c.        df_poi
-00013080: 6e74 205b 276c 6f6e 275d 203d 206c 6f6e  nt ['lon'] = lon
-00013090: 5f63 0a20 2020 2020 2020 2073 6870 5f70  _c.        shp_p
-000130a0: 6f69 6e74 7320 3d20 7365 6c66 2e6d 616b  oints = self.mak
-000130b0: 655f 7368 6170 655f 706f 696e 7428 6466  e_shape_point(df
-000130c0: 5f70 6f69 6e74 2c20 276c 6f6e 272c 2027  _point, 'lon', '
-000130d0: 6c61 7427 2c20 6372 733d 2245 5053 473a  lat', crs="EPSG:
-000130e0: 3639 3333 2229 0a20 2020 2020 2020 2073  6933").        s
-000130f0: 6870 5f70 6f69 6e74 7320 3d20 7368 705f  hp_points = shp_
-00013100: 706f 696e 7473 2e74 6f5f 6372 7328 2245  points.to_crs("E
-00013110: 5053 473a 3433 3236 2229 2023 2074 6f20  PSG:4326") # to 
-00013120: 5747 530a 2020 2020 2020 2020 7368 705f  WGS.        shp_
-00013130: 706f 696e 7473 203d 2073 6870 5f70 6f69  points = shp_poi
-00013140: 6e74 732e 6472 6f70 2863 6f6c 756d 6e73  nts.drop(columns
-00013150: 3d5b 276c 6174 272c 276c 6f6e 275d 290a  =['lat','lon']).
-00013160: 2020 2020 2020 2020 7368 705f 706f 696e          shp_poin
-00013170: 7473 205b 276c 6174 275d 203d 2073 6870  ts ['lat'] = shp
-00013180: 5f70 6f69 6e74 732e 6765 6f6d 6574 7279  _points.geometry
-00013190: 2e79 0a20 2020 2020 2020 2073 6870 5f70  .y.        shp_p
-000131a0: 6f69 6e74 7320 5b27 6c6f 6e27 5d20 3d20  oints ['lon'] = 
-000131b0: 7368 705f 706f 696e 7473 2e67 656f 6d65  shp_points.geome
-000131c0: 7472 792e 780a 2020 2020 2020 2020 7368  try.x.        sh
-000131d0: 7020 5b27 6c61 745f 6365 6e74 275d 203d  p ['lat_cent'] =
-000131e0: 2073 6870 5f70 6f69 6e74 7320 5b27 6c61   shp_points ['la
-000131f0: 7427 5d0a 2020 2020 2020 2020 7368 7020  t'].        shp 
-00013200: 5b27 6c6f 6e5f 6365 6e74 275d 203d 2073  ['lon_cent'] = s
-00013210: 6870 5f70 6f69 6e74 7320 5b27 6c6f 6e27  hp_points ['lon'
-00013220: 5d0a 2020 2020 2020 2020 7265 7475 726e  ].        return
-00013230: 2073 6870 2c20 7368 705f 706f 696e 7473   shp, shp_points
-00013240: 0a0a 0a20 2020 2023 2323 2323 2323 2323  ...    #########
-00013250: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-00013260: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-00013270: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-00013280: 2323 2323 230a 2020 2020 2323 2323 2047  #####.    #### G
-00013290: 4953 2073 6563 7469 6f6e 0a20 2020 2023  IS section.    #
-000132a0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-000132b0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-000132c0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-000132d0: 2323 2323 2323 2323 2323 2323 230a 0a20  #############.. 
-000132e0: 2020 2064 6566 2069 6e74 6572 7365 6374     def intersect
-000132f0: 696f 6e5f 7368 7028 2020 2073 656c 662c  ion_shp(   self,
-00013300: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00013310: 2020 2020 2020 2020 2020 2020 2073 6870               shp
-00013320: 5f31 2c0a 2020 2020 2020 2020 2020 2020  _1,.            
-00013330: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00013340: 7368 705f 3229 3a0a 2020 2020 2020 2020  shp_2):.        
-00013350: 696d 706f 7274 2067 656f 7061 6e64 6173  import geopandas
-00013360: 2061 7320 6770 640a 2020 2020 2020 2020   as gpd.        
-00013370: 6672 6f6d 2020 2073 6861 7065 6c79 2e67  from   shapely.g
-00013380: 656f 6d65 7472 7920 696d 706f 7274 2050  eometry import P
-00013390: 6f6c 7967 6f6e 0a20 2020 2020 2020 2069  olygon.        i
-000133a0: 6d70 6f72 7420 7368 6170 6566 696c 6520  mport shapefile 
-000133b0: 2320 7079 7368 6564 206c 6962 7261 7279  # pyshed library
-000133c0: 0a20 2020 2020 2020 2069 6d70 6f72 7420  .        import 
-000133d0: 7368 6170 656c 790a 2020 2020 2020 2020  shapely.        
-000133e0: 2222 220a 2020 2020 2020 2020 4020 6175  """.        @ au
-000133f0: 7468 6f72 3a20 2020 2020 2020 2020 2020  thor:           
-00013400: 2020 2020 2020 2053 6865 7276 616e 2047         Shervan G
-00013410: 6861 7261 7269 0a20 2020 2020 2020 2040  harari.        @
-00013420: 2047 6974 6875 623a 2020 2020 2020 2020   Github:        
-00013430: 2020 2020 2020 2020 2020 6874 7470 733a            https:
-00013440: 2f2f 6769 7468 7562 2e63 6f6d 2f53 6865  //github.com/She
-00013450: 7276 616e 4768 6172 6172 692f 4541 5359  rvanGharari/EASY
-00013460: 4d4f 5245 0a20 2020 2020 2020 2040 2061  MORE.        @ a
-00013470: 7574 686f 7227 7320 656d 6169 6c20 6964  uthor's email id
-00013480: 3a20 2020 2020 2020 7368 2e67 6861 7261  :       sh.ghara
-00013490: 7269 4067 6d61 696c 2e63 6f6d 0a20 2020  ri@gmail.com.   
-000134a0: 2020 2020 2040 6c69 6365 6e73 653a 2020       @license:  
-000134b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000134c0: 474e 552d 4750 4c76 330a 2020 2020 2020  GNU-GPLv3.      
-000134d0: 2020 5468 6973 2066 7563 6e74 696f 6e20    This fucntion 
-000134e0: 696e 7465 7273 6563 7420 7477 6f20 7368  intersect two sh
-000134f0: 6170 6566 696c 652e 2049 7420 6b65 6570  apefile. It keep
-00013500: 7320 7468 6520 6669 656c 7320 6672 6f6d  s the fiels from
-00013510: 2074 6865 2066 6972 7374 2061 6e64 2073   the first and s
-00013520: 6563 6f6e 6420 7368 6170 6566 696c 6573  econd shapefiles
-00013530: 2028 6964 656e 7469 6669 6564 2062 7920   (identified by 
-00013540: 535f 315f 2061 6e64 0a20 2020 2020 2020  S_1_ and.       
-00013550: 2053 5f32 5f29 2e20 4974 2061 6c73 6f20   S_2_). It also 
-00013560: 6372 6561 7473 206f 7468 6572 2066 6965  creats other fie
-00013570: 6c64 2069 6e63 6c75 6469 6e67 2041 5331  ld including AS1
-00013580: 2028 6172 6561 206f 6620 7468 6520 7368   (area of the sh
-00013590: 6170 6520 656c 656d 656e 7420 6672 6f6d  ape element from
-000135a0: 2073 6861 7065 6669 6c65 2031 292c 2049   shapefile 1), I
-000135b0: 4453 3120 2861 6e20 6172 6269 7461 7279  DS1 (an arbitary
-000135c0: 2069 6e64 6578 0a20 2020 2020 2020 2066   index.        f
-000135d0: 6f72 2074 6865 2073 6861 7065 6669 6c65  or the shapefile
-000135e0: 2031 292c 2041 5332 2028 6172 6561 206f   1), AS2 (area o
-000135f0: 6620 7468 6520 7368 6170 6520 656c 656d  f the shape elem
-00013600: 656e 7420 6672 6f6d 2073 6861 7065 6669  ent from shapefi
-00013610: 6c65 2031 292c 2049 4453 3220 2861 6e20  le 1), IDS2 (an 
-00013620: 6172 6269 7461 7279 2069 6e64 6578 2066  arbitary index f
-00013630: 6f72 2074 6865 2073 6861 7065 6669 6c65  or the shapefile
-00013640: 2031 292c 0a20 2020 2020 2020 2041 494e   1),.        AIN
-00013650: 5420 2874 6865 2061 7265 6120 6f66 2074  T (the area of t
-00013660: 6568 2069 6e74 6572 7365 6374 6564 2073  eh intersected s
-00013670: 6861 7065 7329 2c20 4150 3120 2874 6865  hapes), AP1 (the
-00013680: 2061 7265 6120 6f66 2074 6865 2069 6e74   area of the int
-00013690: 6572 7365 6374 6564 2073 6861 7065 2074  ersected shape t
-000136a0: 6f20 7468 6520 7368 6170 6573 2066 726f  o the shapes fro
-000136b0: 6d20 7368 6170 6566 696c 6520 3129 2c0a  m shapefile 1),.
-000136c0: 2020 2020 2020 2020 4150 3220 2874 6865          AP2 (the
-000136d0: 2061 7265 6120 6f66 2074 6568 2069 6e74   area of teh int
-000136e0: 6572 7365 6374 6564 2073 6861 7065 2074  ersected shape t
-000136f0: 6f20 7468 6520 7368 6170 6566 6573 2066  o the shapefes f
-00013700: 726f 6d20 7368 6170 6566 696c 6520 3229  rom shapefile 2)
-00013710: 2c20 4150 314e 2028 7468 6520 6172 6561  , AP1N (the area
-00013720: 206e 6f72 6d61 6c69 7a65 6420 696e 2074   normalized in t
-00013730: 6865 2063 6173 6520 4150 310a 2020 2020  he case AP1.    
-00013740: 2020 2020 7375 6d6d 6174 696f 6e20 6973      summation is
-00013750: 206e 6f74 2031 2066 6f72 2061 2067 6976   not 1 for a giv
-00013760: 656e 2073 6861 7065 2066 726f 6d20 7368  en shape from sh
-00013770: 6170 6566 696c 6520 312c 2074 6869 7320  apefile 1, this 
-00013780: 7769 6c6c 2068 656c 7020 746f 2070 7265  will help to pre
-00013790: 7365 7665 206d 6173 7320 6966 2070 6172  seve mass if par
-000137a0: 7420 6f66 2074 6865 2073 6861 7065 6669  t of the shapefi
-000137b0: 6c65 2061 7265 206e 6f74 0a20 2020 2020  le are not.     
-000137c0: 2020 2069 6e74 6572 7365 6374 6564 292c     intersected),
-000137d0: 2041 5032 4e20 2874 6865 2061 7265 6120   AP2N (the area 
-000137e0: 6e6f 726d 616c 697a 6564 2069 6e20 7468  normalized in th
-000137f0: 6520 6361 7365 2041 5032 2073 756d 6d61  e case AP2 summa
-00013800: 7469 6f6e 2069 7320 6e6f 7420 3120 666f  tion is not 1 fo
-00013810: 7220 6120 6769 7665 6e20 7368 6170 6520  r a given shape 
-00013820: 6672 6f6d 2073 6861 7065 6669 6c65 2032  from shapefile 2
-00013830: 2c20 7468 6973 0a20 2020 2020 2020 2077  , this.        w
-00013840: 696c 6c20 6865 6c70 2074 6f20 7072 6573  ill help to pres
-00013850: 6576 6520 6d61 7373 2069 6620 7061 7274  eve mass if part
-00013860: 206f 6620 7468 6520 7368 6170 6566 696c   of the shapefil
-00013870: 6520 6172 6520 6e6f 7420 696e 7465 7273  e are not inters
-00013880: 6563 7465 6429 0a20 2020 2020 2020 2041  ected).        A
-00013890: 7267 756d 656e 7473 0a20 2020 2020 2020  rguments.       
-000138a0: 202d 2d2d 2d2d 2d2d 2d2d 0a20 2020 2020   ---------.     
-000138b0: 2020 2073 6870 5f31 3a20 6765 6f20 6461     shp_1: geo da
-000138c0: 7461 2066 7261 6d65 2c20 7368 6170 6566  ta frame, shapef
-000138d0: 696c 6520 310a 2020 2020 2020 2020 7368  ile 1.        sh
-000138e0: 705f 323a 2067 656f 2064 6174 6120 6672  p_2: geo data fr
-000138f0: 616d 652c 2073 6861 7065 6669 6c65 2032  ame, shapefile 2
-00013900: 0a20 2020 2020 2020 2052 6574 7572 6e73  .        Returns
-00013910: 0a20 2020 2020 2020 202d 2d2d 2d2d 2d2d  .        -------
-00013920: 0a20 2020 2020 2020 2072 6573 756c 743a  .        result:
-00013930: 2061 2067 656f 2064 6174 6120 6672 616d   a geo data fram
-00013940: 6520 7468 6174 2069 6e63 6c75 6465 7320  e that includes 
-00013950: 7468 6520 696e 7465 7273 6563 7465 6420  the intersected 
-00013960: 7368 6170 6566 696c 6520 616e 6420 6172  shapefile and ar
-00013970: 6561 2c20 7065 7263 656e 7420 616e 6420  ea, percent and 
-00013980: 6e6f 726d 616c 697a 6564 2070 6572 6365  normalized perce
-00013990: 6e74 206f 6620 6561 6368 2073 6861 7065  nt of each shape
-000139a0: 0a20 2020 2020 2020 2065 6c65 6d65 6e74  .        element
-000139b0: 7320 696e 2061 6e6f 7468 6572 206f 6e65  s in another one
-000139c0: 0a20 2020 2020 2020 2022 2222 0a20 2020  .        """.   
-000139d0: 2020 2020 2023 2067 6574 2074 6865 2063       # get the c
-000139e0: 6f6c 756d 6e20 6e61 6d65 206f 6620 7368  olumn name of sh
-000139f0: 705f 310a 2020 2020 2020 2020 636f 6c75  p_1.        colu
-00013a00: 6d6e 5f6e 616d 6573 203d 2073 6870 5f31  mn_names = shp_1
-00013a10: 2e63 6f6c 756d 6e73 0a20 2020 2020 2020  .columns.       
-00013a20: 2063 6f6c 756d 6e5f 6e61 6d65 7320 3d20   column_names = 
-00013a30: 6c69 7374 2863 6f6c 756d 6e5f 6e61 6d65  list(column_name
-00013a40: 7329 0a20 2020 2020 2020 2023 2072 656d  s).        # rem
-00013a50: 6f76 696e 6720 7468 6520 6765 6f6d 6574  oving the geomet
-00013a60: 7279 2066 726f 6d20 7468 6520 636f 6c75  ry from the colu
-00013a70: 6d6e 206e 616d 6573 0a20 2020 2020 2020  mn names.       
-00013a80: 2063 6f6c 756d 6e5f 6e61 6d65 732e 7265   column_names.re
-00013a90: 6d6f 7665 2827 6765 6f6d 6574 7279 2729  move('geometry')
-00013aa0: 0a20 2020 2020 2020 2023 2072 656e 616d  .        # renam
-00013ab0: 696e 6720 7468 6520 636f 6c75 6d6e 2077  ing the column w
-00013ac0: 6974 6820 535f 310a 2020 2020 2020 2020  ith S_1.        
-00013ad0: 666f 7220 6920 696e 2072 616e 6765 286c  for i in range(l
-00013ae0: 656e 2863 6f6c 756d 6e5f 6e61 6d65 7329  en(column_names)
-00013af0: 293a 0a20 2020 2020 2020 2020 2020 2073  ):.            s
-00013b00: 6870 5f31 203d 2073 6870 5f31 2e72 656e  hp_1 = shp_1.ren
-00013b10: 616d 6528 0a20 2020 2020 2020 2020 2020  ame(.           
-00013b20: 2020 2020 2063 6f6c 756d 6e73 3d7b 636f       columns={co
-00013b30: 6c75 6d6e 5f6e 616d 6573 5b69 5d3a 2027  lumn_names[i]: '
-00013b40: 535f 315f 2720 2b20 636f 6c75 6d6e 5f6e  S_1_' + column_n
-00013b50: 616d 6573 5b69 5d7d 290a 2020 2020 2020  ames[i]}).      
-00013b60: 2020 2320 4361 636c 756c 6174 696e 6720    # Caclulating 
-00013b70: 7468 6520 6172 6561 2066 6f72 2073 6870  the area for shp
-00013b80: 310a 2020 2020 2020 2020 7368 705f 315b  1.        shp_1[
-00013b90: 2741 5331 275d 2020 3d20 7368 705f 312e  'AS1']  = shp_1.
-00013ba0: 6172 6561 0a20 2020 2020 2020 2073 6870  area.        shp
-00013bb0: 5f31 5b27 4944 5331 275d 203d 206e 702e  _1['IDS1'] = np.
-00013bc0: 6172 616e 6765 2873 6870 5f31 2e73 6861  arange(shp_1.sha
-00013bd0: 7065 5b30 5d29 2b31 0a20 2020 2020 2020  pe[0])+1.       
-00013be0: 2023 2067 6574 2074 6865 2063 6f6c 756d   # get the colum
-00013bf0: 6e20 6e61 6d65 206f 6620 7368 705f 320a  n name of shp_2.
-00013c00: 2020 2020 2020 2020 636f 6c75 6d6e 5f6e          column_n
-00013c10: 616d 6573 203d 2073 6870 5f32 2e63 6f6c  ames = shp_2.col
-00013c20: 756d 6e73 0a20 2020 2020 2020 2063 6f6c  umns.        col
-00013c30: 756d 6e5f 6e61 6d65 7320 3d20 6c69 7374  umn_names = list
-00013c40: 2863 6f6c 756d 6e5f 6e61 6d65 7329 0a20  (column_names). 
-00013c50: 2020 2020 2020 2023 2072 656d 6f76 696e         # removin
-00013c60: 6720 7468 6520 6765 6f6d 6574 7279 2066  g the geometry f
-00013c70: 726f 6d20 7468 6520 636f 6c6f 6d6e 206e  rom the colomn n
-00013c80: 616d 6573 0a20 2020 2020 2020 2063 6f6c  ames.        col
-00013c90: 756d 6e5f 6e61 6d65 732e 7265 6d6f 7665  umn_names.remove
-00013ca0: 2827 6765 6f6d 6574 7279 2729 0a20 2020  ('geometry').   
-00013cb0: 2020 2020 2023 2072 656e 616d 696e 6720       # renaming 
-00013cc0: 7468 6520 636f 6c75 6d6e 2077 6974 6820  the column with 
-00013cd0: 535f 320a 2020 2020 2020 2020 666f 7220  S_2.        for 
-00013ce0: 6920 696e 2072 616e 6765 286c 656e 2863  i in range(len(c
-00013cf0: 6f6c 756d 6e5f 6e61 6d65 7329 293a 0a20  olumn_names)):. 
-00013d00: 2020 2020 2020 2020 2020 2073 6870 5f32             shp_2
-00013d10: 203d 2073 6870 5f32 2e72 656e 616d 6528   = shp_2.rename(
-00013d20: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00013d30: 2063 6f6c 756d 6e73 3d7b 636f 6c75 6d6e   columns={column
-00013d40: 5f6e 616d 6573 5b69 5d3a 2027 535f 325f  _names[i]: 'S_2_
-00013d50: 2720 2b20 636f 6c75 6d6e 5f6e 616d 6573  ' + column_names
-00013d60: 5b69 5d7d 290a 2020 2020 2020 2020 2320  [i]}).        # 
-00013d70: 4361 636c 756c 6174 696e 6720 7468 6520  Caclulating the 
-00013d80: 6172 6561 2066 6f72 2073 6870 320a 2020  area for shp2.  
-00013d90: 2020 2020 2020 7368 705f 325b 2741 5332        shp_2['AS2
-00013da0: 275d 203d 2073 6870 5f32 2e61 7265 610a  '] = shp_2.area.
-00013db0: 2020 2020 2020 2020 7368 705f 325b 2749          shp_2['I
-00013dc0: 4453 3227 5d20 3d20 6e70 2e61 7261 6e67  DS2'] = np.arang
-00013dd0: 6528 7368 705f 322e 7368 6170 655b 305d  e(shp_2.shape[0]
-00013de0: 292b 310a 2020 2020 2020 2020 2320 6d61  )+1.        # ma
-00013df0: 6b69 6e67 2069 6e74 6573 6563 7469 6f6e  king intesection
-00013e00: 0a20 2020 2020 2020 2072 6573 756c 7420  .        result 
-00013e10: 3d20 7365 6c66 2e73 7061 7469 616c 5f6f  = self.spatial_o
-00013e20: 7665 726c 6179 7320 2873 6870 5f31 2c20  verlays (shp_1, 
-00013e30: 7368 705f 322c 2068 6f77 3d27 696e 7465  shp_2, how='inte
-00013e40: 7273 6563 7469 6f6e 2729 0a20 2020 2020  rsection').     
-00013e50: 2020 2023 2043 6163 6c75 6c61 7469 6e67     # Caclulating
-00013e60: 2074 6865 2061 7265 6120 666f 7220 7368   the area for sh
-00013e70: 7032 0a20 2020 2020 2020 2072 6573 756c  p2.        resul
-00013e80: 745b 2741 494e 5427 5d20 3d20 7265 7375  t['AINT'] = resu
-00013e90: 6c74 5b27 6765 6f6d 6574 7279 275d 2e61  lt['geometry'].a
-00013ea0: 7265 610a 2020 2020 2020 2020 7265 7375  rea.        resu
-00013eb0: 6c74 5b27 4150 3127 5d20 3d20 7265 7375  lt['AP1'] = resu
-00013ec0: 6c74 5b27 4149 4e54 275d 2f72 6573 756c  lt['AINT']/resul
-00013ed0: 745b 2741 5331 275d 0a20 2020 2020 2020  t['AS1'].       
-00013ee0: 2072 6573 756c 745b 2741 5032 275d 203d   result['AP2'] =
-00013ef0: 2072 6573 756c 745b 2741 494e 5427 5d2f   result['AINT']/
-00013f00: 7265 7375 6c74 5b27 4153 3227 5d0a 2020  result['AS2'].  
-00013f10: 2020 2020 2020 2320 7461 6b69 6e67 2074        # taking t
-00013f20: 6865 2070 6172 7420 6f66 2064 6174 6120  he part of data 
-00013f30: 6672 616d 6520 6173 2074 6865 206e 756d  frame as the num
-00013f40: 7079 2074 6f20 696e 6372 6561 6420 7468  py to incread th
-00013f50: 6520 7370 6561 640a 2020 2020 2020 2020  e spead.        
-00013f60: 2320 6669 6e64 696e 6720 7468 6520 4944  # finding the ID
-00013f70: 7320 6672 6f6d 2073 6861 7065 6669 6c65  s from shapefile
-00013f80: 206f 6e65 0a20 2020 2020 2020 2049 445f   one.        ID_
-00013f90: 5331 203d 206e 702e 6172 7261 7920 2872  S1 = np.array (r
-00013fa0: 6573 756c 745b 2749 4453 3127 5d29 0a20  esult['IDS1']). 
-00013fb0: 2020 2020 2020 2041 5031 203d 206e 702e         AP1 = np.
-00013fc0: 6172 7261 7928 7265 7375 6c74 5b27 4150  array(result['AP
-00013fd0: 3127 5d29 0a20 2020 2020 2020 2041 5031  1']).        AP1
-00013fe0: 4e20 3d20 4150 3120 2320 6372 6561 7469  N = AP1 # creati
-00013ff0: 6e67 2074 6865 206e 6e6f 726d 616c 697a  ng the nnormaliz
-00014000: 6564 2070 6572 6365 6e74 2061 7265 610a  ed percent area.
-00014010: 2020 2020 2020 2020 4944 5f53 315f 756e          ID_S1_un
-00014020: 6971 7565 203d 206e 702e 756e 6971 7565  ique = np.unique
-00014030: 2849 445f 5331 2920 2375 6e69 7175 6520  (ID_S1) #unique 
-00014040: 6964 6561 0a20 2020 2020 2020 2066 6f72  idea.        for
-00014050: 2069 2069 6e20 4944 5f53 315f 756e 6971   i in ID_S1_uniq
-00014060: 7565 3a0a 2020 2020 2020 2020 2020 2020  ue:.            
-00014070: 494e 4458 203d 206e 702e 7768 6572 6528  INDX = np.where(
-00014080: 4944 5f53 313d 3d69 2920 2320 6765 7474  ID_S1==i) # gett
-00014090: 696e 6720 7468 6520 696e 6465 6365 730a  ing the indeces.
-000140a0: 2020 2020 2020 2020 2020 2020 4150 314e              AP1N
-000140b0: 5b49 4e44 585d 203d 2041 5031 5b49 4e44  [INDX] = AP1[IND
-000140c0: 585d 202f 2041 5031 5b49 4e44 585d 2e73  X] / AP1[INDX].s
-000140d0: 756d 2829 2023 206e 6f72 6d61 6c69 7a69  um() # normalizi
-000140e0: 6e67 2066 6f72 2074 6861 7420 7375 6d0a  ng for that sum.
-000140f0: 2020 2020 2020 2020 2320 7461 6b69 6e67          # taking
-00014100: 2074 6865 2070 6172 7420 6f66 2064 6174   the part of dat
-00014110: 6120 6672 616d 6520 6173 2074 6865 206e  a frame as the n
-00014120: 756d 7079 2074 6f20 696e 6372 6561 6420  umpy to incread 
-00014130: 7468 6520 7370 6561 640a 2020 2020 2020  the spead.      
-00014140: 2020 2320 6669 6e64 696e 6720 7468 6520    # finding the 
-00014150: 4944 7320 6672 6f6d 2073 6861 7065 6669  IDs from shapefi
-00014160: 6c65 206f 6e65 0a20 2020 2020 2020 2049  le one.        I
-00014170: 445f 5332 203d 206e 702e 6172 7261 7920  D_S2 = np.array 
-00014180: 2872 6573 756c 745b 2749 4453 3227 5d29  (result['IDS2'])
-00014190: 0a20 2020 2020 2020 2041 5032 203d 206e  .        AP2 = n
-000141a0: 702e 6172 7261 7928 7265 7375 6c74 5b27  p.array(result['
-000141b0: 4150 3227 5d29 0a20 2020 2020 2020 2041  AP2']).        A
-000141c0: 5032 4e20 3d20 4150 3220 2320 6372 6561  P2N = AP2 # crea
-000141d0: 7469 6e67 2074 6865 206e 6e6f 726d 616c  ting the nnormal
-000141e0: 697a 6564 2070 6572 6365 6e74 2061 7265  ized percent are
-000141f0: 610a 2020 2020 2020 2020 4944 5f53 325f  a.        ID_S2_
-00014200: 756e 6971 7565 203d 206e 702e 756e 6971  unique = np.uniq
-00014210: 7565 2849 445f 5332 2920 2375 6e69 7175  ue(ID_S2) #uniqu
-00014220: 6520 6964 6561 0a20 2020 2020 2020 2066  e idea.        f
-00014230: 6f72 2069 2069 6e20 4944 5f53 325f 756e  or i in ID_S2_un
-00014240: 6971 7565 3a0a 2020 2020 2020 2020 2020  ique:.          
-00014250: 2020 494e 4458 203d 206e 702e 7768 6572    INDX = np.wher
-00014260: 6528 4944 5f53 323d 3d69 2920 2320 6765  e(ID_S2==i) # ge
-00014270: 7474 696e 6720 7468 6520 696e 6465 6365  tting the indece
-00014280: 730a 2020 2020 2020 2020 2020 2020 4150  s.            AP
-00014290: 324e 5b49 4e44 585d 203d 2041 5032 5b49  2N[INDX] = AP2[I
-000142a0: 4e44 585d 202f 2041 5032 5b49 4e44 585d  NDX] / AP2[INDX]
-000142b0: 2e73 756d 2829 2023 206e 6f72 6d61 6c69  .sum() # normali
-000142c0: 7a69 6e67 2066 6f72 2074 6861 7420 7375  zing for that su
-000142d0: 6d0a 2020 2020 2020 2020 7265 7375 6c74  m.        result
-000142e0: 205b 2741 5031 4e27 5d20 3d20 4150 314e   ['AP1N'] = AP1N
-000142f0: 0a20 2020 2020 2020 2072 6573 756c 7420  .        result 
-00014300: 5b27 4150 324e 275d 203d 2041 5032 4e0a  ['AP2N'] = AP2N.
-00014310: 2020 2020 2020 2020 7265 7475 726e 2072          return r
-00014320: 6573 756c 740a 0a20 2020 2064 6566 2073  esult..    def s
-00014330: 7061 7469 616c 5f6f 7665 726c 6179 7328  patial_overlays(
-00014340: 2020 2073 656c 662c 0a20 2020 2020 2020     self,.       
-00014350: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00014360: 2020 2020 2064 6631 2c0a 2020 2020 2020       df1,.      
-00014370: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00014380: 2020 2020 2020 6466 322c 0a20 2020 2020        df2,.     
-00014390: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000143a0: 2020 2020 2020 2068 6f77 3d27 696e 7465         how='inte
-000143b0: 7273 6563 7469 6f6e 272c 0a20 2020 2020  rsection',.     
-000143c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000143d0: 2020 2020 2020 2072 6570 726f 6a65 6374         reproject
-000143e0: 3d54 7275 6529 3a0a 2020 2020 2020 2020  =True):.        
-000143f0: 696d 706f 7274 2067 656f 7061 6e64 6173  import geopandas
-00014400: 2061 7320 6770 640a 2020 2020 2020 2020   as gpd.        
-00014410: 6672 6f6d 2020 2073 6861 7065 6c79 2e67  from   shapely.g
-00014420: 656f 6d65 7472 7920 696d 706f 7274 2050  eometry import P
-00014430: 6f6c 7967 6f6e 0a20 2020 2020 2020 2069  olygon.        i
-00014440: 6d70 6f72 7420 7368 6170 6566 696c 6520  mport shapefile 
-00014450: 2320 7079 7368 6564 206c 6962 7261 7279  # pyshed library
-00014460: 0a20 2020 2020 2020 2069 6d70 6f72 7420  .        import 
-00014470: 7368 6170 656c 790a 2020 2020 2020 2020  shapely.        
-00014480: 2222 220a 2020 2020 2020 2020 5065 7266  """.        Perf
-00014490: 6f72 6d20 7370 6174 6961 6c20 6f76 6572  orm spatial over
-000144a0: 6c61 7920 6265 7477 6565 6e20 7477 6f20  lay between two 
-000144b0: 706f 6c79 676f 6e73 2e0a 2020 2020 2020  polygons..      
-000144c0: 2020 4375 7272 656e 746c 7920 6f6e 6c79    Currently only
-000144d0: 2073 7570 706f 7274 7320 6461 7461 2047   supports data G
-000144e0: 656f 4461 7461 4672 616d 6573 2077 6974  eoDataFrames wit
-000144f0: 6820 706f 6c79 676f 6e73 2e0a 2020 2020  h polygons..    
-00014500: 2020 2020 496d 706c 656d 656e 7473 2073      Implements s
-00014510: 6576 6572 616c 206d 6574 686f 6473 2074  everal methods t
-00014520: 6861 7420 6172 6520 616c 6c20 6566 6665  hat are all effe
-00014530: 6374 6976 656c 7920 7375 6273 6574 7320  ctively subsets 
-00014540: 6f66 0a20 2020 2020 2020 2074 6865 2075  of.        the u
-00014550: 6e69 6f6e 2e0a 2020 2020 2020 2020 6175  nion..        au
-00014560: 7468 6f72 3a20 4f6d 6572 204f 7a61 6b0a  thor: Omer Ozak.
-00014570: 2020 2020 2020 2020 6874 7470 733a 2f2f          https://
-00014580: 6769 7468 7562 2e63 6f6d 2f6f 7a61 6b0a  github.com/ozak.
-00014590: 2020 2020 2020 2020 6874 7470 733a 2f2f          https://
-000145a0: 6769 7468 7562 2e63 6f6d 2f67 656f 7061  github.com/geopa
-000145b0: 6e64 6173 2f67 656f 7061 6e64 6173 2f70  ndas/geopandas/p
-000145c0: 756c 6c2f 3333 380a 2020 2020 2020 2020  ull/338.        
-000145d0: 6c69 6365 6e73 653a 2047 4e55 2d47 504c  license: GNU-GPL
-000145e0: 7633 0a20 2020 2020 2020 2050 6172 616d  v3.        Param
-000145f0: 6574 6572 730a 2020 2020 2020 2020 2d2d  eters.        --
-00014600: 2d2d 2d2d 2d2d 2d2d 0a20 2020 2020 2020  --------.       
-00014610: 2064 6631 3a20 4765 6f44 6174 6146 7261   df1: GeoDataFra
-00014620: 6d65 2077 6974 6820 4d75 6c74 6950 6f6c  me with MultiPol
-00014630: 7967 6f6e 206f 7220 506f 6c79 676f 6e20  ygon or Polygon 
-00014640: 6765 6f6d 6574 7279 2063 6f6c 756d 6e0a  geometry column.
-00014650: 2020 2020 2020 2020 6466 323a 2047 656f          df2: Geo
-00014660: 4461 7461 4672 616d 6520 7769 7468 204d  DataFrame with M
-00014670: 756c 7469 506f 6c79 676f 6e20 6f72 2050  ultiPolygon or P
-00014680: 6f6c 7967 6f6e 2067 656f 6d65 7472 7920  olygon geometry 
-00014690: 636f 6c75 6d6e 0a20 2020 2020 2020 2068  column.        h
-000146a0: 6f77 3a20 7374 7269 6e67 0a20 2020 2020  ow: string.     
-000146b0: 2020 2020 2020 204d 6574 686f 6420 6f66         Method of
-000146c0: 2073 7061 7469 616c 206f 7665 726c 6179   spatial overlay
-000146d0: 3a20 2769 6e74 6572 7365 6374 696f 6e27  : 'intersection'
-000146e0: 2c20 2775 6e69 6f6e 272c 0a20 2020 2020  , 'union',.     
-000146f0: 2020 2020 2020 2027 6964 656e 7469 7479         'identity
-00014700: 272c 2027 7379 6d6d 6574 7269 635f 6469  ', 'symmetric_di
-00014710: 6666 6572 656e 6365 2720 6f72 2027 6469  fference' or 'di
-00014720: 6666 6572 656e 6365 272e 0a20 2020 2020  fference'..     
-00014730: 2020 2075 7365 5f73 696e 6465 7820 3a20     use_sindex : 
-00014740: 626f 6f6c 6561 6e2c 2064 6566 6175 6c74  boolean, default
-00014750: 2054 7275 650a 2020 2020 2020 2020 2020   True.          
-00014760: 2020 5573 6520 7468 6520 7370 6174 6961    Use the spatia
-00014770: 6c20 696e 6465 7820 746f 2073 7065 6564  l index to speed
-00014780: 2075 7020 6f70 6572 6174 696f 6e20 6966   up operation if
-00014790: 2061 7661 696c 6162 6c65 2e0a 2020 2020   available..    
-000147a0: 2020 2020 5265 7475 726e 730a 2020 2020      Returns.    
-000147b0: 2020 2020 2d2d 2d2d 2d2d 2d0a 2020 2020      -------.    
-000147c0: 2020 2020 6466 3a20 4765 6f44 6174 6146      df: GeoDataF
-000147d0: 7261 6d65 0a20 2020 2020 2020 2020 2020  rame.           
-000147e0: 2047 656f 4461 7461 4672 616d 6520 7769   GeoDataFrame wi
-000147f0: 7468 206e 6577 2073 6574 206f 6620 706f  th new set of po
-00014800: 6c79 676f 6e73 2061 6e64 2061 7474 7269  lygons and attri
-00014810: 6275 7465 730a 2020 2020 2020 2020 2020  butes.          
-00014820: 2020 7265 7375 6c74 696e 6720 6672 6f6d    resulting from
-00014830: 2074 6865 206f 7665 726c 6179 0a20 2020   the overlay.   
-00014840: 2020 2020 2022 2222 0a20 2020 2020 2020       """.       
-00014850: 2064 6631 203d 2064 6631 2e63 6f70 7928   df1 = df1.copy(
-00014860: 290a 2020 2020 2020 2020 6466 3220 3d20  ).        df2 = 
-00014870: 6466 322e 636f 7079 2829 0a20 2020 2020  df2.copy().     
-00014880: 2020 2064 6631 5b27 6765 6f6d 6574 7279     df1['geometry
-00014890: 275d 203d 2064 6631 2e67 656f 6d65 7472  '] = df1.geometr
-000148a0: 792e 6275 6666 6572 2830 290a 2020 2020  y.buffer(0).    
-000148b0: 2020 2020 6466 325b 2767 656f 6d65 7472      df2['geometr
-000148c0: 7927 5d20 3d20 6466 322e 6765 6f6d 6574  y'] = df2.geomet
-000148d0: 7279 2e62 7566 6665 7228 3029 0a20 2020  ry.buffer(0).   
-000148e0: 2020 2020 2069 6620 6466 312e 6372 7321       if df1.crs!
-000148f0: 3d64 6632 2e63 7273 2061 6e64 2072 6570  =df2.crs and rep
-00014900: 726f 6a65 6374 3a0a 2020 2020 2020 2020  roject:.        
-00014910: 2020 2020 7072 696e 7428 2744 6174 6120      print('Data 
-00014920: 6861 7320 6469 6666 6572 656e 7420 7072  has different pr
-00014930: 6f6a 6563 7469 6f6e 732e 2729 0a20 2020  ojections.').   
-00014940: 2020 2020 2020 2020 2070 7269 6e74 2827           print('
-00014950: 436f 6e76 6572 7465 6420 6461 7461 2074  Converted data t
-00014960: 6f20 7072 6f6a 6563 7469 6f6e 206f 6620  o projection of 
-00014970: 6669 7273 7420 4765 6f50 616e 6461 7320  first GeoPandas 
-00014980: 4461 7446 7261 6d65 2729 0a20 2020 2020  DatFrame').     
-00014990: 2020 2020 2020 2064 6632 2e74 6f5f 6372         df2.to_cr
-000149a0: 7328 6372 733d 6466 312e 6372 732c 2069  s(crs=df1.crs, i
-000149b0: 6e70 6c61 6365 3d54 7275 6529 0a20 2020  nplace=True).   
-000149c0: 2020 2020 2069 6620 686f 773d 3d27 696e       if how=='in
-000149d0: 7465 7273 6563 7469 6f6e 273a 0a20 2020  tersection':.   
-000149e0: 2020 2020 2020 2020 2023 2053 7061 7469           # Spati
-000149f0: 616c 2049 6e64 6578 2074 6f20 6372 6561  al Index to crea
-00014a00: 7465 2069 6e74 6572 7365 6374 696f 6e73  te intersections
-00014a10: 0a20 2020 2020 2020 2020 2020 2073 7061  .            spa
-00014a20: 7469 616c 5f69 6e64 6578 203d 2064 6632  tial_index = df2
-00014a30: 2e73 696e 6465 780a 2020 2020 2020 2020  .sindex.        
-00014a40: 2020 2020 6466 315b 2762 626f 7827 5d20      df1['bbox'] 
-00014a50: 3d20 6466 312e 6765 6f6d 6574 7279 2e61  = df1.geometry.a
-00014a60: 7070 6c79 286c 616d 6264 6120 783a 2078  pply(lambda x: x
-00014a70: 2e62 6f75 6e64 7329 0a20 2020 2020 2020  .bounds).       
-00014a80: 2020 2020 2064 6631 5b27 7369 6478 275d       df1['sidx']
-00014a90: 3d64 6631 2e62 626f 782e 6170 706c 7928  =df1.bbox.apply(
-00014aa0: 6c61 6d62 6461 2078 3a6c 6973 7428 7370  lambda x:list(sp
-00014ab0: 6174 6961 6c5f 696e 6465 782e 696e 7465  atial_index.inte
-00014ac0: 7273 6563 7469 6f6e 2878 2929 290a 2020  rsection(x))).  
-00014ad0: 2020 2020 2020 2020 2020 7061 6972 7320            pairs 
-00014ae0: 3d20 6466 315b 2773 6964 7827 5d2e 746f  = df1['sidx'].to
-00014af0: 5f64 6963 7428 290a 2020 2020 2020 2020  _dict().        
-00014b00: 2020 2020 6e65 6920 3d20 5b5d 0a20 2020      nei = [].   
-00014b10: 2020 2020 2020 2020 2066 6f72 2069 2c6a           for i,j
-00014b20: 2069 6e20 7061 6972 732e 6974 656d 7328   in pairs.items(
-00014b30: 293a 0a20 2020 2020 2020 2020 2020 2020  ):.             
-00014b40: 2020 2066 6f72 206b 2069 6e20 6a3a 0a20     for k in j:. 
-00014b50: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00014b60: 2020 206e 6569 2e61 7070 656e 6428 5b69     nei.append([i
-00014b70: 2c6b 5d29 0a20 2020 2020 2020 2020 2020  ,k]).           
-00014b80: 2023 7061 6972 7320 3d20 6770 642e 4765   #pairs = gpd.Ge
-00014b90: 6f44 6174 6146 7261 6d65 286e 6569 2c20  oDataFrame(nei, 
-00014ba0: 636f 6c75 6d6e 733d 5b27 6964 7831 272c  columns=['idx1',
-00014bb0: 2769 6478 3227 5d2c 2063 7273 3d64 6631  'idx2'], crs=df1
-00014bc0: 2e63 7273 290a 2020 2020 2020 2020 2020  .crs).          
-00014bd0: 2020 7061 6972 7320 3d20 6770 642e 4765    pairs = gpd.Ge
-00014be0: 6f44 6174 6146 7261 6d65 286e 6569 2c20  oDataFrame(nei, 
-00014bf0: 636f 6c75 6d6e 733d 5b27 6964 7831 272c  columns=['idx1',
-00014c00: 2769 6478 3227 5d29 0a20 2020 2020 2020  'idx2']).       
-00014c10: 2020 2020 2070 6169 7273 203d 2070 6169       pairs = pai
-00014c20: 7273 2e6d 6572 6765 2864 6631 2c20 6c65  rs.merge(df1, le
-00014c30: 6674 5f6f 6e3d 2769 6478 3127 2c20 7269  ft_on='idx1', ri
-00014c40: 6768 745f 696e 6465 783d 5472 7565 290a  ght_index=True).
-00014c50: 2020 2020 2020 2020 2020 2020 7061 6972              pair
-00014c60: 7320 3d20 7061 6972 732e 6d65 7267 6528  s = pairs.merge(
-00014c70: 6466 322c 206c 6566 745f 6f6e 3d27 6964  df2, left_on='id
-00014c80: 7832 272c 2072 6967 6874 5f69 6e64 6578  x2', right_index
-00014c90: 3d54 7275 652c 2073 7566 6669 7865 733d  =True, suffixes=
-00014ca0: 5b27 5f31 272c 275f 3227 5d29 0a20 2020  ['_1','_2']).   
-00014cb0: 2020 2020 2020 2020 2070 6169 7273 5b27           pairs['
-00014cc0: 496e 7465 7273 6563 7469 6f6e 275d 203d  Intersection'] =
-00014cd0: 2070 6169 7273 2e61 7070 6c79 286c 616d   pairs.apply(lam
-00014ce0: 6264 6120 783a 2028 785b 2767 656f 6d65  bda x: (x['geome
-00014cf0: 7472 795f 3127 5d2e 696e 7465 7273 6563  try_1'].intersec
-00014d00: 7469 6f6e 2878 5b27 6765 6f6d 6574 7279  tion(x['geometry
-00014d10: 5f32 275d 2929 2e62 7566 6665 7228 3029  _2'])).buffer(0)
-00014d20: 2c20 6178 6973 3d31 290a 2020 2020 2020  , axis=1).      
-00014d30: 2020 2020 2020 2370 6169 7273 203d 2067        #pairs = g
-00014d40: 7064 2e47 656f 4461 7461 4672 616d 6528  pd.GeoDataFrame(
-00014d50: 7061 6972 732c 2063 6f6c 756d 6e73 3d70  pairs, columns=p
-00014d60: 6169 7273 2e63 6f6c 756d 6e73 2c20 6372  airs.columns, cr
-00014d70: 733d 6466 312e 6372 7329 0a20 2020 2020  s=df1.crs).     
-00014d80: 2020 2020 2020 2070 6169 7273 203d 2067         pairs = g
-00014d90: 7064 2e47 656f 4461 7461 4672 616d 6528  pd.GeoDataFrame(
-00014da0: 7061 6972 732c 2063 6f6c 756d 6e73 3d70  pairs, columns=p
-00014db0: 6169 7273 2e63 6f6c 756d 6e73 290a 2020  airs.columns).  
-00014dc0: 2020 2020 2020 2020 2020 636f 6c73 203d            cols =
-00014dd0: 2070 6169 7273 2e63 6f6c 756d 6e73 2e74   pairs.columns.t
-00014de0: 6f6c 6973 7428 290a 2020 2020 2020 2020  olist().        
-00014df0: 2020 2020 636f 6c73 2e72 656d 6f76 6528      cols.remove(
-00014e00: 2767 656f 6d65 7472 795f 3127 290a 2020  'geometry_1').  
-00014e10: 2020 2020 2020 2020 2020 636f 6c73 2e72            cols.r
-00014e20: 656d 6f76 6528 2767 656f 6d65 7472 795f  emove('geometry_
-00014e30: 3227 290a 2020 2020 2020 2020 2020 2020  2').            
-00014e40: 636f 6c73 2e72 656d 6f76 6528 2773 6964  cols.remove('sid
-00014e50: 7827 290a 2020 2020 2020 2020 2020 2020  x').            
-00014e60: 636f 6c73 2e72 656d 6f76 6528 2762 626f  cols.remove('bbo
-00014e70: 7827 290a 2020 2020 2020 2020 2020 2020  x').            
-00014e80: 636f 6c73 2e72 656d 6f76 6528 2749 6e74  cols.remove('Int
-00014e90: 6572 7365 6374 696f 6e27 290a 2020 2020  ersection').    
-00014ea0: 2020 2020 2020 2020 6466 696e 7465 7220          dfinter 
-00014eb0: 3d20 7061 6972 735b 636f 6c73 2b5b 2749  = pairs[cols+['I
-00014ec0: 6e74 6572 7365 6374 696f 6e27 5d5d 2e63  ntersection']].c
-00014ed0: 6f70 7928 290a 2020 2020 2020 2020 2020  opy().          
-00014ee0: 2020 6466 696e 7465 722e 7265 6e61 6d65    dfinter.rename
-00014ef0: 2863 6f6c 756d 6e73 3d7b 2749 6e74 6572  (columns={'Inter
-00014f00: 7365 6374 696f 6e27 3a27 6765 6f6d 6574  section':'geomet
-00014f10: 7279 277d 2c20 696e 706c 6163 653d 5472  ry'}, inplace=Tr
-00014f20: 7565 290a 2020 2020 2020 2020 2020 2020  ue).            
-00014f30: 2364 6669 6e74 6572 203d 2067 7064 2e47  #dfinter = gpd.G
-00014f40: 656f 4461 7461 4672 616d 6528 6466 696e  eoDataFrame(dfin
-00014f50: 7465 722c 2063 6f6c 756d 6e73 3d64 6669  ter, columns=dfi
-00014f60: 6e74 6572 2e63 6f6c 756d 6e73 2c20 6372  nter.columns, cr
-00014f70: 733d 7061 6972 732e 6372 7329 0a20 2020  s=pairs.crs).   
-00014f80: 2020 2020 2020 2020 2064 6669 6e74 6572           dfinter
-00014f90: 203d 2067 7064 2e47 656f 4461 7461 4672   = gpd.GeoDataFr
-00014fa0: 616d 6528 6466 696e 7465 722c 2063 6f6c  ame(dfinter, col
-00014fb0: 756d 6e73 3d64 6669 6e74 6572 2e63 6f6c  umns=dfinter.col
-00014fc0: 756d 6e73 2c20 6372 733d 6466 312e 6372  umns, crs=df1.cr
-00014fd0: 7329 0a20 2020 2020 2020 2020 2020 2064  s).            d
-00014fe0: 6669 6e74 6572 203d 2064 6669 6e74 6572  finter = dfinter
-00014ff0: 2e6c 6f63 5b64 6669 6e74 6572 2e67 656f  .loc[dfinter.geo
-00015000: 6d65 7472 792e 6973 5f65 6d70 7479 3d3d  metry.is_empty==
-00015010: 4661 6c73 655d 0a20 2020 2020 2020 2020  False].         
-00015020: 2020 2064 6669 6e74 6572 2e64 726f 7028     dfinter.drop(
-00015030: 5b27 6964 7831 272c 2769 6478 3227 5d2c  ['idx1','idx2'],
-00015040: 2069 6e70 6c61 6365 3d54 7275 652c 2061   inplace=True, a
-00015050: 7869 733d 3129 0a20 2020 2020 2020 2020  xis=1).         
-00015060: 2020 2072 6574 7572 6e20 6466 696e 7465     return dfinte
-00015070: 720a 2020 2020 2020 2020 656c 6966 2068  r.        elif h
-00015080: 6f77 3d3d 2764 6966 6665 7265 6e63 6527  ow=='difference'
-00015090: 3a0a 2020 2020 2020 2020 2020 2020 7370  :.            sp
-000150a0: 6174 6961 6c5f 696e 6465 7820 3d20 6466  atial_index = df
-000150b0: 322e 7369 6e64 6578 0a20 2020 2020 2020  2.sindex.       
-000150c0: 2020 2020 2064 6631 5b27 6262 6f78 275d       df1['bbox']
-000150d0: 203d 2064 6631 2e67 656f 6d65 7472 792e   = df1.geometry.
-000150e0: 6170 706c 7928 6c61 6d62 6461 2078 3a20  apply(lambda x: 
-000150f0: 782e 626f 756e 6473 290a 2020 2020 2020  x.bounds).      
-00015100: 2020 2020 2020 6466 315b 2773 6964 7827        df1['sidx'
-00015110: 5d20 3d20 6466 312e 6262 6f78 2e61 7070  ] = df1.bbox.app
-00015120: 6c79 286c 616d 6264 6120 783a 6c69 7374  ly(lambda x:list
-00015130: 2873 7061 7469 616c 5f69 6e64 6578 2e69  (spatial_index.i
-00015140: 6e74 6572 7365 6374 696f 6e28 7829 2929  ntersection(x)))
-00015150: 0a20 2020 2020 2020 2020 2020 2064 6631  .            df1
-00015160: 5b27 6e65 775f 6727 5d20 3d20 6466 312e  ['new_g'] = df1.
-00015170: 6170 706c 7928 6c61 6d62 6461 2078 3a20  apply(lambda x: 
-00015180: 7265 6475 6365 286c 616d 6264 6120 782c  reduce(lambda x,
-00015190: 2079 3a20 782e 6469 6666 6572 656e 6365   y: x.difference
-000151a0: 2879 292e 6275 6666 6572 2830 292c 0a20  (y).buffer(0),. 
-000151b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000151c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000151d0: 2020 2020 5b78 2e67 656f 6d65 7472 795d      [x.geometry]
-000151e0: 2b6c 6973 7428 6466 322e 696c 6f63 5b78  +list(df2.iloc[x
-000151f0: 2e73 6964 785d 2e67 656f 6d65 7472 7929  .sidx].geometry)
-00015200: 2920 2c20 6178 6973 3d31 290a 2020 2020  ) , axis=1).    
-00015210: 2020 2020 2020 2020 6466 312e 6765 6f6d          df1.geom
-00015220: 6574 7279 203d 2064 6631 2e6e 6577 5f67  etry = df1.new_g
-00015230: 0a20 2020 2020 2020 2020 2020 2064 6631  .            df1
-00015240: 203d 2064 6631 2e6c 6f63 5b64 6631 2e67   = df1.loc[df1.g
-00015250: 656f 6d65 7472 792e 6973 5f65 6d70 7479  eometry.is_empty
-00015260: 3d3d 4661 6c73 655d 2e63 6f70 7928 290a  ==False].copy().
-00015270: 2020 2020 2020 2020 2020 2020 6466 312e              df1.
-00015280: 6472 6f70 285b 2762 626f 7827 2c20 2773  drop(['bbox', 's
-00015290: 6964 7827 2c20 276e 6577 5f67 275d 2c20  idx', 'new_g'], 
-000152a0: 6178 6973 3d31 2c20 696e 706c 6163 653d  axis=1, inplace=
-000152b0: 5472 7565 290a 2020 2020 2020 2020 2020  True).          
-000152c0: 2020 7265 7475 726e 2064 6631 0a20 2020    return df1.   
-000152d0: 2020 2020 2065 6c69 6620 686f 773d 3d27       elif how=='
-000152e0: 7379 6d6d 6574 7269 635f 6469 6666 6572  symmetric_differ
-000152f0: 656e 6365 273a 0a20 2020 2020 2020 2020  ence':.         
-00015300: 2020 2064 6631 5b27 6964 7831 275d 203d     df1['idx1'] =
-00015310: 2064 6631 2e69 6e64 6578 2e74 6f6c 6973   df1.index.tolis
-00015320: 7428 290a 2020 2020 2020 2020 2020 2020  t().            
-00015330: 6466 325b 2769 6478 3227 5d20 3d20 6466  df2['idx2'] = df
-00015340: 322e 696e 6465 782e 746f 6c69 7374 2829  2.index.tolist()
-00015350: 0a20 2020 2020 2020 2020 2020 2064 6631  .            df1
-00015360: 5b27 6964 7832 275d 203d 206e 702e 6e61  ['idx2'] = np.na
-00015370: 6e0a 2020 2020 2020 2020 2020 2020 6466  n.            df
-00015380: 325b 2769 6478 3127 5d20 3d20 6e70 2e6e  2['idx1'] = np.n
-00015390: 616e 0a20 2020 2020 2020 2020 2020 2064  an.            d
-000153a0: 6673 796d 203d 2064 6631 2e6d 6572 6765  fsym = df1.merge
-000153b0: 2864 6632 2c20 6f6e 3d5b 2769 6478 3127  (df2, on=['idx1'
-000153c0: 2c27 6964 7832 275d 2c20 686f 773d 276f  ,'idx2'], how='o
-000153d0: 7574 6572 272c 2073 7566 6669 7865 733d  uter', suffixes=
-000153e0: 5b27 5f31 272c 275f 3227 5d29 0a20 2020  ['_1','_2']).   
-000153f0: 2020 2020 2020 2020 2064 6673 796d 5b27           dfsym['
-00015400: 6765 6f6d 6574 7279 275d 203d 2064 6673  geometry'] = dfs
-00015410: 796d 2e67 656f 6d65 7472 795f 310a 2020  ym.geometry_1.  
-00015420: 2020 2020 2020 2020 2020 6466 7379 6d2e            dfsym.
-00015430: 6c6f 635b 6466 7379 6d2e 6765 6f6d 6574  loc[dfsym.geomet
-00015440: 7279 5f32 2e69 736e 756c 6c28 293d 3d46  ry_2.isnull()==F
-00015450: 616c 7365 2c20 2767 656f 6d65 7472 7927  alse, 'geometry'
-00015460: 5d20 3d20 6466 7379 6d2e 6c6f 635b 6466  ] = dfsym.loc[df
-00015470: 7379 6d2e 6765 6f6d 6574 7279 5f32 2e69  sym.geometry_2.i
-00015480: 736e 756c 6c28 293d 3d46 616c 7365 2c20  snull()==False, 
-00015490: 2767 656f 6d65 7472 795f 3227 5d0a 2020  'geometry_2'].  
-000154a0: 2020 2020 2020 2020 2020 6466 7379 6d2e            dfsym.
-000154b0: 6472 6f70 285b 2767 656f 6d65 7472 795f  drop(['geometry_
-000154c0: 3127 2c20 2767 656f 6d65 7472 795f 3227  1', 'geometry_2'
-000154d0: 5d2c 2061 7869 733d 312c 2069 6e70 6c61  ], axis=1, inpla
-000154e0: 6365 3d54 7275 6529 0a20 2020 2020 2020  ce=True).       
-000154f0: 2020 2020 2064 6673 796d 203d 2067 7064       dfsym = gpd
-00015500: 2e47 656f 4461 7461 4672 616d 6528 6466  .GeoDataFrame(df
-00015510: 7379 6d2c 2063 6f6c 756d 6e73 3d64 6673  sym, columns=dfs
-00015520: 796d 2e63 6f6c 756d 6e73 2c20 6372 733d  ym.columns, crs=
-00015530: 6466 312e 6372 7329 0a20 2020 2020 2020  df1.crs).       
-00015540: 2020 2020 2073 7061 7469 616c 5f69 6e64       spatial_ind
-00015550: 6578 203d 2064 6673 796d 2e73 696e 6465  ex = dfsym.sinde
-00015560: 780a 2020 2020 2020 2020 2020 2020 6466  x.            df
-00015570: 7379 6d5b 2762 626f 7827 5d20 3d20 6466  sym['bbox'] = df
-00015580: 7379 6d2e 6765 6f6d 6574 7279 2e61 7070  sym.geometry.app
-00015590: 6c79 286c 616d 6264 6120 783a 2078 2e62  ly(lambda x: x.b
-000155a0: 6f75 6e64 7329 0a20 2020 2020 2020 2020  ounds).         
-000155b0: 2020 2064 6673 796d 5b27 7369 6478 275d     dfsym['sidx']
-000155c0: 203d 2064 6673 796d 2e62 626f 782e 6170   = dfsym.bbox.ap
-000155d0: 706c 7928 6c61 6d62 6461 2078 3a6c 6973  ply(lambda x:lis
-000155e0: 7428 7370 6174 6961 6c5f 696e 6465 782e  t(spatial_index.
-000155f0: 696e 7465 7273 6563 7469 6f6e 2878 2929  intersection(x))
-00015600: 290a 2020 2020 2020 2020 2020 2020 6466  ).            df
-00015610: 7379 6d5b 2769 6478 275d 203d 2064 6673  sym['idx'] = dfs
-00015620: 796d 2e69 6e64 6578 2e76 616c 7565 730a  ym.index.values.
-00015630: 2020 2020 2020 2020 2020 2020 6466 7379              dfsy
-00015640: 6d2e 6170 706c 7928 6c61 6d62 6461 2078  m.apply(lambda x
-00015650: 3a20 782e 7369 6478 2e72 656d 6f76 6528  : x.sidx.remove(
-00015660: 782e 6964 7829 2c20 6178 6973 3d31 290a  x.idx), axis=1).
-00015670: 2020 2020 2020 2020 2020 2020 6466 7379              dfsy
-00015680: 6d5b 276e 6577 5f67 275d 203d 2064 6673  m['new_g'] = dfs
-00015690: 796d 2e61 7070 6c79 286c 616d 6264 6120  ym.apply(lambda 
-000156a0: 783a 2072 6564 7563 6528 6c61 6d62 6461  x: reduce(lambda
-000156b0: 2078 2c20 793a 2078 2e64 6966 6665 7265   x, y: x.differe
-000156c0: 6e63 6528 7929 2e62 7566 6665 7228 3029  nce(y).buffer(0)
-000156d0: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
-000156e0: 2020 2020 2020 2020 2020 2020 2020 205b                 [
-000156f0: 782e 6765 6f6d 6574 7279 5d2b 6c69 7374  x.geometry]+list
-00015700: 2864 6673 796d 2e69 6c6f 635b 782e 7369  (dfsym.iloc[x.si
-00015710: 6478 5d2e 6765 6f6d 6574 7279 2929 202c  dx].geometry)) ,
-00015720: 2061 7869 733d 3129 0a20 2020 2020 2020   axis=1).       
-00015730: 2020 2020 2064 6673 796d 2e67 656f 6d65       dfsym.geome
-00015740: 7472 7920 3d20 6466 7379 6d2e 6e65 775f  try = dfsym.new_
-00015750: 670a 2020 2020 2020 2020 2020 2020 6466  g.            df
-00015760: 7379 6d20 3d20 6466 7379 6d2e 6c6f 635b  sym = dfsym.loc[
-00015770: 6466 7379 6d2e 6765 6f6d 6574 7279 2e69  dfsym.geometry.i
-00015780: 735f 656d 7074 793d 3d46 616c 7365 5d2e  s_empty==False].
-00015790: 636f 7079 2829 0a20 2020 2020 2020 2020  copy().         
-000157a0: 2020 2064 6673 796d 2e64 726f 7028 5b27     dfsym.drop(['
-000157b0: 6262 6f78 272c 2027 7369 6478 272c 2027  bbox', 'sidx', '
-000157c0: 6964 7827 2c20 2769 6478 3127 2c27 6964  idx', 'idx1','id
-000157d0: 7832 272c 2027 6e65 775f 6727 5d2c 2061  x2', 'new_g'], a
-000157e0: 7869 733d 312c 2069 6e70 6c61 6365 3d54  xis=1, inplace=T
-000157f0: 7275 6529 0a20 2020 2020 2020 2020 2020  rue).           
-00015800: 2072 6574 7572 6e20 6466 7379 6d0a 2020   return dfsym.  
-00015810: 2020 2020 2020 656c 6966 2068 6f77 3d3d        elif how==
-00015820: 2775 6e69 6f6e 273a 0a20 2020 2020 2020  'union':.       
-00015830: 2020 2020 2064 6669 6e74 6572 203d 2073       dfinter = s
-00015840: 7061 7469 616c 5f6f 7665 726c 6179 7328  patial_overlays(
-00015850: 6466 312c 2064 6632 2c20 686f 773d 2769  df1, df2, how='i
-00015860: 6e74 6572 7365 6374 696f 6e27 290a 2020  ntersection').  
-00015870: 2020 2020 2020 2020 2020 6466 7379 6d20            dfsym 
-00015880: 3d20 7370 6174 6961 6c5f 6f76 6572 6c61  = spatial_overla
-00015890: 7973 2864 6631 2c20 6466 322c 2068 6f77  ys(df1, df2, how
-000158a0: 3d27 7379 6d6d 6574 7269 635f 6469 6666  ='symmetric_diff
-000158b0: 6572 656e 6365 2729 0a20 2020 2020 2020  erence').       
-000158c0: 2020 2020 2064 6675 6e69 6f6e 203d 2064       dfunion = d
-000158d0: 6669 6e74 6572 2e61 7070 656e 6428 6466  finter.append(df
-000158e0: 7379 6d29 0a20 2020 2020 2020 2020 2020  sym).           
-000158f0: 2064 6675 6e69 6f6e 2e72 6573 6574 5f69   dfunion.reset_i
-00015900: 6e64 6578 2869 6e70 6c61 6365 3d54 7275  ndex(inplace=Tru
-00015910: 652c 2064 726f 703d 5472 7565 290a 2020  e, drop=True).  
-00015920: 2020 2020 2020 2020 2020 7265 7475 726e            return
-00015930: 2064 6675 6e69 6f6e 0a20 2020 2020 2020   dfunion.       
-00015940: 2065 6c69 6620 686f 773d 3d27 6964 656e   elif how=='iden
-00015950: 7469 7479 273a 0a20 2020 2020 2020 2020  tity':.         
-00015960: 2020 2064 6675 6e69 6f6e 203d 2073 7061     dfunion = spa
-00015970: 7469 616c 5f6f 7665 726c 6179 7328 6466  tial_overlays(df
-00015980: 312c 2064 6632 2c20 686f 773d 2775 6e69  1, df2, how='uni
-00015990: 6f6e 2729 0a20 2020 2020 2020 2020 2020  on').           
-000159a0: 2063 6f6c 7331 203d 2064 6631 2e63 6f6c   cols1 = df1.col
-000159b0: 756d 6e73 2e74 6f6c 6973 7428 290a 2020  umns.tolist().  
-000159c0: 2020 2020 2020 2020 2020 636f 6c73 3220            cols2 
-000159d0: 3d20 6466 322e 636f 6c75 6d6e 732e 746f  = df2.columns.to
-000159e0: 6c69 7374 2829 0a20 2020 2020 2020 2020  list().         
-000159f0: 2020 2063 6f6c 7331 2e72 656d 6f76 6528     cols1.remove(
-00015a00: 2767 656f 6d65 7472 7927 290a 2020 2020  'geometry').    
-00015a10: 2020 2020 2020 2020 636f 6c73 322e 7265          cols2.re
-00015a20: 6d6f 7665 2827 6765 6f6d 6574 7279 2729  move('geometry')
-00015a30: 0a20 2020 2020 2020 2020 2020 2063 6f6c  .            col
-00015a40: 7332 203d 2073 6574 2863 6f6c 7332 292e  s2 = set(cols2).
-00015a50: 696e 7465 7273 6563 7469 6f6e 2873 6574  intersection(set
-00015a60: 2863 6f6c 7331 2929 0a20 2020 2020 2020  (cols1)).       
-00015a70: 2020 2020 2063 6f6c 7331 203d 206c 6973       cols1 = lis
-00015a80: 7428 7365 7428 636f 6c73 3129 2e64 6966  t(set(cols1).dif
-00015a90: 6665 7265 6e63 6528 7365 7428 636f 6c73  ference(set(cols
-00015aa0: 3229 2929 0a20 2020 2020 2020 2020 2020  2))).           
-00015ab0: 2063 6f6c 7332 203d 205b 636f 6c2b 275f   cols2 = [col+'_
-00015ac0: 3127 2066 6f72 2063 6f6c 2069 6e20 636f  1' for col in co
-00015ad0: 6c73 325d 0a20 2020 2020 2020 2020 2020  ls2].           
-00015ae0: 2064 6675 6e69 6f6e 203d 2064 6675 6e69   dfunion = dfuni
-00015af0: 6f6e 5b28 6466 756e 696f 6e5b 636f 6c73  on[(dfunion[cols
-00015b00: 312b 636f 6c73 325d 2e69 736e 756c 6c28  1+cols2].isnull(
-00015b10: 293d 3d46 616c 7365 292e 7661 6c75 6573  )==False).values
-00015b20: 5d0a 2020 2020 2020 2020 2020 2020 7265  ].            re
-00015b30: 7475 726e 2064 6675 6e69 6f6e 0a0a 2020  turn dfunion..  
-00015b40: 2020 6465 6620 6d61 6b65 5f73 6861 7065    def make_shape
-00015b50: 5f70 6f69 6e74 2820 2020 7365 6c66 2c0a  _point(   self,.
-00015b60: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00015b70: 2020 2020 2020 2020 2020 2020 6461 7461              data
-00015b80: 6672 616d 652c 0a20 2020 2020 2020 2020  frame,.         
-00015b90: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00015ba0: 2020 206c 6f6e 5f66 6965 6c64 2c0a 2020     lon_field,.  
-00015bb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00015bc0: 2020 2020 2020 2020 2020 6c61 745f 6669            lat_fi
-00015bd0: 656c 642c 0a20 2020 2020 2020 2020 2020  eld,.           
-00015be0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00015bf0: 2063 7273 3d4e 6f6e 6529 3a0a 2020 2020   crs=None):.    
-00015c00: 2020 2020 2222 220a 2020 2020 2020 2020      """.        
-00015c10: 4020 6175 7468 6f72 3a20 2020 2020 2020  @ author:       
-00015c20: 2020 2020 2020 2020 2020 2053 6865 7276             Sherv
-00015c30: 616e 2047 6861 7261 7269 0a20 2020 2020  an Gharari.     
-00015c40: 2020 2040 2047 6974 6875 623a 2020 2020     @ Github:    
-00015c50: 2020 2020 2020 2020 2020 2020 2020 6874                ht
-00015c60: 7470 733a 2f2f 6769 7468 7562 2e63 6f6d  tps://github.com
-00015c70: 2f53 6865 7276 616e 4768 6172 6172 692f  /ShervanGharari/
-00015c80: 4541 5359 4d4f 5245 0a20 2020 2020 2020  EASYMORE.       
-00015c90: 2040 2061 7574 686f 7227 7320 656d 6169   @ author's emai
-00015ca0: 6c20 6964 3a20 2020 2020 2020 7368 2e67  l id:       sh.g
-00015cb0: 6861 7261 7269 4067 6d61 696c 2e63 6f6d  harari@gmail.com
-00015cc0: 0a20 2020 2020 2020 2040 206c 6963 656e  .        @ licen
-00015cd0: 7365 3a20 2020 2020 2020 2020 2020 2020  se:             
-00015ce0: 2020 2020 474e 552d 4750 4c76 330a 2020      GNU-GPLv3.  
-00015cf0: 2020 2020 2020 5468 6973 2066 756e 6374        This funct
-00015d00: 696f 6e20 6372 6561 7465 7320 6120 6765  ion creates a ge
-00015d10: 6f70 616e 6461 7320 6461 7461 6672 616d  opandas datafram
-00015d20: 6520 6f66 206c 6174 2c20 6c6f 6e20 616e  e of lat, lon an
-00015d30: 6420 4944 7320 7072 6f76 6964 6564 0a20  d IDs provided. 
-00015d40: 2020 2020 2020 2041 7267 756d 656e 7473         Arguments
-00015d50: 0a20 2020 2020 2020 202d 2d2d 2d2d 2d2d  .        -------
-00015d60: 2d2d 0a20 2020 2020 2020 2064 6174 6166  --.        dataf
-00015d70: 7261 6d65 3a20 7061 6e64 6173 2064 6174  rame: pandas dat
-00015d80: 6166 7261 6d65 206f 7220 7374 7269 6e67  aframe or string
-00015d90: 206c 696e 6b69 6e67 2074 6f20 6120 6373   linking to a cs
-00015da0: 7620 6461 7461 2066 7261 6d65 0a20 2020  v data frame.   
-00015db0: 2020 2020 206c 6f6e 5f66 6965 6c64 3a20       lon_field: 
-00015dc0: 7374 7269 6e67 2c20 7468 6520 6e61 6d65  string, the name
-00015dd0: 206f 6620 6c6f 6e67 6974 7564 6520 636f   of longitude co
-00015de0: 6c75 6d6e 2069 6e20 6461 7461 6672 616d  lumn in datafram
-00015df0: 650a 2020 2020 2020 2020 6c61 745f 6669  e.        lat_fi
-00015e00: 656c 643a 2073 7472 696e 672c 2074 6865  eld: string, the
-00015e10: 206e 616d 6520 6f66 206c 6174 6974 7564   name of latitud
-00015e20: 6520 636f 6c75 6d6e 2069 6e20 6461 7461  e column in data
-00015e30: 6672 616d 650a 2020 2020 2020 2020 6372  frame.        cr
-00015e40: 733a 2073 7472 696e 672c 2069 6e64 6963  s: string, indic
-00015e50: 6174 696e 6720 7468 6520 7370 6174 6961  ating the spatia
-00015e60: 6c20 7265 6665 7265 6e63 653b 2065 2e67  l reference; e.g
-00015e70: 2e27 4550 5347 3a34 3332 3627 0a20 2020  .'EPSG:4326'.   
-00015e80: 2020 2020 2052 6574 7572 6e73 0a20 2020       Returns.   
-00015e90: 2020 2020 202d 2d2d 2d2d 2d2d 0a20 2020       -------.   
-00015ea0: 2020 2020 2073 6870 3a20 6765 6f70 616e       shp: geopan
-00015eb0: 6461 7320 6461 7461 6672 616d 652c 2077  das dataframe, w
-00015ec0: 6974 6820 6765 6f6d 6574 7279 206f 6620  ith geometry of 
-00015ed0: 6c6f 6e67 6974 7564 6520 616e 6420 6c61  longitude and la
-00015ee0: 7469 7475 6465 0a20 2020 2020 2020 2022  titude.        "
-00015ef0: 2222 0a20 2020 2020 2020 2069 6d70 6f72  "".        impor
-00015f00: 7420 6765 6f70 616e 6461 7320 6173 2067  t geopandas as g
-00015f10: 7064 0a20 2020 2020 2020 2069 6d70 6f72  pd.        impor
-00015f20: 7420 7061 6e64 6173 2061 7320 7064 0a20  t pandas as pd. 
-00015f30: 2020 2020 2020 2069 6620 6973 696e 7374         if isinst
-00015f40: 616e 6365 2864 6174 6166 7261 6d65 2c20  ance(dataframe, 
-00015f50: 7374 7229 3a0a 2020 2020 2020 2020 2020  str):.          
-00015f60: 2020 6461 7461 6672 616d 6520 3d20 7064    dataframe = pd
-00015f70: 2e72 6561 645f 6373 7628 6461 7461 6672  .read_csv(datafr
-00015f80: 616d 6529 0a20 2020 2020 2020 2073 6870  ame).        shp
-00015f90: 203d 2067 7064 2e47 656f 4461 7461 4672   = gpd.GeoDataFr
-00015fa0: 616d 6528 6461 7461 6672 616d 652c 2067  ame(dataframe, g
-00015fb0: 656f 6d65 7472 793d 6770 642e 706f 696e  eometry=gpd.poin
-00015fc0: 7473 5f66 726f 6d5f 7879 2864 6174 6166  ts_from_xy(dataf
-00015fd0: 7261 6d65 5b6c 6f6e 5f66 6965 6c64 5d2c  rame[lon_field],
-00015fe0: 2064 6174 6166 7261 6d65 5b6c 6174 5f66   dataframe[lat_f
-00015ff0: 6965 6c64 5d29 290a 2020 2020 2020 2020  ield])).        
-00016000: 6966 2063 7273 3a0a 2020 2020 2020 2020  if crs:.        
-00016010: 2020 2020 7368 7020 3d20 7368 702e 7365      shp = shp.se
-00016020: 745f 6372 7320 2863 7273 290a 2020 2020  t_crs (crs).    
-00016030: 2020 2020 656c 7365 3a0a 2020 2020 2020      else:.      
-00016040: 2020 2020 2020 7072 696e 7428 276e 6f20        print('no 
-00016050: 6372 7320 6973 2070 726f 7669 6465 6420  crs is provided 
-00016060: 666f 7220 7468 6520 706f 696e 7420 7368  for the point sh
-00016070: 6170 6566 696c 6573 3b20 4541 5359 4d4f  apefiles; EASYMO
-00016080: 5245 2077 696c 6c20 616c 6c6f 6361 7465  RE will allocate
-00016090: 2057 4753 3834 2729 0a20 2020 2020 2020   WGS84').       
-000160a0: 2020 2020 2073 6870 203d 2073 6870 2e73       shp = shp.s
-000160b0: 6574 5f63 7273 2028 2745 5053 473a 3433  et_crs ('EPSG:43
-000160c0: 3236 2729 0a20 2020 2020 2020 2072 6574  26').        ret
-000160d0: 7572 6e20 7368 700a 0a20 2020 2064 6566  urn shp..    def
-000160e0: 207a 6f6e 616c 5f73 7461 745f 7665 6374   zonal_stat_vect
-000160f0: 6f72 2028 2073 656c 662c 0a20 2020 2020  or ( self,.     
-00016100: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00016110: 2020 2020 2020 2076 6563 746f 725f 7061         vector_pa
-00016120: 7468 5f31 2c0a 2020 2020 2020 2020 2020  th_1,.          
-00016130: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00016140: 2020 7665 6374 6f72 5f70 6174 685f 322c    vector_path_2,
-00016150: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00016160: 2020 2020 2020 2020 2020 2020 2066 6965               fie
-00016170: 6c64 5f49 445f 3120 3d20 4e6f 6e65 2c0a  ld_ID_1 = None,.
-00016180: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00016190: 2020 2020 2020 2020 2020 2020 6669 656c              fiel
-000161a0: 645f 4944 5f32 203d 204e 6f6e 6529 3a0a  d_ID_2 = None):.
-000161b0: 2020 2020 2020 2020 2222 220a 2020 2020          """.    
-000161c0: 2020 2020 4020 6175 7468 6f72 3a20 2020      @ author:   
-000161d0: 2020 2020 2020 2020 2020 2020 2020 2053                 S
-000161e0: 6865 7276 616e 2047 6861 7261 7269 0a20  hervan Gharari. 
-000161f0: 2020 2020 2020 2040 2047 6974 6875 623a         @ Github:
-00016200: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00016210: 2020 6874 7470 733a 2f2f 6769 7468 7562    https://github
-00016220: 2e63 6f6d 2f53 6865 7276 616e 4768 6172  .com/ShervanGhar
-00016230: 6172 692f 4541 5359 4d4f 5245 0a20 2020  ari/EASYMORE.   
-00016240: 2020 2020 2040 2061 7574 686f 7227 7320       @ author's 
-00016250: 656d 6169 6c20 6964 3a20 2020 2020 2020  email id:       
-00016260: 7368 2e67 6861 7261 7269 4067 6d61 696c  sh.gharari@gmail
-00016270: 2e63 6f6d 0a20 2020 2020 2020 2040 206c  .com.        @ l
-00016280: 6963 656e 7365 3a20 2020 2020 2020 2020  icense:         
-00016290: 2020 2020 2020 2020 474e 552d 4750 4c76          GNU-GPLv
-000162a0: 330a 2020 2020 2020 2020 5468 6973 2066  3.        This f
-000162b0: 756e 6374 696f 6e20 7265 6164 7320 7468  unction reads th
-000162c0: 6520 7477 6f20 7368 6170 6566 696c 6520  e two shapefile 
-000162d0: 696e 2057 4753 3834 2061 6e64 2072 6574  in WGS84 and ret
-000162e0: 7572 6e20 7468 6520 7065 7263 656e 7420  urn the percent 
-000162f0: 6f66 2069 6e74 6572 7365 6374 696f 6e0a  of intersection.
-00016300: 2020 2020 2020 2020 6f66 2074 6865 2065          of the e
-00016310: 6c65 6d65 6e74 7320 6f66 2074 6865 2073  lements of the s
-00016320: 6563 6f6e 6420 7368 6170 6566 696c 6520  econd shapefile 
-00016330: 696e 2074 6865 2066 6972 7374 2073 6861  in the first sha
-00016340: 7065 6669 6c65 2028 616c 736f 2074 6865  pefile (also the
-00016350: 206e 6f72 6d61 6c69 7a65 6420 7661 6c75   normalized valu
-00016360: 6573 290a 2020 2020 2020 2020 4172 6775  es).        Argu
-00016370: 6d65 6e74 730a 2020 2020 2020 2020 2d2d  ments.        --
-00016380: 2d2d 2d2d 2d2d 2d0a 2020 2020 2020 2020  -------.        
-00016390: 7665 6374 6f72 5f70 6174 685f 313a 2073  vector_path_1: s
-000163a0: 7472 696e 673b 2074 6865 2070 6174 6820  tring; the path 
-000163b0: 746f 2074 6865 2074 6172 6765 7420 7368  to the target sh
-000163c0: 6170 6566 696c 653b 2061 7320 616e 2065  apefile; as an e
-000163d0: 7861 6d70 6c65 2073 7562 6261 7369 6e73  xample subbasins
-000163e0: 0a20 2020 2020 2020 2076 6563 746f 725f  .        vector_
-000163f0: 7061 7468 5f32 3a20 7374 7269 6e67 3b20  path_2: string; 
-00016400: 7468 6520 7061 7468 2074 6f20 7468 6520  the path to the 
-00016410: 736f 7572 6365 2073 6861 7065 6669 6c65  source shapefile
-00016420: 3b20 6173 2061 6e20 6c61 6e64 2063 6f76  ; as an land cov
-00016430: 6572 0a20 2020 2020 2020 2066 6965 6c64  er.        field
-00016440: 5f49 445f 313a 206e 616d 6520 6f66 2074  _ID_1: name of t
-00016450: 6865 2066 6965 6c64 7320 6672 6f6d 2074  he fields from t
-00016460: 6865 2066 6972 7374 2073 6861 7065 6669  he first shapefi
-00016470: 6c65 2074 6861 7420 6964 656e 7469 6669  le that identifi
-00016480: 6573 2062 6574 7765 656e 2074 6865 2073  es between the s
-00016490: 6861 7065 730a 2020 2020 2020 2020 6669  hapes.        fi
-000164a0: 656c 645f 4944 5f32 3a20 6e61 6d65 206f  eld_ID_2: name o
-000164b0: 6620 7468 6520 6669 656c 6473 2066 726f  f the fields fro
-000164c0: 6d20 7468 6520 7365 636f 6e64 2073 6861  m the second sha
-000164d0: 7065 6669 6c65 2074 6861 7420 6964 656e  pefile that iden
-000164e0: 7469 6669 6573 2062 6574 7765 656e 2074  tifies between t
-000164f0: 6865 2073 6861 7065 730a 2020 2020 2020  he shapes.      
-00016500: 2020 5265 7475 726e 730a 2020 2020 2020    Returns.      
-00016510: 2020 2d2d 2d2d 2d2d 2d0a 2020 2020 2020    -------.      
-00016520: 2020 7368 705f 696e 743a 2067 656f 6461    shp_int: geoda
-00016530: 7461 6672 616d 652c 2077 6974 6820 7661  taframe, with va
-00016540: 6c75 6573 206f 6620 6d65 616e 2c20 6d61  lues of mean, ma
-00016550: 782c 206d 696e 2c20 7375 6d2c 2073 7464  x, min, sum, std
-00016560: 2c20 636f 756e 742c 2066 6964 2066 6f72  , count, fid for
-00016570: 2065 6163 6820 7368 6170 6520 696e 2073   each shape in s
-00016580: 6861 7065 6669 6c65 0a20 2020 2020 2020  hapefile.       
-00016590: 2022 2222 0a20 2020 2020 2020 2069 6d70   """.        imp
-000165a0: 6f72 7420 6765 6f70 616e 6461 7320 6173  ort geopandas as
-000165b0: 2067 7064 0a20 2020 2020 2020 2073 6870   gpd.        shp
-000165c0: 5f31 203d 2067 7064 2e72 6561 645f 6669  _1 = gpd.read_fi
-000165d0: 6c65 2876 6563 746f 725f 7061 7468 5f31  le(vector_path_1
-000165e0: 290a 2020 2020 2020 2020 6966 206e 6f74  ).        if not
-000165f0: 2073 6870 5f31 2e63 7273 3a0a 2020 2020   shp_1.crs:.    
-00016600: 2020 2020 2020 2020 7379 732e 6578 6974          sys.exit
-00016610: 2827 6669 7273 7420 7368 6170 6566 696c  ('first shapefil
-00016620: 6520 646f 6573 206e 6f74 2068 6176 6520  e does not have 
-00016630: 6120 7072 6f6a 6563 7469 6f6e 2729 0a20  a projection'). 
-00016640: 2020 2020 2020 2069 6620 2265 7073 673a         if "epsg:
-00016650: 3639 3333 2220 6e6f 7420 696e 2073 7472  6933" not in str
-00016660: 2873 6870 5f31 2e63 7273 292e 6c6f 7765  (shp_1.crs).lowe
-00016670: 7228 293a 0a20 2020 2020 2020 2020 2020  r():.           
-00016680: 2073 6870 5f31 203d 2073 6870 5f31 2e74   shp_1 = shp_1.t
-00016690: 6f5f 6372 7320 2822 4550 5347 3a36 3933  o_crs ("EPSG:693
-000166a0: 3322 2920 2320 7072 6f6a 6563 7420 746f  3") # project to
-000166b0: 2065 7175 616c 2061 7265 610a 2020 2020   equal area.    
-000166c0: 2020 2020 7368 705f 3220 3d20 6770 642e      shp_2 = gpd.
-000166d0: 7265 6164 5f66 696c 6528 7665 6374 6f72  read_file(vector
-000166e0: 5f70 6174 685f 3229 0a20 2020 2020 2020  _path_2).       
-000166f0: 2069 6620 6e6f 7420 7368 705f 322e 6372   if not shp_2.cr
-00016700: 733a 0a20 2020 2020 2020 2020 2020 2073  s:.            s
-00016710: 7973 2e65 7869 7428 2773 6563 6f6e 6420  ys.exit('second 
-00016720: 7368 6170 6566 696c 6520 646f 6573 206e  shapefile does n
-00016730: 6f74 2068 6176 6520 6120 7072 6f6a 6563  ot have a projec
-00016740: 7469 6f6e 2729 0a20 2020 2020 2020 2069  tion').        i
-00016750: 6620 2265 7073 673a 3639 3333 2220 6e6f  f "epsg:6933" no
-00016760: 7420 696e 2073 7472 2873 6870 5f32 2e63  t in str(shp_2.c
-00016770: 7273 292e 6c6f 7765 7228 293a 0a20 2020  rs).lower():.   
-00016780: 2020 2020 2020 2020 2073 6870 5f32 203d           shp_2 =
-00016790: 2073 6870 5f32 2e74 6f5f 6372 7320 2822   shp_2.to_crs ("
-000167a0: 4550 5347 3a36 3933 3322 2920 2320 7072  EPSG:6933") # pr
-000167b0: 6f6a 6563 7420 746f 2065 7175 616c 2061  oject to equal a
-000167c0: 7265 610a 2020 2020 2020 2020 7368 705f  rea.        shp_
-000167d0: 696e 7420 3d20 7365 6c66 2e69 6e74 6572  int = self.inter
-000167e0: 7365 6374 696f 6e5f 7368 7028 7368 705f  section_shp(shp_
-000167f0: 312c 2073 6870 5f32 290a 2020 2020 2020  1, shp_2).      
-00016800: 2020 2320 7265 6e61 6d65 2064 6963 7469    # rename dicti
-00016810: 6f6e 6172 790a 2020 2020 2020 2020 6469  onary.        di
-00016820: 6374 5f72 656e 616d 6520 3d20 7b27 535f  ct_rename = {'S_
-00016830: 315f 272b 6669 656c 645f 4944 5f31 3a20  1_'+field_ID_1: 
-00016840: 6669 656c 645f 4944 5f31 2b27 5f31 272c  field_ID_1+'_1',
-00016850: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00016860: 2020 2020 2020 2020 2753 5f32 5f27 2b66          'S_2_'+f
-00016870: 6965 6c64 5f49 445f 323a 2066 6965 6c64  ield_ID_2: field
-00016880: 5f49 445f 322b 275f 3227 2c0a 2020 2020  _ID_2+'_2',.    
-00016890: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000168a0: 2020 2027 4153 3127 203a 2027 415f 315b     'AS1' : 'A_1[
-000168b0: 6d32 5d27 2c0a 2020 2020 2020 2020 2020  m2]',.          
-000168c0: 2020 2020 2020 2020 2020 2020 2027 4149               'AI
-000168d0: 4e54 273a 2027 4169 6e74 5b6d 325d 272c  NT': 'Aint[m2]',
-000168e0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-000168f0: 2020 2020 2020 2020 2741 5031 2720 3a20          'AP1' : 
-00016900: 2770 6572 6365 6e74 272c 0a20 2020 2020  'percent',.     
-00016910: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00016920: 2020 2741 5031 4e27 3a20 2770 6572 6365    'AP1N': 'perce
-00016930: 6e74 5f4e 277d 0a20 2020 2020 2020 2073  nt_N'}.        s
-00016940: 6870 5f69 6e74 203d 2073 6870 5f69 6e74  hp_int = shp_int
-00016950: 2e72 656e 616d 6528 636f 6c75 6d6e 733d  .rename(columns=
-00016960: 6469 6374 5f72 656e 616d 6529 0a20 2020  dict_rename).   
-00016970: 2020 2020 2063 6f6c 756d 6e5f 6c69 7374       column_list
-00016980: 203d 206c 6973 7420 285b 2741 5f31 5b6d   = list (['A_1[m
-00016990: 325d 272c 2741 696e 745b 6d32 5d27 2c0a  2]','Aint[m2]',.
-000169a0: 2020 2020 2020 2020 2020 2020 2767 656f              'geo
-000169b0: 6d65 7472 7927 2c20 2770 6572 6365 6e74  metry', 'percent
-000169c0: 272c 2027 7065 7263 656e 745f 4e27 2c0a  ', 'percent_N',.
-000169d0: 2020 2020 2020 2020 2020 2020 6669 656c              fiel
-000169e0: 645f 4944 5f31 2b27 5f31 272c 2066 6965  d_ID_1+'_1', fie
-000169f0: 6c64 5f49 445f 322b 275f 3227 5d29 0a20  ld_ID_2+'_2']). 
-00016a00: 2020 2020 2020 2073 6870 5f69 6e74 203d         shp_int =
-00016a10: 2073 6870 5f69 6e74 5b63 6f6c 756d 6e5f   shp_int[column_
-00016a20: 6c69 7374 5d0a 2020 2020 2020 2020 7368  list].        sh
-00016a30: 705f 696e 745b 2770 6572 6365 6e74 275d  p_int['percent']
-00016a40: 2020 203d 2073 6870 5f69 6e74 5b27 7065     = shp_int['pe
-00016a50: 7263 656e 7427 5d20 2a20 3130 3020 2320  rcent'] * 100 # 
-00016a60: 746f 2070 6572 656e 740a 2020 2020 2020  to perent.      
-00016a70: 2020 7368 705f 696e 745b 2770 6572 6365    shp_int['perce
-00016a80: 6e74 5f4e 275d 203d 2073 6870 5f69 6e74  nt_N'] = shp_int
-00016a90: 5b27 7065 7263 656e 745f 4e27 5d20 2a20  ['percent_N'] * 
-00016aa0: 3130 3020 2320 746f 2070 6572 656e 740a  100 # to perent.
-00016ab0: 2020 2020 2020 2020 7368 705f 696e 7420          shp_int 
-00016ac0: 3d20 7368 705f 696e 742e 746f 5f63 7273  = shp_int.to_crs
-00016ad0: 2873 6870 5f31 2e63 7273 2920 2320 7072  (shp_1.crs) # pr
-00016ae0: 6f6a 6563 7420 746f 2074 6865 2066 6972  oject to the fir
-00016af0: 7374 2073 6861 7065 6669 6c65 2063 7273  st shapefile crs
-00016b00: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
-00016b10: 7368 705f 696e 740a 0a20 2020 2064 6566  shp_int..    def
-00016b20: 207a 6f6e 616c 5f73 7461 7428 7365 6c66   zonal_stat(self
-00016b30: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
-00016b40: 2020 2020 2076 6563 746f 725f 7061 7468       vector_path
-00016b50: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
-00016b60: 2020 2020 2072 6173 7465 725f 7061 7468       raster_path
-00016b70: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
-00016b80: 2020 2020 2068 6973 746f 6772 616d 203d       histogram =
-00016b90: 2046 616c 7365 2c0a 2020 2020 2020 2020   False,.        
-00016ba0: 2020 2020 2020 2020 2020 2072 6173 7465             raste
-00016bb0: 725f 6261 6e64 203d 2031 2c0a 2020 2020  r_band = 1,.    
-00016bc0: 2020 2020 2020 2020 2020 2020 2020 206e                 n
-00016bd0: 6f64 6174 615f 7661 6c75 6520 3d20 4e6f  odata_value = No
-00016be0: 6e65 293a 0a20 2020 2020 2020 2022 2222  ne):.        """
-00016bf0: 0a20 2020 2020 2020 206f 7269 6769 6e61  .        origina
-00016c00: 6c20 636f 6465 3a0a 2020 2020 2020 2020  l code:.        
-00016c10: 5a6f 6e61 6c20 5374 6174 6973 7469 6373  Zonal Statistics
-00016c20: 0a20 2020 2020 2020 2056 6563 746f 722d  .        Vector-
-00016c30: 5261 7374 6572 2041 6e61 6c79 7369 730a  Raster Analysis.
-00016c40: 2020 2020 2020 2020 436f 7079 7269 6768          Copyrigh
-00016c50: 7420 3230 3133 204d 6174 7468 6577 2050  t 2013 Matthew P
-00016c60: 6572 7279 0a20 2020 2020 2020 2055 7361  erry.        Usa
-00016c70: 6765 3a0a 2020 2020 2020 2020 2020 7a6f  ge:.          zo
-00016c80: 6e61 6c5f 7374 6174 732e 7079 2056 4543  nal_stats.py VEC
-00016c90: 544f 5220 5241 5354 4552 0a20 2020 2020  TOR RASTER.     
-00016ca0: 2020 2020 207a 6f6e 616c 5f73 7461 7473       zonal_stats
-00016cb0: 2e70 7920 2d68 207c 202d 2d68 656c 700a  .py -h | --help.
-00016cc0: 2020 2020 2020 2020 2020 7a6f 6e61 6c5f            zonal_
-00016cd0: 7374 6174 732e 7079 202d 2d76 6572 7369  stats.py --versi
-00016ce0: 6f6e 0a20 2020 2020 2020 204f 7074 696f  on.        Optio
-00016cf0: 6e73 3a0a 2020 2020 2020 2020 2020 2d68  ns:.          -h
-00016d00: 202d 2d68 656c 7020 2020 2020 5368 6f77   --help     Show
-00016d10: 2074 6869 7320 7363 7265 656e 2e0a 2020   this screen..  
-00016d20: 2020 2020 2020 2020 2d2d 7665 7273 696f          --versio
-00016d30: 6e20 2020 2020 5368 6f77 2076 6572 7369  n     Show versi
-00016d40: 6f6e 2e0a 2020 2020 2020 2020 6d6f 6469  on..        modi
-00016d50: 6669 6564 2062 793a 0a20 2020 2020 2020  fied by:.       
-00016d60: 2040 2061 7574 686f 723a 2020 2020 2020   @ author:      
-00016d70: 2020 2020 2020 2020 2020 2020 5368 6572              Sher
-00016d80: 7661 6e20 4768 6172 6172 690a 2020 2020  van Gharari.    
-00016d90: 2020 2020 4020 4769 7468 7562 3a20 2020      @ Github:   
-00016da0: 2020 2020 2020 2020 2020 2020 2020 2068                 h
-00016db0: 7474 7073 3a2f 2f67 6974 6875 622e 636f  ttps://github.co
-00016dc0: 6d2f 5368 6572 7661 6e47 6861 7261 7269  m/ShervanGharari
-00016dd0: 2f45 4153 594d 4f52 450a 2020 2020 2020  /EASYMORE.      
-00016de0: 2020 4020 6175 7468 6f72 2773 2065 6d61    @ author's ema
-00016df0: 696c 2069 643a 2020 2020 2020 2073 682e  il id:       sh.
-00016e00: 6768 6172 6172 6940 676d 6169 6c2e 636f  gharari@gmail.co
-00016e10: 6d0a 2020 2020 2020 2020 4020 6c69 6365  m.        @ lice
-00016e20: 6e73 653a 2020 2020 2020 2020 2020 2020  nse:            
-00016e30: 2020 2020 2047 4e55 2d47 504c 7633 0a20       GNU-GPLv3. 
-00016e40: 2020 2020 2020 2054 6869 7320 6675 6e63         This func
-00016e50: 7469 6f6e 2063 7265 6174 6573 2061 2067  tion creates a g
-00016e60: 656f 7061 6e64 6173 2064 6174 6166 7261  eopandas datafra
-00016e70: 6d65 206f 6620 6c61 742c 206c 6f6e 2061  me of lat, lon a
-00016e80: 6e64 2049 4473 2070 726f 7669 6465 640a  nd IDs provided.
-00016e90: 2020 2020 2020 2020 4172 6775 6d65 6e74          Argument
-00016ea0: 730a 2020 2020 2020 2020 2d2d 2d2d 2d2d  s.        ------
-00016eb0: 2d2d 2d0a 2020 2020 2020 2020 7665 6374  ---.        vect
-00016ec0: 6f72 5f70 6174 683a 2073 7472 696e 673b  or_path: string;
-00016ed0: 2074 6865 2070 6174 6820 746f 2074 6865   the path to the
-00016ee0: 2073 6861 7065 6669 6c65 0a20 2020 2020   shapefile.     
-00016ef0: 2020 2072 6173 7465 725f 7061 7468 3a20     raster_path: 
-00016f00: 7374 7269 6e67 3b20 7468 6520 7061 7468  string; the path
-00016f10: 2074 6f20 7468 6520 7261 7374 6572 0a20   to the raster. 
-00016f20: 2020 2020 2020 2068 6973 746f 6772 616d         histogram
-00016f30: 3a20 6c6f 6769 6361 6c3b 2073 6574 2074  : logical; set t
-00016f40: 6f20 6661 6c73 652c 2066 6f72 2064 6973  o false, for dis
-00016f50: 6372 6574 6520 7661 6c75 6573 2069 6e20  crete values in 
-00016f60: 7261 7374 6572 2028 7375 6368 2061 7320  raster (such as 
-00016f70: 6c61 6e20 636f 7665 7229 2063 616e 2062  lan cover) can b
-00016f80: 6520 7365 7420 5472 7565 0a20 2020 2020  e set True.     
-00016f90: 2020 2072 6173 7465 725f 6261 6e64 3a20     raster_band: 
-00016fa0: 696e 742c 2074 6865 2062 616e 6420 696e  int, the band in
-00016fb0: 2074 6865 2072 6173 7465 7220 746f 2062   the raster to b
-00016fc0: 6520 7573 6564 2066 6f72 207a 6f6e 616c  e used for zonal
-00016fd0: 2073 7461 7469 7374 6963 730a 2020 2020   statistics.    
-00016fe0: 2020 2020 6e6f 6461 7461 5f76 616c 7565      nodata_value
-00016ff0: 3a20 6e6f 2064 6174 6120 7661 6c75 6520  : no data value 
-00017000: 696e 2072 6173 7465 7220 746f 2062 6520  in raster to be 
-00017010: 696e 676e 6f72 6564 0a20 2020 2020 2020  ingnored.       
-00017020: 2067 6c6f 6261 6c5f 7372 635f 6578 7465   global_src_exte
-00017030: 6e74 203a 2073 6574 2061 7320 4661 6c73  nt : set as Fals
-00017040: 650a 2020 2020 2020 2020 5265 7475 726e  e.        Return
-00017050: 730a 2020 2020 2020 2020 2d2d 2d2d 2d2d  s.        ------
-00017060: 2d0a 2020 2020 2020 2020 7368 703a 2067  -.        shp: g
-00017070: 656f 6461 7461 6672 616d 652c 2077 6974  eodataframe, wit
-00017080: 6820 7661 6c75 6573 206f 6620 6d65 616e  h values of mean
-00017090: 2c20 6d61 782c 206d 696e 2c20 7375 6d2c  , max, min, sum,
-000170a0: 2073 7464 2c20 636f 756e 742c 2066 6964   std, count, fid
-000170b0: 2066 6f72 2065 6163 6820 7368 6170 6520   for each shape 
-000170c0: 696e 2073 6861 7065 6669 6c65 0a20 2020  in shapefile.   
-000170d0: 2020 2020 2022 2222 0a20 2020 2020 2020       """.       
-000170e0: 2066 726f 6d20 6f73 6765 6f20 696d 706f   from osgeo impo
-000170f0: 7274 2067 6461 6c2c 206f 6772 0a20 2020  rt gdal, ogr.   
-00017100: 2020 2020 2023 2066 726f 6d20 6f73 6765       # from osge
-00017110: 6f2e 6764 616c 636f 6e73 7420 696d 706f  o.gdalconst impo
-00017120: 7274 202a 0a20 2020 2020 2020 2069 6d70  rt *.        imp
-00017130: 6f72 7420 6f73 6765 6f2e 6764 616c 636f  ort osgeo.gdalco
-00017140: 6e73 740a 2020 2020 2020 2020 696d 706f  nst.        impo
-00017150: 7274 206e 756d 7079 2061 7320 6e70 0a20  rt numpy as np. 
-00017160: 2020 2020 2020 2069 6d70 6f72 7420 7379         import sy
-00017170: 730a 2020 2020 2020 2020 6764 616c 2e50  s.        gdal.P
-00017180: 7573 6845 7272 6f72 4861 6e64 6c65 7228  ushErrorHandler(
-00017190: 2743 504c 5175 6965 7445 7272 6f72 4861  'CPLQuietErrorHa
-000171a0: 6e64 6c65 7227 290a 2020 2020 2020 2020  ndler').        
-000171b0: 696d 706f 7274 2070 616e 6461 7320 6173  import pandas as
-000171c0: 2070 640a 2020 2020 2020 2020 696d 706f   pd.        impo
-000171d0: 7274 206f 730a 2020 2020 2020 2020 696d  rt os.        im
-000171e0: 706f 7274 2067 656f 7061 6e64 6173 2061  port geopandas a
-000171f0: 7320 6770 640a 2020 2020 2020 2020 2320  s gpd.        # 
-00017200: 7365 7420 6861 7264 636f 6465 6420 7661  set hardcoded va
-00017210: 6c75 650a 2020 2020 2020 2020 676c 6f62  lue.        glob
-00017220: 616c 5f73 7263 5f65 7874 656e 7420 3d20  al_src_extent = 
-00017230: 4661 6c73 650a 2020 2020 2020 2020 2320  False.        # 
-00017240: 7265 6164 2074 6865 2072 6174 7374 6572  read the ratster
-00017250: 2066 696c 6520 6261 6e64 206e 756d 6265   file band numbe
-00017260: 7220 6e0a 2020 2020 2020 2020 7264 7320  r n.        rds 
-00017270: 3d20 6764 616c 2e4f 7065 6e28 7261 7374  = gdal.Open(rast
-00017280: 6572 5f70 6174 682c 206f 7367 656f 2e67  er_path, osgeo.g
-00017290: 6461 6c63 6f6e 7374 2e47 415f 5265 6164  dalconst.GA_Read
-000172a0: 4f6e 6c79 290a 2020 2020 2020 2020 6173  Only).        as
-000172b0: 7365 7274 2872 6473 290a 2020 2020 2020  sert(rds).      
-000172c0: 2020 7262 203d 2072 6473 2e47 6574 5261    rb = rds.GetRa
-000172d0: 7374 6572 4261 6e64 2872 6173 7465 725f  sterBand(raster_
-000172e0: 6261 6e64 290a 2020 2020 2020 2020 7267  band).        rg
-000172f0: 7420 3d20 7264 732e 4765 7447 656f 5472  t = rds.GetGeoTr
-00017300: 616e 7366 6f72 6d28 290a 2020 2020 2020  ansform().      
-00017310: 2020 2320 6966 206e 6f64 6174 615f 7661    # if nodata_va
-00017320: 6c75 6520 6973 2069 6465 6e74 6966 6965  lue is identifie
-00017330: 640a 2020 2020 2020 2020 6966 206e 6f64  d.        if nod
-00017340: 6174 615f 7661 6c75 653a 0a20 2020 2020  ata_value:.     
-00017350: 2020 2020 2020 206e 6f64 6174 615f 7661         nodata_va
-00017360: 6c75 6520 3d20 666c 6f61 7428 6e6f 6461  lue = float(noda
-00017370: 7461 5f76 616c 7565 290a 2020 2020 2020  ta_value).      
-00017380: 2020 2020 2020 7262 2e53 6574 4e6f 4461        rb.SetNoDa
-00017390: 7461 5661 6c75 6528 6e6f 6461 7461 5f76  taValue(nodata_v
-000173a0: 616c 7565 290a 2020 2020 2020 2020 2320  alue).        # 
-000173b0: 7265 6164 2076 6563 746f 7220 6461 7461  read vector data
-000173c0: 0a20 2020 2020 2020 2076 6473 203d 206f  .        vds = o
-000173d0: 6772 2e4f 7065 6e28 7665 6374 6f72 5f70  gr.Open(vector_p
-000173e0: 6174 682c 206f 7367 656f 2e67 6461 6c63  ath, osgeo.gdalc
-000173f0: 6f6e 7374 2e47 415f 5265 6164 4f6e 6c79  onst.GA_ReadOnly
-00017400: 2920 2023 2054 4f44 4f20 6d61 7962 6520  )  # TODO maybe 
-00017410: 6f70 656e 2075 7064 6174 6520 6966 2077  open update if w
-00017420: 6520 7761 6e74 2074 6f20 7772 6974 6520  e want to write 
-00017430: 7374 6174 730a 2020 2020 2020 2020 6173  stats.        as
-00017440: 7365 7274 2876 6473 290a 2020 2020 2020  sert(vds).      
-00017450: 2020 766c 7972 203d 2076 6473 2e47 6574    vlyr = vds.Get
-00017460: 4c61 7965 7228 3029 0a20 2020 2020 2020  Layer(0).       
-00017470: 2023 2063 7265 6174 6520 616e 2069 6e2d   # create an in-
-00017480: 6d65 6d6f 7279 206e 756d 7079 2061 7272  memory numpy arr
-00017490: 6179 206f 6620 7468 6520 736f 7572 6365  ay of the source
-000174a0: 2072 6173 7465 7220 6461 7461 0a20 2020   raster data.   
-000174b0: 2020 2020 2023 2063 6f76 6572 696e 6720       # covering 
-000174c0: 7468 6520 7768 6f6c 6520 6578 7465 6e74  the whole extent
-000174d0: 206f 6620 7468 6520 7665 6374 6f72 206c   of the vector l
-000174e0: 6179 6572 0a20 2020 2020 2020 2069 6620  ayer.        if 
-000174f0: 676c 6f62 616c 5f73 7263 5f65 7874 656e  global_src_exten
-00017500: 743a 0a20 2020 2020 2020 2020 2020 2023  t:.            #
-00017510: 2075 7365 2067 6c6f 6261 6c20 736f 7572   use global sour
-00017520: 6365 2065 7874 656e 740a 2020 2020 2020  ce extent.      
-00017530: 2020 2020 2020 2320 7573 6566 756c 206f        # useful o
-00017540: 6e6c 7920 7768 656e 2064 6973 6b20 494f  nly when disk IO
-00017550: 206f 7220 7261 7374 6572 2073 6361 6e6e   or raster scann
-00017560: 696e 6720 696e 6566 6669 6369 656e 6369  ing inefficienci
-00017570: 6573 2061 7265 2079 6f75 7220 6c69 6d69  es are your limi
-00017580: 7469 6e67 2066 6163 746f 720a 2020 2020  ting factor.    
-00017590: 2020 2020 2020 2020 2320 6164 7661 6e74          # advant
-000175a0: 6167 653a 2072 6561 6473 2072 6173 7465  age: reads raste
-000175b0: 7220 6461 7461 2069 6e20 6f6e 6520 7061  r data in one pa
-000175c0: 7373 0a20 2020 2020 2020 2020 2020 2023  ss.            #
-000175d0: 2064 6973 6164 7661 6e74 6167 653a 206c   disadvantage: l
-000175e0: 6172 6765 2076 6563 746f 7220 6578 7465  arge vector exte
-000175f0: 6e74 7320 6d61 7920 6861 7665 2062 6967  nts may have big
-00017600: 206d 656d 6f72 7920 7265 7175 6972 656d   memory requirem
-00017610: 656e 7473 0a20 2020 2020 2020 2020 2020  ents.           
-00017620: 2073 7263 5f6f 6666 7365 7420 3d20 7365   src_offset = se
-00017630: 6c66 2e62 626f 785f 746f 5f70 6978 656c  lf.bbox_to_pixel
-00017640: 5f6f 6666 7365 7473 2872 6774 2c20 766c  _offsets(rgt, vl
-00017650: 7972 2e47 6574 4578 7465 6e74 2829 290a  yr.GetExtent()).
-00017660: 2020 2020 2020 2020 2020 2020 7372 635f              src_
-00017670: 6172 7261 7920 3d20 7262 2e52 6561 6441  array = rb.ReadA
-00017680: 7341 7272 6179 282a 7372 635f 6f66 6673  sArray(*src_offs
-00017690: 6574 290a 2020 2020 2020 2020 2020 2020  et).            
-000176a0: 2320 6361 6c63 756c 6174 6520 6e65 7720  # calculate new 
-000176b0: 6765 6f74 7261 6e73 666f 726d 206f 6620  geotransform of 
-000176c0: 7468 6520 6c61 7965 7220 7375 6273 6574  the layer subset
-000176d0: 0a20 2020 2020 2020 2020 2020 206e 6577  .            new
-000176e0: 5f67 7420 3d20 280a 2020 2020 2020 2020  _gt = (.        
-000176f0: 2020 2020 2020 2020 2872 6774 5b30 5d20          (rgt[0] 
-00017700: 2b20 2873 7263 5f6f 6666 7365 745b 305d  + (src_offset[0]
-00017710: 202a 2072 6774 5b31 5d29 292c 0a20 2020   * rgt[1])),.   
-00017720: 2020 2020 2020 2020 2020 2020 2072 6774               rgt
-00017730: 5b31 5d2c 0a20 2020 2020 2020 2020 2020  [1],.           
-00017740: 2020 2020 2030 2e30 2c0a 2020 2020 2020       0.0,.      
-00017750: 2020 2020 2020 2020 2020 2872 6774 5b33            (rgt[3
-00017760: 5d20 2b20 2873 7263 5f6f 6666 7365 745b  ] + (src_offset[
-00017770: 315d 202a 2072 6774 5b35 5d29 292c 0a20  1] * rgt[5])),. 
-00017780: 2020 2020 2020 2020 2020 2020 2020 2030                 0
-00017790: 2e30 2c0a 2020 2020 2020 2020 2020 2020  .0,.            
-000177a0: 2020 2020 7267 745b 355d 0a20 2020 2020      rgt[5].     
-000177b0: 2020 2020 2020 2029 0a20 2020 2020 2020         ).       
-000177c0: 206d 656d 5f64 7276 203d 206f 6772 2e47   mem_drv = ogr.G
-000177d0: 6574 4472 6976 6572 4279 4e61 6d65 2827  etDriverByName('
-000177e0: 4d65 6d6f 7279 2729 0a20 2020 2020 2020  Memory').       
-000177f0: 2064 7269 7665 7220 3d20 6764 616c 2e47   driver = gdal.G
-00017800: 6574 4472 6976 6572 4279 4e61 6d65 2827  etDriverByName('
-00017810: 4d45 4d27 290a 2020 2020 2020 2020 2320  MEM').        # 
-00017820: 4c6f 6f70 2074 6872 6f75 6768 2076 6563  Loop through vec
-00017830: 746f 7273 0a20 2020 2020 2020 2073 7461  tors.        sta
-00017840: 7473 203d 205b 5d0a 2020 2020 2020 2020  ts = [].        
-00017850: 6665 6174 203d 2076 6c79 722e 4765 744e  feat = vlyr.GetN
-00017860: 6578 7446 6561 7475 7265 2829 0a20 2020  extFeature().   
-00017870: 2020 2020 2077 6869 6c65 2066 6561 7420       while feat 
-00017880: 6973 206e 6f74 204e 6f6e 653a 0a20 2020  is not None:.   
-00017890: 2020 2020 2020 2020 2069 6620 6e6f 7420           if not 
-000178a0: 676c 6f62 616c 5f73 7263 5f65 7874 656e  global_src_exten
-000178b0: 743a 0a20 2020 2020 2020 2020 2020 2020  t:.             
-000178c0: 2020 2023 2075 7365 206c 6f63 616c 2073     # use local s
-000178d0: 6f75 7263 6520 6578 7465 6e74 0a20 2020  ource extent.   
-000178e0: 2020 2020 2020 2020 2020 2020 2023 2066               # f
-000178f0: 6173 7465 7374 206f 7074 696f 6e20 7768  astest option wh
-00017900: 656e 2079 6f75 2068 6176 6520 6661 7374  en you have fast
-00017910: 2064 6973 6b73 2061 6e64 2077 656c 6c20   disks and well 
-00017920: 696e 6465 7865 6420 7261 7374 6572 2028  indexed raster (
-00017930: 6965 2074 696c 6564 2047 656f 7469 6666  ie tiled Geotiff
-00017940: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
-00017950: 2020 2320 6164 7661 6e74 6167 653a 2065    # advantage: e
-00017960: 6163 6820 6665 6174 7572 6520 7573 6573  ach feature uses
-00017970: 2074 6865 2073 6d61 6c6c 6573 7420 7261   the smallest ra
-00017980: 7374 6572 2063 6875 6e6b 0a20 2020 2020  ster chunk.     
-00017990: 2020 2020 2020 2020 2020 2023 2064 6973             # dis
-000179a0: 6164 7661 6e74 6167 653a 206c 6f74 7320  advantage: lots 
-000179b0: 6f66 2072 6561 6473 206f 6e20 7468 6520  of reads on the 
-000179c0: 736f 7572 6365 2072 6173 7465 720a 2020  source raster.  
-000179d0: 2020 2020 2020 2020 2020 2020 2020 7372                sr
-000179e0: 635f 6f66 6673 6574 203d 2073 656c 662e  c_offset = self.
-000179f0: 6262 6f78 5f74 6f5f 7069 7865 6c5f 6f66  bbox_to_pixel_of
-00017a00: 6673 6574 7328 7267 742c 2066 6561 742e  fsets(rgt, feat.
-00017a10: 6765 6f6d 6574 7279 2829 2e47 6574 456e  geometry().GetEn
-00017a20: 7665 6c6f 7065 2829 290a 2020 2020 2020  velope()).      
-00017a30: 2020 2020 2020 2020 2020 7372 635f 6172            src_ar
-00017a40: 7261 7920 3d20 7262 2e52 6561 6441 7341  ray = rb.ReadAsA
-00017a50: 7272 6179 282a 7372 635f 6f66 6673 6574  rray(*src_offset
-00017a60: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
-00017a70: 2020 2320 6361 6c63 756c 6174 6520 6e65    # calculate ne
-00017a80: 7720 6765 6f74 7261 6e73 666f 726d 206f  w geotransform o
-00017a90: 6620 7468 6520 6665 6174 7572 6520 7375  f the feature su
-00017aa0: 6273 6574 0a20 2020 2020 2020 2020 2020  bset.           
-00017ab0: 2020 2020 206e 6577 5f67 7420 3d20 280a       new_gt = (.
-00017ac0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00017ad0: 2020 2020 2872 6774 5b30 5d20 2b20 2873      (rgt[0] + (s
-00017ae0: 7263 5f6f 6666 7365 745b 305d 202a 2072  rc_offset[0] * r
-00017af0: 6774 5b31 5d29 292c 0a20 2020 2020 2020  gt[1])),.       
-00017b00: 2020 2020 2020 2020 2020 2020 2072 6774               rgt
-00017b10: 5b31 5d2c 0a20 2020 2020 2020 2020 2020  [1],.           
-00017b20: 2020 2020 2020 2020 2030 2e30 2c0a 2020           0.0,.  
+00011600: 2020 2020 2020 2020 2020 2020 2020 6669                fi
+00011610: 6c6c 5f76 616c 7565 203d 2073 656c 662e  ll_value = self.
+00011620: 6669 6c6c 5f76 616c 7565 5f6c 6973 745b  fill_value_list[
+00011630: 695d 2c20 7a6c 6962 3d63 6f6d 7066 6c61  i], zlib=compfla
+00011640: 672c 5c0a 2020 2020 2020 2020 2020 2020  g,\.            
+00011650: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00011660: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00011670: 2020 2020 636f 6d70 6c65 7665 6c3d 636f      complevel=co
+00011680: 6d70 6c65 7665 6c2c 5c0a 2020 2020 2020  mplevel,\.      
+00011690: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000116a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000116b0: 2020 2020 2020 2020 2020 6368 756e 6b73            chunks
+000116c0: 697a 6573 3d63 6875 6e6b 5f73 697a 6573  izes=chunk_sizes
+000116d0: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
+000116e0: 2020 2020 2020 7661 7269 6420 5b3a 5d20        varid [:] 
+000116f0: 3d20 7661 725f 7661 6c75 650a 2020 2020  = var_value.    
+00011700: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00011710: 2320 5061 7373 2061 7474 7269 6275 7465  # Pass attribute
+00011720: 730a 2020 2020 2020 2020 2020 2020 2020  s.              
+00011730: 2020 2020 2020 6966 2027 6c6f 6e67 5f6e        if 'long_n
+00011740: 616d 6527 2069 6e20 6e63 6964 732e 7661  ame' in ncids.va
+00011750: 7269 6162 6c65 735b 7365 6c66 2e76 6172  riables[self.var
+00011760: 5f6e 616d 6573 5b69 5d5d 2e6e 6361 7474  _names[i]].ncatt
+00011770: 7273 2829 3a0a 2020 2020 2020 2020 2020  rs():.          
+00011780: 2020 2020 2020 2020 2020 2020 2020 7661                va
+00011790: 7269 642e 6c6f 6e67 5f6e 616d 6520 3d20  rid.long_name = 
+000117a0: 6e63 6964 732e 7661 7269 6162 6c65 735b  ncids.variables[
+000117b0: 7365 6c66 2e76 6172 5f6e 616d 6573 5b69  self.var_names[i
+000117c0: 5d5d 2e6c 6f6e 675f 6e61 6d65 0a20 2020  ]].long_name.   
+000117d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000117e0: 2069 6620 2775 6e69 7473 2720 696e 206e   if 'units' in n
+000117f0: 6369 6473 2e76 6172 6961 626c 6573 5b73  cids.variables[s
+00011800: 656c 662e 7661 725f 6e61 6d65 735b 695d  elf.var_names[i]
+00011810: 5d2e 6e63 6174 7472 7328 293a 0a20 2020  ].ncattrs():.   
+00011820: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00011830: 2020 2020 2076 6172 6964 2e75 6e69 7473       varid.units
+00011840: 203d 206e 6369 6473 2e76 6172 6961 626c   = ncids.variabl
+00011850: 6573 5b73 656c 662e 7661 725f 6e61 6d65  es[self.var_name
+00011860: 735b 695d 5d2e 756e 6974 730a 2020 2020  s[i]].units.    
+00011870: 2020 2020 2020 2020 6966 2073 656c 662e          if self.
+00011880: 7361 7665 5f63 7376 3a0a 2020 2020 2020  save_csv:.      
+00011890: 2020 2020 2020 2020 2020 6473 203d 2078            ds = x
+000118a0: 722e 6f70 656e 5f64 6174 6173 6574 2874  r.open_dataset(t
+000118b0: 6172 6765 745f 6e61 6d65 290a 2020 2020  arget_name).    
+000118c0: 2020 2020 2020 2020 2020 2020 666f 7220              for 
+000118d0: 6920 696e 206e 702e 6172 616e 6765 286c  i in np.arange(l
+000118e0: 656e 2873 656c 662e 7661 725f 6e61 6d65  en(self.var_name
+000118f0: 735f 7265 6d61 7070 6564 2929 3a0a 2020  s_remapped)):.  
+00011900: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00011910: 2020 2320 6173 7369 676e 2074 6865 2076    # assign the v
+00011920: 6172 6961 626c 6520 746f 2074 6865 2064  ariable to the d
+00011930: 6174 6120 6672 616d 6520 7769 7468 2074  ata frame with t
+00011940: 6865 2049 4420 636f 6c75 6d6e 206e 616d  he ID column nam
+00011950: 650a 2020 2020 2020 2020 2020 2020 2020  e.              
+00011960: 2020 2020 2020 636f 6c75 6d6e 5f6e 616d        column_nam
+00011970: 6520 3d20 6c69 7374 286d 6170 2873 7472  e = list(map(str
+00011980: 2c6c 6973 7428 6e70 2e61 7272 6179 2864  ,list(np.array(d
+00011990: 735b 7365 6c66 2e72 656d 6170 7065 645f  s[self.remapped_
+000119a0: 7661 725f 6964 5d29 2929 290a 2020 2020  var_id])))).    
+000119b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000119c0: 636f 6c75 6d6e 5f6e 616d 6520 3d20 5b27  column_name = ['
+000119d0: 4944 5f27 2b73 2066 6f72 2073 2069 6e20  ID_'+s for s in 
+000119e0: 636f 6c75 6d6e 5f6e 616d 655d 0a20 2020  column_name].   
+000119f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00011a00: 2064 6620 3d20 7064 2e44 6174 6146 7261   df = pd.DataFra
+00011a10: 6d65 2864 6174 613d 6e70 2e61 7272 6179  me(data=np.array
+00011a20: 2864 735b 7365 6c66 2e76 6172 5f6e 616d  (ds[self.var_nam
+00011a30: 6573 5f72 656d 6170 7065 645b 695d 5d29  es_remapped[i]])
+00011a40: 2c20 636f 6c75 6d6e 733d 636f 6c75 6d6e  , columns=column
+00011a50: 5f6e 616d 6529 0a20 2020 2020 2020 2020  _name).         
+00011a60: 2020 2020 2020 2020 2020 2023 2064 6620             # df 
+00011a70: 5b27 7469 6d65 275d 203d 2064 732e 7469  ['time'] = ds.ti
+00011a80: 6d65 0a20 2020 2020 2020 2020 2020 2020  me.             
+00011a90: 2020 2020 2020 2064 662e 696e 7365 7274         df.insert
+00011aa0: 286c 6f63 3d30 2c20 636f 6c75 6d6e 3d27  (loc=0, column='
+00011ab0: 7469 6d65 272c 2076 616c 7565 3d64 732e  time', value=ds.
+00011ac0: 7469 6d65 290a 2020 2020 2020 2020 2020  time).          
+00011ad0: 2020 2020 2020 2020 2020 2320 6765 7420            # get 
+00011ae0: 7468 6520 756e 6974 2066 6f72 2074 6865  the unit for the
+00011af0: 2076 6172 6961 626c 6520 6966 2065 7869   variable if exi
+00011b00: 7374 730a 2020 2020 2020 2020 2020 2020  sts.            
+00011b10: 2020 2020 2020 2020 756e 6974 5f6e 616d          unit_nam
+00011b20: 6520 3d20 2727 0a20 2020 2020 2020 2020  e = ''.         
+00011b30: 2020 2020 2020 2020 2020 2069 6620 2775             if 'u
+00011b40: 6e69 7473 2720 696e 2064 735b 7365 6c66  nits' in ds[self
+00011b50: 2e76 6172 5f6e 616d 6573 5f72 656d 6170  .var_names_remap
+00011b60: 7065 645b 695d 5d2e 6174 7472 732e 6b65  ped[i]].attrs.ke
+00011b70: 7973 2829 3a0a 2020 2020 2020 2020 2020  ys():.          
+00011b80: 2020 2020 2020 2020 2020 2020 2020 756e                un
+00011b90: 6974 5f6e 616d 6520 3d20 6473 5b73 656c  it_name = ds[sel
+00011ba0: 662e 7661 725f 6e61 6d65 735f 7265 6d61  f.var_names_rema
+00011bb0: 7070 6564 5b69 5d5d 2e61 7474 7273 5b27  pped[i]].attrs['
+00011bc0: 756e 6974 7327 5d0a 2020 2020 2020 2020  units'].        
+00011bd0: 2020 2020 2020 2020 2020 2020 2320 7265              # re
+00011be0: 6d6f 7665 2074 6865 2066 6f72 6269 6464  move the forbidd
+00011bf0: 656e 2063 6861 7261 6374 6572 2062 6173  en character bas
+00011c00: 6564 206f 6e0a 2020 2020 2020 2020 2020  ed on.          
+00011c10: 2020 2020 2020 2020 2020 2320 5b27 2327            # ['#'
+00011c20: 2c27 2527 2c27 2627 2c27 7b27 2c27 7d27  ,'%','&','{','}'
+00011c30: 2c27 5c27 2c27 3c27 2c27 3e27 2c27 2a27  ,'\','<','>','*'
+00011c40: 2c27 3f27 2c27 2f27 2c27 2027 2c27 2427  ,'?','/',' ','$'
+00011c50: 2c27 2127 2c27 6027 2c27 2727 2c27 2227  ,'!','`',''','"'
+00011c60: 2c27 3a27 2c27 4027 2c27 2b27 2c27 2c27  ,':','@','+',','
+00011c70: 2c27 7c27 2c27 3d27 5d0a 2020 2020 2020  ,'|','='].      
+00011c80: 2020 2020 2020 2020 2020 2020 2020 756e                un
+00011c90: 6974 5f6e 616d 6520 3d20 7265 2e73 7562  it_name = re.sub
+00011ca0: 2822 5b23 2526 7b7d 2a3c 3e2a 3f2a 2421  ("[#%&{}*<>*?*$!
+00011cb0: 603a 402b 2c7c 3d20 5d22 2c22 222c 756e  `:@+,|= ]","",un
+00011cc0: 6974 5f6e 616d 6529 0a20 2020 2020 2020  it_name).       
+00011cd0: 2020 2020 2020 2020 2020 2020 2075 6e69               uni
+00011ce0: 745f 6e61 6d65 203d 2075 6e69 745f 6e61  t_name = unit_na
+00011cf0: 6d65 2e72 6570 6c61 6365 2822 5c5c 222c  me.replace("\\",
+00011d00: 2222 290a 2020 2020 2020 2020 2020 2020  "").            
+00011d10: 2020 2020 2020 2020 756e 6974 5f6e 616d          unit_nam
+00011d20: 6520 3d20 756e 6974 5f6e 616d 652e 7265  e = unit_name.re
+00011d30: 706c 6163 6528 222f 2f22 2c22 2229 0a20  place("//",""). 
+00011d40: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00011d50: 2020 2075 6e69 745f 6e61 6d65 203d 2075     unit_name = u
+00011d60: 6e69 745f 6e61 6d65 2e72 6570 6c61 6365  nit_name.replace
+00011d70: 2822 2f22 2c22 2229 0a20 2020 2020 2020  ("/","").       
+00011d80: 2020 2020 2020 2020 2020 2020 2023 2070               # p
+00011d90: 7269 6e74 2875 6e69 745f 6e61 6d65 290a  rint(unit_name).
+00011da0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00011db0: 2020 2020 7461 7267 6574 5f6e 616d 655f      target_name_
+00011dc0: 6373 7620 3d20 7365 6c66 2e6f 7574 7075  csv = self.outpu
+00011dd0: 745f 6469 7220 2b20 7365 6c66 2e63 6173  t_dir + self.cas
+00011de0: 655f 6e61 6d65 202b 2027 5f72 656d 6170  e_name + '_remap
+00011df0: 7065 645f 272b 2073 656c 662e 7661 725f  ped_'+ self.var_
+00011e00: 6e61 6d65 735f 7265 6d61 7070 6564 5b69  names_remapped[i
+00011e10: 5d20 2b5c 0a20 2020 2020 2020 2020 2020  ] +\.           
+00011e20: 2020 2020 2020 2020 2020 275f 2720 2b20            '_' + 
+00011e30: 756e 6974 5f6e 616d 6520 2b5c 0a20 2020  unit_name +\.   
+00011e40: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00011e50: 2020 275f 2720 2b20 7461 7267 6574 5f64    '_' + target_d
+00011e60: 6174 655f 7469 6d65 735b 305d 2e73 7472  ate_times[0].str
+00011e70: 6674 696d 6528 2225 592d 256d 2d25 642d  ftime("%Y-%m-%d-
+00011e80: 2548 2d25 4d2d 2553 2229 2b20 272e 6373  %H-%M-%S")+ '.cs
+00011e90: 7627 0a20 2020 2020 2020 2020 2020 2020  v'.             
+00011ea0: 2020 2020 2020 2074 6172 6765 745f 6e61         target_na
+00011eb0: 6d65 5f6d 6170 203d 2073 656c 662e 6f75  me_map = self.ou
+00011ec0: 7470 7574 5f64 6972 202b 2027 4d61 7070  tput_dir + 'Mapp
+00011ed0: 696e 675f 2720 2b20 7365 6c66 2e63 6173  ing_' + self.cas
+00011ee0: 655f 6e61 6d65 202b 2027 5f72 656d 6170  e_name + '_remap
+00011ef0: 7065 645f 272b 2073 656c 662e 7661 725f  ped_'+ self.var_
+00011f00: 6e61 6d65 735f 7265 6d61 7070 6564 5b69  names_remapped[i
+00011f10: 5d20 2b5c 0a20 2020 2020 2020 2020 2020  ] +\.           
+00011f20: 2020 2020 2020 2020 2020 275f 2720 2b20            '_' + 
+00011f30: 756e 6974 5f6e 616d 6520 2b5c 0a20 2020  unit_name +\.   
+00011f40: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00011f50: 2020 275f 2720 2b20 7461 7267 6574 5f64    '_' + target_d
+00011f60: 6174 655f 7469 6d65 735b 305d 2e73 7472  ate_times[0].str
+00011f70: 6674 696d 6528 2225 592d 256d 2d25 642d  ftime("%Y-%m-%d-
+00011f80: 2548 2d25 4d2d 2553 2229 2b20 272e 6373  %H-%M-%S")+ '.cs
+00011f90: 7627 0a20 2020 2020 2020 2020 2020 2020  v'.             
+00011fa0: 2020 2020 2020 2069 6620 6f73 2e70 6174         if os.pat
+00011fb0: 682e 6578 6973 7473 2874 6172 6765 745f  h.exists(target_
+00011fc0: 6e61 6d65 5f63 7376 293a 2023 2072 656d  name_csv): # rem
+00011fd0: 6f76 6520 6669 6c65 2069 6620 6578 6973  ove file if exis
+00011fe0: 7473 0a20 2020 2020 2020 2020 2020 2020  ts.             
+00011ff0: 2020 2020 2020 2020 2020 206f 732e 7265             os.re
+00012000: 6d6f 7665 2874 6172 6765 745f 6e61 6d65  move(target_name
+00012010: 5f63 7376 290a 2020 2020 2020 2020 2020  _csv).          
+00012020: 2020 2020 2020 2020 2020 6966 206f 732e            if os.
+00012030: 7061 7468 2e65 7869 7374 7328 7461 7267  path.exists(targ
+00012040: 6574 5f6e 616d 655f 6d61 7029 3a20 2320  et_name_map): # 
+00012050: 7265 6d6f 7665 2066 696c 6520 6966 2065  remove file if e
+00012060: 7869 7374 730a 2020 2020 2020 2020 2020  xists.          
+00012070: 2020 2020 2020 2020 2020 2020 2020 6f73                os
+00012080: 2e72 656d 6f76 6528 7461 7267 6574 5f6e  .remove(target_n
+00012090: 616d 655f 6d61 7029 0a20 2020 2020 2020  ame_map).       
+000120a0: 2020 2020 2020 2020 2020 2020 206c 6174               lat
+000120b0: 5f64 6174 6120 3d20 6e70 2e73 7175 6565  _data = np.squee
+000120c0: 7a65 286e 702e 6172 7261 7928 6473 5b73  ze(np.array(ds[s
+000120d0: 656c 662e 7265 6d61 7070 6564 5f76 6172  elf.remapped_var
+000120e0: 5f6c 6174 5d29 293b 206c 6174 5f64 6174  _lat])); lat_dat
+000120f0: 6120 3d20 6c61 745f 6461 7461 2e66 6c61  a = lat_data.fla
+00012100: 7474 656e 2829 0a20 2020 2020 2020 2020  tten().         
+00012110: 2020 2020 2020 2020 2020 206c 6f6e 5f64             lon_d
+00012120: 6174 6120 3d20 6e70 2e73 7175 6565 7a65  ata = np.squeeze
+00012130: 286e 702e 6172 7261 7928 6473 5b73 656c  (np.array(ds[sel
+00012140: 662e 7265 6d61 7070 6564 5f76 6172 5f6c  f.remapped_var_l
+00012150: 6f6e 5d29 293b 206c 6f6e 5f64 6174 6120  on])); lon_data 
+00012160: 3d20 6c6f 6e5f 6461 7461 2e66 6c61 7474  = lon_data.flatt
+00012170: 656e 2829 0a20 2020 2020 2020 2020 2020  en().           
+00012180: 2020 2020 2020 2020 206d 6170 7320 3d20           maps = 
+00012190: 6e70 2e7a 6572 6f73 285b 322c 6c65 6e28  np.zeros([2,len(
+000121a0: 6c61 745f 6461 7461 295d 290a 2020 2020  lat_data)]).    
+000121b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000121c0: 6d61 7073 205b 302c 3a5d 203d 206c 6174  maps [0,:] = lat
+000121d0: 5f64 6174 610a 2020 2020 2020 2020 2020  _data.          
+000121e0: 2020 2020 2020 2020 2020 6d61 7073 205b            maps [
+000121f0: 312c 3a5d 203d 206c 6f6e 5f64 6174 610a  1,:] = lon_data.
+00012200: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00012210: 2020 2020 6466 5f6d 6170 203d 2070 642e      df_map = pd.
+00012220: 4461 7461 4672 616d 6528 6461 7461 3d6d  DataFrame(data=m
+00012230: 6170 732c 2069 6e64 6578 3d5b 226c 6174  aps, index=["lat
+00012240: 222c 226c 6f6e 225d 2c20 636f 6c75 6d6e  ","lon"], column
+00012250: 733d 636f 6c75 6d6e 5f6e 616d 6529 0a20  s=column_name). 
+00012260: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00012270: 2020 2064 662e 746f 5f63 7376 2874 6172     df.to_csv(tar
+00012280: 6765 745f 6e61 6d65 5f63 7376 290a 2020  get_name_csv).  
+00012290: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000122a0: 2020 6466 5f6d 6170 2e74 6f5f 6373 7628    df_map.to_csv(
+000122b0: 7461 7267 6574 5f6e 616d 655f 6d61 7029  target_name_map)
+000122c0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+000122d0: 2020 2020 2073 7461 7465 6d65 6e74 5f70       statement_p
+000122e0: 7269 6e74 203d 2073 7461 7465 6d65 6e74  rint = statement
+000122f0: 5f70 7269 6e74 202b 2027 436f 6e76 6572  _print + 'Conver
+00012300: 7469 6e67 2076 6172 6961 626c 6520 272b  ting variable '+
+00012310: 2073 656c 662e 7661 725f 6e61 6d65 735f   self.var_names_
+00012320: 7265 6d61 7070 6564 5b69 5d20 2b5c 0a20  remapped[i] +\. 
+00012330: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00012340: 2020 2027 2066 726f 6d20 7265 6d61 7070     ' from remapp
+00012350: 6564 2066 696c 6520 6f66 2027 2b74 6172  ed file of '+tar
+00012360: 6765 745f 6e61 6d65 2b27 2074 6f20 272b  get_name+' to '+
+00012370: 7461 7267 6574 5f6e 616d 655f 6373 7620  target_name_csv 
+00012380: 2b20 2720 5c6e 270a 2020 2020 2020 2020  + ' \n'.        
+00012390: 2020 2020 2020 2020 2020 2020 7374 6174              stat
+000123a0: 656d 656e 745f 7072 696e 7420 3d20 7374  ement_print = st
+000123b0: 6174 656d 656e 745f 7072 696e 7420 2b20  atement_print + 
+000123c0: 2753 6176 696e 6720 7468 6520 4944 2c20  'Saving the ID, 
+000123d0: 6c61 742c 206c 6f6e 206d 6170 2061 7420  lat, lon map at 
+000123e0: 272b 7461 7267 6574 5f6e 616d 655f 6373  '+target_name_cs
+000123f0: 762b 2027 205c 6e27 0a20 2020 2020 2020  v+ ' \n'.       
+00012400: 2020 2020 2074 696d 655f 656e 6420 3d20       time_end = 
+00012410: 6461 7465 7469 6d65 2e6e 6f77 2829 0a20  datetime.now(). 
+00012420: 2020 2020 2020 2020 2020 2074 696d 655f             time_
+00012430: 6469 6666 203d 2074 696d 655f 656e 642d  diff = time_end-
+00012440: 7469 6d65 5f73 7461 7274 0a20 2020 2020  time_start.     
+00012450: 2020 2020 2020 2073 7461 7465 6d65 6e74         statement
+00012460: 5f70 7269 6e74 203d 2073 7461 7465 6d65  _print = stateme
+00012470: 6e74 5f70 7269 6e74 202b 2027 456e 6465  nt_print + 'Ende
+00012480: 6420 6174 2064 6174 6520 616e 6420 7469  d at date and ti
+00012490: 6d65 2027 202b 2073 7472 2874 696d 655f  me ' + str(time_
+000124a0: 656e 6429 202b 2027 205c 6e27 0a20 2020  end) + ' \n'.   
+000124b0: 2020 2020 2020 2020 2073 7461 7465 6d65           stateme
+000124c0: 6e74 5f70 7269 6e74 203d 2073 7461 7465  nt_print = state
+000124d0: 6d65 6e74 5f70 7269 6e74 202b 2027 4974  ment_print + 'It
+000124e0: 2074 6f6f 6b20 272b 2073 7472 2874 696d   took '+ str(tim
+000124f0: 655f 6469 6666 2e74 6f74 616c 5f73 6563  e_diff.total_sec
+00012500: 6f6e 6473 2829 2920 2b5c 0a20 2020 2020  onds()) +\.     
+00012510: 2020 2020 2020 2027 2073 6563 6f6e 6473         ' seconds
+00012520: 2074 6f20 6669 6e69 7368 2074 6865 2072   to finish the r
+00012530: 656d 6170 7069 6e67 206f 6620 7661 7269  emapping of vari
+00012540: 6162 6c65 2873 2927 202b 2720 5c6e 272b  able(s)' +' \n'+
+00012550: 2028 272d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d   ('-------------
+00012560: 2d2d 2d2d 2d2d 2d2d 2729 0a20 2020 2020  --------').     
+00012570: 2020 2020 2020 2070 7269 6e74 2873 7461         print(sta
+00012580: 7465 6d65 6e74 5f70 7269 6e74 290a 2020  tement_print).  
+00012590: 2020 2020 2020 7072 696e 7428 272d 2d2d        print('---
+000125a0: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
+000125b0: 2d2d 2729 0a0a 2020 2020 6465 6620 5f5f  --')..    def __
+000125c0: 7765 6967 6874 6564 5f61 7665 7261 6765  weighted_average
+000125d0: 2873 656c 662c 0a20 2020 2020 2020 2020  (self,.         
+000125e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000125f0: 2020 6e63 5f6e 616d 652c 0a20 2020 2020    nc_name,.     
+00012600: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00012610: 2020 2020 2020 7461 7267 6574 5f74 696d        target_tim
+00012620: 652c 0a20 2020 2020 2020 2020 2020 2020  e,.             
+00012630: 2020 2020 2020 2020 2020 2020 2020 7661                va
+00012640: 7269 6162 6c65 5f6e 616d 652c 0a20 2020  riable_name,.   
+00012650: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00012660: 2020 2020 2020 2020 6669 6c6c 5f76 616c          fill_val
+00012670: 7565 2c0a 2020 2020 2020 2020 2020 2020  ue,.            
+00012680: 2020 2020 2020 2020 2020 2020 2020 206d                 m
+00012690: 6170 7069 6e67 5f64 6629 3a0a 2020 2020  apping_df):.    
+000126a0: 2020 2020 2222 220a 2020 2020 2020 2020      """.        
+000126b0: 4020 6175 7468 6f72 3a20 2020 2020 2020  @ author:       
+000126c0: 2020 2020 2020 2020 2020 2053 6865 7276             Sherv
+000126d0: 616e 2047 6861 7261 7269 0a20 2020 2020  an Gharari.     
+000126e0: 2020 2040 2047 6974 6875 623a 2020 2020     @ Github:    
+000126f0: 2020 2020 2020 2020 2020 2020 2020 6874                ht
+00012700: 7470 733a 2f2f 6769 7468 7562 2e63 6f6d  tps://github.com
+00012710: 2f53 6865 7276 616e 4768 6172 6172 692f  /ShervanGharari/
+00012720: 4541 5359 4d4f 5245 0a20 2020 2020 2020  EASYMORE.       
+00012730: 2040 2061 7574 686f 7227 7320 656d 6169   @ author's emai
+00012740: 6c20 6964 3a20 2020 2020 2020 7368 2e67  l id:       sh.g
+00012750: 6861 7261 7269 4067 6d61 696c 2e63 6f6d  harari@gmail.com
+00012760: 0a20 2020 2020 2020 2040 206c 6963 656e  .        @ licen
+00012770: 7365 3a20 2020 2020 2020 2020 2020 2020  se:             
+00012780: 2020 2020 474e 552d 4750 4c76 330a 2020      GNU-GPLv3.  
+00012790: 2020 2020 2020 5468 6973 2066 756e 6374        This funct
+000127a0: 696f 6e20 7265 6164 7320 7468 6520 6461  ion reads the da
+000127b0: 7461 2066 6f72 2061 2067 6976 656e 2074  ta for a given t
+000127c0: 696d 6520 616e 6420 6361 6c63 756c 6174  ime and calculat
+000127d0: 6573 2074 6865 2077 6569 6768 7465 6420  es the weighted 
+000127e0: 6176 6572 6167 650a 2020 2020 2020 2020  average.        
+000127f0: 4172 6775 6d65 6e74 730a 2020 2020 2020  Arguments.      
+00012800: 2020 2d2d 2d2d 2d2d 2d2d 2d0a 2020 2020    ---------.    
+00012810: 2020 2020 6e63 5f6e 616d 653a 2073 7472      nc_name: str
+00012820: 696e 672c 206e 616d 6520 6f66 2074 6865  ing, name of the
+00012830: 206e 6574 4344 4620 6669 6c65 0a20 2020   netCDF file.   
+00012840: 2020 2020 2074 6172 6765 745f 7469 6d65       target_time
+00012850: 3a20 7374 7269 6e67 2c0a 2020 2020 2020  : string,.      
+00012860: 2020 7661 7269 6162 6c65 5f6e 616d 653a    variable_name:
+00012870: 2073 7472 696e 672c 206e 616d 6520 6f66   string, name of
+00012880: 2076 6172 6961 626c 6520 6672 6f6d 2073   variable from s
+00012890: 6f75 7263 6520 6e65 7463 7366 2066 696c  ource netcsf fil
+000128a0: 6520 746f 2062 6520 7265 6d61 7070 6564  e to be remapped
+000128b0: 0a20 2020 2020 2020 206d 6170 7069 6e67  .        mapping
+000128c0: 5f64 663a 2070 616e 6461 7320 6461 7461  _df: pandas data
+000128d0: 6672 616d 652c 2069 6e63 6c75 6469 6e67  frame, including
+000128e0: 2074 6865 2072 6f77 2061 6e64 2063 6f6c   the row and col
+000128f0: 756d 6e20 6f66 2074 6865 2073 6f75 7263  umn of the sourc
+00012900: 6520 6461 7461 2061 6e64 2077 6569 6768  e data and weigh
+00012910: 740a 2020 2020 2020 2020 5265 7475 726e  t.        Return
+00012920: 730a 2020 2020 2020 2020 2d2d 2d2d 2d2d  s.        ------
+00012930: 2d0a 2020 2020 2020 2020 7765 6967 6874  -.        weight
+00012940: 6564 5f76 616c 7565 3a20 6120 6e75 6d70  ed_value: a nump
+00012950: 7920 6172 7261 7920 7468 6174 2068 6173  y array that has
+00012960: 2074 6865 2072 656d 6170 7065 6420 7661   the remapped va
+00012970: 6c75 6573 2066 726f 6d20 7468 6520 6e63  lues from the nc
+00012980: 2066 696c 650a 2020 2020 2020 2020 2222   file.        ""
+00012990: 220a 2020 2020 2020 2020 2320 6f70 656e  ".        # open
+000129a0: 2064 6174 6173 6574 0a20 2020 2020 2020   dataset.       
+000129b0: 2064 7320 3d20 7872 2e6f 7065 6e5f 6461   ds = xr.open_da
+000129c0: 7461 7365 7428 6e63 5f6e 616d 6529 0a20  taset(nc_name). 
+000129d0: 2020 2020 2020 2023 2072 656e 616d 6520         # rename 
+000129e0: 7469 6d65 2076 6172 6961 626c 6520 746f  time variable to
+000129f0: 2074 696d 650a 2020 2020 2020 2020 6966   time.        if
+00012a00: 2073 656c 662e 7661 725f 7469 6d65 2021   self.var_time !
+00012a10: 3d20 2774 696d 6527 3a0a 2020 2020 2020  = 'time':.      
+00012a20: 2020 2020 2020 6473 203d 2064 732e 7265        ds = ds.re
+00012a30: 6e61 6d65 287b 7365 6c66 2e76 6172 5f74  name({self.var_t
+00012a40: 696d 653a 2774 696d 6527 7d29 0a20 2020  ime:'time'}).   
+00012a50: 2020 2020 2023 2070 7265 7061 7265 6420       # prepared 
+00012a60: 7468 6520 6e75 6d70 7920 6172 7261 7920  the numpy array 
+00012a70: 666f 7220 6f75 7074 7574 0a20 2020 2020  for ouptut.     
+00012a80: 2020 2077 6569 6768 7465 645f 7661 6c75     weighted_valu
+00012a90: 6520 3d20 6e70 2e7a 6572 6f73 285b 7365  e = np.zeros([se
+00012aa0: 6c66 2e6c 656e 6774 685f 6f66 5f74 696d  lf.length_of_tim
+00012ab0: 652c 7365 6c66 2e6e 756d 6265 725f 6f66  e,self.number_of
+00012ac0: 5f74 6172 6765 745f 656c 656d 656e 7473  _target_elements
+00012ad0: 5d29 0a20 2020 2020 2020 206d 203d 2030  ]).        m = 0
+00012ae0: 2023 2063 6f75 6e74 6572 0a20 2020 2020   # counter.     
+00012af0: 2020 2066 6f72 2064 6174 6520 696e 2074     for date in t
+00012b00: 6172 6765 745f 7469 6d65 3a20 2320 6c6f  arget_time: # lo
+00012b10: 6f70 206f 7665 7220 7469 6d65 0a20 2020  op over time.   
+00012b20: 2020 2020 2020 2020 2064 735f 7465 6d70           ds_temp
+00012b30: 203d 2064 732e 7365 6c28 7469 6d65 3d64   = ds.sel(time=d
+00012b40: 6174 652e 7374 7266 7469 6d65 2822 2559  ate.strftime("%Y
+00012b50: 2d25 6d2d 2564 2025 483a 254d 3a25 5322  -%m-%d %H:%M:%S"
+00012b60: 292c 6d65 7468 6f64 3d22 6e65 6172 6573  ),method="neares
+00012b70: 7422 290a 2020 2020 2020 2020 2020 2020  t").            
+00012b80: 6461 7461 203d 206e 702e 6172 7261 7928  data = np.array(
+00012b90: 6473 5f74 656d 705b 7661 7269 6162 6c65  ds_temp[variable
+00012ba0: 5f6e 616d 655d 290a 2020 2020 2020 2020  _name]).        
+00012bb0: 2020 2020 6461 7461 203d 206e 702e 7371      data = np.sq
+00012bc0: 7565 657a 6528 6461 7461 290a 2020 2020  ueeze(data).    
+00012bd0: 2020 2020 2020 2020 2320 6765 7420 7661          # get va
+00012be0: 6c75 6573 2066 726f 6d20 7468 6520 726f  lues from the ro
+00012bf0: 7773 2061 6e64 2063 6f6c 7320 616e 6420  ws and cols and 
+00012c00: 7061 7373 2074 6f20 6e70 2064 6174 6120  pass to np data 
+00012c10: 6172 7261 790a 2020 2020 2020 2020 2020  array.          
+00012c20: 2020 6966 2073 656c 662e 6361 7365 203d    if self.case =
+00012c30: 3d31 206f 7220 7365 6c66 2e63 6173 6520  =1 or self.case 
+00012c40: 3d3d 323a 0a20 2020 2020 2020 2020 2020  ==2:.           
+00012c50: 2020 2020 2076 616c 7565 7320 3d20 6461       values = da
+00012c60: 7461 205b 7365 6c66 2e72 6f77 732c 7365  ta [self.rows,se
+00012c70: 6c66 2e63 6f6c 735d 0a20 2020 2020 2020  lf.cols].       
+00012c80: 2020 2020 2069 6620 7365 6c66 2e63 6173       if self.cas
+00012c90: 6520 3d3d 333a 0a20 2020 2020 2020 2020  e ==3:.         
+00012ca0: 2020 2020 2020 2076 616c 7565 7320 3d20         values = 
+00012cb0: 6461 7461 205b 7365 6c66 2e72 6f77 735d  data [self.rows]
+00012cc0: 0a20 2020 2020 2020 2020 2020 2076 616c  .            val
+00012cd0: 7565 7320 3d20 6e70 2e61 7272 6179 2876  ues = np.array(v
+00012ce0: 616c 7565 7329 0a20 2020 2020 2020 2020  alues).         
+00012cf0: 2020 2023 2061 6464 2076 616c 7565 7320     # add values 
+00012d00: 746f 2064 6174 6120 6672 616d 650a 2020  to data frame.  
+00012d10: 2020 2020 2020 2020 2020 6d61 7070 696e            mappin
+00012d20: 675f 6466 5b27 7661 6c75 6573 275d 203d  g_df['values'] =
+00012d30: 2076 616c 7565 730a 2020 2020 2020 2020   values.        
+00012d40: 2020 2020 2320 7265 706c 6163 6520 6e6f      # replace no
+00012d50: 6e2d 6e75 6d65 7269 6320 6f72 206e 702e  n-numeric or np.
+00012d60: 6e61 6e20 7769 7468 204e 614e 0a20 2020  nan with NaN.   
+00012d70: 2020 2020 2020 2020 206d 6170 7069 6e67           mapping
+00012d80: 5f64 665b 2776 616c 7565 7327 5d20 3d20  _df['values'] = 
+00012d90: 7064 2e74 6f5f 6e75 6d65 7269 6328 6d61  pd.to_numeric(ma
+00012da0: 7070 696e 675f 6466 5b27 7661 6c75 6573  pping_df['values
+00012db0: 275d 2c20 6572 726f 7273 3d27 636f 6572  '], errors='coer
+00012dc0: 6365 2729 0a20 2020 2020 2020 2020 2020  ce').           
+00012dd0: 2023 2069 6620 7468 6572 6520 6172 6520   # if there are 
+00012de0: 4e61 4e20 7661 6c75 6573 2074 6865 6e20  NaN values then 
+00012df0: 7265 7363 616c 6520 7468 6520 7765 6967  rescale the weig
+00012e00: 6874 7320 6966 206e 6565 6465 640a 2020  hts if needed.  
+00012e10: 2020 2020 2020 2020 2020 7468 6572 655f            there_
+00012e20: 6973 5f6e 616e 203d 2028 6d61 7070 696e  is_nan = (mappin
+00012e30: 675f 6466 5b27 7661 6c75 6573 275d 2e69  g_df['values'].i
+00012e40: 736e 6128 292e 616e 7928 2920 6f72 206d  sna().any() or m
+00012e50: 6170 7069 6e67 5f64 665b 2777 6569 6768  apping_df['weigh
+00012e60: 7427 5d2e 6973 6e61 2829 2e61 6e79 2829  t'].isna().any()
+00012e70: 290a 2020 2020 2020 2020 2020 2020 6966  ).            if
+00012e80: 2073 656c 662e 7265 7363 616c 6564 7765   self.rescaledwe
+00012e90: 6967 6874 7320 616e 6420 7468 6572 655f  ights and there_
+00012ea0: 6973 5f6e 616e 3a0a 2020 2020 2020 2020  is_nan:.        
+00012eb0: 2020 2020 2020 2020 6964 7820 3d20 6d61          idx = ma
+00012ec0: 7070 696e 675f 6466 5b7e 6d61 7070 696e  pping_df[~mappin
+00012ed0: 675f 6466 5b27 7661 6c75 6573 275d 2e69  g_df['values'].i
+00012ee0: 736e 6128 2920 2620 7e6d 6170 7069 6e67  sna() & ~mapping
+00012ef0: 5f64 665b 2777 6569 6768 7427 5d2e 6973  _df['weight'].is
+00012f00: 6e61 2829 5d2e 696e 6465 780a 2020 2020  na()].index.    
+00012f10: 2020 2020 2020 2020 2020 2020 6d61 7070              mapp
+00012f20: 696e 675f 6466 5b27 726f 7727 5d20 3d20  ing_df['row'] = 
+00012f30: 6e70 2e6e 616e 3b20 6d61 7070 696e 675f  np.nan; mapping_
+00012f40: 6466 2e6c 6f63 5b69 6478 2c27 726f 7727  df.loc[idx,'row'
+00012f50: 5d20 3d20 3120 2320 3120 666f 7220 7468  ] = 1 # 1 for th
+00012f60: 6520 6f6e 6365 2077 6974 6820 7661 6c75  e once with valu
+00012f70: 6573 2069 6e20 626f 7468 2076 616c 7565  es in both value
+00012f80: 7320 616e 6420 7765 6967 6874 2063 6f6c  s and weight col
+00012f90: 756d 6e73 0a20 2020 2020 2020 2020 2020  umns.           
+00012fa0: 2020 2020 206d 6170 7069 6e67 5f64 665b       mapping_df[
+00012fb0: 2777 6569 6768 745f 726f 7727 5d20 3d20  'weight_row'] = 
+00012fc0: 6d61 7070 696e 675f 6466 5b27 7765 6967  mapping_df['weig
+00012fd0: 6874 275d 202a 206d 6170 7069 6e67 5f64  ht'] * mapping_d
+00012fe0: 665b 2772 6f77 275d 0a20 2020 2020 2020  f['row'].       
+00012ff0: 2020 2020 2020 2020 206d 6170 7069 6e67           mapping
+00013000: 5f64 665b 2776 616c 7565 735f 726f 7727  _df['values_row'
+00013010: 5d20 3d20 6d61 7070 696e 675f 6466 5b27  ] = mapping_df['
+00013020: 7661 6c75 6573 275d 202a 206d 6170 7069  values'] * mappi
+00013030: 6e67 5f64 665b 2772 6f77 275d 0a20 2020  ng_df['row'].   
+00013040: 2020 2020 2020 2020 2020 2020 2023 2072               # r
+00013050: 6573 6361 6c69 6e67 2074 6865 2077 6569  escaling the wei
+00013060: 6768 740a 2020 2020 2020 2020 2020 2020  ght.            
+00013070: 2020 2020 6d61 7070 696e 675f 6466 5b27      mapping_df['
+00013080: 7765 6967 6874 5f72 6f77 5f73 756d 275d  weight_row_sum']
+00013090: 2020 3d20 6d61 7070 696e 675f 6466 5b27    = mapping_df['
+000130a0: 6f72 6465 725f 7427 5d2e 6d61 7028 6d61  order_t'].map(ma
+000130b0: 7070 696e 675f 6466 2e67 726f 7570 6279  pping_df.groupby
+000130c0: 2827 6f72 6465 725f 7427 295b 2777 6569  ('order_t')['wei
+000130d0: 6768 745f 726f 7727 5d2e 7375 6d28 2929  ght_row'].sum())
+000130e0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+000130f0: 206d 6170 7069 6e67 5f64 665b 2777 6569   mapping_df['wei
+00013100: 6768 745f 7265 7363 616c 6564 275d 203d  ght_rescaled'] =
+00013110: 206d 6170 7069 6e67 5f64 665b 2777 6569   mapping_df['wei
+00013120: 6768 7427 5d20 2f20 6d61 7070 696e 675f  ght'] / mapping_
+00013130: 6466 5b27 7765 6967 6874 5f72 6f77 5f73  df['weight_row_s
+00013140: 756d 275d 2023 2072 6573 6361 6c65 6420  um'] # rescaled 
+00013150: 7765 6967 6874 0a20 2020 2020 2020 2020  weight.         
+00013160: 2020 2020 2020 2069 6478 203d 206d 6170         idx = map
+00013170: 7069 6e67 5f64 665b 6d61 7070 696e 675f  ping_df[mapping_
+00013180: 6466 5b27 7765 6967 6874 5f72 6573 6361  df['weight_resca
+00013190: 6c65 6427 5d20 3e20 312e 305d 2e69 6e64  led'] > 1.0].ind
+000131a0: 6578 0a20 2020 2020 2020 2020 2020 2020  ex.             
+000131b0: 2020 206d 6170 7069 6e67 5f64 662e 6c6f     mapping_df.lo
+000131c0: 635b 6964 782c 2777 6569 6768 745f 7265  c[idx,'weight_re
+000131d0: 7363 616c 6564 275d 203d 206e 702e 6e61  scaled'] = np.na
+000131e0: 6e20 2320 6966 2074 6865 7265 2069 7320  n # if there is 
+000131f0: 696e 6620 6f72 2064 6576 6973 696f 6e20  inf or devision 
+00013200: 6279 207a 6572 6f20 7265 706c 6163 6520  by zero replace 
+00013210: 7769 7468 206e 616e 0a20 2020 2020 2020  with nan.       
+00013220: 2020 2020 2065 6c73 653a 0a20 2020 2020       else:.     
+00013230: 2020 2020 2020 2020 2020 206d 6170 7069             mappi
+00013240: 6e67 5f64 665b 2777 6569 6768 745f 7265  ng_df['weight_re
+00013250: 7363 616c 6564 275d 203d 206d 6170 7069  scaled'] = mappi
+00013260: 6e67 5f64 665b 2777 6569 6768 7427 5d0a  ng_df['weight'].
+00013270: 2020 2020 2020 2020 2020 2020 6d61 7070              mapp
+00013280: 696e 675f 6466 5b27 7661 6c75 6573 5f77  ing_df['values_w
+00013290: 275d 2020 203d 206d 6170 7069 6e67 5f64  ']   = mapping_d
+000132a0: 665b 2776 616c 7565 7327 5d20 2a20 6d61  f['values'] * ma
+000132b0: 7070 696e 675f 6466 5b27 7765 6967 6874  pping_df['weight
+000132c0: 5f72 6573 6361 6c65 6427 5d0a 2020 2020  _rescaled'].    
+000132d0: 2020 2020 2020 2020 6466 5f74 656d 7020          df_temp 
+000132e0: 3d20 6d61 7070 696e 675f 6466 2e67 726f  = mapping_df.gro
+000132f0: 7570 6279 285b 276f 7264 6572 5f74 275d  upby(['order_t']
+00013300: 2c61 735f 696e 6465 783d 4661 6c73 6529  ,as_index=False)
+00013310: 2e61 6767 287b 2776 616c 7565 735f 7727  .agg({'values_w'
+00013320: 3a20 2773 756d 277d 290a 2020 2020 2020  : 'sum'}).      
+00013330: 2020 2020 2020 6966 2074 6865 7265 5f69        if there_i
+00013340: 735f 6e61 6e3a 0a20 2020 2020 2020 2020  s_nan:.         
+00013350: 2020 2020 2020 2069 6478 2020 2020 2020         idx      
+00013360: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00013370: 3d20 6d61 7070 696e 675f 6466 5b7e 6d61  = mapping_df[~ma
+00013380: 7070 696e 675f 6466 5b27 7661 6c75 6573  pping_df['values
+00013390: 5f77 275d 2e69 736e 6128 295d 2e69 6e64  _w'].isna()].ind
+000133a0: 6578 0a20 2020 2020 2020 2020 2020 2020  ex.             
+000133b0: 2020 206d 6170 7069 6e67 5f64 665f 736c     mapping_df_sl
+000133c0: 6963 6520 2020 2020 2020 2020 3d20 6d61  ice         = ma
+000133d0: 7070 696e 675f 6466 2e6c 6f63 5b69 6478  pping_df.loc[idx
+000133e0: 5d2e 636f 7079 2829 0a20 2020 2020 2020  ].copy().       
+000133f0: 2020 2020 2020 2020 206f 7264 6572 5f74           order_t
+00013400: 5f49 4473 5f6e 6f74 5f61 6c6c 5f6e 616e  _IDs_not_all_nan
+00013410: 2020 3d20 6e70 2e75 6e69 7175 6528 6d61    = np.unique(ma
+00013420: 7070 696e 675f 6466 5f73 6c69 6365 5b27  pping_df_slice['
+00013430: 6f72 6465 725f 7427 5d29 0a20 2020 2020  order_t']).     
+00013440: 2020 2020 2020 2020 2020 206f 7264 6572             order
+00013450: 5f74 5f49 4473 5f61 6c6c 2020 2020 2020  _t_IDs_all      
+00013460: 2020 2020 3d20 6e70 2e75 6e69 7175 6528      = np.unique(
+00013470: 6d61 7070 696e 675f 6466 5b27 6f72 6465  mapping_df['orde
+00013480: 725f 7427 5d29 0a20 2020 2020 2020 2020  r_t']).         
+00013490: 2020 2020 2020 206f 7264 6572 5f74 5f49         order_t_I
+000134a0: 4473 5f61 6c6c 5f6e 616e 2020 2020 2020  Ds_all_nan      
+000134b0: 3d20 6e70 2e73 6574 6469 6666 3164 286f  = np.setdiff1d(o
+000134c0: 7264 6572 5f74 5f49 4473 5f61 6c6c 2c20  rder_t_IDs_all, 
+000134d0: 6f72 6465 725f 745f 4944 735f 6e6f 745f  order_t_IDs_not_
+000134e0: 616c 6c5f 6e61 6e29 2e66 6c61 7474 656e  all_nan).flatten
+000134f0: 2829 0a20 2020 2020 2020 2020 2020 2020  ().             
+00013500: 2020 2023 2070 7574 2062 6163 6b20 4e61     # put back Na
+00013510: 4e20 666f 7220 7468 6520 6f72 6465 725f  N for the order_
+00013520: 7420 7468 6174 2061 7265 2061 6c6c 204e  t that are all N
+00013530: 614e 2076 616c 7565 730a 2020 2020 2020  aN values.      
+00013540: 2020 2020 2020 2020 2020 6964 7820 3d20            idx = 
+00013550: 6466 5f74 656d 705b 6466 5f74 656d 705b  df_temp[df_temp[
+00013560: 276f 7264 6572 5f74 275d 2e69 7369 6e28  'order_t'].isin(
+00013570: 6f72 6465 725f 745f 4944 735f 616c 6c5f  order_t_IDs_all_
+00013580: 6e61 6e29 5d2e 696e 6465 780a 2020 2020  nan)].index.    
+00013590: 2020 2020 2020 2020 2020 2020 6466 5f74              df_t
+000135a0: 656d 705f 736c 6963 6520 3d20 6466 5f74  emp_slice = df_t
+000135b0: 656d 702e 6c6f 635b 6964 785d 2e63 6f70  emp.loc[idx].cop
+000135c0: 7928 290a 2020 2020 2020 2020 2020 2020  y().            
+000135d0: 2020 2020 6966 206e 6f74 2064 665f 7465      if not df_te
+000135e0: 6d70 5f73 6c69 6365 2e65 6d70 7479 3a0a  mp_slice.empty:.
+000135f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00013600: 2020 2020 6466 5f74 656d 702e 6c6f 635b      df_temp.loc[
+00013610: 6466 5f74 656d 705f 736c 6963 652e 696e  df_temp_slice.in
+00013620: 6465 782c 2776 616c 7565 735f 7727 5d20  dex,'values_w'] 
+00013630: 3d20 6e70 2e6e 616e 0a20 2020 2020 2020  = np.nan.       
+00013640: 2020 2020 2020 2020 2064 665f 7465 6d70           df_temp
+00013650: 5b27 7661 6c75 6573 5f77 275d 2e66 696c  ['values_w'].fil
+00013660: 6c6e 6128 6669 6c6c 5f76 616c 7565 2c20  lna(fill_value, 
+00013670: 696e 706c 6163 653d 5472 7565 290a 2020  inplace=True).  
+00013680: 2020 2020 2020 2020 2020 7765 6967 6874            weight
+00013690: 6564 5f76 616c 7565 205b 6d2c 3a5d 203d  ed_value [m,:] =
+000136a0: 206e 702e 6172 7261 7928 6466 5f74 656d   np.array(df_tem
+000136b0: 705b 2776 616c 7565 735f 7727 5d29 0a20  p['values_w']). 
+000136c0: 2020 2020 2020 2020 2020 206d 202b 3d20             m += 
+000136d0: 310a 2020 2020 2020 2020 7265 7475 726e  1.        return
+000136e0: 2077 6569 6768 7465 645f 7661 6c75 650a   weighted_value.
+000136f0: 0a0a 2020 2020 6465 6620 7368 705f 6c6f  ..    def shp_lo
+00013700: 6e5f 636f 7272 6563 7469 6f6e 2028 7365  n_correction (se
+00013710: 6c66 2c0a 2020 2020 2020 2020 2020 2020  lf,.            
+00013720: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00013730: 7368 7029 3a20 2320 7468 6520 6e61 6d65  shp): # the name
+00013740: 206f 6620 5348 5020 696e 636c 7564 696e   of SHP includin
+00013750: 6720 7061 7468 2077 6974 6820 5747 5331  g path with WGS1
+00013760: 3938 3420 7072 6f6a 6563 7469 6f6e 0a20  984 projection. 
+00013770: 2020 2020 2020 2022 2222 0a20 2020 2020         """.     
+00013780: 2020 2040 2061 7574 686f 723a 2020 2020     @ author:    
+00013790: 2020 2020 2020 2020 2020 2020 2020 5368                Sh
+000137a0: 6572 7661 6e20 4768 6172 6172 690a 2020  ervan Gharari.  
+000137b0: 2020 2020 2020 4020 4769 7468 7562 3a20        @ Github: 
+000137c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000137d0: 2068 7474 7073 3a2f 2f67 6974 6875 622e   https://github.
+000137e0: 636f 6d2f 5368 6572 7661 6e47 6861 7261  com/ShervanGhara
+000137f0: 7269 2f45 4153 594d 4f52 450a 2020 2020  ri/EASYMORE.    
+00013800: 2020 2020 4020 6175 7468 6f72 2773 2065      @ author's e
+00013810: 6d61 696c 2069 643a 2020 2020 2020 2073  mail id:       s
+00013820: 682e 6768 6172 6172 6940 676d 6169 6c2e  h.gharari@gmail.
+00013830: 636f 6d0a 2020 2020 2020 2020 4020 6c69  com.        @ li
+00013840: 6365 6e73 653a 2020 2020 2020 2020 2020  cense:          
+00013850: 2020 2020 2020 2047 4e55 2d47 504c 7633         GNU-GPLv3
+00013860: 0a20 2020 2020 2020 2054 6869 7320 6675  .        This fu
+00013870: 6e63 7469 6f6e 2072 6561 6473 2061 2073  nction reads a s
+00013880: 6861 7065 6669 6c65 2061 6e64 2066 6f72  hapefile and for
+00013890: 206c 6f6e 6769 7475 6465 206f 6620 6d6f   longitude of mo
+000138a0: 6465 6c20 7468 616e 2031 3830 2069 7420  del than 180 it 
+000138b0: 636f 7272 6563 7420 6974 2074 6f20 6120  correct it to a 
+000138c0: 6672 616d 6520 6f66 202d 3138 3020 746f  frame of -180 to
+000138d0: 2031 3830 0a20 2020 2020 2020 202d 2d2d   180.        ---
+000138e0: 2d2d 2d2d 2d2d 0a20 2020 2020 2020 2073  ------.        s
+000138f0: 6870 3a20 6765 6f70 616e 6461 7320 7368  hp: geopandas sh
+00013900: 6170 6566 696c 650a 2020 2020 2020 2020  apefile.        
+00013910: 5265 7475 726e 730a 2020 2020 2020 2020  Returns.        
+00013920: 2d2d 2d2d 2d2d 2d0a 2020 2020 2020 2020  -------.        
+00013930: 7368 705f 6669 6e61 6c3a 2067 656f 7061  shp_final: geopa
+00013940: 6e64 6173 2073 6861 7065 6669 6c65 2063  ndas shapefile c
+00013950: 6f72 7265 6374 6564 2069 6e20 7468 6520  orrected in the 
+00013960: 6672 616d 6520 6f66 202d 3138 3020 746f  frame of -180 to
+00013970: 2031 3830 0a20 2020 2020 2020 2022 2222   180.        """
+00013980: 0a20 2020 2020 2020 2023 206c 6f61 6469  .        # loadi
+00013990: 6e67 2074 6865 206e 6565 6465 6420 7061  ng the needed pa
+000139a0: 636b 6167 6564 0a20 2020 2020 2020 2069  ckaged.        i
+000139b0: 6d70 6f72 7420 6765 6f70 616e 6461 7320  mport geopandas 
+000139c0: 6173 2067 7064 0a20 2020 2020 2020 2069  as gpd.        i
+000139d0: 6d70 6f72 7420 7061 6e64 6173 2061 7320  mport pandas as 
+000139e0: 7064 0a20 2020 2020 2020 2066 726f 6d20  pd.        from 
+000139f0: 2020 7368 6170 656c 792e 6765 6f6d 6574    shapely.geomet
+00013a00: 7279 2069 6d70 6f72 7420 506f 6c79 676f  ry import Polygo
+00013a10: 6e0a 2020 2020 2020 2020 696d 706f 7274  n.        import
+00013a20: 2073 6861 7065 6c79 0a20 2020 2020 2020   shapely.       
+00013a30: 2023 2069 6620 6e6f 2063 7273 2073 6574   # if no crs set
+00013a40: 2074 6f20 6570 7367 3a34 3332 360a 2020   to epsg:4326.  
+00013a50: 2020 2020 2020 6966 206e 6f74 2073 6870        if not shp
+00013a60: 2e63 7273 3a0a 2020 2020 2020 2020 2020  .crs:.          
+00013a70: 2020 7072 696e 7428 2769 6e73 6964 6520    print('inside 
+00013a80: 7368 705f 6c6f 6e5f 636f 7272 6563 7469  shp_lon_correcti
+00013a90: 6f6e 2c20 6e6f 2063 7273 2069 7320 7072  on, no crs is pr
+00013aa0: 6f76 6964 6564 2066 6f72 2074 6865 2073  ovided for the s
+00013ab0: 6861 7065 6669 6c65 3b20 4541 5359 4d4f  hapefile; EASYMO
+00013ac0: 5245 2077 696c 6c20 616c 6c6f 6361 7465  RE will allocate
+00013ad0: 2057 4753 3834 205c 0a74 6f20 636f 7272   WGS84 \.to corr
+00013ae0: 6563 7420 666f 7220 6c6f 6e20 6162 6f76  ect for lon abov
+00013af0: 6520 3138 3027 290a 2020 2020 2020 2020  e 180').        
+00013b00: 2020 2020 7368 7020 3d20 7368 702e 7365      shp = shp.se
+00013b10: 745f 6372 7328 2265 7073 673a 3433 3236  t_crs("epsg:4326
+00013b20: 2229 0a20 2020 2020 2020 2023 0a20 2020  ").        #.   
+00013b30: 2020 2020 2063 6f6c 5f6e 616d 6573 203d       col_names =
+00013b40: 2073 6870 2e63 6f6c 756d 6e73 2e74 6f5f   shp.columns.to_
+00013b50: 6c69 7374 2829 0a20 2020 2020 2020 2063  list().        c
+00013b60: 6f6c 5f6e 616d 6573 2e72 656d 6f76 6528  ol_names.remove(
+00013b70: 2767 656f 6d65 7472 7927 290a 2020 2020  'geometry').    
+00013b80: 2020 2020 6466 5f61 7474 7269 6275 7465      df_attribute
+00013b90: 203d 2070 642e 4461 7461 4672 616d 6528   = pd.DataFrame(
+00013ba0: 290a 2020 2020 2020 2020 6966 2063 6f6c  ).        if col
+00013bb0: 5f6e 616d 6573 3a0a 2020 2020 2020 2020  _names:.        
+00013bc0: 2020 2020 6466 5f61 7474 7269 6275 7465      df_attribute
+00013bd0: 203d 2073 6870 2e64 726f 7028 636f 6c75   = shp.drop(colu
+00013be0: 6d6e 7320 3d20 2767 656f 6d65 7472 7927  mns = 'geometry'
+00013bf0: 290a 2020 2020 2020 2020 7368 7020 3d20  ).        shp = 
+00013c00: 7368 702e 6472 6f70 2863 6f6c 756d 6e73  shp.drop(columns
+00013c10: 203d 2063 6f6c 5f6e 616d 6573 290a 2020   = col_names).  
+00013c20: 2020 2020 2020 7368 705b 2749 4427 5d20        shp['ID'] 
+00013c30: 3d20 6e70 2e61 7261 6e67 6528 6c65 6e28  = np.arange(len(
+00013c40: 7368 7029 292b 310a 2020 2020 2020 2020  shp))+1.        
+00013c50: 2320 6765 7420 7468 6520 6d61 7869 6d75  # get the maximu
+00013c60: 6d20 616e 6420 6d69 6e69 6d75 6d20 626f  m and minimum bo
+00013c70: 756e 6420 6f66 2074 6865 2074 6f74 616c  und of the total
+00013c80: 2062 6f75 6e64 0a20 2020 2020 2020 206d   bound.        m
+00013c90: 696e 5f6c 6f6e 2c20 6d69 6e5f 6c61 742c  in_lon, min_lat,
+00013ca0: 206d 6178 5f6c 6f6e 2c20 6d61 785f 6c61   max_lon, max_la
+00013cb0: 7420 3d20 7368 702e 746f 7461 6c5f 626f  t = shp.total_bo
+00013cc0: 756e 6473 0a20 2020 2020 2020 206d 696e  unds.        min
+00013cd0: 5f6c 6f6e 203d 206d 696e 5f6c 6f6e 202b  _lon = min_lon +
+00013ce0: 2073 656c 662e 746f 6c65 7261 6e63 650a   self.tolerance.
+00013cf0: 2020 2020 2020 2020 6d61 785f 6c6f 6e20          max_lon 
+00013d00: 3d20 6d61 785f 6c6f 6e20 2d20 7365 6c66  = max_lon - self
+00013d10: 2e74 6f6c 6572 616e 6365 0a20 2020 2020  .tolerance.     
+00013d20: 2020 2073 6870 5f69 6e74 3120 3d20 7064     shp_int1 = pd
+00013d30: 2e44 6174 6146 7261 6d65 2829 0a20 2020  .DataFrame().   
+00013d40: 2020 2020 2073 6870 5f69 6e74 3220 3d20       shp_int2 = 
+00013d50: 7064 2e44 6174 6146 7261 6d65 2829 0a20  pd.DataFrame(). 
+00013d60: 2020 2020 2020 2069 6620 2833 3630 203c         if (360 <
+00013d70: 206d 6178 5f6c 6f6e 2920 616e 6420 286d   max_lon) and (m
+00013d80: 696e 5f6c 6f6e 3c30 293a 0a20 2020 2020  in_lon<0):.     
+00013d90: 2020 2020 2020 2073 7973 2e65 7869 7428         sys.exit(
+00013da0: 2754 6865 206d 696e 696d 756d 206c 6f6e  'The minimum lon
+00013db0: 6769 7475 6465 2069 7320 6869 6768 6572  gitude is higher
+00013dc0: 2074 6861 6e20 3336 3020 7768 696c 6520   than 360 while 
+00013dd0: 7468 6520 6d69 6e69 6d75 6d20 6c6f 6e67  the minimum long
+00013de0: 6974 7564 6520 6973 206c 6f77 6572 2074  itude is lower t
+00013df0: 6861 7420 3027 290a 2020 2020 2020 2020  hat 0').        
+00013e00: 6966 2028 6d61 785f 6c6f 6e20 3c20 3138  if (max_lon < 18
+00013e10: 3029 2061 6e64 2028 2d31 3830 203c 206d  0) and (-180 < m
+00013e20: 696e 5f6c 6f6e 293a 0a20 2020 2020 2020  in_lon):.       
+00013e30: 2020 2020 2070 7269 6e74 2827 4541 5359       print('EASY
+00013e40: 4d4f 5245 2064 6574 6563 7473 2074 6861  MORE detects tha
+00013e50: 7420 7368 6170 6566 696c 6520 6c6f 6e67  t shapefile long
+00013e60: 6974 7564 6520 6973 2062 6574 7765 656e  itude is between
+00013e70: 202d 3138 3020 616e 6420 3138 302c 206e   -180 and 180, n
+00013e80: 6f20 636f 7272 6563 7469 6f6e 2069 7320  o correction is 
+00013e90: 7065 7266 6f72 6d65 6427 290a 2020 2020  performed').    
+00013ea0: 2020 2020 2020 2020 2320 7368 6170 6566          # shapef
+00013eb0: 696c 6520 7769 7468 202d 3138 3020 746f  ile with -180 to
+00013ec0: 2031 3830 206c 6f6e 0a20 2020 2020 2020   180 lon.       
+00013ed0: 2020 2020 2067 6466 3220 3d20 7b27 6765       gdf2 = {'ge
+00013ee0: 6f6d 6574 7279 273a 205b 506f 6c79 676f  ometry': [Polygo
+00013ef0: 6e28 5b28 202d 3138 302e 302b 7365 6c66  n([( -180.0+self
+00013f00: 2e74 6f6c 6572 616e 6365 2c20 2d39 302e  .tolerance, -90.
+00013f10: 302b 7365 6c66 2e74 6f6c 6572 616e 6365  0+self.tolerance
+00013f20: 292c 2028 2d31 3830 2e30 2b73 656c 662e  ), (-180.0+self.
+00013f30: 746f 6c65 7261 6e63 652c 2020 3930 2e30  tolerance,  90.0
+00013f40: 2d73 656c 662e 746f 6c65 7261 6e63 6529  -self.tolerance)
+00013f50: 2c5c 0a20 2020 2020 2020 2020 2020 2020  ,\.             
+00013f60: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00013f70: 2020 2020 2020 2020 2020 2020 2028 2020               (  
+00013f80: 3138 302e 302d 7365 6c66 2e74 6f6c 6572  180.0-self.toler
+00013f90: 616e 6365 2c20 2039 302e 302d 7365 6c66  ance,  90.0-self
+00013fa0: 2e74 6f6c 6572 616e 6365 292c 2028 2031  .tolerance), ( 1
+00013fb0: 3830 2e30 2d73 656c 662e 746f 6c65 7261  80.0-self.tolera
+00013fc0: 6e63 652c 202d 3930 2e30 2b73 656c 662e  nce, -90.0+self.
+00013fd0: 746f 6c65 7261 6e63 6529 5d29 5d7d 0a20  tolerance)])]}. 
+00013fe0: 2020 2020 2020 2020 2020 2067 6466 3220             gdf2 
+00013ff0: 3d20 6770 642e 4765 6f44 6174 6146 7261  = gpd.GeoDataFra
+00014000: 6d65 2867 6466 3229 0a20 2020 2020 2020  me(gdf2).       
+00014010: 2020 2020 2067 6466 3220 3d20 6764 6632       gdf2 = gdf2
+00014020: 2e73 6574 5f63 7273 2028 2265 7073 673a  .set_crs ("epsg:
+00014030: 3433 3236 2229 0a20 2020 2020 2020 2020  4326").         
+00014040: 2020 2077 6172 6e69 6e67 732e 7369 6d70     warnings.simp
+00014050: 6c65 6669 6c74 6572 2827 6967 6e6f 7265  lefilter('ignore
+00014060: 2729 0a20 2020 2020 2020 2020 2020 2073  ').            s
+00014070: 6870 5f69 6e74 3220 3d20 7365 6c66 2e69  hp_int2 = self.i
+00014080: 6e74 6572 7365 6374 696f 6e5f 7368 7028  ntersection_shp(
+00014090: 7368 702c 2067 6466 3229 0a20 2020 2020  shp, gdf2).     
+000140a0: 2020 2020 2020 2077 6172 6e69 6e67 732e         warnings.
+000140b0: 7369 6d70 6c65 6669 6c74 6572 2827 6465  simplefilter('de
+000140c0: 6661 756c 7427 290a 2020 2020 2020 2020  fault').        
+000140d0: 2020 2020 636f 6c5f 6e61 6d65 7320 3d20      col_names = 
+000140e0: 7368 705f 696e 7432 2e63 6f6c 756d 6e73  shp_int2.columns
+000140f0: 0a20 2020 2020 2020 2020 2020 2063 6f6c  .            col
+00014100: 5f6e 616d 6573 203d 206c 6973 7428 6669  _names = list(fi
+00014110: 6c74 6572 286c 616d 6264 6120 783a 2078  lter(lambda x: x
+00014120: 2e73 7461 7274 7377 6974 6828 2753 5f31  .startswith('S_1
+00014130: 5f27 292c 2063 6f6c 5f6e 616d 6573 2929  _'), col_names))
+00014140: 0a20 2020 2020 2020 2020 2020 2063 6f6c  .            col
+00014150: 5f6e 616d 6573 2e61 7070 656e 6428 2767  _names.append('g
+00014160: 656f 6d65 7472 7927 290a 2020 2020 2020  eometry').      
+00014170: 2020 2020 2020 7368 705f 696e 7432 203d        shp_int2 =
+00014180: 2073 6870 5f69 6e74 325b 7368 705f 696e   shp_int2[shp_in
+00014190: 7432 2e63 6f6c 756d 6e73 2e69 6e74 6572  t2.columns.inter
+000141a0: 7365 6374 696f 6e28 636f 6c5f 6e61 6d65  section(col_name
+000141b0: 7329 5d0a 2020 2020 2020 2020 2020 2020  s)].            
+000141c0: 636f 6c5f 6e61 6d65 732e 7265 6d6f 7665  col_names.remove
+000141d0: 2827 6765 6f6d 6574 7279 2729 0a20 2020  ('geometry').   
+000141e0: 2020 2020 2020 2020 2023 2072 656e 616d           # renam
+000141f0: 6520 636f 6c75 6d6e 7320 7769 7468 6f75  e columns withou
+00014200: 7420 535f 315f 0a20 2020 2020 2020 2020  t S_1_.         
+00014210: 2020 2066 6f72 2063 6f6c 5f6e 616d 6520     for col_name 
+00014220: 696e 2063 6f6c 5f6e 616d 6573 3a0a 2020  in col_names:.  
+00014230: 2020 2020 2020 2020 2020 2020 2020 636f                co
+00014240: 6c5f 6e61 6d65 203d 2073 7472 2863 6f6c  l_name = str(col
+00014250: 5f6e 616d 6529 0a20 2020 2020 2020 2020  _name).         
+00014260: 2020 2020 2020 2063 6f6c 5f6e 616d 655f         col_name_
+00014270: 6e20 3d20 636f 6c5f 6e61 6d65 2e72 6570  n = col_name.rep
+00014280: 6c61 6365 2822 535f 315f 222c 2222 293b  lace("S_1_","");
+00014290: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+000142a0: 2073 6870 5f69 6e74 3220 3d20 7368 705f   shp_int2 = shp_
+000142b0: 696e 7432 2e72 656e 616d 6528 636f 6c75  int2.rename(colu
+000142c0: 6d6e 733d 7b63 6f6c 5f6e 616d 653a 2063  mns={col_name: c
+000142d0: 6f6c 5f6e 616d 655f 6e7d 290a 2020 2020  ol_name_n}).    
+000142e0: 2020 2020 656c 7365 3a0a 2020 2020 2020      else:.      
+000142f0: 2020 2020 2020 2320 696e 7465 7273 6563        # intersec
+00014300: 7469 6f6e 2069 6620 7368 7020 6861 7320  tion if shp has 
+00014310: 6120 6c61 7267 6572 206c 6f6e 206f 6620  a larger lon of 
+00014320: 3138 3020 736f 2069 7420 6973 2030 2074  180 so it is 0 t
+00014330: 6f20 3336 302c 0a20 2020 2020 2020 2020  o 360,.         
+00014340: 2020 2069 6620 2831 3830 203c 206d 6178     if (180 < max
+00014350: 5f6c 6f6e 2920 616e 6420 282d 3138 3020  _lon) and (-180 
+00014360: 3c20 6d69 6e5f 6c6f 6e29 3a0a 2020 2020  < min_lon):.    
+00014370: 2020 2020 2020 2020 2020 2020 7072 696e              prin
+00014380: 7428 2745 4153 594d 4f52 4520 6465 7465  t('EASYMORE dete
+00014390: 6374 7320 7468 6174 2073 6861 7065 6669  cts that shapefi
+000143a0: 6c65 206c 6f6e 6769 7475 6465 2069 7320  le longitude is 
+000143b0: 6265 7477 6565 6e20 3020 616e 6420 3336  between 0 and 36
+000143c0: 302c 2063 6f72 7265 6374 696f 6e20 6973  0, correction is
+000143d0: 2070 6572 666f 726d 6564 2074 6f20 7472   performed to tr
+000143e0: 616e 7366 6572 2074 6f20 2d31 3830 2074  ansfer to -180 t
+000143f0: 6f20 3138 3027 290a 2020 2020 2020 2020  o 180').        
+00014400: 2020 2020 2020 2020 2320 7368 6170 6566          # shapef
+00014410: 696c 6520 7769 7468 2031 3830 2074 6f20  ile with 180 to 
+00014420: 3336 3020 6c6f 6e0a 2020 2020 2020 2020  360 lon.        
+00014430: 2020 2020 2020 2020 6764 6631 203d 207b          gdf1 = {
+00014440: 2767 656f 6d65 7472 7927 3a20 5b50 6f6c  'geometry': [Pol
+00014450: 7967 6f6e 285b 2820 2031 3830 2e30 2b73  ygon([(  180.0+s
+00014460: 656c 662e 746f 6c65 7261 6e63 652c 202d  elf.tolerance, -
+00014470: 3930 2e30 2b73 656c 662e 746f 6c65 7261  90.0+self.tolera
+00014480: 6e63 6529 2c20 2820 3138 302e 302b 7365  nce), ( 180.0+se
+00014490: 6c66 2e74 6f6c 6572 616e 6365 2c20 2039  lf.tolerance,  9
+000144a0: 302e 302d 7365 6c66 2e74 6f6c 6572 616e  0.0-self.toleran
+000144b0: 6365 292c 5c0a 2020 2020 2020 2020 2020  ce),\.          
+000144c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000144d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000144e0: 2020 2020 2820 2033 3630 2e30 2d73 656c      (  360.0-sel
+000144f0: 662e 746f 6c65 7261 6e63 652c 2020 3930  f.tolerance,  90
+00014500: 2e30 2d73 656c 662e 746f 6c65 7261 6e63  .0-self.toleranc
+00014510: 6529 2c20 2820 3336 302e 302d 7365 6c66  e), ( 360.0-self
+00014520: 2e74 6f6c 6572 616e 6365 2c20 2d39 302e  .tolerance, -90.
+00014530: 302b 7365 6c66 2e74 6f6c 6572 616e 6365  0+self.tolerance
+00014540: 295d 295d 7d0a 2020 2020 2020 2020 2020  )])]}.          
+00014550: 2020 2020 2020 6764 6631 203d 2067 7064        gdf1 = gpd
+00014560: 2e47 656f 4461 7461 4672 616d 6528 6764  .GeoDataFrame(gd
+00014570: 6631 290a 2020 2020 2020 2020 2020 2020  f1).            
+00014580: 2020 2020 6764 6631 203d 2067 6466 312e      gdf1 = gdf1.
+00014590: 7365 745f 6372 7320 2822 6570 7367 3a34  set_crs ("epsg:4
+000145a0: 3332 3622 290a 2020 2020 2020 2020 2020  326").          
+000145b0: 2020 2020 2020 7761 726e 696e 6773 2e73        warnings.s
+000145c0: 696d 706c 6566 696c 7465 7228 2769 676e  implefilter('ign
+000145d0: 6f72 6527 290a 2020 2020 2020 2020 2020  ore').          
+000145e0: 2020 2020 2020 7368 705f 696e 7431 203d        shp_int1 =
+000145f0: 2073 656c 662e 696e 7465 7273 6563 7469   self.intersecti
+00014600: 6f6e 5f73 6870 2873 6870 2c20 6764 6631  on_shp(shp, gdf1
+00014610: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
+00014620: 2020 7761 726e 696e 6773 2e73 696d 706c    warnings.simpl
+00014630: 6566 696c 7465 7228 2764 6566 6175 6c74  efilter('default
+00014640: 2729 0a20 2020 2020 2020 2020 2020 2020  ').             
+00014650: 2020 2063 6f6c 5f6e 616d 6573 203d 2073     col_names = s
+00014660: 6870 5f69 6e74 312e 636f 6c75 6d6e 730a  hp_int1.columns.
+00014670: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00014680: 636f 6c5f 6e61 6d65 7320 3d20 6c69 7374  col_names = list
+00014690: 2866 696c 7465 7228 6c61 6d62 6461 2078  (filter(lambda x
+000146a0: 3a20 782e 7374 6172 7473 7769 7468 2827  : x.startswith('
+000146b0: 535f 315f 2729 2c20 636f 6c5f 6e61 6d65  S_1_'), col_name
+000146c0: 7329 290a 2020 2020 2020 2020 2020 2020  s)).            
+000146d0: 2020 2020 636f 6c5f 6e61 6d65 732e 6170      col_names.ap
+000146e0: 7065 6e64 2827 6765 6f6d 6574 7279 2729  pend('geometry')
+000146f0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00014700: 2073 6870 5f69 6e74 3120 3d20 7368 705f   shp_int1 = shp_
+00014710: 696e 7431 5b73 6870 5f69 6e74 312e 636f  int1[shp_int1.co
+00014720: 6c75 6d6e 732e 696e 7465 7273 6563 7469  lumns.intersecti
+00014730: 6f6e 2863 6f6c 5f6e 616d 6573 295d 0a20  on(col_names)]. 
+00014740: 2020 2020 2020 2020 2020 2020 2020 2063                 c
+00014750: 6f6c 5f6e 616d 6573 2e72 656d 6f76 6528  ol_names.remove(
+00014760: 2767 656f 6d65 7472 7927 290a 2020 2020  'geometry').    
+00014770: 2020 2020 2020 2020 2020 2020 2320 7265              # re
+00014780: 6e61 6d65 2063 6f6c 756d 6e73 2077 6974  name columns wit
+00014790: 686f 7574 2053 5f31 5f0a 2020 2020 2020  hout S_1_.      
+000147a0: 2020 2020 2020 2020 2020 666f 7220 636f            for co
+000147b0: 6c5f 6e61 6d65 2069 6e20 636f 6c5f 6e61  l_name in col_na
+000147c0: 6d65 733a 0a20 2020 2020 2020 2020 2020  mes:.           
+000147d0: 2020 2020 2020 2020 2063 6f6c 5f6e 616d           col_nam
+000147e0: 6520 3d20 7374 7228 636f 6c5f 6e61 6d65  e = str(col_name
+000147f0: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
+00014800: 2020 2020 2020 636f 6c5f 6e61 6d65 5f6e        col_name_n
+00014810: 203d 2063 6f6c 5f6e 616d 652e 7265 706c   = col_name.repl
+00014820: 6163 6528 2253 5f31 5f22 2c22 2229 3b0a  ace("S_1_","");.
+00014830: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00014840: 2020 2020 7368 705f 696e 7431 203d 2073      shp_int1 = s
+00014850: 6870 5f69 6e74 312e 7265 6e61 6d65 2863  hp_int1.rename(c
+00014860: 6f6c 756d 6e73 3d7b 636f 6c5f 6e61 6d65  olumns={col_name
+00014870: 3a20 636f 6c5f 6e61 6d65 5f6e 7d29 0a20  : col_name_n}). 
+00014880: 2020 2020 2020 2020 2020 2020 2020 2023                 #
+00014890: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+000148a0: 2066 6f72 2069 6e64 6578 2c20 5f20 696e   for index, _ in
+000148b0: 2073 6870 5f69 6e74 312e 6974 6572 726f   shp_int1.iterro
+000148c0: 7773 2829 3a0a 2020 2020 2020 2020 2020  ws():.          
+000148d0: 2020 2020 2020 2020 2020 706f 6c79 7320            polys 
+000148e0: 3d20 7368 705f 696e 7431 2e67 656f 6d65  = shp_int1.geome
+000148f0: 7472 792e 696c 6f63 5b69 6e64 6578 5d20  try.iloc[index] 
+00014900: 2320 6765 7420 7468 6520 7368 6170 650a  # get the shape.
+00014910: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00014920: 2020 2020 706f 6c79 7320 3d20 7368 6170      polys = shap
+00014930: 656c 792e 6166 6669 6e69 7479 2e74 7261  ely.affinity.tra
+00014940: 6e73 6c61 7465 2870 6f6c 7973 2c20 786f  nslate(polys, xo
+00014950: 6666 3d2d 3336 302e 302c 2079 6f66 663d  ff=-360.0, yoff=
+00014960: 302e 302c 207a 6f66 663d 302e 3029 0a20  0.0, zoff=0.0). 
+00014970: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00014980: 2020 2073 6870 5f69 6e74 312e 6765 6f6d     shp_int1.geom
+00014990: 6574 7279 2e69 6c6f 635b 696e 6465 785d  etry.iloc[index]
+000149a0: 203d 2070 6f6c 7973 0a20 2020 2020 2020   = polys.       
+000149b0: 2020 2020 2020 2020 2023 2073 6861 7065           # shape
+000149c0: 6669 6c65 2077 6974 6820 2d31 3830 2074  file with -180 t
+000149d0: 6f20 3138 3020 6c6f 6e0a 2020 2020 2020  o 180 lon.      
+000149e0: 2020 2020 2020 2020 2020 6764 6632 203d            gdf2 =
+000149f0: 207b 2767 656f 6d65 7472 7927 3a20 5b50   {'geometry': [P
+00014a00: 6f6c 7967 6f6e 285b 2820 2d31 3830 2e30  olygon([( -180.0
+00014a10: 2b73 656c 662e 746f 6c65 7261 6e63 652c  +self.tolerance,
+00014a20: 202d 3930 2e30 2b73 656c 662e 746f 6c65   -90.0+self.tole
+00014a30: 7261 6e63 6529 2c20 282d 3138 302e 302b  rance), (-180.0+
+00014a40: 7365 6c66 2e74 6f6c 6572 616e 6365 2c20  self.tolerance, 
+00014a50: 2039 302e 302d 7365 6c66 2e74 6f6c 6572   90.0-self.toler
+00014a60: 616e 6365 292c 5c0a 2020 2020 2020 2020  ance),\.        
+00014a70: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00014a80: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00014a90: 2020 2020 2020 2820 2031 3830 2e30 2d73        (  180.0-s
+00014aa0: 656c 662e 746f 6c65 7261 6e63 652c 2020  elf.tolerance,  
+00014ab0: 3930 2e30 2d73 656c 662e 746f 6c65 7261  90.0-self.tolera
+00014ac0: 6e63 6529 2c20 2820 3138 302e 302d 7365  nce), ( 180.0-se
+00014ad0: 6c66 2e74 6f6c 6572 616e 6365 2c20 2d39  lf.tolerance, -9
+00014ae0: 302e 302b 7365 6c66 2e74 6f6c 6572 616e  0.0+self.toleran
+00014af0: 6365 295d 295d 7d0a 2020 2020 2020 2020  ce)])]}.        
+00014b00: 2020 2020 2020 2020 6764 6632 203d 2067          gdf2 = g
+00014b10: 7064 2e47 656f 4461 7461 4672 616d 6528  pd.GeoDataFrame(
+00014b20: 6764 6632 290a 2020 2020 2020 2020 2020  gdf2).          
+00014b30: 2020 2020 2020 6764 6632 203d 2067 6466        gdf2 = gdf
+00014b40: 322e 7365 745f 6372 7320 2822 6570 7367  2.set_crs ("epsg
+00014b50: 3a34 3332 3622 290a 2020 2020 2020 2020  :4326").        
+00014b60: 2020 2020 2020 2020 7761 726e 696e 6773          warnings
+00014b70: 2e73 696d 706c 6566 696c 7465 7228 2769  .simplefilter('i
+00014b80: 676e 6f72 6527 290a 2020 2020 2020 2020  gnore').        
+00014b90: 2020 2020 2020 2020 7368 705f 696e 7432          shp_int2
+00014ba0: 203d 2073 656c 662e 696e 7465 7273 6563   = self.intersec
+00014bb0: 7469 6f6e 5f73 6870 2873 6870 2c20 6764  tion_shp(shp, gd
+00014bc0: 6632 290a 2020 2020 2020 2020 2020 2020  f2).            
+00014bd0: 2020 2020 7761 726e 696e 6773 2e73 696d      warnings.sim
+00014be0: 706c 6566 696c 7465 7228 2764 6566 6175  plefilter('defau
+00014bf0: 6c74 2729 0a20 2020 2020 2020 2020 2020  lt').           
+00014c00: 2020 2020 2063 6f6c 5f6e 616d 6573 203d       col_names =
+00014c10: 2073 6870 5f69 6e74 322e 636f 6c75 6d6e   shp_int2.column
+00014c20: 730a 2020 2020 2020 2020 2020 2020 2020  s.              
+00014c30: 2020 636f 6c5f 6e61 6d65 7320 3d20 6c69    col_names = li
+00014c40: 7374 2866 696c 7465 7228 6c61 6d62 6461  st(filter(lambda
+00014c50: 2078 3a20 782e 7374 6172 7473 7769 7468   x: x.startswith
+00014c60: 2827 535f 315f 2729 2c20 636f 6c5f 6e61  ('S_1_'), col_na
+00014c70: 6d65 7329 290a 2020 2020 2020 2020 2020  mes)).          
+00014c80: 2020 2020 2020 636f 6c5f 6e61 6d65 732e        col_names.
+00014c90: 6170 7065 6e64 2827 6765 6f6d 6574 7279  append('geometry
+00014ca0: 2729 0a20 2020 2020 2020 2020 2020 2020  ').             
+00014cb0: 2020 2073 6870 5f69 6e74 3220 3d20 7368     shp_int2 = sh
+00014cc0: 705f 696e 7432 5b73 6870 5f69 6e74 322e  p_int2[shp_int2.
+00014cd0: 636f 6c75 6d6e 732e 696e 7465 7273 6563  columns.intersec
+00014ce0: 7469 6f6e 2863 6f6c 5f6e 616d 6573 295d  tion(col_names)]
+00014cf0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00014d00: 2063 6f6c 5f6e 616d 6573 2e72 656d 6f76   col_names.remov
+00014d10: 6528 2767 656f 6d65 7472 7927 290a 2020  e('geometry').  
+00014d20: 2020 2020 2020 2020 2020 2020 2020 2320                # 
+00014d30: 7265 6e61 6d65 2063 6f6c 756d 6e73 2077  rename columns w
+00014d40: 6974 686f 7574 2053 5f31 5f0a 2020 2020  ithout S_1_.    
+00014d50: 2020 2020 2020 2020 2020 2020 666f 7220              for 
+00014d60: 636f 6c5f 6e61 6d65 2069 6e20 636f 6c5f  col_name in col_
+00014d70: 6e61 6d65 733a 0a20 2020 2020 2020 2020  names:.         
+00014d80: 2020 2020 2020 2020 2020 2063 6f6c 5f6e             col_n
+00014d90: 616d 6520 3d20 7374 7228 636f 6c5f 6e61  ame = str(col_na
+00014da0: 6d65 290a 2020 2020 2020 2020 2020 2020  me).            
+00014db0: 2020 2020 2020 2020 636f 6c5f 6e61 6d65          col_name
+00014dc0: 5f6e 203d 2063 6f6c 5f6e 616d 652e 7265  _n = col_name.re
+00014dd0: 706c 6163 6528 2253 5f31 5f22 2c22 2229  place("S_1_","")
+00014de0: 3b0a 2020 2020 2020 2020 2020 2020 2020  ;.              
+00014df0: 2020 2020 2020 7368 705f 696e 7432 203d        shp_int2 =
+00014e00: 2073 6870 5f69 6e74 322e 7265 6e61 6d65   shp_int2.rename
+00014e10: 2863 6f6c 756d 6e73 3d7b 636f 6c5f 6e61  (columns={col_na
+00014e20: 6d65 3a20 636f 6c5f 6e61 6d65 5f6e 7d29  me: col_name_n})
+00014e30: 0a20 2020 2020 2020 2020 2020 2023 0a20  .            #. 
+00014e40: 2020 2020 2020 2020 2020 2069 6620 286d             if (m
+00014e50: 6178 5f6c 6f6e 203c 2031 3830 2920 616e  ax_lon < 180) an
+00014e60: 6420 286d 696e 5f6c 6f6e 203c 202d 3138  d (min_lon < -18
+00014e70: 3029 3a0a 2020 2020 2020 2020 2020 2020  0):.            
+00014e80: 2020 2020 7072 696e 7428 2745 4153 594d      print('EASYM
+00014e90: 4f52 4520 6465 7465 6374 7320 7468 6174  ORE detects that
+00014ea0: 2073 6861 7065 6669 6c65 206c 6f6e 6769   shapefile longi
+00014eb0: 7475 6465 2069 7320 6265 7477 6565 6e20  tude is between 
+00014ec0: 3020 616e 6420 3336 302c 2063 6f72 7265  0 and 360, corre
+00014ed0: 6374 696f 6e20 6973 2070 6572 666f 726d  ction is perform
+00014ee0: 6564 2074 6f20 7472 616e 7366 6572 2074  ed to transfer t
+00014ef0: 6f20 2d31 3830 2074 6f20 3138 3027 290a  o -180 to 180').
+00014f00: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00014f10: 2320 7368 6170 6566 696c 6520 7769 7468  # shapefile with
+00014f20: 202d 3138 3020 746f 202d 3336 3020 6c6f   -180 to -360 lo
+00014f30: 6e0a 2020 2020 2020 2020 2020 2020 2020  n.              
+00014f40: 2020 6764 6631 203d 207b 2767 656f 6d65    gdf1 = {'geome
+00014f50: 7472 7927 3a20 5b50 6f6c 7967 6f6e 285b  try': [Polygon([
+00014f60: 2820 2d33 3630 2e30 2b73 656c 662e 746f  ( -360.0+self.to
+00014f70: 6c65 7261 6e63 652c 202d 3930 2e30 2b73  lerance, -90.0+s
+00014f80: 656c 662e 746f 6c65 7261 6e63 6529 2c20  elf.tolerance), 
+00014f90: 282d 3336 302e 302b 7365 6c66 2e74 6f6c  (-360.0+self.tol
+00014fa0: 6572 616e 6365 2c20 2039 302e 302d 7365  erance,  90.0-se
+00014fb0: 6c66 2e74 6f6c 6572 616e 6365 292c 5c0a  lf.tolerance),\.
+00014fc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00014fd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00014fe0: 2020 2020 2020 2020 2020 2020 2020 2820                ( 
+00014ff0: 2d31 3830 2e30 2d73 656c 662e 746f 6c65  -180.0-self.tole
+00015000: 7261 6e63 652c 2020 3930 2e30 2d73 656c  rance,  90.0-sel
+00015010: 662e 746f 6c65 7261 6e63 6529 2c20 282d  f.tolerance), (-
+00015020: 3138 302e 302d 7365 6c66 2e74 6f6c 6572  180.0-self.toler
+00015030: 616e 6365 2c20 2d39 302e 302b 7365 6c66  ance, -90.0+self
+00015040: 2e74 6f6c 6572 616e 6365 295d 295d 7d0a  .tolerance)])]}.
+00015050: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00015060: 6764 6631 203d 2067 7064 2e47 656f 4461  gdf1 = gpd.GeoDa
+00015070: 7461 4672 616d 6528 6764 6631 290a 2020  taFrame(gdf1).  
+00015080: 2020 2020 2020 2020 2020 2020 2020 6764                gd
+00015090: 6631 203d 2067 6466 312e 7365 745f 6372  f1 = gdf1.set_cr
+000150a0: 7320 2822 6570 7367 3a34 3332 3622 290a  s ("epsg:4326").
+000150b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000150c0: 7761 726e 696e 6773 2e73 696d 706c 6566  warnings.simplef
+000150d0: 696c 7465 7228 2769 676e 6f72 6527 290a  ilter('ignore').
+000150e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000150f0: 7368 705f 696e 7431 203d 2073 656c 662e  shp_int1 = self.
+00015100: 696e 7465 7273 6563 7469 6f6e 5f73 6870  intersection_shp
+00015110: 2873 6870 2c20 6764 6631 290a 2020 2020  (shp, gdf1).    
+00015120: 2020 2020 2020 2020 2020 2020 7761 726e              warn
+00015130: 696e 6773 2e73 696d 706c 6566 696c 7465  ings.simplefilte
+00015140: 7228 2764 6566 6175 6c74 2729 0a20 2020  r('default').   
+00015150: 2020 2020 2020 2020 2020 2020 2063 6f6c               col
+00015160: 5f6e 616d 6573 203d 2073 6870 5f69 6e74  _names = shp_int
+00015170: 312e 636f 6c75 6d6e 730a 2020 2020 2020  1.columns.      
+00015180: 2020 2020 2020 2020 2020 636f 6c5f 6e61            col_na
+00015190: 6d65 7320 3d20 6c69 7374 2866 696c 7465  mes = list(filte
+000151a0: 7228 6c61 6d62 6461 2078 3a20 782e 7374  r(lambda x: x.st
+000151b0: 6172 7473 7769 7468 2827 535f 315f 2729  artswith('S_1_')
+000151c0: 2c20 636f 6c5f 6e61 6d65 7329 290a 2020  , col_names)).  
+000151d0: 2020 2020 2020 2020 2020 2020 2020 636f                co
+000151e0: 6c5f 6e61 6d65 732e 6170 7065 6e64 2827  l_names.append('
+000151f0: 6765 6f6d 6574 7279 2729 0a20 2020 2020  geometry').     
+00015200: 2020 2020 2020 2020 2020 2073 6870 5f69             shp_i
+00015210: 6e74 3120 3d20 7368 705f 696e 7431 5b73  nt1 = shp_int1[s
+00015220: 6870 5f69 6e74 312e 636f 6c75 6d6e 732e  hp_int1.columns.
+00015230: 696e 7465 7273 6563 7469 6f6e 2863 6f6c  intersection(col
+00015240: 5f6e 616d 6573 295d 0a20 2020 2020 2020  _names)].       
+00015250: 2020 2020 2020 2020 2063 6f6c 5f6e 616d           col_nam
+00015260: 6573 2e72 656d 6f76 6528 2767 656f 6d65  es.remove('geome
+00015270: 7472 7927 290a 2020 2020 2020 2020 2020  try').          
+00015280: 2020 2020 2020 2320 7265 6e61 6d65 2063        # rename c
+00015290: 6f6c 756d 6e73 2077 6974 686f 7574 2053  olumns without S
+000152a0: 5f31 5f0a 2020 2020 2020 2020 2020 2020  _1_.            
+000152b0: 2020 2020 666f 7220 636f 6c5f 6e61 6d65      for col_name
+000152c0: 2069 6e20 636f 6c5f 6e61 6d65 733a 0a20   in col_names:. 
+000152d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000152e0: 2020 2063 6f6c 5f6e 616d 6520 3d20 7374     col_name = st
+000152f0: 7228 636f 6c5f 6e61 6d65 290a 2020 2020  r(col_name).    
+00015300: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00015310: 636f 6c5f 6e61 6d65 5f6e 203d 2063 6f6c  col_name_n = col
+00015320: 5f6e 616d 652e 7265 706c 6163 6528 2253  _name.replace("S
+00015330: 5f31 5f22 2c22 2229 3b0a 2020 2020 2020  _1_","");.      
+00015340: 2020 2020 2020 2020 2020 2020 2020 7368                sh
+00015350: 705f 696e 7431 203d 2073 6870 5f69 6e74  p_int1 = shp_int
+00015360: 312e 7265 6e61 6d65 2863 6f6c 756d 6e73  1.rename(columns
+00015370: 3d7b 636f 6c5f 6e61 6d65 3a20 636f 6c5f  ={col_name: col_
+00015380: 6e61 6d65 5f6e 7d29 0a20 2020 2020 2020  name_n}).       
+00015390: 2020 2020 2020 2020 2023 0a20 2020 2020           #.     
+000153a0: 2020 2020 2020 2020 2020 2066 6f72 2069             for i
+000153b0: 6e64 6578 2c20 5f20 696e 2073 6870 5f69  ndex, _ in shp_i
+000153c0: 6e74 312e 6974 6572 726f 7773 2829 3a0a  nt1.iterrows():.
+000153d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000153e0: 2020 2020 706f 6c79 7320 3d20 7368 705f      polys = shp_
+000153f0: 696e 7431 2e67 656f 6d65 7472 792e 696c  int1.geometry.il
+00015400: 6f63 5b69 6e64 6578 5d20 2320 6765 7420  oc[index] # get 
+00015410: 7468 6520 7368 6170 650a 2020 2020 2020  the shape.      
+00015420: 2020 2020 2020 2020 2020 2020 2020 706f                po
+00015430: 6c79 7320 3d20 7368 6170 656c 792e 6166  lys = shapely.af
+00015440: 6669 6e69 7479 2e74 7261 6e73 6c61 7465  finity.translate
+00015450: 2870 6f6c 7973 2c20 786f 6666 3d2b 3336  (polys, xoff=+36
+00015460: 302e 302c 2079 6f66 663d 302e 302c 207a  0.0, yoff=0.0, z
+00015470: 6f66 663d 302e 3029 0a20 2020 2020 2020  off=0.0).       
+00015480: 2020 2020 2020 2020 2020 2020 2073 6870               shp
+00015490: 5f69 6e74 312e 6765 6f6d 6574 7279 2e69  _int1.geometry.i
+000154a0: 6c6f 635b 696e 6465 785d 203d 2070 6f6c  loc[index] = pol
+000154b0: 7973 0a20 2020 2020 2020 2020 2020 2020  ys.             
+000154c0: 2020 2023 2073 6861 7065 6669 6c65 2077     # shapefile w
+000154d0: 6974 6820 2d31 3830 2074 6f20 3138 3020  ith -180 to 180 
+000154e0: 6c6f 6e0a 2020 2020 2020 2020 2020 2020  lon.            
+000154f0: 2020 2020 6764 6632 203d 207b 2767 656f      gdf2 = {'geo
+00015500: 6d65 7472 7927 3a20 5b50 6f6c 7967 6f6e  metry': [Polygon
+00015510: 285b 2820 2d31 3830 2e30 2b73 656c 662e  ([( -180.0+self.
+00015520: 746f 6c65 7261 6e63 652c 202d 3930 2e30  tolerance, -90.0
+00015530: 2b73 656c 662e 746f 6c65 7261 6e63 6529  +self.tolerance)
+00015540: 2c20 282d 3138 302e 302b 7365 6c66 2e74  , (-180.0+self.t
+00015550: 6f6c 6572 616e 6365 2c20 2039 302e 302d  olerance,  90.0-
+00015560: 7365 6c66 2e74 6f6c 6572 616e 6365 292c  self.tolerance),
+00015570: 5c0a 2020 2020 2020 2020 2020 2020 2020  \.              
+00015580: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00015590: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000155a0: 2820 2031 3830 2e30 2d73 656c 662e 746f  (  180.0-self.to
+000155b0: 6c65 7261 6e63 652c 2020 3930 2e30 2d73  lerance,  90.0-s
+000155c0: 656c 662e 746f 6c65 7261 6e63 6529 2c20  elf.tolerance), 
+000155d0: 2820 3138 302e 302d 7365 6c66 2e74 6f6c  ( 180.0-self.tol
+000155e0: 6572 616e 6365 2c20 2d39 302e 302b 7365  erance, -90.0+se
+000155f0: 6c66 2e74 6f6c 6572 616e 6365 295d 295d  lf.tolerance)])]
+00015600: 7d0a 2020 2020 2020 2020 2020 2020 2020  }.              
+00015610: 2020 6764 6632 203d 2067 7064 2e47 656f    gdf2 = gpd.Geo
+00015620: 4461 7461 4672 616d 6528 6764 6632 290a  DataFrame(gdf2).
+00015630: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00015640: 6764 6632 203d 2067 6466 322e 7365 745f  gdf2 = gdf2.set_
+00015650: 6372 7320 2822 6570 7367 3a34 3332 3622  crs ("epsg:4326"
+00015660: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
+00015670: 2020 7761 726e 696e 6773 2e73 696d 706c    warnings.simpl
+00015680: 6566 696c 7465 7228 2769 676e 6f72 6527  efilter('ignore'
+00015690: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
+000156a0: 2020 7368 705f 696e 7432 203d 2073 656c    shp_int2 = sel
+000156b0: 662e 696e 7465 7273 6563 7469 6f6e 5f73  f.intersection_s
+000156c0: 6870 2873 6870 2c20 6764 6632 290a 2020  hp(shp, gdf2).  
+000156d0: 2020 2020 2020 2020 2020 2020 2020 7761                wa
+000156e0: 726e 696e 6773 2e73 696d 706c 6566 696c  rnings.simplefil
+000156f0: 7465 7228 2764 6566 6175 6c74 2729 0a20  ter('default'). 
+00015700: 2020 2020 2020 2020 2020 2020 2020 2063                 c
+00015710: 6f6c 5f6e 616d 6573 203d 2073 6870 5f69  ol_names = shp_i
+00015720: 6e74 322e 636f 6c75 6d6e 730a 2020 2020  nt2.columns.    
+00015730: 2020 2020 2020 2020 2020 2020 636f 6c5f              col_
+00015740: 6e61 6d65 7320 3d20 6c69 7374 2866 696c  names = list(fil
+00015750: 7465 7228 6c61 6d62 6461 2078 3a20 782e  ter(lambda x: x.
+00015760: 7374 6172 7473 7769 7468 2827 535f 315f  startswith('S_1_
+00015770: 2729 2c20 636f 6c5f 6e61 6d65 7329 290a  '), col_names)).
+00015780: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00015790: 636f 6c5f 6e61 6d65 732e 6170 7065 6e64  col_names.append
+000157a0: 2827 6765 6f6d 6574 7279 2729 0a20 2020  ('geometry').   
+000157b0: 2020 2020 2020 2020 2020 2020 2073 6870               shp
+000157c0: 5f69 6e74 3220 3d20 7368 705f 696e 7432  _int2 = shp_int2
+000157d0: 5b73 6870 5f69 6e74 322e 636f 6c75 6d6e  [shp_int2.column
+000157e0: 732e 696e 7465 7273 6563 7469 6f6e 2863  s.intersection(c
+000157f0: 6f6c 5f6e 616d 6573 295d 0a20 2020 2020  ol_names)].     
+00015800: 2020 2020 2020 2020 2020 2063 6f6c 5f6e             col_n
+00015810: 616d 6573 2e72 656d 6f76 6528 2767 656f  ames.remove('geo
+00015820: 6d65 7472 7927 290a 2020 2020 2020 2020  metry').        
+00015830: 2020 2020 2020 2020 2320 7265 6e61 6d65          # rename
+00015840: 2063 6f6c 756d 6e73 2077 6974 686f 7574   columns without
+00015850: 2053 5f31 5f0a 2020 2020 2020 2020 2020   S_1_.          
+00015860: 2020 2020 2020 666f 7220 636f 6c5f 6e61        for col_na
+00015870: 6d65 2069 6e20 636f 6c5f 6e61 6d65 733a  me in col_names:
+00015880: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00015890: 2020 2020 2063 6f6c 5f6e 616d 6520 3d20       col_name = 
+000158a0: 7374 7228 636f 6c5f 6e61 6d65 290a 2020  str(col_name).  
+000158b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000158c0: 2020 636f 6c5f 6e61 6d65 5f6e 203d 2063    col_name_n = c
+000158d0: 6f6c 5f6e 616d 652e 7265 706c 6163 6528  ol_name.replace(
+000158e0: 2253 5f31 5f22 2c22 2229 3b0a 2020 2020  "S_1_","");.    
+000158f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00015900: 7368 705f 696e 7432 203d 2073 6870 5f69  shp_int2 = shp_i
+00015910: 6e74 322e 7265 6e61 6d65 2863 6f6c 756d  nt2.rename(colum
+00015920: 6e73 3d7b 636f 6c5f 6e61 6d65 3a20 636f  ns={col_name: co
+00015930: 6c5f 6e61 6d65 5f6e 7d29 0a20 2020 2020  l_name_n}).     
+00015940: 2020 2023 206d 6572 6769 6e67 2074 6865     # merging the
+00015950: 2074 776f 2073 6861 7065 6669 6c65 730a   two shapefiles.
+00015960: 2020 2020 2020 2020 6966 206e 6f74 2073          if not s
+00015970: 6870 5f69 6e74 312e 656d 7074 7920 616e  hp_int1.empty an
+00015980: 6420 6e6f 7420 7368 705f 696e 7432 2e65  d not shp_int2.e
+00015990: 6d70 7479 3a0a 2020 2020 2020 2020 2020  mpty:.          
+000159a0: 2020 7368 705f 6669 6e61 6c20 3d20 7064    shp_final = pd
+000159b0: 2e63 6f6e 6361 7428 5b73 6870 5f69 6e74  .concat([shp_int
+000159c0: 312c 7368 705f 696e 7432 5d29 0a20 2020  1,shp_int2]).   
+000159d0: 2020 2020 2065 6c69 6620 6e6f 7420 7368       elif not sh
+000159e0: 705f 696e 7431 2e65 6d70 7479 3a0a 2020  p_int1.empty:.  
+000159f0: 2020 2020 2020 2020 2020 7368 705f 6669            shp_fi
+00015a00: 6e61 6c20 3d20 7368 705f 696e 7431 0a20  nal = shp_int1. 
+00015a10: 2020 2020 2020 2065 6c69 6620 6e6f 7420         elif not 
+00015a20: 7368 705f 696e 7432 2e65 6d70 7479 3a0a  shp_int2.empty:.
+00015a30: 2020 2020 2020 2020 2020 2020 7368 705f              shp_
+00015a40: 6669 6e61 6c20 3d20 7368 705f 696e 7432  final = shp_int2
+00015a50: 0a20 2020 2020 2020 2023 2070 7574 2062  .        # put b
+00015a60: 6163 6b20 7468 6520 7061 6e64 6173 2069  ack the pandas i
+00015a70: 6e74 6f20 6765 6f70 616e 6461 730a 2020  nto geopandas.  
+00015a80: 2020 2020 2020 7368 705f 6669 6e61 6c20        shp_final 
+00015a90: 3d20 7368 705f 6669 6e61 6c2e 7365 745f  = shp_final.set_
+00015aa0: 6765 6f6d 6574 7279 2827 6765 6f6d 6574  geometry('geomet
+00015ab0: 7279 2729 0a20 2020 2020 2020 2073 6870  ry').        shp
+00015ac0: 5f66 696e 616c 203d 2073 6870 5f66 696e  _final = shp_fin
+00015ad0: 616c 2e64 6973 736f 6c76 6528 6279 3d27  al.dissolve(by='
+00015ae0: 4944 272c 2061 735f 696e 6465 783d 4661  ID', as_index=Fa
+00015af0: 6c73 6529 0a20 2020 2020 2020 2073 6870  lse).        shp
+00015b00: 5f66 696e 616c 203d 2073 6870 5f66 696e  _final = shp_fin
+00015b10: 616c 2e73 6f72 745f 7661 6c75 6573 2862  al.sort_values(b
+00015b20: 793d 2749 4427 290a 2020 2020 2020 2020  y='ID').        
+00015b30: 7368 705f 6669 6e61 6c20 3d20 7368 705f  shp_final = shp_
+00015b40: 6669 6e61 6c2e 6472 6f70 2863 6f6c 756d  final.drop(colum
+00015b50: 6e73 3d27 4944 2729 0a20 2020 2020 2020  ns='ID').       
+00015b60: 2069 6620 6e6f 7420 6466 5f61 7474 7269   if not df_attri
+00015b70: 6275 7465 2e65 6d70 7479 3a20 2320 6164  bute.empty: # ad
+00015b80: 6420 6174 7472 6962 7574 6573 0a20 2020  d attributes.   
+00015b90: 2020 2020 2020 2020 2073 6870 5f66 696e           shp_fin
+00015ba0: 616c 203d 2070 642e 636f 6e63 6174 285b  al = pd.concat([
+00015bb0: 7368 705f 6669 6e61 6c2c 2064 665f 6174  shp_final, df_at
+00015bc0: 7472 6962 7574 655d 2c20 6178 6973 3d31  tribute], axis=1
+00015bd0: 290a 2020 2020 2020 2020 2320 6368 6563  ).        # chec
+00015be0: 6b20 6966 2074 6865 206f 7574 7075 7420  k if the output 
+00015bf0: 6861 7320 7468 6520 7361 6d65 206e 756d  has the same num
+00015c00: 6265 7220 6f66 2065 6c65 6d65 6e74 730a  ber of elements.
+00015c10: 2020 2020 2020 2020 6966 206c 656e 2873          if len(s
+00015c20: 6870 2920 213d 206c 656e 2873 6870 5f66  hp) != len(shp_f
+00015c30: 696e 616c 293a 0a20 2020 2020 2020 2020  inal):.         
+00015c40: 2020 2073 7973 2e65 7869 7428 2774 6865     sys.exit('the
+00015c50: 2065 6c65 6d65 6e74 206f 6620 696e 7075   element of inpu
+00015c60: 7420 7368 6170 6566 696c 6520 616e 6420  t shapefile and 
+00015c70: 636f 7272 6563 7465 6420 7368 6170 6566  corrected shapef
+00015c80: 696c 6520 6172 6561 206e 6f74 2074 6865  ile area not the
+00015c90: 2073 616d 6527 290a 2020 2020 2020 2020   same').        
+00015ca0: 2320 7265 7475 726e 2074 6865 2073 6861  # return the sha
+00015cb0: 7065 6669 6c65 0a20 2020 2020 2020 2072  pefile.        r
+00015cc0: 6574 7572 6e20 7368 705f 6669 6e61 6c0a  eturn shp_final.
+00015cd0: 0a0a 2020 2020 6465 6620 7368 705f 6365  ..    def shp_ce
+00015ce0: 6e74 726f 6964 5f65 7175 616c 5f61 7265  ntroid_equal_are
+00015cf0: 6120 2873 656c 662c 0a20 2020 2020 2020  a (self,.       
+00015d00: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00015d10: 2020 2020 2020 2020 2020 7368 7029 3a0a            shp):.
+00015d20: 2020 2020 2020 2020 2222 220a 2020 2020          """.    
+00015d30: 2020 2020 4020 6175 7468 6f72 3a20 2020      @ author:   
+00015d40: 2020 2020 2020 2020 2020 2020 2020 2053                 S
+00015d50: 6865 7276 616e 2047 6861 7261 7269 0a20  hervan Gharari. 
+00015d60: 2020 2020 2020 2040 2047 6974 6875 623a         @ Github:
+00015d70: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00015d80: 2020 6874 7470 733a 2f2f 6769 7468 7562    https://github
+00015d90: 2e63 6f6d 2f53 6865 7276 616e 4768 6172  .com/ShervanGhar
+00015da0: 6172 692f 4541 5359 4d4f 5245 0a20 2020  ari/EASYMORE.   
+00015db0: 2020 2020 2040 2061 7574 686f 7227 7320       @ author's 
+00015dc0: 656d 6169 6c20 6964 3a20 2020 2020 2020  email id:       
+00015dd0: 7368 2e67 6861 7261 7269 4067 6d61 696c  sh.gharari@gmail
+00015de0: 2e63 6f6d 0a20 2020 2020 2020 2040 206c  .com.        @ l
+00015df0: 6963 656e 7365 3a20 2020 2020 2020 2020  icense:         
+00015e00: 2020 2020 2020 2020 474e 552d 4750 4c76          GNU-GPLv
+00015e10: 330a 2020 2020 2020 2020 5468 6973 2066  3.        This f
+00015e20: 756e 6374 696f 6e20 6361 6c63 756c 7465  unction calculte
+00015e30: 7320 7468 6520 6365 6e74 726f 6964 2069  s the centroid i
+00015e40: 6e20 6571 7561 6c20 6172 6561 2070 726f  n equal area pro
+00015e50: 6a65 6374 696f 6e20 666f 7220 7368 6170  jection for shap
+00015e60: 6566 696c 6520 626f 756e 6420 6265 7477  efile bound betw
+00015e70: 6565 6e20 2d31 3830 2074 6f20 3138 302e  een -180 to 180.
+00015e80: 0a20 2020 2020 2020 202d 2d2d 2d2d 2d2d  .        -------
+00015e90: 2d2d 0a20 2020 2020 2020 2073 6870 3a20  --.        shp: 
+00015ea0: 6765 6f70 616e 6461 7320 7368 6170 6566  geopandas shapef
+00015eb0: 696c 650a 2020 2020 2020 2020 5265 7475  ile.        Retu
+00015ec0: 726e 730a 2020 2020 2020 2020 2d2d 2d2d  rns.        ----
+00015ed0: 2d2d 2d0a 2020 2020 2020 2020 7368 703a  ---.        shp:
+00015ee0: 2067 656f 7061 6e64 6173 2073 6861 7065   geopandas shape
+00015ef0: 6669 6c65 2077 6974 6820 6365 6e74 726f  file with centro
+00015f00: 6964 2069 6e20 6571 7561 6c20 6172 6165  id in equal arae
+00015f10: 0a20 2020 2020 2020 2073 6870 5f70 6f69  .        shp_poi
+00015f20: 6e74 733a 2067 656f 7061 6e64 6173 2073  nts: geopandas s
+00015f30: 6861 7065 6669 6c65 2028 706f 696e 7473  hapefile (points
+00015f40: 2920 7769 7468 206c 6f63 6174 696f 6e20  ) with location 
+00015f50: 696e 2057 4753 3834 2063 6f72 7265 7370  in WGS84 corresp
+00015f60: 6f6e 7369 6e67 2074 6f20 7468 6520 6365  onsing to the ce
+00015f70: 6e74 726f 6964 2069 6e20 6571 7561 6c20  ntroid in equal 
+00015f80: 6172 6561 0a20 2020 2020 2020 2022 2222  area.        """
+00015f90: 0a20 2020 2020 2020 2023 2069 6e20 6571  .        # in eq
+00015fa0: 7561 6c20 7072 6f6a 6563 7469 6f6e 0a20  ual projection. 
+00015fb0: 2020 2020 2020 2070 7269 6e74 2827 6361         print('ca
+00015fc0: 6c63 756c 6174 696e 6720 6365 6e74 726f  lculating centro
+00015fd0: 6964 206f 6620 7368 6170 6573 2069 6e20  id of shapes in 
+00015fe0: 6571 7561 6c20 6172 6561 2070 726f 6a65  equal area proje
+00015ff0: 6374 696f 6e27 290a 2020 2020 2020 2020  ction').        
+00016000: 6966 206e 6f74 2073 656c 662e 6368 6563  if not self.chec
+00016010: 6b5f 7368 705f 6372 7328 7368 7029 3a20  k_shp_crs(shp): 
+00016020: 2320 2265 7073 673a 3433 3236 2220 6e6f  # "epsg:4326" no
+00016030: 7420 696e 2073 7472 2873 6870 2e63 7273  t in str(shp.crs
+00016040: 292e 6c6f 7765 7228 293a 0a20 2020 2020  ).lower():.     
+00016050: 2020 2020 2020 2073 7973 2e65 7869 7428         sys.exit(
+00016060: 2773 6861 7065 6669 6c65 2073 686f 756c  'shapefile shoul
+00016070: 6420 6265 2069 6e20 5747 5338 3420 7072  d be in WGS84 pr
+00016080: 6f6a 6563 7469 6f6e 2729 3b0a 2020 2020  ojection');.    
+00016090: 2020 2020 6d69 6e78 2c20 6d69 6e79 2c20      minx, miny, 
+000160a0: 6d61 7878 2c20 6d61 7879 203d 2073 6870  maxx, maxy = shp
+000160b0: 2e74 6f74 616c 5f62 6f75 6e64 730a 2020  .total_bounds.  
+000160c0: 2020 2020 2020 6966 206d 6178 7820 3e20        if maxx > 
+000160d0: 3138 303a 0a20 2020 2020 2020 2020 2020  180:.           
+000160e0: 2073 7973 2e65 7869 7428 2769 7420 7365   sys.exit('it se
+000160f0: 656d 7320 7468 6174 2074 6865 2073 6861  ems that the sha
+00016100: 7065 6669 6c65 2068 6173 206c 6f6e 6769  pefile has longi
+00016110: 7475 6465 2076 616c 7565 7320 6f66 206d  tude values of m
+00016120: 6f72 6520 7468 616e 2031 3830 2064 6567  ore than 180 deg
+00016130: 7265 6520 7768 6963 6820 6d69 6768 7420  ree which might 
+00016140: 6d61 6b65 205c 0a20 2020 2020 2020 2020  make \.         
+00016150: 2020 2070 726f 626c 656d 2069 6e20 6571     problem in eq
+00016160: 7561 6c20 6172 6561 2070 726f 6a65 6374  ual area project
+00016170: 696f 6e3b 206f 7468 6572 2073 6f66 7477  ion; other softw
+00016180: 6172 6520 6361 6e20 6265 2075 7365 6427  are can be used'
+00016190: 293b 0a20 2020 2020 2020 2073 6870 5f74  );.        shp_t
+000161a0: 656d 7020 3d20 7368 702e 746f 5f63 7273  emp = shp.to_crs
+000161b0: 2028 2245 5053 473a 3639 3333 2229 2023   ("EPSG:6933") #
+000161c0: 2073 6f75 7263 6520 7368 6170 6566 696c   source shapefil
+000161d0: 6520 746f 2065 7175 616c 2061 7265 610a  e to equal area.
+000161e0: 2020 2020 2020 2020 6c61 745f 6320 3d20          lat_c = 
+000161f0: 6e70 2e61 7272 6179 2873 6870 5f74 656d  np.array(shp_tem
+00016200: 702e 6365 6e74 726f 6964 2e79 2920 2320  p.centroid.y) # 
+00016210: 6365 6e74 726f 6964 206c 6174 2066 726f  centroid lat fro
+00016220: 6d20 7461 7267 6574 0a20 2020 2020 2020  m target.       
+00016230: 206c 6f6e 5f63 203d 206e 702e 6172 7261   lon_c = np.arra
+00016240: 7928 7368 705f 7465 6d70 2e63 656e 7472  y(shp_temp.centr
+00016250: 6f69 642e 7829 2023 2063 656e 7472 6f69  oid.x) # centroi
+00016260: 6420 6c6f 6e20 6672 6f6d 2074 6172 6765  d lon from targe
+00016270: 740a 2020 2020 2020 2020 6466 5f70 6f69  t.        df_poi
+00016280: 6e74 203d 2070 642e 4461 7461 4672 616d  nt = pd.DataFram
+00016290: 6528 290a 2020 2020 2020 2020 6466 5f70  e().        df_p
+000162a0: 6f69 6e74 205b 276c 6174 275d 203d 206c  oint ['lat'] = l
+000162b0: 6174 5f63 0a20 2020 2020 2020 2064 665f  at_c.        df_
+000162c0: 706f 696e 7420 5b27 6c6f 6e27 5d20 3d20  point ['lon'] = 
+000162d0: 6c6f 6e5f 630a 2020 2020 2020 2020 7368  lon_c.        sh
+000162e0: 705f 706f 696e 7473 203d 2073 656c 662e  p_points = self.
+000162f0: 6d61 6b65 5f73 6861 7065 5f70 6f69 6e74  make_shape_point
+00016300: 2864 665f 706f 696e 742c 2027 6c6f 6e27  (df_point, 'lon'
+00016310: 2c20 276c 6174 272c 2063 7273 3d22 4550  , 'lat', crs="EP
+00016320: 5347 3a36 3933 3322 290a 2020 2020 2020  SG:6933").      
+00016330: 2020 7368 705f 706f 696e 7473 203d 2073    shp_points = s
+00016340: 6870 5f70 6f69 6e74 732e 746f 5f63 7273  hp_points.to_crs
+00016350: 2822 4550 5347 3a34 3332 3622 2920 2320  ("EPSG:4326") # 
+00016360: 746f 2057 4753 0a20 2020 2020 2020 2073  to WGS.        s
+00016370: 6870 5f70 6f69 6e74 7320 3d20 7368 705f  hp_points = shp_
+00016380: 706f 696e 7473 2e64 726f 7028 636f 6c75  points.drop(colu
+00016390: 6d6e 733d 5b27 6c61 7427 2c27 6c6f 6e27  mns=['lat','lon'
+000163a0: 5d29 0a20 2020 2020 2020 2073 6870 5f70  ]).        shp_p
+000163b0: 6f69 6e74 7320 5b27 6c61 7427 5d20 3d20  oints ['lat'] = 
+000163c0: 7368 705f 706f 696e 7473 2e67 656f 6d65  shp_points.geome
+000163d0: 7472 792e 790a 2020 2020 2020 2020 7368  try.y.        sh
+000163e0: 705f 706f 696e 7473 205b 276c 6f6e 275d  p_points ['lon']
+000163f0: 203d 2073 6870 5f70 6f69 6e74 732e 6765   = shp_points.ge
+00016400: 6f6d 6574 7279 2e78 0a20 2020 2020 2020  ometry.x.       
+00016410: 2073 6870 205b 276c 6174 5f63 656e 7427   shp ['lat_cent'
+00016420: 5d20 3d20 7368 705f 706f 696e 7473 205b  ] = shp_points [
+00016430: 276c 6174 275d 0a20 2020 2020 2020 2073  'lat'].        s
+00016440: 6870 205b 276c 6f6e 5f63 656e 7427 5d20  hp ['lon_cent'] 
+00016450: 3d20 7368 705f 706f 696e 7473 205b 276c  = shp_points ['l
+00016460: 6f6e 275d 0a20 2020 2020 2020 2072 6574  on'].        ret
+00016470: 7572 6e20 7368 702c 2073 6870 5f70 6f69  urn shp, shp_poi
+00016480: 6e74 730a 0a0a 2020 2020 6465 6620 6461  nts...    def da
+00016490: 7461 6672 616d 655f 746f 5f6e 6574 6364  taframe_to_netcd
+000164a0: 665f 7872 2028 7365 6c66 2c0a 2020 2020  f_xr (self,.    
+000164b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000164c0: 2020 2020 2020 2020 2020 2020 6461 7461              data
+000164d0: 5f66 7261 6d65 2c0a 2020 2020 2020 2020  _frame,.        
+000164e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000164f0: 2020 2020 2020 2020 6e63 5f66 696c 655f          nc_file_
+00016500: 6e61 6d65 203d 204e 6f6e 652c 0a20 2020  name = None,.   
+00016510: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00016520: 2020 2020 2020 2020 2020 2020 206e 635f               nc_
+00016530: 6669 6c65 5f70 6174 6820 3d20 4e6f 6e65  file_path = None
+00016540: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
+00016550: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00016560: 2020 6461 7461 5f66 7261 6d65 5f44 6174    data_frame_Dat
+00016570: 6554 696d 655f 636f 6c75 6d6e 203d 204e  eTime_column = N
+00016580: 6f6e 652c 0a20 2020 2020 2020 2020 2020  one,.           
+00016590: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000165a0: 2020 2020 2076 6172 6961 626c 655f 6e61       variable_na
+000165b0: 6d65 203d 2027 7661 7269 6162 6c65 272c  me = 'variable',
+000165c0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+000165d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000165e0: 2076 6172 6961 626c 655f 6469 6d5f 6e61   variable_dim_na
+000165f0: 6d65 203d 2027 6e27 2c0a 2020 2020 2020  me = 'n',.      
+00016600: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00016610: 2020 2020 2020 2020 2020 756e 6974 5f6f            unit_o
+00016620: 665f 7661 7269 6162 6c65 203d 204e 6f6e  f_variable = Non
+00016630: 652c 0a20 2020 2020 2020 2020 2020 2020  e,.             
+00016640: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00016650: 2020 2076 6172 6961 626c 655f 6c6f 6e67     variable_long
+00016660: 5f6e 616d 6520 3d20 4e6f 6e65 2c0a 2020  _name = None,.  
+00016670: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00016680: 2020 2020 2020 2020 2020 2020 2020 4669                Fi
+00016690: 6c6c 5f76 616c 7565 203d 204e 6f6e 652c  ll_value = None,
+000166a0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+000166b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000166c0: 2073 7461 7469 6f6e 5f69 6e66 6f5f 6461   station_info_da
+000166d0: 7461 203d 204e 6f6e 652c 0a20 2020 2020  ta = None,.     
+000166e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000166f0: 2020 2020 2020 2020 2020 2073 7461 7469             stati
+00016700: 6f6e 5f69 6e66 6f5f 636f 6c75 6d6e 203d  on_info_column =
+00016710: 204e 6f6e 6529 3a0a 2020 2020 2020 2020   None):.        
+00016720: 2222 220a 2020 2020 2020 2020 4020 6175  """.        @ au
+00016730: 7468 6f72 3a20 2020 2020 2020 2020 2020  thor:           
+00016740: 2020 2020 2020 2053 6865 7276 616e 2047         Shervan G
+00016750: 6861 7261 7269 0a20 2020 2020 2020 2040  harari.        @
+00016760: 2047 6974 6875 623a 2020 2020 2020 2020   Github:        
+00016770: 2020 2020 2020 2020 2020 6874 7470 733a            https:
+00016780: 2f2f 6769 7468 7562 2e63 6f6d 2f53 6865  //github.com/She
+00016790: 7276 616e 4768 6172 6172 692f 4541 5359  rvanGharari/EASY
+000167a0: 4d4f 5245 0a20 2020 2020 2020 2040 2061  MORE.        @ a
+000167b0: 7574 686f 7227 7320 656d 6169 6c20 6964  uthor's email id
+000167c0: 3a20 2020 2020 2020 7368 2e67 6861 7261  :       sh.ghara
+000167d0: 7269 4067 6d61 696c 2e63 6f6d 0a20 2020  ri@gmail.com.   
+000167e0: 2020 2020 2040 206c 6963 656e 7365 3a20       @ license: 
+000167f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00016800: 474e 552d 4750 4c76 330a 2020 2020 2020  GNU-GPLv3.      
+00016810: 2020 5468 6973 2066 756e 6374 696f 6e20    This function 
+00016820: 6765 7420 6120 7061 6e64 6173 2064 6174  get a pandas dat
+00016830: 6166 7261 6d65 206f 6620 736f 6d65 2076  aframe of some v
+00016840: 616c 7565 7320 2861 6c6c 2066 6c6f 6174  alues (all float
+00016850: 202b 2064 6174 6574 696d 6520 7374 7269   + datetime stri
+00016860: 6e67 2920 616e 6420 7361 7665 2074 6865  ng) and save the
+00016870: 6d20 696e 2061 206e 6574 6364 6620 6669  m in a netcdf fi
+00016880: 6c65 0a20 2020 2020 2020 202d 2d2d 2d2d  le.        -----
+00016890: 2d2d 2d2d 0a20 2020 2020 2020 2064 6174  ----.        dat
+000168a0: 615f 6672 616d 653a 2070 616e 6461 7320  a_frame: pandas 
+000168b0: 6461 7461 5f66 7261 6d65 2077 6974 6820  data_frame with 
+000168c0: 696e 6465 7820 6173 2070 616e 6461 7320  index as pandas 
+000168d0: 6461 7461 2074 696d 6520 6f72 2070 6174  data time or pat
+000168e0: 6820 746f 2063 7376 2066 696c 650a 2020  h to csv file.  
+000168f0: 2020 2020 2020 6e63 5f66 696c 655f 6e61        nc_file_na
+00016900: 6d65 3a20 7468 6520 6e61 6d65 206f 6620  me: the name of 
+00016910: 6e63 2066 696c 6520 746f 2062 6520 7361  nc file to be sa
+00016920: 7665 642c 2073 7472 696e 670a 2020 2020  ved, string.    
+00016930: 2020 2020 6e63 5f66 696c 655f 7061 7468      nc_file_path
+00016940: 3a20 7468 6520 7061 7468 2074 6f20 7768  : the path to wh
+00016950: 6572 6520 7468 6520 6e63 2066 696c 6520  ere the nc file 
+00016960: 7769 6c6c 2062 6520 7361 7665 642c 2073  will be saved, s
+00016970: 7472 696e 670a 2020 2020 2020 2020 6461  tring.        da
+00016980: 7461 5f66 7261 6d65 5f44 6174 6554 696d  ta_frame_DateTim
+00016990: 655f 636f 6c75 6d6e 3a20 696e 2063 6173  e_column: in cas
+000169a0: 6520 6461 7461 5f66 7261 6d65 2069 7320  e data_frame is 
+000169b0: 7061 7468 2074 6f20 6373 7620 6669 6c65  path to csv file
+000169c0: 2074 6865 6e20 636f 6c75 6d6e 2064 6174   then column dat
+000169d0: 615f 6672 616d 655f 4461 7465 5469 6d65  a_frame_DateTime
+000169e0: 5f63 6f6c 756d 6e20 7368 6f75 6c64 2062  _column should b
+000169f0: 6520 7072 6f76 6964 6564 2c20 7374 7269  e provided, stri
+00016a00: 6e67 0a20 2020 2020 2020 2076 6172 6961  ng.        varia
+00016a10: 626c 655f 6e61 6d65 3a20 6e61 6d65 206f  ble_name: name o
+00016a20: 6620 7661 7269 6162 6c65 206e 616d 6520  f variable name 
+00016a30: 746f 2062 6520 7361 7665 6420 696e 206e  to be saved in n
+00016a40: 6320 6669 6c65 2c20 7374 7269 6e67 0a20  c file, string. 
+00016a50: 2020 2020 2020 2075 6e69 745f 6f66 5f76         unit_of_v
+00016a60: 6172 6961 626c 653a 2075 6e69 7420 6f66  ariable: unit of
+00016a70: 2076 6172 6961 626c 6520 6e61 6d65 2074   variable name t
+00016a80: 6f20 6265 2073 6176 6564 2069 6e20 6e63  o be saved in nc
+00016a90: 2066 696c 652c 2073 7472 696e 670a 2020   file, string.  
+00016aa0: 2020 2020 2020 7661 7269 6162 6c65 5f6c        variable_l
+00016ab0: 6f6e 675f 6e61 6d65 3a20 7661 7269 6162  ong_name: variab
+00016ac0: 6c65 206c 6f6e 6720 6e61 6d65 2074 6f20  le long name to 
+00016ad0: 6265 2073 6176 6564 2069 6e20 6e63 2066  be saved in nc f
+00016ae0: 696c 652c 2073 7472 696e 670a 2020 2020  ile, string.    
+00016af0: 2020 2020 4669 6c6c 5f76 616c 7565 3a20      Fill_value: 
+00016b00: 6669 6c6c 2076 616c 7565 2074 6f20 6265  fill value to be
+00016b10: 2073 6176 6564 2069 6e20 6e63 2066 696c   saved in nc fil
+00016b20: 652c 2073 7472 696e 670a 2020 2020 2020  e, string.      
+00016b30: 2020 7374 6174 696f 6e5f 696e 666f 5f64    station_info_d
+00016b40: 6174 613a 2070 616e 6461 7320 6461 7461  ata: pandas data
+00016b50: 6672 616d 6520 6f72 2070 6174 6820 746f  frame or path to
+00016b60: 2063 7376 2066 696c 6520 696e 636c 7564   csv file includ
+00016b70: 696e 6720 7468 6520 696e 666f 726d 6174  ing the informat
+00016b80: 696f 6e20 6f66 2073 7461 7469 6f6e 7320  ion of stations 
+00016b90: 6f72 2067 7269 6420 666f 7220 6461 7461  or grid for data
+00016ba0: 5f66 7261 6d65 0a20 2020 2020 2020 2073  _frame.        s
+00016bb0: 7461 7469 6f6e 5f69 6e66 6f5f 636f 6c75  tation_info_colu
+00016bc0: 6d6e 3a20 7468 6520 636f 6c75 6d6e 2074  mn: the column t
+00016bd0: 6861 7420 696e 636c 7564 6520 7468 6520  hat include the 
+00016be0: 696e 666f 726d 6174 696f 6e20 6f66 2073  information of s
+00016bf0: 7461 7469 6f6e 2066 726f 6d20 7374 6174  tation from stat
+00016c00: 696f 6e5f 696e 666f 5f64 6174 612c 2073  ion_info_data, s
+00016c10: 7472 696e 670a 2020 2020 2020 2020 2222  tring.        ""
+00016c20: 220a 0a20 2020 2020 2020 2023 2070 7265  "..        # pre
+00016c30: 7061 7261 7469 6f6e 206f 6620 6461 7461  paration of data
+00016c40: 7365 740a 2020 2020 2020 2020 6966 2069  set.        if i
+00016c50: 7369 6e73 7461 6e63 6528 6461 7461 5f66  sinstance(data_f
+00016c60: 7261 6d65 2c20 7064 2e44 6174 6146 7261  rame, pd.DataFra
+00016c70: 6d65 293a 0a20 2020 2020 2020 2020 2020  me):.           
+00016c80: 2070 7269 6e74 2827 4541 5359 4d4f 5245   print('EASYMORE
+00016c90: 2064 6574 6563 7473 2074 6861 7420 7468   detects that th
+00016ca0: 6520 696e 7075 7420 6461 7461 6661 7261  e input datafara
+00016cb0: 6d65 2069 7320 7061 6e64 6173 2064 6174  me is pandas dat
+00016cc0: 6166 7261 6d65 2729 0a20 2020 2020 2020  aframe').       
+00016cd0: 2020 2020 2069 6620 6973 696e 7374 616e       if isinstan
+00016ce0: 6365 2864 6174 615f 6672 616d 652e 696e  ce(data_frame.in
+00016cf0: 6465 782c 2070 642e 4461 7465 7469 6d65  dex, pd.Datetime
+00016d00: 496e 6465 7829 3a0a 2020 2020 2020 2020  Index):.        
+00016d10: 2020 2020 2020 2020 7072 696e 7428 2745          print('E
+00016d20: 4153 594d 4f52 4520 6465 7465 6374 7320  ASYMORE detects 
+00016d30: 7468 6174 2069 6e64 6578 2069 7320 7061  that index is pa
+00016d40: 6e64 6173 2064 6174 6174 696d 6527 290a  ndas datatime').
+00016d50: 2020 2020 2020 2020 2020 2020 656c 7365              else
+00016d60: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+00016d70: 2020 7379 732e 6578 6974 2827 4541 5359    sys.exit('EASY
+00016d80: 4d4f 5245 2064 6574 6563 7473 2074 6861  MORE detects tha
+00016d90: 7420 7468 6520 696e 6465 7820 6973 206e  t the index is n
+00016da0: 6f74 2064 6174 6574 696d 6520 696e 2064  ot datetime in d
+00016db0: 6174 6120 696e 7075 7420 6669 6c65 2e20  ata input file. 
+00016dc0: 272c 5c0a 2020 2020 2020 2020 2020 2020  ',\.            
+00016dd0: 2020 2020 2020 2020 2020 2020 2027 596f               'Yo
+00016de0: 7520 7573 6520 6461 7461 6672 616d 652e  u use dataframe.
+00016df0: 696e 6465 7820 3d20 7064 2e74 6f5f 6461  index = pd.to_da
+00016e00: 7465 7469 6d65 2864 6174 6166 7261 6d65  tetime(dataframe
+00016e10: 2e69 6e64 6578 2920 746f 206d 616b 6520  .index) to make 
+00016e20: 7375 7265 2027 2c5c 0a20 2020 2020 2020  sure ',\.       
+00016e30: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00016e40: 2020 2774 6865 2069 6e64 6578 2069 7320    'the index is 
+00016e50: 696e 203c 636c 6173 7320 7061 6e64 6173  in <class pandas
+00016e60: 2e63 6f72 652e 696e 6465 7865 732e 6461  .core.indexes.da
+00016e70: 7465 7469 6d65 732e 4461 7465 7469 6d65  tetimes.Datetime
+00016e80: 496e 6465 783e 2729 0a20 2020 2020 2020  Index>').       
+00016e90: 2065 6c69 6620 6973 696e 7374 616e 6365   elif isinstance
+00016ea0: 2864 6174 615f 6672 616d 652c 2073 7472  (data_frame, str
+00016eb0: 293a 0a20 2020 2020 2020 2020 2020 2069  ):.            i
+00016ec0: 6620 6461 7461 5f66 7261 6d65 5f44 6174  f data_frame_Dat
+00016ed0: 6554 696d 655f 636f 6c75 6d6e 2069 7320  eTime_column is 
+00016ee0: 4e6f 6e65 3a0a 2020 2020 2020 2020 2020  None:.          
+00016ef0: 2020 2020 2020 7379 732e 6578 6974 2827        sys.exit('
+00016f00: 6461 7461 6672 616d 6520 6973 2070 726f  dataframe is pro
+00016f10: 7669 6465 6420 6173 2073 7472 696e 6720  vided as string 
+00016f20: 6373 7620 6669 6c65 2c27 5c0a 2020 2020  csv file,'\.    
+00016f30: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00016f40: 2020 2020 202b 2770 6c65 6173 6520 7072       +'please pr
+00016f50: 6f76 6964 6520 7468 6520 6e61 6d65 206f  ovide the name o
+00016f60: 6620 7469 6d65 2069 6e64 6578 2063 6f6c  f time index col
+00016f70: 756d 6e27 290a 2020 2020 2020 2020 2020  umn').          
+00016f80: 2020 2320 7265 6164 2074 6865 2064 6174    # read the dat
+00016f90: 6120 6373 760a 2020 2020 2020 2020 2020  a csv.          
+00016fa0: 2020 6461 7461 5f66 7261 6d65 203d 2070    data_frame = p
+00016fb0: 642e 7265 6164 5f63 7376 2864 6174 615f  d.read_csv(data_
+00016fc0: 6672 616d 6529 0a20 2020 2020 2020 2020  frame).         
+00016fd0: 2020 2023 2063 6f6e 7665 7274 2074 6865     # convert the
+00016fe0: 2064 6174 6120 7469 6d65 206f 6620 7468   data time of th
+00016ff0: 6520 6461 7461 5f66 7261 6d65 2074 6f20  e data_frame to 
+00017000: 696e 6465 780a 2020 2020 2020 2020 2020  index.          
+00017010: 2020 6461 7461 5f66 7261 6d65 5b64 6174    data_frame[dat
+00017020: 615f 6672 616d 655f 4461 7465 5469 6d65  a_frame_DateTime
+00017030: 5f63 6f6c 756d 6e5d 203d 2070 642e 746f  _column] = pd.to
+00017040: 5f64 6174 6574 696d 6528 6461 7461 5f66  _datetime(data_f
+00017050: 7261 6d65 5b64 6174 615f 6672 616d 655f  rame[data_frame_
+00017060: 4461 7465 5469 6d65 5f63 6f6c 756d 6e5d  DateTime_column]
+00017070: 2c20 696e 6665 725f 6461 7465 7469 6d65  , infer_datetime
+00017080: 5f66 6f72 6d61 743d 5472 7565 290a 2020  _format=True).  
+00017090: 2020 2020 2020 2020 2020 6461 7461 5f66            data_f
+000170a0: 7261 6d65 203d 2064 6174 615f 6672 616d  rame = data_fram
+000170b0: 652e 7365 745f 696e 6465 7828 6461 7461  e.set_index(data
+000170c0: 5f66 7261 6d65 5f44 6174 6554 696d 655f  _frame_DateTime_
+000170d0: 636f 6c75 6d6e 2920 2320 7365 7420 6173  column) # set as
+000170e0: 2069 6e64 6578 0a20 2020 2020 2020 2020   index.         
+000170f0: 2020 2064 6174 615f 6672 616d 652e 696e     data_frame.in
+00017100: 6465 7820 3d20 7064 2e74 6f5f 6461 7465  dex = pd.to_date
+00017110: 7469 6d65 2864 6174 615f 6672 616d 652e  time(data_frame.
+00017120: 696e 6465 7829 2023 2066 726f 6d20 696e  index) # from in
+00017130: 6465 7820 746f 2064 6174 6574 696d 6520  dex to datetime 
+00017140: 696e 6465 780a 2020 2020 2020 2020 656c  index.        el
+00017150: 7365 3a0a 2020 2020 2020 2020 2020 2020  se:.            
+00017160: 7379 732e 6578 6974 2827 5468 6520 6461  sys.exit('The da
+00017170: 7461 2069 6e70 7574 2074 7970 6520 6973  ta input type is
+00017180: 206e 6f74 2072 6563 6f67 6e69 7a65 6427   not recognized'
+00017190: 290a 2020 2020 2020 2020 6461 7461 5f66  ).        data_f
+000171a0: 7261 6d65 203d 2064 6174 615f 6672 616d  rame = data_fram
+000171b0: 652e 7265 6e61 6d65 5f61 7869 7328 696e  e.rename_axis(in
+000171c0: 6465 783d 4e6f 6e65 2920 2320 7265 6d6f  dex=None) # remo
+000171d0: 7665 2070 6f73 7369 626c 6520 6e61 6d65  ve possible name
+000171e0: 206f 6620 7468 6520 696e 6465 7820 636f   of the index co
+000171f0: 6c75 6d6e 0a0a 2020 2020 2020 2020 2320  lumn..        # 
+00017200: 7072 6570 6172 6174 696f 6e20 6f66 2064  preparation of d
+00017210: 6174 6173 6574 5f69 6e66 6f0a 2020 2020  ataset_info.    
+00017220: 2020 2020 2320 656e 636f 6469 6e67 2066      # encoding f
+00017230: 6f72 2073 7461 7469 6f6e 2069 6e66 6f0a  or station info.
+00017240: 2020 2020 2020 2020 656e 636f 6469 6e67          encoding
+00017250: 203d 207b 7d0a 2020 2020 2020 2020 6966   = {}.        if
+00017260: 206e 6f74 2028 7374 6174 696f 6e5f 696e   not (station_in
+00017270: 666f 5f64 6174 6120 6973 204e 6f6e 6529  fo_data is None)
+00017280: 3a0a 2020 2020 2020 2020 2020 2020 6966  :.            if
+00017290: 206e 6f74 2073 7461 7469 6f6e 5f69 6e66   not station_inf
+000172a0: 6f5f 636f 6c75 6d6e 3a0a 2020 2020 2020  o_column:.      
+000172b0: 2020 2020 2020 2020 2020 7379 732e 6578            sys.ex
+000172c0: 6974 2827 5468 6520 7374 6174 696f 6e20  it('The station 
+000172d0: 6e61 6d65 2063 6f6c 756d 6e20 7368 6f75  name column shou
+000172e0: 6c64 2062 6520 7072 6f76 6964 6564 2729  ld be provided')
+000172f0: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
+00017300: 6973 696e 7374 616e 6365 2873 7461 7469  isinstance(stati
+00017310: 6f6e 5f69 6e66 6f5f 6461 7461 2c20 7064  on_info_data, pd
+00017320: 2e44 6174 6146 7261 6d65 293a 0a20 2020  .DataFrame):.   
+00017330: 2020 2020 2020 2020 2020 2020 2070 7269               pri
+00017340: 6e74 2827 4541 5359 4d4f 5245 2064 6574  nt('EASYMORE det
+00017350: 6563 7473 2074 6861 7420 7468 6520 7374  ects that the st
+00017360: 6174 696f 6e20 6461 7461 2069 7320 7061  ation data is pa
+00017370: 6e64 6173 2064 6174 6166 7261 6d65 2729  ndas dataframe')
+00017380: 0a20 2020 2020 2020 2020 2020 2065 6c69  .            eli
+00017390: 6620 6973 696e 7374 616e 6365 2873 7461  f isinstance(sta
+000173a0: 7469 6f6e 5f69 6e66 6f5f 6461 7461 2c20  tion_info_data, 
+000173b0: 7374 7229 3a0a 2020 2020 2020 2020 2020  str):.          
+000173c0: 2020 2020 2020 6966 2064 6174 615f 6672        if data_fr
+000173d0: 616d 655f 4461 7465 5469 6d65 5f63 6f6c  ame_DateTime_col
+000173e0: 756d 6e20 6973 204e 6f6e 653a 0a20 2020  umn is None:.   
+000173f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00017400: 2073 7973 2e65 7869 7428 2764 6174 6166   sys.exit('dataf
+00017410: 7261 6d65 2069 7320 7072 6f76 6964 6564  rame is provided
+00017420: 2061 7320 7374 7269 6e67 2063 7376 2066   as string csv f
+00017430: 696c 652c 2070 6c65 6173 6527 2b5c 0a20  ile, please'+\. 
+00017440: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00017450: 2020 2020 2020 2020 2020 2020 2720 7072              ' pr
+00017460: 6f76 6964 6520 7468 6520 6e61 6d65 206f  ovide the name o
+00017470: 6620 7469 6d65 2069 6e64 6578 2063 6f6c  f time index col
+00017480: 756d 6e27 290a 2020 2020 2020 2020 2020  umn').          
+00017490: 2020 2020 2020 2320 7265 6164 2074 6865        # read the
+000174a0: 2064 6174 6120 6373 760a 2020 2020 2020   data csv.      
+000174b0: 2020 2020 2020 2020 2020 7374 6174 696f            statio
+000174c0: 6e5f 696e 666f 5f64 6174 6120 3d20 7064  n_info_data = pd
+000174d0: 2e72 6561 645f 6373 7628 7374 6174 696f  .read_csv(statio
+000174e0: 6e5f 696e 666f 5f64 6174 6129 0a20 2020  n_info_data).   
+000174f0: 2020 2020 2020 2020 2065 6c73 653a 0a20           else:. 
+00017500: 2020 2020 2020 2020 2020 2020 2020 2073                 s
+00017510: 7973 2e65 7869 7428 2754 6865 2073 7461  ys.exit('The sta
+00017520: 7469 6f6e 2069 6e66 6f20 6461 7461 2069  tion info data i
+00017530: 6e70 7574 2074 7970 6520 6973 206e 6f74  nput type is not
+00017540: 2072 6563 6f67 6e69 7a65 6427 290a 2020   recognized').  
+00017550: 2020 2020 2020 2020 2020 7374 6174 696f            statio
+00017560: 6e5f 696e 666f 5f64 6174 6120 3d20 7374  n_info_data = st
+00017570: 6174 696f 6e5f 696e 666f 5f64 6174 612e  ation_info_data.
+00017580: 7365 745f 696e 6465 7828 7374 6174 696f  set_index(statio
+00017590: 6e5f 696e 666f 5f63 6f6c 756d 6e29 0a20  n_info_column). 
+000175a0: 2020 2020 2020 2020 2020 2073 7461 7469             stati
+000175b0: 6f6e 5f69 6e66 6f5f 6461 7461 203d 2073  on_info_data = s
+000175c0: 7461 7469 6f6e 5f69 6e66 6f5f 6461 7461  tation_info_data
+000175d0: 2e72 656e 616d 655f 6178 6973 2869 6e64  .rename_axis(ind
+000175e0: 6578 3d4e 6f6e 6529 0a20 2020 2020 2020  ex=None).       
+000175f0: 2020 2020 2023 2063 6865 636b 2069 6620       # check if 
+00017600: 616c 6c20 7374 6174 696f 6e20 696e 666f  all station info
+00017610: 2069 6e66 6f20 6973 2065 7873 6974 696e   info is exsitin
+00017620: 6720 696e 2074 6865 2073 7461 7469 6f6e  g in the station
+00017630: 2069 6e66 6f0a 2020 2020 2020 2020 2020   info.          
+00017640: 2020 6966 2073 6574 286c 6973 7428 6461    if set(list(da
+00017650: 7461 5f66 7261 6d65 2e63 6f6c 756d 6e73  ta_frame.columns
+00017660: 2929 203c 3d20 7365 7428 6c69 7374 2873  )) <= set(list(s
+00017670: 7461 7469 6f6e 5f69 6e66 6f5f 6461 7461  tation_info_data
+00017680: 2e63 6f6c 756d 6e73 2929 3a0a 2020 2020  .columns)):.    
+00017690: 2020 2020 2020 2020 2020 2020 7072 696e              prin
+000176a0: 7428 2745 4153 594d 4f52 4520 6465 7465  t('EASYMORE dete
+000176b0: 6374 7320 7468 6174 2074 6865 206e 6563  cts that the nec
+000176c0: 6573 7361 7279 2069 6e66 6f72 6d61 7469  essary informati
+000176d0: 6f6e 2066 6f72 2074 6865 2073 7461 7469  on for the stati
+000176e0: 6f6e 2061 7265 2070 726f 7669 6465 6427  on are provided'
+000176f0: 290a 2020 2020 2020 2020 2020 2020 656c  ).            el
+00017700: 7365 3a0a 2020 2020 2020 2020 2020 2020  se:.            
+00017710: 2020 2020 2320 7472 7920 7472 616e 706f      # try tranpo
+00017720: 7369 6e67 2074 6865 2073 7461 7469 6f6e  sing the station
+00017730: 2069 6e66 6f0a 2020 2020 2020 2020 2020   info.          
+00017740: 2020 2020 2020 7374 6174 696f 6e5f 696e        station_in
+00017750: 666f 5f64 6174 6120 3d20 7374 6174 696f  fo_data = statio
+00017760: 6e5f 696e 666f 5f64 6174 612e 7472 616e  n_info_data.tran
+00017770: 7370 6f73 6528 290a 2020 2020 2020 2020  spose().        
+00017780: 2020 2020 2020 2020 6966 2073 6574 286c          if set(l
+00017790: 6973 7428 6461 7461 5f66 7261 6d65 2e63  ist(data_frame.c
+000177a0: 6f6c 756d 6e73 2929 203c 3d20 7365 7428  olumns)) <= set(
+000177b0: 6c69 7374 2873 7461 7469 6f6e 5f69 6e66  list(station_inf
+000177c0: 6f5f 6461 7461 2e63 6f6c 756d 6e73 2929  o_data.columns))
+000177d0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+000177e0: 2020 2020 2020 7072 696e 7428 2745 4153        print('EAS
+000177f0: 594d 4f52 4520 6465 7465 6374 7320 7468  YMORE detects th
+00017800: 6174 2074 6865 206e 6563 6573 7361 7279  at the necessary
+00017810: 2069 6e66 6f72 6d61 7469 6f6e 2066 6f72   information for
+00017820: 2074 6865 2073 7461 7469 6f6e 2061 7265   the station are
+00017830: 2070 726f 7669 6465 6420 7769 7468 2074   provided with t
+00017840: 7261 6e73 706f 7365 2729 0a20 2020 2020  ranspose').     
+00017850: 2020 2020 2020 2020 2020 2065 6c73 653a             else:
+00017860: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00017870: 2020 2020 2073 7973 2e65 7869 7428 2745       sys.exit('E
+00017880: 4153 594d 4f52 4520 6465 7465 6374 7320  ASYMORE detects 
+00017890: 7468 6520 6461 7461 2066 7261 6d65 2070  the data frame p
+000178a0: 726f 7669 6465 6420 666f 7220 6461 7461  rovided for data
+000178b0: 2c20 636f 6c75 6d6e 7320 6e61 6d65 732c  , columns names,
+000178c0: 2027 2b5c 0a20 2020 2020 2020 2020 2020   '+\.           
+000178d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000178e0: 2020 2761 7265 2070 6172 746c 7920 6d69    'are partly mi
+000178f0: 7373 696e 6720 696e 2074 6865 2073 7461  ssing in the sta
+00017900: 7469 6f6e 2069 6e66 6f72 6d61 7469 6f6e  tion information
+00017910: 2729 0a20 2020 2020 2020 2020 2020 2023  ').            #
+00017920: 2073 7562 7365 7420 7468 6520 7374 6174   subset the stat
+00017930: 696f 6e20 696e 6672 6f6d 6174 696f 6e20  ion infromation 
+00017940: 666f 7220 7468 6520 7072 6f76 6964 6564  for the provided
+00017950: 2064 6174 610a 2020 2020 2020 2020 2020   data.          
+00017960: 2020 7374 6174 696f 6e5f 696e 666f 5f64    station_info_d
+00017970: 6174 6120 3d20 7374 6174 696f 6e5f 696e  ata = station_in
+00017980: 666f 5f64 6174 6120 5b73 7461 7469 6f6e  fo_data [station
+00017990: 5f69 6e66 6f5f 6461 7461 2e63 6f6c 756d  _info_data.colum
+000179a0: 6e73 2e69 6e74 6572 7365 6374 696f 6e28  ns.intersection(
+000179b0: 6c69 7374 2864 6174 615f 6672 616d 652e  list(data_frame.
+000179c0: 636f 6c75 6d6e 7329 295d 0a20 2020 2020  columns))].     
+000179d0: 2020 2020 2020 2064 6174 615f 6672 616d         data_fram
+000179e0: 6520 3d20 6461 7461 5f66 7261 6d65 5b6c  e = data_frame[l
+000179f0: 6973 7428 7374 6174 696f 6e5f 696e 666f  ist(station_info
+00017a00: 5f64 6174 612e 636f 6c75 6d6e 7329 5d20  _data.columns)] 
+00017a10: 2320 7265 6f72 6465 7220 636f 6c75 6d6e  # reorder column
+00017a20: 7320 746f 206d 6174 6368 2073 7461 7469  s to match stati
+00017a30: 6f6e 2069 6e74 6f0a 2020 2020 2020 2020  on into.        
+00017a40: 2020 2020 2320 656e 636f 6469 6e67 0a20      # encoding. 
+00017a50: 2020 2020 2020 2020 2020 2073 7461 7469             stati
+00017a60: 6f6e 5f69 6e66 6f5f 6461 7461 5f74 7970  on_info_data_typ
+00017a70: 6520 3d20 7365 6c66 2e63 6865 636b 5f69  e = self.check_i
+00017a80: 665f 726f 775f 6973 5f6e 756d 6572 6963  f_row_is_numeric
+00017a90: 2028 7374 6174 696f 6e5f 696e 666f 5f64   (station_info_d
+00017aa0: 6174 6129 0a20 2020 2020 2020 2020 2020  ata).           
+00017ab0: 2066 6f72 2069 6e64 6578 2c20 726f 7720   for index, row 
+00017ac0: 696e 2073 7461 7469 6f6e 5f69 6e66 6f5f  in station_info_
+00017ad0: 6461 7461 5f74 7970 652e 6974 6572 726f  data_type.iterro
+00017ae0: 7773 2829 3a0a 2020 2020 2020 2020 2020  ws():.          
+00017af0: 2020 2020 2020 7465 6d70 203d 207b 7d0a        temp = {}.
+00017b00: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00017b10: 6966 2072 6f77 5b27 726f 775f 7479 7065  if row['row_type
+00017b20: 275d 203d 3d20 2769 6e74 273a 0a20 2020  '] == 'int':.   
 00017b30: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00017b40: 2020 2872 6774 5b33 5d20 2b20 2873 7263    (rgt[3] + (src
-00017b50: 5f6f 6666 7365 745b 315d 202a 2072 6774  _offset[1] * rgt
-00017b60: 5b35 5d29 292c 0a20 2020 2020 2020 2020  [5])),.         
-00017b70: 2020 2020 2020 2020 2020 2030 2e30 2c0a             0.0,.
-00017b80: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00017b90: 2020 2020 7267 745b 355d 0a20 2020 2020      rgt[5].     
-00017ba0: 2020 2020 2020 2020 2020 2029 0a20 2020             ).   
-00017bb0: 2020 2020 2020 2020 2069 6620 7372 635f           if src_
-00017bc0: 6172 7261 7920 6973 206e 6f74 204e 6f6e  array is not Non
-00017bd0: 653a 0a20 2020 2020 2020 2020 2020 2020  e:.             
-00017be0: 2020 2023 2043 7265 6174 6520 6120 7465     # Create a te
-00017bf0: 6d70 6f72 6172 7920 7665 6374 6f72 206c  mporary vector l
-00017c00: 6179 6572 2069 6e20 6d65 6d6f 7279 0a20  ayer in memory. 
-00017c10: 2020 2020 2020 2020 2020 2020 2020 206d                 m
-00017c20: 656d 5f64 7320 3d20 6d65 6d5f 6472 762e  em_ds = mem_drv.
-00017c30: 4372 6561 7465 4461 7461 536f 7572 6365  CreateDataSource
-00017c40: 2827 6f75 7427 290a 2020 2020 2020 2020  ('out').        
-00017c50: 2020 2020 2020 2020 6d65 6d5f 6c61 7965          mem_laye
-00017c60: 7220 3d20 6d65 6d5f 6473 2e43 7265 6174  r = mem_ds.Creat
-00017c70: 654c 6179 6572 2827 706f 6c79 272c 204e  eLayer('poly', N
-00017c80: 6f6e 652c 206f 6772 2e77 6b62 506f 6c79  one, ogr.wkbPoly
-00017c90: 676f 6e29 0a20 2020 2020 2020 2020 2020  gon).           
-00017ca0: 2020 2020 206d 656d 5f6c 6179 6572 2e43       mem_layer.C
-00017cb0: 7265 6174 6546 6561 7475 7265 2866 6561  reateFeature(fea
-00017cc0: 742e 436c 6f6e 6528 2929 0a20 2020 2020  t.Clone()).     
-00017cd0: 2020 2020 2020 2020 2020 2023 2052 6173             # Ras
-00017ce0: 7465 7269 7a65 2069 740a 2020 2020 2020  terize it.      
-00017cf0: 2020 2020 2020 2020 2020 7276 6473 203d            rvds =
-00017d00: 2064 7269 7665 722e 4372 6561 7465 2827   driver.Create('
-00017d10: 272c 2073 7263 5f6f 6666 7365 745b 325d  ', src_offset[2]
-00017d20: 2c20 7372 635f 6f66 6673 6574 5b33 5d2c  , src_offset[3],
-00017d30: 2031 2c20 6764 616c 2e47 4454 5f42 7974   1, gdal.GDT_Byt
-00017d40: 6529 0a20 2020 2020 2020 2020 2020 2020  e).             
-00017d50: 2020 2072 7664 732e 5365 7447 656f 5472     rvds.SetGeoTr
-00017d60: 616e 7366 6f72 6d28 6e65 775f 6774 290a  ansform(new_gt).
-00017d70: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00017d80: 6764 616c 2e52 6173 7465 7269 7a65 4c61  gdal.RasterizeLa
-00017d90: 7965 7228 7276 6473 2c20 5b31 5d2c 206d  yer(rvds, [1], m
-00017da0: 656d 5f6c 6179 6572 2c20 6275 726e 5f76  em_layer, burn_v
-00017db0: 616c 7565 733d 5b31 5d29 0a20 2020 2020  alues=[1]).     
-00017dc0: 2020 2020 2020 2020 2020 2072 765f 6172             rv_ar
-00017dd0: 7261 7920 3d20 7276 6473 2e52 6561 6441  ray = rvds.ReadA
-00017de0: 7341 7272 6179 2829 0a20 2020 2020 2020  sArray().       
-00017df0: 2020 2020 2020 2020 2023 204d 6173 6b20           # Mask 
-00017e00: 7468 6520 736f 7572 6365 2064 6174 6120  the source data 
-00017e10: 6172 7261 7920 7769 7468 206f 7572 2063  array with our c
-00017e20: 7572 7265 6e74 2066 6561 7475 7265 0a20  urrent feature. 
-00017e30: 2020 2020 2020 2020 2020 2020 2020 2023                 #
-00017e40: 2077 6520 7461 6b65 2074 6865 206c 6f67   we take the log
-00017e50: 6963 616c 5f6e 6f74 2074 6f20 666c 6970  ical_not to flip
-00017e60: 2030 3c2d 3e31 2074 6f20 6765 7420 7468   0<->1 to get th
-00017e70: 6520 636f 7272 6563 7420 6d61 736b 2065  e correct mask e
-00017e80: 6666 6563 740a 2020 2020 2020 2020 2020  ffect.          
-00017e90: 2020 2020 2020 2320 7765 2061 6c73 6f20        # we also 
-00017ea0: 6d61 736b 206f 7574 206e 6f64 6174 6120  mask out nodata 
-00017eb0: 7661 6c75 6573 2065 7870 6c69 6374 6c79  values explictly
-00017ec0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00017ed0: 206d 6173 6b65 6420 3d20 6e70 2e6d 612e   masked = np.ma.
-00017ee0: 4d61 736b 6564 4172 7261 7928 0a20 2020  MaskedArray(.   
-00017ef0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00017f00: 2073 7263 5f61 7272 6179 2c0a 2020 2020   src_array,.    
+00017b40: 2074 656d 7020 3d20 7b69 6e64 6578 3a20   temp = {index: 
+00017b50: 7b27 6474 7970 6527 3a20 2769 6e74 3332  {'dtype': 'int32
+00017b60: 277d 7d0a 2020 2020 2020 2020 2020 2020  '}}.            
+00017b70: 2020 2020 2020 2020 7374 6174 696f 6e5f          station_
+00017b80: 696e 666f 5f64 6174 612e 6c6f 635b 696e  info_data.loc[in
+00017b90: 6465 785d 203d 2073 7461 7469 6f6e 5f69  dex] = station_i
+00017ba0: 6e66 6f5f 6461 7461 2e6c 6f63 5b69 6e64  nfo_data.loc[ind
+00017bb0: 6578 5d2e 6173 7479 7065 2869 6e74 290a  ex].astype(int).
+00017bc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00017bd0: 6966 2072 6f77 5b27 726f 775f 7479 7065  if row['row_type
+00017be0: 275d 203d 3d20 2766 6c6f 6174 273a 0a20  '] == 'float':. 
+00017bf0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00017c00: 2020 2074 656d 7020 3d20 7b69 6e64 6578     temp = {index
+00017c10: 3a20 7b27 6474 7970 6527 3a20 2766 6c6f  : {'dtype': 'flo
+00017c20: 6174 3634 277d 7d0a 2020 2020 2020 2020  at64'}}.        
+00017c30: 2020 2020 2020 2020 2020 2020 7374 6174              stat
+00017c40: 696f 6e5f 696e 666f 5f64 6174 612e 6c6f  ion_info_data.lo
+00017c50: 635b 696e 6465 785d 203d 2073 7461 7469  c[index] = stati
+00017c60: 6f6e 5f69 6e66 6f5f 6461 7461 2e6c 6f63  on_info_data.loc
+00017c70: 5b69 6e64 6578 5d2e 6173 7479 7065 2866  [index].astype(f
+00017c80: 6c6f 6174 290a 2020 2020 2020 2020 2020  loat).          
+00017c90: 2020 2020 2020 656e 636f 6469 6e67 2e75        encoding.u
+00017ca0: 7064 6174 6528 7465 6d70 290a 2020 2020  pdate(temp).    
+00017cb0: 2020 2020 2020 2020 7374 6174 696f 6e5f          station_
+00017cc0: 696e 666f 5f64 6174 6120 3d20 7374 6174  info_data = stat
+00017cd0: 696f 6e5f 696e 666f 5f64 6174 612e 7472  ion_info_data.tr
+00017ce0: 616e 7370 6f73 6528 290a 2020 2020 2020  anspose().      
+00017cf0: 2020 656c 7365 3a0a 2020 2020 2020 2020    else:.        
+00017d00: 2020 2020 7374 6174 696f 6e5f 696e 666f      station_info
+00017d10: 5f64 6174 6120 3d20 7064 2e44 6174 6146  _data = pd.DataF
+00017d20: 7261 6d65 286e 702e 6172 616e 6765 286c  rame(np.arange(l
+00017d30: 656e 2864 6174 615f 6672 616d 652e 636f  en(data_frame.co
+00017d40: 6c75 6d6e 7329 292b 312c 5c0a 2020 2020  lumns))+1,\.    
+00017d50: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00017d60: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00017d70: 2020 2020 2020 2020 2069 6e64 6578 3d64           index=d
+00017d80: 6174 615f 6672 616d 652e 636f 6c75 6d6e  ata_frame.column
+00017d90: 732c 5c0a 2020 2020 2020 2020 2020 2020  s,\.            
+00017da0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00017db0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00017dc0: 2063 6f6c 756d 6e73 3d5b 2749 4427 5d29   columns=['ID'])
+00017dd0: 0a20 2020 2020 2020 2023 2072 656e 616d  .        # renam
+00017de0: 6520 7468 6520 6469 6d65 6e73 696f 6e0a  e the dimension.
+00017df0: 2020 2020 2020 2020 6966 2073 7461 7469          if stati
+00017e00: 6f6e 5f69 6e66 6f5f 6461 7461 2e69 6e64  on_info_data.ind
+00017e10: 6578 2e6e 616d 6520 6973 204e 6f6e 653a  ex.name is None:
+00017e20: 0a20 2020 2020 2020 2020 2020 2073 7461  .            sta
+00017e30: 7469 6f6e 5f69 6e66 6f5f 6461 7461 2e69  tion_info_data.i
+00017e40: 6e64 6578 2e6e 616d 6520 3d20 7661 7269  ndex.name = vari
+00017e50: 6162 6c65 5f64 696d 5f6e 616d 650a 2020  able_dim_name.  
+00017e60: 2020 2020 2020 230a 2020 2020 2020 2020        #.        
+00017e70: 696e 666f 203d 2078 722e 4461 7461 7365  info = xr.Datase
+00017e80: 7428 7374 6174 696f 6e5f 696e 666f 5f64  t(station_info_d
+00017e90: 6174 612e 746f 5f78 6172 7261 7928 2929  ata.to_xarray())
+00017ea0: 0a0a 2020 2020 2020 2020 2320 6461 7461  ..        # data
+00017eb0: 0a20 2020 2020 2020 2064 6174 6120 3d20  .        data = 
+00017ec0: 7872 2e44 6174 6173 6574 2864 6174 615f  xr.Dataset(data_
+00017ed0: 7661 7273 3d64 6963 7428 7661 6c75 6573  vars=dict(values
+00017ee0: 3d28 5b22 7469 6d65 222c 2073 7461 7469  =(["time", stati
+00017ef0: 6f6e 5f69 6e66 6f5f 6461 7461 2e69 6e64  on_info_data.ind
+00017f00: 6578 2e6e 616d 655d 2c5c 0a20 2020 2020  ex.name],\.     
 00017f10: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00017f20: 6d61 736b 3d6e 702e 6c6f 6769 6361 6c5f  mask=np.logical_
-00017f30: 6f72 280a 2020 2020 2020 2020 2020 2020  or(.            
-00017f40: 2020 2020 2020 2020 2020 2020 7372 635f              src_
-00017f50: 6172 7261 7920 3d3d 206e 6f64 6174 615f  array == nodata_
-00017f60: 7661 6c75 652c 0a20 2020 2020 2020 2020  value,.         
-00017f70: 2020 2020 2020 2020 2020 2020 2020 206e                 n
-00017f80: 702e 6c6f 6769 6361 6c5f 6e6f 7428 7276  p.logical_not(rv
-00017f90: 5f61 7272 6179 290a 2020 2020 2020 2020  _array).        
-00017fa0: 2020 2020 2020 2020 2020 2020 290a 2020              ).  
-00017fb0: 2020 2020 2020 2020 2020 2020 2020 290a                ).
-00017fc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00017fd0: 6966 2068 6973 746f 6772 616d 3a0a 2020  if histogram:.  
-00017fe0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00017ff0: 2020 6d61 736b 6564 5f6e 756d 7079 203d    masked_numpy =
-00018000: 206e 702e 6d61 2e66 696c 6c65 6428 6d61   np.ma.filled(ma
-00018010: 736b 6564 2e61 7374 7970 6528 666c 6f61  sked.astype(floa
-00018020: 7429 2c20 6e70 2e6e 616e 290a 2020 2020  t), np.nan).    
-00018030: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00018040: 6d61 736b 6564 5f6e 756d 7079 203d 206d  masked_numpy = m
-00018050: 6173 6b65 645f 6e75 6d70 795b 7e6e 702e  asked_numpy[~np.
-00018060: 6973 6e61 6e28 6d61 736b 6564 5f6e 756d  isnan(masked_num
-00018070: 7079 295d 0a20 2020 2020 2020 2020 2020  py)].           
-00018080: 2020 2020 2020 2020 206d 6173 6b65 645f           masked_
-00018090: 6e75 6d70 795f 6269 6e20 3d20 6e70 2e75  numpy_bin = np.u
-000180a0: 6e69 7175 6528 6d61 736b 6564 5f6e 756d  nique(masked_num
-000180b0: 7079 290a 2020 2020 2020 2020 2020 2020  py).            
-000180c0: 2020 2020 2020 2020 6d61 736b 6564 5f6e          masked_n
-000180d0: 756d 7079 5f62 696e 203d 206e 702e 6170  umpy_bin = np.ap
-000180e0: 7065 6e64 286d 6173 6b65 645f 6e75 6d70  pend(masked_nump
-000180f0: 795f 6269 6e2d 302e 3030 3030 3030 3031  y_bin-0.00000001
-00018100: 2c20 6d61 736b 6564 5f6e 756d 7079 5f62  , masked_numpy_b
-00018110: 696e 5b2d 315d 2b30 2e30 3030 3030 3030  in[-1]+0.0000000
-00018120: 3031 290a 2020 2020 2020 2020 2020 2020  01).            
-00018130: 2020 2020 2020 2020 6665 6174 7572 655f          feature_
-00018140: 7374 6174 7320 3d20 7b0a 2020 2020 2020  stats = {.      
-00018150: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00018160: 2020 276d 696e 273a 2066 6c6f 6174 286d    'min': float(m
-00018170: 6173 6b65 642e 6d69 6e28 2929 2c0a 2020  asked.min()),.  
-00018180: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00018190: 2020 2020 2020 276d 6561 6e27 3a20 666c        'mean': fl
-000181a0: 6f61 7428 6d61 736b 6564 2e6d 6561 6e28  oat(masked.mean(
-000181b0: 2929 2c0a 2020 2020 2020 2020 2020 2020  )),.            
-000181c0: 2020 2020 2020 2020 2020 2020 276d 6178              'max
-000181d0: 273a 2066 6c6f 6174 286d 6173 6b65 642e  ': float(masked.
-000181e0: 6d61 7828 2929 2c0a 2020 2020 2020 2020  max()),.        
-000181f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00018200: 2773 7464 273a 2066 6c6f 6174 286d 6173  'std': float(mas
-00018210: 6b65 642e 7374 6428 2929 2c0a 2020 2020  ked.std()),.    
-00018220: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00018230: 2020 2020 2773 756d 273a 2066 6c6f 6174      'sum': float
-00018240: 286d 6173 6b65 642e 7375 6d28 2929 2c0a  (masked.sum()),.
-00018250: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00018260: 2020 2020 2020 2020 2763 6f75 6e74 273a          'count':
-00018270: 2069 6e74 286d 6173 6b65 642e 636f 756e   int(masked.coun
-00018280: 7428 2929 2c0a 2020 2020 2020 2020 2020  t()),.          
-00018290: 2020 2020 2020 2020 2020 2020 2020 2766                'f
-000182a0: 6964 273a 2069 6e74 2866 6561 742e 4765  id': int(feat.Ge
-000182b0: 7446 4944 2829 292c 0a20 2020 2020 2020  tFID()),.       
-000182c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000182d0: 2027 756e 6971 7565 273a 2073 7472 286e   'unique': str(n
-000182e0: 702e 756e 6971 7565 286d 6173 6b65 645f  p.unique(masked_
-000182f0: 6e75 6d70 7929 292c 0a20 2020 2020 2020  numpy)),.       
-00018300: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00018310: 2027 6672 6571 273a 2073 7472 286e 702e   'freq': str(np.
-00018320: 6869 7374 6f67 7261 6d28 6d61 736b 6564  histogram(masked
-00018330: 5f6e 756d 7079 2c62 696e 733d 6d61 736b  _numpy,bins=mask
-00018340: 6564 5f6e 756d 7079 5f62 696e 295b 305d  ed_numpy_bin)[0]
-00018350: 292c 0a20 2020 2020 2020 2020 2020 2020  ),.             
-00018360: 2020 2020 2020 2020 2020 2027 7065 7263             'perc
-00018370: 656e 7427 3a20 7374 7228 6e70 2e68 6973  ent': str(np.his
-00018380: 746f 6772 616d 286d 6173 6b65 645f 6e75  togram(masked_nu
-00018390: 6d70 792c 6269 6e73 3d6d 6173 6b65 645f  mpy,bins=masked_
-000183a0: 6e75 6d70 795f 6269 6e29 5b30 5d2f 6d61  numpy_bin)[0]/ma
-000183b0: 736b 6564 2e63 6f75 6e74 2829 2a31 3030  sked.count()*100
-000183c0: 297d 0a20 2020 2020 2020 2020 2020 2020  )}.             
-000183d0: 2020 2065 6c73 653a 0a20 2020 2020 2020     else:.       
-000183e0: 2020 2020 2020 2020 2020 2020 2066 6561               fea
-000183f0: 7475 7265 5f73 7461 7473 203d 207b 0a20  ture_stats = {. 
-00018400: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00018410: 2020 2020 2020 2027 6d69 6e27 3a20 666c         'min': fl
-00018420: 6f61 7428 6d61 736b 6564 2e6d 696e 2829  oat(masked.min()
-00018430: 292c 0a20 2020 2020 2020 2020 2020 2020  ),.             
-00018440: 2020 2020 2020 2020 2020 2027 6d65 616e             'mean
-00018450: 273a 2066 6c6f 6174 286d 6173 6b65 642e  ': float(masked.
-00018460: 6d65 616e 2829 292c 0a20 2020 2020 2020  mean()),.       
-00018470: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00018480: 2027 6d61 7827 3a20 666c 6f61 7428 6d61   'max': float(ma
-00018490: 736b 6564 2e6d 6178 2829 292c 0a20 2020  sked.max()),.   
-000184a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000184b0: 2020 2020 2027 7374 6427 3a20 666c 6f61       'std': floa
-000184c0: 7428 6d61 736b 6564 2e73 7464 2829 292c  t(masked.std()),
-000184d0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-000184e0: 2020 2020 2020 2020 2027 7375 6d27 3a20           'sum': 
-000184f0: 666c 6f61 7428 6d61 736b 6564 2e73 756d  float(masked.sum
-00018500: 2829 292c 0a20 2020 2020 2020 2020 2020  ()),.           
-00018510: 2020 2020 2020 2020 2020 2020 2027 636f               'co
-00018520: 756e 7427 3a20 696e 7428 6d61 736b 6564  unt': int(masked
-00018530: 2e63 6f75 6e74 2829 292c 0a20 2020 2020  .count()),.     
-00018540: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00018550: 2020 2027 6669 6427 3a20 696e 7428 6665     'fid': int(fe
-00018560: 6174 2e47 6574 4649 4428 2929 2c0a 2020  at.GetFID()),.  
-00018570: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00018580: 2020 2020 2020 2775 6e69 7175 6527 3a20        'unique': 
-00018590: 274e 614e 272c 0a20 2020 2020 2020 2020  'NaN',.         
-000185a0: 2020 2020 2020 2020 2020 2020 2020 2027                 '
-000185b0: 6672 6571 273a 2027 4e61 4e27 2c0a 2020  freq': 'NaN',.  
-000185c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000185d0: 2020 2020 2020 2770 6572 6365 6e74 273a        'percent':
-000185e0: 2027 4e61 4e27 7d0a 2020 2020 2020 2020   'NaN'}.        
-000185f0: 2020 2020 656c 7365 3a0a 2020 2020 2020      else:.      
-00018600: 2020 2020 2020 2020 2020 6665 6174 7572            featur
-00018610: 655f 7374 6174 7320 3d20 7b0a 2020 2020  e_stats = {.    
-00018620: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00018630: 276d 696e 273a 2027 4e61 4e27 2c0a 2020  'min': 'NaN',.  
-00018640: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00018650: 2020 276d 6561 6e27 3a20 274e 614e 272c    'mean': 'NaN',
-00018660: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00018670: 2020 2020 2027 6d61 7827 3a20 274e 614e       'max': 'NaN
-00018680: 272c 0a20 2020 2020 2020 2020 2020 2020  ',.             
-00018690: 2020 2020 2020 2027 7374 6427 3a20 274e         'std': 'N
-000186a0: 614e 272c 0a20 2020 2020 2020 2020 2020  aN',.           
-000186b0: 2020 2020 2020 2020 2027 7375 6d27 3a20           'sum': 
-000186c0: 274e 614e 272c 0a20 2020 2020 2020 2020  'NaN',.         
-000186d0: 2020 2020 2020 2020 2020 2027 636f 756e             'coun
-000186e0: 7427 3a20 274e 614e 272c 0a20 2020 2020  t': 'NaN',.     
-000186f0: 2020 2020 2020 2020 2020 2020 2020 2027                 '
-00018700: 6669 6427 3a20 274e 614e 272c 0a20 2020  fid': 'NaN',.   
-00018710: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00018720: 2027 756e 6971 7565 273a 2027 4e61 4e27   'unique': 'NaN'
-00018730: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
-00018740: 2020 2020 2020 2766 7265 7127 3a20 274e        'freq': 'N
-00018750: 614e 272c 0a20 2020 2020 2020 2020 2020  aN',.           
-00018760: 2020 2020 2020 2020 2027 7065 7263 656e           'percen
-00018770: 7427 3a20 274e 614e 277d 0a20 2020 2020  t': 'NaN'}.     
-00018780: 2020 2020 2020 2073 7461 7473 2e61 7070         stats.app
-00018790: 656e 6428 6665 6174 7572 655f 7374 6174  end(feature_stat
-000187a0: 7329 0a20 2020 2020 2020 2020 2020 2072  s).            r
-000187b0: 7664 7320 3d20 4e6f 6e65 0a20 2020 2020  vds = None.     
-000187c0: 2020 2020 2020 206d 656d 5f64 7320 3d20         mem_ds = 
-000187d0: 4e6f 6e65 0a20 2020 2020 2020 2020 2020  None.           
-000187e0: 2066 6561 7420 3d20 766c 7972 2e47 6574   feat = vlyr.Get
-000187f0: 4e65 7874 4665 6174 7572 6528 290a 2020  NextFeature().  
-00018800: 2020 2020 2020 7664 7320 3d20 4e6f 6e65        vds = None
-00018810: 0a20 2020 2020 2020 2072 6473 203d 204e  .        rds = N
-00018820: 6f6e 650a 2020 2020 2020 2020 7374 6174  one.        stat
-00018830: 7320 3d20 7064 2e44 6174 6146 7261 6d65  s = pd.DataFrame
-00018840: 2873 7461 7473 290a 2020 2020 2020 2020  (stats).        
-00018850: 7368 7020 3d20 6770 642e 7265 6164 5f66  shp = gpd.read_f
-00018860: 696c 6528 7665 6374 6f72 5f70 6174 6829  ile(vector_path)
-00018870: 0a20 2020 2020 2020 2073 6870 205b 276d  .        shp ['m
-00018880: 696e 275d 203d 2073 7461 7473 5b27 6d69  in'] = stats['mi
-00018890: 6e27 5d2e 6173 7479 7065 2866 6c6f 6174  n'].astype(float
-000188a0: 290a 2020 2020 2020 2020 7368 7020 5b27  ).        shp ['
-000188b0: 6d65 616e 275d 203d 2073 7461 7473 5b27  mean'] = stats['
-000188c0: 6d65 616e 275d 2e61 7374 7970 6528 666c  mean'].astype(fl
-000188d0: 6f61 7429 0a20 2020 2020 2020 2073 6870  oat).        shp
-000188e0: 205b 276d 6178 275d 203d 2073 7461 7473   ['max'] = stats
-000188f0: 5b27 6d61 7827 5d2e 6173 7479 7065 2866  ['max'].astype(f
-00018900: 6c6f 6174 290a 2020 2020 2020 2020 7368  loat).        sh
-00018910: 7020 5b27 7374 6427 5d20 3d20 7374 6174  p ['std'] = stat
-00018920: 735b 2773 7464 275d 2e61 7374 7970 6528  s['std'].astype(
-00018930: 666c 6f61 7429 0a20 2020 2020 2020 2073  float).        s
-00018940: 6870 205b 2773 756d 275d 203d 2073 7461  hp ['sum'] = sta
-00018950: 7473 5b27 7375 6d27 5d2e 6173 7479 7065  ts['sum'].astype
-00018960: 2866 6c6f 6174 290a 2020 2020 2020 2020  (float).        
-00018970: 7368 7020 5b27 636f 756e 7427 5d20 3d20  shp ['count'] = 
-00018980: 7374 6174 735b 2763 6f75 6e74 275d 2e61  stats['count'].a
-00018990: 7374 7970 6528 666c 6f61 7429 0a20 2020  stype(float).   
-000189a0: 2020 2020 2073 6870 205b 2766 6964 275d       shp ['fid']
-000189b0: 203d 2020 7374 6174 735b 2766 6964 275d   =  stats['fid']
-000189c0: 2e61 7374 7970 6528 666c 6f61 7429 0a20  .astype(float). 
-000189d0: 2020 2020 2020 2069 6620 6869 7374 6f67         if histog
-000189e0: 7261 6d3a 0a20 2020 2020 2020 2020 2020  ram:.           
-000189f0: 2073 6870 205b 2775 6e69 7175 6527 5d20   shp ['unique'] 
-00018a00: 3d20 2073 7461 7473 5b27 756e 6971 7565  =  stats['unique
-00018a10: 275d 2e61 7374 7970 6528 7374 7229 0a20  '].astype(str). 
-00018a20: 2020 2020 2020 2020 2020 2073 6870 205b             shp [
-00018a30: 2766 7265 7127 5d20 3d20 2073 7461 7473  'freq'] =  stats
-00018a40: 5b27 6672 6571 275d 2e61 7374 7970 6528  ['freq'].astype(
-00018a50: 7374 7229 0a20 2020 2020 2020 2020 2020  str).           
-00018a60: 2073 6870 205b 2770 6572 6365 6e74 275d   shp ['percent']
-00018a70: 203d 2020 7374 6174 735b 2770 6572 6365   =  stats['perce
-00018a80: 6e74 275d 2e61 7374 7970 6528 7374 7229  nt'].astype(str)
-00018a90: 0a20 2020 2020 2020 2020 2020 2073 6870  .            shp
-00018aa0: 205b 276d 6f64 6527 5d20 3d20 4e6f 6e65   ['mode'] = None
-00018ab0: 0a20 2020 2020 2020 2020 2020 2066 6f72  .            for
-00018ac0: 2069 6e64 6578 2c20 726f 7720 696e 2073   index, row in s
-00018ad0: 6870 2e69 7465 7272 6f77 7328 293a 0a20  hp.iterrows():. 
-00018ae0: 2020 2020 2020 2020 2020 2020 2020 2066                 f
-00018af0: 7265 7175 656e 6379 203d 2072 6f77 205b  requency = row [
-00018b00: 2766 7265 7127 5d0a 2020 2020 2020 2020  'freq'].        
-00018b10: 2020 2020 2020 2020 6672 6571 7565 6e63          frequenc
-00018b20: 7920 3d20 6672 6571 7565 6e63 792e 7265  y = frequency.re
-00018b30: 706c 6163 6528 275d 272c 2027 2729 0a20  place(']', ''). 
-00018b40: 2020 2020 2020 2020 2020 2020 2020 2066                 f
-00018b50: 7265 7175 656e 6379 203d 2066 7265 7175  requency = frequ
-00018b60: 656e 6379 2e72 6570 6c61 6365 2827 5b27  ency.replace('['
-00018b70: 2c20 2727 290a 2020 2020 2020 2020 2020  , '').          
-00018b80: 2020 2020 2020 6672 6571 7565 6e63 7920        frequency 
-00018b90: 3d20 6e70 2e66 726f 6d73 7472 696e 6728  = np.fromstring(
-00018ba0: 6672 6571 7565 6e63 792c 2064 7479 7065  frequency, dtype
-00018bb0: 3d66 6c6f 6174 2c20 7365 703d 2720 2729  =float, sep=' ')
-00018bc0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00018bd0: 2075 6e69 7175 6520 3d20 726f 7720 5b27   unique = row ['
-00018be0: 756e 6971 7565 275d 0a20 2020 2020 2020  unique'].       
-00018bf0: 2020 2020 2020 2020 2075 6e69 7175 6520           unique 
-00018c00: 3d20 756e 6971 7565 2e72 6570 6c61 6365  = unique.replace
-00018c10: 2827 5d27 2c20 2727 290a 2020 2020 2020  (']', '').      
-00018c20: 2020 2020 2020 2020 2020 756e 6971 7565            unique
-00018c30: 203d 2075 6e69 7175 652e 7265 706c 6163   = unique.replac
-00018c40: 6528 275b 272c 2027 2729 0a20 2020 2020  e('[', '').     
-00018c50: 2020 2020 2020 2020 2020 2075 6e69 7175             uniqu
-00018c60: 6520 3d20 6e70 2e66 726f 6d73 7472 696e  e = np.fromstrin
-00018c70: 6728 756e 6971 7565 2c20 6474 7970 653d  g(unique, dtype=
-00018c80: 666c 6f61 742c 2073 6570 3d27 2027 290a  float, sep=' ').
-00018c90: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00018ca0: 6964 7820 3d20 6e70 2e77 6865 7265 2866  idx = np.where(f
-00018cb0: 7265 7175 656e 6379 203d 3d20 6e70 2e6d  requency == np.m
-00018cc0: 6178 2866 7265 7175 656e 6379 2929 0a20  ax(frequency)). 
-00018cd0: 2020 2020 2020 2020 2020 2020 2020 2076                 v
-00018ce0: 616c 7565 203d 2075 6e69 7175 655b 6964  alue = unique[id
-00018cf0: 785d 0a20 2020 2020 2020 2020 2020 2020  x].             
-00018d00: 2020 2073 6870 2e69 6c6f 635b 696e 6465     shp.iloc[inde
-00018d10: 782c 2073 6870 2e63 6f6c 756d 6e73 2e67  x, shp.columns.g
-00018d20: 6574 5f6c 6f63 2827 6d6f 6465 2729 5d20  et_loc('mode')] 
-00018d30: 3d20 7374 7228 7661 6c75 6529 0a20 2020  = str(value).   
-00018d40: 2020 2020 2020 2020 2020 2020 2023 7368               #sh
-00018d50: 705b 276d 6f64 6527 5d2e 696c 6f63 5b69  p['mode'].iloc[i
-00018d60: 6e64 6578 5d20 3d20 7374 7228 7661 6c75  ndex] = str(valu
-00018d70: 6529 0a20 2020 2020 2020 2072 6574 7572  e).        retur
-00018d80: 6e20 7368 700a 0a20 2020 2064 6566 2062  n shp..    def b
-00018d90: 626f 785f 746f 5f70 6978 656c 5f6f 6666  box_to_pixel_off
-00018da0: 7365 7473 2873 656c 662c 6774 2c20 6262  sets(self,gt, bb
-00018db0: 6f78 293a 0a20 2020 2020 2020 2022 2222  ox):.        """
-00018dc0: 0a20 2020 2020 2020 205a 6f6e 616c 2053  .        Zonal S
-00018dd0: 7461 7469 7374 6963 730a 2020 2020 2020  tatistics.      
-00018de0: 2020 5665 6374 6f72 2d52 6173 7465 7220    Vector-Raster 
-00018df0: 416e 616c 7973 6973 0a20 2020 2020 2020  Analysis.       
-00018e00: 2043 6f70 7972 6967 6874 2032 3031 3320   Copyright 2013 
-00018e10: 4d61 7474 6865 7720 5065 7272 790a 2020  Matthew Perry.  
-00018e20: 2020 2020 2020 5573 6167 653a 0a20 2020        Usage:.   
-00018e30: 2020 2020 2020 207a 6f6e 616c 5f73 7461         zonal_sta
-00018e40: 7473 2e70 7920 5645 4354 4f52 2052 4153  ts.py VECTOR RAS
-00018e50: 5445 520a 2020 2020 2020 2020 2020 7a6f  TER.          zo
-00018e60: 6e61 6c5f 7374 6174 732e 7079 202d 6820  nal_stats.py -h 
-00018e70: 7c20 2d2d 6865 6c70 0a20 2020 2020 2020  | --help.       
-00018e80: 2020 207a 6f6e 616c 5f73 7461 7473 2e70     zonal_stats.p
-00018e90: 7920 2d2d 7665 7273 696f 6e0a 2020 2020  y --version.    
-00018ea0: 2020 2020 4f70 7469 6f6e 733a 0a20 2020      Options:.   
-00018eb0: 2020 2020 2020 202d 6820 2d2d 6865 6c70         -h --help
-00018ec0: 2020 2020 2053 686f 7720 7468 6973 2073       Show this s
-00018ed0: 6372 6565 6e2e 0a20 2020 2020 2020 2020  creen..         
-00018ee0: 202d 2d76 6572 7369 6f6e 2020 2020 2053   --version     S
-00018ef0: 686f 7720 7665 7273 696f 6e2e 0a20 2020  how version..   
-00018f00: 2020 2020 2022 2222 0a20 2020 2020 2020       """.       
-00018f10: 206f 7269 6769 6e58 203d 2067 745b 305d   originX = gt[0]
-00018f20: 0a20 2020 2020 2020 206f 7269 6769 6e59  .        originY
-00018f30: 203d 2067 745b 335d 0a20 2020 2020 2020   = gt[3].       
-00018f40: 2070 6978 656c 5f77 6964 7468 203d 2067   pixel_width = g
-00018f50: 745b 315d 0a20 2020 2020 2020 2070 6978  t[1].        pix
-00018f60: 656c 5f68 6569 6768 7420 3d20 6774 5b35  el_height = gt[5
-00018f70: 5d0a 2020 2020 2020 2020 7831 203d 2069  ].        x1 = i
-00018f80: 6e74 2828 6262 6f78 5b30 5d20 2d20 6f72  nt((bbox[0] - or
-00018f90: 6967 696e 5829 202f 2070 6978 656c 5f77  iginX) / pixel_w
-00018fa0: 6964 7468 290a 2020 2020 2020 2020 7832  idth).        x2
-00018fb0: 203d 2069 6e74 2828 6262 6f78 5b31 5d20   = int((bbox[1] 
-00018fc0: 2d20 6f72 6967 696e 5829 202f 2070 6978  - originX) / pix
-00018fd0: 656c 5f77 6964 7468 2920 2b20 310a 2020  el_width) + 1.  
-00018fe0: 2020 2020 2020 7931 203d 2069 6e74 2828        y1 = int((
-00018ff0: 6262 6f78 5b33 5d20 2d20 6f72 6967 696e  bbox[3] - origin
-00019000: 5929 202f 2070 6978 656c 5f68 6569 6768  Y) / pixel_heigh
-00019010: 7429 0a20 2020 2020 2020 2079 3220 3d20  t).        y2 = 
-00019020: 696e 7428 2862 626f 785b 325d 202d 206f  int((bbox[2] - o
-00019030: 7269 6769 6e59 2920 2f20 7069 7865 6c5f  riginY) / pixel_
-00019040: 6865 6967 6874 2920 2b20 310a 2020 2020  height) + 1.    
-00019050: 2020 2020 7873 697a 6520 3d20 7832 202d      xsize = x2 -
-00019060: 2078 310a 2020 2020 2020 2020 7973 697a   x1.        ysiz
-00019070: 6520 3d20 7932 202d 2079 310a 2020 2020  e = y2 - y1.    
-00019080: 2020 2020 7265 7475 726e 2028 7831 2c20      return (x1, 
-00019090: 7931 2c20 7873 697a 652c 2079 7369 7a65  y1, xsize, ysize
-000190a0: 290a 0a20 2020 2064 6566 2067 656f 7469  )..    def geoti
-000190b0: 665f 7a6f 6e65 7328 7365 6c66 2c0a 2020  f_zones(self,.  
-000190c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000190d0: 2020 2072 6173 7465 725f 7061 7468 5f69     raster_path_i
-000190e0: 6e2c 0a20 2020 2020 2020 2020 2020 2020  n,.             
-000190f0: 2020 2020 2020 2020 7261 7374 6572 5f70          raster_p
-00019100: 6174 685f 6f75 742c 0a20 2020 2020 2020  ath_out,.       
-00019110: 2020 2020 2020 2020 2020 2020 2020 7261                ra
-00019120: 7374 6572 5f62 616e 6420 3d20 312c 0a20  ster_band = 1,. 
-00019130: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00019140: 2020 2020 6e75 6d5f 6269 6e20 3d20 3130      num_bin = 10
-00019150: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
-00019160: 2020 2020 2020 2073 6c69 6365 5f76 616c         slice_val
-00019170: 7565 7320 3d20 4e6f 6e65 293a 0a20 2020  ues = None):.   
-00019180: 2020 2020 2022 2222 0a20 2020 2020 2020       """.       
-00019190: 206f 7269 6769 6e61 6c20 636f 6465 2062   original code b
-000191a0: 793a 0a20 2020 2020 2020 2041 6e64 7265  y:.        Andre
-000191b0: 6120 4d61 7373 6574 7469 3b0a 2020 2020  a Massetti;.    
-000191c0: 2020 2020 6874 7470 733a 2f2f 6769 732e      https://gis.
-000191d0: 7374 6163 6b65 7863 6861 6e67 652e 636f  stackexchange.co
-000191e0: 6d2f 7175 6573 7469 6f6e 732f 3136 3438  m/questions/1648
-000191f0: 3533 2f72 6561 6469 6e67 2d6d 6f64 6966  53/reading-modif
-00019200: 7969 6e67 2d61 6e64 2d77 7269 7469 6e67  ying-and-writing
-00019210: 2d61 2d67 656f 7469 6666 2d77 6974 682d  -a-geotiff-with-
-00019220: 6764 616c 2d69 6e2d 7079 7468 6f6e 0a20  gdal-in-python. 
-00019230: 2020 2020 2020 206d 6f64 6966 6965 6420         modified 
-00019240: 6279 3a0a 2020 2020 2020 2020 4020 6175  by:.        @ au
-00019250: 7468 6f72 3a20 2020 2020 2020 2020 2020  thor:           
-00019260: 2020 2020 2020 2053 6865 7276 616e 2047         Shervan G
-00019270: 6861 7261 7269 0a20 2020 2020 2020 2040  harari.        @
-00019280: 2047 6974 6875 623a 2020 2020 2020 2020   Github:        
-00019290: 2020 2020 2020 2020 2020 6874 7470 733a            https:
-000192a0: 2f2f 6769 7468 7562 2e63 6f6d 2f53 6865  //github.com/She
-000192b0: 7276 616e 4768 6172 6172 692f 4541 5359  rvanGharari/EASY
-000192c0: 4d4f 5245 0a20 2020 2020 2020 2040 2061  MORE.        @ a
-000192d0: 7574 686f 7227 7320 656d 6169 6c20 6964  uthor's email id
-000192e0: 3a20 2020 2020 2020 7368 2e67 6861 7261  :       sh.ghara
-000192f0: 7269 4067 6d61 696c 2e63 6f6d 0a20 2020  ri@gmail.com.   
-00019300: 2020 2020 2040 206c 6963 656e 7365 3a20       @ license: 
-00019310: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00019320: 474e 552d 4750 4c76 330a 2020 2020 2020  GNU-GPLv3.      
-00019330: 2020 5468 6973 2066 756e 6374 696f 6e20    This function 
-00019340: 6372 6561 7465 7320 6120 7261 7374 6572  creates a raster
-00019350: 2066 696c 6520 6261 7365 6420 6f6e 2061   file based on a
-00019360: 7373 6967 696e 6720 7369 6e67 6c65 2076  ssiging single v
-00019370: 616c 7565 7320 746f 2061 2067 6976 656e  alues to a given
-00019380: 2072 616e 6765 206f 6620 6365 6c6c 2076   range of cell v
-00019390: 616c 7565 733b 0a20 2020 2020 2020 2065  alues;.        e
-000193a0: 7861 6d70 6c65 2069 7320 6372 6561 7469  xample is creati
-000193b0: 6e67 2065 6c65 7661 7469 6f6e 207a 6f6e  ng elevation zon
-000193c0: 6520 6261 7365 6420 6f6e 2061 2072 6173  e based on a ras
-000193d0: 7465 7220 6669 6c65 206f 6620 6469 6769  ter file of digi
-000193e0: 7461 6c20 656c 6576 6174 696f 6e20 6d6f  tal elevation mo
-000193f0: 6465 6c73 2028 4445 4d73 290a 2020 2020  dels (DEMs).    
-00019400: 2020 2020 4172 6775 6d65 6e74 730a 2020      Arguments.  
-00019410: 2020 2020 2020 2d2d 2d2d 2d2d 2d2d 2d0a        ---------.
-00019420: 2020 2020 2020 2020 7261 7374 6572 5f70          raster_p
-00019430: 6174 685f 696e 3a20 7374 7269 6e67 3b20  ath_in: string; 
-00019440: 7468 6520 7061 7468 2074 6f20 7468 6520  the path to the 
-00019450: 696e 7075 7420 7261 7374 6572 0a20 2020  input raster.   
-00019460: 2020 2020 2072 6173 7465 725f 7061 7468       raster_path
-00019470: 5f6f 7574 3a20 7374 7269 6e67 3b20 7468  _out: string; th
-00019480: 6520 7061 7468 2074 6f20 7468 6520 6f75  e path to the ou
-00019490: 7470 7574 2072 6173 7465 720a 2020 2020  tput raster.    
-000194a0: 2020 2020 7261 7374 6572 5f62 616e 643a      raster_band:
-000194b0: 2069 6e74 3b20 7468 6520 6261 6e64 2069   int; the band i
-000194c0: 6e20 7468 6520 7261 7374 6572 0a20 2020  n the raster.   
-000194d0: 2020 2020 206e 756d 5f62 696e 3a20 696e       num_bin: in
-000194e0: 743b 206e 756d 6265 7220 6f66 2062 696e  t; number of bin
-000194f0: 7320 746f 2073 6c69 6365 206d 696e 2061  s to slice min a
-00019500: 6e64 206d 6178 0a20 2020 2020 2020 2073  nd max.        s
-00019510: 6c69 6365 5f76 616c 7565 7320 3a20 6e70  lice_values : np
-00019520: 2e61 7272 6179 3b20 7374 7263 6974 6c79  .array; strcitly
-00019530: 206d 6f6e 6f74 6f6e 6963 616c 6c79 2069   monotonically i
-00019540: 6e63 7265 6173 696e 6720 6c65 7665 6c73  ncreasing levels
-00019550: 2066 6f72 2073 6c69 6369 6e67 2074 6865   for slicing the
-00019560: 2072 6173 7465 720a 2020 2020 2020 2020   raster.        
-00019570: 2222 220a 2020 2020 2020 2020 2320 7265  """.        # re
-00019580: 6164 2074 6865 2072 6174 7374 6572 2066  ad the ratster f
-00019590: 696c 6520 6261 6e64 206e 756d 6265 7220  ile band number 
-000195a0: 6e0a 2020 2020 2020 2020 696d 706f 7274  n.        import
-000195b0: 206f 730a 2020 2020 2020 2020 6672 6f6d   os.        from
-000195c0: 206f 7367 656f 2069 6d70 6f72 7420 6764   osgeo import gd
-000195d0: 616c 0a20 2020 2020 2020 2069 6d70 6f72  al.        impor
-000195e0: 7420 6e75 6d70 7920 6173 206e 700a 2020  t numpy as np.  
-000195f0: 2020 2020 2020 6473 203d 2067 6461 6c2e        ds = gdal.
-00019600: 4f70 656e 2872 6173 7465 725f 7061 7468  Open(raster_path
-00019610: 5f69 6e29 0a20 2020 2020 2020 2062 616e  _in).        ban
-00019620: 6420 3d20 6473 2e47 6574 5261 7374 6572  d = ds.GetRaster
-00019630: 4261 6e64 2872 6173 7465 725f 6261 6e64  Band(raster_band
-00019640: 290a 2020 2020 2020 2020 6172 7220 3d20  ).        arr = 
-00019650: 6261 6e64 2e52 6561 6441 7341 7272 6179  band.ReadAsArray
-00019660: 2829 0a20 2020 2020 2020 205b 636f 6c73  ().        [cols
-00019670: 2c20 726f 7773 5d20 3d20 6172 722e 7368  , rows] = arr.sh
-00019680: 6170 650a 2020 2020 2020 2020 6172 725f  ape.        arr_
-00019690: 6d69 6e20 3d20 6172 722e 6d69 6e28 290a  min = arr.min().
-000196a0: 2020 2020 2020 2020 6172 725f 6d61 7820          arr_max 
-000196b0: 3d20 6172 722e 6d61 7828 290a 2020 2020  = arr.max().    
-000196c0: 2020 2020 6966 2073 6c69 6365 5f76 616c      if slice_val
-000196d0: 7565 7320 6973 204e 6f6e 653a 2023 2063  ues is None: # c
-000196e0: 616c 6375 6c61 7465 2074 6865 2064 656c  alculate the del
-000196f0: 7461 2066 726f 6d20 6d69 6e20 746f 206d  ta from min to m
-00019700: 6178 2077 6974 6820 6e75 6d62 6572 206f  ax with number o
-00019710: 6620 6269 6e73 0a20 2020 2020 2020 2020  f bins.         
-00019720: 2020 2064 656c 7461 203d 206e 702e 6172     delta = np.ar
-00019730: 616e 6765 2861 7272 5f6d 696e 2c20 6172  ange(arr_min, ar
-00019740: 725f 6d61 782c 2028 6172 725f 6d61 782d  r_max, (arr_max-
-00019750: 6172 725f 6d69 6e29 2f6e 756d 5f62 696e  arr_min)/num_bin
-00019760: 290a 2020 2020 2020 2020 656c 7365 3a0a  ).        else:.
-00019770: 2020 2020 2020 2020 2020 2020 2320 6368              # ch
-00019780: 6563 6b20 6966 2073 6c69 6365 5f6c 6576  eck if slice_lev
-00019790: 656c 2069 7320 6d6f 6e6f 746f 6e69 6361  el is monotonica
-000197a0: 6c6c 7920 696e 6372 6561 7369 6e67 0a20  lly increasing. 
-000197b0: 2020 2020 2020 2020 2020 2073 6c69 6365             slice
-000197c0: 5f76 616c 7565 7320 3d20 736c 6963 655f  _values = slice_
-000197d0: 7661 6c75 6573 2e66 6c61 7474 656e 2829  values.flatten()
-000197e0: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
-000197f0: 736c 6963 655f 7661 6c75 6573 2e6e 6469  slice_values.ndi
-00019800: 6d20 213d 2031 3a0a 2020 2020 2020 2020  m != 1:.        
-00019810: 2020 2020 2020 2020 7379 732e 6578 6974          sys.exit
-00019820: 2827 6974 2073 6565 6d73 2074 6865 2070  ('it seems the p
-00019830: 726f 7669 6465 6420 736c 6963 6520 6c65  rovided slice le
-00019840: 7665 6c73 2061 7265 206e 6f74 2031 2064  vels are not 1 d
-00019850: 696d 656e 7469 6f6e 616c 206e 756d 7079  imentional numpy
-00019860: 2061 7272 6179 2729 0a20 2020 2020 2020   array').       
-00019870: 2020 2020 2069 6620 6c65 6e28 736c 6963       if len(slic
-00019880: 655f 7661 6c75 6573 2920 213d 206c 656e  e_values) != len
-00019890: 286e 702e 756e 6971 7565 2873 6c69 6365  (np.unique(slice
-000198a0: 5f76 616c 7565 7329 293a 0a20 2020 2020  _values)):.     
-000198b0: 2020 2020 2020 2020 2020 2073 7973 2e65             sys.e
-000198c0: 7869 7428 2769 7420 7365 656d 7320 7468  xit('it seems th
-000198d0: 6520 7072 6f76 6964 6564 2073 6c69 6365  e provided slice
-000198e0: 206c 6576 656c 7320 646f 206e 6f74 2068   levels do not h
-000198f0: 6176 6520 756e 6971 7565 2076 616c 7565  ave unique value
-00019900: 7327 290a 2020 2020 2020 2020 2020 2020  s').            
-00019910: 6966 206e 6f74 206e 702e 616c 6c28 6e70  if not np.all(np
-00019920: 2e64 6966 6628 736c 6963 655f 7661 6c75  .diff(slice_valu
-00019930: 6573 2920 3e20 3029 3a0a 2020 2020 2020  es) > 0):.      
-00019940: 2020 2020 2020 2020 2020 7379 732e 6578            sys.ex
-00019950: 6974 2827 6974 2073 6565 6d73 2074 6865  it('it seems the
-00019960: 2070 726f 7669 6465 6420 736c 6963 6520   provided slice 
-00019970: 6c65 7665 6c73 2061 7265 206e 6f74 2069  levels are not i
-00019980: 6e20 696e 6372 6561 7369 6e67 206f 7264  n increasing ord
-00019990: 6572 2729 0a20 2020 2020 2020 2020 2020  er').           
-000199a0: 2064 656c 7461 203d 2073 6c69 6365 5f76   delta = slice_v
-000199b0: 616c 7565 730a 2020 2020 2020 2020 2020  alues.          
-000199c0: 2020 2320 6368 6563 6b20 7661 6c75 6573    # check values
-000199d0: 3a0a 2020 2020 2020 2020 2020 2020 6966  :.            if
-000199e0: 2028 6172 725f 6d69 6e20 3e20 6465 6c74   (arr_min > delt
-000199f0: 612e 6d61 7828 2929 206f 7220 2861 7272  a.max()) or (arr
-00019a00: 5f6d 6178 203c 2064 656c 7461 2e6d 696e  _max < delta.min
-00019a10: 2829 293a 0a20 2020 2020 2020 2020 2020  ()):.           
-00019a20: 2020 2020 2070 7269 6e74 2827 6d61 7820       print('max 
-00019a30: 6672 6f6d 2067 656f 7469 6666 3a20 272c  from geotiff: ',
-00019a40: 2061 7272 5f6d 6178 2c20 276d 696e 2066   arr_max, 'min f
-00019a50: 726f 6d20 6765 6f74 6966 663a 2027 2c20  rom geotiff: ', 
-00019a60: 6172 725f 6d69 6e29 0a20 2020 2020 2020  arr_min).       
-00019a70: 2020 2020 2020 2020 2073 7973 2e65 7869           sys.exi
-00019a80: 7428 2769 7420 7365 656d 7320 7468 6520  t('it seems the 
-00019a90: 7072 6f76 6964 6564 2062 6f75 6e64 2073  provided bound s
-00019aa0: 7065 6369 6669 6564 2062 7920 736c 6963  pecified by slic
-00019ab0: 655f 6c65 7665 6c20 6973 206f 7574 7369  e_level is outsi
-00019ac0: 6465 206f 6620 7261 7374 6572 206d 6178  de of raster max
-00019ad0: 2074 6f20 6d69 6e20 7661 6c75 6573 2729   to min values')
-00019ae0: 0a20 2020 2020 2020 2069 6620 2861 7272  .        if (arr
-00019af0: 5f6d 6178 203e 2064 656c 7461 2e6d 6178  _max > delta.max
-00019b00: 2829 293a 0a20 2020 2020 2020 2020 2020  ()):.           
-00019b10: 2064 656c 7461 203d 206e 702e 6170 7065   delta = np.appe
-00019b20: 6e64 2864 656c 7461 2c6e 702e 6172 7261  nd(delta,np.arra
-00019b30: 7928 5b61 7272 5f6d 6178 5d29 290a 2020  y([arr_max])).  
-00019b40: 2020 2020 2020 2020 2020 6465 6c74 6120            delta 
-00019b50: 3d20 6e70 2e75 6e69 7175 6528 6465 6c74  = np.unique(delt
-00019b60: 6129 0a20 2020 2020 2020 2020 2020 2064  a).            d
-00019b70: 656c 7461 203d 206e 702e 736f 7274 2864  elta = np.sort(d
-00019b80: 656c 7461 290a 2020 2020 2020 2020 6966  elta).        if
-00019b90: 2028 6172 725f 6d69 6e20 3c20 6465 6c74   (arr_min < delt
-00019ba0: 612e 6d69 6e28 2929 3a0a 2020 2020 2020  a.min()):.      
-00019bb0: 2020 2020 2020 6465 6c74 6120 3d20 6e70        delta = np
-00019bc0: 2e61 7070 656e 6428 6465 6c74 612c 6e70  .append(delta,np
-00019bd0: 2e61 7272 6179 285b 6172 725f 6d69 6e5d  .array([arr_min]
-00019be0: 2929 0a20 2020 2020 2020 2020 2020 2064  )).            d
-00019bf0: 656c 7461 203d 206e 702e 756e 6971 7565  elta = np.unique
-00019c00: 2864 656c 7461 290a 2020 2020 2020 2020  (delta).        
-00019c10: 2020 2020 6465 6c74 6120 3d20 6e70 2e73      delta = np.s
-00019c20: 6f72 7428 6465 6c74 6129 0a20 2020 2020  ort(delta).     
-00019c30: 2020 2061 7272 5f6f 7574 203d 2061 7272     arr_out = arr
-00019c40: 0a20 2020 2020 2020 2070 7269 6e74 2864  .        print(d
-00019c50: 656c 7461 290a 2020 2020 2020 2020 666f  elta).        fo
-00019c60: 7220 6920 696e 206e 702e 6172 616e 6765  r i in np.arange
-00019c70: 286c 656e 2864 656c 7461 292d 3129 3a0a  (len(delta)-1):.
-00019c80: 2020 2020 2020 2020 2020 2020 6172 725f              arr_
-00019c90: 6f75 7420 3d20 6e70 2e77 6865 7265 286e  out = np.where(n
-00019ca0: 702e 6c6f 6769 6361 6c5f 616e 6428 6172  p.logical_and(ar
-00019cb0: 725f 6f75 743e 3d64 656c 7461 5b69 5d2c  r_out>=delta[i],
-00019cc0: 2061 7272 5f6f 7574 3c3d 6465 6c74 615b   arr_out<=delta[
-00019cd0: 692b 315d 292c 2028 6465 6c74 615b 695d  i+1]), (delta[i]
-00019ce0: 2b64 656c 7461 5b69 2b31 5d29 2f32 2c61  +delta[i+1])/2,a
-00019cf0: 7272 5f6f 7574 290a 2020 2020 2020 2020  rr_out).        
-00019d00: 2320 7361 7669 6e67 0a20 2020 2020 2020  # saving.       
-00019d10: 2064 7269 7665 7220 3d20 6764 616c 2e47   driver = gdal.G
-00019d20: 6574 4472 6976 6572 4279 4e61 6d65 2822  etDriverByName("
-00019d30: 4754 6966 6622 290a 2020 2020 2020 2020  GTiff").        
-00019d40: 6f75 7464 6174 6120 3d20 6472 6976 6572  outdata = driver
-00019d50: 2e43 7265 6174 6528 7261 7374 6572 5f70  .Create(raster_p
-00019d60: 6174 685f 6f75 742c 2072 6f77 732c 2063  ath_out, rows, c
-00019d70: 6f6c 732c 2031 2c20 6764 616c 2e47 4454  ols, 1, gdal.GDT
-00019d80: 5f55 496e 7431 3629 0a20 2020 2020 2020  _UInt16).       
-00019d90: 206f 7574 6461 7461 2e53 6574 4765 6f54   outdata.SetGeoT
-00019da0: 7261 6e73 666f 726d 2864 732e 4765 7447  ransform(ds.GetG
-00019db0: 656f 5472 616e 7366 6f72 6d28 2929 2323  eoTransform())##
-00019dc0: 7365 7473 2073 616d 6520 6765 6f74 7261  sets same geotra
-00019dd0: 6e73 666f 726d 2061 7320 696e 7075 740a  nsform as input.
-00019de0: 2020 2020 2020 2020 6f75 7464 6174 612e          outdata.
-00019df0: 5365 7450 726f 6a65 6374 696f 6e28 6473  SetProjection(ds
-00019e00: 2e47 6574 5072 6f6a 6563 7469 6f6e 2829  .GetProjection()
-00019e10: 2923 2373 6574 7320 7361 6d65 2070 726f  )##sets same pro
-00019e20: 6a65 6374 696f 6e20 6173 2069 6e70 7574  jection as input
-00019e30: 0a20 2020 2020 2020 206f 7574 6461 7461  .        outdata
-00019e40: 2e47 6574 5261 7374 6572 4261 6e64 2831  .GetRasterBand(1
-00019e50: 292e 5772 6974 6541 7272 6179 2861 7272  ).WriteArray(arr
-00019e60: 5f6f 7574 290a 2020 2020 2020 2020 6f75  _out).        ou
-00019e70: 7464 6174 612e 4765 7452 6173 7465 7242  tdata.GetRasterB
-00019e80: 616e 6428 3129 2e53 6574 4e6f 4461 7461  and(1).SetNoData
-00019e90: 5661 6c75 6528 3029 0a20 2020 2020 2020  Value(0).       
-00019ea0: 206f 7574 6461 7461 2e46 6c75 7368 4361   outdata.FlushCa
-00019eb0: 6368 6528 290a 2020 2020 2020 2020 6f75  che().        ou
-00019ec0: 7464 6174 6120 3d20 4e6f 6e65 0a20 2020  tdata = None.   
-00019ed0: 2020 2020 2062 616e 643d 4e6f 6e65 0a20       band=None. 
-00019ee0: 2020 2020 2020 2064 733d 4e6f 6e65 0a0a         ds=None..
-00019ef0: 0a20 2020 2064 6566 2067 656f 7469 6632  .    def geotif2
-00019f00: 7368 7028 7365 6c66 2c0a 2020 2020 2020  shp(self,.      
-00019f10: 2020 2020 2020 2020 2020 2020 2072 6173               ras
-00019f20: 7465 725f 7061 7468 5f69 6e2c 0a20 2020  ter_path_in,.   
-00019f30: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00019f40: 7665 6374 6f72 5f70 6174 685f 6f75 742c  vector_path_out,
-00019f50: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00019f60: 2020 2020 7261 7374 6572 5f62 616e 6420      raster_band 
-00019f70: 3d20 312c 0a20 2020 2020 2020 2020 2020  = 1,.           
-00019f80: 2020 2020 2020 2020 6e61 6d65 5f6f 665f          name_of_
-00019f90: 6669 6c65 6420 3d20 2776 616c 7565 7327  filed = 'values'
-00019fa0: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
-00019fb0: 2020 2020 2064 6973 736f 6c76 6520 3d20       dissolve = 
-00019fc0: 5472 7565 293a 0a0a 2020 2020 2020 2020  True):..        
-00019fd0: 7365 6c66 2e5f 5f67 656f 7469 6632 7368  self.__geotif2sh
-00019fe0: 705f 7375 6266 756e 2872 6173 7465 725f  p_subfun(raster_
-00019ff0: 7061 7468 5f69 6e2c 0a20 2020 2020 2020  path_in,.       
-0001a000: 2020 2020 2076 6563 746f 725f 7061 7468       vector_path
-0001a010: 5f6f 7574 2c0a 2020 2020 2020 2020 2020  _out,.          
-0001a020: 2020 7261 7374 6572 5f62 616e 6420 3d20    raster_band = 
-0001a030: 7261 7374 6572 5f62 616e 642c 0a20 2020  raster_band,.   
-0001a040: 2020 2020 2020 2020 206e 616d 655f 6f66           name_of
-0001a050: 5f66 696c 6564 203d 206e 616d 655f 6f66  _filed = name_of
-0001a060: 5f66 696c 6564 290a 2020 2020 2020 2020  _filed).        
-0001a070: 6966 2064 6973 736f 6c76 653a 0a20 2020  if dissolve:.   
-0001a080: 2020 2020 2020 2020 2073 656c 662e 7368           self.sh
-0001a090: 705f 6469 7373 6f6c 7665 2876 6563 746f  p_dissolve(vecto
-0001a0a0: 725f 7061 7468 5f6f 7574 2c0a 2020 2020  r_path_out,.    
-0001a0b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001a0c0: 2020 2020 2020 2020 2020 7665 6374 6f72            vector
-0001a0d0: 5f70 6174 685f 6f75 742c 0a20 2020 2020  _path_out,.     
-0001a0e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001a0f0: 2020 2020 2020 2020 206e 616d 655f 6f66           name_of
-0001a100: 5f66 696c 6564 290a 0a20 2020 2064 6566  _filed)..    def
-0001a110: 205f 5f67 656f 7469 6632 7368 705f 7375   __geotif2shp_su
-0001a120: 6266 756e 2873 656c 662c 0a20 2020 2020  bfun(self,.     
-0001a130: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001a140: 2020 2020 2020 2072 6173 7465 725f 7061         raster_pa
-0001a150: 7468 5f69 6e2c 0a20 2020 2020 2020 2020  th_in,.         
-0001a160: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001a170: 2020 2076 6563 746f 725f 7061 7468 5f6f     vector_path_o
-0001a180: 7574 2c0a 2020 2020 2020 2020 2020 2020  ut,.            
-0001a190: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001a1a0: 7261 7374 6572 5f62 616e 6420 3d20 312c  raster_band = 1,
-0001a1b0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0001a1c0: 2020 2020 2020 2020 2020 2020 206e 616d               nam
-0001a1d0: 655f 6f66 5f66 696c 6564 203d 2027 7661  e_of_filed = 'va
-0001a1e0: 6c75 6573 2729 3a0a 2020 2020 2020 2020  lues'):.        
-0001a1f0: 2222 220a 2020 2020 2020 2020 6f72 6967  """.        orig
-0001a200: 696e 616c 2063 6f64 6520 6279 3a0a 2020  inal code by:.  
-0001a210: 2020 2020 2020 4b61 6469 7220 c59e 6168        Kadir ..ah
-0001a220: 6261 7a3b 0a20 2020 2020 2020 2068 7474  baz;.        htt
-0001a230: 7073 3a2f 2f67 6973 2e73 7461 636b 6578  ps://gis.stackex
-0001a240: 6368 616e 6765 2e63 6f6d 2f71 7565 7374  change.com/quest
-0001a250: 696f 6e73 2f32 3831 3037 332f 6578 636c  ions/281073/excl
-0001a260: 7564 696e 672d 6578 7465 6e74 2d77 6865  uding-extent-whe
-0001a270: 6e2d 706f 6c79 676f 6e69 7a69 6e67 2d72  n-polygonizing-r
-0001a280: 6173 7465 722d 6669 6c65 2d75 7369 6e67  aster-file-using
-0001a290: 2d70 7974 686f 6e0a 2020 2020 2020 2020  -python.        
-0001a2a0: 616e 640a 2020 2020 2020 2020 6f6e 616b  and.        onak
-0001a2b0: 7561 0a20 2020 2020 2020 2068 7474 7073  ua.        https
-0001a2c0: 3a2f 2f67 6973 2e73 7461 636b 6578 6368  ://gis.stackexch
-0001a2d0: 616e 6765 2e63 6f6d 2f71 7565 7374 696f  ange.com/questio
-0001a2e0: 6e73 2f32 3534 3431 302f 7261 7374 6572  ns/254410/raster
-0001a2f0: 2d74 6f2d 7665 6374 6f72 2d63 6f6e 7665  -to-vector-conve
-0001a300: 7273 696f 6e2d 7573 696e 672d 6764 616c  rsion-using-gdal
-0001a310: 2d70 7974 686f 6e0a 2020 2020 2020 2020  -python.        
-0001a320: 6d6f 6469 6669 6564 2062 793a 0a20 2020  modified by:.   
-0001a330: 2020 2020 2040 2061 7574 686f 723a 2020       @ author:  
-0001a340: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001a350: 5368 6572 7661 6e20 4768 6172 6172 690a  Shervan Gharari.
-0001a360: 2020 2020 2020 2020 4020 4769 7468 7562          @ Github
-0001a370: 3a20 2020 2020 2020 2020 2020 2020 2020  :               
-0001a380: 2020 2068 7474 7073 3a2f 2f67 6974 6875     https://githu
-0001a390: 622e 636f 6d2f 5368 6572 7661 6e47 6861  b.com/ShervanGha
-0001a3a0: 7261 7269 2f45 4153 594d 4f52 450a 2020  rari/EASYMORE.  
-0001a3b0: 2020 2020 2020 4020 6175 7468 6f72 2773        @ author's
-0001a3c0: 2065 6d61 696c 2069 643a 2020 2020 2020   email id:      
-0001a3d0: 2073 682e 6768 6172 6172 6940 676d 6169   sh.gharari@gmai
-0001a3e0: 6c2e 636f 6d0a 2020 2020 2020 2020 4020  l.com.        @ 
-0001a3f0: 6c69 6365 6e73 653a 2020 2020 2020 2020  license:        
-0001a400: 2020 2020 2020 2020 2047 4e55 2d47 504c           GNU-GPL
-0001a410: 7633 0a20 2020 2020 2020 2054 6869 7320  v3.        This 
-0001a420: 6675 6e63 7469 6f6e 2072 6561 6473 2061  function reads a
-0001a430: 2072 6173 7465 7220 6669 6c65 2069 6e20   raster file in 
-0001a440: 6765 6f74 6966 6620 616e 6420 7265 7475  geotiff and retu
-0001a450: 726e 2076 6563 746f 7220 7661 6c75 6573  rn vector values
-0001a460: 2072 6566 6572 696e 6720 746f 2074 6861   refering to tha
-0001a470: 7420 7261 7374 6572 0a20 2020 2020 2020  t raster.       
-0001a480: 2041 7267 756d 656e 7473 0a20 2020 2020   Arguments.     
-0001a490: 2020 202d 2d2d 2d2d 2d2d 2d2d 0a20 2020     ---------.   
-0001a4a0: 2020 2020 2072 6173 7465 725f 7061 7468       raster_path
-0001a4b0: 5f69 6e3a 2073 7472 696e 673b 2074 6865  _in: string; the
-0001a4c0: 2070 6174 6820 746f 2074 6865 2069 6e70   path to the inp
-0001a4d0: 7574 2072 6173 7465 720a 2020 2020 2020  ut raster.      
-0001a4e0: 2020 7665 6374 6f72 5f70 6174 685f 6f75    vector_path_ou
-0001a4f0: 743a 2073 7472 696e 673b 2074 6865 2070  t: string; the p
-0001a500: 6174 6820 746f 2074 6865 206f 7574 7075  ath to the outpu
-0001a510: 7420 7368 6170 6566 696c 650a 2020 2020  t shapefile.    
-0001a520: 2020 2020 7261 7374 6572 5f62 616e 643a      raster_band:
-0001a530: 2069 6e74 3b20 7468 6520 6261 6e64 2069   int; the band i
-0001a540: 6e20 7468 6520 7261 7374 6572 0a20 2020  n the raster.   
-0001a550: 2020 2020 206e 616d 655f 6f66 5f66 696c       name_of_fil
-0001a560: 6564 3a20 7374 7269 6e67 3b20 7468 6520  ed: string; the 
-0001a570: 6e61 6d65 206f 6620 7468 6520 636f 6c75  name of the colu
-0001a580: 6d6e 206f 6620 6578 7472 6163 7465 6420  mn of extracted 
-0001a590: 7661 6c75 6573 2069 6e20 7368 6170 6566  values in shapef
-0001a5a0: 696c 650a 2020 2020 2020 2020 2222 220a  ile.        """.
-0001a5b0: 2020 2020 2020 2020 6672 6f6d 206f 7367          from osg
-0001a5c0: 656f 2069 6d70 6f72 7420 6764 616c 2c20  eo import gdal, 
-0001a5d0: 6f67 722c 206f 7372 0a20 2020 2020 2020  ogr, osr.       
-0001a5e0: 2069 6d70 6f72 7420 6765 6f70 616e 6461   import geopanda
-0001a5f0: 7320 6173 2067 7064 0a20 2020 2020 2020  s as gpd.       
-0001a600: 2023 2074 6869 7320 616c 6c6f 7773 2047   # this allows G
-0001a610: 4441 4c20 746f 2074 6872 6f77 2050 7974  DAL to throw Pyt
-0001a620: 686f 6e20 4578 6365 7074 696f 6e73 0a20  hon Exceptions. 
-0001a630: 2020 2020 2020 2023 6764 616c 2e55 7365         #gdal.Use
-0001a640: 4578 6365 7074 696f 6e73 2829 0a20 2020  Exceptions().   
-0001a650: 2020 2020 2073 7263 5f64 7320 3d20 6764       src_ds = gd
-0001a660: 616c 2e4f 7065 6e28 7261 7374 6572 5f70  al.Open(raster_p
-0001a670: 6174 685f 696e 290a 2020 2020 2020 2020  ath_in).        
-0001a680: 7372 7320 3d20 6f73 722e 5370 6174 6961  srs = osr.Spatia
-0001a690: 6c52 6566 6572 656e 6365 2829 0a20 2020  lReference().   
-0001a6a0: 2020 2020 2073 7273 2e49 6d70 6f72 7446       srs.ImportF
-0001a6b0: 726f 6d57 6b74 2873 7263 5f64 732e 4765  romWkt(src_ds.Ge
-0001a6c0: 7450 726f 6a65 6374 696f 6e28 2929 0a20  tProjection()). 
-0001a6d0: 2020 2020 2020 2073 7263 6261 6e64 203d         srcband =
-0001a6e0: 2073 7263 5f64 732e 4765 7452 6173 7465   src_ds.GetRaste
-0001a6f0: 7242 616e 6428 7261 7374 6572 5f62 616e  rBand(raster_ban
-0001a700: 6429 0a20 2020 2020 2020 2064 7276 203d  d).        drv =
-0001a710: 206f 6772 2e47 6574 4472 6976 6572 4279   ogr.GetDriverBy
-0001a720: 4e61 6d65 2827 4553 5249 2053 6861 7065  Name('ESRI Shape
-0001a730: 6669 6c65 2729 0a20 2020 2020 2020 2064  file').        d
-0001a740: 7374 5f64 7320 3d20 6472 762e 4372 6561  st_ds = drv.Crea
-0001a750: 7465 4461 7461 536f 7572 6365 2876 6563  teDataSource(vec
-0001a760: 746f 725f 7061 7468 5f6f 7574 290a 2020  tor_path_out).  
-0001a770: 2020 2020 2020 6473 745f 6c61 7965 7220        dst_layer 
-0001a780: 3d20 6473 745f 6473 2e43 7265 6174 654c  = dst_ds.CreateL
-0001a790: 6179 6572 2876 6563 746f 725f 7061 7468  ayer(vector_path
-0001a7a0: 5f6f 7574 202c 2073 7273 3d73 7273 290a  _out , srs=srs).
-0001a7b0: 2020 2020 2020 2020 6664 203d 206f 6772          fd = ogr
-0001a7c0: 2e46 6965 6c64 4465 666e 286e 616d 655f  .FieldDefn(name_
-0001a7d0: 6f66 5f66 696c 6564 2c20 6f67 722e 4f46  of_filed, ogr.OF
-0001a7e0: 5449 6e74 6567 6572 290a 2020 2020 2020  TInteger).      
-0001a7f0: 2020 6473 745f 6c61 7965 722e 4372 6561    dst_layer.Crea
-0001a800: 7465 4669 656c 6428 6664 290a 2020 2020  teField(fd).    
-0001a810: 2020 2020 6473 745f 6669 656c 6420 3d20      dst_field = 
-0001a820: 6473 745f 6c61 7965 722e 4765 744c 6179  dst_layer.GetLay
-0001a830: 6572 4465 666e 2829 2e47 6574 4669 656c  erDefn().GetFiel
-0001a840: 6449 6e64 6578 286e 616d 655f 6f66 5f66  dIndex(name_of_f
-0001a850: 696c 6564 290a 2020 2020 2020 2020 6764  iled).        gd
-0001a860: 616c 2e50 6f6c 7967 6f6e 697a 6528 7372  al.Polygonize(sr
-0001a870: 6362 616e 642c 204e 6f6e 652c 2064 7374  cband, None, dst
-0001a880: 5f6c 6179 6572 2c20 6473 745f 6669 656c  _layer, dst_fiel
-0001a890: 642c 205b 5d2c 2063 616c 6c62 6163 6b3d  d, [], callback=
-0001a8a0: 4e6f 6e65 290a 0a20 2020 2064 6566 2073  None)..    def s
-0001a8b0: 6870 5f64 6973 736f 6c76 6528 2020 2073  hp_dissolve(   s
-0001a8c0: 656c 662c 0a20 2020 2020 2020 2020 2020  elf,.           
-0001a8d0: 2020 2020 2020 2020 2020 2020 2076 6563               vec
-0001a8e0: 746f 725f 7061 7468 5f69 6e2c 0a20 2020  tor_path_in,.   
-0001a8f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001a900: 2020 2020 2076 6563 746f 725f 7061 7468       vector_path
-0001a910: 5f6f 7574 2c0a 2020 2020 2020 2020 2020  _out,.          
-0001a920: 2020 2020 2020 2020 2020 2020 2020 6e61                na
-0001a930: 6d65 5f6f 665f 6669 6c65 6429 3a0a 2020  me_of_filed):.  
-0001a940: 2020 2020 2020 2222 220a 2020 2020 2020        """.      
-0001a950: 2020 4020 6175 7468 6f72 3a20 2020 2020    @ author:     
-0001a960: 2020 2020 2020 2020 2020 2020 2053 6865               She
-0001a970: 7276 616e 2047 6861 7261 7269 0a20 2020  rvan Gharari.   
-0001a980: 2020 2020 2040 2047 6974 6875 623a 2020       @ Github:  
-0001a990: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001a9a0: 6874 7470 733a 2f2f 6769 7468 7562 2e63  https://github.c
-0001a9b0: 6f6d 2f53 6865 7276 616e 4768 6172 6172  om/ShervanGharar
-0001a9c0: 692f 4541 5359 4d4f 5245 0a20 2020 2020  i/EASYMORE.     
-0001a9d0: 2020 2040 2061 7574 686f 7227 7320 656d     @ author's em
-0001a9e0: 6169 6c20 6964 3a20 2020 2020 2020 7368  ail id:       sh
-0001a9f0: 2e67 6861 7261 7269 4067 6d61 696c 2e63  .gharari@gmail.c
-0001aa00: 6f6d 0a20 2020 2020 2020 2040 206c 6963  om.        @ lic
-0001aa10: 656e 7365 3a20 2020 2020 2020 2020 2020  ense:           
-0001aa20: 2020 2020 2020 474e 552d 4750 4c76 330a        GNU-GPLv3.
-0001aa30: 2020 2020 2020 2020 5468 6973 2066 756e          This fun
-0001aa40: 6374 696f 6e20 7265 6369 6576 6520 6120  ction recieve a 
-0001aa50: 7368 6170 6566 696c 6520 6e61 6d65 2061  shapefile name a
-0001aa60: 6e64 2069 7473 2063 6f6c 6f6d 6e20 746f  nd its colomn to
-0001aa70: 2062 6520 6469 7373 6f6c 7665 640a 2020   be dissolved.  
-0001aa80: 2020 2020 2020 4172 6775 6d65 6e74 730a        Arguments.
-0001aa90: 2020 2020 2020 2020 2d2d 2d2d 2d2d 2d2d          --------
-0001aaa0: 2d0a 2020 2020 2020 2020 7261 7374 6572  -.        raster
-0001aab0: 5f70 6174 685f 696e 3a20 7374 7269 6e67  _path_in: string
-0001aac0: 3b20 7468 6520 7061 7468 2074 6f20 7468  ; the path to th
-0001aad0: 6520 696e 7075 7420 7261 7374 6572 0a20  e input raster. 
-0001aae0: 2020 2020 2020 2072 6173 7465 725f 7061         raster_pa
-0001aaf0: 7468 5f6f 7574 3a20 7374 7269 6e67 3b20  th_out: string; 
-0001ab00: 7468 6520 7061 7468 2074 6f20 7468 6520  the path to the 
-0001ab10: 6f75 7470 7574 2072 6173 7465 720a 2020  output raster.  
-0001ab20: 2020 2020 2020 6e61 6d65 5f6f 665f 6669        name_of_fi
-0001ab30: 6c65 643a 2073 7472 696e 673b 2074 6865  led: string; the
-0001ab40: 206e 616d 6520 6f66 2074 6865 2063 6f6c   name of the col
-0001ab50: 756d 6e20 6f66 2065 7874 7261 6374 6564  umn of extracted
-0001ab60: 2076 616c 7565 7320 696e 2073 6861 7065   values in shape
-0001ab70: 6669 6c65 0a20 2020 2020 2020 2022 2222  file.        """
-0001ab80: 0a20 2020 2020 2020 2069 6d70 6f72 7420  .        import 
-0001ab90: 6765 6f70 616e 6461 7320 6173 2067 7064  geopandas as gpd
-0001aba0: 0a20 2020 2020 2020 2073 6870 203d 2067  .        shp = g
-0001abb0: 7064 2e72 6561 645f 6669 6c65 2876 6563  pd.read_file(vec
-0001abc0: 746f 725f 7061 7468 5f69 6e29 0a20 2020  tor_path_in).   
-0001abd0: 2020 2020 2073 6870 203d 2073 6870 2e64       shp = shp.d
-0001abe0: 6973 736f 6c76 6528 6279 3d6e 616d 655f  issolve(by=name_
-0001abf0: 6f66 5f66 696c 6564 290a 2020 2020 2020  of_filed).      
-0001ac00: 2020 7368 7020 5b27 7465 6d70 275d 203d    shp ['temp'] =
-0001ac10: 2073 6870 2e69 6e64 6578 0a20 2020 2020   shp.index.     
-0001ac20: 2020 2073 6870 203d 2073 6870 2e72 6573     shp = shp.res
-0001ac30: 6574 5f69 6e64 6578 2864 726f 703d 5472  et_index(drop=Tr
-0001ac40: 7565 290a 2020 2020 2020 2020 7368 7020  ue).        shp 
-0001ac50: 5b6e 616d 655f 6f66 5f66 696c 6564 5d20  [name_of_filed] 
-0001ac60: 3d20 7368 7020 5b27 7465 6d70 275d 0a20  = shp ['temp']. 
-0001ac70: 2020 2020 2020 2073 6870 203d 2073 6870         shp = shp
-0001ac80: 2e64 726f 7028 636f 6c75 6d6e 733d 5b27  .drop(columns=['
-0001ac90: 7465 6d70 275d 290a 2020 2020 2020 2020  temp']).        
-0001aca0: 7368 702e 746f 5f66 696c 6528 7665 6374  shp.to_file(vect
-0001acb0: 6f72 5f70 6174 685f 6f75 7429 0a0a 2020  or_path_out)..  
-0001acc0: 2020 6465 6620 6578 7472 6163 745f 7661    def extract_va
-0001acd0: 6c75 655f 7469 6666 2028 2020 7365 6c66  lue_tiff (  self
-0001ace0: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
-0001acf0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001ad00: 6c6f 6e5f 696e 2c0a 2020 2020 2020 2020  lon_in,.        
+00017f20: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00017f30: 2020 2020 2020 2020 2020 2020 6e70 2e61              np.a
+00017f40: 7272 6179 2864 6174 615f 6672 616d 6529  rray(data_frame)
+00017f50: 2929 2c5c 0a20 2020 2020 2020 2020 2020  )),\.           
+00017f60: 2020 2020 2020 2020 2020 2020 2020 2063                 c
+00017f70: 6f6f 7264 733d 6469 6374 2874 696d 6520  oords=dict(time 
+00017f80: 3d20 6461 7461 5f66 7261 6d65 2e69 6e64  = data_frame.ind
+00017f90: 6578 2929 0a20 2020 2020 2020 2061 7474  ex)).        att
+00017fa0: 7220 3d20 7b7d 0a20 2020 2020 2020 2069  r = {}.        i
+00017fb0: 6620 756e 6974 5f6f 665f 7661 7269 6162  f unit_of_variab
+00017fc0: 6c65 3a0a 2020 2020 2020 2020 2020 2020  le:.            
+00017fd0: 6174 7472 2e75 7064 6174 6528 7b27 756e  attr.update({'un
+00017fe0: 6974 7327 203a 2075 6e69 745f 6f66 5f76  its' : unit_of_v
+00017ff0: 6172 6961 626c 657d 290a 2020 2020 2020  ariable}).      
+00018000: 2020 6966 2076 6172 6961 626c 655f 6c6f    if variable_lo
+00018010: 6e67 5f6e 616d 653a 0a20 2020 2020 2020  ng_name:.       
+00018020: 2020 2020 2061 7474 722e 7570 6461 7465       attr.update
+00018030: 287b 276c 6f6e 675f 6e61 6d65 2720 3a20  ({'long_name' : 
+00018040: 7661 7269 6162 6c65 5f6c 6f6e 675f 6e61  variable_long_na
+00018050: 6d65 7d29 0a20 2020 2020 2020 2064 6174  me}).        dat
+00018060: 615b 2776 616c 7565 7327 5d2e 6174 7472  a['values'].attr
+00018070: 733d 6174 7472 0a20 2020 2020 2020 2069  s=attr.        i
+00018080: 6620 7661 7269 6162 6c65 5f6e 616d 653a  f variable_name:
+00018090: 0a20 2020 2020 2020 2020 2020 2064 6174  .            dat
+000180a0: 6120 3d20 6461 7461 2e72 656e 616d 655f  a = data.rename_
+000180b0: 7661 7273 287b 2776 616c 7565 7327 3a76  vars({'values':v
+000180c0: 6172 6961 626c 655f 6e61 6d65 7d29 0a0a  ariable_name})..
+000180d0: 2020 2020 2020 2020 2320 6d65 7267 696e          # mergin
+000180e0: 6720 7468 6520 6461 7461 2061 6e64 2064  g the data and d
+000180f0: 6174 6120 696e 666f 726d 6174 696f 6e0a  ata information.
+00018100: 2020 2020 2020 2020 6461 7461 203d 2078          data = x
+00018110: 722e 6d65 7267 6528 5b64 6174 612c 2069  r.merge([data, i
+00018120: 6e66 6f5d 290a 0a20 2020 2020 2020 2023  nfo])..        #
+00018130: 2073 6176 6520 7468 6520 6669 6c65 2069   save the file i
+00018140: 6620 6e63 5f66 696c 6520 6973 2070 726f  f nc_file is pro
+00018150: 7669 6465 640a 2020 2020 2020 2020 6966  vided.        if
+00018160: 206e 6f74 2028 6e63 5f66 696c 655f 6e61   not (nc_file_na
+00018170: 6d65 2069 7320 4e6f 6e65 293a 0a20 2020  me is None):.   
+00018180: 2020 2020 2020 2020 2023 2074 6865 7265           # there
+00018190: 2069 7320 6e63 5f66 696c 655f 6e61 6d65   is nc_file_name
+000181a0: 2074 6f20 7361 7665 0a20 2020 2020 2020   to save.       
+000181b0: 2020 2020 2069 6620 6e63 5f66 696c 655f       if nc_file_
+000181c0: 7061 7468 2069 7320 4e6f 6e65 3a0a 2020  path is None:.  
+000181d0: 2020 2020 2020 2020 2020 2020 2020 6e63                nc
+000181e0: 5f66 696c 655f 7061 7468 203d 2027 270a  _file_path = ''.
+000181f0: 2020 2020 2020 2020 2020 2020 656c 7365              else
+00018200: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+00018210: 2020 6966 2028 6e6f 7420 6f73 2e70 6174    if (not os.pat
+00018220: 682e 6973 6469 7228 6e63 5f66 696c 655f  h.isdir(nc_file_
+00018230: 7061 7468 2929 3a0a 2020 2020 2020 2020  path)):.        
+00018240: 2020 2020 2020 2020 2020 2020 6f73 2e6d              os.m
+00018250: 616b 6564 6972 7328 6e63 5f66 696c 655f  akedirs(nc_file_
+00018260: 7061 7468 290a 2020 2020 2020 2020 2020  path).          
+00018270: 2020 6966 2046 696c 6c5f 7661 6c75 6520    if Fill_value 
+00018280: 6973 204e 6f6e 653a 0a20 2020 2020 2020  is None:.       
+00018290: 2020 2020 2020 2020 2046 696c 6c5f 7661           Fill_va
+000182a0: 6c75 6520 3d20 2d39 3939 390a 2020 2020  lue = -9999.    
+000182b0: 2020 2020 2020 2020 6966 2064 6174 615f          if data_
+000182c0: 6672 616d 652e 6170 706c 796d 6170 286c  frame.applymap(l
+000182d0: 616d 6264 6120 783a 2069 7369 6e73 7461  ambda x: isinsta
+000182e0: 6e63 6528 782c 2028 696e 742c 2066 6c6f  nce(x, (int, flo
+000182f0: 6174 2929 292e 616c 6c28 292e 616c 6c28  at))).all().all(
+00018300: 293a 0a20 2020 2020 2020 2020 2020 2020  ):.             
+00018310: 2020 2074 656d 7020 3d20 7b76 6172 6961     temp = {varia
+00018320: 626c 655f 6e61 6d65 3a7b 2764 7479 7065  ble_name:{'dtype
+00018330: 273a 2027 6f62 6a65 6374 272c 2027 5f46  ': 'object', '_F
+00018340: 696c 6c56 616c 7565 273a 2046 696c 6c5f  illValue': Fill_
+00018350: 7661 6c75 657d 7d0a 2020 2020 2020 2020  value}}.        
+00018360: 2020 2020 656c 7365 3a0a 2020 2020 2020      else:.      
+00018370: 2020 2020 2020 2020 2020 7465 6d70 203d            temp =
+00018380: 207b 7661 7269 6162 6c65 5f6e 616d 653a   {variable_name:
+00018390: 7b27 6474 7970 6527 3a20 276f 626a 6563  {'dtype': 'objec
+000183a0: 7427 7d7d 0a20 2020 2020 2020 2020 2020  t'}}.           
+000183b0: 2069 6620 6f73 2e70 6174 682e 6973 6669   if os.path.isfi
+000183c0: 6c65 286e 635f 6669 6c65 5f70 6174 682b  le(nc_file_path+
+000183d0: 6e63 5f66 696c 655f 6e61 6d65 293a 0a20  nc_file_name):. 
+000183e0: 2020 2020 2020 2020 2020 2020 2020 206f                 o
+000183f0: 732e 7265 6d6f 7665 286e 635f 6669 6c65  s.remove(nc_file
+00018400: 5f70 6174 682b 6e63 5f66 696c 655f 6e61  _path+nc_file_na
+00018410: 6d65 290a 2020 2020 2020 2020 2020 2020  me).            
+00018420: 6461 7461 2e74 6f5f 6e65 7463 6466 286e  data.to_netcdf(n
+00018430: 635f 6669 6c65 5f70 6174 682b 6e63 5f66  c_file_path+nc_f
+00018440: 696c 655f 6e61 6d65 2c20 656e 636f 6469  ile_name, encodi
+00018450: 6e67 3d74 656d 7029 0a20 2020 2020 2020  ng=temp).       
+00018460: 2020 2020 2070 7269 6e74 2822 4541 5359       print("EASY
+00018470: 4d4f 5245 2073 6176 6564 2074 6865 206e  MORE saved the n
+00018480: 6320 6669 6c65 2068 6572 653a 2022 2c6e  c file here: ",n
+00018490: 635f 6669 6c65 5f70 6174 682b 6e63 5f66  c_file_path+nc_f
+000184a0: 696c 655f 6e61 6d65 290a 2020 2020 2020  ile_name).      
+000184b0: 2020 2320 7265 7475 726e 2078 6172 7261    # return xarra
+000184c0: 7920 6461 7461 7365 740a 2020 2020 2020  y dataset.      
+000184d0: 2020 7265 7475 726e 2064 6174 610a 0a0a    return data...
+000184e0: 2020 2020 6465 6620 6368 6563 6b5f 6966      def check_if
+000184f0: 5f72 6f77 5f69 735f 6e75 6d65 7269 6320  _row_is_numeric 
+00018500: 2873 656c 662c 0a20 2020 2020 2020 2020  (self,.         
+00018510: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00018520: 2020 2020 2020 2020 6466 293a 0a0a 2020          df):..  
+00018530: 2020 2020 2020 2222 220a 2020 2020 2020        """.      
+00018540: 2020 4020 6175 7468 6f72 3a20 2020 2020    @ author:     
+00018550: 2020 2020 2020 2020 2020 2020 2053 6865               She
+00018560: 7276 616e 2047 6861 7261 7269 0a20 2020  rvan Gharari.   
+00018570: 2020 2020 2040 2047 6974 6875 623a 2020       @ Github:  
+00018580: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00018590: 6874 7470 733a 2f2f 6769 7468 7562 2e63  https://github.c
+000185a0: 6f6d 2f53 6865 7276 616e 4768 6172 6172  om/ShervanGharar
+000185b0: 692f 4541 5359 4d4f 5245 0a20 2020 2020  i/EASYMORE.     
+000185c0: 2020 2040 2061 7574 686f 7227 7320 656d     @ author's em
+000185d0: 6169 6c20 6964 3a20 2020 2020 2020 7368  ail id:       sh
+000185e0: 2e67 6861 7261 7269 4067 6d61 696c 2e63  .gharari@gmail.c
+000185f0: 6f6d 0a20 2020 2020 2020 2040 206c 6963  om.        @ lic
+00018600: 656e 7365 3a20 2020 2020 2020 2020 2020  ense:           
+00018610: 2020 2020 2020 474e 552d 4750 4c76 330a        GNU-GPLv3.
+00018620: 2020 2020 2020 2020 5468 6973 2066 756e          This fun
+00018630: 6374 696f 6e20 6765 7420 6120 7061 6e64  ction get a pand
+00018640: 6173 2064 6174 6166 7261 6d65 2061 6e64  as dataframe and
+00018650: 2064 6574 6572 6d69 6e20 6966 2061 2063   determin if a c
+00018660: 6f6c 756d 6e20 6973 2061 6c6c 206e 756d  olumn is all num
+00018670: 6572 6963 2028 696e 7420 6f72 2066 6c6f  eric (int or flo
+00018680: 6174 2920 6f72 206f 7468 6572 730a 2020  at) or others.  
+00018690: 2020 2020 2020 2d2d 2d2d 2d2d 2d2d 2d0a        ---------.
+000186a0: 2020 2020 2020 2020 6466 3a20 7061 6e64          df: pand
+000186b0: 6173 2064 6174 6166 7261 6d65 0a20 2020  as dataframe.   
+000186c0: 2020 2020 2072 6574 7572 6e3a 0a20 2020       return:.   
+000186d0: 2020 2020 2064 665f 7479 7065 3a20 7061       df_type: pa
+000186e0: 6e64 6173 2064 6174 615f 6672 616d 6520  ndas data_frame 
+000186f0: 7769 7468 2074 7970 6520 6f66 2065 6163  with type of eac
+00018700: 6820 726f 770a 2020 2020 2020 2020 2222  h row.        ""
+00018710: 220a 2020 2020 2020 2020 6466 5f74 7970  ".        df_typ
+00018720: 6520 3d20 6466 2e63 6f70 7928 290a 2020  e = df.copy().  
+00018730: 2020 2020 2020 6466 5f74 7970 6520 5b27        df_type ['
+00018740: 726f 775f 7479 7065 275d 203d 2027 4e61  row_type'] = 'Na
+00018750: 4e27 0a20 2020 2020 2020 2066 6f72 2069  N'.        for i
+00018760: 6e64 6578 2c20 726f 7720 696e 2064 662e  ndex, row in df.
+00018770: 6974 6572 726f 7773 2829 3a0a 2020 2020  iterrows():.    
+00018780: 2020 2020 2020 2020 726f 775f 6973 5f6e          row_is_n
+00018790: 756d 6572 6963 203d 2054 7275 650a 2020  umeric = True.  
+000187a0: 2020 2020 2020 2020 2020 666f 7220 7661            for va
+000187b0: 6c75 6520 696e 2072 6f77 3a0a 2020 2020  lue in row:.    
+000187c0: 2020 2020 2020 2020 2020 2020 7472 793a              try:
+000187d0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+000187e0: 2020 2020 2070 642e 746f 5f6e 756d 6572       pd.to_numer
+000187f0: 6963 2876 616c 7565 2c20 6572 726f 7273  ic(value, errors
+00018800: 3d27 7261 6973 6527 290a 2020 2020 2020  ='raise').      
+00018810: 2020 2020 2020 2020 2020 6578 6365 7074            except
+00018820: 2056 616c 7565 4572 726f 723a 0a20 2020   ValueError:.   
+00018830: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00018840: 2072 6f77 5f69 735f 6e75 6d65 7269 6320   row_is_numeric 
+00018850: 3d20 4661 6c73 650a 2020 2020 2020 2020  = False.        
+00018860: 2020 2020 2020 2020 2020 2020 6272 6561              brea
+00018870: 6b0a 2020 2020 2020 2020 2020 2020 6966  k.            if
+00018880: 2072 6f77 5f69 735f 6e75 6d65 7269 633a   row_is_numeric:
+00018890: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+000188a0: 2069 6620 7365 6c66 2e63 6865 636b 5f69   if self.check_i
+000188b0: 665f 726f 775f 6973 5f66 6c6f 6174 5f6f  f_row_is_float_o
+000188c0: 725f 696e 7428 726f 7729 3a0a 2020 2020  r_int(row):.    
+000188d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000188e0: 5420 3d20 2766 6c6f 6174 270a 2020 2020  T = 'float'.    
+000188f0: 2020 2020 2020 2020 2020 2020 656c 7365              else
+00018900: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+00018910: 2020 2020 2020 5420 3d20 2769 6e74 270a        T = 'int'.
+00018920: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00018930: 6466 5f74 7970 6520 5b27 726f 775f 7479  df_type ['row_ty
+00018940: 7065 275d 2e6c 6f63 5b69 6e64 6578 5d20  pe'].loc[index] 
+00018950: 3d20 540a 2020 2020 2020 2020 6466 5f74  = T.        df_t
+00018960: 7970 6520 3d20 6466 5f74 7970 652e 6c6f  ype = df_type.lo
+00018970: 635b 3a2c 205b 2772 6f77 5f74 7970 6527  c[:, ['row_type'
+00018980: 5d5d 2e63 6f70 7928 290a 2020 2020 2020  ]].copy().      
+00018990: 2020 7265 7475 726e 2064 665f 7479 7065    return df_type
+000189a0: 0a0a 0a20 2020 2064 6566 2063 6865 636b  ...    def check
+000189b0: 5f69 665f 726f 775f 6973 5f66 6c6f 6174  _if_row_is_float
+000189c0: 5f6f 725f 696e 7420 2873 656c 662c 0a20  _or_int (self,. 
+000189d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000189e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000189f0: 2020 2020 2072 6f77 293a 0a20 2020 2020       row):.     
+00018a00: 2020 2022 2222 0a20 2020 2020 2020 2040     """.        @
+00018a10: 2061 7574 686f 723a 2020 2020 2020 2020   author:        
+00018a20: 2020 2020 2020 2020 2020 5368 6572 7661            Sherva
+00018a30: 6e20 4768 6172 6172 690a 2020 2020 2020  n Gharari.      
+00018a40: 2020 4020 4769 7468 7562 3a20 2020 2020    @ Github:     
+00018a50: 2020 2020 2020 2020 2020 2020 2068 7474               htt
+00018a60: 7073 3a2f 2f67 6974 6875 622e 636f 6d2f  ps://github.com/
+00018a70: 5368 6572 7661 6e47 6861 7261 7269 2f45  ShervanGharari/E
+00018a80: 4153 594d 4f52 450a 2020 2020 2020 2020  ASYMORE.        
+00018a90: 4020 6175 7468 6f72 2773 2065 6d61 696c  @ author's email
+00018aa0: 2069 643a 2020 2020 2020 2073 682e 6768   id:       sh.gh
+00018ab0: 6172 6172 6940 676d 6169 6c2e 636f 6d0a  arari@gmail.com.
+00018ac0: 2020 2020 2020 2020 4020 6c69 6365 6e73          @ licens
+00018ad0: 653a 2020 2020 2020 2020 2020 2020 2020  e:              
+00018ae0: 2020 2047 4e55 2d47 504c 7633 0a20 2020     GNU-GPLv3.   
+00018af0: 2020 2020 2054 6869 7320 6675 6e63 7469       This functi
+00018b00: 6f6e 2067 6574 2061 2070 616e 6461 7320  on get a pandas 
+00018b10: 6461 7461 6672 616d 6520 726f 7720 616e  dataframe row an
+00018b20: 6420 6368 6563 6b20 6f66 2074 6865 2065  d check of the e
+00018b30: 6e74 6972 6520 726f 7720 6973 2066 6c6f  ntire row is flo
+00018b40: 6174 206f 7220 696e 740a 2020 2020 2020  at or int.      
+00018b50: 2020 2d2d 2d2d 2d2d 2d2d 2d0a 2020 2020    ---------.    
+00018b60: 2020 2020 726f 773a 2070 616e 6461 7320      row: pandas 
+00018b70: 6461 7461 5f66 7261 6d65 2072 6f77 0a20  data_frame row. 
+00018b80: 2020 2020 2020 2072 6574 7572 6e0a 2020         return.  
+00018b90: 2020 2020 2020 6861 735f 666c 6f61 743a        has_float:
+00018ba0: 2062 6f6f 6c65 616e 206f 7220 6c6f 6769   boolean or logi
+00018bb0: 6361 6c2c 2066 6c61 6720 7468 6174 2069  cal, flag that i
+00018bc0: 6e64 6963 6174 6520 7468 6520 726f 7720  ndicate the row 
+00018bd0: 6861 7320 6120 666c 6f61 740a 2020 2020  has a float.    
+00018be0: 2020 2020 2222 220a 2020 2020 2020 2020      """.        
+00018bf0: 6861 735f 666c 6f61 7420 3d20 4661 6c73  has_float = Fals
+00018c00: 650a 2020 2020 2020 2020 666f 7220 6974  e.        for it
+00018c10: 656d 2069 6e20 726f 773a 0a20 2020 2020  em in row:.     
+00018c20: 2020 2020 2020 2069 6620 6973 696e 7374         if isinst
+00018c30: 616e 6365 2870 642e 746f 5f6e 756d 6572  ance(pd.to_numer
+00018c40: 6963 2869 7465 6d2c 2065 7272 6f72 733d  ic(item, errors=
+00018c50: 2772 6169 7365 2729 2c20 666c 6f61 7429  'raise'), float)
+00018c60: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+00018c70: 2020 6861 735f 666c 6f61 7420 3d20 5472    has_float = Tr
+00018c80: 7565 0a20 2020 2020 2020 2020 2020 2020  ue.             
+00018c90: 2020 2062 7265 616b 0a20 2020 2020 2020     break.       
+00018ca0: 2072 6574 7572 6e20 6861 735f 666c 6f61   return has_floa
+00018cb0: 740a 0a0a 2020 2020 2323 2323 2323 2323  t...    ########
+00018cc0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+00018cd0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+00018ce0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+00018cf0: 2323 2323 2323 0a20 2020 2023 2323 2320  ######.    #### 
+00018d00: 4749 5320 7365 6374 696f 6e0a 2020 2020  GIS section.    
+00018d10: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+00018d20: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+00018d30: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+00018d40: 2323 2323 2323 2323 2323 2323 2323 0a0a  ##############..
+00018d50: 2020 2020 6465 6620 696e 7465 7273 6563      def intersec
+00018d60: 7469 6f6e 5f73 6870 2820 2020 7365 6c66  tion_shp(   self
+00018d70: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
+00018d80: 2020 2020 2020 2020 2020 2020 2020 7368                sh
+00018d90: 705f 312c 0a20 2020 2020 2020 2020 2020  p_1,.           
+00018da0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00018db0: 2073 6870 5f32 293a 0a20 2020 2020 2020   shp_2):.       
+00018dc0: 2069 6d70 6f72 7420 6765 6f70 616e 6461   import geopanda
+00018dd0: 7320 6173 2067 7064 0a20 2020 2020 2020  s as gpd.       
+00018de0: 2066 726f 6d20 2020 7368 6170 656c 792e   from   shapely.
+00018df0: 6765 6f6d 6574 7279 2069 6d70 6f72 7420  geometry import 
+00018e00: 506f 6c79 676f 6e0a 2020 2020 2020 2020  Polygon.        
+00018e10: 2369 6d70 6f72 7420 7368 6170 6566 696c  #import shapefil
+00018e20: 6520 2320 7079 7368 6564 206c 6962 7261  e # pyshed libra
+00018e30: 7279 0a20 2020 2020 2020 2069 6d70 6f72  ry.        impor
+00018e40: 7420 7368 6170 656c 790a 2020 2020 2020  t shapely.      
+00018e50: 2020 2222 220a 2020 2020 2020 2020 4020    """.        @ 
+00018e60: 6175 7468 6f72 3a20 2020 2020 2020 2020  author:         
+00018e70: 2020 2020 2020 2020 2053 6865 7276 616e           Shervan
+00018e80: 2047 6861 7261 7269 0a20 2020 2020 2020   Gharari.       
+00018e90: 2040 2047 6974 6875 623a 2020 2020 2020   @ Github:      
+00018ea0: 2020 2020 2020 2020 2020 2020 6874 7470              http
+00018eb0: 733a 2f2f 6769 7468 7562 2e63 6f6d 2f53  s://github.com/S
+00018ec0: 6865 7276 616e 4768 6172 6172 692f 4541  hervanGharari/EA
+00018ed0: 5359 4d4f 5245 0a20 2020 2020 2020 2040  SYMORE.        @
+00018ee0: 2061 7574 686f 7227 7320 656d 6169 6c20   author's email 
+00018ef0: 6964 3a20 2020 2020 2020 7368 2e67 6861  id:       sh.gha
+00018f00: 7261 7269 4067 6d61 696c 2e63 6f6d 0a20  rari@gmail.com. 
+00018f10: 2020 2020 2020 2040 6c69 6365 6e73 653a         @license:
+00018f20: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00018f30: 2020 474e 552d 4750 4c76 330a 2020 2020    GNU-GPLv3.    
+00018f40: 2020 2020 5468 6973 2066 756e 6374 696f      This functio
+00018f50: 6e20 696e 7465 7273 6563 7473 2074 776f  n intersects two
+00018f60: 2073 6861 7065 6669 6c65 732e 2049 7420   shapefiles. It 
+00018f70: 6b65 6570 7320 7468 6520 6174 7472 6962  keeps the attrib
+00018f80: 7574 6573 2066 726f 6d20 7468 6520 6669  utes from the fi
+00018f90: 7273 7420 616e 6420 7365 636f 6e64 2073  rst and second s
+00018fa0: 6861 7065 6669 6c65 7320 2869 6465 6e74  hapefiles (ident
+00018fb0: 6966 6965 6420 6279 2070 7265 6669 7820  ified by prefix 
+00018fc0: 535f 315f 2061 6e64 0a20 2020 2020 2020  S_1_ and.       
+00018fd0: 2053 5f32 5f29 2e20 4974 2061 6c73 6f20   S_2_). It also 
+00018fe0: 6372 6561 7465 7320 6f74 6865 7220 6669  creates other fi
+00018ff0: 656c 6473 2069 6e63 6c75 6469 6e67 2041  elds including A
+00019000: 5331 2028 6172 6561 206f 6620 7468 6520  S1 (area of the 
+00019010: 7368 6170 6520 656c 656d 656e 7420 6672  shape element fr
+00019020: 6f6d 2073 6861 7065 6669 6c65 2031 292c  om shapefile 1),
+00019030: 2049 4453 3120 2861 6e20 6172 6269 7472   IDS1 (an arbitr
+00019040: 6172 7920 696e 6465 780a 2020 2020 2020  ary index.      
+00019050: 2020 666f 7220 7468 6520 7368 6170 6566    for the shapef
+00019060: 696c 6520 3129 2c20 4153 3220 2861 7265  ile 1), AS2 (are
+00019070: 6120 6f66 2074 6865 2073 6861 7065 2065  a of the shape e
+00019080: 6c65 6d65 6e74 2066 726f 6d20 7368 6170  lement from shap
+00019090: 6566 696c 6520 3129 2c20 4944 5332 2028  efile 1), IDS2 (
+000190a0: 616e 2061 7262 6974 7261 7279 2069 6e64  an arbitrary ind
+000190b0: 6578 2066 6f72 2074 6865 2073 6861 7065  ex for the shape
+000190c0: 6669 6c65 2031 292c 0a20 2020 2020 2020  file 1),.       
+000190d0: 2041 494e 5420 2874 6865 2061 7265 6120   AINT (the area 
+000190e0: 6f66 2074 6865 2069 6e74 6572 7365 6374  of the intersect
+000190f0: 6564 2073 6861 7065 7329 2c20 4150 3120  ed shapes), AP1 
+00019100: 2874 6865 2061 7265 6120 6f66 2074 6865  (the area of the
+00019110: 2069 6e74 6572 7365 6374 6564 2073 6861   intersected sha
+00019120: 7065 2074 6f20 7468 6520 7368 6170 6573  pe to the shapes
+00019130: 2066 726f 6d20 7368 6170 6566 696c 6520   from shapefile 
+00019140: 3129 2c0a 2020 2020 2020 2020 4150 3220  1),.        AP2 
+00019150: 2874 6865 2061 7265 6120 6f66 2074 6865  (the area of the
+00019160: 2069 6e74 6572 7365 6374 6564 2073 6861   intersected sha
+00019170: 7065 2074 6f20 7468 6520 7368 6170 6573  pe to the shapes
+00019180: 2066 726f 6d20 7368 6170 6566 696c 6520   from shapefile 
+00019190: 3229 2c20 4150 314e 2028 7468 6520 6172  2), AP1N (the ar
+000191a0: 6561 206e 6f72 6d61 6c69 7a65 6420 696e  ea normalized in
+000191b0: 2074 6865 2063 6173 6520 4150 310a 2020   the case AP1.  
+000191c0: 2020 2020 2020 7375 6d6d 6174 696f 6e20        summation 
+000191d0: 6973 206c 6573 7320 7468 616e 206f 6e65  is less than one
+000191e0: 2066 6f72 2061 2067 6976 656e 2073 6861   for a given sha
+000191f0: 7065 2066 726f 6d20 7368 6170 6566 696c  pe from shapefil
+00019200: 6520 312c 2074 6869 7320 7769 6c6c 2068  e 1, this will h
+00019210: 656c 7020 746f 2070 7265 7365 7276 6520  elp to preserve 
+00019220: 6d61 7373 2069 6620 7061 7274 7320 6f66  mass if parts of
+00019230: 2074 6865 2073 6861 7065 6669 6c65 2061   the shapefile a
+00019240: 7265 206e 6f74 0a20 2020 2020 2020 2069  re not.        i
+00019250: 6e74 6572 7365 6374 6564 2c20 666f 7220  ntersected, for 
+00019260: 6578 616d 706c 652c 2073 6861 7065 6669  example, shapefi
+00019270: 6c65 206f 7665 7265 7874 656e 6473 2074  le overextends t
+00019280: 6865 2065 7869 7374 696e 6720 646f 6d61  he existing doma
+00019290: 696e 206f 6620 7468 6520 6f74 6865 7220  in of the other 
+000192a0: 7368 6170 6566 696c 6529 2c20 4150 324e  shapefile), AP2N
+000192b0: 2028 7468 6520 6172 6561 206e 6f72 6d61   (the area norma
+000192c0: 6c69 7a65 6420 696e 2074 6865 2063 6173  lized in the cas
+000192d0: 6520 4150 320a 2020 2020 2020 2020 7375  e AP2.        su
+000192e0: 6d6d 6174 696f 6e20 6973 206c 6573 7320  mmation is less 
+000192f0: 7468 616e 206f 6e65 2066 6f72 2061 2067  than one for a g
+00019300: 6976 656e 2073 6861 7065 2066 726f 6d20  iven shape from 
+00019310: 7368 6170 6566 696c 6520 322c 2074 6869  shapefile 2, thi
+00019320: 7320 7769 6c6c 2068 656c 7020 746f 2070  s will help to p
+00019330: 7265 7365 7276 6520 6d61 7373 2069 6620  reserve mass if 
+00019340: 7061 7274 7320 6f66 2074 6865 2073 6861  parts of the sha
+00019350: 7065 6669 6c65 2061 7265 206e 6f74 0a20  pefile are not. 
+00019360: 2020 2020 2020 2069 6e74 6572 7365 6374         intersect
+00019370: 6564 2c20 666f 7220 6578 616d 706c 652c  ed, for example,
+00019380: 2073 6861 7065 6669 6c65 206f 7665 7265   shapefile overe
+00019390: 7874 656e 6473 2074 6865 2065 7869 7374  xtends the exist
+000193a0: 696e 6720 646f 6d61 696e 206f 6620 7468  ing domain of th
+000193b0: 6520 6f74 6865 7220 7368 6170 6566 696c  e other shapefil
+000193c0: 6529 0a20 2020 2020 2020 2041 7267 756d  e).        Argum
+000193d0: 656e 7473 0a20 2020 2020 2020 202d 2d2d  ents.        ---
+000193e0: 2d2d 2d2d 2d2d 0a20 2020 2020 2020 2073  ------.        s
+000193f0: 6870 5f31 3a20 6765 6f20 6461 7461 2066  hp_1: geo data f
+00019400: 7261 6d65 2c20 7368 6170 6566 696c 6520  rame, shapefile 
+00019410: 310a 2020 2020 2020 2020 7368 705f 323a  1.        shp_2:
+00019420: 2067 656f 2064 6174 6120 6672 616d 652c   geo data frame,
+00019430: 2073 6861 7065 6669 6c65 2032 0a20 2020   shapefile 2.   
+00019440: 2020 2020 2052 6574 7572 6e73 0a20 2020       Returns.   
+00019450: 2020 2020 202d 2d2d 2d2d 2d2d 0a20 2020       -------.   
+00019460: 2020 2020 2072 6573 756c 743a 2061 2067       result: a g
+00019470: 656f 6461 7461 6672 616d 6520 7468 6174  eodataframe that
+00019480: 2069 6e63 6c75 6465 7320 7468 6520 696e   includes the in
+00019490: 7465 7273 6563 7465 6420 7368 6170 6566  tersected shapef
+000194a0: 696c 6520 616e 6420 6172 6561 2c20 7065  ile and area, pe
+000194b0: 7263 656e 7420 616e 6420 6e6f 726d 616c  rcent and normal
+000194c0: 697a 6564 2070 6572 6365 6e74 206f 6620  ized percent of 
+000194d0: 6561 6368 2073 6861 7065 0a20 2020 2020  each shape.     
+000194e0: 2020 2065 6c65 6d65 6e74 7320 696e 2061     elements in a
+000194f0: 6e6f 7468 6572 206f 6e65 0a20 2020 2020  nother one.     
+00019500: 2020 2022 2222 0a20 2020 2020 2020 2023     """.        #
+00019510: 2067 6574 2074 6865 2063 6f6c 756d 6e20   get the column 
+00019520: 6e61 6d65 206f 6620 7368 705f 310a 2020  name of shp_1.  
+00019530: 2020 2020 2020 636f 6c75 6d6e 5f6e 616d        column_nam
+00019540: 6573 203d 2073 6870 5f31 2e63 6f6c 756d  es = shp_1.colum
+00019550: 6e73 0a20 2020 2020 2020 2063 6f6c 756d  ns.        colum
+00019560: 6e5f 6e61 6d65 7320 3d20 6c69 7374 2863  n_names = list(c
+00019570: 6f6c 756d 6e5f 6e61 6d65 7329 0a20 2020  olumn_names).   
+00019580: 2020 2020 2023 2072 656d 6f76 696e 6720       # removing 
+00019590: 7468 6520 6765 6f6d 6574 7279 2066 726f  the geometry fro
+000195a0: 6d20 7468 6520 636f 6c75 6d6e 206e 616d  m the column nam
+000195b0: 6573 0a20 2020 2020 2020 2063 6f6c 756d  es.        colum
+000195c0: 6e5f 6e61 6d65 732e 7265 6d6f 7665 2827  n_names.remove('
+000195d0: 6765 6f6d 6574 7279 2729 0a20 2020 2020  geometry').     
+000195e0: 2020 2023 2072 656e 616d 696e 6720 7468     # renaming th
+000195f0: 6520 636f 6c75 6d6e 2077 6974 6820 535f  e column with S_
+00019600: 310a 2020 2020 2020 2020 636f 6c75 6d6e  1.        column
+00019610: 5f6e 616d 6573 5f6e 6577 203d 205b 2753  _names_new = ['S
+00019620: 5f31 5f27 202b 2073 2066 6f72 2073 2069  _1_' + s for s i
+00019630: 6e20 636f 6c75 6d6e 5f6e 616d 6573 5d0a  n column_names].
+00019640: 2020 2020 2020 2020 7265 6e61 6d69 6e67          renaming
+00019650: 203d 2064 6963 7428 7a69 7028 636f 6c75   = dict(zip(colu
+00019660: 6d6e 5f6e 616d 6573 2c20 636f 6c75 6d6e  mn_names, column
+00019670: 5f6e 616d 6573 5f6e 6577 2929 0a20 2020  _names_new)).   
+00019680: 2020 2020 2073 6870 5f31 2e72 656e 616d       shp_1.renam
+00019690: 6528 636f 6c75 6d6e 7320 3d20 7265 6e61  e(columns = rena
+000196a0: 6d69 6e67 2c20 696e 706c 6163 653d 5472  ming, inplace=Tr
+000196b0: 7565 290a 2020 2020 2020 2020 2320 4361  ue).        # Ca
+000196c0: 636c 756c 6174 6520 7468 6520 6172 6561  clulate the area
+000196d0: 2066 6f72 2073 6870 310a 2020 2020 2020   for shp1.      
+000196e0: 2020 7368 705f 315b 2741 5331 275d 2020    shp_1['AS1']  
+000196f0: 3d20 7368 705f 312e 6172 6561 0a20 2020  = shp_1.area.   
+00019700: 2020 2020 2073 6870 5f31 5b27 4944 5331       shp_1['IDS1
+00019710: 275d 203d 206e 702e 6172 616e 6765 2873  '] = np.arange(s
+00019720: 6870 5f31 2e73 6861 7065 5b30 5d29 2b31  hp_1.shape[0])+1
+00019730: 0a20 2020 2020 2020 2023 2067 6574 2074  .        # get t
+00019740: 6865 2063 6f6c 756d 6e20 6e61 6d65 206f  he column name o
+00019750: 6620 7368 705f 320a 2020 2020 2020 2020  f shp_2.        
+00019760: 636f 6c75 6d6e 5f6e 616d 6573 203d 2073  column_names = s
+00019770: 6870 5f32 2e63 6f6c 756d 6e73 0a20 2020  hp_2.columns.   
+00019780: 2020 2020 2063 6f6c 756d 6e5f 6e61 6d65       column_name
+00019790: 7320 3d20 6c69 7374 2863 6f6c 756d 6e5f  s = list(column_
+000197a0: 6e61 6d65 7329 0a20 2020 2020 2020 2023  names).        #
+000197b0: 2072 656d 6f76 696e 6720 7468 6520 6765   removing the ge
+000197c0: 6f6d 6574 7279 2066 726f 6d20 7468 6520  ometry from the 
+000197d0: 636f 6c6f 6d6e 206e 616d 6573 0a20 2020  colomn names.   
+000197e0: 2020 2020 2063 6f6c 756d 6e5f 6e61 6d65       column_name
+000197f0: 732e 7265 6d6f 7665 2827 6765 6f6d 6574  s.remove('geomet
+00019800: 7279 2729 0a20 2020 2020 2020 2023 2072  ry').        # r
+00019810: 656e 616d 696e 6720 7468 6520 636f 6c75  enaming the colu
+00019820: 6d6e 2077 6974 6820 535f 320a 2020 2020  mn with S_2.    
+00019830: 2020 2020 636f 6c75 6d6e 5f6e 616d 6573      column_names
+00019840: 5f6e 6577 203d 205b 2753 5f32 5f27 202b  _new = ['S_2_' +
+00019850: 2073 2066 6f72 2073 2069 6e20 636f 6c75   s for s in colu
+00019860: 6d6e 5f6e 616d 6573 5d0a 2020 2020 2020  mn_names].      
+00019870: 2020 7265 6e61 6d69 6e67 203d 2064 6963    renaming = dic
+00019880: 7428 7a69 7028 636f 6c75 6d6e 5f6e 616d  t(zip(column_nam
+00019890: 6573 2c20 636f 6c75 6d6e 5f6e 616d 6573  es, column_names
+000198a0: 5f6e 6577 2929 0a20 2020 2020 2020 2073  _new)).        s
+000198b0: 6870 5f32 2e72 656e 616d 6528 636f 6c75  hp_2.rename(colu
+000198c0: 6d6e 7320 3d20 7265 6e61 6d69 6e67 2c20  mns = renaming, 
+000198d0: 696e 706c 6163 653d 5472 7565 290a 2020  inplace=True).  
+000198e0: 2020 2020 2020 2320 4361 636c 756c 6174        # Caclulat
+000198f0: 6520 7468 6520 6172 6561 2066 6f72 2073  e the area for s
+00019900: 6870 320a 2020 2020 2020 2020 7368 705f  hp2.        shp_
+00019910: 325b 2741 5332 275d 2020 3d20 7368 705f  2['AS2']  = shp_
+00019920: 322e 6172 6561 0a20 2020 2020 2020 2073  2.area.        s
+00019930: 6870 5f32 5b27 4944 5332 275d 203d 206e  hp_2['IDS2'] = n
+00019940: 702e 6172 616e 6765 2873 6870 5f32 2e73  p.arange(shp_2.s
+00019950: 6861 7065 5b30 5d29 2b31 0a20 2020 2020  hape[0])+1.     
+00019960: 2020 2023 2049 6e74 6572 7365 6374 696f     # Intersectio
+00019970: 6e0a 2020 2020 2020 2020 7265 7375 6c74  n.        result
+00019980: 203d 2073 656c 662e 7370 6174 6961 6c5f   = self.spatial_
+00019990: 6f76 6572 6c61 7973 2028 7368 705f 312c  overlays (shp_1,
+000199a0: 2073 6870 5f32 2c20 686f 773d 2769 6e74   shp_2, how='int
+000199b0: 6572 7365 6374 696f 6e27 290a 2020 2020  ersection').    
+000199c0: 2020 2020 2320 4361 636c 756c 6174 6520      # Caclulate 
+000199d0: 7468 6520 6172 6561 2066 6f72 2073 6870  the area for shp
+000199e0: 320a 2020 2020 2020 2020 7265 7375 6c74  2.        result
+000199f0: 5b27 4149 4e54 275d 203d 2072 6573 756c  ['AINT'] = resul
+00019a00: 745b 2767 656f 6d65 7472 7927 5d2e 6172  t['geometry'].ar
+00019a10: 6561 0a20 2020 2020 2020 2072 6573 756c  ea.        resul
+00019a20: 745b 2741 5031 275d 2020 3d20 7265 7375  t['AP1']  = resu
+00019a30: 6c74 5b27 4149 4e54 275d 2f72 6573 756c  lt['AINT']/resul
+00019a40: 745b 2741 5331 275d 0a20 2020 2020 2020  t['AS1'].       
+00019a50: 2072 6573 756c 745b 2741 5032 275d 2020   result['AP2']  
+00019a60: 3d20 7265 7375 6c74 5b27 4149 4e54 275d  = result['AINT']
+00019a70: 2f72 6573 756c 745b 2741 5332 275d 0a20  /result['AS2']. 
+00019a80: 2020 2020 2020 2023 2043 616c 6375 6c61         # Calcula
+00019a90: 7465 2074 6865 206e 6f72 6d61 6c69 7a65  te the normalize
+00019aa0: 6420 6172 6561 2066 6f72 2041 5031 2061  d area for AP1 a
+00019ab0: 6e64 2041 5032 2074 6f20 636f 6e73 6572  nd AP2 to conser
+00019ac0: 7665 206d 6173 730a 2020 2020 2020 2020  ve mass.        
+00019ad0: 7265 7375 6c74 5b27 4944 5331 275d 203d  result['IDS1'] =
+00019ae0: 2072 6573 756c 745b 2749 4453 3127 5d2e   result['IDS1'].
+00019af0: 6173 7479 7065 2869 6e74 290a 2020 2020  astype(int).    
+00019b00: 2020 2020 7265 7375 6c74 5b27 4944 5332      result['IDS2
+00019b10: 275d 203d 2072 6573 756c 745b 2749 4453  '] = result['IDS
+00019b20: 3227 5d2e 6173 7479 7065 2869 6e74 290a  2'].astype(int).
+00019b30: 2020 2020 2020 2020 230a 2020 2020 2020          #.      
+00019b40: 2020 6466 203d 2070 642e 4461 7461 4672    df = pd.DataFr
+00019b50: 616d 6528 290a 2020 2020 2020 2020 6466  ame().        df
+00019b60: 5b27 4150 3127 5d20 3d20 7265 7375 6c74  ['AP1'] = result
+00019b70: 5b27 4150 3127 5d2e 7661 6c75 6573 0a20  ['AP1'].values. 
+00019b80: 2020 2020 2020 2064 665b 2749 4453 3127         df['IDS1'
+00019b90: 5d20 3d20 7265 7375 6c74 5b27 4944 5331  ] = result['IDS1
+00019ba0: 275d 2e76 616c 7565 730a 2020 2020 2020  '].values.      
+00019bb0: 2020 6466 5b27 4150 314e 275d 203d 2064    df['AP1N'] = d
+00019bc0: 665b 2741 5031 275d 202f 2064 662e 6772  f['AP1'] / df.gr
+00019bd0: 6f75 7062 7928 2749 4453 3127 295b 2741  oupby('IDS1')['A
+00019be0: 5031 275d 2e74 7261 6e73 666f 726d 2827  P1'].transform('
+00019bf0: 7375 6d27 290a 2020 2020 2020 2020 2320  sum').        # 
+00019c00: 6466 5b27 4150 314e 275d 203d 2064 662e  df['AP1N'] = df.
+00019c10: 6772 6f75 7062 7928 2749 4453 3127 295b  groupby('IDS1')[
+00019c20: 2741 5031 275d 2e61 7070 6c79 286c 616d  'AP1'].apply(lam
+00019c30: 6264 6120 783a 2028 7820 2f20 782e 7375  bda x: (x / x.su
+00019c40: 6d28 2929 292e 7265 7365 745f 696e 6465  m())).reset_inde
+00019c50: 7828 6472 6f70 3d54 7275 6529 0a20 2020  x(drop=True).   
+00019c60: 2020 2020 2072 6573 756c 745b 2741 5031       result['AP1
+00019c70: 4e27 5d20 3d20 6466 5b27 4150 314e 275d  N'] = df['AP1N']
+00019c80: 2e76 616c 7565 730a 2020 2020 2020 2020  .values.        
+00019c90: 230a 2020 2020 2020 2020 6466 203d 2070  #.        df = p
+00019ca0: 642e 4461 7461 4672 616d 6528 290a 2020  d.DataFrame().  
+00019cb0: 2020 2020 2020 6466 5b27 4150 3227 5d20        df['AP2'] 
+00019cc0: 3d20 7265 7375 6c74 5b27 4150 3227 5d2e  = result['AP2'].
+00019cd0: 7661 6c75 6573 0a20 2020 2020 2020 2064  values.        d
+00019ce0: 665b 2749 4453 3227 5d20 3d20 7265 7375  f['IDS2'] = resu
+00019cf0: 6c74 5b27 4944 5332 275d 2e76 616c 7565  lt['IDS2'].value
+00019d00: 730a 2020 2020 2020 2020 6466 5b27 4150  s.        df['AP
+00019d10: 324e 275d 203d 2064 665b 2741 5032 275d  2N'] = df['AP2']
+00019d20: 202f 2064 662e 6772 6f75 7062 7928 2749   / df.groupby('I
+00019d30: 4453 3227 295b 2741 5032 275d 2e74 7261  DS2')['AP2'].tra
+00019d40: 6e73 666f 726d 2827 7375 6d27 290a 2020  nsform('sum').  
+00019d50: 2020 2020 2020 2364 665b 2741 5032 4e27        #df['AP2N'
+00019d60: 5d20 3d20 6466 2e67 726f 7570 6279 2827  ] = df.groupby('
+00019d70: 4944 5332 2729 5b27 4150 3227 5d2e 6170  IDS2')['AP2'].ap
+00019d80: 706c 7928 6c61 6d62 6461 2078 3a20 2878  ply(lambda x: (x
+00019d90: 202f 2078 2e73 756d 2829 2929 2e72 6573   / x.sum())).res
+00019da0: 6574 5f69 6e64 6578 2864 726f 703d 5472  et_index(drop=Tr
+00019db0: 7565 290a 2020 2020 2020 2020 7265 7375  ue).        resu
+00019dc0: 6c74 5b27 4150 324e 275d 203d 2064 665b  lt['AP2N'] = df[
+00019dd0: 2741 5032 4e27 5d2e 7661 6c75 6573 0a20  'AP2N'].values. 
+00019de0: 2020 2020 2020 2023 2072 6574 7572 6e0a         # return.
+00019df0: 2020 2020 2020 2020 7265 7475 726e 2072          return r
+00019e00: 6573 756c 740a 0a20 2020 2064 6566 2073  esult..    def s
+00019e10: 7061 7469 616c 5f6f 7665 726c 6179 7328  patial_overlays(
+00019e20: 7365 6c66 2c0a 2020 2020 2020 2020 2020  self,.          
+00019e30: 2020 2020 2020 2020 2020 2020 2020 2064                 d
+00019e40: 6631 2c0a 2020 2020 2020 2020 2020 2020  f1,.            
+00019e50: 2020 2020 2020 2020 2020 2020 2064 6632               df2
+00019e60: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
+00019e70: 2020 2020 2020 2020 2020 2068 6f77 3d27             how='
+00019e80: 696e 7465 7273 6563 7469 6f6e 272c 0a20  intersection',. 
+00019e90: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00019ea0: 2020 2020 2020 2020 7265 7072 6f6a 6563          reprojec
+00019eb0: 743d 5472 7565 293a 0a20 2020 2020 2020  t=True):.       
+00019ec0: 2069 6d70 6f72 7420 6765 6f70 616e 6461   import geopanda
+00019ed0: 7320 6173 2067 7064 0a20 2020 2020 2020  s as gpd.       
+00019ee0: 2066 726f 6d20 2020 7368 6170 656c 792e   from   shapely.
+00019ef0: 6765 6f6d 6574 7279 2069 6d70 6f72 7420  geometry import 
+00019f00: 506f 6c79 676f 6e0a 2020 2020 2020 2020  Polygon.        
+00019f10: 2369 6d70 6f72 7420 7368 6170 6566 696c  #import shapefil
+00019f20: 6520 2320 7079 7368 6564 206c 6962 7261  e # pyshed libra
+00019f30: 7279 0a20 2020 2020 2020 2069 6d70 6f72  ry.        impor
+00019f40: 7420 7368 6170 656c 790a 2020 2020 2020  t shapely.      
+00019f50: 2020 2222 220a 2020 2020 2020 2020 5065    """.        Pe
+00019f60: 7266 6f72 6d20 7370 6174 6961 6c20 6f76  rform spatial ov
+00019f70: 6572 6c61 7920 6265 7477 6565 6e20 7477  erlay between tw
+00019f80: 6f20 706f 6c79 676f 6e73 2e0a 2020 2020  o polygons..    
+00019f90: 2020 2020 4375 7272 656e 746c 7920 6f6e      Currently on
+00019fa0: 6c79 2073 7570 706f 7274 7320 6461 7461  ly supports data
+00019fb0: 2047 656f 4461 7461 4672 616d 6573 2077   GeoDataFrames w
+00019fc0: 6974 6820 706f 6c79 676f 6e73 2e0a 2020  ith polygons..  
+00019fd0: 2020 2020 2020 496d 706c 656d 656e 7473        Implements
+00019fe0: 2073 6576 6572 616c 206d 6574 686f 6473   several methods
+00019ff0: 2074 6861 7420 6172 6520 616c 6c20 6566   that are all ef
+0001a000: 6665 6374 6976 656c 7920 7375 6273 6574  fectively subset
+0001a010: 7320 6f66 0a20 2020 2020 2020 2074 6865  s of.        the
+0001a020: 2075 6e69 6f6e 2e0a 2020 2020 2020 2020   union..        
+0001a030: 6175 7468 6f72 3a20 4f6d 6572 204f 7a61  author: Omer Oza
+0001a040: 6b20 2877 6974 6820 6869 7320 7065 726d  k (with his perm
+0001a050: 6973 7369 6f6e 290a 2020 2020 2020 2020  ission).        
+0001a060: 6874 7470 733a 2f2f 6769 7468 7562 2e63  https://github.c
+0001a070: 6f6d 2f6f 7a61 6b0a 2020 2020 2020 2020  om/ozak.        
+0001a080: 6874 7470 733a 2f2f 6769 7468 7562 2e63  https://github.c
+0001a090: 6f6d 2f67 656f 7061 6e64 6173 2f67 656f  om/geopandas/geo
+0001a0a0: 7061 6e64 6173 2f70 756c 6c2f 3333 380a  pandas/pull/338.
+0001a0b0: 2020 2020 2020 2020 6c69 6365 6e73 653a          license:
+0001a0c0: 2047 4e55 2d47 504c 7633 0a20 2020 2020   GNU-GPLv3.     
+0001a0d0: 2020 2050 6172 616d 6574 6572 730a 2020     Parameters.  
+0001a0e0: 2020 2020 2020 2d2d 2d2d 2d2d 2d2d 2d2d        ----------
+0001a0f0: 0a20 2020 2020 2020 2064 6631 3a20 4765  .        df1: Ge
+0001a100: 6f44 6174 6146 7261 6d65 2077 6974 6820  oDataFrame with 
+0001a110: 4d75 6c74 6950 6f6c 7967 6f6e 206f 7220  MultiPolygon or 
+0001a120: 506f 6c79 676f 6e20 6765 6f6d 6574 7279  Polygon geometry
+0001a130: 2063 6f6c 756d 6e0a 2020 2020 2020 2020   column.        
+0001a140: 6466 323a 2047 656f 4461 7461 4672 616d  df2: GeoDataFram
+0001a150: 6520 7769 7468 204d 756c 7469 506f 6c79  e with MultiPoly
+0001a160: 676f 6e20 6f72 2050 6f6c 7967 6f6e 2067  gon or Polygon g
+0001a170: 656f 6d65 7472 7920 636f 6c75 6d6e 0a20  eometry column. 
+0001a180: 2020 2020 2020 2068 6f77 3a20 7374 7269         how: stri
+0001a190: 6e67 0a20 2020 2020 2020 2020 2020 204d  ng.            M
+0001a1a0: 6574 686f 6420 6f66 2073 7061 7469 616c  ethod of spatial
+0001a1b0: 206f 7665 726c 6179 3a20 2769 6e74 6572   overlay: 'inter
+0001a1c0: 7365 6374 696f 6e27 2c20 2775 6e69 6f6e  section', 'union
+0001a1d0: 272c 0a20 2020 2020 2020 2020 2020 2027  ',.            '
+0001a1e0: 6964 656e 7469 7479 272c 2027 7379 6d6d  identity', 'symm
+0001a1f0: 6574 7269 635f 6469 6666 6572 656e 6365  etric_difference
+0001a200: 2720 6f72 2027 6469 6666 6572 656e 6365  ' or 'difference
+0001a210: 272e 0a20 2020 2020 2020 2072 6570 726f  '..        repro
+0001a220: 6a65 743a 2062 6f6f 6c65 616e 2c20 746f  jet: boolean, to
+0001a230: 2072 6570 726f 6a65 6374 206f 6e65 2073   reproject one s
+0001a240: 6861 7065 6669 6c65 2074 6f20 616e 6f74  hapefile to anot
+0001a250: 6865 7220 6372 730a 2020 2020 2020 2020  her crs.        
+0001a260: 2020 2020 2020 2020 2020 666f 7220 7370            for sp
+0001a270: 6174 6961 6c20 6f70 6572 6174 696f 6e0a  atial operation.
+0001a280: 2020 2020 2020 2020 5265 7475 726e 730a          Returns.
+0001a290: 2020 2020 2020 2020 2d2d 2d2d 2d2d 2d0a          -------.
+0001a2a0: 2020 2020 2020 2020 6466 3a20 4765 6f44          df: GeoD
+0001a2b0: 6174 6146 7261 6d65 0a20 2020 2020 2020  ataFrame.       
+0001a2c0: 2020 2020 2047 656f 4461 7461 4672 616d       GeoDataFram
+0001a2d0: 6520 7769 7468 2061 206e 6577 2073 6574  e with a new set
+0001a2e0: 206f 6620 706f 6c79 676f 6e73 2061 6e64   of polygons and
+0001a2f0: 2061 7474 7269 6275 7465 730a 2020 2020   attributes.    
+0001a300: 2020 2020 2020 2020 7265 7375 6c74 696e          resultin
+0001a310: 6720 6672 6f6d 2074 6865 206f 7665 726c  g from the overl
+0001a320: 6179 0a20 2020 2020 2020 2022 2222 0a20  ay.        """. 
+0001a330: 2020 2020 2020 2064 6631 203d 2064 6631         df1 = df1
+0001a340: 2e63 6f70 7928 290a 2020 2020 2020 2020  .copy().        
+0001a350: 6466 3220 3d20 6466 322e 636f 7079 2829  df2 = df2.copy()
+0001a360: 0a20 2020 2020 2020 2064 6631 5b27 6765  .        df1['ge
+0001a370: 6f6d 6574 7279 275d 203d 2064 6631 2e67  ometry'] = df1.g
+0001a380: 656f 6d65 7472 792e 6275 6666 6572 2830  eometry.buffer(0
+0001a390: 290a 2020 2020 2020 2020 6466 325b 2767  ).        df2['g
+0001a3a0: 656f 6d65 7472 7927 5d20 3d20 6466 322e  eometry'] = df2.
+0001a3b0: 6765 6f6d 6574 7279 2e62 7566 6665 7228  geometry.buffer(
+0001a3c0: 3029 0a20 2020 2020 2020 2069 6620 6466  0).        if df
+0001a3d0: 312e 6372 7321 3d64 6632 2e63 7273 2061  1.crs!=df2.crs a
+0001a3e0: 6e64 2072 6570 726f 6a65 6374 3a0a 2020  nd reproject:.  
+0001a3f0: 2020 2020 2020 2020 2020 7072 696e 7428            print(
+0001a400: 2744 6174 6120 6861 7320 6469 6666 6572  'Data has differ
+0001a410: 656e 7420 7072 6f6a 6563 7469 6f6e 732e  ent projections.
+0001a420: 2729 0a20 2020 2020 2020 2020 2020 2070  ').            p
+0001a430: 7269 6e74 2827 436f 6e76 6572 7465 6420  rint('Converted 
+0001a440: 6461 7461 2074 6f20 7072 6f6a 6563 7469  data to projecti
+0001a450: 6f6e 206f 6620 6669 7273 7420 4765 6f50  on of first GeoP
+0001a460: 616e 6461 7320 4461 7446 7261 6d65 2729  andas DatFrame')
+0001a470: 0a20 2020 2020 2020 2020 2020 2064 6632  .            df2
+0001a480: 2e74 6f5f 6372 7328 6372 733d 6466 312e  .to_crs(crs=df1.
+0001a490: 6372 732c 2069 6e70 6c61 6365 3d54 7275  crs, inplace=Tru
+0001a4a0: 6529 0a20 2020 2020 2020 2069 6620 686f  e).        if ho
+0001a4b0: 773d 3d27 696e 7465 7273 6563 7469 6f6e  w=='intersection
+0001a4c0: 273a 0a20 2020 2020 2020 2020 2020 2023  ':.            #
+0001a4d0: 2053 7061 7469 616c 2049 6e64 6578 2074   Spatial Index t
+0001a4e0: 6f20 6372 6561 7465 2069 6e74 6572 7365  o create interse
+0001a4f0: 6374 696f 6e73 0a20 2020 2020 2020 2020  ctions.         
+0001a500: 2020 2073 7061 7469 616c 5f69 6e64 6578     spatial_index
+0001a510: 203d 2064 6632 2e73 696e 6465 780a 2020   = df2.sindex.  
+0001a520: 2020 2020 2020 2020 2020 6466 315b 2762            df1['b
+0001a530: 626f 7827 5d20 3d20 6466 312e 6765 6f6d  box'] = df1.geom
+0001a540: 6574 7279 2e61 7070 6c79 286c 616d 6264  etry.apply(lambd
+0001a550: 6120 783a 2078 2e62 6f75 6e64 7329 0a20  a x: x.bounds). 
+0001a560: 2020 2020 2020 2020 2020 2064 6631 5b27             df1['
+0001a570: 7369 6478 275d 3d64 6631 2e62 626f 782e  sidx']=df1.bbox.
+0001a580: 6170 706c 7928 6c61 6d62 6461 2078 3a6c  apply(lambda x:l
+0001a590: 6973 7428 7370 6174 6961 6c5f 696e 6465  ist(spatial_inde
+0001a5a0: 782e 696e 7465 7273 6563 7469 6f6e 2878  x.intersection(x
+0001a5b0: 2929 290a 2020 2020 2020 2020 2020 2020  ))).            
+0001a5c0: 7061 6972 7320 3d20 6466 315b 2773 6964  pairs = df1['sid
+0001a5d0: 7827 5d2e 746f 5f64 6963 7428 290a 2020  x'].to_dict().  
+0001a5e0: 2020 2020 2020 2020 2020 6e65 6920 3d20            nei = 
+0001a5f0: 5b5d 0a20 2020 2020 2020 2020 2020 2066  [].            f
+0001a600: 6f72 2069 2c6a 2069 6e20 7061 6972 732e  or i,j in pairs.
+0001a610: 6974 656d 7328 293a 0a20 2020 2020 2020  items():.       
+0001a620: 2020 2020 2020 2020 2066 6f72 206b 2069           for k i
+0001a630: 6e20 6a3a 0a20 2020 2020 2020 2020 2020  n j:.           
+0001a640: 2020 2020 2020 2020 206e 6569 2e61 7070           nei.app
+0001a650: 656e 6428 5b69 2c6b 5d29 0a20 2020 2020  end([i,k]).     
+0001a660: 2020 2020 2020 2023 7061 6972 7320 3d20         #pairs = 
+0001a670: 6770 642e 4765 6f44 6174 6146 7261 6d65  gpd.GeoDataFrame
+0001a680: 286e 6569 2c20 636f 6c75 6d6e 733d 5b27  (nei, columns=['
+0001a690: 6964 7831 272c 2769 6478 3227 5d2c 2063  idx1','idx2'], c
+0001a6a0: 7273 3d64 6631 2e63 7273 290a 2020 2020  rs=df1.crs).    
+0001a6b0: 2020 2020 2020 2020 2370 6169 7273 203d          #pairs =
+0001a6c0: 2067 7064 2e47 656f 4461 7461 4672 616d   gpd.GeoDataFram
+0001a6d0: 6528 6e65 692c 2063 6f6c 756d 6e73 3d5b  e(nei, columns=[
+0001a6e0: 2769 6478 3127 2c27 6964 7832 275d 290a  'idx1','idx2']).
+0001a6f0: 2020 2020 2020 2020 2020 2020 7061 6972              pair
+0001a700: 7320 3d20 7064 2e44 6174 6146 7261 6d65  s = pd.DataFrame
+0001a710: 286e 6569 2c20 636f 6c75 6d6e 733d 5b27  (nei, columns=['
+0001a720: 6964 7831 272c 2769 6478 3227 5d29 2023  idx1','idx2']) #
+0001a730: 2072 6570 6c61 6365 2069 6e73 7465 6164   replace instead
+0001a740: 206f 6620 696e 6974 6961 6c69 7a69 6e67   of initializing
+0001a750: 2074 6865 2047 656f 4461 7461 4672 616d   the GeoDataFram
+0001a760: 650a 2020 2020 2020 2020 2020 2020 7061  e.            pa
+0001a770: 6972 7320 3d20 7061 6972 732e 6d65 7267  irs = pairs.merg
+0001a780: 6528 6466 312c 206c 6566 745f 6f6e 3d27  e(df1, left_on='
+0001a790: 6964 7831 272c 2072 6967 6874 5f69 6e64  idx1', right_ind
+0001a7a0: 6578 3d54 7275 6529 0a20 2020 2020 2020  ex=True).       
+0001a7b0: 2020 2020 2070 6169 7273 203d 2070 6169       pairs = pai
+0001a7c0: 7273 2e6d 6572 6765 2864 6632 2c20 6c65  rs.merge(df2, le
+0001a7d0: 6674 5f6f 6e3d 2769 6478 3227 2c20 7269  ft_on='idx2', ri
+0001a7e0: 6768 745f 696e 6465 783d 5472 7565 2c20  ght_index=True, 
+0001a7f0: 7375 6666 6978 6573 3d5b 275f 3127 2c27  suffixes=['_1','
+0001a800: 5f32 275d 290a 2020 2020 2020 2020 2020  _2']).          
+0001a810: 2020 7061 6972 735b 2749 6e74 6572 7365    pairs['Interse
+0001a820: 6374 696f 6e27 5d20 3d20 7061 6972 732e  ction'] = pairs.
+0001a830: 6170 706c 7928 6c61 6d62 6461 2078 3a20  apply(lambda x: 
+0001a840: 2878 5b27 6765 6f6d 6574 7279 5f31 275d  (x['geometry_1']
+0001a850: 2e69 6e74 6572 7365 6374 696f 6e28 785b  .intersection(x[
+0001a860: 2767 656f 6d65 7472 795f 3227 5d29 292e  'geometry_2'])).
+0001a870: 6275 6666 6572 2830 292c 2061 7869 733d  buffer(0), axis=
+0001a880: 3129 0a20 2020 2020 2020 2020 2020 2023  1).            #
+0001a890: 7061 6972 7320 3d20 6770 642e 4765 6f44  pairs = gpd.GeoD
+0001a8a0: 6174 6146 7261 6d65 2870 6169 7273 2c20  ataFrame(pairs, 
+0001a8b0: 636f 6c75 6d6e 733d 7061 6972 732e 636f  columns=pairs.co
+0001a8c0: 6c75 6d6e 732c 2063 7273 3d64 6631 2e63  lumns, crs=df1.c
+0001a8d0: 7273 290a 2020 2020 2020 2020 2020 2020  rs).            
+0001a8e0: 7061 6972 7320 3d20 6770 642e 4765 6f44  pairs = gpd.GeoD
+0001a8f0: 6174 6146 7261 6d65 2870 6169 7273 2c20  ataFrame(pairs, 
+0001a900: 636f 6c75 6d6e 733d 7061 6972 732e 636f  columns=pairs.co
+0001a910: 6c75 6d6e 7329 0a20 2020 2020 2020 2020  lumns).         
+0001a920: 2020 2063 6f6c 7320 3d20 7061 6972 732e     cols = pairs.
+0001a930: 636f 6c75 6d6e 732e 746f 6c69 7374 2829  columns.tolist()
+0001a940: 0a20 2020 2020 2020 2020 2020 2063 6f6c  .            col
+0001a950: 732e 7265 6d6f 7665 2827 6765 6f6d 6574  s.remove('geomet
+0001a960: 7279 5f31 2729 0a20 2020 2020 2020 2020  ry_1').         
+0001a970: 2020 2063 6f6c 732e 7265 6d6f 7665 2827     cols.remove('
+0001a980: 6765 6f6d 6574 7279 5f32 2729 0a20 2020  geometry_2').   
+0001a990: 2020 2020 2020 2020 2063 6f6c 732e 7265           cols.re
+0001a9a0: 6d6f 7665 2827 7369 6478 2729 0a20 2020  move('sidx').   
+0001a9b0: 2020 2020 2020 2020 2063 6f6c 732e 7265           cols.re
+0001a9c0: 6d6f 7665 2827 6262 6f78 2729 0a20 2020  move('bbox').   
+0001a9d0: 2020 2020 2020 2020 2063 6f6c 732e 7265           cols.re
+0001a9e0: 6d6f 7665 2827 496e 7465 7273 6563 7469  move('Intersecti
+0001a9f0: 6f6e 2729 0a20 2020 2020 2020 2020 2020  on').           
+0001aa00: 2064 6669 6e74 6572 203d 2070 6169 7273   dfinter = pairs
+0001aa10: 5b63 6f6c 732b 5b27 496e 7465 7273 6563  [cols+['Intersec
+0001aa20: 7469 6f6e 275d 5d2e 636f 7079 2829 0a20  tion']].copy(). 
+0001aa30: 2020 2020 2020 2020 2020 2064 6669 6e74             dfint
+0001aa40: 6572 2e72 656e 616d 6528 636f 6c75 6d6e  er.rename(column
+0001aa50: 733d 7b27 496e 7465 7273 6563 7469 6f6e  s={'Intersection
+0001aa60: 273a 2767 656f 6d65 7472 7927 7d2c 2069  ':'geometry'}, i
+0001aa70: 6e70 6c61 6365 3d54 7275 6529 0a20 2020  nplace=True).   
+0001aa80: 2020 2020 2020 2020 2023 6466 696e 7465           #dfinte
+0001aa90: 7220 3d20 6770 642e 4765 6f44 6174 6146  r = gpd.GeoDataF
+0001aaa0: 7261 6d65 2864 6669 6e74 6572 2c20 636f  rame(dfinter, co
+0001aab0: 6c75 6d6e 733d 6466 696e 7465 722e 636f  lumns=dfinter.co
+0001aac0: 6c75 6d6e 732c 2063 7273 3d70 6169 7273  lumns, crs=pairs
+0001aad0: 2e63 7273 290a 2020 2020 2020 2020 2020  .crs).          
+0001aae0: 2020 6466 696e 7465 7220 3d20 6770 642e    dfinter = gpd.
+0001aaf0: 4765 6f44 6174 6146 7261 6d65 2864 6669  GeoDataFrame(dfi
+0001ab00: 6e74 6572 2c20 636f 6c75 6d6e 733d 6466  nter, columns=df
+0001ab10: 696e 7465 722e 636f 6c75 6d6e 732c 2063  inter.columns, c
+0001ab20: 7273 3d64 6631 2e63 7273 290a 2020 2020  rs=df1.crs).    
+0001ab30: 2020 2020 2020 2020 6466 696e 7465 7220          dfinter 
+0001ab40: 3d20 6466 696e 7465 722e 6c6f 635b 6466  = dfinter.loc[df
+0001ab50: 696e 7465 722e 6765 6f6d 6574 7279 2e69  inter.geometry.i
+0001ab60: 735f 656d 7074 793d 3d46 616c 7365 5d0a  s_empty==False].
+0001ab70: 2020 2020 2020 2020 2020 2020 6466 696e              dfin
+0001ab80: 7465 722e 6472 6f70 285b 2769 6478 3127  ter.drop(['idx1'
+0001ab90: 2c27 6964 7832 275d 2c20 696e 706c 6163  ,'idx2'], inplac
+0001aba0: 653d 5472 7565 2c20 6178 6973 3d31 290a  e=True, axis=1).
+0001abb0: 2020 2020 2020 2020 2020 2020 7265 7475              retu
+0001abc0: 726e 2064 6669 6e74 6572 0a20 2020 2020  rn dfinter.     
+0001abd0: 2020 2065 6c69 6620 686f 773d 3d27 6469     elif how=='di
+0001abe0: 6666 6572 656e 6365 273a 0a20 2020 2020  fference':.     
+0001abf0: 2020 2020 2020 2073 7061 7469 616c 5f69         spatial_i
+0001ac00: 6e64 6578 203d 2064 6632 2e73 696e 6465  ndex = df2.sinde
+0001ac10: 780a 2020 2020 2020 2020 2020 2020 6466  x.            df
+0001ac20: 315b 2762 626f 7827 5d20 3d20 6466 312e  1['bbox'] = df1.
+0001ac30: 6765 6f6d 6574 7279 2e61 7070 6c79 286c  geometry.apply(l
+0001ac40: 616d 6264 6120 783a 2078 2e62 6f75 6e64  ambda x: x.bound
+0001ac50: 7329 0a20 2020 2020 2020 2020 2020 2064  s).            d
+0001ac60: 6631 5b27 7369 6478 275d 203d 2064 6631  f1['sidx'] = df1
+0001ac70: 2e62 626f 782e 6170 706c 7928 6c61 6d62  .bbox.apply(lamb
+0001ac80: 6461 2078 3a6c 6973 7428 7370 6174 6961  da x:list(spatia
+0001ac90: 6c5f 696e 6465 782e 696e 7465 7273 6563  l_index.intersec
+0001aca0: 7469 6f6e 2878 2929 290a 2020 2020 2020  tion(x))).      
+0001acb0: 2020 2020 2020 6466 315b 276e 6577 5f67        df1['new_g
+0001acc0: 275d 203d 2064 6631 2e61 7070 6c79 286c  '] = df1.apply(l
+0001acd0: 616d 6264 6120 783a 2072 6564 7563 6528  ambda x: reduce(
+0001ace0: 6c61 6d62 6461 2078 2c20 793a 2078 2e64  lambda x, y: x.d
+0001acf0: 6966 6665 7265 6e63 6528 7929 2e62 7566  ifference(y).buf
+0001ad00: 6665 7228 3029 2c0a 2020 2020 2020 2020  fer(0),.        
 0001ad10: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001ad20: 2020 2020 2020 6c61 745f 696e 2c0a 2020        lat_in,.  
-0001ad30: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001ad40: 2020 2020 2020 2020 2020 2020 7261 7374              rast
-0001ad50: 6572 5f70 6174 685f 696e 293a 0a20 2020  er_path_in):.   
-0001ad60: 2020 2020 2022 2222 0a20 2020 2020 2020       """.       
-0001ad70: 206f 7269 6769 6e61 6c20 636f 6465 2062   original code b
-0001ad80: 793a 0a20 2020 2020 2020 2043 6861 726c  y:.        Charl
-0001ad90: 6965 2050 6172 723b 0a20 2020 2020 2020  ie Parr;.       
-0001ada0: 2068 7474 7073 3a2f 2f67 6973 2e73 7461   https://gis.sta
-0001adb0: 636b 6578 6368 616e 6765 2e63 6f6d 2f71  ckexchange.com/q
-0001adc0: 7565 7374 696f 6e73 2f33 3137 3339 312f  uestions/317391/
-0001add0: 7079 7468 6f6e 2d65 7874 7261 6374 2d72  python-extract-r
-0001ade0: 6173 7465 722d 7661 6c75 6573 2d61 742d  aster-values-at-
-0001adf0: 706f 696e 742d 6c6f 6361 7469 6f6e 732f  point-locations/
-0001ae00: 3332 3438 3330 0a20 2020 2020 2020 206d  324830.        m
-0001ae10: 6f64 6966 6965 6420 6279 3a0a 2020 2020  odified by:.    
-0001ae20: 2020 2020 4020 6175 7468 6f72 3a20 2020      @ author:   
-0001ae30: 2020 2020 2020 2020 2020 2020 2020 2053                 S
-0001ae40: 6865 7276 616e 2047 6861 7261 7269 0a20  hervan Gharari. 
-0001ae50: 2020 2020 2020 2040 2047 6974 6875 623a         @ Github:
-0001ae60: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001ae70: 2020 6874 7470 733a 2f2f 6769 7468 7562    https://github
-0001ae80: 2e63 6f6d 2f53 6865 7276 616e 4768 6172  .com/ShervanGhar
-0001ae90: 6172 692f 4541 5359 4d4f 5245 0a20 2020  ari/EASYMORE.   
-0001aea0: 2020 2020 2040 2061 7574 686f 7227 7320       @ author's 
-0001aeb0: 656d 6169 6c20 6964 3a20 2020 2020 2020  email id:       
-0001aec0: 7368 2e67 6861 7261 7269 4067 6d61 696c  sh.gharari@gmail
-0001aed0: 2e63 6f6d 0a20 2020 2020 2020 2040 206c  .com.        @ l
-0001aee0: 6963 656e 7365 3a20 2020 2020 2020 2020  icense:         
-0001aef0: 2020 2020 2020 2020 474e 552d 4750 4c76          GNU-GPLv
-0001af00: 330a 2020 2020 2020 2020 5468 6973 2066  3.        This f
-0001af10: 756e 6374 696f 6e20 7265 6164 7320 6120  unction reads a 
-0001af20: 7261 7374 6572 2066 696c 6520 696e 2067  raster file in g
-0001af30: 656f 7469 6666 2061 6e64 2072 6574 7572  eotiff and retur
-0001af40: 6e20 7665 6374 6f72 2076 616c 7565 7320  n vector values 
-0001af50: 7265 6665 7269 6e67 2074 6f20 6365 6c6c  refering to cell
-0001af60: 7320 6f66 2074 6861 7420 7261 7374 6572  s of that raster
-0001af70: 0a20 2020 2020 2020 2067 6976 656e 2074  .        given t
-0001af80: 6865 6e20 6c61 7420 616e 6420 6c6f 6e20  hen lat and lon 
-0001af90: 7661 6c75 6573 0a20 2020 2020 2020 2041  values.        A
-0001afa0: 7267 756d 656e 7473 0a20 2020 2020 2020  rguments.       
-0001afb0: 202d 2d2d 2d2d 2d2d 2d2d 0a20 2020 2020   ---------.     
-0001afc0: 2020 206c 6f6e 5f69 6e3a 206e 702e 6172     lon_in: np.ar
-0001afd0: 7261 793b 206c 6f6e 6769 7475 6465 206f  ray; longitude o
-0001afe0: 6620 7468 6520 706f 696e 7473 2074 6f20  f the points to 
-0001aff0: 6265 2065 7874 7261 7874 6564 2028 696e  be extraxted (in
-0001b000: 2067 656f 7469 6666 2070 726f 6a65 6374   geotiff project
-0001b010: 696f 6e29 0a20 2020 2020 2020 206c 6174  ion).        lat
-0001b020: 5f69 6e3a 206e 702e 6172 7261 793b 206c  _in: np.array; l
-0001b030: 6174 6974 7564 6520 6f66 2074 6865 2070  atitude of the p
-0001b040: 6f69 6e74 7320 746f 2062 6520 6578 7472  oints to be extr
-0001b050: 6178 7465 6420 2869 6e20 6765 6f74 6966  axted (in geotif
-0001b060: 6620 7072 6f6a 6563 7469 6f6e 290a 2020  f projection).  
-0001b070: 2020 2020 2020 7261 7374 6572 5f70 6174        raster_pat
-0001b080: 685f 696e 3a20 7374 7269 6e67 3b20 7468  h_in: string; th
-0001b090: 6520 7061 7468 2074 6f20 7468 6520 696e  e path to the in
-0001b0a0: 7075 7420 7261 7374 6572 0a20 2020 2020  put raster.     
-0001b0b0: 2020 2022 2222 0a20 2020 2020 2020 2069     """.        i
-0001b0c0: 6d70 6f72 7420 7261 7374 6572 696f 0a20  mport rasterio. 
-0001b0d0: 2020 2020 2020 2069 6d70 6f72 7420 6765         import ge
-0001b0e0: 6f70 616e 6461 7320 6173 2067 7064 0a20  opandas as gpd. 
-0001b0f0: 2020 2020 2020 2069 6d70 6f72 7420 6e75         import nu
-0001b100: 6d70 7920 6173 206e 700a 2020 2020 2020  mpy as np.      
-0001b110: 2020 2320 496e 6974 6961 6c69 7a65 2063    # Initialize c
-0001b120: 6f6f 7264 730a 2020 2020 2020 2020 636f  oords.        co
-0001b130: 6f72 6473 203d 206e 702e 7a65 726f 7328  ords = np.zeros(
-0001b140: 5b6c 656e 286c 6f6e 5f69 6e29 2c32 5d29  [len(lon_in),2])
-0001b150: 0a20 2020 2020 2020 2063 6f6f 7264 735b  .        coords[
-0001b160: 3a2c 305d 203d 206c 6f6e 5f69 6e0a 2020  :,0] = lon_in.  
-0001b170: 2020 2020 2020 636f 6f72 6473 5b3a 2c31        coords[:,1
-0001b180: 5d20 3d20 6c61 745f 696e 0a20 2020 2020  ] = lat_in.     
-0001b190: 2020 2023 204f 7065 6e20 7468 6520 7261     # Open the ra
-0001b1a0: 7374 6572 2061 6e64 2073 746f 7265 206d  ster and store m
-0001b1b0: 6574 6164 6174 610a 2020 2020 2020 2020  etadata.        
-0001b1c0: 7372 6320 3d20 7261 7374 6572 696f 2e6f  src = rasterio.o
-0001b1d0: 7065 6e28 7261 7374 6572 5f70 6174 685f  pen(raster_path_
-0001b1e0: 696e 290a 2020 2020 2020 2020 2320 5361  in).        # Sa
-0001b1f0: 6d70 6c65 2074 6865 2072 6173 7465 7220  mple the raster 
-0001b200: 6174 2065 7665 7279 2070 6f69 6e74 206c  at every point l
-0001b210: 6f63 6174 696f 6e20 616e 6420 7374 6f72  ocation and stor
-0001b220: 6520 7661 6c75 6573 2069 6e20 4461 7461  e values in Data
-0001b230: 4672 616d 650a 2020 2020 2020 2020 7661  Frame.        va
-0001b240: 6c75 6573 203d 205b 7820 666f 7220 7820  lues = [x for x 
-0001b250: 696e 2073 7263 2e73 616d 706c 6528 636f  in src.sample(co
-0001b260: 6f72 6473 295d 0a20 2020 2020 2020 2072  ords)].        r
-0001b270: 6574 7572 6e20 6e70 2e61 7272 6179 2876  eturn np.array(v
-0001b280: 616c 7565 7329 0a0a 2020 2020 6465 6620  alues)..    def 
-0001b290: 766f 726f 6e6f 695f 6469 6167 7261 6d28  voronoi_diagram(
-0001b2a0: 7365 6c66 2c0a 2020 2020 2020 2020 2020  self,.          
-0001b2b0: 2020 2020 2020 2020 2020 2020 2020 706f                po
-0001b2c0: 696e 7473 5f73 6870 5f69 6e2c 0a20 2020  ints_shp_in,.   
-0001b2d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001b2e0: 2020 2020 2076 6f72 6f6e 6f69 5f73 6870       voronoi_shp
-0001b2f0: 5f6f 7574 2c0a 2020 2020 2020 2020 2020  _out,.          
-0001b300: 2020 2020 2020 2020 2020 2020 2020 6275                bu
-0001b310: 6666 6572 203d 2032 293a 0a20 2020 2020  ffer = 2):.     
-0001b320: 2020 2022 2222 0a20 2020 2020 2020 206f     """.        o
-0001b330: 7269 6769 6e61 6c20 636f 6465 2062 793a  riginal code by:
-0001b340: 0a20 2020 2020 2020 2041 6264 6973 6861  .        Abdisha
-0001b350: 6b75 720a 2020 2020 2020 2020 6874 7470  kur.        http
-0001b360: 733a 2f2f 746f 7761 7264 7364 6174 6173  s://towardsdatas
-0001b370: 6369 656e 6365 2e63 6f6d 2f68 6f77 2d74  cience.com/how-t
-0001b380: 6f2d 6372 6561 7465 2d76 6f72 6f6e 6f69  o-create-voronoi
-0001b390: 2d72 6567 696f 6e73 2d77 6974 682d 6765  -regions-with-ge
-0001b3a0: 6f73 7061 7469 616c 2d64 6174 612d 696e  ospatial-data-in
-0001b3b0: 2d70 7974 686f 6e2d 6164 6262 3663 3566  -python-adbb6c5f
-0001b3c0: 3231 3334 0a20 2020 2020 2020 206d 6f64  2134.        mod
-0001b3d0: 6966 6965 6420 6279 3a0a 2020 2020 2020  ified by:.      
-0001b3e0: 2020 4020 6175 7468 6f72 3a20 2020 2020    @ author:     
-0001b3f0: 2020 2020 2020 2020 2020 2020 2053 6865               She
-0001b400: 7276 616e 2047 6861 7261 7269 0a20 2020  rvan Gharari.   
-0001b410: 2020 2020 2040 2047 6974 6875 623a 2020       @ Github:  
-0001b420: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001b430: 6874 7470 733a 2f2f 6769 7468 7562 2e63  https://github.c
-0001b440: 6f6d 2f53 6865 7276 616e 4768 6172 6172  om/ShervanGharar
-0001b450: 692f 4541 5359 4d4f 5245 0a20 2020 2020  i/EASYMORE.     
-0001b460: 2020 2040 2061 7574 686f 7227 7320 656d     @ author's em
-0001b470: 6169 6c20 6964 3a20 2020 2020 2020 7368  ail id:       sh
-0001b480: 2e67 6861 7261 7269 4067 6d61 696c 2e63  .gharari@gmail.c
-0001b490: 6f6d 0a20 2020 2020 2020 2040 206c 6963  om.        @ lic
-0001b4a0: 656e 7365 3a20 2020 2020 2020 2020 2020  ense:           
-0001b4b0: 2020 2020 2020 474e 552d 4750 4c76 330a        GNU-GPLv3.
-0001b4c0: 2020 2020 2020 2020 5468 6973 2066 756e          This fun
-0001b4d0: 6374 696f 6e20 7265 6164 7320 6120 7368  ction reads a sh
-0001b4e0: 6170 6566 696c 6520 6f66 2070 6f69 6e74  apefile of point
-0001b4f0: 7320 616e 6420 7265 7475 726e 2074 6865  s and return the
-0001b500: 2054 6869 6573 7365 6e20 6f72 2056 6f72   Thiessen or Vor
-0001b510: 6f6e 6f69 2070 6f6c 7967 6f6e 730a 2020  onoi polygons.  
-0001b520: 2020 2020 2020 2d2d 2d2d 2d2d 2d2d 2d0a        ---------.
-0001b530: 2020 2020 2020 2020 706f 696e 7473 5f73          points_s
-0001b540: 6870 5f69 6e3a 2067 656f 7061 6e64 6173  hp_in: geopandas
-0001b550: 206f 7220 7374 7269 6e67 3b20 6966 2073   or string; if s
-0001b560: 7472 696e 6720 6974 2077 696c 6c20 7265  tring it will re
-0001b570: 6164 2074 6865 2066 696c 650a 2020 2020  ad the file.    
-0001b580: 2020 2020 766f 726f 6e6f 695f 7368 705f      voronoi_shp_
-0001b590: 6f75 743a 2073 7472 696e 673b 2074 6865  out: string; the
-0001b5a0: 2070 6174 6820 746f 2073 6176 6520 7468   path to save th
-0001b5b0: 6520 6f75 7470 7574 2056 6f72 6f6e 6f69  e output Voronoi
-0001b5c0: 2073 6861 7065 6669 6c65 0a20 2020 2020   shapefile.     
-0001b5d0: 2020 2062 7566 6665 723a 2066 6c6f 6174     buffer: float
-0001b5e0: 3b20 7468 6520 6275 6666 6572 2061 726f  ; the buffer aro
-0001b5f0: 756e 6420 7468 6520 706f 696e 7473 5f73  und the points_s
-0001b600: 6870 5f69 6e20 746f 2063 7265 6174 6520  hp_in to create 
-0001b610: 566f 726f 6e6f 6920 7368 6170 6566 696c  Voronoi shapefil
-0001b620: 650a 2020 2020 2020 2020 2222 220a 2020  e.        """.  
-0001b630: 2020 2020 2020 696d 706f 7274 2073 6861        import sha
-0001b640: 7065 6669 6c65 2023 2061 7320 7061 7274  pefile # as part
-0001b650: 206f 6620 7079 7368 700a 2020 2020 2020   of pyshp.      
-0001b660: 2020 696d 706f 7274 2067 656f 766f 726f    import geovoro
-0001b670: 6e6f 690a 2020 2020 2020 2020 696d 706f  noi.        impo
-0001b680: 7274 206f 730a 2020 2020 2020 2020 6672  rt os.        fr
-0001b690: 6f6d 2020 2073 6861 7065 6c79 2e67 656f  om   shapely.geo
-0001b6a0: 6d65 7472 7920 696d 706f 7274 2050 6f6c  metry import Pol
-0001b6b0: 7967 6f6e 0a20 2020 2020 2020 2069 6d70  ygon.        imp
-0001b6c0: 6f72 7420 6e75 6d70 7920 6173 206e 700a  ort numpy as np.
-0001b6d0: 2020 2020 2020 2020 696d 706f 7274 2070          import p
-0001b6e0: 616e 6461 7320 6173 2070 640a 2020 2020  andas as pd.    
-0001b6f0: 2020 2020 696d 706f 7274 2067 656f 7061      import geopa
-0001b700: 6e64 6173 2061 7320 6770 640a 2020 2020  ndas as gpd.    
-0001b710: 2020 2020 2320 7265 6164 2074 6865 2073      # read the s
-0001b720: 6861 7065 6669 6c65 0a20 2020 2020 2020  hapefile.       
-0001b730: 2069 6620 6973 696e 7374 616e 6365 2870   if isinstance(p
-0001b740: 6f69 6e74 735f 7368 705f 696e 2c20 7374  oints_shp_in, st
-0001b750: 7229 3a0a 2020 2020 2020 2020 2020 2020  r):.            
-0001b760: 7374 6174 696f 6e73 203d 2067 7064 2e72  stations = gpd.r
-0001b770: 6561 645f 6669 6c65 2870 6f69 6e74 735f  ead_file(points_
-0001b780: 7368 705f 696e 290a 2020 2020 2020 2020  shp_in).        
-0001b790: 656c 7365 3a0a 2020 2020 2020 2020 2020  else:.          
-0001b7a0: 2020 7374 6174 696f 6e73 203d 2070 6f69    stations = poi
-0001b7b0: 6e74 735f 7368 705f 696e 2023 2067 656f  nts_shp_in # geo
-0001b7c0: 6461 7461 6672 616d 650a 2020 2020 2020  dataframe.      
-0001b7d0: 2020 2320 6765 7420 7468 6520 6372 7320    # get the crs 
-0001b7e0: 6672 6f6d 2074 6865 2070 6f69 6e74 2073  from the point s
-0001b7f0: 6861 7065 6669 6c65 0a20 2020 2020 2020  hapefile.       
-0001b800: 2063 7273 5f6f 7267 203d 2073 7461 7469   crs_org = stati
-0001b810: 6f6e 732e 6372 730a 2020 2020 2020 2020  ons.crs.        
-0001b820: 7072 696e 7428 6372 735f 6f72 6729 0a20  print(crs_org). 
-0001b830: 2020 2020 2020 2023 2061 6464 2074 6865         # add the
-0001b840: 2049 445f 7420 746f 2074 6865 2070 6f69   ID_t to the poi
-0001b850: 6e74 2073 6861 7065 6669 6c65 730a 2020  nt shapefiles.  
-0001b860: 2020 2020 2020 7374 6174 696f 6e73 205b        stations [
-0001b870: 2749 445f 7327 5d20 3d20 6e70 2e61 7261  'ID_s'] = np.ara
-0001b880: 6e67 6528 6c65 6e28 7374 6174 696f 6e73  nge(len(stations
-0001b890: 2929 2b31 0a20 2020 2020 2020 2073 7461  ))+1.        sta
-0001b8a0: 7469 6f6e 7320 5b27 4944 5f73 275d 203d  tions ['ID_s'] =
-0001b8b0: 2073 7461 7469 6f6e 7320 5b27 4944 5f73   stations ['ID_s
-0001b8c0: 275d 2e61 7374 7970 6528 666c 6f61 7429  '].astype(float)
-0001b8d0: 0a20 2020 2020 2020 2023 2067 6574 2074  .        # get t
-0001b8e0: 6865 2074 6f74 616c 2062 6f75 6e64 6172  he total boundar
-0001b8f0: 7920 6f66 2074 6865 2073 6861 7065 6669  y of the shapefi
-0001b900: 6c65 0a20 2020 2020 2020 2073 7461 7469  le.        stati
-0001b910: 6f6e 735f 6275 6666 6572 7420 3d20 7374  ons_buffert = st
-0001b920: 6174 696f 6e73 2e62 7566 6665 7228 6275  ations.buffer(bu
-0001b930: 6666 6572 2920 2320 6164 6420 6120 6275  ffer) # add a bu
-0001b940: 6666 6572 0a20 2020 2020 2020 206d 696e  ffer.        min
-0001b950: 782c 206d 696e 792c 206d 6178 782c 206d  x, miny, maxx, m
-0001b960: 6178 7920 3d20 7374 6174 696f 6e73 5f62  axy = stations_b
-0001b970: 7566 6665 7274 2e74 6f74 616c 5f62 6f75  uffert.total_bou
-0001b980: 6e64 730a 2020 2020 2020 2020 2320 6372  nds.        # cr
-0001b990: 6561 7465 2074 6865 2062 6f75 6e64 696e  eate the boundin
-0001b9a0: 6720 7368 6170 6566 696c 650a 2020 2020  g shapefile.    
-0001b9b0: 2020 2020 7061 7274 7320 3d20 5b5d 0a20      parts = []. 
-0001b9c0: 2020 2020 2020 2077 6974 6820 7368 6170         with shap
-0001b9d0: 6566 696c 652e 5772 6974 6572 2827 7465  efile.Writer('te
-0001b9e0: 7374 2e73 6870 2729 2061 7320 773a 0a20  st.shp') as w:. 
-0001b9f0: 2020 2020 2020 2020 2020 2077 2e61 7574             w.aut
-0001ba00: 6f42 616c 616e 6365 203d 2031 2023 2074  oBalance = 1 # t
-0001ba10: 7572 6e20 6f6e 2066 756e 6374 696f 6e20  urn on function 
-0001ba20: 7468 6174 206b 6565 7073 2066 696c 6520  that keeps file 
-0001ba30: 7374 6162 6c65 2069 6620 6e75 6d62 6572  stable if number
-0001ba40: 206f 6620 7368 6170 6573 2061 6e64 2072   of shapes and r
-0001ba50: 6563 6f72 6473 2064 6f6e 2774 206c 696e  ecords don't lin
-0001ba60: 6520 7570 0a20 2020 2020 2020 2020 2020  e up.           
-0001ba70: 2077 2e66 6965 6c64 2822 4944 5f62 6f75   w.field("ID_bou
-0001ba80: 6e64 696e 6722 2c27 4e27 2920 2320 6372  nding",'N') # cr
-0001ba90: 6561 7465 2028 4e29 756d 6572 6963 616c  eate (N)umerical
-0001baa0: 2061 7474 7269 6275 7465 2066 6965 6c64   attribute field
-0001bab0: 732c 2069 6e74 6567 6572 0a20 2020 2020  s, integer.     
-0001bac0: 2020 2020 2020 2023 2063 7265 6174 696e         # creatin
-0001bad0: 6720 7468 6520 706f 6c79 676f 6e20 6769  g the polygon gi
-0001bae0: 7665 6e20 7468 6520 6c61 7420 616e 6420  ven the lat and 
-0001baf0: 6c6f 6e0a 2020 2020 2020 2020 2020 2020  lon.            
-0001bb00: 7061 7274 732e 6170 7065 6e64 285b 2028  parts.append([ (
-0001bb10: 6d69 6e78 2c20 6d69 6e79 292c 5c0a 2020  minx, miny),\.  
-0001bb20: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001bb30: 2020 2020 2020 2020 2028 6d69 6e78 2c20           (minx, 
-0001bb40: 6d61 7879 292c 205c 0a20 2020 2020 2020  maxy), \.       
-0001bb50: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001bb60: 2020 2020 286d 6178 782c 206d 6178 7929      (maxx, maxy)
-0001bb70: 2c20 5c0a 2020 2020 2020 2020 2020 2020  , \.            
-0001bb80: 2020 2020 2020 2020 2020 2020 2020 2028                 (
-0001bb90: 6d61 7878 2c20 6d69 6e79 292c 205c 0a20  maxx, miny), \. 
-0001bba0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001bbb0: 2020 2020 2020 2020 2020 286d 696e 782c            (minx,
-0001bbc0: 206d 696e 7929 5d29 0a20 2020 2020 2020   miny)]).       
-0001bbd0: 2020 2020 2023 2073 746f 7265 2070 6f6c       # store pol
-0001bbe0: 7967 6f6e 0a20 2020 2020 2020 2020 2020  ygon.           
-0001bbf0: 2077 2e70 6f6c 7928 7061 7274 7329 0a20   w.poly(parts). 
-0001bc00: 2020 2020 2020 2020 2020 2023 2075 7064             # upd
-0001bc10: 6174 6520 7265 636f 7264 732f 6669 656c  ate records/fiel
-0001bc20: 6473 2066 6f72 2074 6865 2070 6f6c 7967  ds for the polyg
-0001bc30: 6f6e 0a20 2020 2020 2020 2020 2020 2077  on.            w
-0001bc40: 2e72 6563 6f72 6428 3129 0a20 2020 2020  .record(1).     
-0001bc50: 2020 2062 6f75 6e64 6172 7920 3d20 6770     boundary = gp
-0001bc60: 642e 7265 6164 5f66 696c 6528 2774 6573  d.read_file('tes
-0001bc70: 742e 7368 7027 290a 2020 2020 2020 2020  t.shp').        
-0001bc80: 6f73 2e72 656d 6f76 6528 2774 6573 742e  os.remove('test.
-0001bc90: 6462 6627 293b 6f73 2e72 656d 6f76 6528  dbf');os.remove(
-0001bca0: 2774 6573 742e 7368 7827 293b 6f73 2e72  'test.shx');os.r
-0001bcb0: 656d 6f76 6528 2774 6573 742e 7368 7027  emove('test.shp'
-0001bcc0: 290a 2020 2020 2020 2020 2320 6372 6561  ).        # crea
-0001bcd0: 7465 2074 6865 2076 6f72 6f6e 6920 6469  te the voroni di
-0001bce0: 6167 7261 6d20 666f 7220 6769 7665 6e20  agram for given 
-0001bcf0: 706f 696e 7420 7368 6170 6566 696c 650a  point shapefile.
-0001bd00: 2020 2020 2020 2020 636f 6f72 6473 203d          coords =
-0001bd10: 2067 656f 766f 726f 6e6f 692e 706f 696e   geovoronoi.poin
-0001bd20: 7473 5f74 6f5f 636f 6f72 6473 2873 7461  ts_to_coords(sta
-0001bd30: 7469 6f6e 732e 6765 6f6d 6574 7279 290a  tions.geometry).
-0001bd40: 2020 2020 2020 2020 706f 6c79 5f73 6861          poly_sha
-0001bd50: 7065 732c 206c 6f63 6174 696f 6e20 3d20  pes, location = 
-0001bd60: 5c0a 2020 2020 2020 2020 6765 6f76 6f72  \.        geovor
-0001bd70: 6f6e 6f69 2e76 6f72 6f6e 6f69 5f72 6567  onoi.voronoi_reg
-0001bd80: 696f 6e73 5f66 726f 6d5f 636f 6f72 6473  ions_from_coords
-0001bd90: 2863 6f6f 7264 732c 2062 6f75 6e64 6172  (coords, boundar
-0001bda0: 792e 696c 6f63 5b30 5d2e 6765 6f6d 6574  y.iloc[0].geomet
-0001bdb0: 7279 290a 2020 2020 2020 2020 2320 7061  ry).        # pa
-0001bdc0: 7373 2074 6520 706f 6c79 676f 6e73 2074  ss te polygons t
-0001bdd0: 6f20 7368 6170 6566 696c 650a 2020 2020  o shapefile.    
-0001bde0: 2020 2020 5468 6965 7373 656e 203d 2067      Thiessen = g
-0001bdf0: 7064 2e47 656f 4461 7461 4672 616d 6528  pd.GeoDataFrame(
-0001be00: 290a 2020 2020 2020 2020 5468 6965 7373  ).        Thiess
-0001be10: 656e 5b27 4944 275d 203d 204e 6f6e 650a  en['ID'] = None.
-0001be20: 2020 2020 2020 2020 666f 7220 6920 696e          for i in
-0001be30: 206e 702e 6172 616e 6765 286c 656e 2870   np.arange(len(p
-0001be40: 6f6c 795f 7368 6170 6573 2929 3a0a 2020  oly_shapes)):.  
-0001be50: 2020 2020 2020 2020 2020 5468 6965 7373            Thiess
-0001be60: 656e 2e6c 6f63 5b69 2c20 2767 656f 6d65  en.loc[i, 'geome
-0001be70: 7472 7927 5d20 3d20 506f 6c79 676f 6e28  try'] = Polygon(
-0001be80: 706f 6c79 5f73 6861 7065 735b 695d 290a  poly_shapes[i]).
-0001be90: 2020 2020 2020 2020 2020 2020 5468 6965              Thie
-0001bea0: 7373 656e 2e6c 6f63 5b69 2c20 2749 445f  ssen.loc[i, 'ID_
-0001beb0: 7327 5d20 2020 2020 3d20 7374 6174 696f  s']     = statio
-0001bec0: 6e73 2e69 6c6f 635b 6c6f 6361 7469 6f6e  ns.iloc[location
-0001bed0: 5b69 5d5b 305d 5d2e 4944 5f73 2e61 7374  [i][0]].ID_s.ast
-0001bee0: 7970 6528 666c 6f61 7429 0a20 2020 2020  ype(float).     
-0001bef0: 2020 2054 6869 6573 7365 6e20 3d20 5468     Thiessen = Th
-0001bf00: 6965 7373 656e 2e73 6f72 745f 7661 6c75  iessen.sort_valu
-0001bf10: 6573 2862 793d 2749 445f 7327 2923 2073  es(by='ID_s')# s
-0001bf20: 6f72 7420 6f6e 2076 616c 7565 730a 2020  ort on values.  
-0001bf30: 2020 2020 2020 7374 6174 696f 6e73 203d        stations =
-0001bf40: 2073 7461 7469 6f6e 732e 6472 6f70 2863   stations.drop(c
-0001bf50: 6f6c 756d 6e73 3d27 6765 6f6d 6574 7279  olumns='geometry
-0001bf60: 2729 0a20 2020 2020 2020 2054 6869 6573  ').        Thies
-0001bf70: 7365 6e20 3d20 7064 2e6d 6572 6765 5f61  sen = pd.merge_a
-0001bf80: 736f 6628 5468 6965 7373 656e 2c20 7374  sof(Thiessen, st
-0001bf90: 6174 696f 6e73 2c20 6f6e 3d27 4944 5f73  ations, on='ID_s
-0001bfa0: 2729 2023 2c20 6469 7265 6374 696f 6e3d  ') #, direction=
-0001bfb0: 276e 6561 7265 7374 2729 0a20 2020 2020  'nearest').     
-0001bfc0: 2020 2054 6869 6573 7365 6e20 3d20 5468     Thiessen = Th
-0001bfd0: 6965 7373 656e 2e73 6574 5f67 656f 6d65  iessen.set_geome
-0001bfe0: 7472 7928 2767 656f 6d65 7472 7927 2920  try('geometry') 
-0001bff0: 2362 7269 6e67 2062 6163 6b20 7468 6520  #bring back the 
-0001c000: 6765 6f6d 6574 7279 2066 696c 6564 3b20  geometry filed; 
-0001c010: 7064 2074 6f20 6770 640a 2020 2020 2020  pd to gpd.      
-0001c020: 2020 5468 6965 7373 656e 203d 2054 6869    Thiessen = Thi
-0001c030: 6573 7365 6e2e 7365 745f 6372 7328 6372  essen.set_crs(cr
-0001c040: 735f 6f72 6729 0a20 2020 2020 2020 2054  s_org).        T
-0001c050: 6869 6573 7365 6e2e 746f 5f66 696c 6528  hiessen.to_file(
-0001c060: 766f 726f 6e6f 695f 7368 705f 6f75 7429  voronoi_shp_out)
-0001c070: 0a0a 2020 2020 6465 6620 6765 745f 616c  ..    def get_al
-0001c080: 6c5f 646f 776e 7374 7265 616d 2028 7365  l_downstream (se
-0001c090: 6c66 2c0a 2020 2020 2020 2020 2020 2020  lf,.            
-0001c0a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001c0b0: 7365 675f 4944 732c 0a20 2020 2020 2020  seg_IDs,.       
-0001c0c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001c0d0: 2020 2020 2064 6f77 6e5f 4944 7329 3a0a       down_IDs):.
-0001c0e0: 2020 2020 2020 2020 2222 220a 2020 2020          """.    
-0001c0f0: 2020 2020 4020 6175 7468 6f72 3a20 2020      @ author:   
-0001c100: 2020 2020 2020 2020 2020 2020 2020 2053                 S
-0001c110: 6865 7276 616e 2047 6861 7261 7269 0a20  hervan Gharari. 
-0001c120: 2020 2020 2020 2040 2047 6974 6875 623a         @ Github:
-0001c130: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001c140: 2020 6874 7470 733a 2f2f 6769 7468 7562    https://github
-0001c150: 2e63 6f6d 2f53 6865 7276 616e 4768 6172  .com/ShervanGhar
-0001c160: 6172 692f 4541 5359 4d4f 5245 0a20 2020  ari/EASYMORE.   
-0001c170: 2020 2020 2040 2061 7574 686f 7227 7320       @ author's 
-0001c180: 656d 6169 6c20 6964 3a20 2020 2020 2020  email id:       
-0001c190: 7368 2e67 6861 7261 7269 4067 6d61 696c  sh.gharari@gmail
-0001c1a0: 2e63 6f6d 0a20 2020 2020 2020 2040 206c  .com.        @ l
-0001c1b0: 6963 656e 7365 3a20 2020 2020 2020 2020  icense:         
-0001c1c0: 2020 2020 2020 2020 474e 552d 4750 4c76          GNU-GPLv
-0001c1d0: 330a 2020 2020 2020 2020 5468 6973 2066  3.        This f
-0001c1e0: 756e 6374 696f 6e20 6765 7420 6120 312d  unction get a 1-
-0001c1f0: 4420 6172 7261 7920 6f66 206e 756d 7079  D array of numpy
-0001c200: 2061 7272 6179 7320 6f66 2072 6976 6572   arrays of river
-0001c210: 2072 6561 6368 2049 4420 616e 6420 6120   reach ID and a 
-0001c220: 7369 6d69 6c61 7220 312d 4420 6172 7261  similar 1-D arra
-0001c230: 790a 2020 2020 2020 2020 6f66 2064 6f77  y.        of dow
-0001c240: 6e73 7472 6561 6d20 7269 7665 7220 7265  nstream river re
-0001c250: 6163 6820 4944 0a20 2020 2020 2020 2041  ach ID.        A
-0001c260: 7267 756d 656e 7473 0a20 2020 2020 2020  rguments.       
-0001c270: 202d 2d2d 2d2d 2d2d 2d2d 0a20 2020 2020   ---------.     
-0001c280: 2020 2073 6567 5f49 4473 3a20 7468 6520     seg_IDs: the 
-0001c290: 3144 2061 7272 6179 206f 6620 7365 6720  1D array of seg 
-0001c2a0: 6964 205b 6e2c 5d0a 2020 2020 2020 2020  id [n,].        
-0001c2b0: 646f 776e 5f49 4473 3a20 7468 6520 3144  down_IDs: the 1D
-0001c2c0: 2061 7272 6179 206f 6620 646f 776e 7374   array of downst
-0001c2d0: 7265 616d 2073 6567 2069 6420 5b6e 2c5d  ream seg id [n,]
-0001c2e0: 3b20 6966 206e 6f20 646f 776e 5f49 4473  ; if no down_IDs
-0001c2f0: 2066 6f72 2061 2067 6976 656e 2073 6567   for a given seg
-0001c300: 6d65 6e74 2073 686f 756c 6420 6265 206e  ment should be n
-0001c310: 6567 6174 6976 650a 2020 2020 2020 2020  egative.        
-0001c320: 5265 7475 726e 730a 2020 2020 2020 2020  Returns.        
-0001c330: 2d2d 2d2d 2d2d 2d0a 2020 2020 2020 2020  -------.        
-0001c340: 4e54 4f50 4f3a 2074 6865 2032 4420 6172  NTOPO: the 2D ar
-0001c350: 7261 7920 6f66 2064 6f77 6e73 7265 616d  ray of downsream
-0001c360: 2073 6567 2069 6420 7320 5b6e 2c31 3030   seg id s [n,100
-0001c370: 3030 5d3b 2031 3030 3030 2069 7320 6d61  00]; 10000 is ma
-0001c380: 7869 6d75 6d65 206e 756d 6265 7220 6f66  ximume number of
-0001c390: 2064 6f77 6e73 7472 6561 6d0a 2020 2020   downstream.    
-0001c3a0: 2020 2020 2222 220a 2020 2020 2020 2020      """.        
-0001c3b0: 696d 706f 7274 2070 616e 6461 7320 6173  import pandas as
-0001c3c0: 2070 640a 2020 2020 2020 2020 696d 706f   pd.        impo
-0001c3d0: 7274 206e 756d 7079 2061 7320 6e70 0a20  rt numpy as np. 
-0001c3e0: 2020 2020 2020 2023 0a20 2020 2020 2020         #.       
-0001c3f0: 2073 6567 5f49 4473 203d 206e 702e 6172   seg_IDs = np.ar
-0001c400: 7261 7928 7365 675f 4944 7329 0a20 2020  ray(seg_IDs).   
-0001c410: 2020 2020 2064 6f77 6e5f 4944 7320 3d20       down_IDs = 
-0001c420: 6e70 2e61 7272 6179 2864 6f77 6e5f 4944  np.array(down_ID
-0001c430: 7329 0a20 2020 2020 2020 204e 544f 504f  s).        NTOPO
-0001c440: 203d 206e 702e 656d 7074 7928 5b6c 656e   = np.empty([len
-0001c450: 2873 6567 5f49 4473 292c 3130 3030 305d  (seg_IDs),10000]
-0001c460: 2920 2320 6372 6561 7465 2074 6865 2065  ) # create the e
-0001c470: 6d70 7479 2061 7272 6179 2077 6974 6820  mpty array with 
-0001c480: 6c65 6e67 7468 206f 6620 7365 675f 4944  length of seg_ID
-0001c490: 7320 616e 6420 3130 3030 300a 2020 2020  s and 10000.    
-0001c4a0: 2020 2020 4e54 4f50 4f20 5b3a 5d20 3d20      NTOPO [:] = 
-0001c4b0: 6e70 2e6e 616e 2023 2070 6f70 756c 6174  np.nan # populat
-0001c4c0: 6520 7769 7468 206e 616e 0a20 2020 2020  e with nan.     
-0001c4d0: 2020 204e 544f 504f 205b 3a2c 305d 203d     NTOPO [:,0] =
-0001c4e0: 2073 6567 5f49 4473 2023 2061 7373 6967   seg_IDs # assig
-0001c4f0: 6e20 7468 6520 6669 7273 7420 636f 6c6f  n the first colo
-0001c500: 6d6e 2061 7320 7365 6720 6964 0a20 2020  mn as seg id.   
-0001c510: 2020 2020 2023 206c 6f6f 7020 6f76 6572       # loop over
-0001c520: 2074 6865 2073 6567 5f49 4473 0a20 2020   the seg_IDs.   
-0001c530: 2020 2020 2066 6f72 2069 2069 6e20 6e70       for i in np
-0001c540: 2e61 7261 6e67 6528 6c65 6e28 7365 675f  .arange(len(seg_
-0001c550: 4944 7329 293a 0a20 2020 2020 2020 2020  IDs)):.         
-0001c560: 2020 2049 4420 3d20 7365 675f 4944 7320     ID = seg_IDs 
-0001c570: 5b69 5d20 2320 6765 7420 7468 6520 7365  [i] # get the se
-0001c580: 6720 4944 0a20 2020 2020 2020 2020 2020  g ID.           
-0001c590: 2064 6f77 6e5f 4944 203d 2064 6f77 6e5f   down_ID = down_
-0001c5a0: 4944 7320 5b69 5d20 2320 6765 7420 7468  IDs [i] # get th
-0001c5b0: 6520 7365 6720 646f 776e 7374 7265 616d  e seg downstream
-0001c5c0: 2049 440a 2020 2020 2020 2020 2020 2020   ID.            
-0001c5d0: 6966 2064 6f77 6e5f 4944 2069 6e20 7365  if down_ID in se
-0001c5e0: 675f 4944 733a 2023 2063 6865 636b 2069  g_IDs: # check i
-0001c5f0: 6620 7468 6520 646f 776e 7374 7265 616d  f the downstream
-0001c600: 2073 6567 2069 7320 7061 7274 206f 6620   seg is part of 
-0001c610: 7269 7665 7220 6e65 7477 6f72 6b0a 2020  river network.  
-0001c620: 2020 2020 2020 2020 2020 2020 2020 646f                do
-0001c630: 776e 5f73 7472 6561 6d5f 6578 6973 7473  wn_stream_exists
-0001c640: 203d 2054 7275 650a 2020 2020 2020 2020   = True.        
-0001c650: 2020 2020 656c 7365 3a0a 2020 2020 2020      else:.      
-0001c660: 2020 2020 2020 2020 2020 646f 776e 5f73            down_s
-0001c670: 7472 6561 6d5f 6578 6973 7473 203d 2046  tream_exists = F
-0001c680: 616c 7365 0a20 2020 2020 2020 2020 2020  alse.           
-0001c690: 206d 203d 2031 2023 2069 6e69 7469 616c   m = 1 # initial
-0001c6a0: 697a 6520 6d0a 2020 2020 2020 2020 2020  ize m.          
-0001c6b0: 2020 7768 696c 6520 646f 776e 5f49 4420    while down_ID 
-0001c6c0: 3e20 3020 616e 6420 646f 776e 5f73 7472  > 0 and down_str
-0001c6d0: 6561 6d5f 6578 6973 7473 3a20 2320 7768  eam_exists: # wh
-0001c6e0: 696c 6520 6e6f 7420 7468 6520 6c61 7374  ile not the last
-0001c6f0: 2073 6567 6d65 6e74 0a20 2020 2020 2020   segment.       
-0001c700: 2020 2020 2020 2020 2023 2075 7064 6174           # updat
-0001c710: 6520 7468 6520 4944 2061 6e64 2049 4420  e the ID and ID 
-0001c720: 646f 776e 0a20 2020 2020 2020 2020 2020  down.           
-0001c730: 2020 2020 2069 6478 203d 206e 702e 7768       idx = np.wh
-0001c740: 6572 6520 2873 6567 5f49 4473 203d 3d20  ere (seg_IDs == 
-0001c750: 646f 776e 5f49 4429 2023 2067 6574 2074  down_ID) # get t
-0001c760: 6865 2069 6e64 6578 206f 6620 7468 6520  he index of the 
-0001c770: 7365 676d 656e 7420 7468 6174 2069 7320  segment that is 
-0001c780: 646f 776e 7374 7265 616d 0a20 2020 2020  downstream.     
-0001c790: 2020 2020 2020 2020 2020 2049 4420 3d20             ID = 
-0001c7a0: 7365 675f 4944 7320 5b69 6478 5d20 2320  seg_IDs [idx] # 
-0001c7b0: 7570 6461 7465 2074 6865 2049 440a 2020  update the ID.  
-0001c7c0: 2020 2020 2020 2020 2020 2020 2020 646f                do
-0001c7d0: 776e 5f49 4420 3d20 646f 776e 5f49 4473  wn_ID = down_IDs
-0001c7e0: 205b 6964 785d 2023 2075 7064 6174 6520   [idx] # update 
-0001c7f0: 7468 6520 646f 776e 7374 7265 616d 0a20  the downstream. 
-0001c800: 2020 2020 2020 2020 2020 2020 2020 2069                 i
-0001c810: 6620 646f 776e 5f49 4420 696e 2073 6567  f down_ID in seg
-0001c820: 5f49 4473 3a0a 2020 2020 2020 2020 2020  _IDs:.          
-0001c830: 2020 2020 2020 2020 2020 646f 776e 5f73            down_s
-0001c840: 7472 6561 6d5f 6578 6973 7473 203d 2054  tream_exists = T
-0001c850: 7275 650a 2020 2020 2020 2020 2020 2020  rue.            
-0001c860: 2020 2020 656c 7365 3a0a 2020 2020 2020      else:.      
-0001c870: 2020 2020 2020 2020 2020 2020 2020 646f                do
-0001c880: 776e 5f73 7472 6561 6d5f 6578 6973 7473  wn_stream_exists
-0001c890: 203d 2046 616c 7365 0a20 2020 2020 2020   = False.       
-0001c8a0: 2020 2020 2020 2020 204e 544f 504f 5b69           NTOPO[i
-0001c8b0: 2c6d 5d20 3d20 4944 0a20 2020 2020 2020  ,m] = ID.       
-0001c8c0: 2020 2020 2020 2020 206d 202b 3d20 310a           m += 1.
-0001c8d0: 2020 2020 2020 2020 7265 7475 726e 204e          return N
-0001c8e0: 544f 504f 0a0a 2020 2020 6465 6620 6765  TOPO..    def ge
-0001c8f0: 745f 616c 6c5f 7570 7374 7265 616d 2820  t_all_upstream( 
-0001c900: 2020 7365 6c66 2c0a 2020 2020 2020 2020    self,.        
-0001c910: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001c920: 2020 2020 7365 675f 4944 2c0a 2020 2020      seg_ID,.    
-0001c930: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001c940: 2020 2020 2020 2020 4e54 4f50 4f29 3a0a          NTOPO):.
-0001c950: 2020 2020 2020 2020 2222 220a 2020 2020          """.    
-0001c960: 2020 2020 4020 6175 7468 6f72 3a20 2020      @ author:   
-0001c970: 2020 2020 2020 2020 2020 2020 2020 2053                 S
-0001c980: 6865 7276 616e 2047 6861 7261 7269 0a20  hervan Gharari. 
-0001c990: 2020 2020 2020 2040 2047 6974 6875 623a         @ Github:
-0001c9a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001c9b0: 2020 6874 7470 733a 2f2f 6769 7468 7562    https://github
-0001c9c0: 2e63 6f6d 2f53 6865 7276 616e 4768 6172  .com/ShervanGhar
-0001c9d0: 6172 692f 4541 5359 4d4f 5245 0a20 2020  ari/EASYMORE.   
-0001c9e0: 2020 2020 2040 2061 7574 686f 7227 7320       @ author's 
-0001c9f0: 656d 6169 6c20 6964 3a20 2020 2020 2020  email id:       
-0001ca00: 7368 2e67 6861 7261 7269 4067 6d61 696c  sh.gharari@gmail
-0001ca10: 2e63 6f6d 0a20 2020 2020 2020 2040 206c  .com.        @ l
-0001ca20: 6963 656e 7365 3a20 2020 2020 2020 2020  icense:         
-0001ca30: 2020 2020 2020 2020 474e 552d 4750 4c76          GNU-GPLv
-0001ca40: 330a 2020 2020 2020 2020 5468 6973 2066  3.        This f
-0001ca50: 756e 6374 696f 6e20 6765 7473 2061 2073  unction gets a s
-0001ca60: 6567 6d65 6e65 7420 4944 2c20 6120 312d  egmenet ID, a 1-
-0001ca70: 4420 6172 7261 7920 6f66 206e 756d 7079  D array of numpy
-0001ca80: 2061 7272 6179 7320 6f66 2072 6976 6572   arrays of river
-0001ca90: 2072 6561 6368 2049 4420 616e 640a 2020   reach ID and.  
-0001caa0: 2020 2020 2020 6120 7369 6d69 6c61 7220        a similar 
-0001cab0: 312d 4420 6172 7261 7920 6f66 2064 6f77  1-D array of dow
-0001cac0: 6e73 7472 6561 6d20 7269 7665 7220 7265  nstream river re
-0001cad0: 6163 6820 4944 0a20 2020 2020 2020 2041  ach ID.        A
-0001cae0: 7267 756d 656e 7473 0a20 2020 2020 2020  rguments.       
-0001caf0: 202d 2d2d 2d2d 2d2d 2d2d 0a20 2020 2020   ---------.     
-0001cb00: 2020 2073 6567 5f49 443a 2074 6865 2073     seg_ID: the s
-0001cb10: 6567 6d65 6e74 2069 6420 7768 6963 6820  egment id which 
-0001cb20: 7765 2077 616e 7420 7468 6520 7570 7374  we want the upst
-0001cb30: 7265 616d 0a20 2020 2020 2020 204e 544f  ream.        NTO
-0001cb40: 504f 3a20 7468 6520 3244 2061 7272 6179  PO: the 2D array
-0001cb50: 206f 6620 646f 776e 7374 7265 616d 2066   of downstream f
-0001cb60: 6f72 2065 6163 6820 7365 676d 656e 740a  or each segment.
-0001cb70: 2020 2020 2020 2020 5265 7475 726e 730a          Returns.
-0001cb80: 2020 2020 2020 2020 2d2d 2d2d 2d2d 2d0a          -------.
-0001cb90: 2020 2020 2020 2020 4172 7261 793a 2074          Array: t
-0001cba0: 6865 2032 4420 6172 7261 7920 6f66 2064  he 2D array of d
-0001cbb0: 6f77 6e73 7265 616d 2073 6567 2069 6420  ownsream seg id 
-0001cbc0: 7320 5b6e 2c31 3030 305d 2031 3030 3020  s [n,1000] 1000 
-0001cbd0: 6973 206d 6178 696d 756d 6520 6e75 6d62  is maximume numb
-0001cbe0: 6572 206f 6620 646f 776e 7374 7265 616d  er of downstream
-0001cbf0: 0a20 2020 2020 2020 2022 2222 0a20 2020  .        """.   
-0001cc00: 2020 2020 2069 6d70 6f72 7420 7061 6e64       import pand
-0001cc10: 6173 2061 7320 7064 0a20 2020 2020 2020  as as pd.       
-0001cc20: 2069 6d70 6f72 7420 6e75 6d70 7920 6173   import numpy as
-0001cc30: 206e 700a 2020 2020 2020 2020 230a 2020   np.        #.  
-0001cc40: 2020 2020 2020 7570 7374 7265 616d 7320        upstreams 
-0001cc50: 3d20 6e70 2e61 7272 6179 285b 5d29 0a20  = np.array([]). 
-0001cc60: 2020 2020 2020 2023 206c 6f6f 7020 6f76         # loop ov
-0001cc70: 6572 2074 6865 2072 6f77 7320 616e 6420  er the rows and 
-0001cc80: 6669 6e64 2074 6865 2072 6f77 7320 7468  find the rows th
-0001cc90: 6174 2074 6865 2073 6567 5f49 4420 6973  at the seg_ID is
-0001cca0: 206d 656e 7469 6f6e 6564 2069 6e20 7468   mentioned in th
-0001ccb0: 656d 0a20 2020 2020 2020 2066 6f72 2069  em.        for i
-0001ccc0: 2069 6e20 6e70 2e61 7261 6e67 6528 6c65   in np.arange(le
-0001ccd0: 6e28 4e54 4f50 4f5b 3a2c 305d 2929 3a0a  n(NTOPO[:,0])):.
-0001cce0: 2020 2020 2020 2020 2020 2020 2320 6765              # ge
-0001ccf0: 7420 726f 7773 0a20 2020 2020 2020 2020  t rows.         
-0001cd00: 2020 2072 6f77 203d 204e 544f 504f 5b69     row = NTOPO[i
-0001cd10: 2c3a 5d2e 666c 6174 7465 6e28 290a 2020  ,:].flatten().  
-0001cd20: 2020 2020 2020 2020 2020 2320 6368 6563            # chec
-0001cd30: 6b20 6966 2073 6567 5f49 4420 6973 2069  k if seg_ID is i
-0001cd40: 6e20 7468 6520 726f 770a 2020 2020 2020  n the row.      
-0001cd50: 2020 2020 2020 6966 2073 6567 5f49 4420        if seg_ID 
-0001cd60: 696e 2072 6f77 3a0a 2020 2020 2020 2020  in row:.        
-0001cd70: 2020 2020 2020 2020 7570 7374 7265 616d          upstream
-0001cd80: 7320 3d20 6e70 2e61 7070 656e 6420 2875  s = np.append (u
-0001cd90: 7073 7472 6561 6d73 2c20 726f 775b 305d  pstreams, row[0]
-0001cda0: 290a 2020 2020 2020 2020 7265 7475 726e  ).        return
-0001cdb0: 2075 7073 7472 6561 6d73 0a0a 2020 2020   upstreams..    
-0001cdc0: 2320 6465 6620 7469 665f 6372 6f70 2028  # def tif_crop (
-0001cdd0: 2073 656c 662c 0a20 2020 2023 2020 2020   self,.    #    
-0001cde0: 2020 2020 2020 2020 2020 2020 2072 6173               ras
-0001cdf0: 7465 725f 696e 2c0a 2020 2020 2320 2020  ter_in,.    #   
-0001ce00: 2020 2020 2020 2020 2020 2020 2020 7261                ra
-0001ce10: 7374 6572 5f6f 7574 2c0a 2020 2020 2320  ster_out,.    # 
-0001ce20: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001ce30: 786d 696e 3d4e 6f6e 652c 0a20 2020 2023  xmin=None,.    #
+0001ad20: 2020 2020 2020 2020 2020 2020 205b 782e               [x.
+0001ad30: 6765 6f6d 6574 7279 5d2b 6c69 7374 2864  geometry]+list(d
+0001ad40: 6632 2e69 6c6f 635b 782e 7369 6478 5d2e  f2.iloc[x.sidx].
+0001ad50: 6765 6f6d 6574 7279 2929 202c 2061 7869  geometry)) , axi
+0001ad60: 733d 3129 0a20 2020 2020 2020 2020 2020  s=1).           
+0001ad70: 2064 6631 2e67 656f 6d65 7472 7920 3d20   df1.geometry = 
+0001ad80: 6466 312e 6e65 775f 670a 2020 2020 2020  df1.new_g.      
+0001ad90: 2020 2020 2020 6466 3120 3d20 6466 312e        df1 = df1.
+0001ada0: 6c6f 635b 6466 312e 6765 6f6d 6574 7279  loc[df1.geometry
+0001adb0: 2e69 735f 656d 7074 793d 3d46 616c 7365  .is_empty==False
+0001adc0: 5d2e 636f 7079 2829 0a20 2020 2020 2020  ].copy().       
+0001add0: 2020 2020 2064 6631 2e64 726f 7028 5b27       df1.drop(['
+0001ade0: 6262 6f78 272c 2027 7369 6478 272c 2027  bbox', 'sidx', '
+0001adf0: 6e65 775f 6727 5d2c 2061 7869 733d 312c  new_g'], axis=1,
+0001ae00: 2069 6e70 6c61 6365 3d54 7275 6529 0a20   inplace=True). 
+0001ae10: 2020 2020 2020 2020 2020 2072 6574 7572             retur
+0001ae20: 6e20 6466 310a 2020 2020 2020 2020 656c  n df1.        el
+0001ae30: 6966 2068 6f77 3d3d 2773 796d 6d65 7472  if how=='symmetr
+0001ae40: 6963 5f64 6966 6665 7265 6e63 6527 3a0a  ic_difference':.
+0001ae50: 2020 2020 2020 2020 2020 2020 6466 315b              df1[
+0001ae60: 2769 6478 3127 5d20 3d20 6466 312e 696e  'idx1'] = df1.in
+0001ae70: 6465 782e 746f 6c69 7374 2829 0a20 2020  dex.tolist().   
+0001ae80: 2020 2020 2020 2020 2064 6632 5b27 6964           df2['id
+0001ae90: 7832 275d 203d 2064 6632 2e69 6e64 6578  x2'] = df2.index
+0001aea0: 2e74 6f6c 6973 7428 290a 2020 2020 2020  .tolist().      
+0001aeb0: 2020 2020 2020 6466 315b 2769 6478 3227        df1['idx2'
+0001aec0: 5d20 3d20 6e70 2e6e 616e 0a20 2020 2020  ] = np.nan.     
+0001aed0: 2020 2020 2020 2064 6632 5b27 6964 7831         df2['idx1
+0001aee0: 275d 203d 206e 702e 6e61 6e0a 2020 2020  '] = np.nan.    
+0001aef0: 2020 2020 2020 2020 6466 7379 6d20 3d20          dfsym = 
+0001af00: 6466 312e 6d65 7267 6528 6466 322c 206f  df1.merge(df2, o
+0001af10: 6e3d 5b27 6964 7831 272c 2769 6478 3227  n=['idx1','idx2'
+0001af20: 5d2c 2068 6f77 3d27 6f75 7465 7227 2c20  ], how='outer', 
+0001af30: 7375 6666 6978 6573 3d5b 275f 3127 2c27  suffixes=['_1','
+0001af40: 5f32 275d 290a 2020 2020 2020 2020 2020  _2']).          
+0001af50: 2020 6466 7379 6d5b 2767 656f 6d65 7472    dfsym['geometr
+0001af60: 7927 5d20 3d20 6466 7379 6d2e 6765 6f6d  y'] = dfsym.geom
+0001af70: 6574 7279 5f31 0a20 2020 2020 2020 2020  etry_1.         
+0001af80: 2020 2064 6673 796d 2e6c 6f63 5b64 6673     dfsym.loc[dfs
+0001af90: 796d 2e67 656f 6d65 7472 795f 322e 6973  ym.geometry_2.is
+0001afa0: 6e75 6c6c 2829 3d3d 4661 6c73 652c 2027  null()==False, '
+0001afb0: 6765 6f6d 6574 7279 275d 203d 2064 6673  geometry'] = dfs
+0001afc0: 796d 2e6c 6f63 5b64 6673 796d 2e67 656f  ym.loc[dfsym.geo
+0001afd0: 6d65 7472 795f 322e 6973 6e75 6c6c 2829  metry_2.isnull()
+0001afe0: 3d3d 4661 6c73 652c 2027 6765 6f6d 6574  ==False, 'geomet
+0001aff0: 7279 5f32 275d 0a20 2020 2020 2020 2020  ry_2'].         
+0001b000: 2020 2064 6673 796d 2e64 726f 7028 5b27     dfsym.drop(['
+0001b010: 6765 6f6d 6574 7279 5f31 272c 2027 6765  geometry_1', 'ge
+0001b020: 6f6d 6574 7279 5f32 275d 2c20 6178 6973  ometry_2'], axis
+0001b030: 3d31 2c20 696e 706c 6163 653d 5472 7565  =1, inplace=True
+0001b040: 290a 2020 2020 2020 2020 2020 2020 6466  ).            df
+0001b050: 7379 6d20 3d20 6770 642e 4765 6f44 6174  sym = gpd.GeoDat
+0001b060: 6146 7261 6d65 2864 6673 796d 2c20 636f  aFrame(dfsym, co
+0001b070: 6c75 6d6e 733d 6466 7379 6d2e 636f 6c75  lumns=dfsym.colu
+0001b080: 6d6e 732c 2063 7273 3d64 6631 2e63 7273  mns, crs=df1.crs
+0001b090: 290a 2020 2020 2020 2020 2020 2020 7370  ).            sp
+0001b0a0: 6174 6961 6c5f 696e 6465 7820 3d20 6466  atial_index = df
+0001b0b0: 7379 6d2e 7369 6e64 6578 0a20 2020 2020  sym.sindex.     
+0001b0c0: 2020 2020 2020 2064 6673 796d 5b27 6262         dfsym['bb
+0001b0d0: 6f78 275d 203d 2064 6673 796d 2e67 656f  ox'] = dfsym.geo
+0001b0e0: 6d65 7472 792e 6170 706c 7928 6c61 6d62  metry.apply(lamb
+0001b0f0: 6461 2078 3a20 782e 626f 756e 6473 290a  da x: x.bounds).
+0001b100: 2020 2020 2020 2020 2020 2020 6466 7379              dfsy
+0001b110: 6d5b 2773 6964 7827 5d20 3d20 6466 7379  m['sidx'] = dfsy
+0001b120: 6d2e 6262 6f78 2e61 7070 6c79 286c 616d  m.bbox.apply(lam
+0001b130: 6264 6120 783a 6c69 7374 2873 7061 7469  bda x:list(spati
+0001b140: 616c 5f69 6e64 6578 2e69 6e74 6572 7365  al_index.interse
+0001b150: 6374 696f 6e28 7829 2929 0a20 2020 2020  ction(x))).     
+0001b160: 2020 2020 2020 2064 6673 796d 5b27 6964         dfsym['id
+0001b170: 7827 5d20 3d20 6466 7379 6d2e 696e 6465  x'] = dfsym.inde
+0001b180: 782e 7661 6c75 6573 0a20 2020 2020 2020  x.values.       
+0001b190: 2020 2020 2064 6673 796d 2e61 7070 6c79       dfsym.apply
+0001b1a0: 286c 616d 6264 6120 783a 2078 2e73 6964  (lambda x: x.sid
+0001b1b0: 782e 7265 6d6f 7665 2878 2e69 6478 292c  x.remove(x.idx),
+0001b1c0: 2061 7869 733d 3129 0a20 2020 2020 2020   axis=1).       
+0001b1d0: 2020 2020 2064 6673 796d 5b27 6e65 775f       dfsym['new_
+0001b1e0: 6727 5d20 3d20 6466 7379 6d2e 6170 706c  g'] = dfsym.appl
+0001b1f0: 7928 6c61 6d62 6461 2078 3a20 7265 6475  y(lambda x: redu
+0001b200: 6365 286c 616d 6264 6120 782c 2079 3a20  ce(lambda x, y: 
+0001b210: 782e 6469 6666 6572 656e 6365 2879 292e  x.difference(y).
+0001b220: 6275 6666 6572 2830 292c 0a20 2020 2020  buffer(0),.     
+0001b230: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001b240: 2020 2020 2020 2020 5b78 2e67 656f 6d65          [x.geome
+0001b250: 7472 795d 2b6c 6973 7428 6466 7379 6d2e  try]+list(dfsym.
+0001b260: 696c 6f63 5b78 2e73 6964 785d 2e67 656f  iloc[x.sidx].geo
+0001b270: 6d65 7472 7929 2920 2c20 6178 6973 3d31  metry)) , axis=1
+0001b280: 290a 2020 2020 2020 2020 2020 2020 6466  ).            df
+0001b290: 7379 6d2e 6765 6f6d 6574 7279 203d 2064  sym.geometry = d
+0001b2a0: 6673 796d 2e6e 6577 5f67 0a20 2020 2020  fsym.new_g.     
+0001b2b0: 2020 2020 2020 2064 6673 796d 203d 2064         dfsym = d
+0001b2c0: 6673 796d 2e6c 6f63 5b64 6673 796d 2e67  fsym.loc[dfsym.g
+0001b2d0: 656f 6d65 7472 792e 6973 5f65 6d70 7479  eometry.is_empty
+0001b2e0: 3d3d 4661 6c73 655d 2e63 6f70 7928 290a  ==False].copy().
+0001b2f0: 2020 2020 2020 2020 2020 2020 6466 7379              dfsy
+0001b300: 6d2e 6472 6f70 285b 2762 626f 7827 2c20  m.drop(['bbox', 
+0001b310: 2773 6964 7827 2c20 2769 6478 272c 2027  'sidx', 'idx', '
+0001b320: 6964 7831 272c 2769 6478 3227 2c20 276e  idx1','idx2', 'n
+0001b330: 6577 5f67 275d 2c20 6178 6973 3d31 2c20  ew_g'], axis=1, 
+0001b340: 696e 706c 6163 653d 5472 7565 290a 2020  inplace=True).  
+0001b350: 2020 2020 2020 2020 2020 7265 7475 726e            return
+0001b360: 2064 6673 796d 0a20 2020 2020 2020 2065   dfsym.        e
+0001b370: 6c69 6620 686f 773d 3d27 756e 696f 6e27  lif how=='union'
+0001b380: 3a0a 2020 2020 2020 2020 2020 2020 6466  :.            df
+0001b390: 696e 7465 7220 3d20 7370 6174 6961 6c5f  inter = spatial_
+0001b3a0: 6f76 6572 6c61 7973 2864 6631 2c20 6466  overlays(df1, df
+0001b3b0: 322c 2068 6f77 3d27 696e 7465 7273 6563  2, how='intersec
+0001b3c0: 7469 6f6e 2729 0a20 2020 2020 2020 2020  tion').         
+0001b3d0: 2020 2064 6673 796d 203d 2073 7061 7469     dfsym = spati
+0001b3e0: 616c 5f6f 7665 726c 6179 7328 6466 312c  al_overlays(df1,
+0001b3f0: 2064 6632 2c20 686f 773d 2773 796d 6d65   df2, how='symme
+0001b400: 7472 6963 5f64 6966 6665 7265 6e63 6527  tric_difference'
+0001b410: 290a 2020 2020 2020 2020 2020 2020 6466  ).            df
+0001b420: 756e 696f 6e20 3d20 6466 696e 7465 722e  union = dfinter.
+0001b430: 6170 7065 6e64 2864 6673 796d 290a 2020  append(dfsym).  
+0001b440: 2020 2020 2020 2020 2020 6466 756e 696f            dfunio
+0001b450: 6e2e 7265 7365 745f 696e 6465 7828 696e  n.reset_index(in
+0001b460: 706c 6163 653d 5472 7565 2c20 6472 6f70  place=True, drop
+0001b470: 3d54 7275 6529 0a20 2020 2020 2020 2020  =True).         
+0001b480: 2020 2072 6574 7572 6e20 6466 756e 696f     return dfunio
+0001b490: 6e0a 2020 2020 2020 2020 656c 6966 2068  n.        elif h
+0001b4a0: 6f77 3d3d 2769 6465 6e74 6974 7927 3a0a  ow=='identity':.
+0001b4b0: 2020 2020 2020 2020 2020 2020 6466 756e              dfun
+0001b4c0: 696f 6e20 3d20 7370 6174 6961 6c5f 6f76  ion = spatial_ov
+0001b4d0: 6572 6c61 7973 2864 6631 2c20 6466 322c  erlays(df1, df2,
+0001b4e0: 2068 6f77 3d27 756e 696f 6e27 290a 2020   how='union').  
+0001b4f0: 2020 2020 2020 2020 2020 636f 6c73 3120            cols1 
+0001b500: 3d20 6466 312e 636f 6c75 6d6e 732e 746f  = df1.columns.to
+0001b510: 6c69 7374 2829 0a20 2020 2020 2020 2020  list().         
+0001b520: 2020 2063 6f6c 7332 203d 2064 6632 2e63     cols2 = df2.c
+0001b530: 6f6c 756d 6e73 2e74 6f6c 6973 7428 290a  olumns.tolist().
+0001b540: 2020 2020 2020 2020 2020 2020 636f 6c73              cols
+0001b550: 312e 7265 6d6f 7665 2827 6765 6f6d 6574  1.remove('geomet
+0001b560: 7279 2729 0a20 2020 2020 2020 2020 2020  ry').           
+0001b570: 2063 6f6c 7332 2e72 656d 6f76 6528 2767   cols2.remove('g
+0001b580: 656f 6d65 7472 7927 290a 2020 2020 2020  eometry').      
+0001b590: 2020 2020 2020 636f 6c73 3220 3d20 7365        cols2 = se
+0001b5a0: 7428 636f 6c73 3229 2e69 6e74 6572 7365  t(cols2).interse
+0001b5b0: 6374 696f 6e28 7365 7428 636f 6c73 3129  ction(set(cols1)
+0001b5c0: 290a 2020 2020 2020 2020 2020 2020 636f  ).            co
+0001b5d0: 6c73 3120 3d20 6c69 7374 2873 6574 2863  ls1 = list(set(c
+0001b5e0: 6f6c 7331 292e 6469 6666 6572 656e 6365  ols1).difference
+0001b5f0: 2873 6574 2863 6f6c 7332 2929 290a 2020  (set(cols2))).  
+0001b600: 2020 2020 2020 2020 2020 636f 6c73 3220            cols2 
+0001b610: 3d20 5b63 6f6c 2b27 5f31 2720 666f 7220  = [col+'_1' for 
+0001b620: 636f 6c20 696e 2063 6f6c 7332 5d0a 2020  col in cols2].  
+0001b630: 2020 2020 2020 2020 2020 6466 756e 696f            dfunio
+0001b640: 6e20 3d20 6466 756e 696f 6e5b 2864 6675  n = dfunion[(dfu
+0001b650: 6e69 6f6e 5b63 6f6c 7331 2b63 6f6c 7332  nion[cols1+cols2
+0001b660: 5d2e 6973 6e75 6c6c 2829 3d3d 4661 6c73  ].isnull()==Fals
+0001b670: 6529 2e76 616c 7565 735d 0a20 2020 2020  e).values].     
+0001b680: 2020 2020 2020 2072 6574 7572 6e20 6466         return df
+0001b690: 756e 696f 6e0a 0a20 2020 2064 6566 206d  union..    def m
+0001b6a0: 616b 655f 7368 6170 655f 706f 696e 7428  ake_shape_point(
+0001b6b0: 2020 2073 656c 662c 0a20 2020 2020 2020     self,.       
+0001b6c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001b6d0: 2020 2020 2064 6174 6166 7261 6d65 2c0a       dataframe,.
+0001b6e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001b6f0: 2020 2020 2020 2020 2020 2020 6c6f 6e5f              lon_
+0001b700: 636f 6c75 6d6e 2c0a 2020 2020 2020 2020  column,.        
+0001b710: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001b720: 2020 2020 6c61 745f 636f 6c75 6d6e 2c0a      lat_column,.
+0001b730: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001b740: 2020 2020 2020 2020 2020 2020 706f 696e              poin
+0001b750: 745f 7368 705f 6669 6c65 5f6e 616d 6520  t_shp_file_name 
+0001b760: 3d20 4e6f 6e65 2c0a 2020 2020 2020 2020  = None,.        
+0001b770: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001b780: 2020 2020 6372 7320 3d20 4e6f 6e65 293a      crs = None):
+0001b790: 0a20 2020 2020 2020 2022 2222 0a20 2020  .        """.   
+0001b7a0: 2020 2020 2040 2061 7574 686f 723a 2020       @ author:  
+0001b7b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001b7c0: 5368 6572 7661 6e20 4768 6172 6172 690a  Shervan Gharari.
+0001b7d0: 2020 2020 2020 2020 4020 4769 7468 7562          @ Github
+0001b7e0: 3a20 2020 2020 2020 2020 2020 2020 2020  :               
+0001b7f0: 2020 2068 7474 7073 3a2f 2f67 6974 6875     https://githu
+0001b800: 622e 636f 6d2f 5368 6572 7661 6e47 6861  b.com/ShervanGha
+0001b810: 7261 7269 2f45 4153 594d 4f52 450a 2020  rari/EASYMORE.  
+0001b820: 2020 2020 2020 4020 6175 7468 6f72 2773        @ author's
+0001b830: 2065 6d61 696c 2069 643a 2020 2020 2020   email id:      
+0001b840: 2073 682e 6768 6172 6172 6940 676d 6169   sh.gharari@gmai
+0001b850: 6c2e 636f 6d0a 2020 2020 2020 2020 4020  l.com.        @ 
+0001b860: 6c69 6365 6e73 653a 2020 2020 2020 2020  license:        
+0001b870: 2020 2020 2020 2020 2047 4e55 2d47 504c           GNU-GPL
+0001b880: 7633 0a20 2020 2020 2020 2054 6869 7320  v3.        This 
+0001b890: 6675 6e63 7469 6f6e 2063 7265 6174 6573  function creates
+0001b8a0: 2061 2067 656f 7061 6e64 6173 2064 6174   a geopandas dat
+0001b8b0: 6166 7261 6d65 206f 6620 6c61 742c 206c  aframe of lat, l
+0001b8c0: 6f6e 2c20 616e 6420 4944 7320 7072 6f76  on, and IDs prov
+0001b8d0: 6964 6564 2066 726f 6d20 6120 6373 7620  ided from a csv 
+0001b8e0: 6669 6c65 206f 7220 6120 7061 6e64 6173  file or a pandas
+0001b8f0: 2064 6174 6166 7261 6d65 0a20 2020 2020   dataframe.     
+0001b900: 2020 2041 7267 756d 656e 7473 0a20 2020     Arguments.   
+0001b910: 2020 2020 202d 2d2d 2d2d 2d2d 2d2d 0a20       ---------. 
+0001b920: 2020 2020 2020 2064 6174 6166 7261 6d65         dataframe
+0001b930: 3a20 7061 6e64 6173 2064 6174 6166 7261  : pandas datafra
+0001b940: 6d65 206f 7220 7374 7269 6e67 206c 696e  me or string lin
+0001b950: 6b69 6e67 2074 6f20 6120 6373 7620 6461  king to a csv da
+0001b960: 7461 2066 7261 6d65 2074 6861 7420 696e  ta frame that in
+0001b970: 636c 7564 6573 2074 6865 206c 6174 2f6c  cludes the lat/l
+0001b980: 6f6e 2061 6e64 206f 7468 6572 2069 6e66  on and other inf
+0001b990: 6f0a 2020 2020 2020 2020 6c6f 6e5f 636f  o.        lon_co
+0001b9a0: 6c75 6d6e 3a20 7374 7269 6e67 2c20 7468  lumn: string, th
+0001b9b0: 6520 6e61 6d65 206f 6620 7468 6520 6c6f  e name of the lo
+0001b9c0: 6e67 6974 7564 6520 636f 6c75 6d6e 2069  ngitude column i
+0001b9d0: 6e20 6461 7461 6672 616d 650a 2020 2020  n dataframe.    
+0001b9e0: 2020 2020 6c61 745f 636f 6c75 6d6e 3a20      lat_column: 
+0001b9f0: 7374 7269 6e67 2c20 7468 6520 6e61 6d65  string, the name
+0001ba00: 206f 6620 7468 6520 6c61 7469 7475 6465   of the latitude
+0001ba10: 2063 6f6c 756d 6e20 696e 2064 6174 6166   column in dataf
+0001ba20: 7261 6d65 0a20 2020 2020 2020 2070 6f69  rame.        poi
+0001ba30: 6e74 5f73 6870 5f66 696c 655f 6e61 6d65  nt_shp_file_name
+0001ba40: 3a20 7374 7269 6e67 2c20 7468 6520 6e61  : string, the na
+0001ba50: 6d65 206f 6620 7468 6520 706f 696e 7420  me of the point 
+0001ba60: 7368 6170 6566 696c 6520 746f 2062 6520  shapefile to be 
+0001ba70: 7361 7665 640a 2020 2020 2020 2020 6372  saved.        cr
+0001ba80: 733a 2073 7472 696e 672c 2069 6e64 6963  s: string, indic
+0001ba90: 6174 696e 6720 7468 6520 7370 6174 6961  ating the spatia
+0001baa0: 6c20 7265 6665 7265 6e63 653b 2065 2e67  l reference; e.g
+0001bab0: 2e27 4550 5347 3a34 3332 3627 0a20 2020  .'EPSG:4326'.   
+0001bac0: 2020 2020 2052 6574 7572 6e73 0a20 2020       Returns.   
+0001bad0: 2020 2020 202d 2d2d 2d2d 2d2d 0a20 2020       -------.   
+0001bae0: 2020 2020 2073 6870 3a20 6765 6f70 616e       shp: geopan
+0001baf0: 6461 7320 6461 7461 6672 616d 652c 2077  das dataframe, w
+0001bb00: 6974 6820 7468 6520 6765 6f6d 6574 7279  ith the geometry
+0001bb10: 206f 6620 6c6f 6e67 6974 7564 6520 616e   of longitude an
+0001bb20: 6420 6c61 7469 7475 6465 0a20 2020 2020  d latitude.     
+0001bb30: 2020 2022 2222 0a20 2020 2020 2020 2069     """.        i
+0001bb40: 6d70 6f72 7420 6765 6f70 616e 6461 7320  mport geopandas 
+0001bb50: 6173 2067 7064 0a20 2020 2020 2020 2069  as gpd.        i
+0001bb60: 6d70 6f72 7420 7061 6e64 6173 2020 2020  mport pandas    
+0001bb70: 6173 2070 640a 2020 2020 2020 2020 2320  as pd.        # 
+0001bb80: 6966 2073 7472 696e 6720 6973 2067 6976  if string is giv
+0001bb90: 656e 2069 7420 6973 2061 7373 756d 6564  en it is assumed
+0001bba0: 2074 6861 7420 6973 2074 6865 206c 696e   that is the lin
+0001bbb0: 6b20 746f 2061 2063 7376 2066 696c 6520  k to a csv file 
+0001bbc0: 696e 636c 7564 696e 6720 6c61 7420 616e  including lat an
+0001bbd0: 6420 6c6f 6e20 6f66 2074 6865 2070 6f69  d lon of the poi
+0001bbe0: 6e74 730a 2020 2020 2020 2020 6966 2069  nts.        if i
+0001bbf0: 7369 6e73 7461 6e63 6528 6461 7461 6672  sinstance(datafr
+0001bc00: 616d 652c 2073 7472 293a 0a20 2020 2020  ame, str):.     
+0001bc10: 2020 2020 2020 2064 6174 6166 7261 6d65         dataframe
+0001bc20: 203d 2070 642e 7265 6164 5f63 7376 2864   = pd.read_csv(d
+0001bc30: 6174 6166 7261 6d65 290a 2020 2020 2020  ataframe).      
+0001bc40: 2020 2320 6372 6561 7465 2074 6865 2047    # create the G
+0001bc50: 656f 4461 7461 4672 616d 650a 2020 2020  eoDataFrame.    
+0001bc60: 2020 2020 7368 7020 3d20 6770 642e 4765      shp = gpd.Ge
+0001bc70: 6f44 6174 6146 7261 6d65 2864 6174 6166  oDataFrame(dataf
+0001bc80: 7261 6d65 2c20 6765 6f6d 6574 7279 3d67  rame, geometry=g
+0001bc90: 7064 2e70 6f69 6e74 735f 6672 6f6d 5f78  pd.points_from_x
+0001bca0: 7928 6461 7461 6672 616d 655b 6c6f 6e5f  y(dataframe[lon_
+0001bcb0: 636f 6c75 6d6e 5d2c 2064 6174 6166 7261  column], datafra
+0001bcc0: 6d65 5b6c 6174 5f63 6f6c 756d 6e5d 2929  me[lat_column]))
+0001bcd0: 0a20 2020 2020 2020 2023 2061 7373 6967  .        # assig
+0001bce0: 6e20 6372 732c 206f 7468 6572 7769 7365  n crs, otherwise
+0001bcf0: 2061 7373 6967 6e20 7468 6520 6465 6661   assign the defa
+0001bd00: 756c 740a 2020 2020 2020 2020 6966 2063  ult.        if c
+0001bd10: 7273 3a0a 2020 2020 2020 2020 2020 2020  rs:.            
+0001bd20: 7368 7020 3d20 7368 702e 7365 745f 6372  shp = shp.set_cr
+0001bd30: 7320 2863 7273 290a 2020 2020 2020 2020  s (crs).        
+0001bd40: 2020 2020 7072 696e 7428 2763 7273 2027      print('crs '
+0001bd50: 2c20 6372 732c 2720 6973 2061 7373 6967  , crs,' is assig
+0001bd60: 6e65 6420 746f 2074 6865 2070 6f69 6e74  ned to the point
+0001bd70: 2073 6861 7065 6669 6c65 2729 0a20 2020   shapefile').   
+0001bd80: 2020 2020 2069 6620 706f 696e 745f 7368       if point_sh
+0001bd90: 705f 6669 6c65 5f6e 616d 653a 0a20 2020  p_file_name:.   
+0001bda0: 2020 2020 2020 2020 2073 6870 2e74 6f5f           shp.to_
+0001bdb0: 6669 6c65 2870 6f69 6e74 5f73 6870 5f66  file(point_shp_f
+0001bdc0: 696c 655f 6e61 6d65 290a 2020 2020 2020  ile_name).      
+0001bdd0: 2020 2020 2020 7072 696e 7428 2770 6f69        print('poi
+0001bde0: 6e74 2073 6861 7065 6669 6c65 2069 7320  nt shapefile is 
+0001bdf0: 7361 7665 6420 6174 2027 2c20 706f 696e  saved at ', poin
+0001be00: 745f 7368 705f 6669 6c65 5f6e 616d 6529  t_shp_file_name)
+0001be10: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
+0001be20: 7368 700a 0a20 2020 2064 6566 2073 6870  shp..    def shp
+0001be30: 5f66 726f 6d5f 6972 7265 6775 6c61 725f  _from_irregular_
+0001be40: 6e63 2028 7365 6c66 2c0a 2020 2020 2020  nc (self,.      
+0001be50: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001be60: 2020 2020 2020 2020 2073 7461 7469 6f6e           station
+0001be70: 5f73 6870 5f66 696c 655f 6e61 6d65 203d  _shp_file_name =
+0001be80: 204e 6f6e 652c 0a20 2020 2020 2020 2020   None,.         
+0001be90: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001bea0: 2020 2020 2020 766f 726f 6e6f 695f 7368        voronoi_sh
+0001beb0: 705f 6669 6c65 5f6e 616d 6520 3d20 4e6f  p_file_name = No
+0001bec0: 6e65 2c0a 2020 2020 2020 2020 2020 2020  ne,.            
+0001bed0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001bee0: 2020 2062 7566 6665 7220 3d20 322c 0a20     buffer = 2,. 
+0001bef0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001bf00: 2020 2020 2020 2020 2020 2020 2020 6372                cr
+0001bf10: 7320 3d20 4e6f 6e65 2c0a 2020 2020 2020  s = None,.      
+0001bf20: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001bf30: 2020 2020 2020 2020 2074 6f6c 6572 616e           toleran
+0001bf40: 6365 203d 2030 2e30 3030 3031 293a 0a20  ce = 0.00001):. 
+0001bf50: 2020 2020 2020 2022 2222 0a20 2020 2020         """.     
+0001bf60: 2020 2040 2061 7574 686f 723a 2020 2020     @ author:    
+0001bf70: 2020 2020 2020 2020 2020 2020 2020 5368                Sh
+0001bf80: 6572 7661 6e20 4768 6172 6172 690a 2020  ervan Gharari.  
+0001bf90: 2020 2020 2020 4020 4769 7468 7562 3a20        @ Github: 
+0001bfa0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001bfb0: 2068 7474 7073 3a2f 2f67 6974 6875 622e   https://github.
+0001bfc0: 636f 6d2f 5368 6572 7661 6e47 6861 7261  com/ShervanGhara
+0001bfd0: 7269 2f45 4153 594d 4f52 450a 2020 2020  ri/EASYMORE.    
+0001bfe0: 2020 2020 4020 6175 7468 6f72 2773 2065      @ author's e
+0001bff0: 6d61 696c 2069 643a 2020 2020 2020 2073  mail id:       s
+0001c000: 682e 6768 6172 6172 6940 676d 6169 6c2e  h.gharari@gmail.
+0001c010: 636f 6d0a 2020 2020 2020 2020 4020 6c69  com.        @ li
+0001c020: 6365 6e73 653a 2020 2020 2020 2020 2020  cense:          
+0001c030: 2020 2020 2020 2047 4e55 2d47 504c 7633         GNU-GPLv3
+0001c040: 0a20 2020 2020 2020 2054 6869 7320 6675  .        This fu
+0001c050: 6e63 7469 6f6e 2063 7265 6174 6573 2061  nction creates a
+0001c060: 2056 6f72 6f6e 6f69 2064 6961 6772 616d   Voronoi diagram
+0001c070: 2066 726f 6d20 6c61 7469 7475 6465 2061   from latitude a
+0001c080: 6e64 206c 6f6e 6769 7475 6465 2070 726f  nd longitude pro
+0001c090: 7669 6465 6420 696e 2061 6e20 6972 7265  vided in an irre
+0001c0a0: 6775 6c61 7220 7368 6170 6566 696c 650a  gular shapefile.
+0001c0b0: 2020 2020 2020 2020 4172 6775 6d65 6e74          Argument
+0001c0c0: 730a 2020 2020 2020 2020 2d2d 2d2d 2d2d  s.        ------
+0001c0d0: 2d2d 2d0a 2020 2020 2020 2020 7374 6174  ---.        stat
+0001c0e0: 696f 6e5f 7368 705f 6669 6c65 5f6e 616d  ion_shp_file_nam
+0001c0f0: 653a 2073 7472 696e 672c 206e 616d 6520  e: string, name 
+0001c100: 6f66 2074 6865 2063 7265 6174 6564 2070  of the created p
+0001c110: 6f69 6e74 2073 6861 7065 6669 6c65 2074  oint shapefile t
+0001c120: 6f20 6265 2073 6176 6564 0a20 2020 2020  o be saved.     
+0001c130: 2020 2076 6f72 6f6e 6f69 5f73 6870 5f66     voronoi_shp_f
+0001c140: 696c 655f 6e61 6d65 3a20 7374 7269 6e67  ile_name: string
+0001c150: 2c20 6e61 6d65 206f 6620 7468 6520 6372  , name of the cr
+0001c160: 6561 7465 6420 566f 726f 6e6f 6920 7368  eated Voronoi sh
+0001c170: 6170 6566 696c 6520 746f 2062 6520 7361  apefile to be sa
+0001c180: 7665 640a 2020 2020 2020 2020 6275 6666  ved.        buff
+0001c190: 6572 3a20 666c 6f61 742c 2074 6865 2062  er: float, the b
+0001c1a0: 7566 6665 7220 6172 6f75 6e64 2074 6865  uffer around the
+0001c1b0: 2062 6f75 6e64 696e 6720 626f 7820 6f66   bounding box of
+0001c1c0: 2074 6865 2070 6f69 6e74 2073 6861 7065   the point shape
+0001c1d0: 6669 6c65 2066 6f72 2063 7265 6174 696e  file for creatin
+0001c1e0: 6720 7468 6520 566f 726f 6e6f 6920 7368  g the Voronoi sh
+0001c1f0: 6170 6566 696c 650a 2020 2020 2020 2020  apefile.        
+0001c200: 6372 733a 2073 7472 696e 672c 2069 6e64  crs: string, ind
+0001c210: 6963 6174 696e 6720 7468 6520 7370 6174  icating the spat
+0001c220: 6961 6c20 7265 6665 7265 6e63 6520 7379  ial reference sy
+0001c230: 7374 656d 3b20 652e 672e 2745 5053 473a  stem; e.g.'EPSG:
+0001c240: 3433 3236 270a 2020 2020 2020 2020 746f  4326'.        to
+0001c250: 6c65 7261 6e63 653a 2066 6c6f 6174 2c20  lerance: float, 
+0001c260: 746f 6c65 7261 6e63 6520 746f 2069 6465  tolerance to ide
+0001c270: 6e74 6966 7920 6966 2074 776f 2070 6f69  ntify if two poi
+0001c280: 6e74 7320 7072 6f76 6964 6564 2069 6e20  nts provided in 
+0001c290: 6e63 2066 696c 6573 2061 7265 2063 6c6f  nc files are clo
+0001c2a0: 7365 7220 7468 616e 2074 6f6c 6572 616e  ser than toleran
+0001c2b0: 6365 0a20 2020 2020 2020 2052 6574 7572  ce.        Retur
+0001c2c0: 6e73 0a20 2020 2020 2020 202d 2d2d 2d2d  ns.        -----
+0001c2d0: 2d2d 0a20 2020 2020 2020 2076 6f72 6f6e  --.        voron
+0001c2e0: 6f69 3a20 6765 6f70 616e 6461 7320 6461  oi: geopandas da
+0001c2f0: 7461 6672 616d 652c 2056 6f72 6f6e 696f  taframe, Voronio
+0001c300: 2064 6961 6772 616d 0a20 2020 2020 2020   diagram.       
+0001c310: 2070 6f69 6e74 733a 2067 656f 7061 6e64   points: geopand
+0001c320: 6173 2064 6174 6166 7261 6d65 2c20 706f  as dataframe, po
+0001c330: 696e 7473 2073 6861 7065 6669 6c65 2063  ints shapefile c
+0001c340: 7265 6174 6564 2066 6f72 2069 7272 6567  reated for irreg
+0001c350: 756c 6172 206e 6320 6669 6c65 2028 652e  ular nc file (e.
+0001c360: 672e 2073 7461 7469 6f6e 2064 6174 6129  g. station data)
+0001c370: 0a20 2020 2020 2020 2022 2222 0a0a 2020  .        """..  
+0001c380: 2020 2020 2020 2320 7265 6164 2074 6865        # read the
+0001c390: 2066 696c 6520 286f 7220 7468 6520 6669   file (or the fi
+0001c3a0: 7273 7420 6669 6c65 290a 2020 2020 2020  rst file).      
+0001c3b0: 2020 6e63 5f6e 616d 6573 203d 2067 6c6f    nc_names = glo
+0001c3c0: 622e 676c 6f62 2873 656c 662e 736f 7572  b.glob(self.sour
+0001c3d0: 6365 5f6e 6329 0a20 2020 2020 2020 206e  ce_nc).        n
+0001c3e0: 6369 6420 2020 2020 3d20 6e63 342e 4461  cid     = nc4.Da
+0001c3f0: 7461 7365 7428 6e63 5f6e 616d 6573 5b30  taset(nc_names[0
+0001c400: 5d29 0a20 2020 2020 2020 2023 2063 7265  ]).        # cre
+0001c410: 6174 6520 7468 6520 6461 7461 2066 7261  ate the data fra
+0001c420: 6d65 0a20 2020 2020 2020 2070 6f69 6e74  me.        point
+0001c430: 7320 3d20 7064 2e44 6174 6146 7261 6d65  s = pd.DataFrame
+0001c440: 2829 0a20 2020 2020 2020 2070 6f69 6e74  ().        point
+0001c450: 735b 276c 6f6e 275d 203d 206e 6369 642e  s['lon'] = ncid.
+0001c460: 7661 7269 6162 6c65 735b 7365 6c66 2e76  variables[self.v
+0001c470: 6172 5f6c 6f6e 5d5b 3a5d 0a20 2020 2020  ar_lon][:].     
+0001c480: 2020 2070 6f69 6e74 735b 276c 6174 275d     points['lat']
+0001c490: 203d 206e 6369 642e 7661 7269 6162 6c65   = ncid.variable
+0001c4a0: 735b 7365 6c66 2e76 6172 5f6c 6174 5d5b  s[self.var_lat][
+0001c4b0: 3a5d 0a20 2020 2020 2020 2070 6f69 6e74  :].        point
+0001c4c0: 735b 2749 445f 7327 5d20 3d20 3120 2b20  s['ID_s'] = 1 + 
+0001c4d0: 6e70 2e61 7261 6e67 6528 6c65 6e28 706f  np.arange(len(po
+0001c4e0: 696e 7473 2929 0a20 2020 2020 2020 2069  ints)).        i
+0001c4f0: 6620 7365 6c66 2e76 6172 5f49 4420 213d  f self.var_ID !=
+0001c500: 2027 273a 0a20 2020 2020 2020 2020 2020   '':.           
+0001c510: 2070 6f69 6e74 735b 2749 445f 7327 5d20   points['ID_s'] 
+0001c520: 3d20 6e63 6964 2e76 6172 6961 626c 6573  = ncid.variables
+0001c530: 5b73 656c 662e 7661 725f 4944 5d5b 3a5d  [self.var_ID][:]
+0001c540: 0a20 2020 2020 2020 2065 6c73 653a 0a20  .        else:. 
+0001c550: 2020 2020 2020 2020 2020 2070 6f69 6e74             point
+0001c560: 735b 2749 445f 7327 5d20 3d20 3120 2b20  s['ID_s'] = 1 + 
+0001c570: 6e70 2e61 7261 6e67 6528 6c65 6e28 706f  np.arange(len(po
+0001c580: 696e 7473 2929 0a20 2020 2020 2020 2070  ints)).        p
+0001c590: 6f69 6e74 735b 2749 445f 7465 7374 275d  oints['ID_test']
+0001c5a0: 203d 2070 6f69 6e74 735b 2749 445f 7327   = points['ID_s'
+0001c5b0: 5d0a 2020 2020 2020 2020 6966 2073 656c  ].        if sel
+0001c5c0: 662e 7661 725f 7374 6174 696f 6e20 213d  f.var_station !=
+0001c5d0: 2027 273a 0a20 2020 2020 2020 2020 2020   '':.           
+0001c5e0: 2070 6f69 6e74 735b 2773 7461 7469 6f6e   points['station
+0001c5f0: 5f6e 616d 6527 5d20 3d20 6e63 6964 2e76  _name'] = ncid.v
+0001c600: 6172 6961 626c 6573 5b73 656c 662e 7661  ariables[self.va
+0001c610: 725f 7374 6174 696f 6e5d 5b3a 5d0a 2020  r_station][:].  
+0001c620: 2020 2020 2020 2320 6368 6563 6b20 6966        # check if
+0001c630: 2074 776f 2070 6f69 6e74 7320 6661 6c6c   two points fall
+0001c640: 206f 6e20 6561 6368 206f 7468 6572 0a20   on each other. 
+0001c650: 2020 2020 2020 2070 6f69 6e74 7320 3d20         points = 
+0001c660: 706f 696e 7473 2e73 6f72 745f 7661 6c75  points.sort_valu
+0001c670: 6573 2862 793d 5b27 6c61 7427 2c27 6c6f  es(by=['lat','lo
+0001c680: 6e27 5d29 0a20 2020 2020 2020 2070 6f69  n']).        poi
+0001c690: 6e74 735b 276c 6f6e 5f6e 6578 7427 5d20  nts['lon_next'] 
+0001c6a0: 3d20 6e70 2e72 6f6c 6c28 706f 696e 7473  = np.roll(points
+0001c6b0: 5b27 6c6f 6e27 5d2c 3129 0a20 2020 2020  ['lon'],1).     
+0001c6c0: 2020 2070 6f69 6e74 735b 276c 6174 5f6e     points['lat_n
+0001c6d0: 6578 7427 5d20 3d20 6e70 2e72 6f6c 6c28  ext'] = np.roll(
+0001c6e0: 706f 696e 7473 5b27 6c61 7427 5d2c 3129  points['lat'],1)
+0001c6f0: 0a20 2020 2020 2020 2070 6f69 6e74 735b  .        points[
+0001c700: 2749 445f 7465 7374 5f6e 6578 7427 5d20  'ID_test_next'] 
+0001c710: 3d20 6e70 2e72 6f6c 6c28 706f 696e 7473  = np.roll(points
+0001c720: 5b27 4944 5f74 6573 7427 5d2c 2031 290a  ['ID_test'], 1).
+0001c730: 2020 2020 2020 2020 706f 696e 7473 5b27          points['
+0001c740: 6469 7374 616e 6365 275d 203d 206e 702e  distance'] = np.
+0001c750: 706f 7765 7228 706f 696e 7473 5b27 6c6f  power(points['lo
+0001c760: 6e5f 6e65 7874 275d 2d70 6f69 6e74 735b  n_next']-points[
+0001c770: 276c 6f6e 275d 2c20 3229 2b5c 0a20 2020  'lon'], 2)+\.   
+0001c780: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001c790: 2020 2020 2020 2020 2020 6e70 2e70 6f77            np.pow
+0001c7a0: 6572 2870 6f69 6e74 735b 276c 6174 5f6e  er(points['lat_n
+0001c7b0: 6578 7427 5d2d 706f 696e 7473 5b27 6c61  ext']-points['la
+0001c7c0: 7427 5d2c 2032 290a 2020 2020 2020 2020  t'], 2).        
+0001c7d0: 706f 696e 7473 5b27 6469 7374 616e 6365  points['distance
+0001c7e0: 275d 203d 206e 702e 706f 7765 7228 706f  '] = np.power(po
+0001c7f0: 696e 7473 5b27 6469 7374 616e 6365 275d  ints['distance']
+0001c800: 2c20 302e 3529 0a20 2020 2020 2020 2069  , 0.5).        i
+0001c810: 6478 203d 2070 6f69 6e74 732e 696e 6465  dx = points.inde
+0001c820: 785b 706f 696e 7473 5b27 6469 7374 616e  x[points['distan
+0001c830: 6365 275d 3c74 6f6c 6572 616e 6365 5d0a  ce']<tolerance].
+0001c840: 2020 2020 2020 2020 6966 206e 6f74 2028          if not (
+0001c850: 6964 782e 656d 7074 7929 3a0a 2020 2020  idx.empty):.    
+0001c860: 2020 2020 2020 2020 2320 6164 6420 736d          # add sm
+0001c870: 616c 6c20 7661 6c75 6573 2074 6f20 6f76  all values to ov
+0001c880: 6572 636f 6d65 2074 6865 2069 7373 7565  ercome the issue
+0001c890: 206f 6620 6f76 6572 6c61 7070 696e 6720   of overlapping 
+0001c8a0: 706f 696e 7473 0a20 2020 2020 2020 2020  points.         
+0001c8b0: 2020 2070 7269 6e74 2827 4541 5359 4d4f     print('EASYMO
+0001c8c0: 5245 2064 6574 6563 7473 2074 6861 7420  RE detects that 
+0001c8d0: 7468 6520 6c61 7420 6c6f 6e20 7661 6c75  the lat lon valu
+0001c8e0: 6573 2061 7265 2066 6f72 2032 206f 7227  es are for 2 or'
+0001c8f0: 2b5c 0a20 2020 2020 2020 2020 2020 2020  +\.             
+0001c900: 2020 2020 2027 6d6f 7265 2070 6f69 6e74       'more point
+0001c910: 7320 6172 6520 6964 656e 7469 6361 6c20  s are identical 
+0001c920: 6769 7665 6e20 7468 6520 746f 6c65 7261  given the tolera
+0001c930: 6e63 6520 7661 6c75 6573 206f 6620 272c  nce values of ',
+0001c940: 7374 7228 746f 6c65 7261 6e63 6529 290a  str(tolerance)).
+0001c950: 2020 2020 2020 2020 2020 2020 7072 696e              prin
+0001c960: 7428 2749 4420 6f66 2074 686f 7365 2070  t('ID of those p
+0001c970: 6f69 6e74 7320 6172 653a 2729 0a20 2020  oints are:').   
+0001c980: 2020 2020 2020 2020 2070 7269 6e74 2870           print(p
+0001c990: 6f69 6e74 735b 2749 445f 7327 5d2e 6c6f  oints['ID_s'].lo
+0001c9a0: 635b 6964 785d 2e76 616c 7565 7329 0a20  c[idx].values). 
+0001c9b0: 2020 2020 2020 2020 2020 2023 706f 696e             #poin
+0001c9c0: 7473 5b27 6c61 7427 5d2e 6c6f 635b 6964  ts['lat'].loc[id
+0001c9d0: 785d 3d70 6f69 6e74 735b 276c 6174 275d  x]=points['lat']
+0001c9e0: 2e6c 6f63 5b69 6478 5d2b 746f 6c65 7261  .loc[idx]+tolera
+0001c9f0: 6e63 650a 2020 2020 2020 2020 2020 2020  nce.            
+0001ca00: 2370 6f69 6e74 735b 276c 6f6e 275d 2e6c  #points['lon'].l
+0001ca10: 6f63 5b69 6478 5d3d 706f 696e 7473 5b27  oc[idx]=points['
+0001ca20: 6c6f 6e27 5d2e 6c6f 635b 6964 785d 2b74  lon'].loc[idx]+t
+0001ca30: 6f6c 6572 616e 6365 0a20 2020 2020 2020  olerance.       
+0001ca40: 2020 2020 2070 6f69 6e74 732e 6c6f 635b       points.loc[
+0001ca50: 6964 782c 276c 6174 275d 3d70 6f69 6e74  idx,'lat']=point
+0001ca60: 732e 6c6f 635b 6964 782c 276c 6174 275d  s.loc[idx,'lat']
+0001ca70: 2b74 6f6c 6572 616e 6365 0a20 2020 2020  +tolerance.     
+0001ca80: 2020 2020 2020 2070 6f69 6e74 732e 6c6f         points.lo
+0001ca90: 635b 6964 782c 276c 6f6e 275d 3d70 6f69  c[idx,'lon']=poi
+0001caa0: 6e74 732e 6c6f 635b 6964 782c 276c 6f6e  nts.loc[idx,'lon
+0001cab0: 275d 2b74 6f6c 6572 616e 6365 0a20 2020  ']+tolerance.   
+0001cac0: 2020 2020 2070 6f69 6e74 7320 3d20 706f       points = po
+0001cad0: 696e 7473 2e73 6f72 745f 7661 6c75 6573  ints.sort_values
+0001cae0: 2862 793d 2749 445f 7327 290a 2020 2020  (by='ID_s').    
+0001caf0: 2020 2020 706f 696e 7473 2e72 656e 616d      points.renam
+0001cb00: 6528 636f 6c75 6d6e 7320 3d20 7b27 6c61  e(columns = {'la
+0001cb10: 7427 3a27 6c61 745f 7327 2c27 6c6f 6e27  t':'lat_s','lon'
+0001cb20: 3a27 6c6f 6e5f 7327 7d2c 696e 706c 6163  :'lon_s'},inplac
+0001cb30: 653d 5472 7565 290a 2020 2020 2020 2020  e=True).        
+0001cb40: 706f 696e 7473 203d 2070 6f69 6e74 732e  points = points.
+0001cb50: 6472 6f70 2863 6f6c 756d 6e73 3d5b 276c  drop(columns=['l
+0001cb60: 6f6e 5f6e 6578 7427 2c27 6c61 745f 6e65  on_next','lat_ne
+0001cb70: 7874 272c 2749 445f 7465 7374 272c 2749  xt','ID_test','I
+0001cb80: 445f 7465 7374 5f6e 6578 7427 2c27 6469  D_test_next','di
+0001cb90: 7374 616e 6365 275d 290a 2020 2020 2020  stance']).      
+0001cba0: 2020 2320 6d61 6b69 6e67 2070 6f69 6e74    # making point
+0001cbb0: 730a 2020 2020 2020 2020 706f 696e 7473  s.        points
+0001cbc0: 203d 2073 656c 662e 6d61 6b65 5f73 6861   = self.make_sha
+0001cbd0: 7065 5f70 6f69 6e74 2870 6f69 6e74 732c  pe_point(points,
+0001cbe0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0001cbf0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001cc00: 2020 2020 2020 2020 276c 6f6e 5f73 272c          'lon_s',
+0001cc10: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0001cc20: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001cc30: 2020 2020 2020 2020 276c 6174 5f73 272c          'lat_s',
+0001cc40: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0001cc50: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001cc60: 2020 2020 2020 2020 2070 6f69 6e74 5f73           point_s
+0001cc70: 6870 5f66 696c 655f 6e61 6d65 203d 2073  hp_file_name = s
+0001cc80: 7461 7469 6f6e 5f73 6870 5f66 696c 655f  tation_shp_file_
+0001cc90: 6e61 6d65 2c0a 2020 2020 2020 2020 2020  name,.          
+0001cca0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001ccb0: 2020 2020 2020 2020 2020 2020 2020 6372                cr
+0001ccc0: 7320 3d20 6372 7329 0a20 2020 2020 2020  s = crs).       
+0001ccd0: 2023 2063 7265 6174 696e 6720 7468 6520   # creating the 
+0001cce0: 766f 726f 6e6f 6920 6469 6167 7261 6d0a  voronoi diagram.
+0001ccf0: 2020 2020 2020 2020 766f 726f 6e6f 6920          voronoi 
+0001cd00: 3d20 7365 6c66 2e76 6f72 6f6e 6f69 5f64  = self.voronoi_d
+0001cd10: 6961 6772 616d 2870 6f69 6e74 732c 0a20  iagram(points,. 
+0001cd20: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001cd30: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001cd40: 2020 2020 2020 4944 5f66 6965 6c64 5f6e        ID_field_n
+0001cd50: 616d 6520 3d20 2749 445f 7327 2c0a 2020  ame = 'ID_s',.  
+0001cd60: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001cd70: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001cd80: 2020 2020 2076 6f72 6f6e 6f69 5f73 6870       voronoi_shp
+0001cd90: 5f66 696c 655f 6e61 6d65 203d 2076 6f72  _file_name = vor
+0001cda0: 6f6e 6f69 5f73 6870 5f66 696c 655f 6e61  onoi_shp_file_na
+0001cdb0: 6d65 290a 2020 2020 2020 2020 2320 7265  me).        # re
+0001cdc0: 7475 726e 2074 6865 2073 6861 7065 6669  turn the shapefi
+0001cdd0: 6c65 0a20 2020 2020 2020 2072 6574 7572  le.        retur
+0001cde0: 6e20 766f 726f 6e6f 692c 2070 6f69 6e74  n voronoi, point
+0001cdf0: 730a 0a20 2020 2064 6566 2076 6f72 6f6e  s..    def voron
+0001ce00: 6f69 5f64 6961 6772 616d 2873 656c 662c  oi_diagram(self,
+0001ce10: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0001ce20: 2020 2020 2020 2020 2070 6f69 6e74 735f           points_
+0001ce30: 7368 705f 696e 2c0a 2020 2020 2020 2020  shp_in,.        
 0001ce40: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001ce50: 2078 6d61 783d 4e6f 6e65 2c0a 2020 2020   xmax=None,.    
-0001ce60: 2320 2020 2020 2020 2020 2020 2020 2020  #               
-0001ce70: 2020 796d 696e 3d4e 6f6e 652c 0a20 2020    ymin=None,.   
-0001ce80: 2023 2020 2020 2020 2020 2020 2020 2020   #              
-0001ce90: 2020 2079 6d61 783d 4e6f 6e65 293a 0a20     ymax=None):. 
-0001cea0: 2020 2023 2020 2020 2066 726f 6d20 6f73     #     from os
-0001ceb0: 6765 6f20 696d 706f 7274 2067 6461 6c0a  geo import gdal.
-0001cec0: 2020 2020 2320 2020 2020 6262 6f78 203d      #     bbox =
-0001ced0: 2028 786d 696e 2c79 6d69 6e2c 786d 6178   (xmin,ymin,xmax
-0001cee0: 2c79 6d61 7829 0a20 2020 2023 2020 2020  ,ymax).    #    
-0001cef0: 2067 6461 6c2e 5472 616e 736c 6174 6528   gdal.Translate(
-0001cf00: 7261 7374 6572 5f6f 7574 2c20 7261 7374  raster_out, rast
-0001cf10: 6572 5f69 6e2c 2070 726f 6a57 696e 203d  er_in, projWin =
-0001cf20: 2062 626f 7829 0a0a 2020 2020 6465 6620   bbox)..    def 
-0001cf30: 7275 6e5f 7375 6262 6173 696e 5f63 7265  run_subbasin_cre
-0001cf40: 6174 696f 6e28 7365 6c66 2c0a 2020 2020  ation(self,.    
-0001cf50: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001cf60: 2020 2020 2020 2020 2020 6465 6d5f 7469            dem_ti
-0001cf70: 665f 696e 2c0a 2020 2020 2020 2020 2020  f_in,.          
-0001cf80: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001cf90: 2020 2020 706f 7572 5f70 6f69 6e74 203d      pour_point =
-0001cfa0: 2028 2d39 3939 392c 2d39 3939 3929 2c0a   (-9999,-9999),.
-0001cfb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001cfc0: 2020 2020 2020 2020 2020 2020 2020 7269                ri
-0001cfd0: 7665 725f 7468 7220 3d20 3130 3030 302c  ver_thr = 10000,
-0001cfe0: 2023 7374 6172 7469 6e67 2070 6f69 6e74   #starting point
-0001cff0: 2069 6e20 6e75 6d62 6572 206f 6620 6365   in number of ce
-0001d000: 6c6c 7320 696e 740a 2020 2020 2020 2020  lls int.        
-0001d010: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001d020: 2020 2020 2020 6469 725f 7469 665f 696e        dir_tif_in
-0001d030: 203d 204e 6f6e 652c 0a20 2020 2020 2020   = None,.       
-0001d040: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001d050: 2020 2020 2020 2061 6363 5f74 6966 5f69         acc_tif_i
-0001d060: 6e20 3d20 4e6f 6e65 2c0a 2020 2020 2020  n = None,.      
-0001d070: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001d080: 2020 2020 2020 2020 6469 726d 6170 203d          dirmap =
-0001d090: 2028 3634 2c20 2031 3238 2c20 2031 2c20   (64,  128,  1, 
-0001d0a0: 2020 322c 2020 2020 342c 2020 2038 2c20    2,    4,   8, 
-0001d0b0: 2020 2031 362c 2020 3332 2929 3a20 2320     16,  32)): # 
-0001d0c0: 4e2c 204e 452c 2045 2c20 5345 2c20 532c  N, NE, E, SE, S,
-0001d0d0: 2053 572c 2057 2c20 4e57 293a 0a0a 2020   SW, W, NW):..  
-0001d0e0: 2020 2020 2020 2222 220a 2020 2020 2020        """.      
-0001d0f0: 2020 4020 6175 7468 6f72 3a20 2020 2020    @ author:     
-0001d100: 2020 2020 2020 2020 2020 2020 2053 6865               She
-0001d110: 7276 616e 2047 6861 7261 7269 0a20 2020  rvan Gharari.   
-0001d120: 2020 2020 2040 2047 6974 6875 623a 2020       @ Github:  
-0001d130: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001d140: 6874 7470 733a 2f2f 6769 7468 7562 2e63  https://github.c
-0001d150: 6f6d 2f53 6865 7276 616e 4768 6172 6172  om/ShervanGharar
-0001d160: 692f 4541 5359 4d4f 5245 0a20 2020 2020  i/EASYMORE.     
-0001d170: 2020 2040 2061 7574 686f 7227 7320 656d     @ author's em
-0001d180: 6169 6c20 6964 3a20 2020 2020 2020 7368  ail id:       sh
-0001d190: 2e67 6861 7261 7269 4067 6d61 696c 2e63  .gharari@gmail.c
-0001d1a0: 6f6d 0a20 2020 2020 2020 2040 206c 6963  om.        @ lic
-0001d1b0: 656e 7365 3a20 2020 2020 2020 2020 2020  ense:           
-0001d1c0: 2020 2020 2020 474e 552d 4750 4c76 330a        GNU-GPLv3.
-0001d1d0: 2020 2020 2020 2020 5468 6973 2066 756e          This fun
-0001d1e0: 6374 696f 6e73 2072 6563 6976 6573 2061  ctions recives a
-0001d1f0: 2070 6174 6820 746f 2061 2044 454d 2072   path to a DEM r
-0001d200: 6173 7465 7220 6669 6c65 2061 6e64 2063  aster file and c
-0001d210: 7265 6174 6520 7468 6520 666c 6f77 2064  reate the flow d
-0001d220: 6972 6563 7469 6f6e 0a20 2020 2020 2020  irection.       
-0001d230: 206c 6f77 2061 6363 756d 756c 6174 696f   low accumulatio
-0001d240: 6e2c 2072 6976 6572 206e 6574 776f 726b  n, river network
-0001d250: 2061 6e64 2072 6976 6572 206e 6574 776f   and river netwo
-0001d260: 726b 2074 6f70 6f6c 6f67 7920 616e 6420  rk topology and 
-0001d270: 7375 6262 6173 696e 730a 2020 2020 2020  subbasins.      
-0001d280: 2020 4172 6775 6d65 6e74 730a 2020 2020    Arguments.    
-0001d290: 2020 2020 2d2d 2d2d 2d2d 2d2d 2d0a 2020      ---------.  
-0001d2a0: 2020 2020 2020 7261 7374 6572 5f70 6174        raster_pat
-0001d2b0: 685f 696e 3a20 7374 7269 6e67 3b20 7468  h_in: string; th
-0001d2c0: 6520 7061 7468 2074 6f20 7468 6520 696e  e path to the in
-0001d2d0: 7075 7420 7261 7374 6572 2c20 4445 4d20  put raster, DEM 
-0001d2e0: 6765 6f74 6966 0a20 2020 2020 2020 2070  geotif.        p
-0001d2f0: 6f75 725f 706f 696e 743a 2028 782c 2079  our_point: (x, y
-0001d300: 292c 206c 6f63 6174 696f 6e20 6f66 2074  ), location of t
-0001d310: 6865 206f 7574 6c65 7420 6f66 2074 6865  he outlet of the
-0001d320: 2062 6173 696e 0a20 2020 2020 2020 2072   basin.        r
-0001d330: 6976 6572 5f74 6872 3a20 696e 742c 206e  iver_thr: int, n
-0001d340: 756d 6265 7220 6f66 2063 656c 6c73 2061  umber of cells a
-0001d350: 6363 756d 756c 6174 696f 6e20 7468 6174  ccumulation that
-0001d360: 2072 6976 6572 2073 7461 7274 0a20 2020   river start.   
-0001d370: 2020 2020 2064 6972 5f74 6966 5f69 6e3a       dir_tif_in:
-0001d380: 2073 7472 696e 673b 2074 6865 2070 6174   string; the pat
-0001d390: 6820 746f 2074 6865 2064 6972 6563 7469  h to the directi
-0001d3a0: 6f6e 2072 6173 7465 720a 2020 2020 2020  on raster.      
-0001d3b0: 2020 6163 635f 7469 665f 696e 3a20 7374    acc_tif_in: st
-0001d3c0: 7269 6e67 3b20 7468 6520 7061 7468 2074  ring; the path t
-0001d3d0: 6f20 7468 6520 6163 6375 6d75 6c61 7469  o the accumulati
-0001d3e0: 6f6e 2072 6173 7465 720a 2020 2020 2020  on raster.      
-0001d3f0: 2020 6469 726d 6170 3a20 7368 6f77 696e    dirmap: showin
-0001d400: 6720 7468 6520 6469 7265 6374 696f 6e20  g the direction 
-0001d410: 6f66 2074 6865 2076 616c 7565 7320 696e  of the values in
-0001d420: 2074 6865 2064 6972 206d 6170 2069 6620   the dir map if 
-0001d430: 6469 7265 6374 696f 6e20 6973 2070 726f  direction is pro
-0001d440: 7669 6465 640a 2020 2020 2020 2020 2222  vided.        ""
-0001d450: 220a 2020 2020 2020 2020 696d 706f 7274  ".        import
-0001d460: 2067 656f 7061 6e64 6173 2061 7320 6770   geopandas as gp
-0001d470: 640a 2020 2020 2020 2020 696d 706f 7274  d.        import
-0001d480: 206e 756d 7079 2061 7320 6e70 0a20 2020   numpy as np.   
-0001d490: 2020 2020 2069 6d70 6f72 7420 7061 6e64       import pand
-0001d4a0: 6173 2061 7320 7064 0a20 2020 2020 2020  as as pd.       
-0001d4b0: 2066 726f 6d20 7079 7368 6564 732e 6772   from pysheds.gr
-0001d4c0: 6964 2069 6d70 6f72 7420 4772 6964 0a20  id import Grid. 
-0001d4d0: 2020 2020 2020 2069 6d70 6f72 7420 6f73         import os
-0001d4e0: 0a20 2020 2020 2020 2067 7269 6420 3d20  .        grid = 
-0001d4f0: 4772 6964 2e66 726f 6d5f 7261 7374 6572  Grid.from_raster
-0001d500: 2864 656d 5f74 6966 5f69 6e2c 2064 6174  (dem_tif_in, dat
-0001d510: 615f 6e61 6d65 3d27 6465 6d27 290a 2020  a_name='dem').  
-0001d520: 2020 2020 2020 6372 7320 3d20 7374 7228        crs = str(
-0001d530: 6772 6964 2e63 7273 290a 2020 2020 2020  grid.crs).      
-0001d540: 2020 6966 2027 7767 7338 3427 2069 6e20    if 'wgs84' in 
-0001d550: 6372 732e 6c6f 7765 7228 293a 0a20 2020  crs.lower():.   
-0001d560: 2020 2020 2020 2020 2070 7269 6e74 2827           print('
-0001d570: 4541 5359 4d4f 5245 2064 6574 6563 7420  EASYMORE detect 
-0001d580: 7468 6520 7469 6620 6669 6c65 2069 7320  the tif file is 
-0001d590: 7072 6f6a 6563 7465 6420 696e 2057 4753  projected in WGS
-0001d5a0: 3834 2729 0a20 2020 2020 2020 2065 6c73  84').        els
-0001d5b0: 653a 0a20 2020 2020 2020 2020 2020 2073  e:.            s
-0001d5c0: 7973 2e65 7869 7428 2774 6865 2070 726f  ys.exit('the pro
-0001d5d0: 7669 6465 6420 4445 4d20 7368 6f75 6c64  vided DEM should
-0001d5e0: 2062 6520 696e 2057 4753 3834 2729 0a20   be in WGS84'). 
-0001d5f0: 2020 2020 2020 2067 7269 645f 7369 7a65         grid_size
-0001d600: 203d 2067 7269 642e 6365 6c6c 7369 7a65   = grid.cellsize
-0001d610: 0a20 2020 2020 2020 2069 6620 6e6f 7420  .        if not 
-0001d620: 6f73 2e70 6174 682e 6973 6469 7228 7365  os.path.isdir(se
-0001d630: 6c66 2e74 656d 705f 6469 7229 3a0a 2020  lf.temp_dir):.  
-0001d640: 2020 2020 2020 2020 2020 6f73 2e6d 6b64            os.mkd
-0001d650: 6972 2873 656c 662e 7465 6d70 5f64 6972  ir(self.temp_dir
-0001d660: 290a 2020 2020 2020 2020 6966 206e 6f74  ).        if not
-0001d670: 206f 732e 7061 7468 2e69 7364 6972 2873   os.path.isdir(s
-0001d680: 656c 662e 6f75 7470 7574 5f64 6972 293a  elf.output_dir):
-0001d690: 0a20 2020 2020 2020 2020 2020 206f 732e  .            os.
-0001d6a0: 6d6b 6469 7228 7365 6c66 2e6f 7574 7075  mkdir(self.outpu
-0001d6b0: 745f 6469 7229 0a20 2020 2020 2020 2069  t_dir).        i
-0001d6c0: 6620 6469 725f 7469 665f 696e 3a0a 2020  f dir_tif_in:.  
-0001d6d0: 2020 2020 2020 2020 2020 7072 696e 7428            print(
-0001d6e0: 2770 726f 7669 6469 6e67 2074 6865 2061  'providing the a
-0001d6f0: 6363 5f74 6966 5f69 6e20 6973 206e 6f74  cc_tif_in is not
-0001d700: 2079 6574 2073 7570 706f 7274 6564 2c20   yet supported, 
-0001d710: 4541 5359 4d4f 5245 2077 6974 6820 6361  EASYMORE with ca
-0001d720: 6c63 756c 6174 6520 6469 7265 6374 696f  lculate directio
-0001d730: 6e20 696e 7465 726e 616c 6c79 2729 0a20  n internally'). 
-0001d740: 2020 2020 2020 2020 2020 2070 7269 6e74             print
-0001d750: 2827 4541 5359 4d4f 5245 2073 6574 2064  ('EASYMORE set d
-0001d760: 6972 5f74 6966 5f69 6e20 746f 204e 6f6e  ir_tif_in to Non
-0001d770: 6527 290a 2020 2020 2020 2020 2020 2020  e').            
-0001d780: 6469 725f 7469 665f 696e 203d 204e 6f6e  dir_tif_in = Non
-0001d790: 650a 2020 2020 2020 2020 6966 2061 6363  e.        if acc
-0001d7a0: 5f74 6966 5f69 6e3a 0a20 2020 2020 2020  _tif_in:.       
-0001d7b0: 2020 2020 2070 7269 6e74 2827 7072 6f76       print('prov
-0001d7c0: 6964 696e 6720 7468 6520 6163 635f 7469  iding the acc_ti
-0001d7d0: 665f 696e 2069 7320 6e6f 7420 7965 7420  f_in is not yet 
-0001d7e0: 7375 7070 6f72 7465 642c 2045 4153 594d  supported, EASYM
-0001d7f0: 4f52 4520 7769 7468 2063 616c 6375 6c61  ORE with calcula
-0001d800: 7465 2061 6363 756d 756c 6174 696f 6e20  te accumulation 
-0001d810: 696e 7465 726e 616c 6c79 2729 0a20 2020  internally').   
-0001d820: 2020 2020 2020 2020 2070 7269 6e74 2827           print('
-0001d830: 4541 5359 4d4f 5245 2073 6574 2061 6363  EASYMORE set acc
-0001d840: 5f74 6966 5f69 6e20 746f 204e 6f6e 6527  _tif_in to None'
-0001d850: 290a 2020 2020 2020 2020 2020 2020 6163  ).            ac
-0001d860: 635f 7469 665f 696e 203d 204e 6f6e 650a  c_tif_in = None.
-0001d870: 2020 2020 2020 2020 7365 6c66 2e64 656d          self.dem
-0001d880: 5f70 726f 6365 7373 696e 6720 2864 656d  _processing (dem
-0001d890: 5f74 6966 5f69 6e2c 0a20 2020 2020 2020  _tif_in,.       
-0001d8a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001d8b0: 2020 2020 2020 6469 725f 7469 665f 696e        dir_tif_in
-0001d8c0: 203d 204e 6f6e 652c 0a20 2020 2020 2020   = None,.       
-0001d8d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001d8e0: 2020 2020 2020 6163 635f 7469 665f 696e        acc_tif_in
-0001d8f0: 203d 204e 6f6e 652c 0a20 2020 2020 2020   = None,.       
-0001d900: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001d910: 2020 2020 2020 6469 726d 6170 203d 2064        dirmap = d
-0001d920: 6972 6d61 7029 0a20 2020 2020 2020 2073  irmap).        s
-0001d930: 656c 662e 7269 7665 7220 2873 656c 662e  elf.river (self.
-0001d940: 7465 6d70 5f64 6972 2b73 656c 662e 6361  temp_dir+self.ca
-0001d950: 7365 5f6e 616d 652b 275f 6469 722e 7469  se_name+'_dir.ti
-0001d960: 6627 2c0a 2020 2020 2020 2020 2020 2020  f',.            
-0001d970: 2020 2020 2020 2020 7365 6c66 2e74 656d          self.tem
-0001d980: 705f 6469 722b 7365 6c66 2e63 6173 655f  p_dir+self.case_
-0001d990: 6e61 6d65 2b27 5f61 6363 2e74 6966 272c  name+'_acc.tif',
-0001d9a0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0001d9b0: 2020 2020 2073 656c 662e 7465 6d70 5f64       self.temp_d
-0001d9c0: 6972 2b73 656c 662e 6361 7365 5f6e 616d  ir+self.case_nam
-0001d9d0: 652b 275f 7269 7665 722e 7368 7027 2c0a  e+'_river.shp',.
-0001d9e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001d9f0: 2020 2020 6469 726d 6170 203d 2064 6972      dirmap = dir
-0001da00: 6d61 702c 0a20 2020 2020 2020 2020 2020  map,.           
-0001da10: 2020 2020 2020 2020 2070 6f75 725f 706f           pour_po
-0001da20: 696e 7420 3d20 706f 7572 5f70 6f69 6e74  int = pour_point
-0001da30: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
-0001da40: 2020 2020 2020 736e 6170 5f70 6f75 725f        snap_pour_
-0001da50: 706f 696e 7420 3d20 3130 302c 0a20 2020  point = 100,.   
-0001da60: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001da70: 2072 6976 6572 5f74 6872 203d 2072 6976   river_thr = riv
-0001da80: 6572 5f74 6872 290a 2020 2020 2020 2020  er_thr).        
-0001da90: 7365 6c66 2e72 6976 6572 5f6e 6574 776f  self.river_netwo
-0001daa0: 726b 2820 7365 6c66 2e74 656d 705f 6469  rk( self.temp_di
-0001dab0: 722b 7365 6c66 2e63 6173 655f 6e61 6d65  r+self.case_name
-0001dac0: 2b27 5f72 6976 6572 2e73 6870 272c 0a20  +'_river.shp',. 
-0001dad0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001dae0: 2020 2020 2020 2020 2020 2073 656c 662e             self.
-0001daf0: 7465 6d70 5f64 6972 2b73 656c 662e 6361  temp_dir+self.ca
-0001db00: 7365 5f6e 616d 652b 275f 7269 7665 725f  se_name+'_river_
-0001db10: 4e54 4f50 4f2e 7368 7027 2c0a 2020 2020  NTOPO.shp',.    
-0001db20: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001db30: 2020 2020 2020 2020 6465 6d5f 7469 665f          dem_tif_
-0001db40: 696e 203d 2064 656d 5f74 6966 5f69 6e2c  in = dem_tif_in,
-0001db50: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0001db60: 2020 2020 2020 2020 2020 2020 2061 6363               acc
-0001db70: 5f74 6966 5f69 6e20 3d20 7365 6c66 2e74  _tif_in = self.t
-0001db80: 656d 705f 6469 722b 7365 6c66 2e63 6173  emp_dir+self.cas
-0001db90: 655f 6e61 6d65 2b27 5f61 6363 2e74 6966  e_name+'_acc.tif
-0001dba0: 272c 0a20 2020 2020 2020 2020 2020 2020  ',.             
-0001dbb0: 2020 2020 2020 2020 2020 2020 2020 2067                 g
-0001dbc0: 7269 645f 7369 7a65 203d 2067 7269 645f  rid_size = grid_
-0001dbd0: 7369 7a65 290a 2020 2020 2020 2020 2320  size).        # 
-0001dbe0: 6361 6c63 756c 6174 6520 6c65 6e67 7468  calculate length
-0001dbf0: 206f 6620 7269 7665 7220 7365 676d 656e   of river segmen
-0001dc00: 7473 0a20 2020 2020 2020 2073 6870 203d  ts.        shp =
-0001dc10: 2067 7064 2e72 6561 645f 6669 6c65 2873   gpd.read_file(s
-0001dc20: 656c 662e 7465 6d70 5f64 6972 2b73 656c  elf.temp_dir+sel
-0001dc30: 662e 6361 7365 5f6e 616d 652b 275f 7269  f.case_name+'_ri
-0001dc40: 7665 725f 4e54 4f50 4f2e 7368 7027 290a  ver_NTOPO.shp').
-0001dc50: 2020 2020 2020 2020 7368 705f 7420 3d20          shp_t = 
-0001dc60: 7368 702e 746f 5f63 7273 2028 2245 5053  shp.to_crs ("EPS
-0001dc70: 473a 3639 3333 2229 0a20 2020 2020 2020  G:6933").       
-0001dc80: 2073 6870 5b27 6c65 6e67 7468 275d 203d   shp['length'] =
-0001dc90: 2073 6870 5f74 2e67 656f 6d65 7472 792e   shp_t.geometry.
-0001dca0: 6c65 6e67 7468 0a20 2020 2020 2020 2073  length.        s
-0001dcb0: 6870 2e74 6f5f 6669 6c65 2873 656c 662e  hp.to_file(self.
-0001dcc0: 7465 6d70 5f64 6972 2b73 656c 662e 6361  temp_dir+self.ca
-0001dcd0: 7365 5f6e 616d 652b 275f 7269 7665 725f  se_name+'_river_
-0001dce0: 4e54 4f50 4f2e 7368 7027 290a 2020 2020  NTOPO.shp').    
-0001dcf0: 2020 2020 2320 6372 6561 7465 2074 6865      # create the
-0001dd00: 2076 6972 7475 616c 2067 6175 6765 7320   virtual gauges 
-0001dd10: 6672 6f6d 2074 6865 2073 6870 0a20 2020  from the shp.   
-0001dd20: 2020 2020 2064 665f 6761 7567 6520 3d20       df_gauge = 
-0001dd30: 7064 2e44 6174 6146 7261 6d65 2829 0a20  pd.DataFrame(). 
-0001dd40: 2020 2020 2020 2064 665f 6761 7567 6520         df_gauge 
-0001dd50: 5b27 6c61 7427 5d20 3d20 7368 705b 2765  ['lat'] = shp['e
-0001dd60: 6e64 5f6c 6174 5f62 275d 2e61 7374 7970  nd_lat_b'].astyp
-0001dd70: 6528 666c 6f61 7429 0a20 2020 2020 2020  e(float).       
-0001dd80: 2064 665f 6761 7567 6520 5b27 6c6f 6e27   df_gauge ['lon'
-0001dd90: 5d20 3d20 7368 705b 2765 6e64 5f6c 6f6e  ] = shp['end_lon
-0001dda0: 5f62 275d 2e61 7374 7970 6528 666c 6f61  _b'].astype(floa
-0001ddb0: 7429 0a20 2020 2020 2020 2064 665f 6761  t).        df_ga
-0001ddc0: 7567 6520 5b27 4944 275d 203d 2073 6870  uge ['ID'] = shp
-0001ddd0: 5b27 4944 275d 2e61 7374 7970 6528 666c  ['ID'].astype(fl
-0001dde0: 6f61 7429 0a20 2020 2020 2020 2076 6972  oat).        vir
-0001ddf0: 7475 616c 5f67 6175 6765 7320 3d20 7365  tual_gauges = se
-0001de00: 6c66 2e6d 616b 655f 7368 6170 655f 706f  lf.make_shape_po
-0001de10: 696e 7428 6466 5f67 6175 6765 2c20 276c  int(df_gauge, 'l
-0001de20: 6f6e 272c 2027 6c61 7427 290a 2020 2020  on', 'lat').    
-0001de30: 2020 2020 7669 7274 7561 6c5f 6761 7567      virtual_gaug
-0001de40: 6573 2e74 6f5f 6669 6c65 2873 656c 662e  es.to_file(self.
-0001de50: 7465 6d70 5f64 6972 2b73 656c 662e 6361  temp_dir+self.ca
-0001de60: 7365 5f6e 616d 652b 275f 7669 7274 7561  se_name+'_virtua
-0001de70: 6c5f 6761 7567 6573 2e73 6870 2729 0a20  l_gauges.shp'). 
-0001de80: 2020 2020 2020 2073 656c 662e 7375 6262         self.subb
-0001de90: 6173 696e 5f63 7265 6174 696f 6e28 2020  asin_creation(  
-0001dea0: 7365 6c66 2e74 656d 705f 6469 722b 7365  self.temp_dir+se
-0001deb0: 6c66 2e63 6173 655f 6e61 6d65 2b27 5f64  lf.case_name+'_d
-0001dec0: 6972 2e74 6966 272c 0a20 2020 2020 2020  ir.tif',.       
-0001ded0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001dee0: 2020 2020 2020 2020 2020 7365 6c66 2e74            self.t
-0001def0: 656d 705f 6469 722b 7365 6c66 2e63 6173  emp_dir+self.cas
-0001df00: 655f 6e61 6d65 2b27 5f76 6972 7475 616c  e_name+'_virtual
-0001df10: 5f67 6175 6765 732e 7368 7027 2c0a 2020  _gauges.shp',.  
-0001df20: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001df30: 2020 2020 2020 2020 2020 2020 2020 2073                 s
-0001df40: 656c 662e 7465 6d70 5f64 6972 2b73 656c  elf.temp_dir+sel
-0001df50: 662e 6361 7365 5f6e 616d 652b 275f 7375  f.case_name+'_su
-0001df60: 6262 6173 696e 2e74 6966 2729 0a20 2020  bbasin.tif').   
-0001df70: 2020 2020 2073 656c 662e 6765 6f74 6966       self.geotif
-0001df80: 3273 6870 2820 2020 7365 6c66 2e74 656d  2shp(   self.tem
-0001df90: 705f 6469 722b 7365 6c66 2e63 6173 655f  p_dir+self.case_
-0001dfa0: 6e61 6d65 2b27 5f73 7562 6261 7369 6e2e  name+'_subbasin.
-0001dfb0: 7469 6627 2c0a 2020 2020 2020 2020 2020  tif',.          
-0001dfc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001dfd0: 2073 656c 662e 7465 6d70 5f64 6972 2b73   self.temp_dir+s
-0001dfe0: 656c 662e 6361 7365 5f6e 616d 652b 275f  elf.case_name+'_
-0001dff0: 7375 6262 6173 696e 2e73 6870 272c 0a20  subbasin.shp',. 
-0001e000: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001e010: 2020 2020 2020 2020 2020 7261 7374 6572            raster
-0001e020: 5f62 616e 6420 3d20 312c 0a20 2020 2020  _band = 1,.     
-0001e030: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001e040: 2020 2020 2020 6e61 6d65 5f6f 665f 6669        name_of_fi
-0001e050: 6c65 6420 3d20 2749 4427 2c0a 2020 2020  led = 'ID',.    
-0001e060: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001e070: 2020 2020 2020 2064 6973 736f 6c76 6520         dissolve 
-0001e080: 3d20 5472 7565 290a 2020 2020 2020 2020  = True).        
-0001e090: 7368 7020 3d20 6770 642e 7265 6164 5f66  shp = gpd.read_f
-0001e0a0: 696c 6528 7365 6c66 2e74 656d 705f 6469  ile(self.temp_di
-0001e0b0: 722b 7365 6c66 2e63 6173 655f 6e61 6d65  r+self.case_name
-0001e0c0: 2b27 5f73 7562 6261 7369 6e2e 7368 7027  +'_subbasin.shp'
-0001e0d0: 290a 2020 2020 2020 2020 7368 7020 3d20  ).        shp = 
-0001e0e0: 7368 7020 5b73 6870 5b27 4944 275d 213d  shp [shp['ID']!=
-0001e0f0: 305d 2023 2072 656d 6f76 6520 7468 6520  0] # remove the 
-0001e100: 7375 6262 6173 696e 2049 4420 6f66 207a  subbasin ID of z
-0001e110: 6572 6f0a 2020 2020 2020 2020 7368 705f  ero.        shp_
-0001e120: 7420 3d20 7368 702e 746f 5f63 7273 2822  t = shp.to_crs("
-0001e130: 4550 5347 3a36 3933 3322 290a 2020 2020  EPSG:6933").    
-0001e140: 2020 2020 7368 7020 5b27 4172 6561 5b6d      shp ['Area[m
-0001e150: 325d 275d 203d 2073 6870 5f74 2e61 7265  2]'] = shp_t.are
-0001e160: 610a 2020 2020 2020 2020 7368 702e 746f  a.        shp.to
-0001e170: 5f66 696c 6528 7365 6c66 2e6f 7574 7075  _file(self.outpu
-0001e180: 745f 6469 722b 7365 6c66 2e63 6173 655f  t_dir+self.case_
-0001e190: 6e61 6d65 2b27 5f73 7562 6261 7369 6e2e  name+'_subbasin.
-0001e1a0: 7368 7027 290a 2020 2020 2020 2020 2320  shp').        # 
-0001e1b0: 7570 7374 7265 616d 2061 7265 610a 2020  upstream area.  
-0001e1c0: 2020 2020 2020 6361 7420 3d20 6770 642e        cat = gpd.
-0001e1d0: 7265 6164 5f66 696c 6528 7365 6c66 2e6f  read_file(self.o
-0001e1e0: 7574 7075 745f 6469 722b 7365 6c66 2e63  utput_dir+self.c
-0001e1f0: 6173 655f 6e61 6d65 2b27 5f73 7562 6261  ase_name+'_subba
-0001e200: 7369 6e2e 7368 7027 290a 2020 2020 2020  sin.shp').      
-0001e210: 2020 6361 7420 3d20 6361 742e 736f 7274    cat = cat.sort
-0001e220: 5f76 616c 7565 7328 6279 3d27 4944 2729  _values(by='ID')
-0001e230: 0a20 2020 2020 2020 2063 6174 203d 2063  .        cat = c
-0001e240: 6174 2e72 6573 6574 5f69 6e64 6578 2864  at.reset_index(d
-0001e250: 726f 703d 5472 7565 290a 2020 2020 2020  rop=True).      
-0001e260: 2020 7269 7665 7220 3d20 6770 642e 7265    river = gpd.re
-0001e270: 6164 5f66 696c 6528 7365 6c66 2e74 656d  ad_file(self.tem
-0001e280: 705f 6469 722b 7365 6c66 2e63 6173 655f  p_dir+self.case_
-0001e290: 6e61 6d65 2b27 5f72 6976 6572 5f4e 544f  name+'_river_NTO
-0001e2a0: 504f 2e73 6870 2729 0a20 2020 2020 2020  PO.shp').       
-0001e2b0: 2072 6976 6572 203d 2072 6976 6572 2e73   river = river.s
-0001e2c0: 6f72 745f 7661 6c75 6573 2862 793d 2749  ort_values(by='I
-0001e2d0: 4427 290a 2020 2020 2020 2020 7269 7665  D').        rive
-0001e2e0: 7220 3d20 7269 7665 722e 7265 7365 745f  r = river.reset_
-0001e2f0: 696e 6465 7828 6472 6f70 3d54 7275 6529  index(drop=True)
-0001e300: 0a20 2020 2020 2020 204e 544f 504f 203d  .        NTOPO =
-0001e310: 2073 656c 662e 6765 745f 616c 6c5f 646f   self.get_all_do
-0001e320: 776e 7374 7265 616d 2028 7269 7665 722e  wnstream (river.
-0001e330: 4944 2c72 6976 6572 2e44 6f77 6e5f 4944  ID,river.Down_ID
-0001e340: 290a 2020 2020 2020 2020 2320 6c6f 6f70  ).        # loop
-0001e350: 206f 7665 7220 7468 6520 7365 6765 6d65   over the segeme
-0001e360: 7473 2061 6e64 2067 6574 2074 6865 2075  ts and get the u
-0001e370: 7073 7472 6561 6d0a 2020 2020 2020 2020  pstream.        
-0001e380: 4172 6561 5f75 7020 3d20 6e70 2e7a 6572  Area_up = np.zer
-0001e390: 6f73 285b 6c65 6e28 6361 7429 5d29 0a20  os([len(cat)]). 
-0001e3a0: 2020 2020 2020 206d 203d 2030 0a20 2020         m = 0.   
-0001e3b0: 2020 2020 2066 6f72 2069 6e64 6578 2c20       for index, 
-0001e3c0: 726f 7720 696e 2063 6174 2e69 7465 7272  row in cat.iterr
-0001e3d0: 6f77 7328 293a 0a20 2020 2020 2020 2020  ows():.         
-0001e3e0: 2020 2075 7073 7472 6561 6d73 203d 2073     upstreams = s
-0001e3f0: 656c 662e 6765 745f 616c 6c5f 7570 7374  elf.get_all_upst
-0001e400: 7265 616d 2872 6f77 2e49 442c 4e54 4f50  ream(row.ID,NTOP
-0001e410: 4f29 0a20 2020 2020 2020 2020 2020 2063  O).            c
-0001e420: 6174 5f74 203d 2063 6174 205b 6361 745b  at_t = cat [cat[
-0001e430: 2749 4427 5d2e 6973 696e 2875 7073 7472  'ID'].isin(upstr
-0001e440: 6561 6d73 295d 0a20 2020 2020 2020 2020  eams)].         
-0001e450: 2020 2041 7265 615f 7570 205b 6d5d 203d     Area_up [m] =
-0001e460: 2063 6174 5f74 5b27 4172 6561 5b6d 325d   cat_t['Area[m2]
-0001e470: 275d 2e73 756d 2829 0a20 2020 2020 2020  '].sum().       
-0001e480: 2020 2020 206d 202b 3d20 310a 2020 2020       m += 1.    
-0001e490: 2020 2020 7269 7665 7220 5b27 4172 6561      river ['Area
-0001e4a0: 5f75 7027 5d20 3d20 4172 6561 5f75 700a  _up'] = Area_up.
-0001e4b0: 2020 2020 2020 2020 7269 7665 7220 5b27          river ['
-0001e4c0: 4172 6561 5b6d 325d 275d 203d 2063 6174  Area[m2]'] = cat
-0001e4d0: 5b27 4172 6561 5b6d 325d 275d 0a20 2020  ['Area[m2]'].   
-0001e4e0: 2020 2020 2072 6976 6572 2e74 6f5f 6669       river.to_fi
-0001e4f0: 6c65 2873 656c 662e 6f75 7470 7574 5f64  le(self.output_d
-0001e500: 6972 2b73 656c 662e 6361 7365 5f6e 616d  ir+self.case_nam
-0001e510: 652b 275f 7269 7665 725f 4e54 4f50 4f2e  e+'_river_NTOPO.
-0001e520: 7368 7027 290a 0a20 2020 2064 6566 2064  shp')..    def d
-0001e530: 656d 5f70 726f 6365 7373 696e 6720 2873  em_processing (s
-0001e540: 656c 662c 0a20 2020 2020 2020 2020 2020  elf,.           
-0001e550: 2020 2020 2020 2020 2020 2020 2064 656d               dem
-0001e560: 5f74 6966 5f69 6e2c 0a20 2020 2020 2020  _tif_in,.       
-0001e570: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001e580: 2064 6972 5f74 6966 5f69 6e20 3d20 4e6f   dir_tif_in = No
-0001e590: 6e65 2c20 2354 4f44 4f3a 2069 6e63 6c75  ne, #TODO: inclu
-0001e5a0: 6465 2069 6620 7573 6572 2067 6976 6520  de if user give 
-0001e5b0: 6469 725f 7469 665f 696e 0a20 2020 2020  dir_tif_in.     
-0001e5c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001e5d0: 2020 2061 6363 5f74 6966 5f69 6e20 3d20     acc_tif_in = 
-0001e5e0: 4e6f 6e65 2c20 2354 4f44 4f3a 2069 6e63  None, #TODO: inc
-0001e5f0: 6c75 6465 2069 6620 7573 6572 2067 6976  lude if user giv
-0001e600: 6520 6163 635f 7469 665f 696e 0a20 2020  e acc_tif_in.   
-0001e610: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001e620: 2020 2020 2064 6972 6d61 7020 3d20 2836       dirmap = (6
-0001e630: 342c 2020 3132 382c 2020 312c 2020 2032  4,  128,  1,   2
-0001e640: 2c20 2020 2034 2c20 2020 382c 2020 2020  ,    4,   8,    
-0001e650: 3136 2c20 2033 3229 293a 2023 204e 2c20  16,  32)): # N, 
-0001e660: 4e45 2c20 452c 2053 452c 2053 2c20 5357  NE, E, SE, S, SW
-0001e670: 2c20 572c 204e 570a 2020 2020 2020 2020  , W, NW.        
-0001e680: 2222 220a 2020 2020 2020 2020 6f72 6967  """.        orig
-0001e690: 696e 616c 2063 6f64 6520 6279 3a0a 2020  inal code by:.  
-0001e6a0: 2020 2020 2020 7079 7368 6564 7320 6465        pysheds de
-0001e6b0: 7665 6c6f 7065 7220 7465 616d 0a20 2020  veloper team.   
-0001e6c0: 2020 2020 2068 7474 7073 3a2f 2f67 6974       https://git
-0001e6d0: 6875 622e 636f 6d2f 6d64 6261 7274 6f73  hub.com/mdbartos
-0001e6e0: 2f70 7973 6865 6473 0a20 2020 2020 2020  /pysheds.       
-0001e6f0: 206d 6f64 6966 6965 6420 6279 3a0a 2020   modified by:.  
-0001e700: 2020 2020 2020 4020 6175 7468 6f72 3a20        @ author: 
-0001e710: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001e720: 2053 6865 7276 616e 2047 6861 7261 7269   Shervan Gharari
-0001e730: 0a20 2020 2020 2020 2040 2047 6974 6875  .        @ Githu
-0001e740: 623a 2020 2020 2020 2020 2020 2020 2020  b:              
-0001e750: 2020 2020 6874 7470 733a 2f2f 6769 7468      https://gith
-0001e760: 7562 2e63 6f6d 2f53 6865 7276 616e 4768  ub.com/ShervanGh
-0001e770: 6172 6172 692f 4541 5359 4d4f 5245 0a20  arari/EASYMORE. 
-0001e780: 2020 2020 2020 2040 2061 7574 686f 7227         @ author'
-0001e790: 7320 656d 6169 6c20 6964 3a20 2020 2020  s email id:     
-0001e7a0: 2020 7368 2e67 6861 7261 7269 4067 6d61    sh.gharari@gma
-0001e7b0: 696c 2e63 6f6d 0a20 2020 2020 2020 2040  il.com.        @
-0001e7c0: 206c 6963 656e 7365 3a20 2020 2020 2020   license:       
-0001e7d0: 2020 2020 2020 2020 2020 474e 552d 4750            GNU-GP
-0001e7e0: 4c76 330a 2020 2020 2020 2020 5468 6973  Lv3.        This
-0001e7f0: 2066 756e 6374 696f 6e20 7265 6164 7320   function reads 
-0001e800: 6120 6465 6d20 286f 7220 616c 736f 2061  a dem (or also a
-0001e810: 2064 6972 6563 7469 6f6e 2066 696c 6520   direction file 
-0001e820: 616e 6420 6d61 7029 2061 6e64 2067 656e  and map) and gen
-0001e830: 6572 6174 6520 7468 6520 6469 7220 6669  erate the dir fi
-0001e840: 6c65 2c20 616e 6420 666c 6f77 2061 6363  le, and flow acc
-0001e850: 756d 7561 6c74 696f 6e0a 2020 2020 2020  umualtion.      
-0001e860: 2020 2d2d 2d2d 2d2d 2d2d 2d0a 2020 2020    ---------.    
-0001e870: 2020 2020 6465 6d5f 7469 665f 696e 3a20      dem_tif_in: 
-0001e880: 7374 7269 6e67 3b20 7468 6520 7061 7468  string; the path
-0001e890: 2074 6f20 7468 6520 696e 7075 7420 7261   to the input ra
-0001e8a0: 7374 6572 0a20 2020 2020 2020 2064 6972  ster.        dir
-0001e8b0: 5f74 6966 5f69 6e3a 2073 7472 696e 673b  _tif_in: string;
-0001e8c0: 2074 6865 2070 6174 6820 746f 2074 6865   the path to the
-0001e8d0: 2064 6972 6563 7469 6f6e 2072 6173 7465   direction raste
-0001e8e0: 720a 2020 2020 2020 2020 6163 635f 7469  r.        acc_ti
-0001e8f0: 665f 696e 3a20 7374 7269 6e67 3b20 7468  f_in: string; th
-0001e900: 6520 7061 7468 2074 6f20 7468 6520 6163  e path to the ac
-0001e910: 6375 6d75 6c61 7469 6f6e 2072 6173 7465  cumulation raste
-0001e920: 720a 2020 2020 2020 2020 6469 726d 6170  r.        dirmap
-0001e930: 3a20 7368 6f77 696e 6720 7468 6520 6469  : showing the di
-0001e940: 7265 6374 696f 6e20 6f66 2074 6865 2076  rection of the v
-0001e950: 616c 7565 7320 696e 2074 6865 2064 6972  alues in the dir
-0001e960: 206d 6170 2069 6620 6469 7265 6374 696f   map if directio
-0001e970: 6e20 6973 2070 726f 7669 6465 640a 2020  n is provided.  
-0001e980: 2020 2020 2020 2222 220a 2020 2020 2020        """.      
-0001e990: 2020 6672 6f6d 2070 7973 6865 6473 2e67    from pysheds.g
-0001e9a0: 7269 6420 696d 706f 7274 2047 7269 640a  rid import Grid.
-0001e9b0: 2020 2020 2020 2020 696d 706f 7274 2067          import g
-0001e9c0: 656f 7061 6e64 6173 2061 7320 6770 640a  eopandas as gpd.
-0001e9d0: 2020 2020 2020 2020 696d 706f 7274 206e          import n
-0001e9e0: 756d 7079 2061 7320 6e70 0a20 2020 2020  umpy as np.     
-0001e9f0: 2020 2069 6d70 6f72 7420 6f73 0a20 2020     import os.   
-0001ea00: 2020 2020 2067 7269 6420 3d20 4772 6964       grid = Grid
-0001ea10: 2e66 726f 6d5f 7261 7374 6572 2864 656d  .from_raster(dem
-0001ea20: 5f74 6966 5f69 6e2c 2064 6174 615f 6e61  _tif_in, data_na
-0001ea30: 6d65 3d27 6465 6d27 290a 2020 2020 2020  me='dem').      
-0001ea40: 2020 6772 6964 2e66 696c 6c5f 6465 7072    grid.fill_depr
-0001ea50: 6573 7369 6f6e 7328 6461 7461 3d27 6465  essions(data='de
-0001ea60: 6d27 2c20 6f75 745f 6e61 6d65 3d27 666c  m', out_name='fl
-0001ea70: 6f6f 6465 645f 6465 6d27 290a 2020 2020  ooded_dem').    
-0001ea80: 2020 2020 6772 6964 2e72 6573 6f6c 7665      grid.resolve
-0001ea90: 5f66 6c61 7473 2827 666c 6f6f 6465 645f  _flats('flooded_
-0001eaa0: 6465 6d27 2c20 6f75 745f 6e61 6d65 3d27  dem', out_name='
-0001eab0: 696e 666c 6174 6564 5f64 656d 2729 2023  inflated_dem') #
-0001eac0: 7265 736f 6c76 6520 7468 6520 666c 6174  resolve the flat
-0001ead0: 730a 2020 2020 2020 2020 2320 4164 6420  s.        # Add 
-0001eae0: 6e65 7720 6469 7220 746f 2067 7269 6420  new dir to grid 
-0001eaf0: 6173 2066 6c6f 6174 2061 6e64 2073 6176  as float and sav
-0001eb00: 6520 696e 2074 656d 706f 7261 7279 2066  e in temporary f
-0001eb10: 6f6c 6465 720a 2020 2020 2020 2020 6966  older.        if
-0001eb20: 206e 6f74 2064 6972 5f74 6966 5f69 6e3a   not dir_tif_in:
-0001eb30: 0a20 2020 2020 2020 2020 2020 2067 7269  .            gri
-0001eb40: 642e 666c 6f77 6469 7228 6461 7461 3d27  d.flowdir(data='
-0001eb50: 696e 666c 6174 6564 5f64 656d 272c 206f  inflated_dem', o
-0001eb60: 7574 5f6e 616d 653d 2764 6972 272c 2064  ut_name='dir', d
-0001eb70: 6972 6d61 703d 6469 726d 6170 290a 2020  irmap=dirmap).  
-0001eb80: 2020 2020 2020 2020 2020 7072 696e 7428            print(
-0001eb90: 2764 6972 6563 7469 6f6e 206d 6170 2069  'direction map i
-0001eba0: 7320 6e6f 7420 7072 6f76 6964 6564 3b20  s not provided; 
-0001ebb0: 4541 5359 4d4f 5245 2077 696c 6c20 6361  EASYMORE will ca
-0001ebc0: 6c63 756c 6174 6520 666c 6f77 2064 6972  lculate flow dir
-0001ebd0: 6563 7469 6f6e 2061 6e64 2073 6176 6520  ection and save 
-0001ebe0: 696e 2074 656d 706f 7261 7279 2066 696c  in temporary fil
-0001ebf0: 653a 2729 0a20 2020 2020 2020 2020 2020  e:').           
-0001ec00: 2070 7269 6e74 2827 4541 5359 4d4f 5245   print('EASYMORE
-0001ec10: 2077 696c 6c20 7361 7665 2074 6865 2064   will save the d
-0001ec20: 6972 6563 7469 6f6e 2066 696c 6520 6865  irection file he
-0001ec30: 7265 3a20 272c 2073 656c 662e 7465 6d70  re: ', self.temp
-0001ec40: 5f64 6972 2b73 656c 662e 6361 7365 5f6e  _dir+self.case_n
-0001ec50: 616d 652b 275f 6469 722e 7469 6627 290a  ame+'_dir.tif').
-0001ec60: 2020 2020 2020 2020 2020 2020 6772 6964              grid
-0001ec70: 2e61 6464 5f67 7269 6464 6564 5f64 6174  .add_gridded_dat
-0001ec80: 6128 6772 6964 2e64 6972 2e61 7374 7970  a(grid.dir.astyp
-0001ec90: 6528 666c 6f61 7429 2c20 6461 7461 5f6e  e(float), data_n
-0001eca0: 616d 653d 2764 6972 5f6e 6577 272c 2061  ame='dir_new', a
-0001ecb0: 6666 696e 653d 6772 6964 2e61 6666 696e  ffine=grid.affin
-0001ecc0: 652c 0a20 2020 2020 2020 2020 2020 2020  e,.             
-0001ecd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001ece0: 2020 2020 2073 6861 7065 3d67 7269 642e       shape=grid.
-0001ecf0: 6465 6d2e 7368 6170 652c 2063 7273 3d67  dem.shape, crs=g
-0001ed00: 7269 642e 6372 732c 206e 6f64 6174 613d  rid.crs, nodata=
-0001ed10: 6772 6964 2e64 6972 2e6e 6f64 6174 6129  grid.dir.nodata)
-0001ed20: 0a20 2020 2020 2020 2020 2020 2067 7269  .            gri
-0001ed30: 642e 746f 5f72 6173 7465 7228 2764 6972  d.to_raster('dir
-0001ed40: 5f6e 6577 272c 2073 656c 662e 7465 6d70  _new', self.temp
-0001ed50: 5f64 6972 2b73 656c 662e 6361 7365 5f6e  _dir+self.case_n
-0001ed60: 616d 652b 275f 6469 722e 7469 6627 202c  ame+'_dir.tif' ,
-0001ed70: 2076 6965 773d 4661 6c73 6529 0a20 2020   view=False).   
-0001ed80: 2020 2020 2069 6620 6e6f 7420 6163 635f       if not acc_
-0001ed90: 7469 665f 696e 3a0a 2020 2020 2020 2020  tif_in:.        
-0001eda0: 2020 2020 6772 6964 2e61 6363 756d 756c      grid.accumul
-0001edb0: 6174 696f 6e28 6461 7461 3d27 6469 7227  ation(data='dir'
-0001edc0: 2c20 6f75 745f 6e61 6d65 3d27 6163 6327  , out_name='acc'
-0001edd0: 290a 2020 2020 2020 2020 2020 2020 2320  ).            # 
-0001ede0: 4164 6420 6e65 7720 6469 7220 746f 2067  Add new dir to g
-0001edf0: 7269 6420 6173 2066 6c6f 6174 0a20 2020  rid as float.   
-0001ee00: 2020 2020 2020 2020 2067 7269 642e 6164           grid.ad
-0001ee10: 645f 6772 6964 6465 645f 6461 7461 2867  d_gridded_data(g
-0001ee20: 7269 642e 6163 632e 6173 7479 7065 2866  rid.acc.astype(f
-0001ee30: 6c6f 6174 292c 2064 6174 615f 6e61 6d65  loat), data_name
-0001ee40: 3d27 6163 635f 6e65 7727 2c20 6166 6669  ='acc_new', affi
-0001ee50: 6e65 3d67 7269 642e 6166 6669 6e65 2c0a  ne=grid.affine,.
-0001ee60: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001ee70: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001ee80: 2020 7368 6170 653d 6772 6964 2e64 656d    shape=grid.dem
-0001ee90: 2e73 6861 7065 2c20 6372 733d 6772 6964  .shape, crs=grid
-0001eea0: 2e63 7273 2c20 6e6f 6461 7461 3d67 7269  .crs, nodata=gri
-0001eeb0: 642e 6163 632e 6e6f 6461 7461 290a 2020  d.acc.nodata).  
-0001eec0: 2020 2020 2020 2020 2020 7072 696e 7428            print(
-0001eed0: 2745 4153 594d 4f52 4520 7769 6c6c 2073  'EASYMORE will s
-0001eee0: 6176 6520 7468 6520 6163 6375 6d75 6c61  ave the accumula
-0001eef0: 7469 6f6e 2066 696c 6520 6865 7265 3a20  tion file here: 
-0001ef00: 272c 2073 656c 662e 7465 6d70 5f64 6972  ', self.temp_dir
-0001ef10: 2b73 656c 662e 6361 7365 5f6e 616d 652b  +self.case_name+
-0001ef20: 275f 6163 632e 7469 6627 290a 2020 2020  '_acc.tif').    
-0001ef30: 2020 2020 2020 2020 6772 6964 2e74 6f5f          grid.to_
-0001ef40: 7261 7374 6572 2827 6163 635f 6e65 7727  raster('acc_new'
-0001ef50: 2c20 7365 6c66 2e74 656d 705f 6469 722b  , self.temp_dir+
-0001ef60: 7365 6c66 2e63 6173 655f 6e61 6d65 2b27  self.case_name+'
-0001ef70: 5f61 6363 2e74 6966 2720 2c20 7669 6577  _acc.tif' , view
-0001ef80: 3d46 616c 7365 290a 0a20 2020 2064 6566  =False)..    def
-0001ef90: 2072 6976 6572 2020 2873 656c 662c 0a20   river  (self,. 
-0001efa0: 2020 2020 2020 2020 2020 2020 2020 2064                 d
-0001efb0: 6972 5f74 6966 5f69 6e2c 0a20 2020 2020  ir_tif_in,.     
-0001efc0: 2020 2020 2020 2020 2020 2061 6363 5f74             acc_t
-0001efd0: 6966 5f69 6e2c 0a20 2020 2020 2020 2020  if_in,.         
-0001efe0: 2020 2020 2020 2073 6870 5f72 6976 6572         shp_river
-0001eff0: 5f6f 7574 2c0a 2020 2020 2020 2020 2020  _out,.          
-0001f000: 2020 2020 2020 6469 726d 6170 203d 2028        dirmap = (
-0001f010: 3634 2c20 2031 3238 2c20 2031 2c20 2020  64,  128,  1,   
-0001f020: 322c 2020 2020 342c 2020 2038 2c20 2020  2,    4,   8,   
-0001f030: 2031 362c 2020 3332 292c 2023 204e 2c20   16,  32), # N, 
-0001f040: 4e45 2c20 452c 2053 452c 2053 2c20 5357  NE, E, SE, S, SW
-0001f050: 2c20 572c 204e 570a 2020 2020 2020 2020  , W, NW.        
-0001f060: 2020 2020 2020 2020 706f 7572 5f70 6f69          pour_poi
-0001f070: 6e74 203d 2028 2d39 3939 392c 2d39 3939  nt = (-9999,-999
-0001f080: 3929 2c20 2320 6c6f 6e20 616e 6420 6c61  9), # lon and la
-0001f090: 7420 6f66 2074 6865 206f 7574 6c65 740a  t of the outlet.
-0001f0a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001f0b0: 736e 6170 5f70 6f75 725f 706f 696e 7420  snap_pour_point 
-0001f0c0: 3d20 3130 302c 2023 2074 6872 6573 686f  = 100, # thresho
-0001f0d0: 6c64 2066 6f72 2073 6e61 7020 7468 6520  ld for snap the 
-0001f0e0: 6f75 746c 6574 2074 6f20 7269 7665 7220  outlet to river 
-0001f0f0: 6e65 7477 6f72 6b0a 2020 2020 2020 2020  network.        
-0001f100: 2020 2020 2020 2020 7269 7665 725f 7468          river_th
-0001f110: 7220 3d20 4e6f 6e65 2c0a 2020 2020 2020  r = None,.      
-0001f120: 2020 2020 2020 2020 2020 6772 6964 5f73            grid_s
-0001f130: 697a 6520 3d20 3029 3a20 2320 7374 6172  ize = 0): # star
-0001f140: 7469 6e67 2072 6976 6572 206e 6574 7772  ting river netwr
-0001f150: 6f6b 2074 6872 6573 686f 6c64 2069 6e20  ok threshold in 
-0001f160: 6e75 6d62 6572 206f 6620 6772 6964 730a  number of grids.
-0001f170: 2020 2020 2020 2020 2222 220a 2020 2020          """.    
-0001f180: 2020 2020 6f72 6967 696e 616c 2063 6f64      original cod
-0001f190: 6520 6279 3a0a 2020 2020 2020 2020 7079  e by:.        py
-0001f1a0: 7368 6564 7320 6465 7665 6c6f 7065 7220  sheds developer 
-0001f1b0: 7465 616d 0a20 2020 2020 2020 2068 7474  team.        htt
-0001f1c0: 7073 3a2f 2f67 6974 6875 622e 636f 6d2f  ps://github.com/
-0001f1d0: 6d64 6261 7274 6f73 2f70 7973 6865 6473  mdbartos/pysheds
-0001f1e0: 0a20 2020 2020 2020 206d 6f64 6966 6965  .        modifie
-0001f1f0: 6420 6279 3a0a 2020 2020 2020 2020 4020  d by:.        @ 
-0001f200: 6175 7468 6f72 3a20 2020 2020 2020 2020  author:         
-0001f210: 2020 2020 2020 2020 2053 6865 7276 616e           Shervan
-0001f220: 2047 6861 7261 7269 0a20 2020 2020 2020   Gharari.       
-0001f230: 2040 2047 6974 6875 623a 2020 2020 2020   @ Github:      
-0001f240: 2020 2020 2020 2020 2020 2020 6874 7470              http
-0001f250: 733a 2f2f 6769 7468 7562 2e63 6f6d 2f53  s://github.com/S
-0001f260: 6865 7276 616e 4768 6172 6172 692f 4541  hervanGharari/EA
-0001f270: 5359 4d4f 5245 0a20 2020 2020 2020 2040  SYMORE.        @
-0001f280: 2061 7574 686f 7227 7320 656d 6169 6c20   author's email 
-0001f290: 6964 3a20 2020 2020 2020 7368 2e67 6861  id:       sh.gha
-0001f2a0: 7261 7269 4067 6d61 696c 2e63 6f6d 0a20  rari@gmail.com. 
-0001f2b0: 2020 2020 2020 2040 206c 6963 656e 7365         @ license
-0001f2c0: 3a20 2020 2020 2020 2020 2020 2020 2020  :               
-0001f2d0: 2020 474e 552d 4750 4c76 330a 2020 2020    GNU-GPLv3.    
-0001f2e0: 2020 2020 5468 6973 2066 756e 6374 696f      This functio
-0001f2f0: 6e20 7265 6164 7320 6469 7265 6374 696f  n reads directio
-0001f300: 6e20 616e 6420 666c 6f77 2061 6363 756d  n and flow accum
-0001f310: 756c 6174 696f 6e20 616e 6420 7468 6520  ulation and the 
-0001f320: 6d6f 7374 2064 6f77 6e73 7472 6561 6d20  most downstream 
-0001f330: 706f 696e 7420 616e 6420 7468 7265 7368  point and thresh
-0001f340: 6f6c 640a 2020 2020 2020 2020 2d2d 2d2d  old.        ----
-0001f350: 2d2d 2d2d 2d0a 2020 2020 2020 2020 6469  -----.        di
-0001f360: 725f 7469 665f 696e 3a20 7374 7269 6e67  r_tif_in: string
-0001f370: 3b20 7468 6520 7061 7468 2074 6f20 7468  ; the path to th
-0001f380: 6520 6469 7265 6374 696f 6e20 6765 6f74  e direction geot
-0001f390: 6966 0a20 2020 2020 2020 2061 6363 5f74  if.        acc_t
-0001f3a0: 6966 5f69 6e3a 2073 7472 696e 673b 2074  if_in: string; t
-0001f3b0: 6865 2070 6174 6820 746f 2074 6865 2066  he path to the f
-0001f3c0: 6c6f 7720 6163 6375 6d75 6c61 7469 6f6e  low accumulation
-0001f3d0: 2067 656f 7469 660a 2020 2020 2020 2020   geotif.        
-0001f3e0: 6469 726d 6170 3a20 696e 743b 2064 6972  dirmap: int; dir
-0001f3f0: 6563 7469 6f6e 206f 6620 6561 6368 2076  ection of each v
-0001f400: 616c 7565 2069 6e20 666c 6f77 2064 6972  alue in flow dir
-0001f410: 6563 7469 6f6e 2066 696c 650a 2020 2020  ection file.    
-0001f420: 2020 2020 706f 7572 5f70 6f69 6e74 3a20      pour_point: 
-0001f430: 286c 6f6e 2c6c 6174 293b 2074 6865 206d  (lon,lat); the m
-0001f440: 6f73 7420 646f 776e 7374 7265 616d 206c  ost downstream l
-0001f450: 6f63 6174 696f 6e0a 2020 2020 2020 2020  ocation.        
-0001f460: 736e 6170 5f70 6f75 725f 706f 696e 743a  snap_pour_point:
-0001f470: 2069 6e74 3b20 7468 6520 6d61 7869 6d75   int; the maximu
-0001f480: 6d20 666c 6f77 2061 6363 756d 756c 6174  m flow accumulat
-0001f490: 696f 6e20 666f 7220 636f 7272 6563 7469  ion for correcti
-0001f4a0: 6e67 2074 6f20 7468 6520 7269 7665 7220  ng to the river 
-0001f4b0: 7365 676d 656e 7420 696e 2063 656c 6c0a  segment in cell.
-0001f4c0: 2020 2020 2020 2020 7269 7665 725f 7468          river_th
-0001f4d0: 723a 2069 6e74 3b20 7374 6172 7469 6e67  r: int; starting
-0001f4e0: 2070 6f69 6e74 206f 6620 7269 7665 7220   point of river 
-0001f4f0: 6e65 7477 6f72 6b20 666f 7220 6d6f 7265  network for more
-0001f500: 2074 6861 6e20 616e 2061 6363 756d 756c   than an accumul
-0001f510: 6174 696f 6e20 7661 6c75 650a 2020 2020  ation value.    
-0001f520: 2020 2020 2222 220a 2020 2020 2020 2020      """.        
-0001f530: 6672 6f6d 2070 7973 6865 6473 2e67 7269  from pysheds.gri
-0001f540: 6420 696d 706f 7274 2047 7269 640a 2020  d import Grid.  
-0001f550: 2020 2020 2020 696d 706f 7274 2067 656f        import geo
-0001f560: 7061 6e64 6173 2061 7320 6770 640a 2020  pandas as gpd.  
-0001f570: 2020 2020 2020 696d 706f 7274 206a 736f        import jso
-0001f580: 6e0a 2020 2020 2020 2020 696d 706f 7274  n.        import
-0001f590: 206e 756d 7079 2061 7320 6e70 0a20 2020   numpy as np.   
-0001f5a0: 2020 2020 2069 6d70 6f72 7420 6f73 0a20       import os. 
-0001f5b0: 2020 2020 2020 2023 0a20 2020 2020 2020         #.       
-0001f5c0: 2067 7269 6420 3d20 4772 6964 2e66 726f   grid = Grid.fro
-0001f5d0: 6d5f 7261 7374 6572 2864 6972 5f74 6966  m_raster(dir_tif
-0001f5e0: 5f69 6e2c 2064 6174 615f 6e61 6d65 3d27  _in, data_name='
-0001f5f0: 6469 7227 290a 2020 2020 2020 2020 6772  dir').        gr
-0001f600: 6964 3120 3d20 4772 6964 2e66 726f 6d5f  id1 = Grid.from_
-0001f610: 7261 7374 6572 2861 6363 5f74 6966 5f69  raster(acc_tif_i
-0001f620: 6e2c 2064 6174 615f 6e61 6d65 3d27 6163  n, data_name='ac
-0001f630: 6327 290a 2020 2020 2020 2020 6772 6964  c').        grid
-0001f640: 2e61 6464 5f67 7269 6464 6564 5f64 6174  .add_gridded_dat
-0001f650: 6128 6772 6964 312e 6163 632c 2064 6174  a(grid1.acc, dat
-0001f660: 615f 6e61 6d65 3d27 6163 6327 2c20 6166  a_name='acc', af
-0001f670: 6669 6e65 3d67 7269 642e 6166 6669 6e65  fine=grid.affine
-0001f680: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
-0001f690: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001f6a0: 7368 6170 653d 6772 6964 2e73 6861 7065  shape=grid.shape
-0001f6b0: 2c20 6372 733d 6772 6964 2e63 7273 2c20  , crs=grid.crs, 
-0001f6c0: 6e6f 6461 7461 3d6e 702e 6e61 6e29 0a20  nodata=np.nan). 
-0001f6d0: 2020 2020 2020 2023 2070 7574 7469 6e67         # putting
-0001f6e0: 2074 6865 206f 7574 6c65 7420 706f 696e   the outlet poin
-0001f6f0: 7420 6578 6163 746c 7920 6f6e 2074 6865  t exactly on the
-0001f700: 2072 6976 6572 206e 6574 776f 726b 0a20   river network. 
-0001f710: 2020 2020 2020 2078 7920 3d20 6e70 2e63         xy = np.c
-0001f720: 6f6c 756d 6e5f 7374 6163 6b28 5b70 6f75  olumn_stack([pou
-0001f730: 725f 706f 696e 745b 305d 2c20 706f 7572  r_point[0], pour
-0001f740: 5f70 6f69 6e74 5b31 5d5d 290a 2020 2020  _point[1]]).    
-0001f750: 2020 2020 6e65 775f 7879 203d 2067 7269      new_xy = gri
-0001f760: 642e 736e 6170 5f74 6f5f 6d61 736b 2867  d.snap_to_mask(g
-0001f770: 7269 642e 6163 6320 3e20 736e 6170 5f70  rid.acc > snap_p
-0001f780: 6f75 725f 706f 696e 742c 2078 792c 2072  our_point, xy, r
-0001f790: 6574 7572 6e5f 6469 7374 3d46 616c 7365  eturn_dist=False
-0001f7a0: 290a 2020 2020 2020 2020 6e65 775f 7873  ).        new_xs
-0001f7b0: 2c20 6e65 775f 7973 203d 206e 6577 5f78  , new_ys = new_x
-0001f7c0: 795b 3a2c 305d 2c20 6e65 775f 7879 5b3a  y[:,0], new_xy[:
-0001f7d0: 2c31 5d0a 2020 2020 2020 2020 2320 4465  ,1].        # De
-0001f7e0: 6c69 6e65 6174 6520 7468 6520 6361 7463  lineate the catc
-0001f7f0: 686d 656e 740a 2020 2020 2020 2020 6772  hment.        gr
-0001f800: 6964 2e63 6174 6368 6d65 6e74 2864 6174  id.catchment(dat
-0001f810: 613d 2764 6972 272c 2078 3d6e 6577 5f78  a='dir', x=new_x
-0001f820: 732c 2079 3d6e 6577 5f79 732c 2064 6972  s, y=new_ys, dir
-0001f830: 6d61 703d 6469 726d 6170 2c20 6f75 745f  map=dirmap, out_
-0001f840: 6e61 6d65 3d27 6361 7463 6827 2c5c 0a20  name='catch',\. 
-0001f850: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001f860: 2020 2020 2020 6e6f 6461 7461 3d67 7269        nodata=gri
-0001f870: 642e 6469 722e 6e6f 6461 7461 2c5c 0a20  d.dir.nodata,\. 
-0001f880: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001f890: 2020 2020 2020 7265 6375 7273 696f 6e6c        recursionl
-0001f8a0: 696d 6974 3d31 3530 3030 3030 2c20 7879  imit=1500000, xy
-0001f8b0: 7479 7065 3d27 6c61 6265 6c27 290a 2020  type='label').  
-0001f8c0: 2020 2020 2020 6772 6964 2e63 6c69 705f        grid.clip_
-0001f8d0: 746f 2827 6361 7463 6827 2920 2320 6d75  to('catch') # mu
-0001f8e0: 7374 2062 6520 636c 6970 7065 640a 2020  st be clipped.  
-0001f8f0: 2020 2020 2020 2320 436f 6d70 7574 6520        # Compute 
-0001f900: 6163 6375 6d75 6c61 7469 6f6e 0a20 2020  accumulation.   
-0001f910: 2020 2020 2067 7269 642e 6163 6375 6d75       grid.accumu
-0001f920: 6c61 7469 6f6e 2864 6174 613d 2763 6174  lation(data='cat
-0001f930: 6368 272c 206f 7574 5f6e 616d 653d 2761  ch', out_name='a
-0001f940: 6363 2729 0a20 2020 2020 2020 2062 7261  cc').        bra
-0001f950: 6e63 6865 7320 3d20 4e6f 6e65 0a20 2020  nches = None.   
-0001f960: 2020 2020 2062 7261 6e63 6865 7320 3d20       branches = 
-0001f970: 6772 6964 2e65 7874 7261 6374 5f72 6976  grid.extract_riv
-0001f980: 6572 5f6e 6574 776f 726b 2866 6469 723d  er_network(fdir=
-0001f990: 2763 6174 6368 272c 0a20 2020 2020 2020  'catch',.       
-0001f9a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001f9b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001f9c0: 2020 2020 2020 2061 6363 3d27 6163 6327         acc='acc'
-0001f9d0: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
-0001f9e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001f9f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001fa00: 7468 7265 7368 6f6c 643d 7269 7665 725f  threshold=river_
-0001fa10: 7468 722c 0a20 2020 2020 2020 2020 2020  thr,.           
-0001fa20: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001fa30: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001fa40: 2020 2064 6972 6d61 703d 6469 726d 6170     dirmap=dirmap
-0001fa50: 290a 2020 2020 2020 2020 666f 7220 6272  ).        for br
-0001fa60: 616e 6368 2069 6e20 6272 616e 6368 6573  anch in branches
-0001fa70: 5b27 6665 6174 7572 6573 275d 3a0a 2020  ['features']:.  
-0001fa80: 2020 2020 2020 2020 2020 6c69 6e65 203d            line =
-0001fa90: 206e 702e 6173 6172 7261 7928 6272 616e   np.asarray(bran
-0001faa0: 6368 5b27 6765 6f6d 6574 7279 275d 5b27  ch['geometry']['
-0001fab0: 636f 6f72 6469 6e61 7465 7327 5d29 0a20  coordinates']). 
-0001fac0: 2020 2020 2020 2023 2064 756d 7074 2074         # dumpt t
-0001fad0: 6865 206c 696e 6573 2069 6e74 6f20 6120  he lines into a 
-0001fae0: 6e65 7477 6f72 6b0a 2020 2020 2020 2020  network.        
-0001faf0: 7769 7468 206f 7065 6e28 7365 6c66 2e74  with open(self.t
-0001fb00: 656d 705f 6469 722b 7365 6c66 2e63 6173  emp_dir+self.cas
-0001fb10: 655f 6e61 6d65 2b27 5f72 6976 6572 2e6a  e_name+'_river.j
-0001fb20: 736f 6e27 2c20 2777 2729 2061 7320 6a73  son', 'w') as js
-0001fb30: 6f6e 5f66 696c 653a 0a20 2020 2020 2020  on_file:.       
-0001fb40: 2020 2020 206a 736f 6e2e 6475 6d70 2862       json.dump(b
-0001fb50: 7261 6e63 6865 732c 206a 736f 6e5f 6669  ranches, json_fi
-0001fb60: 6c65 290a 2020 2020 2020 2020 2320 6c6f  le).        # lo
-0001fb70: 6164 2074 6865 206a 736f 6e20 616e 6420  ad the json and 
-0001fb80: 7361 7665 2069 7420 6173 2061 2073 6861  save it as a sha
-0001fb90: 7065 6669 6c65 2075 7369 6e67 2067 656f  pefile using geo
-0001fba0: 7061 6e64 6173 0a20 2020 2020 2020 2073  pandas.        s
-0001fbb0: 6870 203d 2067 7064 2e72 6561 645f 6669  hp = gpd.read_fi
-0001fbc0: 6c65 2873 656c 662e 7465 6d70 5f64 6972  le(self.temp_dir
-0001fbd0: 2b73 656c 662e 6361 7365 5f6e 616d 652b  +self.case_name+
-0001fbe0: 275f 7269 7665 722e 6a73 6f6e 2729 0a20  '_river.json'). 
-0001fbf0: 2020 2020 2020 206f 732e 7265 6d6f 7665         os.remove
-0001fc00: 2028 7365 6c66 2e74 656d 705f 6469 722b   (self.temp_dir+
-0001fc10: 7365 6c66 2e63 6173 655f 6e61 6d65 2b27  self.case_name+'
-0001fc20: 5f72 6976 6572 2e6a 736f 6e27 290a 2020  _river.json').  
-0001fc30: 2020 2020 2020 7368 705b 2749 4427 5d20        shp['ID'] 
-0001fc40: 3d20 6e70 2e61 7261 6e67 6528 6c65 6e28  = np.arange(len(
-0001fc50: 7368 7029 2920 2b20 310a 2020 2020 2020  shp)) + 1.      
-0001fc60: 2020 2320 7361 7665 2074 6865 2073 6861    # save the sha
-0001fc70: 7065 6669 6c65 0a20 2020 2020 2020 2073  pefile.        s
-0001fc80: 6870 2e74 6f5f 6669 6c65 2873 6870 5f72  hp.to_file(shp_r
-0001fc90: 6976 6572 5f6f 7574 290a 0a20 2020 2064  iver_out)..    d
-0001fca0: 6566 2072 6976 6572 5f6e 6574 776f 726b  ef river_network
-0001fcb0: 2820 2073 656c 662c 0a20 2020 2020 2020  (  self,.       
-0001fcc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001fcd0: 2069 6e66 696c 655f 7269 7665 722c 0a20   infile_river,. 
-0001fce0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001fcf0: 2020 2020 2020 206f 7574 6669 6c65 5f72         outfile_r
-0001fd00: 6976 6572 5f4e 546f 706f 2c0a 2020 2020  iver_NTopo,.    
-0001fd10: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001fd20: 2020 2020 6465 6d5f 7469 665f 696e 203d      dem_tif_in =
-0001fd30: 204e 6f6e 652c 0a20 2020 2020 2020 2020   None,.         
-0001fd40: 2020 2020 2020 2020 2020 2020 2020 2061                 a
-0001fd50: 6363 5f74 6966 5f69 6e20 3d20 4e6f 6e65  cc_tif_in = None
-0001fd60: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
-0001fd70: 2020 2020 2020 2020 2020 6772 6964 5f73            grid_s
-0001fd80: 697a 6520 3d20 302e 3030 293a 0a0a 2020  ize = 0.00):..  
-0001fd90: 2020 2020 2020 696d 706f 7274 2067 656f        import geo
-0001fda0: 7061 6e64 6173 2061 7320 6770 640a 2020  pandas as gpd.  
-0001fdb0: 2020 2020 2020 696d 706f 7274 2070 616e        import pan
-0001fdc0: 6461 7320 6173 2070 640a 2020 2020 2020  das as pd.      
-0001fdd0: 2020 696d 706f 7274 206e 756d 7079 2061    import numpy a
-0001fde0: 7320 6e70 0a20 2020 2020 2020 2066 726f  s np.        fro
-0001fdf0: 6d20 7368 6170 656c 792e 6765 6f6d 6574  m shapely.geomet
-0001fe00: 7279 2069 6d70 6f72 7420 506f 696e 740a  ry import Point.
-0001fe10: 2020 2020 2020 2020 696d 706f 7274 2073          import s
-0001fe20: 6861 7065 6c79 0a20 2020 2020 2020 2023  hapely.        #
-0001fe30: 0a20 2020 2020 2020 2073 6870 203d 2067  .        shp = g
-0001fe40: 7064 2e72 6561 645f 6669 6c65 2869 6e66  pd.read_file(inf
-0001fe50: 696c 655f 7269 7665 7229 0a20 2020 2020  ile_river).     
-0001fe60: 2020 2023 2063 7265 6174 2061 6464 6974     # creat addit
-0001fe70: 696f 6e61 6c20 6669 656c 6473 2066 6f72  ional fields for
-0001fe80: 206e 6574 776f 726b 2074 6f70 6f6c 6f67   network topolog
-0001fe90: 7920 6461 7461 0a20 2020 2020 2020 2073  y data.        s
-0001fea0: 6870 5b27 7374 6172 745f 6c61 7427 5d20  hp['start_lat'] 
-0001feb0: 3d20 4e6f 6e65 0a20 2020 2020 2020 2073  = None.        s
-0001fec0: 6870 5b27 7374 6172 745f 6c6f 6e27 5d20  hp['start_lon'] 
-0001fed0: 3d20 4e6f 6e65 0a20 2020 2020 2020 2073  = None.        s
-0001fee0: 6870 5b27 656e 645f 6c61 7427 5d20 2020  hp['end_lat']   
-0001fef0: 3d20 4e6f 6e65 0a20 2020 2020 2020 2073  = None.        s
-0001ff00: 6870 5b27 656e 645f 6c6f 6e27 5d20 2020  hp['end_lon']   
-0001ff10: 3d20 4e6f 6e65 0a20 2020 2020 2020 2073  = None.        s
-0001ff20: 6870 5b27 656e 645f 6c61 745f 6227 5d20  hp['end_lat_b'] 
-0001ff30: 3d20 4e6f 6e65 0a20 2020 2020 2020 2073  = None.        s
-0001ff40: 6870 5b27 656e 645f 6c6f 6e5f 6227 5d20  hp['end_lon_b'] 
-0001ff50: 3d20 4e6f 6e65 0a20 2020 2020 2020 2073  = None.        s
-0001ff60: 6870 5b27 446f 776e 5f49 4427 5d20 2020  hp['Down_ID']   
-0001ff70: 3d20 2d39 3939 390a 2020 2020 2020 2020  = -9999.        
-0001ff80: 7368 705b 2755 705f 4944 275d 2020 2020  shp['Up_ID']    
-0001ff90: 203d 204e 6f6e 650a 2020 2020 2020 2020   = None.        
-0001ffa0: 7368 705b 2755 7031 5f49 4427 5d20 2020  shp['Up1_ID']   
-0001ffb0: 203d 204e 6f6e 650a 2020 2020 2020 2020   = None.        
-0001ffc0: 7368 705b 2755 7032 5f49 4427 5d20 2020  shp['Up2_ID']   
-0001ffd0: 203d 204e 6f6e 650a 2020 2020 2020 2020   = None.        
-0001ffe0: 7368 705b 2755 7033 5f49 4427 5d20 2020  shp['Up3_ID']   
-0001fff0: 203d 204e 6f6e 650a 2020 2020 2020 2020   = None.        
-00020000: 7368 705b 2755 7034 5f49 4427 5d20 2020  shp['Up4_ID']   
-00020010: 203d 204e 6f6e 650a 2020 2020 2020 2020   = None.        
-00020020: 7368 705b 2755 7035 5f49 4427 5d20 2020  shp['Up5_ID']   
-00020030: 203d 204e 6f6e 650a 2020 2020 2020 2020   = None.        
-00020040: 2320 706f 706f 6c61 7469 6e67 2074 6865  # popolating the
-00020050: 2066 696c 6564 730a 2020 2020 2020 2020   fileds.        
-00020060: 666f 7220 696e 6465 782c 2072 6f77 2069  for index, row i
-00020070: 6e20 7368 702e 6974 6572 726f 7773 2829  n shp.iterrows()
-00020080: 3a0a 2020 2020 2020 2020 2020 2020 6c69  :.            li
-00020090: 6e65 203d 206e 702e 6173 6172 7261 7928  ne = np.asarray(
-000200a0: 726f 775b 2767 656f 6d65 7472 7927 5d29  row['geometry'])
-000200b0: 0a20 2020 2020 2020 2020 2020 2023 2070  .            # p
-000200c0: 6f70 756c 6174 6520 7468 6520 6669 6c65  opulate the file
-000200d0: 640a 2020 2020 2020 2020 2020 2020 7368  d.            sh
-000200e0: 702e 696c 6f63 5b69 6e64 6578 2c20 7368  p.iloc[index, sh
-000200f0: 702e 636f 6c75 6d6e 732e 6765 745f 6c6f  p.columns.get_lo
-00020100: 6328 2773 7461 7274 5f6c 6174 2729 5d20  c('start_lat')] 
-00020110: 3d20 6c69 6e65 5b2d 312c 315d 0a20 2020  = line[-1,1].   
-00020120: 2020 2020 2020 2020 2073 6870 2e69 6c6f           shp.ilo
-00020130: 635b 696e 6465 782c 2073 6870 2e63 6f6c  c[index, shp.col
-00020140: 756d 6e73 2e67 6574 5f6c 6f63 2827 7374  umns.get_loc('st
-00020150: 6172 745f 6c6f 6e27 295d 203d 206c 696e  art_lon')] = lin
-00020160: 655b 2d31 2c30 5d0a 2020 2020 2020 2020  e[-1,0].        
-00020170: 2020 2020 7368 702e 696c 6f63 5b69 6e64      shp.iloc[ind
-00020180: 6578 2c20 7368 702e 636f 6c75 6d6e 732e  ex, shp.columns.
-00020190: 6765 745f 6c6f 6328 2765 6e64 5f6c 6174  get_loc('end_lat
-000201a0: 2729 5d20 2020 3d20 6c69 6e65 5b30 2c31  ')]   = line[0,1
-000201b0: 5d0a 2020 2020 2020 2020 2020 2020 7368  ].            sh
-000201c0: 702e 696c 6f63 5b69 6e64 6578 2c20 7368  p.iloc[index, sh
-000201d0: 702e 636f 6c75 6d6e 732e 6765 745f 6c6f  p.columns.get_lo
-000201e0: 6328 2765 6e64 5f6c 6f6e 2729 5d20 2020  c('end_lon')]   
-000201f0: 3d20 6c69 6e65 5b30 2c30 5d0a 2020 2020  = line[0,0].    
-00020200: 2020 2020 2020 2020 7368 702e 696c 6f63          shp.iloc
-00020210: 5b69 6e64 6578 2c20 7368 702e 636f 6c75  [index, shp.colu
-00020220: 6d6e 732e 6765 745f 6c6f 6328 2765 6e64  mns.get_loc('end
-00020230: 5f6c 6174 5f62 2729 5d20 3d20 6c69 6e65  _lat_b')] = line
-00020240: 5b31 2c31 5d20 2320 6f6e 6520 6265 666f  [1,1] # one befo
-00020250: 7265 206d 6572 6765 6420 706f 696e 7420  re merged point 
-00020260: 6e6f 7420 746f 2069 6e63 6c75 6465 2061  not to include a
-00020270: 6c6c 2074 6865 2063 6f6e 7472 6962 7574  ll the contribut
-00020280: 696e 6720 6172 6561 206f 6620 636f 6e66  ing area of conf
-00020290: 6c75 656e 6365 0a20 2020 2020 2020 2020  luence.         
-000202a0: 2020 2073 6870 2e69 6c6f 635b 696e 6465     shp.iloc[inde
-000202b0: 782c 2073 6870 2e63 6f6c 756d 6e73 2e67  x, shp.columns.g
-000202c0: 6574 5f6c 6f63 2827 656e 645f 6c6f 6e5f  et_loc('end_lon_
-000202d0: 6227 295d 203d 206c 696e 655b 312c 305d  b')] = line[1,0]
-000202e0: 2023 206f 6e65 2062 6566 6f72 6520 6d65   # one before me
-000202f0: 7267 6564 2070 6f69 6e74 206e 6f74 2074  rged point not t
-00020300: 6f20 696e 636c 7564 6520 616c 6c20 7468  o include all th
-00020310: 6520 636f 6e74 7269 6275 7469 6e67 2061  e contributing a
-00020320: 7265 6120 6f66 2063 6f6e 666c 7565 6e63  rea of confluenc
-00020330: 650a 2020 2020 2020 2020 666f 7220 696e  e.        for in
-00020340: 6465 782c 2072 6f77 2069 6e20 7368 702e  dex, row in shp.
-00020350: 6974 6572 726f 7773 2829 3a0a 2020 2020  iterrows():.    
-00020360: 2020 2020 2020 2020 2320 6765 7420 7468          # get th
-00020370: 6520 656e 6420 6c61 742c 206c 6f6e 206f  e end lat, lon o
-00020380: 6620 6120 7269 7665 7220 7365 676d 656e  f a river segmen
-00020390: 740a 2020 2020 2020 2020 2020 2020 656e  t.            en
-000203a0: 645f 6c61 7420 3d20 7368 705b 2765 6e64  d_lat = shp['end
-000203b0: 5f6c 6174 275d 2e69 6c6f 635b 696e 6465  _lat'].iloc[inde
-000203c0: 785d 0a20 2020 2020 2020 2020 2020 2065  x].            e
-000203d0: 6e64 5f6c 6f6e 203d 2073 6870 5b27 656e  nd_lon = shp['en
-000203e0: 645f 6c6f 6e27 5d2e 696c 6f63 5b69 6e64  d_lon'].iloc[ind
-000203f0: 6578 5d0a 2020 2020 2020 2020 2020 2020  ex].            
-00020400: 2320 6669 6e64 2077 6869 6368 2073 6567  # find which seg
-00020410: 6d65 6e74 2073 7461 7274 2077 6974 6820  ment start with 
-00020420: 7468 6174 206c 6174 2c20 6c6f 6e0a 2020  that lat, lon.  
-00020430: 2020 2020 2020 2020 2020 696e 6479 203d            indy =
-00020440: 2073 6870 2e69 6e64 6578 5b73 6870 5b27   shp.index[shp['
-00020450: 7374 6172 745f 6c61 7427 5d20 3d3d 2065  start_lat'] == e
-00020460: 6e64 5f6c 6174 5d2e 746f 6c69 7374 2829  nd_lat].tolist()
-00020470: 0a20 2020 2020 2020 2020 2020 2069 6e64  .            ind
-00020480: 7820 3d20 7368 702e 696e 6465 785b 7368  x = shp.index[sh
-00020490: 705b 2773 7461 7274 5f6c 6f6e 275d 203d  p['start_lon'] =
-000204a0: 3d20 656e 645f 6c6f 6e5d 2e74 6f6c 6973  = end_lon].tolis
-000204b0: 7428 290a 2020 2020 2020 2020 2020 2020  t().            
-000204c0: 2320 6669 6e64 2074 6865 2065 6e64 206f  # find the end o
-000204d0: 6620 696e 6479 2061 6e64 2069 6e64 780a  f indy and indx.
-000204e0: 2020 2020 2020 2020 2020 2020 696e 6420              ind 
-000204f0: 3d20 6c69 7374 2873 6574 2869 6e64 7929  = list(set(indy)
-00020500: 2e69 6e74 6572 7365 6374 696f 6e28 696e  .intersection(in
-00020510: 6478 2929 0a20 2020 2020 2020 2020 2020  dx)).           
-00020520: 2023 2061 7373 6967 6e20 7468 6520 6c69   # assign the li
-00020530: 7374 206f 6620 646f 776e 7374 7265 616d  st of downstream
-00020540: 2073 6567 6d65 6e74 2074 6f20 7468 6520   segment to the 
-00020550: 6669 656c 6420 6966 206e 6f20 646f 776e  field if no down
-00020560: 7374 7265 616d 202d 3939 3939 0a20 2020  stream -9999.   
-00020570: 2020 2020 2020 2020 2069 6620 7374 7228           if str(
-00020580: 696e 6429 2e73 7472 6970 2827 5b5d 2729  ind).strip('[]')
-00020590: 2021 3d20 2727 3a0a 2020 2020 2020 2020   != '':.        
-000205a0: 2020 2020 2020 2020 7368 702e 696c 6f63          shp.iloc
-000205b0: 5b69 6e64 6578 2c20 7368 702e 636f 6c75  [index, shp.colu
-000205c0: 6d6e 732e 6765 745f 6c6f 6328 2744 6f77  mns.get_loc('Dow
-000205d0: 6e5f 4944 2729 5d20 3d20 7368 705b 2749  n_ID')] = shp['I
-000205e0: 4427 5d2e 696c 6f63 5b69 6e74 2873 7472  D'].iloc[int(str
-000205f0: 2869 6e64 292e 7374 7269 7028 275b 5d27  (ind).strip('[]'
-00020600: 2929 5d0a 2020 2020 2020 2020 2020 2020  ))].            
-00020610: 2020 2020 2320 2d2d 2d20 6f6c 6420 636f      # --- old co
-00020620: 6465 2074 6861 7420 7573 6573 2027 6368  de that uses 'ch
-00020630: 6169 6e65 6420 696e 6465 7869 6e67 2720  ained indexing' 
-00020640: 2d20 636c 6561 6e65 7220 746f 2075 7365  - cleaner to use
-00020650: 2069 6c6f 635b 5d20 746f 2066 696e 6420   iloc[] to find 
-00020660: 626f 7468 2072 6f77 2061 6e64 2063 6f6c  both row and col
-00020670: 756d 6e0a 2020 2020 2020 2020 2020 2020  umn.            
-00020680: 2020 2020 2373 6870 5b27 446f 776e 5f49      #shp['Down_I
-00020690: 4427 5d2e 696c 6f63 5b69 6e64 6578 5d20  D'].iloc[index] 
-000206a0: 3d20 7368 705b 2749 4427 5d2e 696c 6f63  = shp['ID'].iloc
-000206b0: 5b69 6e74 2873 7472 2869 6e64 292e 7374  [int(str(ind).st
-000206c0: 7269 7028 275b 5d27 2929 5d0a 2020 2020  rip('[]'))].    
-000206d0: 2020 2020 2020 2020 656c 7365 3a0a 2020          else:.  
-000206e0: 2020 2020 2020 2020 2020 2020 2020 7368                sh
-000206f0: 702e 696c 6f63 5b69 6e64 6578 2c20 7368  p.iloc[index, sh
-00020700: 702e 636f 6c75 6d6e 732e 6765 745f 6c6f  p.columns.get_lo
-00020710: 6328 2744 6f77 6e5f 4944 2729 5d20 3d20  c('Down_ID')] = 
-00020720: 2d39 3939 390a 2020 2020 2020 2020 2020  -9999.          
-00020730: 2020 2020 2020 2320 2d2d 2d20 6f6c 6420        # --- old 
-00020740: 636f 6465 2074 6861 7420 7573 6573 2027  code that uses '
-00020750: 6368 6169 6e65 6420 696e 6465 7869 6e67  chained indexing
-00020760: 2720 2d20 636c 6561 6e65 7220 746f 2075  ' - cleaner to u
-00020770: 7365 2069 6c6f 635b 5d20 746f 2066 696e  se iloc[] to fin
-00020780: 6420 626f 7468 2072 6f77 2061 6e64 2063  d both row and c
-00020790: 6f6c 756d 6e0a 2020 2020 2020 2020 2020  olumn.          
-000207a0: 2020 2020 2020 2373 6870 5b27 446f 776e        #shp['Down
-000207b0: 5f49 4427 5d2e 696c 6f63 5b69 6e64 6578  _ID'].iloc[index
-000207c0: 5d20 3d20 2d39 3939 390a 2020 2020 2020  ] = -9999.      
-000207d0: 2020 2320 6372 6561 7420 6120 6c69 7374    # creat a list
-000207e0: 206f 6620 696d 6d69 6469 6174 6520 7570   of immidiate up
-000207f0: 7374 7265 616d 0a20 2020 2020 2020 2066  stream.        f
-00020800: 6f72 2069 6e64 6578 2c20 726f 7720 696e  or index, row in
-00020810: 2073 6870 2e69 7465 7272 6f77 7328 293a   shp.iterrows():
-00020820: 0a20 2020 2020 2020 2020 2020 2023 2067  .            # g
-00020830: 6574 2074 6865 2049 4420 6f66 2074 6865  et the ID of the
-00020840: 2072 6976 6572 2073 6567 6d65 6e74 0a20   river segment. 
-00020850: 2020 2020 2020 2020 2020 2049 4420 3d20             ID = 
-00020860: 7368 705b 2749 4427 5d2e 6c6f 635b 696e  shp['ID'].loc[in
-00020870: 6465 785d 0a20 2020 2020 2020 2020 2020  dex].           
-00020880: 2023 2066 696e 6420 7468 6520 696d 6d69   # find the immi
-00020890: 6461 7465 2075 7073 7472 6561 6d0a 2020  date upstream.  
-000208a0: 2020 2020 2020 2020 2020 696e 6420 3d20            ind = 
-000208b0: 7368 702e 696e 6465 785b 7368 705b 2744  shp.index[shp['D
-000208c0: 6f77 6e5f 4944 275d 203d 3d20 4944 5d0a  own_ID'] == ID].
-000208d0: 2020 2020 2020 2020 2020 2020 696e 6475              indu
-000208e0: 7020 3d20 7368 705b 2749 4427 5d2e 6c6f  p = shp['ID'].lo
-000208f0: 635b 696e 645d 2e74 6f6c 6973 7428 290a  c[ind].tolist().
-00020900: 2020 2020 2020 2020 2020 2020 7368 705b              shp[
-00020910: 2755 705f 4944 275d 203d 2073 7472 2869  'Up_ID'] = str(i
-00020920: 6e64 7570 290a 2020 2020 2020 2020 2020  ndup).          
-00020930: 2020 2320 6173 7369 676e 2074 6865 2075    # assign the u
-00020940: 7073 7472 6561 6d20 6c69 7374 0a20 2020  pstream list.   
-00020950: 2020 2020 2020 2020 2066 6f72 2069 2069           for i i
-00020960: 6e20 6e70 2e61 7261 6e67 6528 6c65 6e28  n np.arange(len(
-00020970: 696e 6475 7029 293a 0a20 2020 2020 2020  indup)):.       
-00020980: 2020 2020 2020 2020 2066 6965 6c64 5f6e           field_n
-00020990: 616d 6520 3d20 2755 7027 2b73 7472 2869  ame = 'Up'+str(i
-000209a0: 2b31 292b 275f 4944 270a 2020 2020 2020  +1)+'_ID'.      
-000209b0: 2020 2020 2020 2020 2020 7368 702e 696c            shp.il
-000209c0: 6f63 5b69 6e64 6578 2c20 7368 702e 636f  oc[index, shp.co
-000209d0: 6c75 6d6e 732e 6765 745f 6c6f 6328 6669  lumns.get_loc(fi
-000209e0: 656c 645f 6e61 6d65 295d 203d 2069 6e64  eld_name)] = ind
-000209f0: 7570 5b69 5d0a 2020 2020 2020 2020 2020  up[i].          
-00020a00: 2020 2020 2020 2320 2d2d 2d20 6f6c 6420        # --- old 
-00020a10: 636f 6465 2074 6861 7420 7573 6573 2027  code that uses '
-00020a20: 6368 6169 6e65 6420 696e 6465 7869 6e67  chained indexing
-00020a30: 2720 2d20 636c 6561 6e65 7220 746f 2075  ' - cleaner to u
-00020a40: 7365 2069 6c6f 635b 5d20 746f 2066 696e  se iloc[] to fin
-00020a50: 6420 626f 7468 2072 6f77 2061 6e64 2063  d both row and c
-00020a60: 6f6c 756d 6e0a 2020 2020 2020 2020 2020  olumn.          
-00020a70: 2020 2020 2020 2373 6870 5b66 6965 6c64        #shp[field
-00020a80: 5f6e 616d 655d 2e69 6c6f 635b 696e 6465  _name].iloc[inde
-00020a90: 785d 203d 2069 6e64 7570 5b69 5d0a 2020  x] = indup[i].  
-00020aa0: 2020 2020 2020 6966 2064 656d 5f74 6966        if dem_tif
-00020ab0: 5f69 6e3a 0a20 2020 2020 2020 2020 2020  _in:.           
-00020ac0: 2076 616c 7565 7320 3d20 7365 6c66 2e65   values = self.e
-00020ad0: 7874 7261 6374 5f76 616c 7565 5f74 6966  xtract_value_tif
-00020ae0: 6620 286e 702e 6172 7261 7928 7368 705b  f (np.array(shp[
-00020af0: 2773 7461 7274 5f6c 6f6e 275d 292b 6772  'start_lon'])+gr
-00020b00: 6964 5f73 697a 652f 322c 0a20 2020 2020  id_size/2,.     
-00020b10: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00020b20: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00020b30: 2020 2020 2020 2020 206e 702e 6172 7261           np.arra
-00020b40: 7928 7368 705b 2773 7461 7274 5f6c 6174  y(shp['start_lat
-00020b50: 275d 292d 6772 6964 5f73 697a 652f 322c  '])-grid_size/2,
-00020b60: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00020b70: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00020b80: 2020 2020 2020 2020 2020 2020 2020 2064                 d
-00020b90: 656d 5f74 6966 5f69 6e29 0a20 2020 2020  em_tif_in).     
-00020ba0: 2020 2020 2020 2073 6870 5b27 7374 6172         shp['star
-00020bb0: 745f 656c 6527 5d20 3d20 7661 6c75 6573  t_ele'] = values
-00020bc0: 0a20 2020 2020 2020 2020 2020 2076 616c  .            val
-00020bd0: 7565 7320 3d20 7365 6c66 2e65 7874 7261  ues = self.extra
-00020be0: 6374 5f76 616c 7565 5f74 6966 6620 286e  ct_value_tiff (n
-00020bf0: 702e 6172 7261 7928 7368 705b 2765 6e64  p.array(shp['end
-00020c00: 5f6c 6f6e 275d 292b 6772 6964 5f73 697a  _lon'])+grid_siz
-00020c10: 652f 322c 0a20 2020 2020 2020 2020 2020  e/2,.           
-00020c20: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00020c30: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00020c40: 2020 206e 702e 6172 7261 7928 7368 705b     np.array(shp[
-00020c50: 2765 6e64 5f6c 6174 275d 292d 6772 6964  'end_lat'])-grid
-00020c60: 5f73 697a 652f 322c 0a20 2020 2020 2020  _size/2,.       
-00020c70: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00020c80: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00020c90: 2020 2020 2020 2064 656d 5f74 6966 5f69         dem_tif_i
-00020ca0: 6e29 0a20 2020 2020 2020 2020 2020 2073  n).            s
-00020cb0: 6870 5b27 656e 645f 656c 6527 5d20 3d20  hp['end_ele'] = 
-00020cc0: 7661 6c75 6573 0a20 2020 2020 2020 2069  values.        i
-00020cd0: 6620 6163 635f 7469 665f 696e 3a0a 2020  f acc_tif_in:.  
-00020ce0: 2020 2020 2020 2020 2020 7661 6c75 6573            values
-00020cf0: 203d 2073 656c 662e 6578 7472 6163 745f   = self.extract_
-00020d00: 7661 6c75 655f 7469 6666 2028 6e70 2e61  value_tiff (np.a
-00020d10: 7272 6179 2873 6870 5b27 656e 645f 6c6f  rray(shp['end_lo
-00020d20: 6e5f 6227 5d29 2b67 7269 645f 7369 7a65  n_b'])+grid_size
-00020d30: 2f32 2c0a 2020 2020 2020 2020 2020 2020  /2,.            
-00020d40: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00020d50: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00020d60: 2020 6e70 2e61 7272 6179 2873 6870 5b27    np.array(shp['
-00020d70: 656e 645f 6c61 745f 6227 5d29 2d67 7269  end_lat_b'])-gri
-00020d80: 645f 7369 7a65 2f32 2c0a 2020 2020 2020  d_size/2,.      
-00020d90: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00020da0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00020db0: 2020 2020 2020 2020 6163 635f 7469 665f          acc_tif_
-00020dc0: 696e 290a 2020 2020 2020 2020 2020 2020  in).            
-00020dd0: 7368 705b 2765 6e64 5f61 6363 275d 203d  shp['end_acc'] =
-00020de0: 2076 616c 7565 730a 2020 2020 2020 2020   values.        
-00020df0: 2020 2020 7368 7020 3d20 7368 702e 736f      shp = shp.so
-00020e00: 7274 5f76 616c 7565 7328 6279 3d27 656e  rt_values(by='en
-00020e10: 645f 6163 6327 290a 2020 2020 2020 2020  d_acc').        
-00020e20: 2320 7361 7665 2074 6865 2073 6861 7065  # save the shape
-00020e30: 6669 6c65 0a23 2020 2020 2020 2020 2066  file.#         f
-00020e40: 6f72 2069 6e64 6578 2c20 5f20 696e 2073  or index, _ in s
-00020e50: 6870 2e69 7465 7272 6f77 7328 293a 0a23  hp.iterrows():.#
-00020e60: 2020 2020 2020 2020 2020 2020 2070 6f6c               pol
-00020e70: 7973 203d 2073 6870 2e67 656f 6d65 7472  ys = shp.geometr
-00020e80: 792e 696c 6f63 5b69 6e64 6578 5d20 2320  y.iloc[index] # 
-00020e90: 6765 7420 7468 6520 7368 6170 650a 2320  get the shape.# 
-00020ea0: 2020 2020 2020 2020 2020 2020 706f 6c79              poly
-00020eb0: 7320 3d20 7368 6170 656c 792e 6166 6669  s = shapely.affi
-00020ec0: 6e69 7479 2e74 7261 6e73 6c61 7465 2870  nity.translate(p
-00020ed0: 6f6c 7973 2c20 786f 6666 3d2b 6772 6964  olys, xoff=+grid
-00020ee0: 5f73 697a 652f 322c 2079 6f66 663d 2d67  _size/2, yoff=-g
-00020ef0: 7269 645f 7369 7a65 2f32 2c20 7a6f 6666  rid_size/2, zoff
-00020f00: 3d30 2e30 290a 2320 2020 2020 2020 2020  =0.0).#         
-00020f10: 2020 2020 7368 702e 6765 6f6d 6574 7279      shp.geometry
-00020f20: 2e69 6c6f 635b 696e 6465 785d 203d 2070  .iloc[index] = p
-00020f30: 6f6c 7973 0a20 2020 2020 2020 2073 6870  olys.        shp
-00020f40: 2e74 6f5f 6669 6c65 286f 7574 6669 6c65  .to_file(outfile
-00020f50: 5f72 6976 6572 5f4e 546f 706f 290a 0a20  _river_NTopo).. 
-00020f60: 2020 2064 6566 2073 7562 6261 7369 6e5f     def subbasin_
-00020f70: 6372 6561 7469 6f6e 2820 2073 656c 662c  creation(  self,
-00020f80: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00020f90: 2020 2020 2020 2020 2020 2020 2064 6972               dir
-00020fa0: 5f74 6966 5f69 6e2c 0a20 2020 2020 2020  _tif_in,.       
-00020fb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00020fc0: 2020 2020 2067 6175 6765 735f 7368 705f       gauges_shp_
-00020fd0: 696e 2c0a 2020 2020 2020 2020 2020 2020  in,.            
-00020fe0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00020ff0: 7375 6262 6173 696e 5f74 6966 665f 6f75  subbasin_tiff_ou
-00021000: 742c 0a20 2020 2020 2020 2020 2020 2020  t,.             
-00021010: 2020 2020 2020 2020 2020 2020 2020 2064                 d
-00021020: 6972 6d61 7020 3d20 2836 342c 2020 3132  irmap = (64,  12
-00021030: 382c 2020 312c 2020 2032 2c20 2020 2034  8,  1,   2,    4
-00021040: 2c20 2020 382c 2020 2020 3136 2c20 2033  ,   8,    16,  3
-00021050: 3229 293a 234e 2c20 4e45 2c20 452c 2053  2)):#N, NE, E, S
-00021060: 452c 2053 2c20 5357 2c20 572c 204e 570a  E, S, SW, W, NW.
-00021070: 2020 2020 2020 2020 6672 6f6d 2070 7973          from pys
-00021080: 6865 6473 2e67 7269 6420 696d 706f 7274  heds.grid import
-00021090: 2047 7269 640a 2020 2020 2020 2020 696d   Grid.        im
-000210a0: 706f 7274 2067 656f 7061 6e64 6173 2061  port geopandas a
-000210b0: 7320 6770 640a 2020 2020 2020 2020 696d  s gpd.        im
-000210c0: 706f 7274 206e 756d 7079 2061 7320 6e70  port numpy as np
-000210d0: 0a20 2020 2020 2020 2067 7269 6420 3d20  .        grid = 
-000210e0: 4772 6964 2e66 726f 6d5f 7261 7374 6572  Grid.from_raster
-000210f0: 2864 6972 5f74 6966 5f69 6e2c 2064 6174  (dir_tif_in, dat
-00021100: 615f 6e61 6d65 3d27 6469 7227 290a 2020  a_name='dir').  
-00021110: 2020 2020 2020 4120 3d20 6770 642e 7265        A = gpd.re
-00021120: 6164 5f66 696c 6528 6761 7567 6573 5f73  ad_file(gauges_s
-00021130: 6870 5f69 6e29 0a20 2020 2020 2020 2023  hp_in).        #
-00021140: 2073 6f72 7420 6261 7365 6420 6f6e 2061   sort based on a
-00021150: 6363 756d 756c 6174 696f 6e0a 2020 2020  ccumulation.    
-00021160: 2020 2020 7761 726e 696e 6773 2e73 696d      warnings.sim
-00021170: 706c 6566 696c 7465 7228 2769 676e 6f72  plefilter('ignor
-00021180: 6527 290a 2020 2020 2020 2020 415b 276c  e').        A['l
-00021190: 6174 275d 203d 2041 2e63 656e 7472 6f69  at'] = A.centroi
-000211a0: 642e 790a 2020 2020 2020 2020 415b 276c  d.y.        A['l
-000211b0: 6f6e 275d 203d 2041 2e63 656e 7472 6f69  on'] = A.centroi
-000211c0: 642e 780a 2020 2020 2020 2020 7761 726e  d.x.        warn
-000211d0: 696e 6773 2e73 696d 706c 6566 696c 7465  ings.simplefilte
-000211e0: 7228 2764 6566 6175 6c74 2729 0a20 2020  r('default').   
-000211f0: 2020 2020 2023 2069 6e69 7469 616c 697a       # initializ
-00021200: 696e 6720 7468 6520 7375 625f 6261 7369  ing the sub_basi
-00021210: 6e20 7261 7374 6572 0a20 2020 2020 2020  n raster.       
-00021220: 207a 3120 3d20 6e70 2e7a 6572 6f73 2867   z1 = np.zeros(g
-00021230: 7269 642e 7368 6170 6529 0a20 2020 2020  rid.shape).     
-00021240: 2020 2023 206c 6f6f 7020 6f76 6572 2065     # loop over e
-00021250: 6163 6820 7365 676d 656e 7420 6f66 2074  ach segment of t
-00021260: 6865 2072 6976 6572 0a20 2020 2020 2020  he river.       
-00021270: 2066 6f72 2069 6e64 6578 2c20 726f 7720   for index, row 
-00021280: 696e 2041 2e69 7465 7272 6f77 7328 293a  in A.iterrows():
-00021290: 0a20 2020 2020 2020 2020 2020 2063 6174  .            cat
-000212a0: 5f49 4420 3d20 415b 2749 4427 5d2e 696c  _ID = A['ID'].il
-000212b0: 6f63 5b69 6e64 6578 5d20 2320 6765 7420  oc[index] # get 
-000212c0: 7468 6520 4944 206f 6620 7468 6174 2072  the ID of that r
-000212d0: 6976 6572 2073 6567 6d65 6e74 0a20 2020  iver segment.   
-000212e0: 2020 2020 2020 2020 2063 203d 2067 7269           c = gri
-000212f0: 642e 6361 7463 686d 656e 7428 415b 276c  d.catchment(A['l
-00021300: 6f6e 275d 2e69 6c6f 635b 696e 6465 785d  on'].iloc[index]
-00021310: 2c20 415b 276c 6174 275d 2e69 6c6f 635b  , A['lat'].iloc[
-00021320: 696e 6465 785d 2c20 5c0a 2020 2020 2020  index], \.      
-00021330: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00021340: 2020 2020 2020 2020 2064 6174 613d 2764           data='d
-00021350: 6972 272c 2064 6972 6d61 703d 6469 726d  ir', dirmap=dirm
-00021360: 6170 2c20 7879 7479 7065 3d27 6c61 6265  ap, xytype='labe
-00021370: 6c27 2c20 696e 706c 6163 653d 4661 6c73  l', inplace=Fals
-00021380: 6529 0a20 2020 2020 2020 2020 2020 207a  e).            z
-00021390: 3120 2b3d 2063 6174 5f49 4420 2a20 2863  1 += cat_ID * (c
-000213a0: 2021 3d20 3029 2e61 7374 7970 6528 696e   != 0).astype(in
-000213b0: 7429 0a20 2020 2020 2020 2020 2020 2069  t).            i
-000213c0: 6478 203d 206e 702e 7768 6572 6528 6320  dx = np.where(c 
-000213d0: 213d 2030 290a 2020 2020 2020 2020 2020  != 0).          
-000213e0: 2020 6772 6964 2e64 6972 5b69 6478 5d20    grid.dir[idx] 
-000213f0: 3d20 6772 6964 2e64 6972 2e6e 6f64 6174  = grid.dir.nodat
-00021400: 610a 2020 2020 2020 2020 2320 4164 6420  a.        # Add 
-00021410: 7a31 2074 6f20 6772 6964 0a20 2020 2020  z1 to grid.     
-00021420: 2020 2069 6478 203d 206e 702e 7768 6572     idx = np.wher
-00021430: 6528 7a31 203d 3d20 3029 0a20 2020 2020  e(z1 == 0).     
-00021440: 2020 207a 315b 6964 785d 203d 206e 702e     z1[idx] = np.
-00021450: 6e61 6e0a 2020 2020 2020 2020 6772 6964  nan.        grid
-00021460: 2e61 6464 5f67 7269 6464 6564 5f64 6174  .add_gridded_dat
-00021470: 6128 7a31 2c20 6461 7461 5f6e 616d 653d  a(z1, data_name=
-00021480: 2773 7562 5f62 6173 696e 272c 2061 6666  'sub_basin', aff
-00021490: 696e 653d 6772 6964 2e61 6666 696e 652c  ine=grid.affine,
-000214a0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-000214b0: 2020 2020 2020 2020 2020 2020 2020 2073                 s
-000214c0: 6861 7065 3d67 7269 642e 7368 6170 652c  hape=grid.shape,
-000214d0: 2063 7273 3d67 7269 642e 6372 732c 206e   crs=grid.crs, n
-000214e0: 6f64 6174 613d 6e70 2e6e 616e 290a 2020  odata=np.nan).  
-000214f0: 2020 2020 2020 2320 5772 6974 6520 746f        # Write to
-00021500: 2072 6173 7465 720a 2020 2020 2020 2020   raster.        
-00021510: 6772 6964 2e74 6f5f 7261 7374 6572 2827  grid.to_raster('
-00021520: 7375 625f 6261 7369 6e27 2c20 7375 6262  sub_basin', subb
-00021530: 6173 696e 5f74 6966 665f 6f75 742c 2076  asin_tiff_out, v
-00021540: 6965 773d 4661 6c73 6529 0a0a 2020 2020  iew=False)..    
-00021550: 6465 6620 7669 7375 616c 697a 655f 7469  def visualize_ti
-00021560: 6666 2028 7365 6c66 2c0a 2020 2020 2020  ff (self,.      
-00021570: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00021580: 2020 6765 6f74 6966 665f 7061 7468 2c0a    geotiff_path,.
-00021590: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000215a0: 2020 2020 2020 2020 6669 675f 7369 7a65          fig_size
-000215b0: 203d 2028 3134 2c37 292c 0a20 2020 2020   = (14,7),.     
-000215c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000215d0: 2020 2063 6d61 703d 276a 6574 272c 0a20     cmap='jet',. 
-000215e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000215f0: 2020 2020 2020 2063 6f6c 6f72 6261 725f         colorbar_
-00021600: 6c61 6265 6c20 3d20 2727 2c0a 2020 2020  label = '',.    
-00021610: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00021620: 2020 2020 7469 746c 6520 3d27 272c 0a20      title ='',. 
-00021630: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00021640: 2020 2020 2020 2078 6c61 626c 6520 3d20         xlable = 
-00021650: 2727 2c0a 2020 2020 2020 2020 2020 2020  '',.            
-00021660: 2020 2020 2020 2020 2020 2020 796c 6162              ylab
-00021670: 6c65 3d27 2729 3a0a 2020 2020 2020 2020  le=''):.        
-00021680: 6672 6f6d 2070 7973 6865 6473 2e67 7269  from pysheds.gri
-00021690: 6420 696d 706f 7274 2047 7269 640a 2020  d import Grid.  
-000216a0: 2020 2020 2020 696d 706f 7274 206d 6174        import mat
-000216b0: 706c 6f74 6c69 622e 7079 706c 6f74 2061  plotlib.pyplot a
-000216c0: 7320 706c 740a 2020 2020 2020 2020 696d  s plt.        im
-000216d0: 706f 7274 206e 756d 7079 2061 7320 6e70  port numpy as np
-000216e0: 0a20 2020 2020 2020 2069 6d70 6f72 7420  .        import 
-000216f0: 6a73 6f6e 0a20 2020 2020 2020 2069 6d70  json.        imp
-00021700: 6f72 7420 6765 6f70 616e 6461 7320 6173  ort geopandas as
-00021710: 2067 7064 0a20 2020 2020 2020 2066 726f   gpd.        fro
-00021720: 6d20 7368 6170 656c 792e 6765 6f6d 6574  m shapely.geomet
-00021730: 7279 2069 6d70 6f72 7420 506f 696e 740a  ry import Point.
-00021740: 2020 2020 2020 2020 6672 6f6d 2067 656f          from geo
-00021750: 7061 6e64 6173 2069 6d70 6f72 7420 4765  pandas import Ge
-00021760: 6f53 6572 6965 730a 2020 2020 2020 2020  oSeries.        
-00021770: 2320 7365 7420 7468 6520 666f 6e74 2061  # set the font a
-00021780: 6e64 2066 6f6e 7420 7369 7a65 2066 6f72  nd font size for
-00021790: 2070 6c6f 7473 0a20 2020 2020 2020 2070   plots.        p
-000217a0: 6c74 2e72 6350 6172 616d 735b 2266 6f6e  lt.rcParams["fon
-000217b0: 742e 6661 6d69 6c79 225d 203d 2022 5469  t.family"] = "Ti
-000217c0: 6d65 7320 4e65 7720 526f 6d61 6e22 0a20  mes New Roman". 
-000217d0: 2020 2020 2020 2070 6c74 2e72 6350 6172         plt.rcPar
-000217e0: 616d 732e 7570 6461 7465 287b 2766 6f6e  ams.update({'fon
-000217f0: 742e 7369 7a65 273a 2031 367d 290a 0a20  t.size': 16}).. 
-00021800: 2020 2020 2020 2067 7269 6420 3d20 4772         grid = Gr
-00021810: 6964 2e66 726f 6d5f 7261 7374 6572 2867  id.from_raster(g
-00021820: 656f 7469 6666 5f70 6174 682c 2064 6174  eotiff_path, dat
-00021830: 615f 6e61 6d65 3d27 7465 6d70 2729 2023  a_name='temp') #
-00021840: 2070 6172 7420 6f66 204d 6973 736f 7572   part of Missour
-00021850: 6920 5269 7665 720a 0a20 2020 2020 2020  i River..       
-00021860: 2049 4420 3d20 6e70 2e77 6865 7265 2867   ID = np.where(g
-00021870: 7269 642e 7465 6d70 213d 6772 6964 2e74  rid.temp!=grid.t
-00021880: 656d 702e 6e6f 6461 7461 2920 2320 7468  emp.nodata) # th
-00021890: 6520 6d69 7373 696e 6720 7661 6c75 6573  e missing values
-000218a0: 2069 7320 7365 7420 746f 202d 3939 3939   is set to -9999
-000218b0: 2072 656d 6f76 696e 6720 7468 656d 2066   removing them f
-000218c0: 726f 6d20 6d69 6e20 616e 6420 6d61 7820  rom min and max 
-000218d0: 666f 7220 636f 6c6f 7262 6172 0a20 2020  for colorbar.   
-000218e0: 2020 2020 2070 6c74 2e66 6967 7572 6528       plt.figure(
-000218f0: 6669 6773 697a 6520 3d20 6669 675f 7369  figsize = fig_si
-00021900: 7a65 290a 2020 2020 2020 2020 706c 742e  ze).        plt.
-00021910: 696d 7368 6f77 2867 7269 642e 7465 6d70  imshow(grid.temp
-00021920: 2e61 7374 7970 6528 666c 6f61 7429 2c20  .astype(float), 
-00021930: 6578 7465 6e74 3d67 7269 642e 6578 7465  extent=grid.exte
-00021940: 6e74 2c20 636d 6170 3d63 6d61 702c 207a  nt, cmap=cmap, z
-00021950: 6f72 6465 723d 312c 0a20 2020 2020 2020  order=1,.       
-00021960: 2020 2020 2020 2020 2020 2020 766d 696e              vmin
-00021970: 3d6e 702e 6d69 6e28 6772 6964 2e74 656d  =np.min(grid.tem
-00021980: 705b 4944 5d29 2c20 766d 6178 3d6e 702e  p[ID]), vmax=np.
-00021990: 6d61 7828 6772 6964 2e74 656d 705b 4944  max(grid.temp[ID
-000219a0: 5d29 290a 2020 2020 2020 2020 706c 742e  ])).        plt.
-000219b0: 636f 6c6f 7262 6172 286c 6162 656c 3d63  colorbar(label=c
-000219c0: 6f6c 6f72 6261 725f 6c61 6265 6c29 2023  olorbar_label) #
-000219d0: 2063 7265 6174 696e 6720 7468 6520 636f   creating the co
-000219e0: 6c6f 7262 6172 2061 6e64 2069 7473 206e  lorbar and its n
-000219f0: 616d 6520 616e 6420 756e 6974 0a20 2020  ame and unit.   
-00021a00: 2020 2020 2070 6c74 2e67 7269 6428 7a6f       plt.grid(zo
-00021a10: 7264 6572 3d30 2920 2320 6372 6561 7469  rder=0) # creati
-00021a20: 6e67 2074 6865 2067 7269 6420 6f6e 2074  ng the grid on t
-00021a30: 6865 206d 6170 0a20 2020 2020 2020 2070  he map.        p
-00021a40: 6c74 2e74 6974 6c65 2874 6974 6c65 2920  lt.title(title) 
-00021a50: 2320 6372 6561 7469 6e67 2074 6974 6c65  # creating title
-00021a60: 0a20 2020 2020 2020 2070 6c74 2e78 6c61  .        plt.xla
-00021a70: 6265 6c28 786c 6162 6c65 2920 2378 6c61  bel(xlable) #xla
-00021a80: 626c 6520 7768 6963 6820 6973 206c 6f6e  ble which is lon
-00021a90: 670a 2020 2020 2020 2020 706c 742e 796c  g.        plt.yl
-00021aa0: 6162 656c 2879 6c61 626c 6529 2023 796c  abel(ylable) #yl
-00021ab0: 6162 6c65 2077 6869 6368 2069 7320 6c61  able which is la
-00021ac0: 740a 2020 2020 2020 2020 706c 742e 7469  t.        plt.ti
-00021ad0: 6768 745f 6c61 796f 7574 2829 0a         ght_layout().
+0001ce50: 4944 5f66 6965 6c64 5f6e 616d 653d 4e6f  ID_field_name=No
+0001ce60: 6e65 2c0a 2020 2020 2020 2020 2020 2020  ne,.            
+0001ce70: 2020 2020 2020 2020 2020 2020 766f 726f              voro
+0001ce80: 6e6f 695f 7368 705f 6669 6c65 5f6e 616d  noi_shp_file_nam
+0001ce90: 653d 4e6f 6e65 2c0a 2020 2020 2020 2020  e=None,.        
+0001cea0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001ceb0: 6275 6666 6572 203d 2032 293a 0a20 2020  buffer = 2):.   
+0001cec0: 2020 2020 2022 2222 0a20 2020 2020 2020       """.       
+0001ced0: 206f 7269 6769 6e61 6c20 636f 6465 2062   original code b
+0001cee0: 793a 0a20 2020 2020 2020 2041 6264 6973  y:.        Abdis
+0001cef0: 6861 6b75 720a 2020 2020 2020 2020 6874  hakur.        ht
+0001cf00: 7470 733a 2f2f 746f 7761 7264 7364 6174  tps://towardsdat
+0001cf10: 6173 6369 656e 6365 2e63 6f6d 2f68 6f77  ascience.com/how
+0001cf20: 2d74 6f2d 6372 6561 7465 2d76 6f72 6f6e  -to-create-voron
+0001cf30: 6f69 2d72 6567 696f 6e73 2d77 6974 682d  oi-regions-with-
+0001cf40: 6765 6f73 7061 7469 616c 2d64 6174 612d  geospatial-data-
+0001cf50: 696e 2d70 7974 686f 6e2d 6164 6262 3663  in-python-adbb6c
+0001cf60: 3566 3231 3334 0a20 2020 2020 2020 206d  5f2134.        m
+0001cf70: 6f64 6966 6965 6420 6279 3a0a 2020 2020  odified by:.    
+0001cf80: 2020 2020 4020 6175 7468 6f72 3a20 2020      @ author:   
+0001cf90: 2020 2020 2020 2020 2020 2020 2020 2053                 S
+0001cfa0: 6865 7276 616e 2047 6861 7261 7269 0a20  hervan Gharari. 
+0001cfb0: 2020 2020 2020 2040 2047 6974 6875 623a         @ Github:
+0001cfc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001cfd0: 2020 6874 7470 733a 2f2f 6769 7468 7562    https://github
+0001cfe0: 2e63 6f6d 2f53 6865 7276 616e 4768 6172  .com/ShervanGhar
+0001cff0: 6172 692f 4541 5359 4d4f 5245 0a20 2020  ari/EASYMORE.   
+0001d000: 2020 2020 2040 2061 7574 686f 7227 7320       @ author's 
+0001d010: 656d 6169 6c20 6964 3a20 2020 2020 2020  email id:       
+0001d020: 7368 2e67 6861 7261 7269 4067 6d61 696c  sh.gharari@gmail
+0001d030: 2e63 6f6d 0a20 2020 2020 2020 2040 206c  .com.        @ l
+0001d040: 6963 656e 7365 3a20 2020 2020 2020 2020  icense:         
+0001d050: 2020 2020 2020 2020 474e 552d 4750 4c76          GNU-GPLv
+0001d060: 330a 2020 2020 2020 2020 5468 6973 2066  3.        This f
+0001d070: 756e 6374 696f 6e20 7265 6164 7320 6120  unction reads a 
+0001d080: 7368 6170 6566 696c 6520 6f66 2070 6f69  shapefile of poi
+0001d090: 6e74 7320 616e 6420 7265 7475 726e 7320  nts and returns 
+0001d0a0: 7468 6520 5468 6965 7373 656e 206f 7220  the Thiessen or 
+0001d0b0: 566f 726f 6e6f 6920 706f 6c79 676f 6e73  Voronoi polygons
+0001d0c0: 2066 6f72 2074 6861 7420 706f 696e 7420   for that point 
+0001d0d0: 7368 6170 6566 696c 650a 2020 2020 2020  shapefile.      
+0001d0e0: 2020 2d2d 2d2d 2d2d 2d2d 2d0a 2020 2020    ---------.    
+0001d0f0: 2020 2020 706f 696e 7473 5f73 6870 5f69      points_shp_i
+0001d100: 6e3a 2067 656f 7061 6e64 6173 206f 7220  n: geopandas or 
+0001d110: 7374 7269 6e67 3b20 6966 2073 7472 696e  string; if strin
+0001d120: 6720 6974 2077 696c 6c20 7265 6164 2074  g it will read t
+0001d130: 6865 2073 6861 7065 6669 6c65 0a20 2020  he shapefile.   
+0001d140: 2020 2020 2049 445f 6669 656c 645f 6e61       ID_field_na
+0001d150: 6d65 3a20 7374 7269 6e67 2c20 7468 6520  me: string, the 
+0001d160: 6e61 6d65 206f 6620 6174 7472 6962 7574  name of attribut
+0001d170: 6573 2074 6861 7420 696e 636c 7564 6520  es that include 
+0001d180: 4944 2069 6e64 6578 2076 616c 7565 7320  ID index values 
+0001d190: 286f 7074 696f 6e61 6c29 0a20 2020 2020  (optional).     
+0001d1a0: 2020 2076 6f72 6f6e 6f69 5f73 6870 5f66     voronoi_shp_f
+0001d1b0: 696c 655f 6e61 6d65 3a20 7374 7269 6e67  ile_name: string
+0001d1c0: 2c20 6e61 6d65 206f 6620 7468 6520 566f  , name of the Vo
+0001d1d0: 726f 6e6f 6920 6f75 7470 7574 2073 6861  ronoi output sha
+0001d1e0: 7065 6669 6c65 2074 6f20 6265 2073 6176  pefile to be sav
+0001d1f0: 6564 0a20 2020 2020 2020 2062 7566 6665  ed.        buffe
+0001d200: 723a 2066 6c6f 6174 2c20 7468 6520 6275  r: float, the bu
+0001d210: 6666 6572 2061 726f 756e 6420 7468 6520  ffer around the 
+0001d220: 706f 696e 7473 2062 6f75 6e64 696e 6720  points bounding 
+0001d230: 626f 7820 746f 206c 696d 6974 2074 6865  box to limit the
+0001d240: 2056 6f72 6f6e 6f69 2064 6961 6772 616d   Voronoi diagram
+0001d250: 0a20 2020 2020 2020 2052 6574 7572 6e73  .        Returns
+0001d260: 0a20 2020 2020 2020 202d 2d2d 2d2d 2d2d  .        -------
+0001d270: 0a20 2020 2020 2020 2054 6869 6573 7365  .        Thiesse
+0001d280: 6e3a 2067 656f 7061 6e64 6173 2064 6174  n: geopandas dat
+0001d290: 6166 7261 6d65 2c20 566f 726f 6e69 6f20  aframe, Voronio 
+0001d2a0: 6f72 2054 6869 6573 7365 6e20 6469 6167  or Thiessen diag
+0001d2b0: 7261 6d0a 2020 2020 2020 2020 2222 220a  ram.        """.
+0001d2c0: 2020 2020 2020 2020 2369 6d70 6f72 7420          #import 
+0001d2d0: 7368 6170 6566 696c 6520 2320 6173 2070  shapefile # as p
+0001d2e0: 6172 7420 6f66 2070 7973 6870 0a20 2020  art of pyshp.   
+0001d2f0: 2020 2020 2069 6d70 6f72 7420 6765 6f76       import geov
+0001d300: 6f72 6f6e 6f69 0a20 2020 2020 2020 2069  oronoi.        i
+0001d310: 6d70 6f72 7420 6f73 0a20 2020 2020 2020  mport os.       
+0001d320: 2066 726f 6d20 2020 7368 6170 656c 792e   from   shapely.
+0001d330: 6765 6f6d 6574 7279 2069 6d70 6f72 7420  geometry import 
+0001d340: 506f 6c79 676f 6e0a 2020 2020 2020 2020  Polygon.        
+0001d350: 6672 6f6d 2020 2073 6861 7065 6c79 2e67  from   shapely.g
+0001d360: 656f 6d65 7472 7920 696d 706f 7274 2062  eometry import b
+0001d370: 6f78 0a20 2020 2020 2020 2069 6d70 6f72  ox.        impor
+0001d380: 7420 6e75 6d70 7920 6173 206e 700a 2020  t numpy as np.  
+0001d390: 2020 2020 2020 696d 706f 7274 2070 616e        import pan
+0001d3a0: 6461 7320 6173 2070 640a 2020 2020 2020  das as pd.      
+0001d3b0: 2020 696d 706f 7274 2067 656f 7061 6e64    import geopand
+0001d3c0: 6173 2061 7320 6770 640a 2020 2020 2020  as as gpd.      
+0001d3d0: 2020 2320 7265 6164 2074 6865 2073 6861    # read the sha
+0001d3e0: 7065 6669 6c65 0a20 2020 2020 2020 2069  pefile.        i
+0001d3f0: 6620 6973 696e 7374 616e 6365 2870 6f69  f isinstance(poi
+0001d400: 6e74 735f 7368 705f 696e 2c20 7374 7229  nts_shp_in, str)
+0001d410: 3a0a 2020 2020 2020 2020 2020 2020 7374  :.            st
+0001d420: 6174 696f 6e73 203d 2067 7064 2e72 6561  ations = gpd.rea
+0001d430: 645f 6669 6c65 2870 6f69 6e74 735f 7368  d_file(points_sh
+0001d440: 705f 696e 290a 2020 2020 2020 2020 656c  p_in).        el
+0001d450: 7365 3a0a 2020 2020 2020 2020 2020 2020  se:.            
+0001d460: 7374 6174 696f 6e73 203d 2070 6f69 6e74  stations = point
+0001d470: 735f 7368 705f 696e 2023 2067 656f 6461  s_shp_in # geoda
+0001d480: 7461 6672 616d 650a 2020 2020 2020 2020  taframe.        
+0001d490: 2320 6765 7420 7468 6520 6372 7320 6672  # get the crs fr
+0001d4a0: 6f6d 2074 6865 2070 6f69 6e74 2073 6861  om the point sha
+0001d4b0: 7065 6669 6c65 0a20 2020 2020 2020 2063  pefile.        c
+0001d4c0: 7273 5f6f 7267 203d 2073 7461 7469 6f6e  rs_org = station
+0001d4d0: 732e 6372 730a 2020 2020 2020 2020 7072  s.crs.        pr
+0001d4e0: 696e 7428 2763 7273 2066 726f 6d20 7468  int('crs from th
+0001d4f0: 6520 706f 696e 7420 6765 6f70 616e 6461  e point geopanda
+0001d500: 733a 2027 2c20 6372 735f 6f72 6729 0a20  s: ', crs_org). 
+0001d510: 2020 2020 2020 2069 6620 2863 7273 5f6f         if (crs_o
+0001d520: 7267 203d 3d20 274e 6f6e 6527 2920 6f72  rg == 'None') or
+0001d530: 2028 6372 735f 6f72 6720 6973 204e 6f6e   (crs_org is Non
+0001d540: 6529 3a0a 2020 2020 2020 2020 2020 2020  e):.            
+0001d550: 7072 696e 7428 2763 7273 2066 726f 6d20  print('crs from 
+0001d560: 7468 6520 706f 696e 7420 6765 6f70 616e  the point geopan
+0001d570: 6461 7320 6973 206e 6f74 2064 6566 696e  das is not defin
+0001d580: 6564 2061 6e64 2077 696c 6c20 6265 2061  ed and will be a
+0001d590: 7373 6967 6e65 6420 6173 2057 4753 3834  ssigned as WGS84
+0001d5a0: 2729 0a20 2020 2020 2020 2020 2020 2073  ').            s
+0001d5b0: 7461 7469 6f6e 7320 3d20 7374 6174 696f  tations = statio
+0001d5c0: 6e73 2e73 6574 5f63 7273 2827 6570 7367  ns.set_crs('epsg
+0001d5d0: 3a34 3332 3627 290a 2020 2020 2020 2020  :4326').        
+0001d5e0: 2020 2020 6372 735f 6f72 6720 3d20 7374      crs_org = st
+0001d5f0: 6174 696f 6e73 2e63 7273 0a20 2020 2020  ations.crs.     
+0001d600: 2020 2023 2061 6464 2074 6865 2049 445f     # add the ID_
+0001d610: 7420 746f 2074 6865 2070 6f69 6e74 2073  t to the point s
+0001d620: 6861 7065 6669 6c65 730a 2020 2020 2020  hapefiles.      
+0001d630: 2020 6966 206e 6f74 2049 445f 6669 656c    if not ID_fiel
+0001d640: 645f 6e61 6d65 3a0a 2020 2020 2020 2020  d_name:.        
+0001d650: 2020 2020 7374 6174 696f 6e73 205b 2749      stations ['I
+0001d660: 445f 7327 5d20 3d20 6e70 2e61 7261 6e67  D_s'] = np.arang
+0001d670: 6528 6c65 6e28 7374 6174 696f 6e73 2929  e(len(stations))
+0001d680: 2b31 0a20 2020 2020 2020 2020 2020 2073  +1.            s
+0001d690: 7461 7469 6f6e 7320 5b27 4944 5f73 275d  tations ['ID_s']
+0001d6a0: 203d 2073 7461 7469 6f6e 7320 5b27 4944   = stations ['ID
+0001d6b0: 5f73 275d 2e61 7374 7970 6528 696e 7429  _s'].astype(int)
+0001d6c0: 0a20 2020 2020 2020 2065 6c73 653a 0a20  .        else:. 
+0001d6d0: 2020 2020 2020 2020 2020 2073 7461 7469             stati
+0001d6e0: 6f6e 7320 5b27 4944 5f73 275d 203d 2073  ons ['ID_s'] = s
+0001d6f0: 7461 7469 6f6e 735b 4944 5f66 6965 6c64  tations[ID_field
+0001d700: 5f6e 616d 655d 2e61 7374 7970 6528 696e  _name].astype(in
+0001d710: 7429 0a20 2020 2020 2020 2073 7461 7469  t).        stati
+0001d720: 6f6e 7320 3d20 7374 6174 696f 6e73 2e73  ons = stations.s
+0001d730: 6f72 745f 7661 6c75 6573 2862 793d 2749  ort_values(by='I
+0001d740: 445f 7327 290a 2020 2020 2020 2020 4944  D_s').        ID
+0001d750: 5f73 203d 2073 7461 7469 6f6e 7320 5b27  _s = stations ['
+0001d760: 4944 5f73 275d 0a20 2020 2020 2020 2023  ID_s'].        #
+0001d770: 2067 6574 2074 6865 2074 6f74 616c 2062   get the total b
+0001d780: 6f75 6e64 6172 7920 6f66 2074 6865 2073  oundary of the s
+0001d790: 6861 7065 6669 6c65 0a20 2020 2020 2020  hapefile.       
+0001d7a0: 2073 7461 7469 6f6e 735f 6275 6666 6572   stations_buffer
+0001d7b0: 7420 3d20 7374 6174 696f 6e73 2e62 7566  t = stations.buf
+0001d7c0: 6665 7228 6275 6666 6572 2920 2320 6164  fer(buffer) # ad
+0001d7d0: 6420 6120 6275 6666 6572 0a20 2020 2020  d a buffer.     
+0001d7e0: 2020 206d 696e 782c 206d 696e 792c 206d     minx, miny, m
+0001d7f0: 6178 782c 206d 6178 7920 3d20 7374 6174  axx, maxy = stat
+0001d800: 696f 6e73 5f62 7566 6665 7274 2e74 6f74  ions_buffert.tot
+0001d810: 616c 5f62 6f75 6e64 730a 2020 2020 2020  al_bounds.      
+0001d820: 2020 6262 6f78 203d 2062 6f78 286d 696e    bbox = box(min
+0001d830: 782c 206d 696e 792c 206d 6178 782c 206d  x, miny, maxx, m
+0001d840: 6178 7929 0a20 2020 2020 2020 2067 6466  axy).        gdf
+0001d850: 203d 2067 7064 2e47 656f 4461 7461 4672   = gpd.GeoDataFr
+0001d860: 616d 6528 6765 6f6d 6574 7279 3d5b 6262  ame(geometry=[bb
+0001d870: 6f78 5d29 0a20 2020 2020 2020 2067 6466  ox]).        gdf
+0001d880: 2e74 6f5f 6669 6c65 2873 656c 662e 7465  .to_file(self.te
+0001d890: 6d70 5f64 6972 2b27 7465 7374 2e73 6870  mp_dir+'test.shp
+0001d8a0: 2729 0a20 2020 2020 2020 2023 2023 2063  ').        # # c
+0001d8b0: 7265 6174 6520 7468 6520 626f 756e 6469  reate the boundi
+0001d8c0: 6e67 2073 6861 7065 6669 6c65 0a20 2020  ng shapefile.   
+0001d8d0: 2020 2020 2023 2070 6172 7473 203d 205b       # parts = [
+0001d8e0: 5d0a 2020 2020 2020 2020 2320 7769 7468  ].        # with
+0001d8f0: 2073 6861 7065 6669 6c65 2e57 7269 7465   shapefile.Write
+0001d900: 7228 7365 6c66 2e74 656d 705f 6469 722b  r(self.temp_dir+
+0001d910: 2774 6573 742e 7368 7027 2920 6173 2077  'test.shp') as w
+0001d920: 3a0a 2020 2020 2020 2020 2320 2020 2020  :.        #     
+0001d930: 772e 6175 746f 4261 6c61 6e63 6520 3d20  w.autoBalance = 
+0001d940: 3120 2320 7475 726e 206f 6e20 6675 6e63  1 # turn on func
+0001d950: 7469 6f6e 2074 6861 7420 6b65 6570 7320  tion that keeps 
+0001d960: 6669 6c65 2073 7461 626c 6520 6966 206e  file stable if n
+0001d970: 756d 6265 7220 6f66 2073 6861 7065 7320  umber of shapes 
+0001d980: 616e 6420 7265 636f 7264 7320 646f 6e27  and records don'
+0001d990: 7420 6c69 6e65 2075 700a 2020 2020 2020  t line up.      
+0001d9a0: 2020 2320 2020 2020 772e 6669 656c 6428    #     w.field(
+0001d9b0: 2249 445f 626f 756e 6469 6e67 222c 274e  "ID_bounding",'N
+0001d9c0: 2729 2023 2063 7265 6174 6520 284e 2975  ') # create (N)u
+0001d9d0: 6d65 7269 6361 6c20 6174 7472 6962 7574  merical attribut
+0001d9e0: 6520 6669 656c 6473 2c20 696e 7465 6765  e fields, intege
+0001d9f0: 720a 2020 2020 2020 2020 2320 2020 2020  r.        #     
+0001da00: 2320 6372 6561 7469 6e67 2074 6865 2070  # creating the p
+0001da10: 6f6c 7967 6f6e 2067 6976 656e 2074 6865  olygon given the
+0001da20: 206c 6174 2061 6e64 206c 6f6e 0a20 2020   lat and lon.   
+0001da30: 2020 2020 2023 2020 2020 2070 6172 7473       #     parts
+0001da40: 2e61 7070 656e 6428 5b20 286d 696e 782c  .append([ (minx,
+0001da50: 206d 696e 7929 2c5c 0a20 2020 2020 2020   miny),\.       
+0001da60: 2023 2020 2020 2020 2020 2020 2020 2020   #              
+0001da70: 2020 2020 2020 286d 696e 782c 206d 6178        (minx, max
+0001da80: 7929 2c5c 0a20 2020 2020 2020 2023 2020  y),\.        #  
+0001da90: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001daa0: 2020 286d 6178 782c 206d 6178 7929 2c5c    (maxx, maxy),\
+0001dab0: 0a20 2020 2020 2020 2023 2020 2020 2020  .        #      
+0001dac0: 2020 2020 2020 2020 2020 2020 2020 286d                (m
+0001dad0: 6178 782c 206d 696e 7929 2c5c 0a20 2020  axx, miny),\.   
+0001dae0: 2020 2020 2023 2020 2020 2020 2020 2020       #          
+0001daf0: 2020 2020 2020 2020 2020 286d 696e 782c            (minx,
+0001db00: 206d 696e 7929 5d29 0a20 2020 2020 2020   miny)]).       
+0001db10: 2023 2020 2020 2023 2073 746f 7265 2070   #     # store p
+0001db20: 6f6c 7967 6f6e 0a20 2020 2020 2020 2023  olygon.        #
+0001db30: 2020 2020 2077 2e70 6f6c 7928 7061 7274       w.poly(part
+0001db40: 7329 0a20 2020 2020 2020 2023 2020 2020  s).        #    
+0001db50: 2023 2075 7064 6174 6520 7265 636f 7264   # update record
+0001db60: 732f 6669 656c 6473 2066 6f72 2074 6865  s/fields for the
+0001db70: 2070 6f6c 7967 6f6e 0a20 2020 2020 2020   polygon.       
+0001db80: 2023 2020 2020 2077 2e72 6563 6f72 6428   #     w.record(
+0001db90: 3129 0a0a 2020 2020 2020 2020 626f 756e  1)..        boun
+0001dba0: 6461 7279 203d 2067 7064 2e72 6561 645f  dary = gpd.read_
+0001dbb0: 6669 6c65 2873 656c 662e 7465 6d70 5f64  file(self.temp_d
+0001dbc0: 6972 2b27 7465 7374 2e73 6870 2729 0a20  ir+'test.shp'). 
+0001dbd0: 2020 2020 2020 2066 6f72 2066 2069 6e20         for f in 
+0001dbe0: 676c 6f62 2e67 6c6f 6228 7365 6c66 2e74  glob.glob(self.t
+0001dbf0: 656d 705f 6469 722b 2774 6573 742e 2a27  emp_dir+'test.*'
+0001dc00: 293a 0a20 2020 2020 2020 2020 2020 206f  ):.            o
+0001dc10: 732e 7265 6d6f 7665 2866 290a 2020 2020  s.remove(f).    
+0001dc20: 2020 2020 2320 6372 6561 7465 2074 6865      # create the
+0001dc30: 2076 6f72 6f6e 6920 6469 6167 7261 6d20   voroni diagram 
+0001dc40: 666f 7220 6769 7665 6e20 706f 696e 7420  for given point 
+0001dc50: 7368 6170 6566 696c 650a 2020 2020 2020  shapefile.      
+0001dc60: 2020 636f 6f72 6473 203d 2067 656f 766f    coords = geovo
+0001dc70: 726f 6e6f 692e 706f 696e 7473 5f74 6f5f  ronoi.points_to_
+0001dc80: 636f 6f72 6473 2873 7461 7469 6f6e 732e  coords(stations.
+0001dc90: 6765 6f6d 6574 7279 290a 2020 2020 2020  geometry).      
+0001dca0: 2020 706f 6c79 5f73 6861 7065 732c 206c    poly_shapes, l
+0001dcb0: 6f63 6174 696f 6e20 3d20 5c0a 2020 2020  ocation = \.    
+0001dcc0: 2020 2020 6765 6f76 6f72 6f6e 6f69 2e76      geovoronoi.v
+0001dcd0: 6f72 6f6e 6f69 5f72 6567 696f 6e73 5f66  oronoi_regions_f
+0001dce0: 726f 6d5f 636f 6f72 6473 2863 6f6f 7264  rom_coords(coord
+0001dcf0: 732c 2062 6f75 6e64 6172 792e 696c 6f63  s, boundary.iloc
+0001dd00: 5b30 5d2e 6765 6f6d 6574 7279 290a 2020  [0].geometry).  
+0001dd10: 2020 2020 2020 2320 7061 7373 2074 6520        # pass te 
+0001dd20: 706f 6c79 676f 6e73 2074 6f20 7368 6170  polygons to shap
+0001dd30: 6566 696c 650a 2020 2020 2020 2020 5468  efile.        Th
+0001dd40: 6965 7373 656e 203d 2067 7064 2e47 656f  iessen = gpd.Geo
+0001dd50: 4461 7461 4672 616d 6528 290a 2020 2020  DataFrame().    
+0001dd60: 2020 2020 666f 7220 6920 696e 206e 702e      for i in np.
+0001dd70: 6172 616e 6765 286c 656e 2870 6f6c 795f  arange(len(poly_
+0001dd80: 7368 6170 6573 2929 3a0a 2020 2020 2020  shapes)):.      
+0001dd90: 2020 2020 2020 5468 6965 7373 656e 2e6c        Thiessen.l
+0001dda0: 6f63 5b69 2c20 2767 656f 6d65 7472 7927  oc[i, 'geometry'
+0001ddb0: 5d20 3d20 506f 6c79 676f 6e28 706f 6c79  ] = Polygon(poly
+0001ddc0: 5f73 6861 7065 735b 695d 290a 2020 2020  _shapes[i]).    
+0001ddd0: 2020 2020 2020 2020 5468 6965 7373 656e          Thiessen
+0001dde0: 2e6c 6f63 5b69 2c20 2749 445f 7327 5d20  .loc[i, 'ID_s'] 
+0001ddf0: 2020 2020 3d20 7374 6174 696f 6e73 2e69      = stations.i
+0001de00: 6c6f 635b 6c6f 6361 7469 6f6e 5b69 5d5b  loc[location[i][
+0001de10: 305d 5d2e 4944 5f73 0a20 2020 2020 2020  0]].ID_s.       
+0001de20: 2054 6869 6573 7365 6e5b 2749 445f 7327   Thiessen['ID_s'
+0001de30: 5d20 3d20 5468 6965 7373 656e 5b27 4944  ] = Thiessen['ID
+0001de40: 5f73 275d 2e61 7374 7970 6528 696e 7429  _s'].astype(int)
+0001de50: 0a20 2020 2020 2020 2054 6869 6573 7365  .        Thiesse
+0001de60: 6e20 3d20 5468 6965 7373 656e 2e73 6f72  n = Thiessen.sor
+0001de70: 745f 7661 6c75 6573 2862 793d 2749 445f  t_values(by='ID_
+0001de80: 7327 2923 2073 6f72 7420 6f6e 2076 616c  s')# sort on val
+0001de90: 7565 730a 2020 2020 2020 2020 7374 6174  ues.        stat
+0001dea0: 696f 6e73 203d 2073 7461 7469 6f6e 732e  ions = stations.
+0001deb0: 6472 6f70 2863 6f6c 756d 6e73 3d27 6765  drop(columns='ge
+0001dec0: 6f6d 6574 7279 2729 0a20 2020 2020 2020  ometry').       
+0001ded0: 2054 6869 6573 7365 6e20 3d20 7064 2e6d   Thiessen = pd.m
+0001dee0: 6572 6765 5f61 736f 6628 5468 6965 7373  erge_asof(Thiess
+0001def0: 656e 2c20 7374 6174 696f 6e73 2c20 6f6e  en, stations, on
+0001df00: 3d27 4944 5f73 2729 2023 2c20 6469 7265  ='ID_s') #, dire
+0001df10: 6374 696f 6e3d 276e 6561 7265 7374 2729  ction='nearest')
+0001df20: 0a20 2020 2020 2020 2054 6869 6573 7365  .        Thiesse
+0001df30: 6e20 3d20 5468 6965 7373 656e 2e73 6574  n = Thiessen.set
+0001df40: 5f67 656f 6d65 7472 7928 2767 656f 6d65  _geometry('geome
+0001df50: 7472 7927 2920 2362 7269 6e67 2062 6163  try') #bring bac
+0001df60: 6b20 7468 6520 6765 6f6d 6574 7279 2066  k the geometry f
+0001df70: 696c 6564 3b20 7064 2074 6f20 6770 640a  iled; pd to gpd.
+0001df80: 2020 2020 2020 2020 5468 6965 7373 656e          Thiessen
+0001df90: 203d 2054 6869 6573 7365 6e2e 7365 745f   = Thiessen.set_
+0001dfa0: 6372 7328 6372 735f 6f72 6729 0a20 2020  crs(crs_org).   
+0001dfb0: 2020 2020 2049 445f 735f 5620 3d20 5468       ID_s_V = Th
+0001dfc0: 6965 7373 656e 5b27 4944 5f73 275d 0a20  iessen['ID_s']. 
+0001dfd0: 2020 2020 2020 2064 6966 6620 3d20 6e70         diff = np
+0001dfe0: 2e73 6574 6469 6666 3164 2849 445f 732c  .setdiff1d(ID_s,
+0001dff0: 2049 445f 735f 562c 2061 7373 756d 655f   ID_s_V, assume_
+0001e000: 756e 6971 7565 3d46 616c 7365 290a 2020  unique=False).  
+0001e010: 2020 2020 2020 6966 2064 6966 662e 7369        if diff.si
+0001e020: 7a65 2021 3d30 203a 0a20 2020 2020 2020  ze !=0 :.       
+0001e030: 2020 2020 2070 7269 6e74 2864 6966 6629       print(diff)
+0001e040: 0a20 2020 2020 2020 2020 2020 2073 7973  .            sys
+0001e050: 2e65 7869 7428 2749 7420 7365 656d 7320  .exit('It seems 
+0001e060: 7468 6520 696e 7075 7420 706f 696e 7473  the input points
+0001e070: 2077 6974 6820 7468 6520 666f 6c6c 6f77   with the follow
+0001e080: 696e 6720 4944 2064 6f20 6861 7665 2069  ing ID do have i
+0001e090: 6465 6e74 6963 616c 206c 6f6e 6769 7475  dentical longitu
+0001e0a0: 6465 2061 6e64 206c 6174 6974 7564 6527  de and latitude'
+0001e0b0: 290a 2020 2020 2020 2020 6966 206e 6f74  ).        if not
+0001e0c0: 2028 766f 726f 6e6f 695f 7368 705f 6669   (voronoi_shp_fi
+0001e0d0: 6c65 5f6e 616d 6520 6973 204e 6f6e 6529  le_name is None)
+0001e0e0: 3a0a 2020 2020 2020 2020 2020 2020 5468  :.            Th
+0001e0f0: 6965 7373 656e 2e74 6f5f 6669 6c65 2876  iessen.to_file(v
+0001e100: 6f72 6f6e 6f69 5f73 6870 5f66 696c 655f  oronoi_shp_file_
+0001e110: 6e61 6d65 290a 2020 2020 2020 2020 7265  name).        re
+0001e120: 7475 726e 2054 6869 6573 7365 6e0a 0a0a  turn Thiessen...
+0001e130: 2020 2020 2323 2323 2323 2323 2323 2323      ############
+0001e140: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+0001e150: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+0001e160: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+0001e170: 2323 0a20 2020 2023 2323 2320 7669 7375  ##.    #### visu
+0001e180: 616c 697a 6174 696f 6e20 7365 6374 696f  alization sectio
+0001e190: 6e0a 2020 2020 2323 2323 2323 2323 2323  n.    ##########
+0001e1a0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+0001e1b0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+0001e1c0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+0001e1d0: 2323 2323 0a0a 2020 2020 6465 6620 6e63  ####..    def nc
+0001e1e0: 5f76 6973 2873 656c 662c 0a20 2020 2020  _vis(self,.     
+0001e1f0: 2020 2020 2020 2020 2020 736f 7572 6365            source
+0001e200: 5f6e 635f 6e61 6d65 2020 2020 2020 2020  _nc_name        
+0001e210: 2020 2020 2020 2020 2020 3d20 4e6f 6e65            = None
+0001e220: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
+0001e230: 2073 6f75 7263 655f 6e63 5f76 6172 5f6c   source_nc_var_l
+0001e240: 6f6e 2020 2020 2020 2020 2020 2020 2020  on              
+0001e250: 203d 204e 6f6e 652c 0a20 2020 2020 2020   = None,.       
+0001e260: 2020 2020 2020 2020 736f 7572 6365 5f6e          source_n
+0001e270: 635f 7661 725f 6c61 7420 2020 2020 2020  c_var_lat       
+0001e280: 2020 2020 2020 2020 3d20 4e6f 6e65 2c0a          = None,.
+0001e290: 2020 2020 2020 2020 2020 2020 2020 2073                 s
+0001e2a0: 6f75 7263 655f 6e63 5f76 6172 5f49 4420  ource_nc_var_ID 
+0001e2b0: 2020 2020 2020 2020 2020 2020 2020 203d                 =
+0001e2c0: 204e 6f6e 652c 0a20 2020 2020 2020 2020   None,.         
+0001e2d0: 2020 2020 2020 736f 7572 6365 5f6e 635f        source_nc_
+0001e2e0: 7661 725f 7469 6d65 2020 2020 2020 2020  var_time        
+0001e2f0: 2020 2020 2020 3d20 4e6f 6e65 2c0a 2020        = None,.  
+0001e300: 2020 2020 2020 2020 2020 2020 2073 6f75               sou
+0001e310: 7263 655f 6e63 5f76 6172 5f6e 616d 6520  rce_nc_var_name 
+0001e320: 2020 2020 2020 2020 2020 2020 203d 204e               = N
+0001e330: 6f6e 652c 0a20 2020 2020 2020 2020 2020  one,.           
+0001e340: 2020 2020 736f 7572 6365 5f73 6870 5f6e      source_shp_n
+0001e350: 616d 6520 2020 2020 2020 2020 2020 2020  ame             
+0001e360: 2020 2020 3d20 4e6f 6e65 2c0a 2020 2020      = None,.    
+0001e370: 2020 2020 2020 2020 2020 2073 6f75 7263             sourc
+0001e380: 655f 7368 705f 6669 656c 645f 4944 2020  e_shp_field_ID  
+0001e390: 2020 2020 2020 2020 2020 203d 204e 6f6e             = Non
+0001e3a0: 652c 0a20 2020 2020 2020 2020 2020 2020  e,.             
+0001e3b0: 2020 736f 7572 6365 5f73 6870 5f66 6965    source_shp_fie
+0001e3c0: 6c64 5f6c 6174 2020 2020 2020 2020 2020  ld_lat          
+0001e3d0: 2020 3d20 4e6f 6e65 2c0a 2020 2020 2020    = None,.      
+0001e3e0: 2020 2020 2020 2020 2073 6f75 7263 655f           source_
+0001e3f0: 7368 705f 6669 656c 645f 6c6f 6e20 2020  shp_field_lon   
+0001e400: 2020 2020 2020 2020 203d 204e 6f6e 652c           = None,
+0001e410: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0001e420: 736f 7572 6365 5f73 6870 5f63 656e 7465  source_shp_cente
+0001e430: 725f 666c 6167 2020 2020 2020 2020 2020  r_flag          
+0001e440: 3d20 4661 6c73 652c 0a20 2020 2020 2020  = False,.       
+0001e450: 2020 2020 2020 2020 736f 7572 6365 5f73          source_s
+0001e460: 6870 5f63 656e 7465 725f 636f 6c6f 7220  hp_center_color 
+0001e470: 2020 2020 2020 2020 3d20 2772 6564 272c          = 'red',
+0001e480: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0001e490: 7265 6d61 7070 6564 5f6e 635f 6e61 6d65  remapped_nc_name
+0001e4a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001e4b0: 3d20 4e6f 6e65 2c0a 2020 2020 2020 2020  = None,.        
+0001e4c0: 2020 2020 2020 2072 656d 6170 7065 645f         remapped_
+0001e4d0: 6e63 5f76 6172 5f49 4420 2020 2020 2020  nc_var_ID       
+0001e4e0: 2020 2020 2020 203d 204e 6f6e 652c 0a20         = None,. 
+0001e4f0: 2020 2020 2020 2020 2020 2020 2020 7265                re
+0001e500: 6d61 7070 6564 5f6e 635f 7661 725f 7469  mapped_nc_var_ti
+0001e510: 6d65 2020 2020 2020 2020 2020 2020 3d20  me            = 
+0001e520: 4e6f 6e65 2c0a 2020 2020 2020 2020 2020  None,.          
+0001e530: 2020 2020 2072 656d 6170 7065 645f 6e63       remapped_nc
+0001e540: 5f76 6172 5f6e 616d 6520 2020 2020 2020  _var_name       
+0001e550: 2020 2020 203d 204e 6f6e 652c 0a20 2020       = None,.   
+0001e560: 2020 2020 2020 2020 2020 2020 7461 7267              targ
+0001e570: 6574 5f73 6870 5f6e 616d 6520 2020 2020  et_shp_name     
+0001e580: 2020 2020 2020 2020 2020 2020 3d20 4e6f              = No
+0001e590: 6e65 2c0a 2020 2020 2020 2020 2020 2020  ne,.            
+0001e5a0: 2020 2074 6172 6765 745f 7368 705f 6669     target_shp_fi
+0001e5b0: 656c 645f 4944 2020 2020 2020 2020 2020  eld_ID          
+0001e5c0: 2020 203d 204e 6f6e 652c 0a20 2020 2020     = None,.     
+0001e5d0: 2020 2020 2020 2020 2020 7461 7267 6574            target
+0001e5e0: 5f73 6870 5f66 6965 6c64 5f6c 6174 2020  _shp_field_lat  
+0001e5f0: 2020 2020 2020 2020 2020 3d20 4e6f 6e65            = None
+0001e600: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
+0001e610: 2074 6172 6765 745f 7368 705f 6669 656c   target_shp_fiel
+0001e620: 645f 6c6f 6e20 2020 2020 2020 2020 2020  d_lon           
+0001e630: 203d 204e 6f6e 652c 0a20 2020 2020 2020   = None,.       
+0001e640: 2020 2020 2020 2020 7461 7267 6574 5f73          target_s
+0001e650: 6870 5f63 656e 7465 725f 666c 6167 2020  hp_center_flag  
+0001e660: 2020 2020 2020 2020 3d20 4661 6c73 652c          = False,
+0001e670: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0001e680: 7461 7267 6574 5f73 6870 5f63 656e 7465  target_shp_cente
+0001e690: 725f 636f 6c6f 7220 2020 2020 2020 2020  r_color         
+0001e6a0: 3d20 2772 6564 272c 0a20 2020 2020 2020  = 'red',.       
+0001e6b0: 2020 2020 2020 2020 7469 6d65 5f73 7465          time_ste
+0001e6c0: 705f 6f66 5f76 697a 2020 2020 2020 2020  p_of_viz        
+0001e6d0: 2020 2020 2020 2020 3d20 4e6f 6e65 2c0a          = None,.
+0001e6e0: 2020 2020 2020 2020 2020 2020 2020 206c                 l
+0001e6f0: 6f63 6174 696f 6e5f 7361 7665 5f66 6967  ocation_save_fig
+0001e700: 2020 2020 2020 2020 2020 2020 2020 203d                 =
+0001e710: 204e 6f6e 652c 0a20 2020 2020 2020 2020   None,.         
+0001e720: 2020 2020 2020 6669 675f 6e61 6d65 2020        fig_name  
+0001e730: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001e740: 2020 2020 2020 3d20 4e6f 6e65 2c0a 2020        = None,.  
+0001e750: 2020 2020 2020 2020 2020 2020 2066 6967               fig
+0001e760: 5f73 697a 6520 2020 2020 2020 2020 2020  _size           
+0001e770: 2020 2020 2020 2020 2020 2020 203d 204e               = N
+0001e780: 6f6e 652c 0a20 2020 2020 2020 2020 2020  one,.           
+0001e790: 2020 2020 7368 6f77 5f74 6172 6765 745f      show_target_
+0001e7a0: 7368 705f 666c 6167 2020 2020 2020 2020  shp_flag        
+0001e7b0: 2020 2020 3d20 4e6f 6e65 2c0a 2020 2020      = None,.    
+0001e7c0: 2020 2020 2020 2020 2020 2073 686f 775f             show_
+0001e7d0: 7265 6d61 7070 6564 5f76 616c 7565 735f  remapped_values_
+0001e7e0: 666c 6167 2020 2020 2020 203d 204e 6f6e  flag       = Non
+0001e7f0: 652c 0a20 2020 2020 2020 2020 2020 2020  e,.             
+0001e800: 2020 7368 6f77 5f73 6f75 7263 655f 666c    show_source_fl
+0001e810: 6167 2020 2020 2020 2020 2020 2020 2020  ag              
+0001e820: 2020 3d20 5472 7565 2c0a 2020 2020 2020    = True,.      
+0001e830: 2020 2020 2020 2020 2063 6d61 7020 2020           cmap   
+0001e840: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001e850: 2020 2020 2020 2020 203d 204e 6f6e 652c           = None,
+0001e860: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0001e870: 6d61 7267 696e 2020 2020 2020 2020 2020  margin          
+0001e880: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001e890: 3d20 302e 312c 2023 6465 6772 6565 0a20  = 0.1, #degree. 
+0001e8a0: 2020 2020 2020 2020 2020 2020 2020 6c69                li
+0001e8b0: 6e65 7769 6474 685f 736f 7572 6365 2020  newidth_source  
+0001e8c0: 2020 2020 2020 2020 2020 2020 2020 3d20                = 
+0001e8d0: 312c 0a20 2020 2020 2020 2020 2020 2020  1,.             
+0001e8e0: 2020 6c69 6e65 7769 6474 685f 7265 6d61    linewidth_rema
+0001e8f0: 7070 6564 2020 2020 2020 2020 2020 2020  pped            
+0001e900: 2020 3d20 312c 0a20 2020 2020 2020 2020    = 1,.         
+0001e910: 2020 2020 2020 616c 7068 615f 736f 7572        alpha_sour
+0001e920: 6365 2020 2020 2020 2020 2020 2020 2020  ce              
+0001e930: 2020 2020 2020 3d20 312c 0a20 2020 2020        = 1,.     
+0001e940: 2020 2020 2020 2020 2020 616c 7068 615f            alpha_
+0001e950: 7265 6d61 7070 6564 2020 2020 2020 2020  remapped        
+0001e960: 2020 2020 2020 2020 2020 3d20 312c 0a20            = 1,. 
+0001e970: 2020 2020 2020 2020 2020 2020 2020 666f                fo
+0001e980: 6e74 5f73 697a 6520 2020 2020 2020 2020  nt_size         
+0001e990: 2020 2020 2020 2020 2020 2020 2020 3d20                = 
+0001e9a0: 3430 2c0a 2020 2020 2020 2020 2020 2020  40,.            
+0001e9b0: 2020 2066 6f6e 745f 6661 6d69 6c79 2020     font_family  
+0001e9c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001e9d0: 2020 203d 2027 5469 6d65 7320 4e65 7720     = 'Times New 
+0001e9e0: 526f 6d61 6e27 2c0a 2020 2020 2020 2020  Roman',.        
+0001e9f0: 2020 2020 2020 2066 6f6e 745f 7765 6967         font_weig
+0001ea00: 7468 2020 2020 2020 2020 2020 2020 2020  th              
+0001ea10: 2020 2020 2020 203d 2027 626f 6c64 272c         = 'bold',
+0001ea20: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0001ea30: 6164 645f 636f 6c6f 7262 6172 5f66 6c61  add_colorbar_fla
+0001ea40: 6720 2020 2020 2020 2020 2020 2020 2020  g               
+0001ea50: 3d20 5472 7565 2c0a 2020 2020 2020 2020  = True,.        
+0001ea60: 2020 2020 2020 206d 696e 5f76 616c 7565         min_value
+0001ea70: 5f63 6f6c 6f72 6261 7220 2020 2020 2020  _colorbar       
+0001ea80: 2020 2020 2020 203d 204e 6f6e 652c 0a20         = None,. 
+0001ea90: 2020 2020 2020 2020 2020 2020 2020 6d61                ma
+0001eaa0: 785f 7661 6c75 655f 636f 6c6f 7262 6172  x_value_colorbar
+0001eab0: 2020 2020 2020 2020 2020 2020 2020 3d20                = 
+0001eac0: 4e6f 6e65 2c0a 2020 2020 2020 2020 2020  None,.          
+0001ead0: 2020 2020 206d 696e 5f6c 6f6e 2020 2020       min_lon    
+0001eae0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001eaf0: 2020 2020 203d 204e 6f6e 652c 0a20 2020       = None,.   
+0001eb00: 2020 2020 2020 2020 2020 2020 6d69 6e5f              min_
+0001eb10: 6c61 7420 2020 2020 2020 2020 2020 2020  lat             
+0001eb20: 2020 2020 2020 2020 2020 2020 3d20 4e6f              = No
+0001eb30: 6e65 2c0a 2020 2020 2020 2020 2020 2020  ne,.            
+0001eb40: 2020 206d 6178 5f6c 6f6e 2020 2020 2020     max_lon      
+0001eb50: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001eb60: 2020 203d 204e 6f6e 652c 0a20 2020 2020     = None,.     
+0001eb70: 2020 2020 2020 2020 2020 6d61 785f 6c61            max_la
+0001eb80: 7420 2020 2020 2020 2020 2020 2020 2020  t               
+0001eb90: 2020 2020 2020 2020 2020 3d20 4e6f 6e65            = None
+0001eba0: 293a 0a0a 2020 2020 2020 2020 696d 706f  ):..        impo
+0001ebb0: 7274 2078 6172 7261 7920 2020 2020 2020  rt xarray       
+0001ebc0: 2020 2020 2020 2061 7320 2020 2020 2078         as      x
+0001ebd0: 720a 2020 2020 2020 2020 6672 6f6d 2020  r.        from  
+0001ebe0: 206d 6174 706c 6f74 6c69 6220 2020 2020   matplotlib     
+0001ebf0: 2020 2020 2069 6d70 6f72 7420 2070 7970       import  pyp
+0001ec00: 6c6f 7420 6173 2070 6c74 0a20 2020 2020  lot as plt.     
+0001ec10: 2020 2069 6d70 6f72 7420 6d61 7470 6c6f     import matplo
+0001ec20: 746c 6962 2020 2020 2020 2020 2020 6173  tlib          as
+0001ec30: 2020 2020 2020 6d70 6c0a 2020 2020 2020        mpl.      
+0001ec40: 2020 696d 706f 7274 2067 656f 7061 6e64    import geopand
+0001ec50: 6173 2020 2020 2020 2020 2020 2061 7320  as           as 
+0001ec60: 2020 2020 2067 7064 0a20 2020 2020 2020       gpd.       
+0001ec70: 2069 6d70 6f72 7420 7061 6e64 6173 2020   import pandas  
+0001ec80: 2020 2020 2020 2020 2020 2020 6173 2020              as  
+0001ec90: 2020 2020 7064 0a20 2020 2020 2020 2069      pd.        i
+0001eca0: 6d70 6f72 7420 6f73 0a20 2020 2020 2020  mport os.       
+0001ecb0: 2069 6d70 6f72 7420 6e75 6d70 7920 2020   import numpy   
+0001ecc0: 2020 2020 2020 2020 2020 2020 6173 2020              as  
+0001ecd0: 2020 2020 6e70 0a20 2020 2020 2020 2066      np.        f
+0001ece0: 726f 6d20 2020 6461 7465 7469 6d65 2020  rom   datetime  
+0001ecf0: 2020 2020 2020 2020 2020 696d 706f 7274            import
+0001ed00: 2020 6461 7465 7469 6d65 0a20 2020 2020    datetime.     
+0001ed10: 2020 2069 6d70 6f72 7420 7379 730a 2020     import sys.  
+0001ed20: 2020 2020 2020 230a 2020 2020 2020 2020        #.        
+0001ed30: 666f 6e74 203d 207b 2766 616d 696c 7927  font = {'family'
+0001ed40: 203a 2020 666f 6e74 5f66 616d 696c 792c   :  font_family,
+0001ed50: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0001ed60: 2027 7765 6967 6874 2720 3a20 2066 6f6e   'weight' :  fon
+0001ed70: 745f 7765 6967 7468 2c0a 2020 2020 2020  t_weigth,.      
+0001ed80: 2020 2020 2020 2020 2020 2773 697a 6527            'size'
+0001ed90: 2020 203a 2020 666f 6e74 5f73 697a 657d     :  font_size}
+0001eda0: 0a20 2020 2020 2020 206d 706c 2e72 6328  .        mpl.rc(
+0001edb0: 2766 6f6e 7427 2c20 2a2a 666f 6e74 290a  'font', **font).
+0001edc0: 2020 2020 2020 2020 230a 2020 2020 2020          #.      
+0001edd0: 2020 636f 6c6f 7262 6172 5f64 6f5f 6e6f    colorbar_do_no
+0001ede0: 745f 6578 6973 7473 203d 2054 7275 650a  t_exists = True.
+0001edf0: 2020 2020 2020 2020 2320 696e 6974 6961          # initia
+0001ee00: 6c69 7a69 6e67 2045 4153 594d 4f52 4520  lizing EASYMORE 
+0001ee10: 6f62 6a65 6374 2061 6e64 2066 696e 6420  object and find 
+0001ee20: 7468 6520 6361 7365 206f 6620 736f 7572  the case of sour
+0001ee30: 6365 206e 6574 6364 6620 6669 6c65 0a20  ce netcdf file. 
+0001ee40: 2020 2020 2020 2023 2063 6865 636b 206f         # check o
+0001ee50: 6620 7468 6520 736f 7572 6365 5f6e 635f  f the source_nc_
+0001ee60: 6e61 6d65 7320 6973 2073 7472 696e 6720  names is string 
+0001ee70: 616e 6420 646f 6573 6e74 2068 6176 6520  and doesnt have 
+0001ee80: 2a20 696e 2069 740a 2020 2020 2020 2020  * in it.        
+0001ee90: 6966 2069 7369 6e73 7461 6e63 6528 736f  if isinstance(so
+0001eea0: 7572 6365 5f6e 635f 6e61 6d65 2c20 7374  urce_nc_name, st
+0001eeb0: 7229 3a0a 2020 2020 2020 2020 2020 2020  r):.            
+0001eec0: 6966 2028 272a 2720 696e 2073 6f75 7263  if ('*' in sourc
+0001eed0: 655f 6e63 5f6e 616d 6529 3a0a 2020 2020  e_nc_name):.    
+0001eee0: 2020 2020 2020 2020 2020 2020 7379 732e              sys.
+0001eef0: 6578 6974 2827 796f 7520 7368 6f75 6c64  exit('you should
+0001ef00: 2070 726f 7669 6465 206f 6e65 2066 696c   provide one fil
+0001ef10: 6520 6e61 6d65 2061 7320 7374 7269 6e67  e name as string
+0001ef20: 2061 6e64 2064 6f20 6e6f 7420 7573 6520   and do not use 
+0001ef30: 2a20 2729 0a20 2020 2020 2020 2065 6c73  * ').        els
+0001ef40: 653a 0a20 2020 2020 2020 2020 2020 2073  e:.            s
+0001ef50: 7973 2e65 7869 7428 2773 6f75 7263 6520  ys.exit('source 
+0001ef60: 6e63 206e 616d 6520 7368 6f75 6c64 2062  nc name should b
+0001ef70: 6520 7374 7269 6e67 2061 6e64 2077 6974  e string and wit
+0001ef80: 686f 7574 202a 2c20 7368 6f75 6c64 2062  hout *, should b
+0001ef90: 6520 7468 6520 6c69 6e6b 2074 6f20 6f6e  e the link to on
+0001efa0: 6520 6669 6c65 2729 0a20 2020 2020 2020  e file').       
+0001efb0: 2073 656c 662e 736f 7572 6365 5f6e 6320   self.source_nc 
+0001efc0: 3d20 736f 7572 6365 5f6e 635f 6e61 6d65  = source_nc_name
+0001efd0: 2023 2070 6173 7320 7468 6174 2074 6f20   # pass that to 
+0001efe0: 7468 6520 6561 7379 6d6f 7265 206f 626a  the easymore obj
+0001eff0: 6563 740a 2020 2020 2020 2020 2320 6368  ect.        # ch
+0001f000: 6563 6b20 6f66 2074 6865 2073 6f75 7263  eck of the sourc
+0001f010: 655f 6e63 5f6e 616d 6573 0a20 2020 2020  e_nc_names.     
+0001f020: 2020 2069 6620 6973 696e 7374 616e 6365     if isinstance
+0001f030: 2873 6f75 7263 655f 6e63 5f76 6172 5f6e  (source_nc_var_n
+0001f040: 616d 652c 2073 7472 293a 0a20 2020 2020  ame, str):.     
+0001f050: 2020 2020 2020 2073 656c 662e 7661 725f         self.var_
+0001f060: 6e61 6d65 7320 2020 2020 2020 2020 2020  names           
+0001f070: 203d 205b 736f 7572 6365 5f6e 635f 7661   = [source_nc_va
+0001f080: 725f 6e61 6d65 5d20 2320 7374 7269 6e67  r_name] # string
+0001f090: 2074 6f20 6c69 7374 0a20 2020 2020 2020   to list.       
+0001f0a0: 2065 6c73 653a 0a20 2020 2020 2020 2020   else:.         
+0001f0b0: 2020 2073 7973 2e65 7869 7428 2774 6865     sys.exit('the
+0001f0c0: 2076 6172 6961 626c 6520 7368 6f75 6c64   variable should
+0001f0d0: 2062 6520 6f6e 6c79 206f 6e65 2061 6e64   be only one and
+0001f0e0: 2069 6e20 7374 7269 6e67 2066 6f72 6d61   in string forma
+0001f0f0: 7427 290a 2020 2020 2020 2020 7365 6c66  t').        self
+0001f100: 2e76 6172 5f6c 6f6e 2020 2020 2020 2020  .var_lon        
+0001f110: 2020 2020 2020 2020 2020 3d20 736f 7572            = sour
+0001f120: 6365 5f6e 635f 7661 725f 6c6f 6e0a 2020  ce_nc_var_lon.  
+0001f130: 2020 2020 2020 7365 6c66 2e76 6172 5f6c        self.var_l
+0001f140: 6174 2020 2020 2020 2020 2020 2020 2020  at              
+0001f150: 2020 2020 3d20 736f 7572 6365 5f6e 635f      = source_nc_
+0001f160: 7661 725f 6c61 740a 2020 2020 2020 2020  var_lat.        
+0001f170: 230a 2020 2020 2020 2020 7265 6d61 7070  #.        remapp
+0001f180: 6564 5f6e 635f 6578 6973 7473 203d 2046  ed_nc_exists = F
+0001f190: 616c 7365 0a20 2020 2020 2020 2069 6620  alse.        if 
+0001f1a0: 7265 6d61 7070 6564 5f6e 635f 6e61 6d65  remapped_nc_name
+0001f1b0: 3a0a 2020 2020 2020 2020 2020 2020 7265  :.            re
+0001f1c0: 6d61 7070 6564 5f6e 635f 6578 6973 7473  mapped_nc_exists
+0001f1d0: 203d 2054 7275 650a 2020 2020 2020 2020   = True.        
+0001f1e0: 2320 6465 6369 6469 6e67 2074 6865 2063  # deciding the c
+0001f1f0: 6173 650a 2020 2020 2020 2020 7365 6c66  ase.        self
+0001f200: 2e4e 6574 4344 465f 5348 505f 6c61 745f  .NetCDF_SHP_lat_
+0001f210: 6c6f 6e28 2920 2320 746f 2066 696e 6420  lon() # to find 
+0001f220: 7468 6520 6361 7365 2061 6e64 206c 6174  the case and lat
+0001f230: 2f6c 6f6e 0a20 2020 2020 2020 2023 0a20  /lon.        #. 
+0001f240: 2020 2020 2020 2064 735f 736f 7572 6365         ds_source
+0001f250: 203d 2078 722e 6f70 656e 5f64 6174 6173   = xr.open_datas
+0001f260: 6574 2873 6f75 7263 655f 6e63 5f6e 616d  et(source_nc_nam
+0001f270: 6529 2023 2073 6f75 7263 650a 2020 2020  e) # source.    
+0001f280: 2020 2020 6966 2073 6f75 7263 655f 7368      if source_sh
+0001f290: 705f 6e61 6d65 3a0a 2020 2020 2020 2020  p_name:.        
+0001f2a0: 2020 2020 7368 705f 736f 7572 6365 203d      shp_source =
+0001f2b0: 2067 7064 2e72 6561 645f 6669 6c65 2873   gpd.read_file(s
+0001f2c0: 6f75 7263 655f 7368 705f 6e61 6d65 290a  ource_shp_name).
+0001f2d0: 2020 2020 2020 2020 2320 6765 7420 7468          # get th
+0001f2e0: 6520 7374 6570 2066 6f72 2074 6865 2072  e step for the r
+0001f2f0: 656d 6170 7065 640a 2020 2020 2020 2020  emapped.        
+0001f300: 6461 7465 203d 2070 642e 4461 7465 7469  date = pd.Dateti
+0001f310: 6d65 496e 6465 7828 6473 5f73 6f75 7263  meIndex(ds_sourc
+0001f320: 655b 736f 7572 6365 5f6e 635f 7661 725f  e[source_nc_var_
+0001f330: 7469 6d65 5d2e 6474 2e73 7472 6674 696d  time].dt.strftim
+0001f340: 6528 2725 592d 256d 2d25 6420 2548 3a25  e('%Y-%m-%d %H:%
+0001f350: 4d3a 2553 2729 290a 2020 2020 2020 2020  M:%S')).        
+0001f360: 6466 203d 2070 642e 4461 7461 4672 616d  df = pd.DataFram
+0001f370: 6528 6e70 2e61 7261 6e67 6528 6c65 6e28  e(np.arange(len(
+0001f380: 6461 7465 2929 2c0a 2020 2020 2020 2020  date)),.        
+0001f390: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001f3a0: 2020 636f 6c75 6d6e 733d 5b22 7374 6570    columns=["step
+0001f3b0: 225d 2c0a 2020 2020 2020 2020 2020 2020  "],.            
+0001f3c0: 2020 2020 2020 2020 2020 2020 2020 696e                in
+0001f3d0: 6465 783d 6461 7465 290a 2020 2020 2020  dex=date).      
+0001f3e0: 2020 6466 5b27 7469 6d65 7374 616d 7027    df['timestamp'
+0001f3f0: 5d20 3d20 6466 2e69 6e64 6578 2e73 7472  ] = df.index.str
+0001f400: 6674 696d 6528 2725 592d 256d 2d25 6420  ftime('%Y-%m-%d 
+0001f410: 2548 3a25 4d3a 2553 2729 0a20 2020 2020  %H:%M:%S').     
+0001f420: 2020 2023 2064 665f 736c 6963 6520 3d20     # df_slice = 
+0001f430: 6466 2e69 6c6f 635b 6466 2e69 6e64 6578  df.iloc[df.index
+0001f440: 2e67 6574 5f69 6e64 6578 6572 2864 6174  .get_indexer(dat
+0001f450: 6574 696d 652e 7374 7270 7469 6d65 2874  etime.strptime(t
+0001f460: 696d 655f 7374 6570 5f6f 665f 7669 7a2c  ime_step_of_viz,
+0001f470: 5c0a 2020 2020 2020 2020 2320 2020 2020  \.        #     
+0001f480: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001f490: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001f4a0: 2020 2020 2020 2020 2020 2020 2725 592d              '%Y-
+0001f4b0: 256d 2d25 6420 2548 3a25 4d3a 2553 2729  %m-%d %H:%M:%S')
+0001f4c0: 2c6d 6574 686f 643d 276e 6561 7265 7374  ,method='nearest
+0001f4d0: 2729 5d0a 2020 2020 2020 2020 6964 7820  ')].        idx 
+0001f4e0: 3d20 6466 2e69 6e64 6578 2e67 6574 5f69  = df.index.get_i
+0001f4f0: 6e64 6578 6572 285b 7064 2e54 696d 6573  ndexer([pd.Times
+0001f500: 7461 6d70 2874 696d 655f 7374 6570 5f6f  tamp(time_step_o
+0001f510: 665f 7669 7a29 5d2c 206d 6574 686f 643d  f_viz)], method=
+0001f520: 276e 6561 7265 7374 2729 2e69 7465 6d28  'nearest').item(
+0001f530: 290a 2020 2020 2020 2020 6466 5f73 6c69  ).        df_sli
+0001f540: 6365 203d 2064 662e 696c 6f63 5b69 6478  ce = df.iloc[idx
+0001f550: 3a69 6478 2b31 5d0a 2020 2020 2020 2020  :idx+1].        
+0001f560: 7374 6570 203d 2064 665f 736c 6963 655b  step = df_slice[
+0001f570: 2773 7465 7027 5d2e 6974 656d 2829 0a20  'step'].item(). 
+0001f580: 2020 2020 2020 2074 696d 655f 7374 616d         time_stam
+0001f590: 7020 3d20 6466 5f73 6c69 6365 5b27 7469  p = df_slice['ti
+0001f5a0: 6d65 7374 616d 7027 5d2e 6974 656d 2829  mestamp'].item()
+0001f5b0: 0a20 2020 2020 2020 2070 7269 6e74 2827  .        print('
+0001f5c0: 7468 6520 636c 6f73 6573 7420 7469 6d65  the closest time
+0001f5d0: 2073 7465 7020 746f 2077 6861 7420 6973   step to what is
+0001f5e0: 2070 726f 7669 6465 6420 666f 7220 7669   provided for vi
+0001f5f0: 7a75 616c 697a 6174 696f 6e20 272c 2074  zualization ', t
+0001f600: 696d 655f 7374 6570 5f6f 665f 7669 7a2c  ime_step_of_viz,
+0001f610: 5c0a 2020 2020 2020 2020 2020 2020 2020  \.              
+0001f620: 2720 6973 2027 2c20 7469 6d65 5f73 7461  ' is ', time_sta
+0001f630: 6d70 290a 2020 2020 2020 2020 2320 6c6f  mp).        # lo
+0001f640: 6164 2074 6865 2064 6174 6120 616e 6420  ad the data and 
+0001f650: 6765 7420 7468 6520 6d61 7820 616e 6420  get the max and 
+0001f660: 6d69 6e20 7661 6c75 6573 206f 6620 7265  min values of re
+0001f670: 6d70 7061 6564 2066 696c 6520 666f 7220  mppaed file for 
+0001f680: 7468 6520 7461 6172 6765 7420 7661 7269  the taarget vari
+0001f690: 6162 6c65 0a20 2020 2020 2020 206d 6178  able.        max
+0001f6a0: 5f76 616c 7565 203d 2064 735f 736f 7572  _value = ds_sour
+0001f6b0: 6365 5b73 6f75 7263 655f 6e63 5f76 6172  ce[source_nc_var
+0001f6c0: 5f6e 616d 655d 2e73 656c 2874 696d 653d  _name].sel(time=
+0001f6d0: 7469 6d65 5f73 7461 6d70 2c20 6d65 7468  time_stamp, meth
+0001f6e0: 6f64 3d27 6e65 6172 6573 7427 292e 6d61  od='nearest').ma
+0001f6f0: 7828 292e 6974 656d 2829 2023 2067 6574  x().item() # get
+0001f700: 2074 6865 206d 6178 206f 6620 7265 6d61   the max of rema
+0001f710: 7070 6564 0a20 2020 2020 2020 206d 696e  pped.        min
+0001f720: 5f76 616c 7565 203d 2064 735f 736f 7572  _value = ds_sour
+0001f730: 6365 5b73 6f75 7263 655f 6e63 5f76 6172  ce[source_nc_var
+0001f740: 5f6e 616d 655d 2e73 656c 2874 696d 653d  _name].sel(time=
+0001f750: 7469 6d65 5f73 7461 6d70 2c20 6d65 7468  time_stamp, meth
+0001f760: 6f64 3d27 6e65 6172 6573 7427 292e 6d69  od='nearest').mi
+0001f770: 6e28 292e 6974 656d 2829 2023 2067 6574  n().item() # get
+0001f780: 2074 6865 206d 696e 206f 6620 7265 6d61   the min of rema
+0001f790: 7070 6564 0a20 2020 2020 2020 2070 7269  pped.        pri
+0001f7a0: 6e74 2827 6d69 6e3a 207b 7d2c 206d 6178  nt('min: {}, max
+0001f7b0: 3a20 7b7d 2066 6f72 2076 6172 6961 626c  : {} for variabl
+0001f7c0: 653a 207b 7d20 696e 2073 6f75 7263 6520  e: {} in source 
+0001f7d0: 6e63 2066 696c 6520 666f 7220 7468 6520  nc file for the 
+0001f7e0: 7469 6d65 2073 7465 703a 207b 7d27 2e66  time step: {}'.f
+0001f7f0: 6f72 6d61 7428 5c0a 2020 2020 2020 2020  ormat(\.        
+0001f800: 2020 2020 6d69 6e5f 7661 6c75 652c 206d      min_value, m
+0001f810: 6178 5f76 616c 7565 2c20 736f 7572 6365  ax_value, source
+0001f820: 5f6e 635f 7661 725f 6e61 6d65 2c20 7469  _nc_var_name, ti
+0001f830: 6d65 5f73 7461 6d70 2929 0a20 2020 2020  me_stamp)).     
+0001f840: 2020 2023 2063 6865 636b 2069 6620 7265     # check if re
+0001f850: 6d61 7070 6564 2066 696c 6520 6578 6973  mapped file exis
+0001f860: 7473 2061 6e64 2063 6865 636b 2074 6865  ts and check the
+0001f870: 2074 696d 6520 7661 7269 6162 6c65 7320   time variables 
+0001f880: 746f 2073 6f75 7263 6520 6e63 2066 696c  to source nc fil
+0001f890: 650a 2020 2020 2020 2020 6966 2072 656d  e.        if rem
+0001f8a0: 6170 7065 645f 6e63 5f65 7869 7374 733a  apped_nc_exists:
+0001f8b0: 0a20 2020 2020 2020 2020 2020 2064 735f  .            ds_
+0001f8c0: 7265 6d61 7070 6564 203d 2078 722e 6f70  remapped = xr.op
+0001f8d0: 656e 5f64 6174 6173 6574 2872 656d 6170  en_dataset(remap
+0001f8e0: 7065 645f 6e63 5f6e 616d 6529 2023 2074  ped_nc_name) # t
+0001f8f0: 6865 2072 656d 6170 206f 6620 6162 6f76  he remap of abov
+0001f900: 650a 2020 2020 2020 2020 2020 2020 2320  e.            # 
+0001f910: 6368 6563 6b20 6966 2074 6865 2074 696d  check if the tim
+0001f920: 6573 2061 7265 2069 6465 6e74 6963 616c  es are identical
+0001f930: 2069 6e20 736f 7572 6365 2061 6e64 2072   in source and r
+0001f940: 656d 6170 7065 640a 2020 2020 2020 2020  emapped.        
+0001f950: 2020 2020 6966 206e 6f74 2064 735f 736f      if not ds_so
+0001f960: 7572 6365 5b73 6f75 7263 655f 6e63 5f76  urce[source_nc_v
+0001f970: 6172 5f74 696d 655d 2e65 7175 616c 7328  ar_time].equals(
+0001f980: 6473 5f72 656d 6170 7065 645b 7265 6d61  ds_remapped[rema
+0001f990: 7070 6564 5f6e 635f 7661 725f 7469 6d65  pped_nc_var_time
+0001f9a0: 5d29 3a0a 2020 2020 2020 2020 2020 2020  ]):.            
+0001f9b0: 2020 2020 7379 732e 6578 6974 2827 5468      sys.exit('Th
+0001f9c0: 6520 736f 7572 6365 2061 6e64 2072 656d  e source and rem
+0001f9d0: 6170 7065 6420 6669 6c65 7320 7365 656d  apped files seem
+0001f9e0: 7320 746f 2068 6176 6520 6469 6666 6572  s to have differ
+0001f9f0: 656e 7420 7469 6d65 3b20 6d61 6b65 2073  ent time; make s
+0001fa00: 7572 6520 272b 5c0a 2020 2020 2020 2020  ure '+\.        
+0001fa10: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001fa20: 2027 7468 6520 7265 6d61 7070 6564 2066   'the remapped f
+0001fa30: 696c 6573 2069 7320 6672 6f6d 2074 6865  iles is from the
+0001fa40: 2073 616d 6520 736f 7572 6365 2066 696c   same source fil
+0001fa50: 652e 2729 0a20 2020 2020 2020 2020 2020  e.').           
+0001fa60: 2023 2075 7064 6174 6520 7468 6520 6d61   # update the ma
+0001fa70: 7820 6d69 6e20 7661 6c75 6520 6261 7365  x min value base
+0001fa80: 6420 6f6e 2072 656d 6170 7065 640a 2020  d on remapped.  
+0001fa90: 2020 2020 2020 2020 2020 6d61 785f 7661            max_va
+0001faa0: 6c75 6520 3d20 6473 5f72 656d 6170 7065  lue = ds_remappe
+0001fab0: 645b 7265 6d61 7070 6564 5f6e 635f 7661  d[remapped_nc_va
+0001fac0: 725f 6e61 6d65 5d2e 7365 6c28 7469 6d65  r_name].sel(time
+0001fad0: 3d74 696d 655f 7374 616d 702c 206d 6574  =time_stamp, met
+0001fae0: 686f 643d 276e 6561 7265 7374 2729 2e6d  hod='nearest').m
+0001faf0: 6178 2829 2e69 7465 6d28 2920 2320 6765  ax().item() # ge
+0001fb00: 7420 7468 6520 6d61 7820 6f66 2072 656d  t the max of rem
+0001fb10: 6170 7065 640a 2020 2020 2020 2020 2020  apped.          
+0001fb20: 2020 6d69 6e5f 7661 6c75 6520 3d20 6473    min_value = ds
+0001fb30: 5f72 656d 6170 7065 645b 7265 6d61 7070  _remapped[remapp
+0001fb40: 6564 5f6e 635f 7661 725f 6e61 6d65 5d2e  ed_nc_var_name].
+0001fb50: 7365 6c28 7469 6d65 3d74 696d 655f 7374  sel(time=time_st
+0001fb60: 616d 702c 206d 6574 686f 643d 276e 6561  amp, method='nea
+0001fb70: 7265 7374 2729 2e6d 696e 2829 2e69 7465  rest').min().ite
+0001fb80: 6d28 2920 2320 6765 7420 7468 6520 6d69  m() # get the mi
+0001fb90: 6e20 6f66 2072 656d 6170 7065 640a 2020  n of remapped.  
+0001fba0: 2020 2020 2020 2020 2020 7072 696e 7428            print(
+0001fbb0: 276d 696e 3a20 7b7d 2c20 6d61 783a 207b  'min: {}, max: {
+0001fbc0: 7d20 666f 7220 7661 7269 6162 6c65 3a20  } for variable: 
+0001fbd0: 7b7d 2069 6e20 7265 6d61 7070 6564 206e  {} in remapped n
+0001fbe0: 6320 6669 6c65 2066 6f72 2074 6865 2074  c file for the t
+0001fbf0: 696d 6520 7374 6570 3a20 7b7d 272e 666f  ime step: {}'.fo
+0001fc00: 726d 6174 285c 0a20 2020 2020 2020 2020  rmat(\.         
+0001fc10: 2020 206d 696e 5f76 616c 7565 2c20 6d61     min_value, ma
+0001fc20: 785f 7661 6c75 652c 2072 656d 6170 7065  x_value, remappe
+0001fc30: 645f 6e63 5f76 6172 5f6e 616d 652c 2074  d_nc_var_name, t
+0001fc40: 696d 655f 7374 616d 7029 290a 2020 2020  ime_stamp)).    
+0001fc50: 2020 2020 2020 2020 230a 2020 2020 2020          #.      
+0001fc60: 2020 2020 2020 7368 705f 7461 7267 6574        shp_target
+0001fc70: 203d 2067 7064 2e72 6561 645f 6669 6c65   = gpd.read_file
+0001fc80: 2874 6172 6765 745f 7368 705f 6e61 6d65  (target_shp_name
+0001fc90: 2920 2320 6c6f 6164 2074 6865 2074 6172  ) # load the tar
+0001fca0: 6765 7420 7368 6170 6566 696c 650a 2020  get shapefile.  
+0001fcb0: 2020 2020 2020 2020 2020 6966 2028 6d69            if (mi
+0001fcc0: 6e5f 6c6f 6e20 6973 204e 6f6e 6529 206f  n_lon is None) o
+0001fcd0: 7220 286d 696e 5f6c 6174 2069 7320 4e6f  r (min_lat is No
+0001fce0: 6e65 2920 6f72 2028 6d61 785f 6c6f 6e20  ne) or (max_lon 
+0001fcf0: 6973 204e 6f6e 6529 206f 7220 286d 6178  is None) or (max
+0001fd00: 5f6c 6174 2069 7320 4e6f 6e65 293a 0a20  _lat is None):. 
+0001fd10: 2020 2020 2020 2020 2020 2020 2020 206d                 m
+0001fd20: 696e 5f6c 6f6e 2c20 6d69 6e5f 6c61 742c  in_lon, min_lat,
+0001fd30: 206d 6178 5f6c 6f6e 2c20 6d61 785f 6c61   max_lon, max_la
+0001fd40: 7420 3d20 7368 705f 7461 7267 6574 2e74  t = shp_target.t
+0001fd50: 6f74 616c 5f62 6f75 6e64 730a 2020 2020  otal_bounds.    
+0001fd60: 2020 2020 2320 636f 7272 6563 7420 6d69      # correct mi
+0001fd70: 6e20 616e 6420 6d61 7820 6966 2074 6865  n and max if the
+0001fd80: 2061 7265 2067 6976 656e 0a20 2020 2020   are given.     
+0001fd90: 2020 2069 6620 6d69 6e5f 7661 6c75 655f     if min_value_
+0001fda0: 636f 6c6f 7262 6172 3a0a 2020 2020 2020  colorbar:.      
+0001fdb0: 2020 2020 2020 6d69 6e5f 7661 6c75 6520        min_value 
+0001fdc0: 3d20 6d69 6e5f 7661 6c75 655f 636f 6c6f  = min_value_colo
+0001fdd0: 7262 6172 0a20 2020 2020 2020 2020 2020  rbar.           
+0001fde0: 2070 7269 6e74 2827 6d69 6e20 7661 6c75   print('min valu
+0001fdf0: 6573 2066 6f72 2063 6f6c 6f72 6261 7220  es for colorbar 
+0001fe00: 6973 2070 726f 7669 6465 6420 6173 3a20  is provided as: 
+0001fe10: 272c 6d69 6e5f 7661 6c75 6529 0a20 2020  ',min_value).   
+0001fe20: 2020 2020 2069 6620 6d61 785f 7661 6c75       if max_valu
+0001fe30: 655f 636f 6c6f 7262 6172 3a0a 2020 2020  e_colorbar:.    
+0001fe40: 2020 2020 2020 2020 6d61 785f 7661 6c75          max_valu
+0001fe50: 6520 3d20 6d61 785f 7661 6c75 655f 636f  e = max_value_co
+0001fe60: 6c6f 7262 6172 0a20 2020 2020 2020 2020  lorbar.         
+0001fe70: 2020 2070 7269 6e74 2827 6d61 7820 7661     print('max va
+0001fe80: 6c75 6573 2066 6f72 2063 6f6c 6f72 6261  lues for colorba
+0001fe90: 7220 6973 2070 726f 7669 6465 6420 6173  r is provided as
+0001fea0: 3a20 272c 6d61 785f 7661 6c75 6529 0a20  : ',max_value). 
+0001feb0: 2020 2020 2020 2023 2076 6973 7561 6c69         # visuali
+0001fec0: 7a65 0a20 2020 2020 2020 2066 6967 2c20  ze.        fig, 
+0001fed0: 6178 203d 2070 6c74 2e73 7562 706c 6f74  ax = plt.subplot
+0001fee0: 7328 6669 6773 697a 653d 6669 675f 7369  s(figsize=fig_si
+0001fef0: 7a65 290a 2020 2020 2020 2020 6669 672e  ze).        fig.
+0001ff00: 7365 745f 6661 6365 636f 6c6f 7228 2277  set_facecolor("w
+0001ff10: 6869 7465 2229 0a20 2020 2020 2020 2069  hite").        i
+0001ff20: 6620 2873 656c 662e 6361 7365 203d 3d20  f (self.case == 
+0001ff30: 3120 6f72 2073 656c 662e 6361 7365 203d  1 or self.case =
+0001ff40: 3d32 2920 616e 6420 7368 6f77 5f73 6f75  =2) and show_sou
+0001ff50: 7263 655f 666c 6167 3a0a 2020 2020 2020  rce_flag:.      
+0001ff60: 2020 2020 2020 6473 5f73 6f75 7263 655b        ds_source[
+0001ff70: 736f 7572 6365 5f6e 635f 7661 725f 6e61  source_nc_var_na
+0001ff80: 6d65 5d2e 7365 6c28 7469 6d65 3d74 696d  me].sel(time=tim
+0001ff90: 655f 7374 616d 702c 206d 6574 686f 643d  e_stamp, method=
+0001ffa0: 276e 6561 7265 7374 2729 2e70 6c6f 742e  'nearest').plot.
+0001ffb0: 7063 6f6c 6f72 6d65 7368 2878 3d73 6f75  pcolormesh(x=sou
+0001ffc0: 7263 655f 6e63 5f76 6172 5f6c 6f6e 2c0a  rce_nc_var_lon,.
+0001ffd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001ffe0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001fff0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00020000: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00020010: 793d 736f 7572 6365 5f6e 635f 7661 725f  y=source_nc_var_
+00020020: 6c61 742c 0a20 2020 2020 2020 2020 2020  lat,.           
+00020030: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00020040: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00020050: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00020060: 2020 2020 2061 6464 5f63 6f6c 6f72 6261       add_colorba
+00020070: 723d 6164 645f 636f 6c6f 7262 6172 5f66  r=add_colorbar_f
+00020080: 6c61 672c 0a20 2020 2020 2020 2020 2020  lag,.           
+00020090: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000200a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000200b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000200c0: 2020 2020 2061 7820 3d20 6178 2c0a 2020       ax = ax,.  
+000200d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000200e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000200f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00020100: 2020 2020 2020 2020 2020 2020 2020 636d                cm
+00020110: 6170 3d63 6d61 702c 0a20 2020 2020 2020  ap=cmap,.       
+00020120: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00020130: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00020140: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00020150: 2020 2020 2020 2020 2076 6d69 6e3d 6d69           vmin=mi
+00020160: 6e5f 7661 6c75 652c 0a20 2020 2020 2020  n_value,.       
+00020170: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00020180: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00020190: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000201a0: 2020 2020 2020 2020 2076 6d61 783d 6d61           vmax=ma
+000201b0: 785f 7661 6c75 652c 0a20 2020 2020 2020  x_value,.       
+000201c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000201d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000201e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000201f0: 2020 2020 2020 2020 2061 6c70 6861 3d61           alpha=a
+00020200: 6c70 6861 5f73 6f75 7263 6529 0a20 2020  lpha_source).   
+00020210: 2020 2020 2020 2020 2063 6f6c 6f72 6261           colorba
+00020220: 725f 646f 5f6e 6f74 5f65 7869 7374 7320  r_do_not_exists 
+00020230: 3d20 4661 6c73 650a 2020 2020 2020 2020  = False.        
+00020240: 6966 2073 656c 662e 6361 7365 203d 3d20  if self.case == 
+00020250: 3320 616e 6420 7368 6f77 5f73 6f75 7263  3 and show_sourc
+00020260: 655f 666c 6167 3a0a 2020 2020 2020 2020  e_flag:.        
+00020270: 2020 2020 2320 6461 7461 6672 616d 650a      # dataframe.
+00020280: 2020 2020 2020 2020 2020 2020 6466 203d              df =
+00020290: 2070 642e 4461 7461 4672 616d 6528 290a   pd.DataFrame().
+000202a0: 2020 2020 2020 2020 2020 2020 6466 205b              df [
+000202b0: 2749 4427 5d20 3d20 6473 5f73 6f75 7263  'ID'] = ds_sourc
+000202c0: 655b 736f 7572 6365 5f6e 635f 7661 725f  e[source_nc_var_
+000202d0: 4944 5d5b 3a5d 2e76 616c 7565 732e 6173  ID][:].values.as
+000202e0: 7479 7065 2869 6e74 290a 2020 2020 2020  type(int).      
+000202f0: 2020 2020 2020 6466 205b 2776 616c 7565        df ['value
+00020300: 275d 203d 2064 735f 736f 7572 6365 5b73  '] = ds_source[s
+00020310: 6f75 7263 655f 6e63 5f76 6172 5f6e 616d  ource_nc_var_nam
+00020320: 655d 2e73 656c 2874 696d 653d 7469 6d65  e].sel(time=time
+00020330: 5f73 7461 6d70 2c20 6d65 7468 6f64 3d27  _stamp, method='
+00020340: 6e65 6172 6573 7427 2920 2320 6173 7375  nearest') # assu
+00020350: 6d65 7320 7469 6d65 7320 6973 2066 6972  mes times is fir
+00020360: 7374 0a20 2020 2020 2020 2020 2020 2064  st.            d
+00020370: 6620 3d20 6466 2e73 6f72 745f 7661 6c75  f = df.sort_valu
+00020380: 6573 2862 793d 5b27 4944 275d 290a 2020  es(by=['ID']).  
+00020390: 2020 2020 2020 2020 2020 6466 203d 2064            df = d
+000203a0: 662e 7265 7365 745f 696e 6465 7828 6472  f.reset_index(dr
+000203b0: 6f70 3d54 7275 6529 0a20 2020 2020 2020  op=True).       
+000203c0: 2020 2020 2023 2073 6861 7065 6669 6c65       # shapefile
+000203d0: 0a20 2020 2020 2020 2020 2020 2073 6870  .            shp
+000203e0: 5f73 6f75 7263 655b 736f 7572 6365 5f73  _source[source_s
+000203f0: 6870 5f66 6965 6c64 5f49 445d 203d 2073  hp_field_ID] = s
+00020400: 6870 5f73 6f75 7263 655b 736f 7572 6365  hp_source[source
+00020410: 5f73 6870 5f66 6965 6c64 5f49 445d 2e61  _shp_field_ID].a
+00020420: 7374 7970 6528 696e 7429 0a20 2020 2020  stype(int).     
+00020430: 2020 2020 2020 2073 6870 5f73 6f75 7263         shp_sourc
+00020440: 6520 3d20 7368 705f 736f 7572 6365 5b73  e = shp_source[s
+00020450: 6870 5f73 6f75 7263 655b 736f 7572 6365  hp_source[source
+00020460: 5f73 6870 5f66 6965 6c64 5f49 445d 2e69  _shp_field_ID].i
+00020470: 7369 6e28 6466 5b27 4944 275d 295d 0a20  sin(df['ID'])]. 
+00020480: 2020 2020 2020 2020 2020 2073 6870 5f73             shp_s
+00020490: 6f75 7263 6520 3d20 7368 705f 736f 7572  ource = shp_sour
+000204a0: 6365 2e73 6f72 745f 7661 6c75 6573 2862  ce.sort_values(b
+000204b0: 793d 5b73 6f75 7263 655f 7368 705f 6669  y=[source_shp_fi
+000204c0: 656c 645f 4944 5d29 0a20 2020 2020 2020  eld_ID]).       
+000204d0: 2020 2020 2073 6870 5f73 6f75 7263 6520       shp_source 
+000204e0: 3d20 7368 705f 736f 7572 6365 2e72 6573  = shp_source.res
+000204f0: 6574 5f69 6e64 6578 2864 726f 703d 5472  et_index(drop=Tr
+00020500: 7565 290a 2020 2020 2020 2020 2020 2020  ue).            
+00020510: 2320 7061 7373 2074 6865 2076 616c 7565  # pass the value
+00020520: 7320 6672 6f6d 2064 6174 6172 616d 6520  s from datarame 
+00020530: 746f 2067 656f 7061 6e64 6173 2061 6e64  to geopandas and
+00020540: 2076 6973 7561 7a6c 6965 0a20 2020 2020   visuazlie.     
+00020550: 2020 2020 2020 2073 6870 5f73 6f75 7263         shp_sourc
+00020560: 6520 5b27 7661 6c75 6527 5d20 3d20 6466  e ['value'] = df
+00020570: 205b 2776 616c 7565 275d 0a20 2020 2020   ['value'].     
+00020580: 2020 2020 2020 2073 6870 5f73 6f75 7263         shp_sourc
+00020590: 652e 706c 6f74 2863 6f6c 756d 6e3d 2776  e.plot(column='v
+000205a0: 616c 7565 272c 0a20 2020 2020 2020 2020  alue',.         
+000205b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000205c0: 2020 2065 6467 6563 6f6c 6f72 3d27 6b27     edgecolor='k'
+000205d0: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
+000205e0: 2020 2020 2020 2020 2020 2020 2020 6c69                li
+000205f0: 6e65 7769 6474 683d 6c69 6e65 7769 6474  newidth=linewidt
+00020600: 685f 736f 7572 6365 2c0a 2020 2020 2020  h_source,.      
+00020610: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00020620: 2020 2020 2020 6178 3d61 782c 0a20 2020        ax=ax,.   
+00020630: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00020640: 2020 2020 2020 2020 2063 6d61 703d 636d           cmap=cm
+00020650: 6170 2c0a 2020 2020 2020 2020 2020 2020  ap,.            
+00020660: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00020670: 766d 696e 3d6d 696e 5f76 616c 7565 2c0a  vmin=min_value,.
+00020680: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00020690: 2020 2020 2020 2020 2020 2020 766d 6178              vmax
+000206a0: 3d6d 6178 5f76 616c 7565 2c0a 2020 2020  =max_value,.    
+000206b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000206c0: 2020 2020 2020 2020 616c 7068 613d 616c          alpha=al
+000206d0: 7068 615f 736f 7572 6365 290a 2020 2020  pha_source).    
+000206e0: 2020 2020 2020 2020 6966 2061 6464 5f63          if add_c
+000206f0: 6f6c 6f72 6261 725f 666c 6167 3a0a 2020  olorbar_flag:.  
+00020700: 2020 2020 2020 2020 2020 2020 2020 2320                # 
+00020710: 7072 6f76 6964 6520 7468 6520 7469 6d65  provide the time
+00020720: 2061 6e64 2064 6174 6520 616e 6420 6f74   and date and ot
+00020730: 6865 7220 7061 7261 6d65 7465 7273 0a20  her parameters. 
+00020740: 2020 2020 2020 2020 2020 2020 2020 2061                 a
+00020750: 782e 7365 745f 7469 746c 6528 2774 696d  x.set_title('tim
+00020760: 653a 2027 2b74 696d 655f 7374 616d 7029  e: '+time_stamp)
+00020770: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00020780: 2061 782e 7365 745f 786c 6162 656c 2827   ax.set_xlabel('
+00020790: 6c6f 6e67 6974 7564 6527 290a 2020 2020  longitude').    
+000207a0: 2020 2020 2020 2020 2020 2020 6178 2e73              ax.s
+000207b0: 6574 5f79 6c61 6265 6c28 276c 6174 6974  et_ylabel('latit
+000207c0: 7564 6527 290a 2020 2020 2020 2020 2020  ude').          
+000207d0: 2020 2020 2020 6e6f 726d 203d 206d 706c        norm = mpl
+000207e0: 2e63 6f6c 6f72 732e 4e6f 726d 616c 697a  .colors.Normaliz
+000207f0: 6528 766d 696e 3d6d 696e 5f76 616c 7565  e(vmin=min_value
+00020800: 2c20 766d 6178 3d6d 6178 5f76 616c 7565  , vmax=max_value
+00020810: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
+00020820: 2020 6362 6172 203d 2066 6967 2e63 6f6c    cbar = fig.col
+00020830: 6f72 6261 7228 6d70 6c2e 636d 2e53 6361  orbar(mpl.cm.Sca
+00020840: 6c61 724d 6170 7061 626c 6528 6e6f 726d  larMappable(norm
+00020850: 3d6e 6f72 6d2c 2063 6d61 703d 636d 6170  =norm, cmap=cmap
+00020860: 292c 2061 783d 6178 290a 2020 2020 2020  ), ax=ax).      
+00020870: 2020 2020 2020 2020 2020 6966 2027 756e            if 'un
+00020880: 6974 7327 2069 6e20 6473 5f73 6f75 7263  its' in ds_sourc
+00020890: 655b 736f 7572 6365 5f6e 635f 7661 725f  e[source_nc_var_
+000208a0: 6e61 6d65 5d2e 6174 7472 732e 6b65 7973  name].attrs.keys
+000208b0: 2829 3a0a 2020 2020 2020 2020 2020 2020  ():.            
+000208c0: 2020 2020 2020 2020 756e 6974 5f6e 616d          unit_nam
+000208d0: 6520 3d20 6473 5f73 6f75 7263 655b 736f  e = ds_source[so
+000208e0: 7572 6365 5f6e 635f 7661 725f 6e61 6d65  urce_nc_var_name
+000208f0: 5d2e 6174 7472 735b 2275 6e69 7473 225d  ].attrs["units"]
+00020900: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00020910: 2020 2020 2063 6261 722e 6178 2e73 6574       cbar.ax.set
+00020920: 5f79 6c61 6265 6c28 736f 7572 6365 5f6e  _ylabel(source_n
+00020930: 635f 7661 725f 6e61 6d65 2b27 205b 272b  c_var_name+' ['+
+00020940: 756e 6974 5f6e 616d 652b 275d 2729 0a20  unit_name+']'). 
+00020950: 2020 2020 2020 2020 2020 2020 2020 2065                 e
+00020960: 6c73 653a 0a20 2020 2020 2020 2020 2020  lse:.           
+00020970: 2020 2020 2020 2020 2063 6261 722e 6178           cbar.ax
+00020980: 2e73 6574 5f79 6c61 6265 6c28 7265 6d61  .set_ylabel(rema
+00020990: 7070 6564 5f6e 635f 7661 725f 6e61 6d65  pped_nc_var_name
+000209a0: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
+000209b0: 2020 636f 6c6f 7262 6172 5f64 6f5f 6e6f    colorbar_do_no
+000209c0: 745f 6578 6973 7473 203d 2046 616c 7365  t_exists = False
+000209d0: 0a20 2020 2020 2020 2069 6620 736f 7572  .        if sour
+000209e0: 6365 5f73 6870 5f63 656e 7465 725f 666c  ce_shp_center_fl
+000209f0: 6167 3a20 2320 6164 6420 706f 696e 7473  ag: # add points
+00020a00: 2069 6e74 6f20 7468 6520 736f 7572 6365   into the source
+00020a10: 2073 7563 6820 6173 2063 656e 7472 6f69   such as centroi
+00020a20: 640a 2020 2020 2020 2020 2020 2020 6966  d.            if
+00020a30: 2073 6f75 7263 655f 7368 705f 6e61 6d65   source_shp_name
+00020a40: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+00020a50: 2020 7368 705f 736f 7572 6365 203d 2067    shp_source = g
+00020a60: 7064 2e72 6561 645f 6669 6c65 2873 6f75  pd.read_file(sou
+00020a70: 7263 655f 7368 705f 6e61 6d65 290a 2020  rce_shp_name).  
+00020a80: 2020 2020 2020 2020 2020 656c 7365 3a0a            else:.
+00020a90: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00020aa0: 7379 732e 6578 6974 2827 536f 7572 6365  sys.exit('Source
+00020ab0: 2073 6861 7065 6669 6c65 2069 7320 6e6f   shapefile is no
+00020ac0: 7420 7072 6f76 6964 6564 2077 6869 6c65  t provided while
+00020ad0: 2073 6f75 7263 655f 7368 705f 6365 6e74   source_shp_cent
+00020ae0: 6572 5f66 6c61 6720 6973 205c 0a20 2020  er_flag is \.   
+00020af0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00020b00: 2073 6574 2074 6f20 7472 7565 2c20 7072   set to true, pr
+00020b10: 6f76 6964 6520 736f 7572 6365 2073 6861  ovide source sha
+00020b20: 7065 6669 6c65 2077 6974 6820 6c61 7420  pefile with lat 
+00020b30: 616e 6420 6c6f 6e27 290a 2020 2020 2020  and lon').      
+00020b40: 2020 2020 2020 7368 705f 736f 7572 6365        shp_source
+00020b50: 5f70 6f69 6e74 7320 3d20 7368 705f 736f  _points = shp_so
+00020b60: 7572 6365 2e63 6f70 7928 290a 2020 2020  urce.copy().    
+00020b70: 2020 2020 2020 2020 6372 735f 6f72 6720          crs_org 
+00020b80: 3d20 7368 705f 736f 7572 6365 5f70 6f69  = shp_source_poi
+00020b90: 6e74 732e 6372 730a 2020 2020 2020 2020  nts.crs.        
+00020ba0: 2020 2020 7368 705f 736f 7572 6365 5f70      shp_source_p
+00020bb0: 6f69 6e74 7320 3d20 7368 705f 736f 7572  oints = shp_sour
+00020bc0: 6365 5f70 6f69 6e74 732e 6472 6f70 2863  ce_points.drop(c
+00020bd0: 6f6c 756d 6e73 3d5b 2767 656f 6d65 7472  olumns=['geometr
+00020be0: 7927 5d29 0a20 2020 2020 2020 2020 2020  y']).           
+00020bf0: 2073 6870 5f70 6f69 6e74 7320 3d20 7365   shp_points = se
+00020c00: 6c66 2e6d 616b 655f 7368 6170 655f 706f  lf.make_shape_po
+00020c10: 696e 7428 7368 705f 736f 7572 6365 5f70  int(shp_source_p
+00020c20: 6f69 6e74 732c 2073 6f75 7263 655f 7368  oints, source_sh
+00020c30: 705f 6669 656c 645f 6c6f 6e2c 2073 6f75  p_field_lon, sou
+00020c40: 7263 655f 7368 705f 6669 656c 645f 6c61  rce_shp_field_la
+00020c50: 742c 2063 7273 3d63 7273 5f6f 7267 290a  t, crs=crs_org).
+00020c60: 2020 2020 2020 2020 2020 2020 7368 705f              shp_
+00020c70: 706f 696e 7473 2e70 6c6f 7428 636f 6c6f  points.plot(colo
+00020c80: 723d 736f 7572 6365 5f73 6870 5f63 656e  r=source_shp_cen
+00020c90: 7465 725f 636f 6c6f 722c 2061 783d 6178  ter_color, ax=ax
+00020ca0: 290a 2020 2020 2020 2020 6966 2072 656d  ).        if rem
+00020cb0: 6170 7065 645f 6e63 5f65 7869 7374 733a  apped_nc_exists:
+00020cc0: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
+00020cd0: 7368 6f77 5f72 656d 6170 7065 645f 7661  show_remapped_va
+00020ce0: 6c75 6573 5f66 6c61 673a 0a20 2020 2020  lues_flag:.     
+00020cf0: 2020 2020 2020 2020 2020 2073 686f 775f             show_
+00020d00: 7461 7267 6574 5f73 6870 5f66 6c61 6720  target_shp_flag 
+00020d10: 3d20 4661 6c73 650a 2020 2020 2020 2020  = False.        
+00020d20: 2020 2020 6966 2073 686f 775f 7461 7267      if show_targ
+00020d30: 6574 5f73 6870 5f66 6c61 673a 0a20 2020  et_shp_flag:.   
+00020d40: 2020 2020 2020 2020 2020 2020 2073 6870               shp
+00020d50: 5f74 6172 6765 742e 6765 6f6d 6574 7279  _target.geometry
+00020d60: 2e62 6f75 6e64 6172 792e 706c 6f74 2863  .boundary.plot(c
+00020d70: 6f6c 6f72 3d4e 6f6e 652c 6564 6765 636f  olor=None,edgeco
+00020d80: 6c6f 723d 276b 272c 6c69 6e65 7769 6474  lor='k',linewidt
+00020d90: 6820 3d20 6c69 6e65 7769 6474 685f 7265  h = linewidth_re
+00020da0: 6d61 7070 6564 2c20 6178 203d 2061 7829  mapped, ax = ax)
+00020db0: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
+00020dc0: 7368 6f77 5f72 656d 6170 7065 645f 7661  show_remapped_va
+00020dd0: 6c75 6573 5f66 6c61 673a 0a20 2020 2020  lues_flag:.     
+00020de0: 2020 2020 2020 2020 2020 2023 2064 6174             # dat
+00020df0: 6166 7261 6d65 0a20 2020 2020 2020 2020  aframe.         
+00020e00: 2020 2020 2020 2064 6620 3d20 7064 2e44         df = pd.D
+00020e10: 6174 6146 7261 6d65 2829 0a20 2020 2020  ataFrame().     
+00020e20: 2020 2020 2020 2020 2020 2064 6620 5b27             df ['
+00020e30: 4944 275d 203d 2064 735f 7265 6d61 7070  ID'] = ds_remapp
+00020e40: 6564 5b72 656d 6170 7065 645f 6e63 5f76  ed[remapped_nc_v
+00020e50: 6172 5f49 445d 5b3a 5d2e 7661 6c75 6573  ar_ID][:].values
+00020e60: 2e61 7374 7970 6528 696e 7429 0a20 2020  .astype(int).   
+00020e70: 2020 2020 2020 2020 2020 2020 2064 6620               df 
+00020e80: 5b27 7661 6c75 6527 5d20 3d20 6473 5f72  ['value'] = ds_r
+00020e90: 656d 6170 7065 645b 7265 6d61 7070 6564  emapped[remapped
+00020ea0: 5f6e 635f 7661 725f 6e61 6d65 5d2e 7365  _nc_var_name].se
+00020eb0: 6c28 7469 6d65 3d74 696d 655f 7374 616d  l(time=time_stam
+00020ec0: 702c 6d65 7468 6f64 3d27 6e65 6172 6573  p,method='neares
+00020ed0: 7427 290a 2020 2020 2020 2020 2020 2020  t').            
+00020ee0: 2020 2020 6466 203d 2064 662e 736f 7274      df = df.sort
+00020ef0: 5f76 616c 7565 7328 6279 3d5b 2749 4427  _values(by=['ID'
+00020f00: 5d29 0a20 2020 2020 2020 2020 2020 2020  ]).             
+00020f10: 2020 2064 6620 3d20 6466 2e72 6573 6574     df = df.reset
+00020f20: 5f69 6e64 6578 2864 726f 703d 5472 7565  _index(drop=True
+00020f30: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
+00020f40: 2020 2320 7368 6170 6566 696c 650a 2020    # shapefile.  
+00020f50: 2020 2020 2020 2020 2020 2020 2020 7368                sh
+00020f60: 705f 7461 7267 6574 5b74 6172 6765 745f  p_target[target_
+00020f70: 7368 705f 6669 656c 645f 4944 5d20 3d20  shp_field_ID] = 
+00020f80: 7368 705f 7461 7267 6574 5b74 6172 6765  shp_target[targe
+00020f90: 745f 7368 705f 6669 656c 645f 4944 5d2e  t_shp_field_ID].
+00020fa0: 6173 7479 7065 2869 6e74 290a 2020 2020  astype(int).    
+00020fb0: 2020 2020 2020 2020 2020 2020 7368 705f              shp_
+00020fc0: 7461 7267 6574 203d 2073 6870 5f74 6172  target = shp_tar
+00020fd0: 6765 745b 7368 705f 7461 7267 6574 5b74  get[shp_target[t
+00020fe0: 6172 6765 745f 7368 705f 6669 656c 645f  arget_shp_field_
+00020ff0: 4944 5d2e 6973 696e 2864 665b 2749 4427  ID].isin(df['ID'
+00021000: 5d29 5d0a 2020 2020 2020 2020 2020 2020  ])].            
+00021010: 2020 2020 7368 705f 7461 7267 6574 203d      shp_target =
+00021020: 2073 6870 5f74 6172 6765 742e 736f 7274   shp_target.sort
+00021030: 5f76 616c 7565 7328 6279 3d5b 7461 7267  _values(by=[targ
+00021040: 6574 5f73 6870 5f66 6965 6c64 5f49 445d  et_shp_field_ID]
+00021050: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
+00021060: 2020 7368 705f 7461 7267 6574 203d 2073    shp_target = s
+00021070: 6870 5f74 6172 6765 742e 7265 7365 745f  hp_target.reset_
+00021080: 696e 6465 7828 6472 6f70 3d54 7275 6529  index(drop=True)
+00021090: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+000210a0: 2023 2070 6173 7320 7468 6520 7661 6c75   # pass the valu
+000210b0: 6573 2066 726f 6d20 6461 7461 7261 6d65  es from datarame
+000210c0: 2074 6f20 6765 6f70 616e 6461 7320 616e   to geopandas an
+000210d0: 6420 7669 7375 617a 6c69 650a 2020 2020  d visuazlie.    
+000210e0: 2020 2020 2020 2020 2020 2020 7368 705f              shp_
+000210f0: 7461 7267 6574 205b 2776 616c 7565 275d  target ['value']
+00021100: 203d 2064 6620 5b27 7661 6c75 6527 5d0a   = df ['value'].
+00021110: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00021120: 7368 705f 7461 7267 6574 2e70 6c6f 7428  shp_target.plot(
+00021130: 636f 6c75 6d6e 3d27 7661 6c75 6527 2c0a  column='value',.
+00021140: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00021150: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00021160: 6564 6765 636f 6c6f 723d 276b 272c 0a20  edgecolor='k',. 
+00021170: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00021180: 2020 2020 2020 2020 2020 2020 2020 206c                 l
+00021190: 696e 6577 6964 7468 3d6c 696e 6577 6964  inewidth=linewid
+000211a0: 7468 5f72 656d 6170 7065 642c 0a20 2020  th_remapped,.   
+000211b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000211c0: 2020 2020 2020 2020 2020 2020 2061 783d               ax=
+000211d0: 6178 2c0a 2020 2020 2020 2020 2020 2020  ax,.            
+000211e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000211f0: 2020 2020 636d 6170 3d63 6d61 702c 0a20      cmap=cmap,. 
+00021200: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00021210: 2020 2020 2020 2020 2020 2020 2020 2076                 v
+00021220: 6d69 6e3d 6d69 6e5f 7661 6c75 652c 0a20  min=min_value,. 
+00021230: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00021240: 2020 2020 2020 2020 2020 2020 2020 2076                 v
+00021250: 6d61 783d 6d61 785f 7661 6c75 652c 0a20  max=max_value,. 
+00021260: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00021270: 2020 2020 2020 2020 2020 2020 2020 2061                 a
+00021280: 6c70 6861 3d61 6c70 6861 5f72 656d 6170  lpha=alpha_remap
+00021290: 7065 6429 0a20 2020 2020 2020 2020 2020  ped).           
+000212a0: 2069 6620 6164 645f 636f 6c6f 7262 6172   if add_colorbar
+000212b0: 5f66 6c61 6720 616e 6420 2863 6f6c 6f72  _flag and (color
+000212c0: 6261 725f 646f 5f6e 6f74 5f65 7869 7374  bar_do_not_exist
+000212d0: 7329 3a0a 2020 2020 2020 2020 2020 2020  s):.            
+000212e0: 2020 2020 2320 7072 6f76 6964 6520 7468      # provide th
+000212f0: 6520 7469 6d65 2061 6e64 2064 6174 6520  e time and date 
+00021300: 616e 6420 6f74 6865 7220 7061 7261 6d65  and other parame
+00021310: 7465 7273 0a20 2020 2020 2020 2020 2020  ters.           
+00021320: 2020 2020 2061 782e 7365 745f 7469 746c       ax.set_titl
+00021330: 6528 2774 696d 653a 2027 2b74 696d 655f  e('time: '+time_
+00021340: 7374 616d 7029 0a20 2020 2020 2020 2020  stamp).         
+00021350: 2020 2020 2020 2061 782e 7365 745f 786c         ax.set_xl
+00021360: 6162 656c 2827 6c6f 6e67 6974 7564 6527  abel('longitude'
+00021370: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
+00021380: 2020 6178 2e73 6574 5f79 6c61 6265 6c28    ax.set_ylabel(
+00021390: 276c 6174 6974 7564 6527 290a 2020 2020  'latitude').    
+000213a0: 2020 2020 2020 2020 2020 2020 6e6f 726d              norm
+000213b0: 203d 206d 706c 2e63 6f6c 6f72 732e 4e6f   = mpl.colors.No
+000213c0: 726d 616c 697a 6528 766d 696e 3d6d 696e  rmalize(vmin=min
+000213d0: 5f76 616c 7565 2c20 766d 6178 3d6d 6178  _value, vmax=max
+000213e0: 5f76 616c 7565 290a 2020 2020 2020 2020  _value).        
+000213f0: 2020 2020 2020 2020 6362 6172 203d 2066          cbar = f
+00021400: 6967 2e63 6f6c 6f72 6261 7228 6d70 6c2e  ig.colorbar(mpl.
+00021410: 636d 2e53 6361 6c61 724d 6170 7061 626c  cm.ScalarMappabl
+00021420: 6528 6e6f 726d 3d6e 6f72 6d2c 2063 6d61  e(norm=norm, cma
+00021430: 703d 636d 6170 292c 2061 783d 6178 290a  p=cmap), ax=ax).
+00021440: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00021450: 6966 2027 756e 6974 7327 2069 6e20 6473  if 'units' in ds
+00021460: 5f72 656d 6170 7065 645b 7265 6d61 7070  _remapped[remapp
+00021470: 6564 5f6e 635f 7661 725f 6e61 6d65 5d2e  ed_nc_var_name].
+00021480: 6174 7472 732e 6b65 7973 2829 3a0a 2020  attrs.keys():.  
+00021490: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000214a0: 2020 756e 6974 5f6e 616d 6520 3d20 6473    unit_name = ds
+000214b0: 5f72 656d 6170 7065 645b 7265 6d61 7070  _remapped[remapp
+000214c0: 6564 5f6e 635f 7661 725f 6e61 6d65 5d2e  ed_nc_var_name].
+000214d0: 6174 7472 735b 2275 6e69 7473 225d 0a20  attrs["units"]. 
+000214e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000214f0: 2020 2063 6261 722e 6178 2e73 6574 5f79     cbar.ax.set_y
+00021500: 6c61 6265 6c28 7265 6d61 7070 6564 5f6e  label(remapped_n
+00021510: 635f 7661 725f 6e61 6d65 2b27 205b 272b  c_var_name+' ['+
+00021520: 756e 6974 5f6e 616d 652b 275d 2729 0a20  unit_name+']'). 
+00021530: 2020 2020 2020 2020 2020 2020 2020 2065                 e
+00021540: 6c73 653a 0a20 2020 2020 2020 2020 2020  lse:.           
+00021550: 2020 2020 2020 2020 2063 6261 722e 6178           cbar.ax
+00021560: 2e73 6574 5f79 6c61 6265 6c28 7265 6d61  .set_ylabel(rema
+00021570: 7070 6564 5f6e 635f 7661 725f 6e61 6d65  pped_nc_var_name
+00021580: 290a 2020 2020 2020 2020 2020 2020 6966  ).            if
+00021590: 2074 6172 6765 745f 7368 705f 6365 6e74   target_shp_cent
+000215a0: 6572 5f66 6c61 673a 2023 2061 6464 2070  er_flag: # add p
+000215b0: 6f69 6e74 7320 696e 746f 2074 6865 2073  oints into the s
+000215c0: 6f75 7263 6520 7375 6368 2061 7320 6365  ource such as ce
+000215d0: 6e74 726f 6964 0a20 2020 2020 2020 2020  ntroid.         
+000215e0: 2020 2020 2020 2073 6870 5f74 6172 6765         shp_targe
+000215f0: 745f 706f 696e 7473 203d 2073 6870 5f74  t_points = shp_t
+00021600: 6172 6765 742e 636f 7079 2829 0a20 2020  arget.copy().   
+00021610: 2020 2020 2020 2020 2020 2020 2063 7273               crs
+00021620: 5f6f 7267 203d 2073 6870 5f74 6172 6765  _org = shp_targe
+00021630: 745f 706f 696e 7473 2e63 7273 0a20 2020  t_points.crs.   
+00021640: 2020 2020 2020 2020 2020 2020 2073 6870               shp
+00021650: 5f74 6172 6765 745f 706f 696e 7473 203d  _target_points =
+00021660: 2073 6870 5f74 6172 6765 745f 706f 696e   shp_target_poin
+00021670: 7473 2e64 726f 7028 636f 6c75 6d6e 733d  ts.drop(columns=
+00021680: 5b27 6765 6f6d 6574 7279 275d 290a 2020  ['geometry']).  
+00021690: 2020 2020 2020 2020 2020 2020 2020 7368                sh
+000216a0: 705f 706f 696e 7473 203d 2073 656c 662e  p_points = self.
+000216b0: 6d61 6b65 5f73 6861 7065 5f70 6f69 6e74  make_shape_point
+000216c0: 2873 6870 5f74 6172 6765 745f 706f 696e  (shp_target_poin
+000216d0: 7473 2c20 7461 7267 6574 5f73 6870 5f66  ts, target_shp_f
+000216e0: 6965 6c64 5f6c 6f6e 2c20 7461 7267 6574  ield_lon, target
+000216f0: 5f73 6870 5f66 6965 6c64 5f6c 6174 2c20  _shp_field_lat, 
+00021700: 6372 733d 6372 735f 6f72 6729 0a20 2020  crs=crs_org).   
+00021710: 2020 2020 2020 2020 2020 2020 2073 6870               shp
+00021720: 5f70 6f69 6e74 732e 706c 6f74 2863 6f6c  _points.plot(col
+00021730: 6f72 3d74 6172 6765 745f 7368 705f 6365  or=target_shp_ce
+00021740: 6e74 6572 5f63 6f6c 6f72 2c20 6178 3d61  nter_color, ax=a
+00021750: 7829 0a20 2020 2020 2020 2023 0a20 2020  x).        #.   
+00021760: 2020 2020 2069 6620 6d69 6e5f 6c61 7420       if min_lat 
+00021770: 616e 6420 6d69 6e5f 6c6f 6e20 616e 6420  and min_lon and 
+00021780: 6d61 785f 6c61 7420 616e 6420 6d61 785f  max_lat and max_
+00021790: 6c6f 6e3a 0a20 2020 2020 2020 2020 2020  lon:.           
+000217a0: 2061 782e 7365 745f 796c 696d 285b 6d69   ax.set_ylim([mi
+000217b0: 6e5f 6c61 742d 6d61 7267 696e 2c6d 6178  n_lat-margin,max
+000217c0: 5f6c 6174 2b6d 6172 6769 6e5d 290a 2020  _lat+margin]).  
+000217d0: 2020 2020 2020 2020 2020 6178 2e73 6574            ax.set
+000217e0: 5f78 6c69 6d28 5b6d 696e 5f6c 6f6e 2d6d  _xlim([min_lon-m
+000217f0: 6172 6769 6e2c 6d61 785f 6c6f 6e2b 6d61  argin,max_lon+ma
+00021800: 7267 696e 5d29 0a20 2020 2020 2020 2023  rgin]).        #
+00021810: 2063 7265 6174 6520 7468 6520 666f 6c64   create the fold
+00021820: 6572 2074 6f20 7361 7665 0a20 2020 2020  er to save.     
+00021830: 2020 2070 6c74 2e74 6967 6874 5f6c 6179     plt.tight_lay
+00021840: 6f75 7428 290a 2020 2020 2020 2020 6966  out().        if
+00021850: 206c 6f63 6174 696f 6e5f 7361 7665 5f66   location_save_f
+00021860: 6967 2061 6e64 2066 6967 5f6e 616d 653a  ig and fig_name:
+00021870: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
+00021880: 6e6f 7420 6f73 2e70 6174 682e 6973 6469  not os.path.isdi
+00021890: 7228 6c6f 6361 7469 6f6e 5f73 6176 655f  r(location_save_
+000218a0: 6669 6729 3a0a 2020 2020 2020 2020 2020  fig):.          
+000218b0: 2020 2020 2020 6f73 2e6d 616b 6564 6972        os.makedir
+000218c0: 7328 6c6f 6361 7469 6f6e 5f73 6176 655f  s(location_save_
+000218d0: 6669 6729 0a20 2020 2020 2020 2020 2020  fig).           
+000218e0: 2070 6c74 2e73 6176 6566 6967 286c 6f63   plt.savefig(loc
+000218f0: 6174 696f 6e5f 7361 7665 5f66 6967 2b66  ation_save_fig+f
+00021900: 6967 5f6e 616d 652c 2062 626f 785f 696e  ig_name, bbox_in
+00021910: 6368 6573 3d27 7469 6768 7427 290a 0a    ches='tight')..
```

### Comparing `easymore-0.0.4/easymore.egg-info/PKG-INFO` & `easymore-1.0.0/easymore.egg-info/PKG-INFO`

 * *Files 20% similar despite different names*

```diff
@@ -1,13 +1,13 @@
 Metadata-Version: 2.1
 Name: easymore
-Version: 0.0.4
+Version: 1.0.0
 Summary: geo-spatial processing of the input data for environmental and hydrological modeling
 Home-page: https://github.com/ShervanGharari/EASYMORE
-Author: ('Shervan Gharari', 'Wouter Knoben')
+Author: Shervan Gharari
 Author-email: sh.gharari@gmail.com
 License: GPLv3
 Keywords: remapping,NetCDF,shapefile,geotif,geo-spatial processing,environmental modeling
 Platform: any
 Classifier: Programming Language :: Python
 Classifier: Programming Language :: Python :: 3
 Classifier: Programming Language :: Python :: 3.6
@@ -28,85 +28,67 @@
 This package allows you to extract and aggregate the relevant values from a
 cfconventions compliant netcdf files given shapefiles.
 
 EASYMORE is a collection of functions that allows extraction of the data from a NetCDF file for a given shapefile such as a basin, catchment, points or lines. It can map gridded data or model output to any given shapefile and provide area average for a target variable.
 
 EASYMORE is very efficient as it uses pandas `groupby` functionality. Remapping of the entire north American domain from ERA5 with resolution of 0.25 degree to 500,000 subbasins of MERIT-Hydro watershed for 7 variables in 1.2 seconds for one time step (the time varying from device to device and depending on the source netCDF files sizes and their temporal aggregation).
 
-In addition, EASYMORE can perform geospatial processes that are often needed for setting up a hydroligcal or land model. These steps are zonal statistics of raster given a shapefile, zonal statistics of two shapefiles, creation of subbasins and river network topology given hydrologically conditioned DEM such as MERIT-Hydro.
-
 ## The code can be used for the following purposes:
 
 1. Remapping the relevant forcing variables, such as precipitation or temperature and other variables for the effortless model set up. This transfer can be from Thiessen polygon or gridded data, for example, to computational units, hydrological model for example.
 2. Remapping the output of a hydrological or land surface model to force another model, such as providing the gridded model output in sub-basin for routing.
 3. Extraction of single or multiple points from the gridded or irregular data for comparison with gauges data, for example.
 4. Interpolation to caorser or finer resolutions with full controllability in creating the interpolation rules.
 
 ## How to install:
 
+**âš  ATTENTION:**
+We highly recommend before using EASYMORE, the virtual environment is set up properly, and then the examples from the GitHub repository are tested to evaluate the authenticity of the results with what is generated by the EASYMORE development team. Examples and more detailed information on installation is provided in the [env](https://github.com/ShervanGharari/EASYMORE/tree/main/env) folder.
+
 ### From PyPI:
 
 `pip install easymore`
 
 ### From local repo:
 
 clone the code on your perosnal computer or home on HPC by
 
 ```
-git clone https://github.com/ShervanGharari/EASYMORE.git`
+git clone https://github.com/ShervanGharari/EASYMORE.git
 cd EASYMORE
-pip install -r requirements.txt
 pip install .
 ```
 
 ## Flexibilities:
 
-1. EASYMORE allow for commbination of the remapping of NetCDF on local computer or remote high performance computer. For example, the the GIS steps of creating remapping file can be done locally on a sample file that contains few time step of the data (but all the domain). EASYMORE can then be directed to remapping file on the HPC and will skip all the needed GIS steps and directly start remapping process of bulk of the data. For installing without gis packages you can simply do:
-
-
-### From PyPI
-
-`pip install easymore --no-deps -r requirements_basic.txt`
-
-### From local repo:
-
-```
-git clone https://github.com/ShervanGharari/EASYMORE.git`
-cd EASYMORE
-pip install -r requirements.txt
-pip install . --no-deps -r requirements_basic.txt
-```
+1. EASYMORE allow for commbination of the remapping of NetCDF on local computer or remote high performance computer. For example, the the GIS steps of creating remapping file can be done locally on a sample file that contains few time step of the data (but all the domain). EASYMORE can then be directed to remapping file on the HPC and will skip all the needed GIS steps and directly start remapping process of bulk of the data.
 
 ## Examples:
 
-1. [Remapping a regular lat/lon gridded data or model output to irregular shapes.](./examples/Chapter1_E1.ipynb)
-2. [Remapping a rotate lat/lon gridded data or model output to irregular shapes.](./examples/Chapter1_E2.ipynb)
-3. [Remapping an irregular shapefile data, such as Thiessen polygon for example, to irregular shapes.](./examples/Chapter1_E3.ipynb)
-4. [Extract the data for points (such as location of stations, cities, etc) from the grided or irregular shapefiles; temprature example](./examples/Chapter1_E4.ipynb)
-5. [Resampling of regular, rotated or irregular data and model output to any resolution density of the points](./examples/Chapter1_E5.ipynb)
-6. [Manipulation of remapped variables such as lapse rate to temperature based on elevation difference (can be applied to slope and aspect, etc)](./examples/Chapter1_E6.ipynb)
-7. [Creation of subbasins for hydrologically conditioned MERIT-Hydro DEM and perform spatial processes for finding elevation and land cover characteistics of all the subbasins](./examples/Chapter2_E1.ipynb)
-8. [Creation of Thiessen polygons, sampling a from a geotif based on point shapefile](./examples/Chapter2_E2.ipynb)
+1. [Illustrative example.](https://github.com/ShervanGharari/EASYMORE/blob/main/examples/00_test_example.ipynb)
+2. [Remap variables from a regular lat/lon gridded data or model output to irregular shapes.](https://github.com/ShervanGharari/EASYMORE/blob/main/examples/01_ERA5_Regular_Lat_Lon.ipynb)
+3. [Remap variables from a regular lat/lon gridded data or model output to irregular shapes with missing values and non-overlapping extent.](https://github.com/ShervanGharari/EASYMORE/blob/main/examples/02_ERA5_Regular_Lat_Lon_NaN.ipynb)
+4. [Remap variables from a rotate lat/lon gridded data or model output to irregular shapes.](https://github.com/ShervanGharari/EASYMORE/blob/main/examples/03_WRF_Rotated_Lat_Lon.ipynb)
+5. [Remap variables from an irregular shapefile data from Thiessen polygons of station data to irregular shapes.](https://github.com/ShervanGharari/EASYMORE/blob/main/examples/04_Thiessen_Polygons_SCDNA.ipynb)
+6. [Remap variables from irregular shapefile data, such as administrative boundaries for example, to irregular shapes.](https://github.com/ShervanGharari/EASYMORE/blob/main/examples/05_irregular_shapes.ipynb)
+7. [Extract variables for points (such as locations of stations, cities, etc) from the grided or irregular shapefiles; temperature example](https://github.com/ShervanGharari/EASYMORE/blob/main/examples/07_GRACE_capitals.ipynb)
+8. [Interpolate regular, rotated, or irregular data and model output to any resolution density of the points by reconstructing the remapping file](https://github.com/ShervanGharari/EASYMORE/blob/main/examples/92_WRF_interpolation.ipynb)
 
 The two figures show remapping of the gridded temperature from ERA5 data set to subbasin of South Saskatchewan River at Medicine Hat.
 
 ### Original gridded temperature field:
 
-<img src="./fig/Gird.png" width="2000">
+![](https://github.com/ShervanGharari/EASYMORE/blob/main/fig/Gird_new.png)
 
 ### Remapped temperature field to the subbasins:
 
-<img src="./fig/Remapped.png" width="2000">
+![](https://github.com/ShervanGharari/EASYMORE/blob/main/fig/Remapped_new.png)
 
 ## Publication that have used EASYMORE so far:
 
-Authors
-
-Knoben, W. J. M., Clark, M. P., Bales, J., Bennett, A., Gharari, S., Marsh, C. B., Nijssen, B., Pietroniro, A., Spiteri, R. J., Tarboton, D. G., Wood, A. W.: Community Workflows to Advance Reproducibility in Hydrologic Modeling: Separating model-agnostic and model-specific configuration steps in applications of large-domain hydrologic models, Earth and Space Science Open Archive, 42, https://doi.org/10.1002/essoar.10509195.1, 2021
+Knoben, W. J. M., Clark, M. P., Bales, J., Bennett, A., Gharari, S., Marsh, C. B., Nijssen, B., Pietroniro, A., Spiteri, R. J., Tarboton, D. G., Wood, A. W.: Community Workflows to Advance Reproducibility in Hydrologic Modeling: Separating Model-Agnostic and Model-Specific Configuration Steps in Applications of Large-Domain Hydrologic Models, Water Resources Research, 58, e2021WR031753. https://doi.org/10.1029/2021WR031753
 
 Gharari, S., Vanderkelen, I., Tefs, A., Mizukami, N., Stadnyk, T. A., Lawrence, D., Clark, M. P.: A Flexible Multi-Scale Framework to Simulate Lakes and Reservoirs in Earth System Models, Earth and Space Science Open Archive, 24, https://doi.org/10.1002/essoar.10510902.1, 2022
 
 Gharari, S., Clark, M. P., Mizukami, N., Knoben, W. J. M., Wong, J. S., and Pietroniro, A.: Flexible vector-based spatial configurations in land models, Hydrol. Earth Syst. Sci., 24, 5953â€“5971, https://doi.org/10.5194/hess-24-5953-2020, 2020
 
 Sheikholeslami, R., Gharari, S., Papalexiou, S. M., Clark, M. P.: VISCOUS: A Variance-Based Sensitivity Analysis Using Copulas for Efficient Identification of Dominant Hydrological Processes, Water Resources Research, https://doi.org/10.1029/2020WR028435, 2021.
-
-
```

### Comparing `easymore-0.0.4/setup.py` & `easymore-1.0.0/setup.py`

 * *Files 6% similar despite different names*

```diff
@@ -1,57 +1,57 @@
 from setuptools import find_packages, setup
-import subprocess
-from sys import platform
-import re
+# import subprocess
+#from sys import platform
+#import re
 
-def check_gdal_version_string(string):
-    '''Returns boolean True if string is in format x.x.x'''
-    matches = re.match(r"[0-9]+\.[0-9]+\.[0-9]+$", string)
-    return matches
+# def check_gdal_version_string(string):
+#     '''Returns boolean True if string is in format x.x.x'''
+#     matches = re.match(r"[0-9]+\.[0-9]+\.[0-9]+$", string)
+#     return matches
 
-def get_installed_gdal_version():
-    '''Returns string of GDAL version in format of ==x.x.x.* is gdal exists, ohterwise empty or raise error'''
-    try:
-        # get the gdal version
-        if ('linux' in str(platform).lower()) or ('darwin' in str(platform).lower()):
-            gdal_version = subprocess.run(["gdal-config","--version"], stdout=subprocess.PIPE).stdout.decode()
-        elif ('win' in str(platform).lower()):
-            gdal_version = subprocess.run(["gdalinfo","--version"], stdout=subprocess.PIPE).stdout.decode()
-            gdal_version = gdal_version.replace('GDAL','').split(',')[0].strip()
-        # Check we got the version string in the correct format
-        if 'gdal_version' in locals():
-            if check_gdal_version_string(gdal_version):
-                gdal_version = gdal_version.replace('\n', '')
-                print("GDAL version is detected as "+gdal_version)
-                gdal_version = "=="+gdal_version+".*"
-            else:
-                print("GDAL version not returned in expected format."+\
-                "Should be x.x.x. Was {} and will be reset to empty string".format(gdal_version))
-                gdal_version = ''
-        else:
-            print("GDAL version not returned and will be reset "+\
-                  "to empty string for pip to decide/install gdal")
-            gdal_version = ''
-        return gdal_version
-    except FileNotFoundError as e:
-        raise(""" ERROR: Could not find the system install of GDAL.
-                  Please install it via your package manage of choice.
-                """
-            )
+# def get_installed_gdal_version():
+#     '''Returns string of GDAL version in format of ==x.x.x.* is gdal exists, ohterwise empty or raise error'''
+#     try:
+#         # get the gdal version
+#         if ('linux' in str(platform).lower()) or ('darwin' in str(platform).lower()):
+#             gdal_version = subprocess.run(["gdal-config","--version"], stdout=subprocess.PIPE).stdout.decode()
+#         elif ('win' in str(platform).lower()):
+#             gdal_version = subprocess.run(["gdalinfo","--version"], stdout=subprocess.PIPE).stdout.decode()
+#             gdal_version = gdal_version.replace('GDAL','').split(',')[0].strip()
+#         # Check we got the version string in the correct format
+#         if 'gdal_version' in locals():
+#             if check_gdal_version_string(gdal_version):
+#                 gdal_version = gdal_version.replace('\n', '')
+#                 print("GDAL version is detected as "+gdal_version)
+#                 gdal_version = "=="+gdal_version+".*"
+#             else:
+#                 print("GDAL version not returned in expected format."+\
+#                 "Should be x.x.x. Was {} and will be reset to empty string".format(gdal_version))
+#                 gdal_version = ''
+#         else:
+#             print("GDAL version not returned and will be reset "+\
+#                   "to empty string for pip to decide/install gdal")
+#             gdal_version = ''
+#         return gdal_version
+#     except FileNotFoundError as e:
+#         raise(""" ERROR: Could not find the system install of GDAL.
+#                   Please install it via your package manage of choice.
+#                 """
+#             )
 
 # read the contents of your README file for distribution on PyPI
 from pathlib import Path
 this_directory = Path(__file__).parent
 long_description = (this_directory / "README.md").read_text()
 
 setup(
     name='easymore',
-    version='0.0.4',
+    version='1.0.0',
     license='GPLv3',
-    author=('Shervan Gharari', 'Wouter Knoben'),
+    author=('Shervan Gharari'),
     author_email = 'sh.gharari@gmail.com',
     url = 'https://github.com/ShervanGharari/EASYMORE',
     description=(
         'geo-spatial processing of the input data for environmental and hydrological modeling'
     ),
     long_description=long_description,
     long_description_content_type='text/markdown',
@@ -64,22 +64,19 @@
         'xarray',
         'pandas',
         'netCDF4',
         'datetime',
         'cftime',
         'geopandas',
         'shapely',
-        'pyshp',
-        'pysheds',
-        'gdal'+get_installed_gdal_version(),
         'geovoronoi',
         'json5',
-        'rasterio',
+        'matplotlib',
         'rtree'
-    ],
+    ], # 'gdal'+get_installed_gdal_version(),  'pyshp',
     packages=find_packages(),
     include_package_data=True,
     platforms='any',
     classifiers=[
         'Programming Language :: Python',
         'Programming Language :: Python :: 3',
         'Programming Language :: Python :: 3.6',
```

