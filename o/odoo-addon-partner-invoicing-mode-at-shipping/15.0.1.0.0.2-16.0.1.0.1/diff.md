# Comparing `tmp/odoo_addon_partner_invoicing_mode_at_shipping-15.0.1.0.0.2-py3-none-any.whl.zip` & `tmp/odoo_addon_partner_invoicing_mode_at_shipping-16.0.1.0.1-py3-none-any.whl.zip`

## zipinfo {}

```diff
@@ -1,22 +1,22 @@
-Zip file size: 24974 bytes, number of entries: 20
--rw-r--r--  2.0 unx     3167 b- defN 23-Apr-20 11:39 odoo/addons/partner_invoicing_mode_at_shipping/README.rst
--rw-r--r--  2.0 unx       21 b- defN 23-Apr-20 11:39 odoo/addons/partner_invoicing_mode_at_shipping/__init__.py
--rw-r--r--  2.0 unx      565 b- defN 23-Apr-20 11:39 odoo/addons/partner_invoicing_mode_at_shipping/__manifest__.py
--rw-r--r--  2.0 unx      593 b- defN 23-Apr-20 11:39 odoo/addons/partner_invoicing_mode_at_shipping/data/queue_job_data.xml
--rw-r--r--  2.0 unx     1517 b- defN 23-Apr-20 11:39 odoo/addons/partner_invoicing_mode_at_shipping/i18n/partner_invoicing_mode_at_shipping.pot
--rw-r--r--  2.0 unx       79 b- defN 23-Apr-20 11:39 odoo/addons/partner_invoicing_mode_at_shipping/models/__init__.py
--rw-r--r--  2.0 unx      346 b- defN 23-Apr-20 11:39 odoo/addons/partner_invoicing_mode_at_shipping/models/res_partner.py
--rw-r--r--  2.0 unx      588 b- defN 23-Apr-20 11:39 odoo/addons/partner_invoicing_mode_at_shipping/models/stock_move.py
--rw-r--r--  2.0 unx     1879 b- defN 23-Apr-20 11:39 odoo/addons/partner_invoicing_mode_at_shipping/models/stock_picking.py
--rw-r--r--  2.0 unx      140 b- defN 23-Apr-20 11:39 odoo/addons/partner_invoicing_mode_at_shipping/readme/CONTRIBUTORS.rst
--rw-r--r--  2.0 unx       80 b- defN 23-Apr-20 11:39 odoo/addons/partner_invoicing_mode_at_shipping/readme/CREDITS.rst
--rw-r--r--  2.0 unx      214 b- defN 23-Apr-20 11:39 odoo/addons/partner_invoicing_mode_at_shipping/readme/DESCRIPTION.rst
--rw-r--r--  2.0 unx     9455 b- defN 23-Apr-20 11:39 odoo/addons/partner_invoicing_mode_at_shipping/static/description/icon.png
--rw-r--r--  2.0 unx    12719 b- defN 23-Apr-20 11:39 odoo/addons/partner_invoicing_mode_at_shipping/static/description/index.html
--rw-r--r--  2.0 unx       44 b- defN 23-Apr-20 11:39 odoo/addons/partner_invoicing_mode_at_shipping/tests/__init__.py
--rw-r--r--  2.0 unx     2330 b- defN 23-Apr-20 11:39 odoo/addons/partner_invoicing_mode_at_shipping/tests/test_invoice_mode_at_shipping.py
--rw-r--r--  2.0 unx     3885 b- defN 23-Apr-20 11:39 odoo_addon_partner_invoicing_mode_at_shipping-15.0.1.0.0.2.dist-info/METADATA
--rw-r--r--  2.0 unx       92 b- defN 23-Apr-20 11:39 odoo_addon_partner_invoicing_mode_at_shipping-15.0.1.0.0.2.dist-info/WHEEL
--rw-r--r--  2.0 unx        5 b- defN 23-Apr-20 11:39 odoo_addon_partner_invoicing_mode_at_shipping-15.0.1.0.0.2.dist-info/top_level.txt
-?rw-rw-r--  2.0 unx     2486 b- defN 23-Apr-20 11:39 odoo_addon_partner_invoicing_mode_at_shipping-15.0.1.0.0.2.dist-info/RECORD
-20 files, 40205 bytes uncompressed, 20596 bytes compressed:  48.8%
+Zip file size: 25278 bytes, number of entries: 20
+-rw-r--r--  2.0 unx     3167 b- defN 23-Apr-21 00:48 odoo/addons/partner_invoicing_mode_at_shipping/README.rst
+-rw-r--r--  2.0 unx       21 b- defN 23-Apr-21 00:47 odoo/addons/partner_invoicing_mode_at_shipping/__init__.py
+-rw-r--r--  2.0 unx      565 b- defN 23-Apr-21 00:49 odoo/addons/partner_invoicing_mode_at_shipping/__manifest__.py
+-rw-r--r--  2.0 unx      593 b- defN 23-Apr-21 00:47 odoo/addons/partner_invoicing_mode_at_shipping/data/queue_job_data.xml
+-rw-r--r--  2.0 unx     1532 b- defN 23-Apr-21 00:47 odoo/addons/partner_invoicing_mode_at_shipping/i18n/partner_invoicing_mode_at_shipping.pot
+-rw-r--r--  2.0 unx       79 b- defN 23-Apr-21 00:47 odoo/addons/partner_invoicing_mode_at_shipping/models/__init__.py
+-rw-r--r--  2.0 unx      346 b- defN 23-Apr-21 00:47 odoo/addons/partner_invoicing_mode_at_shipping/models/res_partner.py
+-rw-r--r--  2.0 unx      578 b- defN 23-Apr-21 00:47 odoo/addons/partner_invoicing_mode_at_shipping/models/stock_move.py
+-rw-r--r--  2.0 unx     1681 b- defN 23-Apr-21 00:47 odoo/addons/partner_invoicing_mode_at_shipping/models/stock_picking.py
+-rw-r--r--  2.0 unx      140 b- defN 23-Apr-21 00:47 odoo/addons/partner_invoicing_mode_at_shipping/readme/CONTRIBUTORS.rst
+-rw-r--r--  2.0 unx       80 b- defN 23-Apr-21 00:47 odoo/addons/partner_invoicing_mode_at_shipping/readme/CREDITS.rst
+-rw-r--r--  2.0 unx      214 b- defN 23-Apr-21 00:47 odoo/addons/partner_invoicing_mode_at_shipping/readme/DESCRIPTION.rst
+-rw-r--r--  2.0 unx     9455 b- defN 23-Apr-21 00:47 odoo/addons/partner_invoicing_mode_at_shipping/static/description/icon.png
+-rw-r--r--  2.0 unx    12719 b- defN 23-Apr-21 00:48 odoo/addons/partner_invoicing_mode_at_shipping/static/description/index.html
+-rw-r--r--  2.0 unx       44 b- defN 23-Apr-21 00:47 odoo/addons/partner_invoicing_mode_at_shipping/tests/__init__.py
+-rw-r--r--  2.0 unx     5665 b- defN 23-Apr-21 00:47 odoo/addons/partner_invoicing_mode_at_shipping/tests/test_invoice_mode_at_shipping.py
+-rw-r--r--  2.0 unx     3884 b- defN 23-Apr-21 00:50 odoo_addon_partner_invoicing_mode_at_shipping-16.0.1.0.1.dist-info/METADATA
+-rw-r--r--  2.0 unx       92 b- defN 23-Apr-21 00:50 odoo_addon_partner_invoicing_mode_at_shipping-16.0.1.0.1.dist-info/WHEEL
+-rw-r--r--  2.0 unx        5 b- defN 23-Apr-21 00:50 odoo_addon_partner_invoicing_mode_at_shipping-16.0.1.0.1.dist-info/top_level.txt
+?rw-rw-r--  2.0 unx     2478 b- defN 23-Apr-21 00:50 odoo_addon_partner_invoicing_mode_at_shipping-16.0.1.0.1.dist-info/RECORD
+20 files, 43338 bytes uncompressed, 20916 bytes compressed:  51.7%
```

## zipnote {}

```diff
@@ -42,20 +42,20 @@
 
 Filename: odoo/addons/partner_invoicing_mode_at_shipping/tests/__init__.py
 Comment: 
 
 Filename: odoo/addons/partner_invoicing_mode_at_shipping/tests/test_invoice_mode_at_shipping.py
 Comment: 
 
-Filename: odoo_addon_partner_invoicing_mode_at_shipping-15.0.1.0.0.2.dist-info/METADATA
+Filename: odoo_addon_partner_invoicing_mode_at_shipping-16.0.1.0.1.dist-info/METADATA
 Comment: 
 
-Filename: odoo_addon_partner_invoicing_mode_at_shipping-15.0.1.0.0.2.dist-info/WHEEL
+Filename: odoo_addon_partner_invoicing_mode_at_shipping-16.0.1.0.1.dist-info/WHEEL
 Comment: 
 
-Filename: odoo_addon_partner_invoicing_mode_at_shipping-15.0.1.0.0.2.dist-info/top_level.txt
+Filename: odoo_addon_partner_invoicing_mode_at_shipping-16.0.1.0.1.dist-info/top_level.txt
 Comment: 
 
-Filename: odoo_addon_partner_invoicing_mode_at_shipping-15.0.1.0.0.2.dist-info/RECORD
+Filename: odoo_addon_partner_invoicing_mode_at_shipping-16.0.1.0.1.dist-info/RECORD
 Comment: 
 
 Zip file comment:
```

## odoo/addons/partner_invoicing_mode_at_shipping/README.rst

```diff
@@ -10,21 +10,21 @@
 .. |badge1| image:: https://img.shields.io/badge/maturity-Beta-yellow.png
     :target: https://odoo-community.org/page/development-status
     :alt: Beta
 .. |badge2| image:: https://img.shields.io/badge/licence-AGPL--3-blue.png
     :target: http://www.gnu.org/licenses/agpl-3.0-standalone.html
     :alt: License: AGPL-3
 .. |badge3| image:: https://img.shields.io/badge/github-OCA%2Faccount--invoicing-lightgray.png?logo=github
-    :target: https://github.com/OCA/account-invoicing/tree/15.0/partner_invoicing_mode_at_shipping
+    :target: https://github.com/OCA/account-invoicing/tree/16.0/partner_invoicing_mode_at_shipping
     :alt: OCA/account-invoicing
 .. |badge4| image:: https://img.shields.io/badge/weblate-Translate%20me-F47D42.png
-    :target: https://translation.odoo-community.org/projects/account-invoicing-15-0/account-invoicing-15-0-partner_invoicing_mode_at_shipping
+    :target: https://translation.odoo-community.org/projects/account-invoicing-16-0/account-invoicing-16-0-partner_invoicing_mode_at_shipping
     :alt: Translate me on Weblate
 .. |badge5| image:: https://img.shields.io/badge/runbot-Try%20me-875A7B.png
-    :target: https://runbot.odoo-community.org/runbot/95/15.0
+    :target: https://runbot.odoo-community.org/runbot/95/16.0
     :alt: Try me on Runbot
 
 |badge1| |badge2| |badge3| |badge4| |badge5| 
 
 This module allows to select a `At shipping` invoicing mode for a customer.
 It is based on `partner_invoicing_mode`.
 When this mode is selected the customer will be invoiced automatically on
@@ -37,15 +37,15 @@
 
 Bug Tracker
 ===========
 
 Bugs are tracked on `GitHub Issues <https://github.com/OCA/account-invoicing/issues>`_.
 In case of trouble, please check there if your issue has already been reported.
 If you spotted it first, help us smashing it by providing a detailed and welcomed
-`feedback <https://github.com/OCA/account-invoicing/issues/new?body=module:%20partner_invoicing_mode_at_shipping%0Aversion:%2015.0%0A%0A**Steps%20to%20reproduce**%0A-%20...%0A%0A**Current%20behavior**%0A%0A**Expected%20behavior**>`_.
+`feedback <https://github.com/OCA/account-invoicing/issues/new?body=module:%20partner_invoicing_mode_at_shipping%0Aversion:%2016.0%0A%0A**Steps%20to%20reproduce**%0A-%20...%0A%0A**Current%20behavior**%0A%0A**Expected%20behavior**>`_.
 
 Do not contact contributors directly about support or help with technical issues.
 
 Credits
 =======
 
 Authors
@@ -78,10 +78,10 @@
    :alt: Odoo Community Association
    :target: https://odoo-community.org
 
 OCA, or the Odoo Community Association, is a nonprofit organization whose
 mission is to support the collaborative development of Odoo features and
 promote its widespread use.
 
-This module is part of the `OCA/account-invoicing <https://github.com/OCA/account-invoicing/tree/15.0/partner_invoicing_mode_at_shipping>`_ project on GitHub.
+This module is part of the `OCA/account-invoicing <https://github.com/OCA/account-invoicing/tree/16.0/partner_invoicing_mode_at_shipping>`_ project on GitHub.
 
 You are welcome to contribute. To learn how please visit https://odoo-community.org/page/Contribute.
```

## odoo/addons/partner_invoicing_mode_at_shipping/__manifest__.py

```diff
@@ -1,12 +1,12 @@
 # Copyright 2020 Camptocamp
 # License AGPL-3.0 or later (http://www.gnu.org/licenses/agpl).
 {
     "name": "Partner Invoicing Mode At Shipping",
-    "version": "15.0.1.0.0",
+    "version": "16.0.1.0.1",
     "summary": "Create invoices automatically when goods are shipped.",
     "author": "Camptocamp, Odoo Community Association (OCA)",
     "website": "https://github.com/OCA/account-invoicing",
     "license": "AGPL-3",
     "category": "Accounting & Finance",
     "data": [
         "data/queue_job_data.xml",
```

## odoo/addons/partner_invoicing_mode_at_shipping/i18n/partner_invoicing_mode_at_shipping.pot

```diff
@@ -1,14 +1,14 @@
 # Translation of Odoo Server.
 # This file contains the translation of the following modules:
 # 	* partner_invoicing_mode_at_shipping
 #
 msgid ""
 msgstr ""
-"Project-Id-Version: Odoo Server 15.0\n"
+"Project-Id-Version: Odoo Server 16.0\n"
 "Report-Msgid-Bugs-To: \n"
 "Last-Translator: \n"
 "Language-Team: \n"
 "MIME-Version: 1.0\n"
 "Content-Type: text/plain; charset=UTF-8\n"
 "Content-Transfer-Encoding: \n"
 "Plural-Forms: \n"
@@ -26,14 +26,15 @@
 #. module: partner_invoicing_mode_at_shipping
 #: model:ir.model.fields,field_description:partner_invoicing_mode_at_shipping.field_res_partner__invoicing_mode
 #: model:ir.model.fields,field_description:partner_invoicing_mode_at_shipping.field_res_users__invoicing_mode
 msgid "Invoicing Mode"
 msgstr ""
 
 #. module: partner_invoicing_mode_at_shipping
+#. odoo-python
 #: code:addons/partner_invoicing_mode_at_shipping/models/stock_picking.py:0
 #, python-format
 msgid "Nothing to invoice."
 msgstr ""
 
 #. module: partner_invoicing_mode_at_shipping
 #: model:ir.model,name:partner_invoicing_mode_at_shipping.model_stock_move
```

## odoo/addons/partner_invoicing_mode_at_shipping/models/stock_move.py

```diff
@@ -8,12 +8,12 @@
     _inherit = "stock.move"
 
     def _get_related_invoices(self):
         """Overridden from stock_account to return the customer invoices
         related to this stock move.
         """
         invoices = super()._get_related_invoices()
-        line_invoices = self.mapped("sale_line_id.order_id.invoice_ids").filtered(
+        line_invoices = self.sale_line_id.order_id.invoice_ids.filtered(
             lambda x: x.state == "posted"
         )
         invoices |= line_invoices
         return invoices
```

## odoo/addons/partner_invoicing_mode_at_shipping/models/stock_picking.py

```diff
@@ -20,30 +20,26 @@
         return (
             self.picking_type_code == "outgoing"
             and self.sale_id.partner_invoice_id.invoicing_mode == "at_shipping"
         )
 
     def _invoicing_at_shipping(self):
         self.ensure_one()
-        sales = self.env["sale.order"].browse()
-        # Filter out non invoicable sales order
-        for sale in self._get_sales_order_to_invoice():
-            if sale._get_invoiceable_lines():
-                sales |= sale
+        sales = self._get_sales_order_to_invoice()
         # Split invoice creation on partner sales grouping on invoice settings
         sales_one_invoice_per_order = sales.filtered(
             "partner_invoice_id.one_invoice_per_order"
         )
-        invoices = self.env["account.move"].browse()
+        invoices = self.env["account.move"]
         if sales_one_invoice_per_order:
             invoices |= sales_one_invoice_per_order._create_invoices(grouped=True)
         sales_many_invoice_per_order = sales - sales_one_invoice_per_order
         if sales_many_invoice_per_order:
             invoices |= sales_many_invoice_per_order._create_invoices(grouped=False)
         for invoice in invoices:
             invoice.with_delay()._validate_invoice()
         return invoices or _("Nothing to invoice.")
 
     def _get_sales_order_to_invoice(self):
-        return self.mapped("move_lines.sale_line_id.order_id").filtered(
+        return self.move_ids.sale_line_id.order_id.filtered(
             lambda r: r._get_invoiceable_lines()
         )
```

## odoo/addons/partner_invoicing_mode_at_shipping/static/description/index.html

### odoo/addons/partner_invoicing_mode_at_shipping/static/description/index.html

```diff
@@ -367,21 +367,21 @@
       <p>
         <a class="reference external" href="https://odoo-community.org/page/development-status">
           <img alt="Beta" src="https://img.shields.io/badge/maturity-Beta-yellow.png"/>
         </a>
         <a class="reference external" href="http://www.gnu.org/licenses/agpl-3.0-standalone.html">
           <img alt="License: AGPL-3" src="https://img.shields.io/badge/licence-AGPL--3-blue.png"/>
         </a>
-        <a class="reference external" href="https://github.com/OCA/account-invoicing/tree/15.0/partner_invoicing_mode_at_shipping">
+        <a class="reference external" href="https://github.com/OCA/account-invoicing/tree/16.0/partner_invoicing_mode_at_shipping">
           <img alt="OCA/account-invoicing" src="https://img.shields.io/badge/github-OCA%2Faccount--invoicing-lightgray.png?logo=github"/>
         </a>
-        <a class="reference external" href="https://translation.odoo-community.org/projects/account-invoicing-15-0/account-invoicing-15-0-partner_invoicing_mode_at_shipping">
+        <a class="reference external" href="https://translation.odoo-community.org/projects/account-invoicing-16-0/account-invoicing-16-0-partner_invoicing_mode_at_shipping">
           <img alt="Translate me on Weblate" src="https://img.shields.io/badge/weblate-Translate%20me-F47D42.png"/>
         </a>
-        <a class="reference external" href="https://runbot.odoo-community.org/runbot/95/15.0">
+        <a class="reference external" href="https://runbot.odoo-community.org/runbot/95/16.0">
           <img alt="Try me on Runbot" src="https://img.shields.io/badge/runbot-Try%20me-875A7B.png"/>
         </a>
       </p>
       <p>
         This module allows to select a
         <cite>At shipping</cite>
         invoicing mode for a customer.
@@ -424,15 +424,15 @@
         </h1>
         <p>
           Bugs are tracked on
           <a class="reference external" href="https://github.com/OCA/account-invoicing/issues">GitHub Issues</a>
           .
 In case of trouble, please check there if your issue has already been reported.
 If you spotted it first, help us smashing it by providing a detailed and welcomed
-          <a class="reference external" href="https://github.com/OCA/account-invoicing/issues/new?body=module:%20partner_invoicing_mode_at_shipping%0Aversion:%2015.0%0A%0A**Steps%20to%20reproduce**%0A-%20...%0A%0A**Current%20behavior**%0A%0A**Expected%20behavior**">feedback</a>
+          <a class="reference external" href="https://github.com/OCA/account-invoicing/issues/new?body=module:%20partner_invoicing_mode_at_shipping%0Aversion:%2016.0%0A%0A**Steps%20to%20reproduce**%0A-%20...%0A%0A**Current%20behavior**%0A%0A**Expected%20behavior**">feedback</a>
           .
         </p>
         <p>Do not contact contributors directly about support or help with technical issues.</p>
       </div>
       <div class="section" id="credits">
         <h1>
           <a class="toc-backref" href="#id2">Credits</a>
@@ -492,15 +492,15 @@
             <img alt="Odoo Community Association" src="https://odoo-community.org/logo.png"/>
           </a>
           <p>OCA, or the Odoo Community Association, is a nonprofit organization whose
 mission is to support the collaborative development of Odoo features and
 promote its widespread use.</p>
           <p>
             This module is part of the
-            <a class="reference external" href="https://github.com/OCA/account-invoicing/tree/15.0/partner_invoicing_mode_at_shipping">OCA/account-invoicing</a>
+            <a class="reference external" href="https://github.com/OCA/account-invoicing/tree/16.0/partner_invoicing_mode_at_shipping">OCA/account-invoicing</a>
             project on GitHub.
           </p>
           <p>
             You are welcome to contribute. To learn how please visit
             <a class="reference external" href="https://odoo-community.org/page/Contribute">https://odoo-community.org/page/Contribute</a>
             .
           </p>
```

## odoo/addons/partner_invoicing_mode_at_shipping/tests/test_invoice_mode_at_shipping.py

```diff
@@ -1,11 +1,12 @@
 # Copyright 2020 Camptocamp SA
 # License AGPL-3.0 or later (http://www.gnu.org/licenses/agpl.html)
 
 from odoo.tests.common import TransactionCase
+from odoo.tools import mute_logger
 
 
 class TestInvoiceModeAtShipping(TransactionCase):
     @classmethod
     def setUpClass(cls):
         super().setUpClass()
         cls.env = cls.env(context=dict(cls.env.context, tracking_disable=True))
@@ -34,24 +35,92 @@
         )
 
     def test_invoice_created_at_shipping(self):
         """Check that an invoice is created when goods are shipped."""
         self.partner.invoicing_mode = "at_shipping"
         self.so1.action_confirm()
         for picking in self.so1.picking_ids:
-            for line in picking.move_lines:
-                line.quantity_done = line.product_uom_qty
-                picking.action_assign()
+            for move in picking.move_ids:
+                move.quantity_done = move.product_uom_qty
+            picking.action_assign()
+            with mute_logger("odoo.addons.queue_job.delay"):
                 picking.with_context(test_queue_job_no_delay=True).button_validate()
         self.assertEqual(len(self.so1.invoice_ids), 1)
         self.assertEqual(self.so1.invoice_ids.state, "posted")
 
     def test_invoice_not_created_at_shipping(self):
         """Check that an invoice is not created when goods are shipped."""
         self.partner.invoicing_mode = "standard"
         self.so1.action_confirm()
         for picking in self.so1.picking_ids:
-            for line in picking.move_lines:
-                line.quantity_done = line.product_uom_qty
+            for move in picking.move_ids:
+                move.quantity_done = move.product_uom_qty
             picking.action_assign()
-            picking.button_validate()
+            with mute_logger("odoo.addons.queue_job.delay"):
+                picking.with_context(test_queue_job_no_delay=True).button_validate()
         self.assertEqual(len(self.so1.invoice_ids), 0)
+
+    def test_picking_multi_order_single_invoice(self):
+        """A picking for more than one sale order creating a single invoice"""
+        self.partner.invoicing_mode = "at_shipping"
+        self.partner.one_invoice_per_order = False
+        so2 = self.so1.copy()
+        for order in self.so1, so2:
+            order.action_confirm()
+        # Effectively merge both pickings
+        picking = self.so1.picking_ids
+        so2.picking_ids.move_ids.picking_id = picking
+        # Transfer the remaining picking with moves
+        for move in picking.move_ids:
+            move.quantity_done = move.product_uom_qty
+        picking.action_assign()
+        with mute_logger("odoo.addons.queue_job.delay"):
+            picking.with_context(test_queue_job_no_delay=True).button_validate()
+        self.assertEqual(len(self.so1.invoice_ids), 1)
+        self.assertEqual(self.so1.invoice_ids.state, "posted")
+        self.assertEqual(self.so1.invoice_ids, so2.invoice_ids)
+
+    def test_picking_multi_order_multi_invoice(self):
+        """A picking for more than one sale order creates more than one invoice"""
+        self.partner.invoicing_mode = "at_shipping"
+        self.partner.one_invoice_per_order = True
+        so2 = self.so1.copy()
+        for order in self.so1, so2:
+            order.action_confirm()
+        # Effectively merge both pickings
+        picking = self.so1.picking_ids
+        so2.picking_ids.move_ids.picking_id = picking
+        # Transfer the remaining picking with moves
+        for move in picking.move_ids:
+            move.quantity_done = move.product_uom_qty
+        picking.action_assign()
+        with mute_logger("odoo.addons.queue_job.delay"):
+            picking.with_context(test_queue_job_no_delay=True).button_validate()
+        self.assertEqual(len(self.so1.invoice_ids), 1)
+        self.assertEqual(self.so1.invoice_ids.state, "posted")
+        self.assertEqual(len(so2.invoice_ids), 1)
+        self.assertEqual(so2.invoice_ids.state, "posted")
+        self.assertNotEqual(self.so1.invoice_ids, so2.invoice_ids)
+
+    def test_picking_backorder(self):
+        """In case of a backorder, another invoice is created"""
+        self.partner.invoicing_mode = "at_shipping"
+        self.so1.action_confirm()
+        picking = self.so1.picking_ids
+        picking.move_ids.quantity_done = 2
+        picking.action_assign()
+        with mute_logger("odoo.addons.queue_job.delay"):
+            picking.with_context(
+                skip_backorder=True, test_queue_job_no_delay=True
+            ).button_validate()
+        self.assertEqual(len(self.so1.invoice_ids), 1)
+        self.assertEqual(self.so1.invoice_ids.state, "posted")
+        # Now process the backorder
+        backorder = self.so1.picking_ids - picking
+        backorder.move_ids.quantity_done = 2
+        backorder.action_assign()
+        with mute_logger("odoo.addons.queue_job.delay"):
+            backorder.with_context(test_queue_job_no_delay=True).button_validate()
+        self.assertEqual(len(self.so1.invoice_ids), 2)
+        self.assertTrue(
+            all(invoice.state == "posted") for invoice in self.so1.invoice_ids
+        )
```

## Comparing `odoo_addon_partner_invoicing_mode_at_shipping-15.0.1.0.0.2.dist-info/METADATA` & `odoo_addon_partner_invoicing_mode_at_shipping-16.0.1.0.1.dist-info/METADATA`

 * *Files 5% similar despite different names*

```diff
@@ -1,24 +1,24 @@
 Metadata-Version: 2.1
 Name: odoo-addon-partner-invoicing-mode-at-shipping
-Version: 15.0.1.0.0.2
+Version: 16.0.1.0.1
 Summary: Create invoices automatically when goods are shipped.
 Home-page: https://github.com/OCA/account-invoicing
 Author: Camptocamp, Odoo Community Association (OCA)
 Author-email: support@odoo-community.org
 License: AGPL-3
 Platform: UNKNOWN
 Classifier: Programming Language :: Python
 Classifier: Framework :: Odoo
-Classifier: Framework :: Odoo :: 15.0
+Classifier: Framework :: Odoo :: 16.0
 Classifier: License :: OSI Approved :: GNU Affero General Public License v3
-Requires-Python: >=3.8
-Requires-Dist: odoo-addon-partner-invoicing-mode (<15.1dev,>=15.0dev)
-Requires-Dist: odoo-addon-queue-job (<15.1dev,>=15.0dev)
-Requires-Dist: odoo (<15.1dev,>=15.0a)
+Requires-Python: >=3.10
+Requires-Dist: odoo-addon-partner-invoicing-mode (<16.1dev,>=16.0dev)
+Requires-Dist: odoo-addon-queue-job (<16.1dev,>=16.0dev)
+Requires-Dist: odoo (<16.1dev,>=16.0a)
 
 ==================================
 Partner Invoicing Mode At Shipping
 ==================================
 
 .. !!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!
    !! This file is generated by oca-gen-addon-readme !!
@@ -28,21 +28,21 @@
 .. |badge1| image:: https://img.shields.io/badge/maturity-Beta-yellow.png
     :target: https://odoo-community.org/page/development-status
     :alt: Beta
 .. |badge2| image:: https://img.shields.io/badge/licence-AGPL--3-blue.png
     :target: http://www.gnu.org/licenses/agpl-3.0-standalone.html
     :alt: License: AGPL-3
 .. |badge3| image:: https://img.shields.io/badge/github-OCA%2Faccount--invoicing-lightgray.png?logo=github
-    :target: https://github.com/OCA/account-invoicing/tree/15.0/partner_invoicing_mode_at_shipping
+    :target: https://github.com/OCA/account-invoicing/tree/16.0/partner_invoicing_mode_at_shipping
     :alt: OCA/account-invoicing
 .. |badge4| image:: https://img.shields.io/badge/weblate-Translate%20me-F47D42.png
-    :target: https://translation.odoo-community.org/projects/account-invoicing-15-0/account-invoicing-15-0-partner_invoicing_mode_at_shipping
+    :target: https://translation.odoo-community.org/projects/account-invoicing-16-0/account-invoicing-16-0-partner_invoicing_mode_at_shipping
     :alt: Translate me on Weblate
 .. |badge5| image:: https://img.shields.io/badge/runbot-Try%20me-875A7B.png
-    :target: https://runbot.odoo-community.org/runbot/95/15.0
+    :target: https://runbot.odoo-community.org/runbot/95/16.0
     :alt: Try me on Runbot
 
 |badge1| |badge2| |badge3| |badge4| |badge5| 
 
 This module allows to select a `At shipping` invoicing mode for a customer.
 It is based on `partner_invoicing_mode`.
 When this mode is selected the customer will be invoiced automatically on
@@ -55,15 +55,15 @@
 
 Bug Tracker
 ===========
 
 Bugs are tracked on `GitHub Issues <https://github.com/OCA/account-invoicing/issues>`_.
 In case of trouble, please check there if your issue has already been reported.
 If you spotted it first, help us smashing it by providing a detailed and welcomed
-`feedback <https://github.com/OCA/account-invoicing/issues/new?body=module:%20partner_invoicing_mode_at_shipping%0Aversion:%2015.0%0A%0A**Steps%20to%20reproduce**%0A-%20...%0A%0A**Current%20behavior**%0A%0A**Expected%20behavior**>`_.
+`feedback <https://github.com/OCA/account-invoicing/issues/new?body=module:%20partner_invoicing_mode_at_shipping%0Aversion:%2016.0%0A%0A**Steps%20to%20reproduce**%0A-%20...%0A%0A**Current%20behavior**%0A%0A**Expected%20behavior**>`_.
 
 Do not contact contributors directly about support or help with technical issues.
 
 Credits
 =======
 
 Authors
@@ -96,12 +96,12 @@
    :alt: Odoo Community Association
    :target: https://odoo-community.org
 
 OCA, or the Odoo Community Association, is a nonprofit organization whose
 mission is to support the collaborative development of Odoo features and
 promote its widespread use.
 
-This module is part of the `OCA/account-invoicing <https://github.com/OCA/account-invoicing/tree/15.0/partner_invoicing_mode_at_shipping>`_ project on GitHub.
+This module is part of the `OCA/account-invoicing <https://github.com/OCA/account-invoicing/tree/16.0/partner_invoicing_mode_at_shipping>`_ project on GitHub.
 
 You are welcome to contribute. To learn how please visit https://odoo-community.org/page/Contribute.
```

## Comparing `odoo_addon_partner_invoicing_mode_at_shipping-15.0.1.0.0.2.dist-info/RECORD` & `odoo_addon_partner_invoicing_mode_at_shipping-16.0.1.0.1.dist-info/RECORD`

 * *Files 18% similar despite different names*

```diff
@@ -1,20 +1,20 @@
-odoo/addons/partner_invoicing_mode_at_shipping/README.rst,sha256=zZ-eobi3X9pEkkoF9DJ_K18FgPnNl8VQHtbGAyNEWoQ,3167
+odoo/addons/partner_invoicing_mode_at_shipping/README.rst,sha256=UWh_SFRai8chNmWDm5C9ph2nTPsC_HS9TLfvYSNXJ7A,3167
 odoo/addons/partner_invoicing_mode_at_shipping/__init__.py,sha256=X9EJGOE2GtZbS0G82PtSXmWSZ_R8jEM0rlJTDliQjp4,21
-odoo/addons/partner_invoicing_mode_at_shipping/__manifest__.py,sha256=m9AUg6CBUUkiJahdrUq795LMM_wpjICEYvPJUXOmnWg,565
+odoo/addons/partner_invoicing_mode_at_shipping/__manifest__.py,sha256=oUwINHTH6KjveFH9qbqTzdzzqzUSQE6DgzhoWdxjIAE,565
 odoo/addons/partner_invoicing_mode_at_shipping/data/queue_job_data.xml,sha256=D8uMzilMykUo-53WxauxLhIE6u1NzQyX747asf9EMTs,593
-odoo/addons/partner_invoicing_mode_at_shipping/i18n/partner_invoicing_mode_at_shipping.pot,sha256=d7_-z1blwk9mvXXUqWL_oA0DpFq9EQS0Tc0fWwFx8xs,1517
+odoo/addons/partner_invoicing_mode_at_shipping/i18n/partner_invoicing_mode_at_shipping.pot,sha256=5thKhkVZAmQk6hucKVhTB5J4tacRpNfaau4nKLAQKMQ,1532
 odoo/addons/partner_invoicing_mode_at_shipping/models/__init__.py,sha256=YpKRaLJYoq8t2OS3RtrpNeI9A0siSeXnPwhFCXWyGsQ,79
 odoo/addons/partner_invoicing_mode_at_shipping/models/res_partner.py,sha256=EL7noYfusKJiR4EodAFIMoX_a65NAAwIyzHY3YLnsg4,346
-odoo/addons/partner_invoicing_mode_at_shipping/models/stock_move.py,sha256=zz-1e_WCgVUnLQPW7U7lCFMMpzJhZNSGz6FgKNHoG9A,588
-odoo/addons/partner_invoicing_mode_at_shipping/models/stock_picking.py,sha256=3rrFFktKBFwl9Grkrq7xNTjNwjPo9awF-NwKq_b7HOU,1879
+odoo/addons/partner_invoicing_mode_at_shipping/models/stock_move.py,sha256=iGY3qdeDY2NP6aSuT82Xl5bg8jN5fS298xqvzAfiT_0,578
+odoo/addons/partner_invoicing_mode_at_shipping/models/stock_picking.py,sha256=SkNgilJofujbme3zgx5qCsuvVsbzhAOpFY5Po7bWbtk,1681
 odoo/addons/partner_invoicing_mode_at_shipping/readme/CONTRIBUTORS.rst,sha256=BSJkiEXstZ9G0OF7XbU-hRNkxdiloXDZTQ1FMWl5wPI,140
 odoo/addons/partner_invoicing_mode_at_shipping/readme/CREDITS.rst,sha256=qJic0c2qWDTloupuq6j69JdIEo70Xpy6-b4MZho00Og,80
 odoo/addons/partner_invoicing_mode_at_shipping/readme/DESCRIPTION.rst,sha256=Pv_uM-i2P2rWuAg4EOYSD4hkdtHW5BWDCGjI2dsKo1E,214
 odoo/addons/partner_invoicing_mode_at_shipping/static/description/icon.png,sha256=6xBPJauaFOF0KDHfHgQopSc28kKvxMaeoQFQWZtfZDo,9455
-odoo/addons/partner_invoicing_mode_at_shipping/static/description/index.html,sha256=sWCPwlKvl0GdgJkEspLFLC6lBxG1HbETZqZhMJmfEBc,12719
+odoo/addons/partner_invoicing_mode_at_shipping/static/description/index.html,sha256=2HOd8fuNwdR826wmShSg4q_0DuxE5ZY29QS0fnx4wxw,12719
 odoo/addons/partner_invoicing_mode_at_shipping/tests/__init__.py,sha256=dYHPgFA5sEInkCE0HCQwQO4WOLU99RxGLp5t1ytViJQ,44
-odoo/addons/partner_invoicing_mode_at_shipping/tests/test_invoice_mode_at_shipping.py,sha256=01EyY2iFOMvPoixdyep4-Qv9MK4R-OUm5855nWgUPno,2330
-odoo_addon_partner_invoicing_mode_at_shipping-15.0.1.0.0.2.dist-info/METADATA,sha256=6Z0nEWmg-m8m6nV1GHmEC-t5URzRCmHweY9s7K4Gwfw,3885
-odoo_addon_partner_invoicing_mode_at_shipping-15.0.1.0.0.2.dist-info/WHEEL,sha256=2wepM1nk4DS4eFpYrW1TTqPcoGNfHhhO_i5m4cOimbo,92
-odoo_addon_partner_invoicing_mode_at_shipping-15.0.1.0.0.2.dist-info/top_level.txt,sha256=qBj40grFkGOfDZ2WDSw3y1RnDlgG0u8rP8pvGNdbz4w,5
-odoo_addon_partner_invoicing_mode_at_shipping-15.0.1.0.0.2.dist-info/RECORD,,
+odoo/addons/partner_invoicing_mode_at_shipping/tests/test_invoice_mode_at_shipping.py,sha256=4kFr6h3V9W6W_ihuMO-zFS3x3zfx4TR82qxBMSv8KF4,5665
+odoo_addon_partner_invoicing_mode_at_shipping-16.0.1.0.1.dist-info/METADATA,sha256=y8OXgxGR3RkR5fcYPqfvkgG6EXgKrphGV55dhx12FTA,3884
+odoo_addon_partner_invoicing_mode_at_shipping-16.0.1.0.1.dist-info/WHEEL,sha256=2wepM1nk4DS4eFpYrW1TTqPcoGNfHhhO_i5m4cOimbo,92
+odoo_addon_partner_invoicing_mode_at_shipping-16.0.1.0.1.dist-info/top_level.txt,sha256=qBj40grFkGOfDZ2WDSw3y1RnDlgG0u8rP8pvGNdbz4w,5
+odoo_addon_partner_invoicing_mode_at_shipping-16.0.1.0.1.dist-info/RECORD,,
```

